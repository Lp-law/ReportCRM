(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))r(a);new MutationObserver(a=>{for(const o of a)if(o.type==="childList")for(const l of o.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&r(l)}).observe(document,{childList:!0,subtree:!0});function s(a){const o={};return a.integrity&&(o.integrity=a.integrity),a.referrerPolicy&&(o.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?o.credentials="include":a.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function r(a){if(a.ep)return;a.ep=!0;const o=s(a);fetch(a.href,o)}})();function Gh(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var Kp={exports:{}},li={},Yp={exports:{}},et={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Eo=Symbol.for("react.element"),qh=Symbol.for("react.portal"),Xh=Symbol.for("react.fragment"),Jh=Symbol.for("react.strict_mode"),Qh=Symbol.for("react.profiler"),Zh=Symbol.for("react.provider"),eg=Symbol.for("react.context"),tg=Symbol.for("react.forward_ref"),ng=Symbol.for("react.suspense"),sg=Symbol.for("react.memo"),rg=Symbol.for("react.lazy"),Xu=Symbol.iterator;function ag(e){return e===null||typeof e!="object"?null:(e=Xu&&e[Xu]||e["@@iterator"],typeof e=="function"?e:null)}var Gp={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},qp=Object.assign,Xp={};function ca(e,t,s){this.props=e,this.context=t,this.refs=Xp,this.updater=s||Gp}ca.prototype.isReactComponent={};ca.prototype.setState=function(e,t){if(typeof e!="object"&&typeof e!="function"&&e!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,e,t,"setState")};ca.prototype.forceUpdate=function(e){this.updater.enqueueForceUpdate(this,e,"forceUpdate")};function Jp(){}Jp.prototype=ca.prototype;function Pd(e,t,s){this.props=e,this.context=t,this.refs=Xp,this.updater=s||Gp}var Fd=Pd.prototype=new Jp;Fd.constructor=Pd;qp(Fd,ca.prototype);Fd.isPureReactComponent=!0;var Ju=Array.isArray,Qp=Object.prototype.hasOwnProperty,Bd={current:null},Zp={key:!0,ref:!0,__self:!0,__source:!0};function ef(e,t,s){var r,a={},o=null,l=null;if(t!=null)for(r in t.ref!==void 0&&(l=t.ref),t.key!==void 0&&(o=""+t.key),t)Qp.call(t,r)&&!Zp.hasOwnProperty(r)&&(a[r]=t[r]);var c=arguments.length-2;if(c===1)a.children=s;else if(1<c){for(var i=Array(c),u=0;u<c;u++)i[u]=arguments[u+2];a.children=i}if(e&&e.defaultProps)for(r in c=e.defaultProps,c)a[r]===void 0&&(a[r]=c[r]);return{$$typeof:Eo,type:e,key:o,ref:l,props:a,_owner:Bd.current}}function og(e,t){return{$$typeof:Eo,type:e.type,key:t,ref:e.ref,props:e.props,_owner:e._owner}}function $d(e){return typeof e=="object"&&e!==null&&e.$$typeof===Eo}function lg(e){var t={"=":"=0",":":"=2"};return"$"+e.replace(/[=:]/g,function(s){return t[s]})}var Qu=/\/+/g;function Xi(e,t){return typeof e=="object"&&e!==null&&e.key!=null?lg(""+e.key):t.toString(36)}function pl(e,t,s,r,a){var o=typeof e;(o==="undefined"||o==="boolean")&&(e=null);var l=!1;if(e===null)l=!0;else switch(o){case"string":case"number":l=!0;break;case"object":switch(e.$$typeof){case Eo:case qh:l=!0}}if(l)return l=e,a=a(l),e=r===""?"."+Xi(l,0):r,Ju(a)?(s="",e!=null&&(s=e.replace(Qu,"$&/")+"/"),pl(a,t,s,"",function(u){return u})):a!=null&&($d(a)&&(a=og(a,s+(!a.key||l&&l.key===a.key?"":(""+a.key).replace(Qu,"$&/")+"/")+e)),t.push(a)),1;if(l=0,r=r===""?".":r+":",Ju(e))for(var c=0;c<e.length;c++){o=e[c];var i=r+Xi(o,c);l+=pl(o,t,s,i,a)}else if(i=ag(e),typeof i=="function")for(e=i.call(e),c=0;!(o=e.next()).done;)o=o.value,i=r+Xi(o,c++),l+=pl(o,t,s,i,a);else if(o==="object")throw t=String(e),Error("Objects are not valid as a React child (found: "+(t==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":t)+"). If you meant to render a collection of children, use an array instead.");return l}function Wo(e,t,s){if(e==null)return e;var r=[],a=0;return pl(e,r,"","",function(o){return t.call(s,o,a++)}),r}function ig(e){if(e._status===-1){var t=e._result;t=t(),t.then(function(s){(e._status===0||e._status===-1)&&(e._status=1,e._result=s)},function(s){(e._status===0||e._status===-1)&&(e._status=2,e._result=s)}),e._status===-1&&(e._status=0,e._result=t)}if(e._status===1)return e._result.default;throw e._result}var un={current:null},fl={transition:null},cg={ReactCurrentDispatcher:un,ReactCurrentBatchConfig:fl,ReactCurrentOwner:Bd};function tf(){throw Error("act(...) is not supported in production builds of React.")}et.Children={map:Wo,forEach:function(e,t,s){Wo(e,function(){t.apply(this,arguments)},s)},count:function(e){var t=0;return Wo(e,function(){t++}),t},toArray:function(e){return Wo(e,function(t){return t})||[]},only:function(e){if(!$d(e))throw Error("React.Children.only expected to receive a single React element child.");return e}};et.Component=ca;et.Fragment=Xh;et.Profiler=Qh;et.PureComponent=Pd;et.StrictMode=Jh;et.Suspense=ng;et.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=cg;et.act=tf;et.cloneElement=function(e,t,s){if(e==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+e+".");var r=qp({},e.props),a=e.key,o=e.ref,l=e._owner;if(t!=null){if(t.ref!==void 0&&(o=t.ref,l=Bd.current),t.key!==void 0&&(a=""+t.key),e.type&&e.type.defaultProps)var c=e.type.defaultProps;for(i in t)Qp.call(t,i)&&!Zp.hasOwnProperty(i)&&(r[i]=t[i]===void 0&&c!==void 0?c[i]:t[i])}var i=arguments.length-2;if(i===1)r.children=s;else if(1<i){c=Array(i);for(var u=0;u<i;u++)c[u]=arguments[u+2];r.children=c}return{$$typeof:Eo,type:e.type,key:a,ref:o,props:r,_owner:l}};et.createContext=function(e){return e={$$typeof:eg,_currentValue:e,_currentValue2:e,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},e.Provider={$$typeof:Zh,_context:e},e.Consumer=e};et.createElement=ef;et.createFactory=function(e){var t=ef.bind(null,e);return t.type=e,t};et.createRef=function(){return{current:null}};et.forwardRef=function(e){return{$$typeof:tg,render:e}};et.isValidElement=$d;et.lazy=function(e){return{$$typeof:rg,_payload:{_status:-1,_result:e},_init:ig}};et.memo=function(e,t){return{$$typeof:sg,type:e,compare:t===void 0?null:t}};et.startTransition=function(e){var t=fl.transition;fl.transition={};try{e()}finally{fl.transition=t}};et.unstable_act=tf;et.useCallback=function(e,t){return un.current.useCallback(e,t)};et.useContext=function(e){return un.current.useContext(e)};et.useDebugValue=function(){};et.useDeferredValue=function(e){return un.current.useDeferredValue(e)};et.useEffect=function(e,t){return un.current.useEffect(e,t)};et.useId=function(){return un.current.useId()};et.useImperativeHandle=function(e,t,s){return un.current.useImperativeHandle(e,t,s)};et.useInsertionEffect=function(e,t){return un.current.useInsertionEffect(e,t)};et.useLayoutEffect=function(e,t){return un.current.useLayoutEffect(e,t)};et.useMemo=function(e,t){return un.current.useMemo(e,t)};et.useReducer=function(e,t,s){return un.current.useReducer(e,t,s)};et.useRef=function(e){return un.current.useRef(e)};et.useState=function(e){return un.current.useState(e)};et.useSyncExternalStore=function(e,t,s){return un.current.useSyncExternalStore(e,t,s)};et.useTransition=function(){return un.current.useTransition()};et.version="18.3.1";Yp.exports=et;var g=Yp.exports;const ii=Gh(g);/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var dg=g,ug=Symbol.for("react.element"),mg=Symbol.for("react.fragment"),pg=Object.prototype.hasOwnProperty,fg=dg.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,xg={key:!0,ref:!0,__self:!0,__source:!0};function nf(e,t,s){var r,a={},o=null,l=null;s!==void 0&&(o=""+s),t.key!==void 0&&(o=""+t.key),t.ref!==void 0&&(l=t.ref);for(r in t)pg.call(t,r)&&!xg.hasOwnProperty(r)&&(a[r]=t[r]);if(e&&e.defaultProps)for(r in t=e.defaultProps,t)a[r]===void 0&&(a[r]=t[r]);return{$$typeof:ug,type:e,key:o,ref:l,props:a,_owner:fg.current}}li.Fragment=mg;li.jsx=nf;li.jsxs=nf;Kp.exports=li;var n=Kp.exports,Pc={},sf={exports:{}},En={},rf={exports:{}},af={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(e){function t(L,Q){var me=L.length;L.push(Q);e:for(;0<me;){var ce=me-1>>>1,le=L[ce];if(0<a(le,Q))L[ce]=Q,L[me]=le,me=ce;else break e}}function s(L){return L.length===0?null:L[0]}function r(L){if(L.length===0)return null;var Q=L[0],me=L.pop();if(me!==Q){L[0]=me;e:for(var ce=0,le=L.length,fe=le>>>1;ce<fe;){var Te=2*(ce+1)-1,ge=L[Te],Be=Te+1,Ye=L[Be];if(0>a(ge,me))Be<le&&0>a(Ye,ge)?(L[ce]=Ye,L[Be]=me,ce=Be):(L[ce]=ge,L[Te]=me,ce=Te);else if(Be<le&&0>a(Ye,me))L[ce]=Ye,L[Be]=me,ce=Be;else break e}}return Q}function a(L,Q){var me=L.sortIndex-Q.sortIndex;return me!==0?me:L.id-Q.id}if(typeof performance=="object"&&typeof performance.now=="function"){var o=performance;e.unstable_now=function(){return o.now()}}else{var l=Date,c=l.now();e.unstable_now=function(){return l.now()-c}}var i=[],u=[],p=1,y=null,b=3,w=!1,R=!1,E=!1,W=typeof setTimeout=="function"?setTimeout:null,N=typeof clearTimeout=="function"?clearTimeout:null,h=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function S(L){for(var Q=s(u);Q!==null;){if(Q.callback===null)r(u);else if(Q.startTime<=L)r(u),Q.sortIndex=Q.expirationTime,t(i,Q);else break;Q=s(u)}}function M(L){if(E=!1,S(L),!R)if(s(i)!==null)R=!0,F(H);else{var Q=s(u);Q!==null&&C(M,Q.startTime-L)}}function H(L,Q){R=!1,E&&(E=!1,N(te),te=-1),w=!0;var me=b;try{for(S(Q),y=s(i);y!==null&&(!(y.expirationTime>Q)||L&&!j());){var ce=y.callback;if(typeof ce=="function"){y.callback=null,b=y.priorityLevel;var le=ce(y.expirationTime<=Q);Q=e.unstable_now(),typeof le=="function"?y.callback=le:y===s(i)&&r(i),S(Q)}else r(i);y=s(i)}if(y!==null)var fe=!0;else{var Te=s(u);Te!==null&&C(M,Te.startTime-Q),fe=!1}return fe}finally{y=null,b=me,w=!1}}var V=!1,q=null,te=-1,G=5,re=-1;function j(){return!(e.unstable_now()-re<G)}function P(){if(q!==null){var L=e.unstable_now();re=L;var Q=!0;try{Q=q(!0,L)}finally{Q?D():(V=!1,q=null)}}else V=!1}var D;if(typeof h=="function")D=function(){h(P)};else if(typeof MessageChannel<"u"){var O=new MessageChannel,z=O.port2;O.port1.onmessage=P,D=function(){z.postMessage(null)}}else D=function(){W(P,0)};function F(L){q=L,V||(V=!0,D())}function C(L,Q){te=W(function(){L(e.unstable_now())},Q)}e.unstable_IdlePriority=5,e.unstable_ImmediatePriority=1,e.unstable_LowPriority=4,e.unstable_NormalPriority=3,e.unstable_Profiling=null,e.unstable_UserBlockingPriority=2,e.unstable_cancelCallback=function(L){L.callback=null},e.unstable_continueExecution=function(){R||w||(R=!0,F(H))},e.unstable_forceFrameRate=function(L){0>L||125<L?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):G=0<L?Math.floor(1e3/L):5},e.unstable_getCurrentPriorityLevel=function(){return b},e.unstable_getFirstCallbackNode=function(){return s(i)},e.unstable_next=function(L){switch(b){case 1:case 2:case 3:var Q=3;break;default:Q=b}var me=b;b=Q;try{return L()}finally{b=me}},e.unstable_pauseExecution=function(){},e.unstable_requestPaint=function(){},e.unstable_runWithPriority=function(L,Q){switch(L){case 1:case 2:case 3:case 4:case 5:break;default:L=3}var me=b;b=L;try{return Q()}finally{b=me}},e.unstable_scheduleCallback=function(L,Q,me){var ce=e.unstable_now();switch(typeof me=="object"&&me!==null?(me=me.delay,me=typeof me=="number"&&0<me?ce+me:ce):me=ce,L){case 1:var le=-1;break;case 2:le=250;break;case 5:le=1073741823;break;case 4:le=1e4;break;default:le=5e3}return le=me+le,L={id:p++,callback:Q,priorityLevel:L,startTime:me,expirationTime:le,sortIndex:-1},me>ce?(L.sortIndex=me,t(u,L),s(i)===null&&L===s(u)&&(E?(N(te),te=-1):E=!0,C(M,me-ce))):(L.sortIndex=le,t(i,L),R||w||(R=!0,F(H))),L},e.unstable_shouldYield=j,e.unstable_wrapCallback=function(L){var Q=b;return function(){var me=b;b=Q;try{return L.apply(this,arguments)}finally{b=me}}}})(af);rf.exports=af;var hg=rf.exports;/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var gg=g,jn=hg;function pe(e){for(var t="https://reactjs.org/docs/error-decoder.html?invariant="+e,s=1;s<arguments.length;s++)t+="&args[]="+encodeURIComponent(arguments[s]);return"Minified React error #"+e+"; visit "+t+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var of=new Set,Ja={};function vr(e,t){Zr(e,t),Zr(e+"Capture",t)}function Zr(e,t){for(Ja[e]=t,e=0;e<t.length;e++)of.add(t[e])}var js=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),Fc=Object.prototype.hasOwnProperty,yg=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,Zu={},em={};function Ng(e){return Fc.call(em,e)?!0:Fc.call(Zu,e)?!1:yg.test(e)?em[e]=!0:(Zu[e]=!0,!1)}function bg(e,t,s,r){if(s!==null&&s.type===0)return!1;switch(typeof t){case"function":case"symbol":return!0;case"boolean":return r?!1:s!==null?!s.acceptsBooleans:(e=e.toLowerCase().slice(0,5),e!=="data-"&&e!=="aria-");default:return!1}}function vg(e,t,s,r){if(t===null||typeof t>"u"||bg(e,t,s,r))return!0;if(r)return!1;if(s!==null)switch(s.type){case 3:return!t;case 4:return t===!1;case 5:return isNaN(t);case 6:return isNaN(t)||1>t}return!1}function mn(e,t,s,r,a,o,l){this.acceptsBooleans=t===2||t===3||t===4,this.attributeName=r,this.attributeNamespace=a,this.mustUseProperty=s,this.propertyName=e,this.type=t,this.sanitizeURL=o,this.removeEmptyString=l}var Gt={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(e){Gt[e]=new mn(e,0,!1,e,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(e){var t=e[0];Gt[t]=new mn(t,1,!1,e[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(e){Gt[e]=new mn(e,2,!1,e.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(e){Gt[e]=new mn(e,2,!1,e,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(e){Gt[e]=new mn(e,3,!1,e.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(e){Gt[e]=new mn(e,3,!0,e,null,!1,!1)});["capture","download"].forEach(function(e){Gt[e]=new mn(e,4,!1,e,null,!1,!1)});["cols","rows","size","span"].forEach(function(e){Gt[e]=new mn(e,6,!1,e,null,!1,!1)});["rowSpan","start"].forEach(function(e){Gt[e]=new mn(e,5,!1,e.toLowerCase(),null,!1,!1)});var Hd=/[\-:]([a-z])/g;function Ud(e){return e[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(e){var t=e.replace(Hd,Ud);Gt[t]=new mn(t,1,!1,e,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(e){var t=e.replace(Hd,Ud);Gt[t]=new mn(t,1,!1,e,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(e){var t=e.replace(Hd,Ud);Gt[t]=new mn(t,1,!1,e,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(e){Gt[e]=new mn(e,1,!1,e.toLowerCase(),null,!1,!1)});Gt.xlinkHref=new mn("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(e){Gt[e]=new mn(e,1,!1,e.toLowerCase(),null,!0,!0)});function Wd(e,t,s,r){var a=Gt.hasOwnProperty(t)?Gt[t]:null;(a!==null?a.type!==0:r||!(2<t.length)||t[0]!=="o"&&t[0]!=="O"||t[1]!=="n"&&t[1]!=="N")&&(vg(t,s,a,r)&&(s=null),r||a===null?Ng(t)&&(s===null?e.removeAttribute(t):e.setAttribute(t,""+s)):a.mustUseProperty?e[a.propertyName]=s===null?a.type===3?!1:"":s:(t=a.attributeName,r=a.attributeNamespace,s===null?e.removeAttribute(t):(a=a.type,s=a===3||a===4&&s===!0?"":""+s,r?e.setAttributeNS(r,t,s):e.setAttribute(t,s))))}var Is=gg.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,zo=Symbol.for("react.element"),_r=Symbol.for("react.portal"),Or=Symbol.for("react.fragment"),zd=Symbol.for("react.strict_mode"),Bc=Symbol.for("react.profiler"),lf=Symbol.for("react.provider"),cf=Symbol.for("react.context"),Vd=Symbol.for("react.forward_ref"),$c=Symbol.for("react.suspense"),Hc=Symbol.for("react.suspense_list"),Kd=Symbol.for("react.memo"),Ls=Symbol.for("react.lazy"),df=Symbol.for("react.offscreen"),tm=Symbol.iterator;function Ea(e){return e===null||typeof e!="object"?null:(e=tm&&e[tm]||e["@@iterator"],typeof e=="function"?e:null)}var kt=Object.assign,Ji;function Ma(e){if(Ji===void 0)try{throw Error()}catch(s){var t=s.stack.trim().match(/\n( *(at )?)/);Ji=t&&t[1]||""}return`
`+Ji+e}var Qi=!1;function Zi(e,t){if(!e||Qi)return"";Qi=!0;var s=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(t)if(t=function(){throw Error()},Object.defineProperty(t.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(t,[])}catch(u){var r=u}Reflect.construct(e,[],t)}else{try{t.call()}catch(u){r=u}e.call(t.prototype)}else{try{throw Error()}catch(u){r=u}e()}}catch(u){if(u&&r&&typeof u.stack=="string"){for(var a=u.stack.split(`
`),o=r.stack.split(`
`),l=a.length-1,c=o.length-1;1<=l&&0<=c&&a[l]!==o[c];)c--;for(;1<=l&&0<=c;l--,c--)if(a[l]!==o[c]){if(l!==1||c!==1)do if(l--,c--,0>c||a[l]!==o[c]){var i=`
`+a[l].replace(" at new "," at ");return e.displayName&&i.includes("<anonymous>")&&(i=i.replace("<anonymous>",e.displayName)),i}while(1<=l&&0<=c);break}}}finally{Qi=!1,Error.prepareStackTrace=s}return(e=e?e.displayName||e.name:"")?Ma(e):""}function Sg(e){switch(e.tag){case 5:return Ma(e.type);case 16:return Ma("Lazy");case 13:return Ma("Suspense");case 19:return Ma("SuspenseList");case 0:case 2:case 15:return e=Zi(e.type,!1),e;case 11:return e=Zi(e.type.render,!1),e;case 1:return e=Zi(e.type,!0),e;default:return""}}function Uc(e){if(e==null)return null;if(typeof e=="function")return e.displayName||e.name||null;if(typeof e=="string")return e;switch(e){case Or:return"Fragment";case _r:return"Portal";case Bc:return"Profiler";case zd:return"StrictMode";case $c:return"Suspense";case Hc:return"SuspenseList"}if(typeof e=="object")switch(e.$$typeof){case cf:return(e.displayName||"Context")+".Consumer";case lf:return(e._context.displayName||"Context")+".Provider";case Vd:var t=e.render;return e=e.displayName,e||(e=t.displayName||t.name||"",e=e!==""?"ForwardRef("+e+")":"ForwardRef"),e;case Kd:return t=e.displayName||null,t!==null?t:Uc(e.type)||"Memo";case Ls:t=e._payload,e=e._init;try{return Uc(e(t))}catch{}}return null}function wg(e){var t=e.type;switch(e.tag){case 24:return"Cache";case 9:return(t.displayName||"Context")+".Consumer";case 10:return(t._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return e=t.render,e=e.displayName||e.name||"",t.displayName||(e!==""?"ForwardRef("+e+")":"ForwardRef");case 7:return"Fragment";case 5:return t;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return Uc(t);case 8:return t===zd?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof t=="function")return t.displayName||t.name||null;if(typeof t=="string")return t}return null}function Js(e){switch(typeof e){case"boolean":case"number":case"string":case"undefined":return e;case"object":return e;default:return""}}function uf(e){var t=e.type;return(e=e.nodeName)&&e.toLowerCase()==="input"&&(t==="checkbox"||t==="radio")}function jg(e){var t=uf(e)?"checked":"value",s=Object.getOwnPropertyDescriptor(e.constructor.prototype,t),r=""+e[t];if(!e.hasOwnProperty(t)&&typeof s<"u"&&typeof s.get=="function"&&typeof s.set=="function"){var a=s.get,o=s.set;return Object.defineProperty(e,t,{configurable:!0,get:function(){return a.call(this)},set:function(l){r=""+l,o.call(this,l)}}),Object.defineProperty(e,t,{enumerable:s.enumerable}),{getValue:function(){return r},setValue:function(l){r=""+l},stopTracking:function(){e._valueTracker=null,delete e[t]}}}}function Vo(e){e._valueTracker||(e._valueTracker=jg(e))}function mf(e){if(!e)return!1;var t=e._valueTracker;if(!t)return!0;var s=t.getValue(),r="";return e&&(r=uf(e)?e.checked?"true":"false":e.value),e=r,e!==s?(t.setValue(e),!0):!1}function kl(e){if(e=e||(typeof document<"u"?document:void 0),typeof e>"u")return null;try{return e.activeElement||e.body}catch{return e.body}}function Wc(e,t){var s=t.checked;return kt({},t,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:s??e._wrapperState.initialChecked})}function nm(e,t){var s=t.defaultValue==null?"":t.defaultValue,r=t.checked!=null?t.checked:t.defaultChecked;s=Js(t.value!=null?t.value:s),e._wrapperState={initialChecked:r,initialValue:s,controlled:t.type==="checkbox"||t.type==="radio"?t.checked!=null:t.value!=null}}function pf(e,t){t=t.checked,t!=null&&Wd(e,"checked",t,!1)}function zc(e,t){pf(e,t);var s=Js(t.value),r=t.type;if(s!=null)r==="number"?(s===0&&e.value===""||e.value!=s)&&(e.value=""+s):e.value!==""+s&&(e.value=""+s);else if(r==="submit"||r==="reset"){e.removeAttribute("value");return}t.hasOwnProperty("value")?Vc(e,t.type,s):t.hasOwnProperty("defaultValue")&&Vc(e,t.type,Js(t.defaultValue)),t.checked==null&&t.defaultChecked!=null&&(e.defaultChecked=!!t.defaultChecked)}function sm(e,t,s){if(t.hasOwnProperty("value")||t.hasOwnProperty("defaultValue")){var r=t.type;if(!(r!=="submit"&&r!=="reset"||t.value!==void 0&&t.value!==null))return;t=""+e._wrapperState.initialValue,s||t===e.value||(e.value=t),e.defaultValue=t}s=e.name,s!==""&&(e.name=""),e.defaultChecked=!!e._wrapperState.initialChecked,s!==""&&(e.name=s)}function Vc(e,t,s){(t!=="number"||kl(e.ownerDocument)!==e)&&(s==null?e.defaultValue=""+e._wrapperState.initialValue:e.defaultValue!==""+s&&(e.defaultValue=""+s))}var Pa=Array.isArray;function Kr(e,t,s,r){if(e=e.options,t){t={};for(var a=0;a<s.length;a++)t["$"+s[a]]=!0;for(s=0;s<e.length;s++)a=t.hasOwnProperty("$"+e[s].value),e[s].selected!==a&&(e[s].selected=a),a&&r&&(e[s].defaultSelected=!0)}else{for(s=""+Js(s),t=null,a=0;a<e.length;a++){if(e[a].value===s){e[a].selected=!0,r&&(e[a].defaultSelected=!0);return}t!==null||e[a].disabled||(t=e[a])}t!==null&&(t.selected=!0)}}function Kc(e,t){if(t.dangerouslySetInnerHTML!=null)throw Error(pe(91));return kt({},t,{value:void 0,defaultValue:void 0,children:""+e._wrapperState.initialValue})}function rm(e,t){var s=t.value;if(s==null){if(s=t.children,t=t.defaultValue,s!=null){if(t!=null)throw Error(pe(92));if(Pa(s)){if(1<s.length)throw Error(pe(93));s=s[0]}t=s}t==null&&(t=""),s=t}e._wrapperState={initialValue:Js(s)}}function ff(e,t){var s=Js(t.value),r=Js(t.defaultValue);s!=null&&(s=""+s,s!==e.value&&(e.value=s),t.defaultValue==null&&e.defaultValue!==s&&(e.defaultValue=s)),r!=null&&(e.defaultValue=""+r)}function am(e){var t=e.textContent;t===e._wrapperState.initialValue&&t!==""&&t!==null&&(e.value=t)}function xf(e){switch(e){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function Yc(e,t){return e==null||e==="http://www.w3.org/1999/xhtml"?xf(t):e==="http://www.w3.org/2000/svg"&&t==="foreignObject"?"http://www.w3.org/1999/xhtml":e}var Ko,hf=function(e){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(t,s,r,a){MSApp.execUnsafeLocalFunction(function(){return e(t,s,r,a)})}:e}(function(e,t){if(e.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in e)e.innerHTML=t;else{for(Ko=Ko||document.createElement("div"),Ko.innerHTML="<svg>"+t.valueOf().toString()+"</svg>",t=Ko.firstChild;e.firstChild;)e.removeChild(e.firstChild);for(;t.firstChild;)e.appendChild(t.firstChild)}});function Qa(e,t){if(t){var s=e.firstChild;if(s&&s===e.lastChild&&s.nodeType===3){s.nodeValue=t;return}}e.textContent=t}var $a={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},Eg=["Webkit","ms","Moz","O"];Object.keys($a).forEach(function(e){Eg.forEach(function(t){t=t+e.charAt(0).toUpperCase()+e.substring(1),$a[t]=$a[e]})});function gf(e,t,s){return t==null||typeof t=="boolean"||t===""?"":s||typeof t!="number"||t===0||$a.hasOwnProperty(e)&&$a[e]?(""+t).trim():t+"px"}function yf(e,t){e=e.style;for(var s in t)if(t.hasOwnProperty(s)){var r=s.indexOf("--")===0,a=gf(s,t[s],r);s==="float"&&(s="cssFloat"),r?e.setProperty(s,a):e[s]=a}}var kg=kt({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function Gc(e,t){if(t){if(kg[e]&&(t.children!=null||t.dangerouslySetInnerHTML!=null))throw Error(pe(137,e));if(t.dangerouslySetInnerHTML!=null){if(t.children!=null)throw Error(pe(60));if(typeof t.dangerouslySetInnerHTML!="object"||!("__html"in t.dangerouslySetInnerHTML))throw Error(pe(61))}if(t.style!=null&&typeof t.style!="object")throw Error(pe(62))}}function qc(e,t){if(e.indexOf("-")===-1)return typeof t.is=="string";switch(e){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var Xc=null;function Yd(e){return e=e.target||e.srcElement||window,e.correspondingUseElement&&(e=e.correspondingUseElement),e.nodeType===3?e.parentNode:e}var Jc=null,Yr=null,Gr=null;function om(e){if(e=Io(e)){if(typeof Jc!="function")throw Error(pe(280));var t=e.stateNode;t&&(t=pi(t),Jc(e.stateNode,e.type,t))}}function Nf(e){Yr?Gr?Gr.push(e):Gr=[e]:Yr=e}function bf(){if(Yr){var e=Yr,t=Gr;if(Gr=Yr=null,om(e),t)for(e=0;e<t.length;e++)om(t[e])}}function vf(e,t){return e(t)}function Sf(){}var ec=!1;function wf(e,t,s){if(ec)return e(t,s);ec=!0;try{return vf(e,t,s)}finally{ec=!1,(Yr!==null||Gr!==null)&&(Sf(),bf())}}function Za(e,t){var s=e.stateNode;if(s===null)return null;var r=pi(s);if(r===null)return null;s=r[t];e:switch(t){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(r=!r.disabled)||(e=e.type,r=!(e==="button"||e==="input"||e==="select"||e==="textarea")),e=!r;break e;default:e=!1}if(e)return null;if(s&&typeof s!="function")throw Error(pe(231,t,typeof s));return s}var Qc=!1;if(js)try{var ka={};Object.defineProperty(ka,"passive",{get:function(){Qc=!0}}),window.addEventListener("test",ka,ka),window.removeEventListener("test",ka,ka)}catch{Qc=!1}function Ag(e,t,s,r,a,o,l,c,i){var u=Array.prototype.slice.call(arguments,3);try{t.apply(s,u)}catch(p){this.onError(p)}}var Ha=!1,Al=null,Il=!1,Zc=null,Ig={onError:function(e){Ha=!0,Al=e}};function Tg(e,t,s,r,a,o,l,c,i){Ha=!1,Al=null,Ag.apply(Ig,arguments)}function Rg(e,t,s,r,a,o,l,c,i){if(Tg.apply(this,arguments),Ha){if(Ha){var u=Al;Ha=!1,Al=null}else throw Error(pe(198));Il||(Il=!0,Zc=u)}}function Sr(e){var t=e,s=e;if(e.alternate)for(;t.return;)t=t.return;else{e=t;do t=e,t.flags&4098&&(s=t.return),e=t.return;while(e)}return t.tag===3?s:null}function jf(e){if(e.tag===13){var t=e.memoizedState;if(t===null&&(e=e.alternate,e!==null&&(t=e.memoizedState)),t!==null)return t.dehydrated}return null}function lm(e){if(Sr(e)!==e)throw Error(pe(188))}function Cg(e){var t=e.alternate;if(!t){if(t=Sr(e),t===null)throw Error(pe(188));return t!==e?null:e}for(var s=e,r=t;;){var a=s.return;if(a===null)break;var o=a.alternate;if(o===null){if(r=a.return,r!==null){s=r;continue}break}if(a.child===o.child){for(o=a.child;o;){if(o===s)return lm(a),e;if(o===r)return lm(a),t;o=o.sibling}throw Error(pe(188))}if(s.return!==r.return)s=a,r=o;else{for(var l=!1,c=a.child;c;){if(c===s){l=!0,s=a,r=o;break}if(c===r){l=!0,r=a,s=o;break}c=c.sibling}if(!l){for(c=o.child;c;){if(c===s){l=!0,s=o,r=a;break}if(c===r){l=!0,r=o,s=a;break}c=c.sibling}if(!l)throw Error(pe(189))}}if(s.alternate!==r)throw Error(pe(190))}if(s.tag!==3)throw Error(pe(188));return s.stateNode.current===s?e:t}function Ef(e){return e=Cg(e),e!==null?kf(e):null}function kf(e){if(e.tag===5||e.tag===6)return e;for(e=e.child;e!==null;){var t=kf(e);if(t!==null)return t;e=e.sibling}return null}var Af=jn.unstable_scheduleCallback,im=jn.unstable_cancelCallback,Dg=jn.unstable_shouldYield,Lg=jn.unstable_requestPaint,Ct=jn.unstable_now,_g=jn.unstable_getCurrentPriorityLevel,Gd=jn.unstable_ImmediatePriority,If=jn.unstable_UserBlockingPriority,Tl=jn.unstable_NormalPriority,Og=jn.unstable_LowPriority,Tf=jn.unstable_IdlePriority,ci=null,cs=null;function Mg(e){if(cs&&typeof cs.onCommitFiberRoot=="function")try{cs.onCommitFiberRoot(ci,e,void 0,(e.current.flags&128)===128)}catch{}}var Kn=Math.clz32?Math.clz32:Bg,Pg=Math.log,Fg=Math.LN2;function Bg(e){return e>>>=0,e===0?32:31-(Pg(e)/Fg|0)|0}var Yo=64,Go=4194304;function Fa(e){switch(e&-e){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return e&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return e&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return e}}function Rl(e,t){var s=e.pendingLanes;if(s===0)return 0;var r=0,a=e.suspendedLanes,o=e.pingedLanes,l=s&268435455;if(l!==0){var c=l&~a;c!==0?r=Fa(c):(o&=l,o!==0&&(r=Fa(o)))}else l=s&~a,l!==0?r=Fa(l):o!==0&&(r=Fa(o));if(r===0)return 0;if(t!==0&&t!==r&&!(t&a)&&(a=r&-r,o=t&-t,a>=o||a===16&&(o&4194240)!==0))return t;if(r&4&&(r|=s&16),t=e.entangledLanes,t!==0)for(e=e.entanglements,t&=r;0<t;)s=31-Kn(t),a=1<<s,r|=e[s],t&=~a;return r}function $g(e,t){switch(e){case 1:case 2:case 4:return t+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function Hg(e,t){for(var s=e.suspendedLanes,r=e.pingedLanes,a=e.expirationTimes,o=e.pendingLanes;0<o;){var l=31-Kn(o),c=1<<l,i=a[l];i===-1?(!(c&s)||c&r)&&(a[l]=$g(c,t)):i<=t&&(e.expiredLanes|=c),o&=~c}}function ed(e){return e=e.pendingLanes&-1073741825,e!==0?e:e&1073741824?1073741824:0}function Rf(){var e=Yo;return Yo<<=1,!(Yo&4194240)&&(Yo=64),e}function tc(e){for(var t=[],s=0;31>s;s++)t.push(e);return t}function ko(e,t,s){e.pendingLanes|=t,t!==536870912&&(e.suspendedLanes=0,e.pingedLanes=0),e=e.eventTimes,t=31-Kn(t),e[t]=s}function Ug(e,t){var s=e.pendingLanes&~t;e.pendingLanes=t,e.suspendedLanes=0,e.pingedLanes=0,e.expiredLanes&=t,e.mutableReadLanes&=t,e.entangledLanes&=t,t=e.entanglements;var r=e.eventTimes;for(e=e.expirationTimes;0<s;){var a=31-Kn(s),o=1<<a;t[a]=0,r[a]=-1,e[a]=-1,s&=~o}}function qd(e,t){var s=e.entangledLanes|=t;for(e=e.entanglements;s;){var r=31-Kn(s),a=1<<r;a&t|e[r]&t&&(e[r]|=t),s&=~a}}var dt=0;function Cf(e){return e&=-e,1<e?4<e?e&268435455?16:536870912:4:1}var Df,Xd,Lf,_f,Of,td=!1,qo=[],Ws=null,zs=null,Vs=null,eo=new Map,to=new Map,Ps=[],Wg="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function cm(e,t){switch(e){case"focusin":case"focusout":Ws=null;break;case"dragenter":case"dragleave":zs=null;break;case"mouseover":case"mouseout":Vs=null;break;case"pointerover":case"pointerout":eo.delete(t.pointerId);break;case"gotpointercapture":case"lostpointercapture":to.delete(t.pointerId)}}function Aa(e,t,s,r,a,o){return e===null||e.nativeEvent!==o?(e={blockedOn:t,domEventName:s,eventSystemFlags:r,nativeEvent:o,targetContainers:[a]},t!==null&&(t=Io(t),t!==null&&Xd(t)),e):(e.eventSystemFlags|=r,t=e.targetContainers,a!==null&&t.indexOf(a)===-1&&t.push(a),e)}function zg(e,t,s,r,a){switch(t){case"focusin":return Ws=Aa(Ws,e,t,s,r,a),!0;case"dragenter":return zs=Aa(zs,e,t,s,r,a),!0;case"mouseover":return Vs=Aa(Vs,e,t,s,r,a),!0;case"pointerover":var o=a.pointerId;return eo.set(o,Aa(eo.get(o)||null,e,t,s,r,a)),!0;case"gotpointercapture":return o=a.pointerId,to.set(o,Aa(to.get(o)||null,e,t,s,r,a)),!0}return!1}function Mf(e){var t=cr(e.target);if(t!==null){var s=Sr(t);if(s!==null){if(t=s.tag,t===13){if(t=jf(s),t!==null){e.blockedOn=t,Of(e.priority,function(){Lf(s)});return}}else if(t===3&&s.stateNode.current.memoizedState.isDehydrated){e.blockedOn=s.tag===3?s.stateNode.containerInfo:null;return}}}e.blockedOn=null}function xl(e){if(e.blockedOn!==null)return!1;for(var t=e.targetContainers;0<t.length;){var s=nd(e.domEventName,e.eventSystemFlags,t[0],e.nativeEvent);if(s===null){s=e.nativeEvent;var r=new s.constructor(s.type,s);Xc=r,s.target.dispatchEvent(r),Xc=null}else return t=Io(s),t!==null&&Xd(t),e.blockedOn=s,!1;t.shift()}return!0}function dm(e,t,s){xl(e)&&s.delete(t)}function Vg(){td=!1,Ws!==null&&xl(Ws)&&(Ws=null),zs!==null&&xl(zs)&&(zs=null),Vs!==null&&xl(Vs)&&(Vs=null),eo.forEach(dm),to.forEach(dm)}function Ia(e,t){e.blockedOn===t&&(e.blockedOn=null,td||(td=!0,jn.unstable_scheduleCallback(jn.unstable_NormalPriority,Vg)))}function no(e){function t(a){return Ia(a,e)}if(0<qo.length){Ia(qo[0],e);for(var s=1;s<qo.length;s++){var r=qo[s];r.blockedOn===e&&(r.blockedOn=null)}}for(Ws!==null&&Ia(Ws,e),zs!==null&&Ia(zs,e),Vs!==null&&Ia(Vs,e),eo.forEach(t),to.forEach(t),s=0;s<Ps.length;s++)r=Ps[s],r.blockedOn===e&&(r.blockedOn=null);for(;0<Ps.length&&(s=Ps[0],s.blockedOn===null);)Mf(s),s.blockedOn===null&&Ps.shift()}var qr=Is.ReactCurrentBatchConfig,Cl=!0;function Kg(e,t,s,r){var a=dt,o=qr.transition;qr.transition=null;try{dt=1,Jd(e,t,s,r)}finally{dt=a,qr.transition=o}}function Yg(e,t,s,r){var a=dt,o=qr.transition;qr.transition=null;try{dt=4,Jd(e,t,s,r)}finally{dt=a,qr.transition=o}}function Jd(e,t,s,r){if(Cl){var a=nd(e,t,s,r);if(a===null)uc(e,t,r,Dl,s),cm(e,r);else if(zg(a,e,t,s,r))r.stopPropagation();else if(cm(e,r),t&4&&-1<Wg.indexOf(e)){for(;a!==null;){var o=Io(a);if(o!==null&&Df(o),o=nd(e,t,s,r),o===null&&uc(e,t,r,Dl,s),o===a)break;a=o}a!==null&&r.stopPropagation()}else uc(e,t,r,null,s)}}var Dl=null;function nd(e,t,s,r){if(Dl=null,e=Yd(r),e=cr(e),e!==null)if(t=Sr(e),t===null)e=null;else if(s=t.tag,s===13){if(e=jf(t),e!==null)return e;e=null}else if(s===3){if(t.stateNode.current.memoizedState.isDehydrated)return t.tag===3?t.stateNode.containerInfo:null;e=null}else t!==e&&(e=null);return Dl=e,null}function Pf(e){switch(e){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(_g()){case Gd:return 1;case If:return 4;case Tl:case Og:return 16;case Tf:return 536870912;default:return 16}default:return 16}}var $s=null,Qd=null,hl=null;function Ff(){if(hl)return hl;var e,t=Qd,s=t.length,r,a="value"in $s?$s.value:$s.textContent,o=a.length;for(e=0;e<s&&t[e]===a[e];e++);var l=s-e;for(r=1;r<=l&&t[s-r]===a[o-r];r++);return hl=a.slice(e,1<r?1-r:void 0)}function gl(e){var t=e.keyCode;return"charCode"in e?(e=e.charCode,e===0&&t===13&&(e=13)):e=t,e===10&&(e=13),32<=e||e===13?e:0}function Xo(){return!0}function um(){return!1}function kn(e){function t(s,r,a,o,l){this._reactName=s,this._targetInst=a,this.type=r,this.nativeEvent=o,this.target=l,this.currentTarget=null;for(var c in e)e.hasOwnProperty(c)&&(s=e[c],this[c]=s?s(o):o[c]);return this.isDefaultPrevented=(o.defaultPrevented!=null?o.defaultPrevented:o.returnValue===!1)?Xo:um,this.isPropagationStopped=um,this}return kt(t.prototype,{preventDefault:function(){this.defaultPrevented=!0;var s=this.nativeEvent;s&&(s.preventDefault?s.preventDefault():typeof s.returnValue!="unknown"&&(s.returnValue=!1),this.isDefaultPrevented=Xo)},stopPropagation:function(){var s=this.nativeEvent;s&&(s.stopPropagation?s.stopPropagation():typeof s.cancelBubble!="unknown"&&(s.cancelBubble=!0),this.isPropagationStopped=Xo)},persist:function(){},isPersistent:Xo}),t}var da={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(e){return e.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},Zd=kn(da),Ao=kt({},da,{view:0,detail:0}),Gg=kn(Ao),nc,sc,Ta,di=kt({},Ao,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:eu,button:0,buttons:0,relatedTarget:function(e){return e.relatedTarget===void 0?e.fromElement===e.srcElement?e.toElement:e.fromElement:e.relatedTarget},movementX:function(e){return"movementX"in e?e.movementX:(e!==Ta&&(Ta&&e.type==="mousemove"?(nc=e.screenX-Ta.screenX,sc=e.screenY-Ta.screenY):sc=nc=0,Ta=e),nc)},movementY:function(e){return"movementY"in e?e.movementY:sc}}),mm=kn(di),qg=kt({},di,{dataTransfer:0}),Xg=kn(qg),Jg=kt({},Ao,{relatedTarget:0}),rc=kn(Jg),Qg=kt({},da,{animationName:0,elapsedTime:0,pseudoElement:0}),Zg=kn(Qg),ey=kt({},da,{clipboardData:function(e){return"clipboardData"in e?e.clipboardData:window.clipboardData}}),ty=kn(ey),ny=kt({},da,{data:0}),pm=kn(ny),sy={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},ry={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},ay={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function oy(e){var t=this.nativeEvent;return t.getModifierState?t.getModifierState(e):(e=ay[e])?!!t[e]:!1}function eu(){return oy}var ly=kt({},Ao,{key:function(e){if(e.key){var t=sy[e.key]||e.key;if(t!=="Unidentified")return t}return e.type==="keypress"?(e=gl(e),e===13?"Enter":String.fromCharCode(e)):e.type==="keydown"||e.type==="keyup"?ry[e.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:eu,charCode:function(e){return e.type==="keypress"?gl(e):0},keyCode:function(e){return e.type==="keydown"||e.type==="keyup"?e.keyCode:0},which:function(e){return e.type==="keypress"?gl(e):e.type==="keydown"||e.type==="keyup"?e.keyCode:0}}),iy=kn(ly),cy=kt({},di,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),fm=kn(cy),dy=kt({},Ao,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:eu}),uy=kn(dy),my=kt({},da,{propertyName:0,elapsedTime:0,pseudoElement:0}),py=kn(my),fy=kt({},di,{deltaX:function(e){return"deltaX"in e?e.deltaX:"wheelDeltaX"in e?-e.wheelDeltaX:0},deltaY:function(e){return"deltaY"in e?e.deltaY:"wheelDeltaY"in e?-e.wheelDeltaY:"wheelDelta"in e?-e.wheelDelta:0},deltaZ:0,deltaMode:0}),xy=kn(fy),hy=[9,13,27,32],tu=js&&"CompositionEvent"in window,Ua=null;js&&"documentMode"in document&&(Ua=document.documentMode);var gy=js&&"TextEvent"in window&&!Ua,Bf=js&&(!tu||Ua&&8<Ua&&11>=Ua),xm=" ",hm=!1;function $f(e,t){switch(e){case"keyup":return hy.indexOf(t.keyCode)!==-1;case"keydown":return t.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function Hf(e){return e=e.detail,typeof e=="object"&&"data"in e?e.data:null}var Mr=!1;function yy(e,t){switch(e){case"compositionend":return Hf(t);case"keypress":return t.which!==32?null:(hm=!0,xm);case"textInput":return e=t.data,e===xm&&hm?null:e;default:return null}}function Ny(e,t){if(Mr)return e==="compositionend"||!tu&&$f(e,t)?(e=Ff(),hl=Qd=$s=null,Mr=!1,e):null;switch(e){case"paste":return null;case"keypress":if(!(t.ctrlKey||t.altKey||t.metaKey)||t.ctrlKey&&t.altKey){if(t.char&&1<t.char.length)return t.char;if(t.which)return String.fromCharCode(t.which)}return null;case"compositionend":return Bf&&t.locale!=="ko"?null:t.data;default:return null}}var by={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function gm(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t==="input"?!!by[e.type]:t==="textarea"}function Uf(e,t,s,r){Nf(r),t=Ll(t,"onChange"),0<t.length&&(s=new Zd("onChange","change",null,s,r),e.push({event:s,listeners:t}))}var Wa=null,so=null;function vy(e){Zf(e,0)}function ui(e){var t=Br(e);if(mf(t))return e}function Sy(e,t){if(e==="change")return t}var Wf=!1;if(js){var ac;if(js){var oc="oninput"in document;if(!oc){var ym=document.createElement("div");ym.setAttribute("oninput","return;"),oc=typeof ym.oninput=="function"}ac=oc}else ac=!1;Wf=ac&&(!document.documentMode||9<document.documentMode)}function Nm(){Wa&&(Wa.detachEvent("onpropertychange",zf),so=Wa=null)}function zf(e){if(e.propertyName==="value"&&ui(so)){var t=[];Uf(t,so,e,Yd(e)),wf(vy,t)}}function wy(e,t,s){e==="focusin"?(Nm(),Wa=t,so=s,Wa.attachEvent("onpropertychange",zf)):e==="focusout"&&Nm()}function jy(e){if(e==="selectionchange"||e==="keyup"||e==="keydown")return ui(so)}function Ey(e,t){if(e==="click")return ui(t)}function ky(e,t){if(e==="input"||e==="change")return ui(t)}function Ay(e,t){return e===t&&(e!==0||1/e===1/t)||e!==e&&t!==t}var qn=typeof Object.is=="function"?Object.is:Ay;function ro(e,t){if(qn(e,t))return!0;if(typeof e!="object"||e===null||typeof t!="object"||t===null)return!1;var s=Object.keys(e),r=Object.keys(t);if(s.length!==r.length)return!1;for(r=0;r<s.length;r++){var a=s[r];if(!Fc.call(t,a)||!qn(e[a],t[a]))return!1}return!0}function bm(e){for(;e&&e.firstChild;)e=e.firstChild;return e}function vm(e,t){var s=bm(e);e=0;for(var r;s;){if(s.nodeType===3){if(r=e+s.textContent.length,e<=t&&r>=t)return{node:s,offset:t-e};e=r}e:{for(;s;){if(s.nextSibling){s=s.nextSibling;break e}s=s.parentNode}s=void 0}s=bm(s)}}function Vf(e,t){return e&&t?e===t?!0:e&&e.nodeType===3?!1:t&&t.nodeType===3?Vf(e,t.parentNode):"contains"in e?e.contains(t):e.compareDocumentPosition?!!(e.compareDocumentPosition(t)&16):!1:!1}function Kf(){for(var e=window,t=kl();t instanceof e.HTMLIFrameElement;){try{var s=typeof t.contentWindow.location.href=="string"}catch{s=!1}if(s)e=t.contentWindow;else break;t=kl(e.document)}return t}function nu(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t&&(t==="input"&&(e.type==="text"||e.type==="search"||e.type==="tel"||e.type==="url"||e.type==="password")||t==="textarea"||e.contentEditable==="true")}function Iy(e){var t=Kf(),s=e.focusedElem,r=e.selectionRange;if(t!==s&&s&&s.ownerDocument&&Vf(s.ownerDocument.documentElement,s)){if(r!==null&&nu(s)){if(t=r.start,e=r.end,e===void 0&&(e=t),"selectionStart"in s)s.selectionStart=t,s.selectionEnd=Math.min(e,s.value.length);else if(e=(t=s.ownerDocument||document)&&t.defaultView||window,e.getSelection){e=e.getSelection();var a=s.textContent.length,o=Math.min(r.start,a);r=r.end===void 0?o:Math.min(r.end,a),!e.extend&&o>r&&(a=r,r=o,o=a),a=vm(s,o);var l=vm(s,r);a&&l&&(e.rangeCount!==1||e.anchorNode!==a.node||e.anchorOffset!==a.offset||e.focusNode!==l.node||e.focusOffset!==l.offset)&&(t=t.createRange(),t.setStart(a.node,a.offset),e.removeAllRanges(),o>r?(e.addRange(t),e.extend(l.node,l.offset)):(t.setEnd(l.node,l.offset),e.addRange(t)))}}for(t=[],e=s;e=e.parentNode;)e.nodeType===1&&t.push({element:e,left:e.scrollLeft,top:e.scrollTop});for(typeof s.focus=="function"&&s.focus(),s=0;s<t.length;s++)e=t[s],e.element.scrollLeft=e.left,e.element.scrollTop=e.top}}var Ty=js&&"documentMode"in document&&11>=document.documentMode,Pr=null,sd=null,za=null,rd=!1;function Sm(e,t,s){var r=s.window===s?s.document:s.nodeType===9?s:s.ownerDocument;rd||Pr==null||Pr!==kl(r)||(r=Pr,"selectionStart"in r&&nu(r)?r={start:r.selectionStart,end:r.selectionEnd}:(r=(r.ownerDocument&&r.ownerDocument.defaultView||window).getSelection(),r={anchorNode:r.anchorNode,anchorOffset:r.anchorOffset,focusNode:r.focusNode,focusOffset:r.focusOffset}),za&&ro(za,r)||(za=r,r=Ll(sd,"onSelect"),0<r.length&&(t=new Zd("onSelect","select",null,t,s),e.push({event:t,listeners:r}),t.target=Pr)))}function Jo(e,t){var s={};return s[e.toLowerCase()]=t.toLowerCase(),s["Webkit"+e]="webkit"+t,s["Moz"+e]="moz"+t,s}var Fr={animationend:Jo("Animation","AnimationEnd"),animationiteration:Jo("Animation","AnimationIteration"),animationstart:Jo("Animation","AnimationStart"),transitionend:Jo("Transition","TransitionEnd")},lc={},Yf={};js&&(Yf=document.createElement("div").style,"AnimationEvent"in window||(delete Fr.animationend.animation,delete Fr.animationiteration.animation,delete Fr.animationstart.animation),"TransitionEvent"in window||delete Fr.transitionend.transition);function mi(e){if(lc[e])return lc[e];if(!Fr[e])return e;var t=Fr[e],s;for(s in t)if(t.hasOwnProperty(s)&&s in Yf)return lc[e]=t[s];return e}var Gf=mi("animationend"),qf=mi("animationiteration"),Xf=mi("animationstart"),Jf=mi("transitionend"),Qf=new Map,wm="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function Zs(e,t){Qf.set(e,t),vr(t,[e])}for(var ic=0;ic<wm.length;ic++){var cc=wm[ic],Ry=cc.toLowerCase(),Cy=cc[0].toUpperCase()+cc.slice(1);Zs(Ry,"on"+Cy)}Zs(Gf,"onAnimationEnd");Zs(qf,"onAnimationIteration");Zs(Xf,"onAnimationStart");Zs("dblclick","onDoubleClick");Zs("focusin","onFocus");Zs("focusout","onBlur");Zs(Jf,"onTransitionEnd");Zr("onMouseEnter",["mouseout","mouseover"]);Zr("onMouseLeave",["mouseout","mouseover"]);Zr("onPointerEnter",["pointerout","pointerover"]);Zr("onPointerLeave",["pointerout","pointerover"]);vr("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));vr("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));vr("onBeforeInput",["compositionend","keypress","textInput","paste"]);vr("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));vr("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));vr("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Ba="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),Dy=new Set("cancel close invalid load scroll toggle".split(" ").concat(Ba));function jm(e,t,s){var r=e.type||"unknown-event";e.currentTarget=s,Rg(r,t,void 0,e),e.currentTarget=null}function Zf(e,t){t=(t&4)!==0;for(var s=0;s<e.length;s++){var r=e[s],a=r.event;r=r.listeners;e:{var o=void 0;if(t)for(var l=r.length-1;0<=l;l--){var c=r[l],i=c.instance,u=c.currentTarget;if(c=c.listener,i!==o&&a.isPropagationStopped())break e;jm(a,c,u),o=i}else for(l=0;l<r.length;l++){if(c=r[l],i=c.instance,u=c.currentTarget,c=c.listener,i!==o&&a.isPropagationStopped())break e;jm(a,c,u),o=i}}}if(Il)throw e=Zc,Il=!1,Zc=null,e}function yt(e,t){var s=t[cd];s===void 0&&(s=t[cd]=new Set);var r=e+"__bubble";s.has(r)||(ex(t,e,2,!1),s.add(r))}function dc(e,t,s){var r=0;t&&(r|=4),ex(s,e,r,t)}var Qo="_reactListening"+Math.random().toString(36).slice(2);function ao(e){if(!e[Qo]){e[Qo]=!0,of.forEach(function(s){s!=="selectionchange"&&(Dy.has(s)||dc(s,!1,e),dc(s,!0,e))});var t=e.nodeType===9?e:e.ownerDocument;t===null||t[Qo]||(t[Qo]=!0,dc("selectionchange",!1,t))}}function ex(e,t,s,r){switch(Pf(t)){case 1:var a=Kg;break;case 4:a=Yg;break;default:a=Jd}s=a.bind(null,t,s,e),a=void 0,!Qc||t!=="touchstart"&&t!=="touchmove"&&t!=="wheel"||(a=!0),r?a!==void 0?e.addEventListener(t,s,{capture:!0,passive:a}):e.addEventListener(t,s,!0):a!==void 0?e.addEventListener(t,s,{passive:a}):e.addEventListener(t,s,!1)}function uc(e,t,s,r,a){var o=r;if(!(t&1)&&!(t&2)&&r!==null)e:for(;;){if(r===null)return;var l=r.tag;if(l===3||l===4){var c=r.stateNode.containerInfo;if(c===a||c.nodeType===8&&c.parentNode===a)break;if(l===4)for(l=r.return;l!==null;){var i=l.tag;if((i===3||i===4)&&(i=l.stateNode.containerInfo,i===a||i.nodeType===8&&i.parentNode===a))return;l=l.return}for(;c!==null;){if(l=cr(c),l===null)return;if(i=l.tag,i===5||i===6){r=o=l;continue e}c=c.parentNode}}r=r.return}wf(function(){var u=o,p=Yd(s),y=[];e:{var b=Qf.get(e);if(b!==void 0){var w=Zd,R=e;switch(e){case"keypress":if(gl(s)===0)break e;case"keydown":case"keyup":w=iy;break;case"focusin":R="focus",w=rc;break;case"focusout":R="blur",w=rc;break;case"beforeblur":case"afterblur":w=rc;break;case"click":if(s.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":w=mm;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":w=Xg;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":w=uy;break;case Gf:case qf:case Xf:w=Zg;break;case Jf:w=py;break;case"scroll":w=Gg;break;case"wheel":w=xy;break;case"copy":case"cut":case"paste":w=ty;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":w=fm}var E=(t&4)!==0,W=!E&&e==="scroll",N=E?b!==null?b+"Capture":null:b;E=[];for(var h=u,S;h!==null;){S=h;var M=S.stateNode;if(S.tag===5&&M!==null&&(S=M,N!==null&&(M=Za(h,N),M!=null&&E.push(oo(h,M,S)))),W)break;h=h.return}0<E.length&&(b=new w(b,R,null,s,p),y.push({event:b,listeners:E}))}}if(!(t&7)){e:{if(b=e==="mouseover"||e==="pointerover",w=e==="mouseout"||e==="pointerout",b&&s!==Xc&&(R=s.relatedTarget||s.fromElement)&&(cr(R)||R[Es]))break e;if((w||b)&&(b=p.window===p?p:(b=p.ownerDocument)?b.defaultView||b.parentWindow:window,w?(R=s.relatedTarget||s.toElement,w=u,R=R?cr(R):null,R!==null&&(W=Sr(R),R!==W||R.tag!==5&&R.tag!==6)&&(R=null)):(w=null,R=u),w!==R)){if(E=mm,M="onMouseLeave",N="onMouseEnter",h="mouse",(e==="pointerout"||e==="pointerover")&&(E=fm,M="onPointerLeave",N="onPointerEnter",h="pointer"),W=w==null?b:Br(w),S=R==null?b:Br(R),b=new E(M,h+"leave",w,s,p),b.target=W,b.relatedTarget=S,M=null,cr(p)===u&&(E=new E(N,h+"enter",R,s,p),E.target=S,E.relatedTarget=W,M=E),W=M,w&&R)t:{for(E=w,N=R,h=0,S=E;S;S=Rr(S))h++;for(S=0,M=N;M;M=Rr(M))S++;for(;0<h-S;)E=Rr(E),h--;for(;0<S-h;)N=Rr(N),S--;for(;h--;){if(E===N||N!==null&&E===N.alternate)break t;E=Rr(E),N=Rr(N)}E=null}else E=null;w!==null&&Em(y,b,w,E,!1),R!==null&&W!==null&&Em(y,W,R,E,!0)}}e:{if(b=u?Br(u):window,w=b.nodeName&&b.nodeName.toLowerCase(),w==="select"||w==="input"&&b.type==="file")var H=Sy;else if(gm(b))if(Wf)H=ky;else{H=jy;var V=wy}else(w=b.nodeName)&&w.toLowerCase()==="input"&&(b.type==="checkbox"||b.type==="radio")&&(H=Ey);if(H&&(H=H(e,u))){Uf(y,H,s,p);break e}V&&V(e,b,u),e==="focusout"&&(V=b._wrapperState)&&V.controlled&&b.type==="number"&&Vc(b,"number",b.value)}switch(V=u?Br(u):window,e){case"focusin":(gm(V)||V.contentEditable==="true")&&(Pr=V,sd=u,za=null);break;case"focusout":za=sd=Pr=null;break;case"mousedown":rd=!0;break;case"contextmenu":case"mouseup":case"dragend":rd=!1,Sm(y,s,p);break;case"selectionchange":if(Ty)break;case"keydown":case"keyup":Sm(y,s,p)}var q;if(tu)e:{switch(e){case"compositionstart":var te="onCompositionStart";break e;case"compositionend":te="onCompositionEnd";break e;case"compositionupdate":te="onCompositionUpdate";break e}te=void 0}else Mr?$f(e,s)&&(te="onCompositionEnd"):e==="keydown"&&s.keyCode===229&&(te="onCompositionStart");te&&(Bf&&s.locale!=="ko"&&(Mr||te!=="onCompositionStart"?te==="onCompositionEnd"&&Mr&&(q=Ff()):($s=p,Qd="value"in $s?$s.value:$s.textContent,Mr=!0)),V=Ll(u,te),0<V.length&&(te=new pm(te,e,null,s,p),y.push({event:te,listeners:V}),q?te.data=q:(q=Hf(s),q!==null&&(te.data=q)))),(q=gy?yy(e,s):Ny(e,s))&&(u=Ll(u,"onBeforeInput"),0<u.length&&(p=new pm("onBeforeInput","beforeinput",null,s,p),y.push({event:p,listeners:u}),p.data=q))}Zf(y,t)})}function oo(e,t,s){return{instance:e,listener:t,currentTarget:s}}function Ll(e,t){for(var s=t+"Capture",r=[];e!==null;){var a=e,o=a.stateNode;a.tag===5&&o!==null&&(a=o,o=Za(e,s),o!=null&&r.unshift(oo(e,o,a)),o=Za(e,t),o!=null&&r.push(oo(e,o,a))),e=e.return}return r}function Rr(e){if(e===null)return null;do e=e.return;while(e&&e.tag!==5);return e||null}function Em(e,t,s,r,a){for(var o=t._reactName,l=[];s!==null&&s!==r;){var c=s,i=c.alternate,u=c.stateNode;if(i!==null&&i===r)break;c.tag===5&&u!==null&&(c=u,a?(i=Za(s,o),i!=null&&l.unshift(oo(s,i,c))):a||(i=Za(s,o),i!=null&&l.push(oo(s,i,c)))),s=s.return}l.length!==0&&e.push({event:t,listeners:l})}var Ly=/\r\n?/g,_y=/\u0000|\uFFFD/g;function km(e){return(typeof e=="string"?e:""+e).replace(Ly,`
`).replace(_y,"")}function Zo(e,t,s){if(t=km(t),km(e)!==t&&s)throw Error(pe(425))}function _l(){}var ad=null,od=null;function ld(e,t){return e==="textarea"||e==="noscript"||typeof t.children=="string"||typeof t.children=="number"||typeof t.dangerouslySetInnerHTML=="object"&&t.dangerouslySetInnerHTML!==null&&t.dangerouslySetInnerHTML.__html!=null}var id=typeof setTimeout=="function"?setTimeout:void 0,Oy=typeof clearTimeout=="function"?clearTimeout:void 0,Am=typeof Promise=="function"?Promise:void 0,My=typeof queueMicrotask=="function"?queueMicrotask:typeof Am<"u"?function(e){return Am.resolve(null).then(e).catch(Py)}:id;function Py(e){setTimeout(function(){throw e})}function mc(e,t){var s=t,r=0;do{var a=s.nextSibling;if(e.removeChild(s),a&&a.nodeType===8)if(s=a.data,s==="/$"){if(r===0){e.removeChild(a),no(t);return}r--}else s!=="$"&&s!=="$?"&&s!=="$!"||r++;s=a}while(s);no(t)}function Ks(e){for(;e!=null;e=e.nextSibling){var t=e.nodeType;if(t===1||t===3)break;if(t===8){if(t=e.data,t==="$"||t==="$!"||t==="$?")break;if(t==="/$")return null}}return e}function Im(e){e=e.previousSibling;for(var t=0;e;){if(e.nodeType===8){var s=e.data;if(s==="$"||s==="$!"||s==="$?"){if(t===0)return e;t--}else s==="/$"&&t++}e=e.previousSibling}return null}var ua=Math.random().toString(36).slice(2),as="__reactFiber$"+ua,lo="__reactProps$"+ua,Es="__reactContainer$"+ua,cd="__reactEvents$"+ua,Fy="__reactListeners$"+ua,By="__reactHandles$"+ua;function cr(e){var t=e[as];if(t)return t;for(var s=e.parentNode;s;){if(t=s[Es]||s[as]){if(s=t.alternate,t.child!==null||s!==null&&s.child!==null)for(e=Im(e);e!==null;){if(s=e[as])return s;e=Im(e)}return t}e=s,s=e.parentNode}return null}function Io(e){return e=e[as]||e[Es],!e||e.tag!==5&&e.tag!==6&&e.tag!==13&&e.tag!==3?null:e}function Br(e){if(e.tag===5||e.tag===6)return e.stateNode;throw Error(pe(33))}function pi(e){return e[lo]||null}var dd=[],$r=-1;function er(e){return{current:e}}function bt(e){0>$r||(e.current=dd[$r],dd[$r]=null,$r--)}function xt(e,t){$r++,dd[$r]=e.current,e.current=t}var Qs={},rn=er(Qs),hn=er(!1),xr=Qs;function ea(e,t){var s=e.type.contextTypes;if(!s)return Qs;var r=e.stateNode;if(r&&r.__reactInternalMemoizedUnmaskedChildContext===t)return r.__reactInternalMemoizedMaskedChildContext;var a={},o;for(o in s)a[o]=t[o];return r&&(e=e.stateNode,e.__reactInternalMemoizedUnmaskedChildContext=t,e.__reactInternalMemoizedMaskedChildContext=a),a}function gn(e){return e=e.childContextTypes,e!=null}function Ol(){bt(hn),bt(rn)}function Tm(e,t,s){if(rn.current!==Qs)throw Error(pe(168));xt(rn,t),xt(hn,s)}function tx(e,t,s){var r=e.stateNode;if(t=t.childContextTypes,typeof r.getChildContext!="function")return s;r=r.getChildContext();for(var a in r)if(!(a in t))throw Error(pe(108,wg(e)||"Unknown",a));return kt({},s,r)}function Ml(e){return e=(e=e.stateNode)&&e.__reactInternalMemoizedMergedChildContext||Qs,xr=rn.current,xt(rn,e),xt(hn,hn.current),!0}function Rm(e,t,s){var r=e.stateNode;if(!r)throw Error(pe(169));s?(e=tx(e,t,xr),r.__reactInternalMemoizedMergedChildContext=e,bt(hn),bt(rn),xt(rn,e)):bt(hn),xt(hn,s)}var hs=null,fi=!1,pc=!1;function nx(e){hs===null?hs=[e]:hs.push(e)}function $y(e){fi=!0,nx(e)}function tr(){if(!pc&&hs!==null){pc=!0;var e=0,t=dt;try{var s=hs;for(dt=1;e<s.length;e++){var r=s[e];do r=r(!0);while(r!==null)}hs=null,fi=!1}catch(a){throw hs!==null&&(hs=hs.slice(e+1)),Af(Gd,tr),a}finally{dt=t,pc=!1}}return null}var Hr=[],Ur=0,Pl=null,Fl=0,Cn=[],Dn=0,hr=null,Ns=1,bs="";function ar(e,t){Hr[Ur++]=Fl,Hr[Ur++]=Pl,Pl=e,Fl=t}function sx(e,t,s){Cn[Dn++]=Ns,Cn[Dn++]=bs,Cn[Dn++]=hr,hr=e;var r=Ns;e=bs;var a=32-Kn(r)-1;r&=~(1<<a),s+=1;var o=32-Kn(t)+a;if(30<o){var l=a-a%5;o=(r&(1<<l)-1).toString(32),r>>=l,a-=l,Ns=1<<32-Kn(t)+a|s<<a|r,bs=o+e}else Ns=1<<o|s<<a|r,bs=e}function su(e){e.return!==null&&(ar(e,1),sx(e,1,0))}function ru(e){for(;e===Pl;)Pl=Hr[--Ur],Hr[Ur]=null,Fl=Hr[--Ur],Hr[Ur]=null;for(;e===hr;)hr=Cn[--Dn],Cn[Dn]=null,bs=Cn[--Dn],Cn[Dn]=null,Ns=Cn[--Dn],Cn[Dn]=null}var wn=null,Sn=null,vt=!1,Vn=null;function rx(e,t){var s=Ln(5,null,null,0);s.elementType="DELETED",s.stateNode=t,s.return=e,t=e.deletions,t===null?(e.deletions=[s],e.flags|=16):t.push(s)}function Cm(e,t){switch(e.tag){case 5:var s=e.type;return t=t.nodeType!==1||s.toLowerCase()!==t.nodeName.toLowerCase()?null:t,t!==null?(e.stateNode=t,wn=e,Sn=Ks(t.firstChild),!0):!1;case 6:return t=e.pendingProps===""||t.nodeType!==3?null:t,t!==null?(e.stateNode=t,wn=e,Sn=null,!0):!1;case 13:return t=t.nodeType!==8?null:t,t!==null?(s=hr!==null?{id:Ns,overflow:bs}:null,e.memoizedState={dehydrated:t,treeContext:s,retryLane:1073741824},s=Ln(18,null,null,0),s.stateNode=t,s.return=e,e.child=s,wn=e,Sn=null,!0):!1;default:return!1}}function ud(e){return(e.mode&1)!==0&&(e.flags&128)===0}function md(e){if(vt){var t=Sn;if(t){var s=t;if(!Cm(e,t)){if(ud(e))throw Error(pe(418));t=Ks(s.nextSibling);var r=wn;t&&Cm(e,t)?rx(r,s):(e.flags=e.flags&-4097|2,vt=!1,wn=e)}}else{if(ud(e))throw Error(pe(418));e.flags=e.flags&-4097|2,vt=!1,wn=e}}}function Dm(e){for(e=e.return;e!==null&&e.tag!==5&&e.tag!==3&&e.tag!==13;)e=e.return;wn=e}function el(e){if(e!==wn)return!1;if(!vt)return Dm(e),vt=!0,!1;var t;if((t=e.tag!==3)&&!(t=e.tag!==5)&&(t=e.type,t=t!=="head"&&t!=="body"&&!ld(e.type,e.memoizedProps)),t&&(t=Sn)){if(ud(e))throw ax(),Error(pe(418));for(;t;)rx(e,t),t=Ks(t.nextSibling)}if(Dm(e),e.tag===13){if(e=e.memoizedState,e=e!==null?e.dehydrated:null,!e)throw Error(pe(317));e:{for(e=e.nextSibling,t=0;e;){if(e.nodeType===8){var s=e.data;if(s==="/$"){if(t===0){Sn=Ks(e.nextSibling);break e}t--}else s!=="$"&&s!=="$!"&&s!=="$?"||t++}e=e.nextSibling}Sn=null}}else Sn=wn?Ks(e.stateNode.nextSibling):null;return!0}function ax(){for(var e=Sn;e;)e=Ks(e.nextSibling)}function ta(){Sn=wn=null,vt=!1}function au(e){Vn===null?Vn=[e]:Vn.push(e)}var Hy=Is.ReactCurrentBatchConfig;function Ra(e,t,s){if(e=s.ref,e!==null&&typeof e!="function"&&typeof e!="object"){if(s._owner){if(s=s._owner,s){if(s.tag!==1)throw Error(pe(309));var r=s.stateNode}if(!r)throw Error(pe(147,e));var a=r,o=""+e;return t!==null&&t.ref!==null&&typeof t.ref=="function"&&t.ref._stringRef===o?t.ref:(t=function(l){var c=a.refs;l===null?delete c[o]:c[o]=l},t._stringRef=o,t)}if(typeof e!="string")throw Error(pe(284));if(!s._owner)throw Error(pe(290,e))}return e}function tl(e,t){throw e=Object.prototype.toString.call(t),Error(pe(31,e==="[object Object]"?"object with keys {"+Object.keys(t).join(", ")+"}":e))}function Lm(e){var t=e._init;return t(e._payload)}function ox(e){function t(N,h){if(e){var S=N.deletions;S===null?(N.deletions=[h],N.flags|=16):S.push(h)}}function s(N,h){if(!e)return null;for(;h!==null;)t(N,h),h=h.sibling;return null}function r(N,h){for(N=new Map;h!==null;)h.key!==null?N.set(h.key,h):N.set(h.index,h),h=h.sibling;return N}function a(N,h){return N=Xs(N,h),N.index=0,N.sibling=null,N}function o(N,h,S){return N.index=S,e?(S=N.alternate,S!==null?(S=S.index,S<h?(N.flags|=2,h):S):(N.flags|=2,h)):(N.flags|=1048576,h)}function l(N){return e&&N.alternate===null&&(N.flags|=2),N}function c(N,h,S,M){return h===null||h.tag!==6?(h=bc(S,N.mode,M),h.return=N,h):(h=a(h,S),h.return=N,h)}function i(N,h,S,M){var H=S.type;return H===Or?p(N,h,S.props.children,M,S.key):h!==null&&(h.elementType===H||typeof H=="object"&&H!==null&&H.$$typeof===Ls&&Lm(H)===h.type)?(M=a(h,S.props),M.ref=Ra(N,h,S),M.return=N,M):(M=jl(S.type,S.key,S.props,null,N.mode,M),M.ref=Ra(N,h,S),M.return=N,M)}function u(N,h,S,M){return h===null||h.tag!==4||h.stateNode.containerInfo!==S.containerInfo||h.stateNode.implementation!==S.implementation?(h=vc(S,N.mode,M),h.return=N,h):(h=a(h,S.children||[]),h.return=N,h)}function p(N,h,S,M,H){return h===null||h.tag!==7?(h=pr(S,N.mode,M,H),h.return=N,h):(h=a(h,S),h.return=N,h)}function y(N,h,S){if(typeof h=="string"&&h!==""||typeof h=="number")return h=bc(""+h,N.mode,S),h.return=N,h;if(typeof h=="object"&&h!==null){switch(h.$$typeof){case zo:return S=jl(h.type,h.key,h.props,null,N.mode,S),S.ref=Ra(N,null,h),S.return=N,S;case _r:return h=vc(h,N.mode,S),h.return=N,h;case Ls:var M=h._init;return y(N,M(h._payload),S)}if(Pa(h)||Ea(h))return h=pr(h,N.mode,S,null),h.return=N,h;tl(N,h)}return null}function b(N,h,S,M){var H=h!==null?h.key:null;if(typeof S=="string"&&S!==""||typeof S=="number")return H!==null?null:c(N,h,""+S,M);if(typeof S=="object"&&S!==null){switch(S.$$typeof){case zo:return S.key===H?i(N,h,S,M):null;case _r:return S.key===H?u(N,h,S,M):null;case Ls:return H=S._init,b(N,h,H(S._payload),M)}if(Pa(S)||Ea(S))return H!==null?null:p(N,h,S,M,null);tl(N,S)}return null}function w(N,h,S,M,H){if(typeof M=="string"&&M!==""||typeof M=="number")return N=N.get(S)||null,c(h,N,""+M,H);if(typeof M=="object"&&M!==null){switch(M.$$typeof){case zo:return N=N.get(M.key===null?S:M.key)||null,i(h,N,M,H);case _r:return N=N.get(M.key===null?S:M.key)||null,u(h,N,M,H);case Ls:var V=M._init;return w(N,h,S,V(M._payload),H)}if(Pa(M)||Ea(M))return N=N.get(S)||null,p(h,N,M,H,null);tl(h,M)}return null}function R(N,h,S,M){for(var H=null,V=null,q=h,te=h=0,G=null;q!==null&&te<S.length;te++){q.index>te?(G=q,q=null):G=q.sibling;var re=b(N,q,S[te],M);if(re===null){q===null&&(q=G);break}e&&q&&re.alternate===null&&t(N,q),h=o(re,h,te),V===null?H=re:V.sibling=re,V=re,q=G}if(te===S.length)return s(N,q),vt&&ar(N,te),H;if(q===null){for(;te<S.length;te++)q=y(N,S[te],M),q!==null&&(h=o(q,h,te),V===null?H=q:V.sibling=q,V=q);return vt&&ar(N,te),H}for(q=r(N,q);te<S.length;te++)G=w(q,N,te,S[te],M),G!==null&&(e&&G.alternate!==null&&q.delete(G.key===null?te:G.key),h=o(G,h,te),V===null?H=G:V.sibling=G,V=G);return e&&q.forEach(function(j){return t(N,j)}),vt&&ar(N,te),H}function E(N,h,S,M){var H=Ea(S);if(typeof H!="function")throw Error(pe(150));if(S=H.call(S),S==null)throw Error(pe(151));for(var V=H=null,q=h,te=h=0,G=null,re=S.next();q!==null&&!re.done;te++,re=S.next()){q.index>te?(G=q,q=null):G=q.sibling;var j=b(N,q,re.value,M);if(j===null){q===null&&(q=G);break}e&&q&&j.alternate===null&&t(N,q),h=o(j,h,te),V===null?H=j:V.sibling=j,V=j,q=G}if(re.done)return s(N,q),vt&&ar(N,te),H;if(q===null){for(;!re.done;te++,re=S.next())re=y(N,re.value,M),re!==null&&(h=o(re,h,te),V===null?H=re:V.sibling=re,V=re);return vt&&ar(N,te),H}for(q=r(N,q);!re.done;te++,re=S.next())re=w(q,N,te,re.value,M),re!==null&&(e&&re.alternate!==null&&q.delete(re.key===null?te:re.key),h=o(re,h,te),V===null?H=re:V.sibling=re,V=re);return e&&q.forEach(function(P){return t(N,P)}),vt&&ar(N,te),H}function W(N,h,S,M){if(typeof S=="object"&&S!==null&&S.type===Or&&S.key===null&&(S=S.props.children),typeof S=="object"&&S!==null){switch(S.$$typeof){case zo:e:{for(var H=S.key,V=h;V!==null;){if(V.key===H){if(H=S.type,H===Or){if(V.tag===7){s(N,V.sibling),h=a(V,S.props.children),h.return=N,N=h;break e}}else if(V.elementType===H||typeof H=="object"&&H!==null&&H.$$typeof===Ls&&Lm(H)===V.type){s(N,V.sibling),h=a(V,S.props),h.ref=Ra(N,V,S),h.return=N,N=h;break e}s(N,V);break}else t(N,V);V=V.sibling}S.type===Or?(h=pr(S.props.children,N.mode,M,S.key),h.return=N,N=h):(M=jl(S.type,S.key,S.props,null,N.mode,M),M.ref=Ra(N,h,S),M.return=N,N=M)}return l(N);case _r:e:{for(V=S.key;h!==null;){if(h.key===V)if(h.tag===4&&h.stateNode.containerInfo===S.containerInfo&&h.stateNode.implementation===S.implementation){s(N,h.sibling),h=a(h,S.children||[]),h.return=N,N=h;break e}else{s(N,h);break}else t(N,h);h=h.sibling}h=vc(S,N.mode,M),h.return=N,N=h}return l(N);case Ls:return V=S._init,W(N,h,V(S._payload),M)}if(Pa(S))return R(N,h,S,M);if(Ea(S))return E(N,h,S,M);tl(N,S)}return typeof S=="string"&&S!==""||typeof S=="number"?(S=""+S,h!==null&&h.tag===6?(s(N,h.sibling),h=a(h,S),h.return=N,N=h):(s(N,h),h=bc(S,N.mode,M),h.return=N,N=h),l(N)):s(N,h)}return W}var na=ox(!0),lx=ox(!1),Bl=er(null),$l=null,Wr=null,ou=null;function lu(){ou=Wr=$l=null}function iu(e){var t=Bl.current;bt(Bl),e._currentValue=t}function pd(e,t,s){for(;e!==null;){var r=e.alternate;if((e.childLanes&t)!==t?(e.childLanes|=t,r!==null&&(r.childLanes|=t)):r!==null&&(r.childLanes&t)!==t&&(r.childLanes|=t),e===s)break;e=e.return}}function Xr(e,t){$l=e,ou=Wr=null,e=e.dependencies,e!==null&&e.firstContext!==null&&(e.lanes&t&&(xn=!0),e.firstContext=null)}function Mn(e){var t=e._currentValue;if(ou!==e)if(e={context:e,memoizedValue:t,next:null},Wr===null){if($l===null)throw Error(pe(308));Wr=e,$l.dependencies={lanes:0,firstContext:e}}else Wr=Wr.next=e;return t}var dr=null;function cu(e){dr===null?dr=[e]:dr.push(e)}function ix(e,t,s,r){var a=t.interleaved;return a===null?(s.next=s,cu(t)):(s.next=a.next,a.next=s),t.interleaved=s,ks(e,r)}function ks(e,t){e.lanes|=t;var s=e.alternate;for(s!==null&&(s.lanes|=t),s=e,e=e.return;e!==null;)e.childLanes|=t,s=e.alternate,s!==null&&(s.childLanes|=t),s=e,e=e.return;return s.tag===3?s.stateNode:null}var _s=!1;function du(e){e.updateQueue={baseState:e.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function cx(e,t){e=e.updateQueue,t.updateQueue===e&&(t.updateQueue={baseState:e.baseState,firstBaseUpdate:e.firstBaseUpdate,lastBaseUpdate:e.lastBaseUpdate,shared:e.shared,effects:e.effects})}function vs(e,t){return{eventTime:e,lane:t,tag:0,payload:null,callback:null,next:null}}function Ys(e,t,s){var r=e.updateQueue;if(r===null)return null;if(r=r.shared,at&2){var a=r.pending;return a===null?t.next=t:(t.next=a.next,a.next=t),r.pending=t,ks(e,s)}return a=r.interleaved,a===null?(t.next=t,cu(r)):(t.next=a.next,a.next=t),r.interleaved=t,ks(e,s)}function yl(e,t,s){if(t=t.updateQueue,t!==null&&(t=t.shared,(s&4194240)!==0)){var r=t.lanes;r&=e.pendingLanes,s|=r,t.lanes=s,qd(e,s)}}function _m(e,t){var s=e.updateQueue,r=e.alternate;if(r!==null&&(r=r.updateQueue,s===r)){var a=null,o=null;if(s=s.firstBaseUpdate,s!==null){do{var l={eventTime:s.eventTime,lane:s.lane,tag:s.tag,payload:s.payload,callback:s.callback,next:null};o===null?a=o=l:o=o.next=l,s=s.next}while(s!==null);o===null?a=o=t:o=o.next=t}else a=o=t;s={baseState:r.baseState,firstBaseUpdate:a,lastBaseUpdate:o,shared:r.shared,effects:r.effects},e.updateQueue=s;return}e=s.lastBaseUpdate,e===null?s.firstBaseUpdate=t:e.next=t,s.lastBaseUpdate=t}function Hl(e,t,s,r){var a=e.updateQueue;_s=!1;var o=a.firstBaseUpdate,l=a.lastBaseUpdate,c=a.shared.pending;if(c!==null){a.shared.pending=null;var i=c,u=i.next;i.next=null,l===null?o=u:l.next=u,l=i;var p=e.alternate;p!==null&&(p=p.updateQueue,c=p.lastBaseUpdate,c!==l&&(c===null?p.firstBaseUpdate=u:c.next=u,p.lastBaseUpdate=i))}if(o!==null){var y=a.baseState;l=0,p=u=i=null,c=o;do{var b=c.lane,w=c.eventTime;if((r&b)===b){p!==null&&(p=p.next={eventTime:w,lane:0,tag:c.tag,payload:c.payload,callback:c.callback,next:null});e:{var R=e,E=c;switch(b=t,w=s,E.tag){case 1:if(R=E.payload,typeof R=="function"){y=R.call(w,y,b);break e}y=R;break e;case 3:R.flags=R.flags&-65537|128;case 0:if(R=E.payload,b=typeof R=="function"?R.call(w,y,b):R,b==null)break e;y=kt({},y,b);break e;case 2:_s=!0}}c.callback!==null&&c.lane!==0&&(e.flags|=64,b=a.effects,b===null?a.effects=[c]:b.push(c))}else w={eventTime:w,lane:b,tag:c.tag,payload:c.payload,callback:c.callback,next:null},p===null?(u=p=w,i=y):p=p.next=w,l|=b;if(c=c.next,c===null){if(c=a.shared.pending,c===null)break;b=c,c=b.next,b.next=null,a.lastBaseUpdate=b,a.shared.pending=null}}while(!0);if(p===null&&(i=y),a.baseState=i,a.firstBaseUpdate=u,a.lastBaseUpdate=p,t=a.shared.interleaved,t!==null){a=t;do l|=a.lane,a=a.next;while(a!==t)}else o===null&&(a.shared.lanes=0);yr|=l,e.lanes=l,e.memoizedState=y}}function Om(e,t,s){if(e=t.effects,t.effects=null,e!==null)for(t=0;t<e.length;t++){var r=e[t],a=r.callback;if(a!==null){if(r.callback=null,r=s,typeof a!="function")throw Error(pe(191,a));a.call(r)}}}var To={},ds=er(To),io=er(To),co=er(To);function ur(e){if(e===To)throw Error(pe(174));return e}function uu(e,t){switch(xt(co,t),xt(io,e),xt(ds,To),e=t.nodeType,e){case 9:case 11:t=(t=t.documentElement)?t.namespaceURI:Yc(null,"");break;default:e=e===8?t.parentNode:t,t=e.namespaceURI||null,e=e.tagName,t=Yc(t,e)}bt(ds),xt(ds,t)}function sa(){bt(ds),bt(io),bt(co)}function dx(e){ur(co.current);var t=ur(ds.current),s=Yc(t,e.type);t!==s&&(xt(io,e),xt(ds,s))}function mu(e){io.current===e&&(bt(ds),bt(io))}var jt=er(0);function Ul(e){for(var t=e;t!==null;){if(t.tag===13){var s=t.memoizedState;if(s!==null&&(s=s.dehydrated,s===null||s.data==="$?"||s.data==="$!"))return t}else if(t.tag===19&&t.memoizedProps.revealOrder!==void 0){if(t.flags&128)return t}else if(t.child!==null){t.child.return=t,t=t.child;continue}if(t===e)break;for(;t.sibling===null;){if(t.return===null||t.return===e)return null;t=t.return}t.sibling.return=t.return,t=t.sibling}return null}var fc=[];function pu(){for(var e=0;e<fc.length;e++)fc[e]._workInProgressVersionPrimary=null;fc.length=0}var Nl=Is.ReactCurrentDispatcher,xc=Is.ReactCurrentBatchConfig,gr=0,Et=null,Pt=null,Ut=null,Wl=!1,Va=!1,uo=0,Uy=0;function en(){throw Error(pe(321))}function fu(e,t){if(t===null)return!1;for(var s=0;s<t.length&&s<e.length;s++)if(!qn(e[s],t[s]))return!1;return!0}function xu(e,t,s,r,a,o){if(gr=o,Et=t,t.memoizedState=null,t.updateQueue=null,t.lanes=0,Nl.current=e===null||e.memoizedState===null?Ky:Yy,e=s(r,a),Va){o=0;do{if(Va=!1,uo=0,25<=o)throw Error(pe(301));o+=1,Ut=Pt=null,t.updateQueue=null,Nl.current=Gy,e=s(r,a)}while(Va)}if(Nl.current=zl,t=Pt!==null&&Pt.next!==null,gr=0,Ut=Pt=Et=null,Wl=!1,t)throw Error(pe(300));return e}function hu(){var e=uo!==0;return uo=0,e}function ns(){var e={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Ut===null?Et.memoizedState=Ut=e:Ut=Ut.next=e,Ut}function Pn(){if(Pt===null){var e=Et.alternate;e=e!==null?e.memoizedState:null}else e=Pt.next;var t=Ut===null?Et.memoizedState:Ut.next;if(t!==null)Ut=t,Pt=e;else{if(e===null)throw Error(pe(310));Pt=e,e={memoizedState:Pt.memoizedState,baseState:Pt.baseState,baseQueue:Pt.baseQueue,queue:Pt.queue,next:null},Ut===null?Et.memoizedState=Ut=e:Ut=Ut.next=e}return Ut}function mo(e,t){return typeof t=="function"?t(e):t}function hc(e){var t=Pn(),s=t.queue;if(s===null)throw Error(pe(311));s.lastRenderedReducer=e;var r=Pt,a=r.baseQueue,o=s.pending;if(o!==null){if(a!==null){var l=a.next;a.next=o.next,o.next=l}r.baseQueue=a=o,s.pending=null}if(a!==null){o=a.next,r=r.baseState;var c=l=null,i=null,u=o;do{var p=u.lane;if((gr&p)===p)i!==null&&(i=i.next={lane:0,action:u.action,hasEagerState:u.hasEagerState,eagerState:u.eagerState,next:null}),r=u.hasEagerState?u.eagerState:e(r,u.action);else{var y={lane:p,action:u.action,hasEagerState:u.hasEagerState,eagerState:u.eagerState,next:null};i===null?(c=i=y,l=r):i=i.next=y,Et.lanes|=p,yr|=p}u=u.next}while(u!==null&&u!==o);i===null?l=r:i.next=c,qn(r,t.memoizedState)||(xn=!0),t.memoizedState=r,t.baseState=l,t.baseQueue=i,s.lastRenderedState=r}if(e=s.interleaved,e!==null){a=e;do o=a.lane,Et.lanes|=o,yr|=o,a=a.next;while(a!==e)}else a===null&&(s.lanes=0);return[t.memoizedState,s.dispatch]}function gc(e){var t=Pn(),s=t.queue;if(s===null)throw Error(pe(311));s.lastRenderedReducer=e;var r=s.dispatch,a=s.pending,o=t.memoizedState;if(a!==null){s.pending=null;var l=a=a.next;do o=e(o,l.action),l=l.next;while(l!==a);qn(o,t.memoizedState)||(xn=!0),t.memoizedState=o,t.baseQueue===null&&(t.baseState=o),s.lastRenderedState=o}return[o,r]}function ux(){}function mx(e,t){var s=Et,r=Pn(),a=t(),o=!qn(r.memoizedState,a);if(o&&(r.memoizedState=a,xn=!0),r=r.queue,gu(xx.bind(null,s,r,e),[e]),r.getSnapshot!==t||o||Ut!==null&&Ut.memoizedState.tag&1){if(s.flags|=2048,po(9,fx.bind(null,s,r,a,t),void 0,null),Wt===null)throw Error(pe(349));gr&30||px(s,t,a)}return a}function px(e,t,s){e.flags|=16384,e={getSnapshot:t,value:s},t=Et.updateQueue,t===null?(t={lastEffect:null,stores:null},Et.updateQueue=t,t.stores=[e]):(s=t.stores,s===null?t.stores=[e]:s.push(e))}function fx(e,t,s,r){t.value=s,t.getSnapshot=r,hx(t)&&gx(e)}function xx(e,t,s){return s(function(){hx(t)&&gx(e)})}function hx(e){var t=e.getSnapshot;e=e.value;try{var s=t();return!qn(e,s)}catch{return!0}}function gx(e){var t=ks(e,1);t!==null&&Yn(t,e,1,-1)}function Mm(e){var t=ns();return typeof e=="function"&&(e=e()),t.memoizedState=t.baseState=e,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:mo,lastRenderedState:e},t.queue=e,e=e.dispatch=Vy.bind(null,Et,e),[t.memoizedState,e]}function po(e,t,s,r){return e={tag:e,create:t,destroy:s,deps:r,next:null},t=Et.updateQueue,t===null?(t={lastEffect:null,stores:null},Et.updateQueue=t,t.lastEffect=e.next=e):(s=t.lastEffect,s===null?t.lastEffect=e.next=e:(r=s.next,s.next=e,e.next=r,t.lastEffect=e)),e}function yx(){return Pn().memoizedState}function bl(e,t,s,r){var a=ns();Et.flags|=e,a.memoizedState=po(1|t,s,void 0,r===void 0?null:r)}function xi(e,t,s,r){var a=Pn();r=r===void 0?null:r;var o=void 0;if(Pt!==null){var l=Pt.memoizedState;if(o=l.destroy,r!==null&&fu(r,l.deps)){a.memoizedState=po(t,s,o,r);return}}Et.flags|=e,a.memoizedState=po(1|t,s,o,r)}function Pm(e,t){return bl(8390656,8,e,t)}function gu(e,t){return xi(2048,8,e,t)}function Nx(e,t){return xi(4,2,e,t)}function bx(e,t){return xi(4,4,e,t)}function vx(e,t){if(typeof t=="function")return e=e(),t(e),function(){t(null)};if(t!=null)return e=e(),t.current=e,function(){t.current=null}}function Sx(e,t,s){return s=s!=null?s.concat([e]):null,xi(4,4,vx.bind(null,t,e),s)}function yu(){}function wx(e,t){var s=Pn();t=t===void 0?null:t;var r=s.memoizedState;return r!==null&&t!==null&&fu(t,r[1])?r[0]:(s.memoizedState=[e,t],e)}function jx(e,t){var s=Pn();t=t===void 0?null:t;var r=s.memoizedState;return r!==null&&t!==null&&fu(t,r[1])?r[0]:(e=e(),s.memoizedState=[e,t],e)}function Ex(e,t,s){return gr&21?(qn(s,t)||(s=Rf(),Et.lanes|=s,yr|=s,e.baseState=!0),t):(e.baseState&&(e.baseState=!1,xn=!0),e.memoizedState=s)}function Wy(e,t){var s=dt;dt=s!==0&&4>s?s:4,e(!0);var r=xc.transition;xc.transition={};try{e(!1),t()}finally{dt=s,xc.transition=r}}function kx(){return Pn().memoizedState}function zy(e,t,s){var r=qs(e);if(s={lane:r,action:s,hasEagerState:!1,eagerState:null,next:null},Ax(e))Ix(t,s);else if(s=ix(e,t,s,r),s!==null){var a=dn();Yn(s,e,r,a),Tx(s,t,r)}}function Vy(e,t,s){var r=qs(e),a={lane:r,action:s,hasEagerState:!1,eagerState:null,next:null};if(Ax(e))Ix(t,a);else{var o=e.alternate;if(e.lanes===0&&(o===null||o.lanes===0)&&(o=t.lastRenderedReducer,o!==null))try{var l=t.lastRenderedState,c=o(l,s);if(a.hasEagerState=!0,a.eagerState=c,qn(c,l)){var i=t.interleaved;i===null?(a.next=a,cu(t)):(a.next=i.next,i.next=a),t.interleaved=a;return}}catch{}finally{}s=ix(e,t,a,r),s!==null&&(a=dn(),Yn(s,e,r,a),Tx(s,t,r))}}function Ax(e){var t=e.alternate;return e===Et||t!==null&&t===Et}function Ix(e,t){Va=Wl=!0;var s=e.pending;s===null?t.next=t:(t.next=s.next,s.next=t),e.pending=t}function Tx(e,t,s){if(s&4194240){var r=t.lanes;r&=e.pendingLanes,s|=r,t.lanes=s,qd(e,s)}}var zl={readContext:Mn,useCallback:en,useContext:en,useEffect:en,useImperativeHandle:en,useInsertionEffect:en,useLayoutEffect:en,useMemo:en,useReducer:en,useRef:en,useState:en,useDebugValue:en,useDeferredValue:en,useTransition:en,useMutableSource:en,useSyncExternalStore:en,useId:en,unstable_isNewReconciler:!1},Ky={readContext:Mn,useCallback:function(e,t){return ns().memoizedState=[e,t===void 0?null:t],e},useContext:Mn,useEffect:Pm,useImperativeHandle:function(e,t,s){return s=s!=null?s.concat([e]):null,bl(4194308,4,vx.bind(null,t,e),s)},useLayoutEffect:function(e,t){return bl(4194308,4,e,t)},useInsertionEffect:function(e,t){return bl(4,2,e,t)},useMemo:function(e,t){var s=ns();return t=t===void 0?null:t,e=e(),s.memoizedState=[e,t],e},useReducer:function(e,t,s){var r=ns();return t=s!==void 0?s(t):t,r.memoizedState=r.baseState=t,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:e,lastRenderedState:t},r.queue=e,e=e.dispatch=zy.bind(null,Et,e),[r.memoizedState,e]},useRef:function(e){var t=ns();return e={current:e},t.memoizedState=e},useState:Mm,useDebugValue:yu,useDeferredValue:function(e){return ns().memoizedState=e},useTransition:function(){var e=Mm(!1),t=e[0];return e=Wy.bind(null,e[1]),ns().memoizedState=e,[t,e]},useMutableSource:function(){},useSyncExternalStore:function(e,t,s){var r=Et,a=ns();if(vt){if(s===void 0)throw Error(pe(407));s=s()}else{if(s=t(),Wt===null)throw Error(pe(349));gr&30||px(r,t,s)}a.memoizedState=s;var o={value:s,getSnapshot:t};return a.queue=o,Pm(xx.bind(null,r,o,e),[e]),r.flags|=2048,po(9,fx.bind(null,r,o,s,t),void 0,null),s},useId:function(){var e=ns(),t=Wt.identifierPrefix;if(vt){var s=bs,r=Ns;s=(r&~(1<<32-Kn(r)-1)).toString(32)+s,t=":"+t+"R"+s,s=uo++,0<s&&(t+="H"+s.toString(32)),t+=":"}else s=Uy++,t=":"+t+"r"+s.toString(32)+":";return e.memoizedState=t},unstable_isNewReconciler:!1},Yy={readContext:Mn,useCallback:wx,useContext:Mn,useEffect:gu,useImperativeHandle:Sx,useInsertionEffect:Nx,useLayoutEffect:bx,useMemo:jx,useReducer:hc,useRef:yx,useState:function(){return hc(mo)},useDebugValue:yu,useDeferredValue:function(e){var t=Pn();return Ex(t,Pt.memoizedState,e)},useTransition:function(){var e=hc(mo)[0],t=Pn().memoizedState;return[e,t]},useMutableSource:ux,useSyncExternalStore:mx,useId:kx,unstable_isNewReconciler:!1},Gy={readContext:Mn,useCallback:wx,useContext:Mn,useEffect:gu,useImperativeHandle:Sx,useInsertionEffect:Nx,useLayoutEffect:bx,useMemo:jx,useReducer:gc,useRef:yx,useState:function(){return gc(mo)},useDebugValue:yu,useDeferredValue:function(e){var t=Pn();return Pt===null?t.memoizedState=e:Ex(t,Pt.memoizedState,e)},useTransition:function(){var e=gc(mo)[0],t=Pn().memoizedState;return[e,t]},useMutableSource:ux,useSyncExternalStore:mx,useId:kx,unstable_isNewReconciler:!1};function Wn(e,t){if(e&&e.defaultProps){t=kt({},t),e=e.defaultProps;for(var s in e)t[s]===void 0&&(t[s]=e[s]);return t}return t}function fd(e,t,s,r){t=e.memoizedState,s=s(r,t),s=s==null?t:kt({},t,s),e.memoizedState=s,e.lanes===0&&(e.updateQueue.baseState=s)}var hi={isMounted:function(e){return(e=e._reactInternals)?Sr(e)===e:!1},enqueueSetState:function(e,t,s){e=e._reactInternals;var r=dn(),a=qs(e),o=vs(r,a);o.payload=t,s!=null&&(o.callback=s),t=Ys(e,o,a),t!==null&&(Yn(t,e,a,r),yl(t,e,a))},enqueueReplaceState:function(e,t,s){e=e._reactInternals;var r=dn(),a=qs(e),o=vs(r,a);o.tag=1,o.payload=t,s!=null&&(o.callback=s),t=Ys(e,o,a),t!==null&&(Yn(t,e,a,r),yl(t,e,a))},enqueueForceUpdate:function(e,t){e=e._reactInternals;var s=dn(),r=qs(e),a=vs(s,r);a.tag=2,t!=null&&(a.callback=t),t=Ys(e,a,r),t!==null&&(Yn(t,e,r,s),yl(t,e,r))}};function Fm(e,t,s,r,a,o,l){return e=e.stateNode,typeof e.shouldComponentUpdate=="function"?e.shouldComponentUpdate(r,o,l):t.prototype&&t.prototype.isPureReactComponent?!ro(s,r)||!ro(a,o):!0}function Rx(e,t,s){var r=!1,a=Qs,o=t.contextType;return typeof o=="object"&&o!==null?o=Mn(o):(a=gn(t)?xr:rn.current,r=t.contextTypes,o=(r=r!=null)?ea(e,a):Qs),t=new t(s,o),e.memoizedState=t.state!==null&&t.state!==void 0?t.state:null,t.updater=hi,e.stateNode=t,t._reactInternals=e,r&&(e=e.stateNode,e.__reactInternalMemoizedUnmaskedChildContext=a,e.__reactInternalMemoizedMaskedChildContext=o),t}function Bm(e,t,s,r){e=t.state,typeof t.componentWillReceiveProps=="function"&&t.componentWillReceiveProps(s,r),typeof t.UNSAFE_componentWillReceiveProps=="function"&&t.UNSAFE_componentWillReceiveProps(s,r),t.state!==e&&hi.enqueueReplaceState(t,t.state,null)}function xd(e,t,s,r){var a=e.stateNode;a.props=s,a.state=e.memoizedState,a.refs={},du(e);var o=t.contextType;typeof o=="object"&&o!==null?a.context=Mn(o):(o=gn(t)?xr:rn.current,a.context=ea(e,o)),a.state=e.memoizedState,o=t.getDerivedStateFromProps,typeof o=="function"&&(fd(e,t,o,s),a.state=e.memoizedState),typeof t.getDerivedStateFromProps=="function"||typeof a.getSnapshotBeforeUpdate=="function"||typeof a.UNSAFE_componentWillMount!="function"&&typeof a.componentWillMount!="function"||(t=a.state,typeof a.componentWillMount=="function"&&a.componentWillMount(),typeof a.UNSAFE_componentWillMount=="function"&&a.UNSAFE_componentWillMount(),t!==a.state&&hi.enqueueReplaceState(a,a.state,null),Hl(e,s,a,r),a.state=e.memoizedState),typeof a.componentDidMount=="function"&&(e.flags|=4194308)}function ra(e,t){try{var s="",r=t;do s+=Sg(r),r=r.return;while(r);var a=s}catch(o){a=`
Error generating stack: `+o.message+`
`+o.stack}return{value:e,source:t,stack:a,digest:null}}function yc(e,t,s){return{value:e,source:null,stack:s??null,digest:t??null}}function hd(e,t){try{console.error(t.value)}catch(s){setTimeout(function(){throw s})}}var qy=typeof WeakMap=="function"?WeakMap:Map;function Cx(e,t,s){s=vs(-1,s),s.tag=3,s.payload={element:null};var r=t.value;return s.callback=function(){Kl||(Kl=!0,kd=r),hd(e,t)},s}function Dx(e,t,s){s=vs(-1,s),s.tag=3;var r=e.type.getDerivedStateFromError;if(typeof r=="function"){var a=t.value;s.payload=function(){return r(a)},s.callback=function(){hd(e,t)}}var o=e.stateNode;return o!==null&&typeof o.componentDidCatch=="function"&&(s.callback=function(){hd(e,t),typeof r!="function"&&(Gs===null?Gs=new Set([this]):Gs.add(this));var l=t.stack;this.componentDidCatch(t.value,{componentStack:l!==null?l:""})}),s}function $m(e,t,s){var r=e.pingCache;if(r===null){r=e.pingCache=new qy;var a=new Set;r.set(t,a)}else a=r.get(t),a===void 0&&(a=new Set,r.set(t,a));a.has(s)||(a.add(s),e=c0.bind(null,e,t,s),t.then(e,e))}function Hm(e){do{var t;if((t=e.tag===13)&&(t=e.memoizedState,t=t!==null?t.dehydrated!==null:!0),t)return e;e=e.return}while(e!==null);return null}function Um(e,t,s,r,a){return e.mode&1?(e.flags|=65536,e.lanes=a,e):(e===t?e.flags|=65536:(e.flags|=128,s.flags|=131072,s.flags&=-52805,s.tag===1&&(s.alternate===null?s.tag=17:(t=vs(-1,1),t.tag=2,Ys(s,t,1))),s.lanes|=1),e)}var Xy=Is.ReactCurrentOwner,xn=!1;function cn(e,t,s,r){t.child=e===null?lx(t,null,s,r):na(t,e.child,s,r)}function Wm(e,t,s,r,a){s=s.render;var o=t.ref;return Xr(t,a),r=xu(e,t,s,r,o,a),s=hu(),e!==null&&!xn?(t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~a,As(e,t,a)):(vt&&s&&su(t),t.flags|=1,cn(e,t,r,a),t.child)}function zm(e,t,s,r,a){if(e===null){var o=s.type;return typeof o=="function"&&!ku(o)&&o.defaultProps===void 0&&s.compare===null&&s.defaultProps===void 0?(t.tag=15,t.type=o,Lx(e,t,o,r,a)):(e=jl(s.type,null,r,t,t.mode,a),e.ref=t.ref,e.return=t,t.child=e)}if(o=e.child,!(e.lanes&a)){var l=o.memoizedProps;if(s=s.compare,s=s!==null?s:ro,s(l,r)&&e.ref===t.ref)return As(e,t,a)}return t.flags|=1,e=Xs(o,r),e.ref=t.ref,e.return=t,t.child=e}function Lx(e,t,s,r,a){if(e!==null){var o=e.memoizedProps;if(ro(o,r)&&e.ref===t.ref)if(xn=!1,t.pendingProps=r=o,(e.lanes&a)!==0)e.flags&131072&&(xn=!0);else return t.lanes=e.lanes,As(e,t,a)}return gd(e,t,s,r,a)}function _x(e,t,s){var r=t.pendingProps,a=r.children,o=e!==null?e.memoizedState:null;if(r.mode==="hidden")if(!(t.mode&1))t.memoizedState={baseLanes:0,cachePool:null,transitions:null},xt(Vr,bn),bn|=s;else{if(!(s&1073741824))return e=o!==null?o.baseLanes|s:s,t.lanes=t.childLanes=1073741824,t.memoizedState={baseLanes:e,cachePool:null,transitions:null},t.updateQueue=null,xt(Vr,bn),bn|=e,null;t.memoizedState={baseLanes:0,cachePool:null,transitions:null},r=o!==null?o.baseLanes:s,xt(Vr,bn),bn|=r}else o!==null?(r=o.baseLanes|s,t.memoizedState=null):r=s,xt(Vr,bn),bn|=r;return cn(e,t,a,s),t.child}function Ox(e,t){var s=t.ref;(e===null&&s!==null||e!==null&&e.ref!==s)&&(t.flags|=512,t.flags|=2097152)}function gd(e,t,s,r,a){var o=gn(s)?xr:rn.current;return o=ea(t,o),Xr(t,a),s=xu(e,t,s,r,o,a),r=hu(),e!==null&&!xn?(t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~a,As(e,t,a)):(vt&&r&&su(t),t.flags|=1,cn(e,t,s,a),t.child)}function Vm(e,t,s,r,a){if(gn(s)){var o=!0;Ml(t)}else o=!1;if(Xr(t,a),t.stateNode===null)vl(e,t),Rx(t,s,r),xd(t,s,r,a),r=!0;else if(e===null){var l=t.stateNode,c=t.memoizedProps;l.props=c;var i=l.context,u=s.contextType;typeof u=="object"&&u!==null?u=Mn(u):(u=gn(s)?xr:rn.current,u=ea(t,u));var p=s.getDerivedStateFromProps,y=typeof p=="function"||typeof l.getSnapshotBeforeUpdate=="function";y||typeof l.UNSAFE_componentWillReceiveProps!="function"&&typeof l.componentWillReceiveProps!="function"||(c!==r||i!==u)&&Bm(t,l,r,u),_s=!1;var b=t.memoizedState;l.state=b,Hl(t,r,l,a),i=t.memoizedState,c!==r||b!==i||hn.current||_s?(typeof p=="function"&&(fd(t,s,p,r),i=t.memoizedState),(c=_s||Fm(t,s,c,r,b,i,u))?(y||typeof l.UNSAFE_componentWillMount!="function"&&typeof l.componentWillMount!="function"||(typeof l.componentWillMount=="function"&&l.componentWillMount(),typeof l.UNSAFE_componentWillMount=="function"&&l.UNSAFE_componentWillMount()),typeof l.componentDidMount=="function"&&(t.flags|=4194308)):(typeof l.componentDidMount=="function"&&(t.flags|=4194308),t.memoizedProps=r,t.memoizedState=i),l.props=r,l.state=i,l.context=u,r=c):(typeof l.componentDidMount=="function"&&(t.flags|=4194308),r=!1)}else{l=t.stateNode,cx(e,t),c=t.memoizedProps,u=t.type===t.elementType?c:Wn(t.type,c),l.props=u,y=t.pendingProps,b=l.context,i=s.contextType,typeof i=="object"&&i!==null?i=Mn(i):(i=gn(s)?xr:rn.current,i=ea(t,i));var w=s.getDerivedStateFromProps;(p=typeof w=="function"||typeof l.getSnapshotBeforeUpdate=="function")||typeof l.UNSAFE_componentWillReceiveProps!="function"&&typeof l.componentWillReceiveProps!="function"||(c!==y||b!==i)&&Bm(t,l,r,i),_s=!1,b=t.memoizedState,l.state=b,Hl(t,r,l,a);var R=t.memoizedState;c!==y||b!==R||hn.current||_s?(typeof w=="function"&&(fd(t,s,w,r),R=t.memoizedState),(u=_s||Fm(t,s,u,r,b,R,i)||!1)?(p||typeof l.UNSAFE_componentWillUpdate!="function"&&typeof l.componentWillUpdate!="function"||(typeof l.componentWillUpdate=="function"&&l.componentWillUpdate(r,R,i),typeof l.UNSAFE_componentWillUpdate=="function"&&l.UNSAFE_componentWillUpdate(r,R,i)),typeof l.componentDidUpdate=="function"&&(t.flags|=4),typeof l.getSnapshotBeforeUpdate=="function"&&(t.flags|=1024)):(typeof l.componentDidUpdate!="function"||c===e.memoizedProps&&b===e.memoizedState||(t.flags|=4),typeof l.getSnapshotBeforeUpdate!="function"||c===e.memoizedProps&&b===e.memoizedState||(t.flags|=1024),t.memoizedProps=r,t.memoizedState=R),l.props=r,l.state=R,l.context=i,r=u):(typeof l.componentDidUpdate!="function"||c===e.memoizedProps&&b===e.memoizedState||(t.flags|=4),typeof l.getSnapshotBeforeUpdate!="function"||c===e.memoizedProps&&b===e.memoizedState||(t.flags|=1024),r=!1)}return yd(e,t,s,r,o,a)}function yd(e,t,s,r,a,o){Ox(e,t);var l=(t.flags&128)!==0;if(!r&&!l)return a&&Rm(t,s,!1),As(e,t,o);r=t.stateNode,Xy.current=t;var c=l&&typeof s.getDerivedStateFromError!="function"?null:r.render();return t.flags|=1,e!==null&&l?(t.child=na(t,e.child,null,o),t.child=na(t,null,c,o)):cn(e,t,c,o),t.memoizedState=r.state,a&&Rm(t,s,!0),t.child}function Mx(e){var t=e.stateNode;t.pendingContext?Tm(e,t.pendingContext,t.pendingContext!==t.context):t.context&&Tm(e,t.context,!1),uu(e,t.containerInfo)}function Km(e,t,s,r,a){return ta(),au(a),t.flags|=256,cn(e,t,s,r),t.child}var Nd={dehydrated:null,treeContext:null,retryLane:0};function bd(e){return{baseLanes:e,cachePool:null,transitions:null}}function Px(e,t,s){var r=t.pendingProps,a=jt.current,o=!1,l=(t.flags&128)!==0,c;if((c=l)||(c=e!==null&&e.memoizedState===null?!1:(a&2)!==0),c?(o=!0,t.flags&=-129):(e===null||e.memoizedState!==null)&&(a|=1),xt(jt,a&1),e===null)return md(t),e=t.memoizedState,e!==null&&(e=e.dehydrated,e!==null)?(t.mode&1?e.data==="$!"?t.lanes=8:t.lanes=1073741824:t.lanes=1,null):(l=r.children,e=r.fallback,o?(r=t.mode,o=t.child,l={mode:"hidden",children:l},!(r&1)&&o!==null?(o.childLanes=0,o.pendingProps=l):o=Ni(l,r,0,null),e=pr(e,r,s,null),o.return=t,e.return=t,o.sibling=e,t.child=o,t.child.memoizedState=bd(s),t.memoizedState=Nd,e):Nu(t,l));if(a=e.memoizedState,a!==null&&(c=a.dehydrated,c!==null))return Jy(e,t,l,r,c,a,s);if(o){o=r.fallback,l=t.mode,a=e.child,c=a.sibling;var i={mode:"hidden",children:r.children};return!(l&1)&&t.child!==a?(r=t.child,r.childLanes=0,r.pendingProps=i,t.deletions=null):(r=Xs(a,i),r.subtreeFlags=a.subtreeFlags&14680064),c!==null?o=Xs(c,o):(o=pr(o,l,s,null),o.flags|=2),o.return=t,r.return=t,r.sibling=o,t.child=r,r=o,o=t.child,l=e.child.memoizedState,l=l===null?bd(s):{baseLanes:l.baseLanes|s,cachePool:null,transitions:l.transitions},o.memoizedState=l,o.childLanes=e.childLanes&~s,t.memoizedState=Nd,r}return o=e.child,e=o.sibling,r=Xs(o,{mode:"visible",children:r.children}),!(t.mode&1)&&(r.lanes=s),r.return=t,r.sibling=null,e!==null&&(s=t.deletions,s===null?(t.deletions=[e],t.flags|=16):s.push(e)),t.child=r,t.memoizedState=null,r}function Nu(e,t){return t=Ni({mode:"visible",children:t},e.mode,0,null),t.return=e,e.child=t}function nl(e,t,s,r){return r!==null&&au(r),na(t,e.child,null,s),e=Nu(t,t.pendingProps.children),e.flags|=2,t.memoizedState=null,e}function Jy(e,t,s,r,a,o,l){if(s)return t.flags&256?(t.flags&=-257,r=yc(Error(pe(422))),nl(e,t,l,r)):t.memoizedState!==null?(t.child=e.child,t.flags|=128,null):(o=r.fallback,a=t.mode,r=Ni({mode:"visible",children:r.children},a,0,null),o=pr(o,a,l,null),o.flags|=2,r.return=t,o.return=t,r.sibling=o,t.child=r,t.mode&1&&na(t,e.child,null,l),t.child.memoizedState=bd(l),t.memoizedState=Nd,o);if(!(t.mode&1))return nl(e,t,l,null);if(a.data==="$!"){if(r=a.nextSibling&&a.nextSibling.dataset,r)var c=r.dgst;return r=c,o=Error(pe(419)),r=yc(o,r,void 0),nl(e,t,l,r)}if(c=(l&e.childLanes)!==0,xn||c){if(r=Wt,r!==null){switch(l&-l){case 4:a=2;break;case 16:a=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:a=32;break;case 536870912:a=268435456;break;default:a=0}a=a&(r.suspendedLanes|l)?0:a,a!==0&&a!==o.retryLane&&(o.retryLane=a,ks(e,a),Yn(r,e,a,-1))}return Eu(),r=yc(Error(pe(421))),nl(e,t,l,r)}return a.data==="$?"?(t.flags|=128,t.child=e.child,t=d0.bind(null,e),a._reactRetry=t,null):(e=o.treeContext,Sn=Ks(a.nextSibling),wn=t,vt=!0,Vn=null,e!==null&&(Cn[Dn++]=Ns,Cn[Dn++]=bs,Cn[Dn++]=hr,Ns=e.id,bs=e.overflow,hr=t),t=Nu(t,r.children),t.flags|=4096,t)}function Ym(e,t,s){e.lanes|=t;var r=e.alternate;r!==null&&(r.lanes|=t),pd(e.return,t,s)}function Nc(e,t,s,r,a){var o=e.memoizedState;o===null?e.memoizedState={isBackwards:t,rendering:null,renderingStartTime:0,last:r,tail:s,tailMode:a}:(o.isBackwards=t,o.rendering=null,o.renderingStartTime=0,o.last=r,o.tail=s,o.tailMode=a)}function Fx(e,t,s){var r=t.pendingProps,a=r.revealOrder,o=r.tail;if(cn(e,t,r.children,s),r=jt.current,r&2)r=r&1|2,t.flags|=128;else{if(e!==null&&e.flags&128)e:for(e=t.child;e!==null;){if(e.tag===13)e.memoizedState!==null&&Ym(e,s,t);else if(e.tag===19)Ym(e,s,t);else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===t)break e;for(;e.sibling===null;){if(e.return===null||e.return===t)break e;e=e.return}e.sibling.return=e.return,e=e.sibling}r&=1}if(xt(jt,r),!(t.mode&1))t.memoizedState=null;else switch(a){case"forwards":for(s=t.child,a=null;s!==null;)e=s.alternate,e!==null&&Ul(e)===null&&(a=s),s=s.sibling;s=a,s===null?(a=t.child,t.child=null):(a=s.sibling,s.sibling=null),Nc(t,!1,a,s,o);break;case"backwards":for(s=null,a=t.child,t.child=null;a!==null;){if(e=a.alternate,e!==null&&Ul(e)===null){t.child=a;break}e=a.sibling,a.sibling=s,s=a,a=e}Nc(t,!0,s,null,o);break;case"together":Nc(t,!1,null,null,void 0);break;default:t.memoizedState=null}return t.child}function vl(e,t){!(t.mode&1)&&e!==null&&(e.alternate=null,t.alternate=null,t.flags|=2)}function As(e,t,s){if(e!==null&&(t.dependencies=e.dependencies),yr|=t.lanes,!(s&t.childLanes))return null;if(e!==null&&t.child!==e.child)throw Error(pe(153));if(t.child!==null){for(e=t.child,s=Xs(e,e.pendingProps),t.child=s,s.return=t;e.sibling!==null;)e=e.sibling,s=s.sibling=Xs(e,e.pendingProps),s.return=t;s.sibling=null}return t.child}function Qy(e,t,s){switch(t.tag){case 3:Mx(t),ta();break;case 5:dx(t);break;case 1:gn(t.type)&&Ml(t);break;case 4:uu(t,t.stateNode.containerInfo);break;case 10:var r=t.type._context,a=t.memoizedProps.value;xt(Bl,r._currentValue),r._currentValue=a;break;case 13:if(r=t.memoizedState,r!==null)return r.dehydrated!==null?(xt(jt,jt.current&1),t.flags|=128,null):s&t.child.childLanes?Px(e,t,s):(xt(jt,jt.current&1),e=As(e,t,s),e!==null?e.sibling:null);xt(jt,jt.current&1);break;case 19:if(r=(s&t.childLanes)!==0,e.flags&128){if(r)return Fx(e,t,s);t.flags|=128}if(a=t.memoizedState,a!==null&&(a.rendering=null,a.tail=null,a.lastEffect=null),xt(jt,jt.current),r)break;return null;case 22:case 23:return t.lanes=0,_x(e,t,s)}return As(e,t,s)}var Bx,vd,$x,Hx;Bx=function(e,t){for(var s=t.child;s!==null;){if(s.tag===5||s.tag===6)e.appendChild(s.stateNode);else if(s.tag!==4&&s.child!==null){s.child.return=s,s=s.child;continue}if(s===t)break;for(;s.sibling===null;){if(s.return===null||s.return===t)return;s=s.return}s.sibling.return=s.return,s=s.sibling}};vd=function(){};$x=function(e,t,s,r){var a=e.memoizedProps;if(a!==r){e=t.stateNode,ur(ds.current);var o=null;switch(s){case"input":a=Wc(e,a),r=Wc(e,r),o=[];break;case"select":a=kt({},a,{value:void 0}),r=kt({},r,{value:void 0}),o=[];break;case"textarea":a=Kc(e,a),r=Kc(e,r),o=[];break;default:typeof a.onClick!="function"&&typeof r.onClick=="function"&&(e.onclick=_l)}Gc(s,r);var l;s=null;for(u in a)if(!r.hasOwnProperty(u)&&a.hasOwnProperty(u)&&a[u]!=null)if(u==="style"){var c=a[u];for(l in c)c.hasOwnProperty(l)&&(s||(s={}),s[l]="")}else u!=="dangerouslySetInnerHTML"&&u!=="children"&&u!=="suppressContentEditableWarning"&&u!=="suppressHydrationWarning"&&u!=="autoFocus"&&(Ja.hasOwnProperty(u)?o||(o=[]):(o=o||[]).push(u,null));for(u in r){var i=r[u];if(c=a!=null?a[u]:void 0,r.hasOwnProperty(u)&&i!==c&&(i!=null||c!=null))if(u==="style")if(c){for(l in c)!c.hasOwnProperty(l)||i&&i.hasOwnProperty(l)||(s||(s={}),s[l]="");for(l in i)i.hasOwnProperty(l)&&c[l]!==i[l]&&(s||(s={}),s[l]=i[l])}else s||(o||(o=[]),o.push(u,s)),s=i;else u==="dangerouslySetInnerHTML"?(i=i?i.__html:void 0,c=c?c.__html:void 0,i!=null&&c!==i&&(o=o||[]).push(u,i)):u==="children"?typeof i!="string"&&typeof i!="number"||(o=o||[]).push(u,""+i):u!=="suppressContentEditableWarning"&&u!=="suppressHydrationWarning"&&(Ja.hasOwnProperty(u)?(i!=null&&u==="onScroll"&&yt("scroll",e),o||c===i||(o=[])):(o=o||[]).push(u,i))}s&&(o=o||[]).push("style",s);var u=o;(t.updateQueue=u)&&(t.flags|=4)}};Hx=function(e,t,s,r){s!==r&&(t.flags|=4)};function Ca(e,t){if(!vt)switch(e.tailMode){case"hidden":t=e.tail;for(var s=null;t!==null;)t.alternate!==null&&(s=t),t=t.sibling;s===null?e.tail=null:s.sibling=null;break;case"collapsed":s=e.tail;for(var r=null;s!==null;)s.alternate!==null&&(r=s),s=s.sibling;r===null?t||e.tail===null?e.tail=null:e.tail.sibling=null:r.sibling=null}}function tn(e){var t=e.alternate!==null&&e.alternate.child===e.child,s=0,r=0;if(t)for(var a=e.child;a!==null;)s|=a.lanes|a.childLanes,r|=a.subtreeFlags&14680064,r|=a.flags&14680064,a.return=e,a=a.sibling;else for(a=e.child;a!==null;)s|=a.lanes|a.childLanes,r|=a.subtreeFlags,r|=a.flags,a.return=e,a=a.sibling;return e.subtreeFlags|=r,e.childLanes=s,t}function Zy(e,t,s){var r=t.pendingProps;switch(ru(t),t.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return tn(t),null;case 1:return gn(t.type)&&Ol(),tn(t),null;case 3:return r=t.stateNode,sa(),bt(hn),bt(rn),pu(),r.pendingContext&&(r.context=r.pendingContext,r.pendingContext=null),(e===null||e.child===null)&&(el(t)?t.flags|=4:e===null||e.memoizedState.isDehydrated&&!(t.flags&256)||(t.flags|=1024,Vn!==null&&(Td(Vn),Vn=null))),vd(e,t),tn(t),null;case 5:mu(t);var a=ur(co.current);if(s=t.type,e!==null&&t.stateNode!=null)$x(e,t,s,r,a),e.ref!==t.ref&&(t.flags|=512,t.flags|=2097152);else{if(!r){if(t.stateNode===null)throw Error(pe(166));return tn(t),null}if(e=ur(ds.current),el(t)){r=t.stateNode,s=t.type;var o=t.memoizedProps;switch(r[as]=t,r[lo]=o,e=(t.mode&1)!==0,s){case"dialog":yt("cancel",r),yt("close",r);break;case"iframe":case"object":case"embed":yt("load",r);break;case"video":case"audio":for(a=0;a<Ba.length;a++)yt(Ba[a],r);break;case"source":yt("error",r);break;case"img":case"image":case"link":yt("error",r),yt("load",r);break;case"details":yt("toggle",r);break;case"input":nm(r,o),yt("invalid",r);break;case"select":r._wrapperState={wasMultiple:!!o.multiple},yt("invalid",r);break;case"textarea":rm(r,o),yt("invalid",r)}Gc(s,o),a=null;for(var l in o)if(o.hasOwnProperty(l)){var c=o[l];l==="children"?typeof c=="string"?r.textContent!==c&&(o.suppressHydrationWarning!==!0&&Zo(r.textContent,c,e),a=["children",c]):typeof c=="number"&&r.textContent!==""+c&&(o.suppressHydrationWarning!==!0&&Zo(r.textContent,c,e),a=["children",""+c]):Ja.hasOwnProperty(l)&&c!=null&&l==="onScroll"&&yt("scroll",r)}switch(s){case"input":Vo(r),sm(r,o,!0);break;case"textarea":Vo(r),am(r);break;case"select":case"option":break;default:typeof o.onClick=="function"&&(r.onclick=_l)}r=a,t.updateQueue=r,r!==null&&(t.flags|=4)}else{l=a.nodeType===9?a:a.ownerDocument,e==="http://www.w3.org/1999/xhtml"&&(e=xf(s)),e==="http://www.w3.org/1999/xhtml"?s==="script"?(e=l.createElement("div"),e.innerHTML="<script><\/script>",e=e.removeChild(e.firstChild)):typeof r.is=="string"?e=l.createElement(s,{is:r.is}):(e=l.createElement(s),s==="select"&&(l=e,r.multiple?l.multiple=!0:r.size&&(l.size=r.size))):e=l.createElementNS(e,s),e[as]=t,e[lo]=r,Bx(e,t,!1,!1),t.stateNode=e;e:{switch(l=qc(s,r),s){case"dialog":yt("cancel",e),yt("close",e),a=r;break;case"iframe":case"object":case"embed":yt("load",e),a=r;break;case"video":case"audio":for(a=0;a<Ba.length;a++)yt(Ba[a],e);a=r;break;case"source":yt("error",e),a=r;break;case"img":case"image":case"link":yt("error",e),yt("load",e),a=r;break;case"details":yt("toggle",e),a=r;break;case"input":nm(e,r),a=Wc(e,r),yt("invalid",e);break;case"option":a=r;break;case"select":e._wrapperState={wasMultiple:!!r.multiple},a=kt({},r,{value:void 0}),yt("invalid",e);break;case"textarea":rm(e,r),a=Kc(e,r),yt("invalid",e);break;default:a=r}Gc(s,a),c=a;for(o in c)if(c.hasOwnProperty(o)){var i=c[o];o==="style"?yf(e,i):o==="dangerouslySetInnerHTML"?(i=i?i.__html:void 0,i!=null&&hf(e,i)):o==="children"?typeof i=="string"?(s!=="textarea"||i!=="")&&Qa(e,i):typeof i=="number"&&Qa(e,""+i):o!=="suppressContentEditableWarning"&&o!=="suppressHydrationWarning"&&o!=="autoFocus"&&(Ja.hasOwnProperty(o)?i!=null&&o==="onScroll"&&yt("scroll",e):i!=null&&Wd(e,o,i,l))}switch(s){case"input":Vo(e),sm(e,r,!1);break;case"textarea":Vo(e),am(e);break;case"option":r.value!=null&&e.setAttribute("value",""+Js(r.value));break;case"select":e.multiple=!!r.multiple,o=r.value,o!=null?Kr(e,!!r.multiple,o,!1):r.defaultValue!=null&&Kr(e,!!r.multiple,r.defaultValue,!0);break;default:typeof a.onClick=="function"&&(e.onclick=_l)}switch(s){case"button":case"input":case"select":case"textarea":r=!!r.autoFocus;break e;case"img":r=!0;break e;default:r=!1}}r&&(t.flags|=4)}t.ref!==null&&(t.flags|=512,t.flags|=2097152)}return tn(t),null;case 6:if(e&&t.stateNode!=null)Hx(e,t,e.memoizedProps,r);else{if(typeof r!="string"&&t.stateNode===null)throw Error(pe(166));if(s=ur(co.current),ur(ds.current),el(t)){if(r=t.stateNode,s=t.memoizedProps,r[as]=t,(o=r.nodeValue!==s)&&(e=wn,e!==null))switch(e.tag){case 3:Zo(r.nodeValue,s,(e.mode&1)!==0);break;case 5:e.memoizedProps.suppressHydrationWarning!==!0&&Zo(r.nodeValue,s,(e.mode&1)!==0)}o&&(t.flags|=4)}else r=(s.nodeType===9?s:s.ownerDocument).createTextNode(r),r[as]=t,t.stateNode=r}return tn(t),null;case 13:if(bt(jt),r=t.memoizedState,e===null||e.memoizedState!==null&&e.memoizedState.dehydrated!==null){if(vt&&Sn!==null&&t.mode&1&&!(t.flags&128))ax(),ta(),t.flags|=98560,o=!1;else if(o=el(t),r!==null&&r.dehydrated!==null){if(e===null){if(!o)throw Error(pe(318));if(o=t.memoizedState,o=o!==null?o.dehydrated:null,!o)throw Error(pe(317));o[as]=t}else ta(),!(t.flags&128)&&(t.memoizedState=null),t.flags|=4;tn(t),o=!1}else Vn!==null&&(Td(Vn),Vn=null),o=!0;if(!o)return t.flags&65536?t:null}return t.flags&128?(t.lanes=s,t):(r=r!==null,r!==(e!==null&&e.memoizedState!==null)&&r&&(t.child.flags|=8192,t.mode&1&&(e===null||jt.current&1?Bt===0&&(Bt=3):Eu())),t.updateQueue!==null&&(t.flags|=4),tn(t),null);case 4:return sa(),vd(e,t),e===null&&ao(t.stateNode.containerInfo),tn(t),null;case 10:return iu(t.type._context),tn(t),null;case 17:return gn(t.type)&&Ol(),tn(t),null;case 19:if(bt(jt),o=t.memoizedState,o===null)return tn(t),null;if(r=(t.flags&128)!==0,l=o.rendering,l===null)if(r)Ca(o,!1);else{if(Bt!==0||e!==null&&e.flags&128)for(e=t.child;e!==null;){if(l=Ul(e),l!==null){for(t.flags|=128,Ca(o,!1),r=l.updateQueue,r!==null&&(t.updateQueue=r,t.flags|=4),t.subtreeFlags=0,r=s,s=t.child;s!==null;)o=s,e=r,o.flags&=14680066,l=o.alternate,l===null?(o.childLanes=0,o.lanes=e,o.child=null,o.subtreeFlags=0,o.memoizedProps=null,o.memoizedState=null,o.updateQueue=null,o.dependencies=null,o.stateNode=null):(o.childLanes=l.childLanes,o.lanes=l.lanes,o.child=l.child,o.subtreeFlags=0,o.deletions=null,o.memoizedProps=l.memoizedProps,o.memoizedState=l.memoizedState,o.updateQueue=l.updateQueue,o.type=l.type,e=l.dependencies,o.dependencies=e===null?null:{lanes:e.lanes,firstContext:e.firstContext}),s=s.sibling;return xt(jt,jt.current&1|2),t.child}e=e.sibling}o.tail!==null&&Ct()>aa&&(t.flags|=128,r=!0,Ca(o,!1),t.lanes=4194304)}else{if(!r)if(e=Ul(l),e!==null){if(t.flags|=128,r=!0,s=e.updateQueue,s!==null&&(t.updateQueue=s,t.flags|=4),Ca(o,!0),o.tail===null&&o.tailMode==="hidden"&&!l.alternate&&!vt)return tn(t),null}else 2*Ct()-o.renderingStartTime>aa&&s!==1073741824&&(t.flags|=128,r=!0,Ca(o,!1),t.lanes=4194304);o.isBackwards?(l.sibling=t.child,t.child=l):(s=o.last,s!==null?s.sibling=l:t.child=l,o.last=l)}return o.tail!==null?(t=o.tail,o.rendering=t,o.tail=t.sibling,o.renderingStartTime=Ct(),t.sibling=null,s=jt.current,xt(jt,r?s&1|2:s&1),t):(tn(t),null);case 22:case 23:return ju(),r=t.memoizedState!==null,e!==null&&e.memoizedState!==null!==r&&(t.flags|=8192),r&&t.mode&1?bn&1073741824&&(tn(t),t.subtreeFlags&6&&(t.flags|=8192)):tn(t),null;case 24:return null;case 25:return null}throw Error(pe(156,t.tag))}function e0(e,t){switch(ru(t),t.tag){case 1:return gn(t.type)&&Ol(),e=t.flags,e&65536?(t.flags=e&-65537|128,t):null;case 3:return sa(),bt(hn),bt(rn),pu(),e=t.flags,e&65536&&!(e&128)?(t.flags=e&-65537|128,t):null;case 5:return mu(t),null;case 13:if(bt(jt),e=t.memoizedState,e!==null&&e.dehydrated!==null){if(t.alternate===null)throw Error(pe(340));ta()}return e=t.flags,e&65536?(t.flags=e&-65537|128,t):null;case 19:return bt(jt),null;case 4:return sa(),null;case 10:return iu(t.type._context),null;case 22:case 23:return ju(),null;case 24:return null;default:return null}}var sl=!1,nn=!1,t0=typeof WeakSet=="function"?WeakSet:Set,Ae=null;function zr(e,t){var s=e.ref;if(s!==null)if(typeof s=="function")try{s(null)}catch(r){Tt(e,t,r)}else s.current=null}function Sd(e,t,s){try{s()}catch(r){Tt(e,t,r)}}var Gm=!1;function n0(e,t){if(ad=Cl,e=Kf(),nu(e)){if("selectionStart"in e)var s={start:e.selectionStart,end:e.selectionEnd};else e:{s=(s=e.ownerDocument)&&s.defaultView||window;var r=s.getSelection&&s.getSelection();if(r&&r.rangeCount!==0){s=r.anchorNode;var a=r.anchorOffset,o=r.focusNode;r=r.focusOffset;try{s.nodeType,o.nodeType}catch{s=null;break e}var l=0,c=-1,i=-1,u=0,p=0,y=e,b=null;t:for(;;){for(var w;y!==s||a!==0&&y.nodeType!==3||(c=l+a),y!==o||r!==0&&y.nodeType!==3||(i=l+r),y.nodeType===3&&(l+=y.nodeValue.length),(w=y.firstChild)!==null;)b=y,y=w;for(;;){if(y===e)break t;if(b===s&&++u===a&&(c=l),b===o&&++p===r&&(i=l),(w=y.nextSibling)!==null)break;y=b,b=y.parentNode}y=w}s=c===-1||i===-1?null:{start:c,end:i}}else s=null}s=s||{start:0,end:0}}else s=null;for(od={focusedElem:e,selectionRange:s},Cl=!1,Ae=t;Ae!==null;)if(t=Ae,e=t.child,(t.subtreeFlags&1028)!==0&&e!==null)e.return=t,Ae=e;else for(;Ae!==null;){t=Ae;try{var R=t.alternate;if(t.flags&1024)switch(t.tag){case 0:case 11:case 15:break;case 1:if(R!==null){var E=R.memoizedProps,W=R.memoizedState,N=t.stateNode,h=N.getSnapshotBeforeUpdate(t.elementType===t.type?E:Wn(t.type,E),W);N.__reactInternalSnapshotBeforeUpdate=h}break;case 3:var S=t.stateNode.containerInfo;S.nodeType===1?S.textContent="":S.nodeType===9&&S.documentElement&&S.removeChild(S.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(pe(163))}}catch(M){Tt(t,t.return,M)}if(e=t.sibling,e!==null){e.return=t.return,Ae=e;break}Ae=t.return}return R=Gm,Gm=!1,R}function Ka(e,t,s){var r=t.updateQueue;if(r=r!==null?r.lastEffect:null,r!==null){var a=r=r.next;do{if((a.tag&e)===e){var o=a.destroy;a.destroy=void 0,o!==void 0&&Sd(t,s,o)}a=a.next}while(a!==r)}}function gi(e,t){if(t=t.updateQueue,t=t!==null?t.lastEffect:null,t!==null){var s=t=t.next;do{if((s.tag&e)===e){var r=s.create;s.destroy=r()}s=s.next}while(s!==t)}}function wd(e){var t=e.ref;if(t!==null){var s=e.stateNode;switch(e.tag){case 5:e=s;break;default:e=s}typeof t=="function"?t(e):t.current=e}}function Ux(e){var t=e.alternate;t!==null&&(e.alternate=null,Ux(t)),e.child=null,e.deletions=null,e.sibling=null,e.tag===5&&(t=e.stateNode,t!==null&&(delete t[as],delete t[lo],delete t[cd],delete t[Fy],delete t[By])),e.stateNode=null,e.return=null,e.dependencies=null,e.memoizedProps=null,e.memoizedState=null,e.pendingProps=null,e.stateNode=null,e.updateQueue=null}function Wx(e){return e.tag===5||e.tag===3||e.tag===4}function qm(e){e:for(;;){for(;e.sibling===null;){if(e.return===null||Wx(e.return))return null;e=e.return}for(e.sibling.return=e.return,e=e.sibling;e.tag!==5&&e.tag!==6&&e.tag!==18;){if(e.flags&2||e.child===null||e.tag===4)continue e;e.child.return=e,e=e.child}if(!(e.flags&2))return e.stateNode}}function jd(e,t,s){var r=e.tag;if(r===5||r===6)e=e.stateNode,t?s.nodeType===8?s.parentNode.insertBefore(e,t):s.insertBefore(e,t):(s.nodeType===8?(t=s.parentNode,t.insertBefore(e,s)):(t=s,t.appendChild(e)),s=s._reactRootContainer,s!=null||t.onclick!==null||(t.onclick=_l));else if(r!==4&&(e=e.child,e!==null))for(jd(e,t,s),e=e.sibling;e!==null;)jd(e,t,s),e=e.sibling}function Ed(e,t,s){var r=e.tag;if(r===5||r===6)e=e.stateNode,t?s.insertBefore(e,t):s.appendChild(e);else if(r!==4&&(e=e.child,e!==null))for(Ed(e,t,s),e=e.sibling;e!==null;)Ed(e,t,s),e=e.sibling}var Vt=null,zn=!1;function Ds(e,t,s){for(s=s.child;s!==null;)zx(e,t,s),s=s.sibling}function zx(e,t,s){if(cs&&typeof cs.onCommitFiberUnmount=="function")try{cs.onCommitFiberUnmount(ci,s)}catch{}switch(s.tag){case 5:nn||zr(s,t);case 6:var r=Vt,a=zn;Vt=null,Ds(e,t,s),Vt=r,zn=a,Vt!==null&&(zn?(e=Vt,s=s.stateNode,e.nodeType===8?e.parentNode.removeChild(s):e.removeChild(s)):Vt.removeChild(s.stateNode));break;case 18:Vt!==null&&(zn?(e=Vt,s=s.stateNode,e.nodeType===8?mc(e.parentNode,s):e.nodeType===1&&mc(e,s),no(e)):mc(Vt,s.stateNode));break;case 4:r=Vt,a=zn,Vt=s.stateNode.containerInfo,zn=!0,Ds(e,t,s),Vt=r,zn=a;break;case 0:case 11:case 14:case 15:if(!nn&&(r=s.updateQueue,r!==null&&(r=r.lastEffect,r!==null))){a=r=r.next;do{var o=a,l=o.destroy;o=o.tag,l!==void 0&&(o&2||o&4)&&Sd(s,t,l),a=a.next}while(a!==r)}Ds(e,t,s);break;case 1:if(!nn&&(zr(s,t),r=s.stateNode,typeof r.componentWillUnmount=="function"))try{r.props=s.memoizedProps,r.state=s.memoizedState,r.componentWillUnmount()}catch(c){Tt(s,t,c)}Ds(e,t,s);break;case 21:Ds(e,t,s);break;case 22:s.mode&1?(nn=(r=nn)||s.memoizedState!==null,Ds(e,t,s),nn=r):Ds(e,t,s);break;default:Ds(e,t,s)}}function Xm(e){var t=e.updateQueue;if(t!==null){e.updateQueue=null;var s=e.stateNode;s===null&&(s=e.stateNode=new t0),t.forEach(function(r){var a=u0.bind(null,e,r);s.has(r)||(s.add(r),r.then(a,a))})}}function Un(e,t){var s=t.deletions;if(s!==null)for(var r=0;r<s.length;r++){var a=s[r];try{var o=e,l=t,c=l;e:for(;c!==null;){switch(c.tag){case 5:Vt=c.stateNode,zn=!1;break e;case 3:Vt=c.stateNode.containerInfo,zn=!0;break e;case 4:Vt=c.stateNode.containerInfo,zn=!0;break e}c=c.return}if(Vt===null)throw Error(pe(160));zx(o,l,a),Vt=null,zn=!1;var i=a.alternate;i!==null&&(i.return=null),a.return=null}catch(u){Tt(a,t,u)}}if(t.subtreeFlags&12854)for(t=t.child;t!==null;)Vx(t,e),t=t.sibling}function Vx(e,t){var s=e.alternate,r=e.flags;switch(e.tag){case 0:case 11:case 14:case 15:if(Un(t,e),ts(e),r&4){try{Ka(3,e,e.return),gi(3,e)}catch(E){Tt(e,e.return,E)}try{Ka(5,e,e.return)}catch(E){Tt(e,e.return,E)}}break;case 1:Un(t,e),ts(e),r&512&&s!==null&&zr(s,s.return);break;case 5:if(Un(t,e),ts(e),r&512&&s!==null&&zr(s,s.return),e.flags&32){var a=e.stateNode;try{Qa(a,"")}catch(E){Tt(e,e.return,E)}}if(r&4&&(a=e.stateNode,a!=null)){var o=e.memoizedProps,l=s!==null?s.memoizedProps:o,c=e.type,i=e.updateQueue;if(e.updateQueue=null,i!==null)try{c==="input"&&o.type==="radio"&&o.name!=null&&pf(a,o),qc(c,l);var u=qc(c,o);for(l=0;l<i.length;l+=2){var p=i[l],y=i[l+1];p==="style"?yf(a,y):p==="dangerouslySetInnerHTML"?hf(a,y):p==="children"?Qa(a,y):Wd(a,p,y,u)}switch(c){case"input":zc(a,o);break;case"textarea":ff(a,o);break;case"select":var b=a._wrapperState.wasMultiple;a._wrapperState.wasMultiple=!!o.multiple;var w=o.value;w!=null?Kr(a,!!o.multiple,w,!1):b!==!!o.multiple&&(o.defaultValue!=null?Kr(a,!!o.multiple,o.defaultValue,!0):Kr(a,!!o.multiple,o.multiple?[]:"",!1))}a[lo]=o}catch(E){Tt(e,e.return,E)}}break;case 6:if(Un(t,e),ts(e),r&4){if(e.stateNode===null)throw Error(pe(162));a=e.stateNode,o=e.memoizedProps;try{a.nodeValue=o}catch(E){Tt(e,e.return,E)}}break;case 3:if(Un(t,e),ts(e),r&4&&s!==null&&s.memoizedState.isDehydrated)try{no(t.containerInfo)}catch(E){Tt(e,e.return,E)}break;case 4:Un(t,e),ts(e);break;case 13:Un(t,e),ts(e),a=e.child,a.flags&8192&&(o=a.memoizedState!==null,a.stateNode.isHidden=o,!o||a.alternate!==null&&a.alternate.memoizedState!==null||(Su=Ct())),r&4&&Xm(e);break;case 22:if(p=s!==null&&s.memoizedState!==null,e.mode&1?(nn=(u=nn)||p,Un(t,e),nn=u):Un(t,e),ts(e),r&8192){if(u=e.memoizedState!==null,(e.stateNode.isHidden=u)&&!p&&e.mode&1)for(Ae=e,p=e.child;p!==null;){for(y=Ae=p;Ae!==null;){switch(b=Ae,w=b.child,b.tag){case 0:case 11:case 14:case 15:Ka(4,b,b.return);break;case 1:zr(b,b.return);var R=b.stateNode;if(typeof R.componentWillUnmount=="function"){r=b,s=b.return;try{t=r,R.props=t.memoizedProps,R.state=t.memoizedState,R.componentWillUnmount()}catch(E){Tt(r,s,E)}}break;case 5:zr(b,b.return);break;case 22:if(b.memoizedState!==null){Qm(y);continue}}w!==null?(w.return=b,Ae=w):Qm(y)}p=p.sibling}e:for(p=null,y=e;;){if(y.tag===5){if(p===null){p=y;try{a=y.stateNode,u?(o=a.style,typeof o.setProperty=="function"?o.setProperty("display","none","important"):o.display="none"):(c=y.stateNode,i=y.memoizedProps.style,l=i!=null&&i.hasOwnProperty("display")?i.display:null,c.style.display=gf("display",l))}catch(E){Tt(e,e.return,E)}}}else if(y.tag===6){if(p===null)try{y.stateNode.nodeValue=u?"":y.memoizedProps}catch(E){Tt(e,e.return,E)}}else if((y.tag!==22&&y.tag!==23||y.memoizedState===null||y===e)&&y.child!==null){y.child.return=y,y=y.child;continue}if(y===e)break e;for(;y.sibling===null;){if(y.return===null||y.return===e)break e;p===y&&(p=null),y=y.return}p===y&&(p=null),y.sibling.return=y.return,y=y.sibling}}break;case 19:Un(t,e),ts(e),r&4&&Xm(e);break;case 21:break;default:Un(t,e),ts(e)}}function ts(e){var t=e.flags;if(t&2){try{e:{for(var s=e.return;s!==null;){if(Wx(s)){var r=s;break e}s=s.return}throw Error(pe(160))}switch(r.tag){case 5:var a=r.stateNode;r.flags&32&&(Qa(a,""),r.flags&=-33);var o=qm(e);Ed(e,o,a);break;case 3:case 4:var l=r.stateNode.containerInfo,c=qm(e);jd(e,c,l);break;default:throw Error(pe(161))}}catch(i){Tt(e,e.return,i)}e.flags&=-3}t&4096&&(e.flags&=-4097)}function s0(e,t,s){Ae=e,Kx(e)}function Kx(e,t,s){for(var r=(e.mode&1)!==0;Ae!==null;){var a=Ae,o=a.child;if(a.tag===22&&r){var l=a.memoizedState!==null||sl;if(!l){var c=a.alternate,i=c!==null&&c.memoizedState!==null||nn;c=sl;var u=nn;if(sl=l,(nn=i)&&!u)for(Ae=a;Ae!==null;)l=Ae,i=l.child,l.tag===22&&l.memoizedState!==null?Zm(a):i!==null?(i.return=l,Ae=i):Zm(a);for(;o!==null;)Ae=o,Kx(o),o=o.sibling;Ae=a,sl=c,nn=u}Jm(e)}else a.subtreeFlags&8772&&o!==null?(o.return=a,Ae=o):Jm(e)}}function Jm(e){for(;Ae!==null;){var t=Ae;if(t.flags&8772){var s=t.alternate;try{if(t.flags&8772)switch(t.tag){case 0:case 11:case 15:nn||gi(5,t);break;case 1:var r=t.stateNode;if(t.flags&4&&!nn)if(s===null)r.componentDidMount();else{var a=t.elementType===t.type?s.memoizedProps:Wn(t.type,s.memoizedProps);r.componentDidUpdate(a,s.memoizedState,r.__reactInternalSnapshotBeforeUpdate)}var o=t.updateQueue;o!==null&&Om(t,o,r);break;case 3:var l=t.updateQueue;if(l!==null){if(s=null,t.child!==null)switch(t.child.tag){case 5:s=t.child.stateNode;break;case 1:s=t.child.stateNode}Om(t,l,s)}break;case 5:var c=t.stateNode;if(s===null&&t.flags&4){s=c;var i=t.memoizedProps;switch(t.type){case"button":case"input":case"select":case"textarea":i.autoFocus&&s.focus();break;case"img":i.src&&(s.src=i.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(t.memoizedState===null){var u=t.alternate;if(u!==null){var p=u.memoizedState;if(p!==null){var y=p.dehydrated;y!==null&&no(y)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(pe(163))}nn||t.flags&512&&wd(t)}catch(b){Tt(t,t.return,b)}}if(t===e){Ae=null;break}if(s=t.sibling,s!==null){s.return=t.return,Ae=s;break}Ae=t.return}}function Qm(e){for(;Ae!==null;){var t=Ae;if(t===e){Ae=null;break}var s=t.sibling;if(s!==null){s.return=t.return,Ae=s;break}Ae=t.return}}function Zm(e){for(;Ae!==null;){var t=Ae;try{switch(t.tag){case 0:case 11:case 15:var s=t.return;try{gi(4,t)}catch(i){Tt(t,s,i)}break;case 1:var r=t.stateNode;if(typeof r.componentDidMount=="function"){var a=t.return;try{r.componentDidMount()}catch(i){Tt(t,a,i)}}var o=t.return;try{wd(t)}catch(i){Tt(t,o,i)}break;case 5:var l=t.return;try{wd(t)}catch(i){Tt(t,l,i)}}}catch(i){Tt(t,t.return,i)}if(t===e){Ae=null;break}var c=t.sibling;if(c!==null){c.return=t.return,Ae=c;break}Ae=t.return}}var r0=Math.ceil,Vl=Is.ReactCurrentDispatcher,bu=Is.ReactCurrentOwner,_n=Is.ReactCurrentBatchConfig,at=0,Wt=null,Lt=null,Yt=0,bn=0,Vr=er(0),Bt=0,fo=null,yr=0,yi=0,vu=0,Ya=null,fn=null,Su=0,aa=1/0,xs=null,Kl=!1,kd=null,Gs=null,rl=!1,Hs=null,Yl=0,Ga=0,Ad=null,Sl=-1,wl=0;function dn(){return at&6?Ct():Sl!==-1?Sl:Sl=Ct()}function qs(e){return e.mode&1?at&2&&Yt!==0?Yt&-Yt:Hy.transition!==null?(wl===0&&(wl=Rf()),wl):(e=dt,e!==0||(e=window.event,e=e===void 0?16:Pf(e.type)),e):1}function Yn(e,t,s,r){if(50<Ga)throw Ga=0,Ad=null,Error(pe(185));ko(e,s,r),(!(at&2)||e!==Wt)&&(e===Wt&&(!(at&2)&&(yi|=s),Bt===4&&Fs(e,Yt)),yn(e,r),s===1&&at===0&&!(t.mode&1)&&(aa=Ct()+500,fi&&tr()))}function yn(e,t){var s=e.callbackNode;Hg(e,t);var r=Rl(e,e===Wt?Yt:0);if(r===0)s!==null&&im(s),e.callbackNode=null,e.callbackPriority=0;else if(t=r&-r,e.callbackPriority!==t){if(s!=null&&im(s),t===1)e.tag===0?$y(ep.bind(null,e)):nx(ep.bind(null,e)),My(function(){!(at&6)&&tr()}),s=null;else{switch(Cf(r)){case 1:s=Gd;break;case 4:s=If;break;case 16:s=Tl;break;case 536870912:s=Tf;break;default:s=Tl}s=eh(s,Yx.bind(null,e))}e.callbackPriority=t,e.callbackNode=s}}function Yx(e,t){if(Sl=-1,wl=0,at&6)throw Error(pe(327));var s=e.callbackNode;if(Jr()&&e.callbackNode!==s)return null;var r=Rl(e,e===Wt?Yt:0);if(r===0)return null;if(r&30||r&e.expiredLanes||t)t=Gl(e,r);else{t=r;var a=at;at|=2;var o=qx();(Wt!==e||Yt!==t)&&(xs=null,aa=Ct()+500,mr(e,t));do try{l0();break}catch(c){Gx(e,c)}while(!0);lu(),Vl.current=o,at=a,Lt!==null?t=0:(Wt=null,Yt=0,t=Bt)}if(t!==0){if(t===2&&(a=ed(e),a!==0&&(r=a,t=Id(e,a))),t===1)throw s=fo,mr(e,0),Fs(e,r),yn(e,Ct()),s;if(t===6)Fs(e,r);else{if(a=e.current.alternate,!(r&30)&&!a0(a)&&(t=Gl(e,r),t===2&&(o=ed(e),o!==0&&(r=o,t=Id(e,o))),t===1))throw s=fo,mr(e,0),Fs(e,r),yn(e,Ct()),s;switch(e.finishedWork=a,e.finishedLanes=r,t){case 0:case 1:throw Error(pe(345));case 2:or(e,fn,xs);break;case 3:if(Fs(e,r),(r&130023424)===r&&(t=Su+500-Ct(),10<t)){if(Rl(e,0)!==0)break;if(a=e.suspendedLanes,(a&r)!==r){dn(),e.pingedLanes|=e.suspendedLanes&a;break}e.timeoutHandle=id(or.bind(null,e,fn,xs),t);break}or(e,fn,xs);break;case 4:if(Fs(e,r),(r&4194240)===r)break;for(t=e.eventTimes,a=-1;0<r;){var l=31-Kn(r);o=1<<l,l=t[l],l>a&&(a=l),r&=~o}if(r=a,r=Ct()-r,r=(120>r?120:480>r?480:1080>r?1080:1920>r?1920:3e3>r?3e3:4320>r?4320:1960*r0(r/1960))-r,10<r){e.timeoutHandle=id(or.bind(null,e,fn,xs),r);break}or(e,fn,xs);break;case 5:or(e,fn,xs);break;default:throw Error(pe(329))}}}return yn(e,Ct()),e.callbackNode===s?Yx.bind(null,e):null}function Id(e,t){var s=Ya;return e.current.memoizedState.isDehydrated&&(mr(e,t).flags|=256),e=Gl(e,t),e!==2&&(t=fn,fn=s,t!==null&&Td(t)),e}function Td(e){fn===null?fn=e:fn.push.apply(fn,e)}function a0(e){for(var t=e;;){if(t.flags&16384){var s=t.updateQueue;if(s!==null&&(s=s.stores,s!==null))for(var r=0;r<s.length;r++){var a=s[r],o=a.getSnapshot;a=a.value;try{if(!qn(o(),a))return!1}catch{return!1}}}if(s=t.child,t.subtreeFlags&16384&&s!==null)s.return=t,t=s;else{if(t===e)break;for(;t.sibling===null;){if(t.return===null||t.return===e)return!0;t=t.return}t.sibling.return=t.return,t=t.sibling}}return!0}function Fs(e,t){for(t&=~vu,t&=~yi,e.suspendedLanes|=t,e.pingedLanes&=~t,e=e.expirationTimes;0<t;){var s=31-Kn(t),r=1<<s;e[s]=-1,t&=~r}}function ep(e){if(at&6)throw Error(pe(327));Jr();var t=Rl(e,0);if(!(t&1))return yn(e,Ct()),null;var s=Gl(e,t);if(e.tag!==0&&s===2){var r=ed(e);r!==0&&(t=r,s=Id(e,r))}if(s===1)throw s=fo,mr(e,0),Fs(e,t),yn(e,Ct()),s;if(s===6)throw Error(pe(345));return e.finishedWork=e.current.alternate,e.finishedLanes=t,or(e,fn,xs),yn(e,Ct()),null}function wu(e,t){var s=at;at|=1;try{return e(t)}finally{at=s,at===0&&(aa=Ct()+500,fi&&tr())}}function Nr(e){Hs!==null&&Hs.tag===0&&!(at&6)&&Jr();var t=at;at|=1;var s=_n.transition,r=dt;try{if(_n.transition=null,dt=1,e)return e()}finally{dt=r,_n.transition=s,at=t,!(at&6)&&tr()}}function ju(){bn=Vr.current,bt(Vr)}function mr(e,t){e.finishedWork=null,e.finishedLanes=0;var s=e.timeoutHandle;if(s!==-1&&(e.timeoutHandle=-1,Oy(s)),Lt!==null)for(s=Lt.return;s!==null;){var r=s;switch(ru(r),r.tag){case 1:r=r.type.childContextTypes,r!=null&&Ol();break;case 3:sa(),bt(hn),bt(rn),pu();break;case 5:mu(r);break;case 4:sa();break;case 13:bt(jt);break;case 19:bt(jt);break;case 10:iu(r.type._context);break;case 22:case 23:ju()}s=s.return}if(Wt=e,Lt=e=Xs(e.current,null),Yt=bn=t,Bt=0,fo=null,vu=yi=yr=0,fn=Ya=null,dr!==null){for(t=0;t<dr.length;t++)if(s=dr[t],r=s.interleaved,r!==null){s.interleaved=null;var a=r.next,o=s.pending;if(o!==null){var l=o.next;o.next=a,r.next=l}s.pending=r}dr=null}return e}function Gx(e,t){do{var s=Lt;try{if(lu(),Nl.current=zl,Wl){for(var r=Et.memoizedState;r!==null;){var a=r.queue;a!==null&&(a.pending=null),r=r.next}Wl=!1}if(gr=0,Ut=Pt=Et=null,Va=!1,uo=0,bu.current=null,s===null||s.return===null){Bt=1,fo=t,Lt=null;break}e:{var o=e,l=s.return,c=s,i=t;if(t=Yt,c.flags|=32768,i!==null&&typeof i=="object"&&typeof i.then=="function"){var u=i,p=c,y=p.tag;if(!(p.mode&1)&&(y===0||y===11||y===15)){var b=p.alternate;b?(p.updateQueue=b.updateQueue,p.memoizedState=b.memoizedState,p.lanes=b.lanes):(p.updateQueue=null,p.memoizedState=null)}var w=Hm(l);if(w!==null){w.flags&=-257,Um(w,l,c,o,t),w.mode&1&&$m(o,u,t),t=w,i=u;var R=t.updateQueue;if(R===null){var E=new Set;E.add(i),t.updateQueue=E}else R.add(i);break e}else{if(!(t&1)){$m(o,u,t),Eu();break e}i=Error(pe(426))}}else if(vt&&c.mode&1){var W=Hm(l);if(W!==null){!(W.flags&65536)&&(W.flags|=256),Um(W,l,c,o,t),au(ra(i,c));break e}}o=i=ra(i,c),Bt!==4&&(Bt=2),Ya===null?Ya=[o]:Ya.push(o),o=l;do{switch(o.tag){case 3:o.flags|=65536,t&=-t,o.lanes|=t;var N=Cx(o,i,t);_m(o,N);break e;case 1:c=i;var h=o.type,S=o.stateNode;if(!(o.flags&128)&&(typeof h.getDerivedStateFromError=="function"||S!==null&&typeof S.componentDidCatch=="function"&&(Gs===null||!Gs.has(S)))){o.flags|=65536,t&=-t,o.lanes|=t;var M=Dx(o,c,t);_m(o,M);break e}}o=o.return}while(o!==null)}Jx(s)}catch(H){t=H,Lt===s&&s!==null&&(Lt=s=s.return);continue}break}while(!0)}function qx(){var e=Vl.current;return Vl.current=zl,e===null?zl:e}function Eu(){(Bt===0||Bt===3||Bt===2)&&(Bt=4),Wt===null||!(yr&268435455)&&!(yi&268435455)||Fs(Wt,Yt)}function Gl(e,t){var s=at;at|=2;var r=qx();(Wt!==e||Yt!==t)&&(xs=null,mr(e,t));do try{o0();break}catch(a){Gx(e,a)}while(!0);if(lu(),at=s,Vl.current=r,Lt!==null)throw Error(pe(261));return Wt=null,Yt=0,Bt}function o0(){for(;Lt!==null;)Xx(Lt)}function l0(){for(;Lt!==null&&!Dg();)Xx(Lt)}function Xx(e){var t=Zx(e.alternate,e,bn);e.memoizedProps=e.pendingProps,t===null?Jx(e):Lt=t,bu.current=null}function Jx(e){var t=e;do{var s=t.alternate;if(e=t.return,t.flags&32768){if(s=e0(s,t),s!==null){s.flags&=32767,Lt=s;return}if(e!==null)e.flags|=32768,e.subtreeFlags=0,e.deletions=null;else{Bt=6,Lt=null;return}}else if(s=Zy(s,t,bn),s!==null){Lt=s;return}if(t=t.sibling,t!==null){Lt=t;return}Lt=t=e}while(t!==null);Bt===0&&(Bt=5)}function or(e,t,s){var r=dt,a=_n.transition;try{_n.transition=null,dt=1,i0(e,t,s,r)}finally{_n.transition=a,dt=r}return null}function i0(e,t,s,r){do Jr();while(Hs!==null);if(at&6)throw Error(pe(327));s=e.finishedWork;var a=e.finishedLanes;if(s===null)return null;if(e.finishedWork=null,e.finishedLanes=0,s===e.current)throw Error(pe(177));e.callbackNode=null,e.callbackPriority=0;var o=s.lanes|s.childLanes;if(Ug(e,o),e===Wt&&(Lt=Wt=null,Yt=0),!(s.subtreeFlags&2064)&&!(s.flags&2064)||rl||(rl=!0,eh(Tl,function(){return Jr(),null})),o=(s.flags&15990)!==0,s.subtreeFlags&15990||o){o=_n.transition,_n.transition=null;var l=dt;dt=1;var c=at;at|=4,bu.current=null,n0(e,s),Vx(s,e),Iy(od),Cl=!!ad,od=ad=null,e.current=s,s0(s),Lg(),at=c,dt=l,_n.transition=o}else e.current=s;if(rl&&(rl=!1,Hs=e,Yl=a),o=e.pendingLanes,o===0&&(Gs=null),Mg(s.stateNode),yn(e,Ct()),t!==null)for(r=e.onRecoverableError,s=0;s<t.length;s++)a=t[s],r(a.value,{componentStack:a.stack,digest:a.digest});if(Kl)throw Kl=!1,e=kd,kd=null,e;return Yl&1&&e.tag!==0&&Jr(),o=e.pendingLanes,o&1?e===Ad?Ga++:(Ga=0,Ad=e):Ga=0,tr(),null}function Jr(){if(Hs!==null){var e=Cf(Yl),t=_n.transition,s=dt;try{if(_n.transition=null,dt=16>e?16:e,Hs===null)var r=!1;else{if(e=Hs,Hs=null,Yl=0,at&6)throw Error(pe(331));var a=at;for(at|=4,Ae=e.current;Ae!==null;){var o=Ae,l=o.child;if(Ae.flags&16){var c=o.deletions;if(c!==null){for(var i=0;i<c.length;i++){var u=c[i];for(Ae=u;Ae!==null;){var p=Ae;switch(p.tag){case 0:case 11:case 15:Ka(8,p,o)}var y=p.child;if(y!==null)y.return=p,Ae=y;else for(;Ae!==null;){p=Ae;var b=p.sibling,w=p.return;if(Ux(p),p===u){Ae=null;break}if(b!==null){b.return=w,Ae=b;break}Ae=w}}}var R=o.alternate;if(R!==null){var E=R.child;if(E!==null){R.child=null;do{var W=E.sibling;E.sibling=null,E=W}while(E!==null)}}Ae=o}}if(o.subtreeFlags&2064&&l!==null)l.return=o,Ae=l;else e:for(;Ae!==null;){if(o=Ae,o.flags&2048)switch(o.tag){case 0:case 11:case 15:Ka(9,o,o.return)}var N=o.sibling;if(N!==null){N.return=o.return,Ae=N;break e}Ae=o.return}}var h=e.current;for(Ae=h;Ae!==null;){l=Ae;var S=l.child;if(l.subtreeFlags&2064&&S!==null)S.return=l,Ae=S;else e:for(l=h;Ae!==null;){if(c=Ae,c.flags&2048)try{switch(c.tag){case 0:case 11:case 15:gi(9,c)}}catch(H){Tt(c,c.return,H)}if(c===l){Ae=null;break e}var M=c.sibling;if(M!==null){M.return=c.return,Ae=M;break e}Ae=c.return}}if(at=a,tr(),cs&&typeof cs.onPostCommitFiberRoot=="function")try{cs.onPostCommitFiberRoot(ci,e)}catch{}r=!0}return r}finally{dt=s,_n.transition=t}}return!1}function tp(e,t,s){t=ra(s,t),t=Cx(e,t,1),e=Ys(e,t,1),t=dn(),e!==null&&(ko(e,1,t),yn(e,t))}function Tt(e,t,s){if(e.tag===3)tp(e,e,s);else for(;t!==null;){if(t.tag===3){tp(t,e,s);break}else if(t.tag===1){var r=t.stateNode;if(typeof t.type.getDerivedStateFromError=="function"||typeof r.componentDidCatch=="function"&&(Gs===null||!Gs.has(r))){e=ra(s,e),e=Dx(t,e,1),t=Ys(t,e,1),e=dn(),t!==null&&(ko(t,1,e),yn(t,e));break}}t=t.return}}function c0(e,t,s){var r=e.pingCache;r!==null&&r.delete(t),t=dn(),e.pingedLanes|=e.suspendedLanes&s,Wt===e&&(Yt&s)===s&&(Bt===4||Bt===3&&(Yt&130023424)===Yt&&500>Ct()-Su?mr(e,0):vu|=s),yn(e,t)}function Qx(e,t){t===0&&(e.mode&1?(t=Go,Go<<=1,!(Go&130023424)&&(Go=4194304)):t=1);var s=dn();e=ks(e,t),e!==null&&(ko(e,t,s),yn(e,s))}function d0(e){var t=e.memoizedState,s=0;t!==null&&(s=t.retryLane),Qx(e,s)}function u0(e,t){var s=0;switch(e.tag){case 13:var r=e.stateNode,a=e.memoizedState;a!==null&&(s=a.retryLane);break;case 19:r=e.stateNode;break;default:throw Error(pe(314))}r!==null&&r.delete(t),Qx(e,s)}var Zx;Zx=function(e,t,s){if(e!==null)if(e.memoizedProps!==t.pendingProps||hn.current)xn=!0;else{if(!(e.lanes&s)&&!(t.flags&128))return xn=!1,Qy(e,t,s);xn=!!(e.flags&131072)}else xn=!1,vt&&t.flags&1048576&&sx(t,Fl,t.index);switch(t.lanes=0,t.tag){case 2:var r=t.type;vl(e,t),e=t.pendingProps;var a=ea(t,rn.current);Xr(t,s),a=xu(null,t,r,e,a,s);var o=hu();return t.flags|=1,typeof a=="object"&&a!==null&&typeof a.render=="function"&&a.$$typeof===void 0?(t.tag=1,t.memoizedState=null,t.updateQueue=null,gn(r)?(o=!0,Ml(t)):o=!1,t.memoizedState=a.state!==null&&a.state!==void 0?a.state:null,du(t),a.updater=hi,t.stateNode=a,a._reactInternals=t,xd(t,r,e,s),t=yd(null,t,r,!0,o,s)):(t.tag=0,vt&&o&&su(t),cn(null,t,a,s),t=t.child),t;case 16:r=t.elementType;e:{switch(vl(e,t),e=t.pendingProps,a=r._init,r=a(r._payload),t.type=r,a=t.tag=p0(r),e=Wn(r,e),a){case 0:t=gd(null,t,r,e,s);break e;case 1:t=Vm(null,t,r,e,s);break e;case 11:t=Wm(null,t,r,e,s);break e;case 14:t=zm(null,t,r,Wn(r.type,e),s);break e}throw Error(pe(306,r,""))}return t;case 0:return r=t.type,a=t.pendingProps,a=t.elementType===r?a:Wn(r,a),gd(e,t,r,a,s);case 1:return r=t.type,a=t.pendingProps,a=t.elementType===r?a:Wn(r,a),Vm(e,t,r,a,s);case 3:e:{if(Mx(t),e===null)throw Error(pe(387));r=t.pendingProps,o=t.memoizedState,a=o.element,cx(e,t),Hl(t,r,null,s);var l=t.memoizedState;if(r=l.element,o.isDehydrated)if(o={element:r,isDehydrated:!1,cache:l.cache,pendingSuspenseBoundaries:l.pendingSuspenseBoundaries,transitions:l.transitions},t.updateQueue.baseState=o,t.memoizedState=o,t.flags&256){a=ra(Error(pe(423)),t),t=Km(e,t,r,s,a);break e}else if(r!==a){a=ra(Error(pe(424)),t),t=Km(e,t,r,s,a);break e}else for(Sn=Ks(t.stateNode.containerInfo.firstChild),wn=t,vt=!0,Vn=null,s=lx(t,null,r,s),t.child=s;s;)s.flags=s.flags&-3|4096,s=s.sibling;else{if(ta(),r===a){t=As(e,t,s);break e}cn(e,t,r,s)}t=t.child}return t;case 5:return dx(t),e===null&&md(t),r=t.type,a=t.pendingProps,o=e!==null?e.memoizedProps:null,l=a.children,ld(r,a)?l=null:o!==null&&ld(r,o)&&(t.flags|=32),Ox(e,t),cn(e,t,l,s),t.child;case 6:return e===null&&md(t),null;case 13:return Px(e,t,s);case 4:return uu(t,t.stateNode.containerInfo),r=t.pendingProps,e===null?t.child=na(t,null,r,s):cn(e,t,r,s),t.child;case 11:return r=t.type,a=t.pendingProps,a=t.elementType===r?a:Wn(r,a),Wm(e,t,r,a,s);case 7:return cn(e,t,t.pendingProps,s),t.child;case 8:return cn(e,t,t.pendingProps.children,s),t.child;case 12:return cn(e,t,t.pendingProps.children,s),t.child;case 10:e:{if(r=t.type._context,a=t.pendingProps,o=t.memoizedProps,l=a.value,xt(Bl,r._currentValue),r._currentValue=l,o!==null)if(qn(o.value,l)){if(o.children===a.children&&!hn.current){t=As(e,t,s);break e}}else for(o=t.child,o!==null&&(o.return=t);o!==null;){var c=o.dependencies;if(c!==null){l=o.child;for(var i=c.firstContext;i!==null;){if(i.context===r){if(o.tag===1){i=vs(-1,s&-s),i.tag=2;var u=o.updateQueue;if(u!==null){u=u.shared;var p=u.pending;p===null?i.next=i:(i.next=p.next,p.next=i),u.pending=i}}o.lanes|=s,i=o.alternate,i!==null&&(i.lanes|=s),pd(o.return,s,t),c.lanes|=s;break}i=i.next}}else if(o.tag===10)l=o.type===t.type?null:o.child;else if(o.tag===18){if(l=o.return,l===null)throw Error(pe(341));l.lanes|=s,c=l.alternate,c!==null&&(c.lanes|=s),pd(l,s,t),l=o.sibling}else l=o.child;if(l!==null)l.return=o;else for(l=o;l!==null;){if(l===t){l=null;break}if(o=l.sibling,o!==null){o.return=l.return,l=o;break}l=l.return}o=l}cn(e,t,a.children,s),t=t.child}return t;case 9:return a=t.type,r=t.pendingProps.children,Xr(t,s),a=Mn(a),r=r(a),t.flags|=1,cn(e,t,r,s),t.child;case 14:return r=t.type,a=Wn(r,t.pendingProps),a=Wn(r.type,a),zm(e,t,r,a,s);case 15:return Lx(e,t,t.type,t.pendingProps,s);case 17:return r=t.type,a=t.pendingProps,a=t.elementType===r?a:Wn(r,a),vl(e,t),t.tag=1,gn(r)?(e=!0,Ml(t)):e=!1,Xr(t,s),Rx(t,r,a),xd(t,r,a,s),yd(null,t,r,!0,e,s);case 19:return Fx(e,t,s);case 22:return _x(e,t,s)}throw Error(pe(156,t.tag))};function eh(e,t){return Af(e,t)}function m0(e,t,s,r){this.tag=e,this.key=s,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=t,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=r,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Ln(e,t,s,r){return new m0(e,t,s,r)}function ku(e){return e=e.prototype,!(!e||!e.isReactComponent)}function p0(e){if(typeof e=="function")return ku(e)?1:0;if(e!=null){if(e=e.$$typeof,e===Vd)return 11;if(e===Kd)return 14}return 2}function Xs(e,t){var s=e.alternate;return s===null?(s=Ln(e.tag,t,e.key,e.mode),s.elementType=e.elementType,s.type=e.type,s.stateNode=e.stateNode,s.alternate=e,e.alternate=s):(s.pendingProps=t,s.type=e.type,s.flags=0,s.subtreeFlags=0,s.deletions=null),s.flags=e.flags&14680064,s.childLanes=e.childLanes,s.lanes=e.lanes,s.child=e.child,s.memoizedProps=e.memoizedProps,s.memoizedState=e.memoizedState,s.updateQueue=e.updateQueue,t=e.dependencies,s.dependencies=t===null?null:{lanes:t.lanes,firstContext:t.firstContext},s.sibling=e.sibling,s.index=e.index,s.ref=e.ref,s}function jl(e,t,s,r,a,o){var l=2;if(r=e,typeof e=="function")ku(e)&&(l=1);else if(typeof e=="string")l=5;else e:switch(e){case Or:return pr(s.children,a,o,t);case zd:l=8,a|=8;break;case Bc:return e=Ln(12,s,t,a|2),e.elementType=Bc,e.lanes=o,e;case $c:return e=Ln(13,s,t,a),e.elementType=$c,e.lanes=o,e;case Hc:return e=Ln(19,s,t,a),e.elementType=Hc,e.lanes=o,e;case df:return Ni(s,a,o,t);default:if(typeof e=="object"&&e!==null)switch(e.$$typeof){case lf:l=10;break e;case cf:l=9;break e;case Vd:l=11;break e;case Kd:l=14;break e;case Ls:l=16,r=null;break e}throw Error(pe(130,e==null?e:typeof e,""))}return t=Ln(l,s,t,a),t.elementType=e,t.type=r,t.lanes=o,t}function pr(e,t,s,r){return e=Ln(7,e,r,t),e.lanes=s,e}function Ni(e,t,s,r){return e=Ln(22,e,r,t),e.elementType=df,e.lanes=s,e.stateNode={isHidden:!1},e}function bc(e,t,s){return e=Ln(6,e,null,t),e.lanes=s,e}function vc(e,t,s){return t=Ln(4,e.children!==null?e.children:[],e.key,t),t.lanes=s,t.stateNode={containerInfo:e.containerInfo,pendingChildren:null,implementation:e.implementation},t}function f0(e,t,s,r,a){this.tag=t,this.containerInfo=e,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=tc(0),this.expirationTimes=tc(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=tc(0),this.identifierPrefix=r,this.onRecoverableError=a,this.mutableSourceEagerHydrationData=null}function Au(e,t,s,r,a,o,l,c,i){return e=new f0(e,t,s,c,i),t===1?(t=1,o===!0&&(t|=8)):t=0,o=Ln(3,null,null,t),e.current=o,o.stateNode=e,o.memoizedState={element:r,isDehydrated:s,cache:null,transitions:null,pendingSuspenseBoundaries:null},du(o),e}function x0(e,t,s){var r=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:_r,key:r==null?null:""+r,children:e,containerInfo:t,implementation:s}}function th(e){if(!e)return Qs;e=e._reactInternals;e:{if(Sr(e)!==e||e.tag!==1)throw Error(pe(170));var t=e;do{switch(t.tag){case 3:t=t.stateNode.context;break e;case 1:if(gn(t.type)){t=t.stateNode.__reactInternalMemoizedMergedChildContext;break e}}t=t.return}while(t!==null);throw Error(pe(171))}if(e.tag===1){var s=e.type;if(gn(s))return tx(e,s,t)}return t}function nh(e,t,s,r,a,o,l,c,i){return e=Au(s,r,!0,e,a,o,l,c,i),e.context=th(null),s=e.current,r=dn(),a=qs(s),o=vs(r,a),o.callback=t??null,Ys(s,o,a),e.current.lanes=a,ko(e,a,r),yn(e,r),e}function bi(e,t,s,r){var a=t.current,o=dn(),l=qs(a);return s=th(s),t.context===null?t.context=s:t.pendingContext=s,t=vs(o,l),t.payload={element:e},r=r===void 0?null:r,r!==null&&(t.callback=r),e=Ys(a,t,l),e!==null&&(Yn(e,a,l,o),yl(e,a,l)),l}function ql(e){if(e=e.current,!e.child)return null;switch(e.child.tag){case 5:return e.child.stateNode;default:return e.child.stateNode}}function np(e,t){if(e=e.memoizedState,e!==null&&e.dehydrated!==null){var s=e.retryLane;e.retryLane=s!==0&&s<t?s:t}}function Iu(e,t){np(e,t),(e=e.alternate)&&np(e,t)}function h0(){return null}var sh=typeof reportError=="function"?reportError:function(e){console.error(e)};function Tu(e){this._internalRoot=e}vi.prototype.render=Tu.prototype.render=function(e){var t=this._internalRoot;if(t===null)throw Error(pe(409));bi(e,t,null,null)};vi.prototype.unmount=Tu.prototype.unmount=function(){var e=this._internalRoot;if(e!==null){this._internalRoot=null;var t=e.containerInfo;Nr(function(){bi(null,e,null,null)}),t[Es]=null}};function vi(e){this._internalRoot=e}vi.prototype.unstable_scheduleHydration=function(e){if(e){var t=_f();e={blockedOn:null,target:e,priority:t};for(var s=0;s<Ps.length&&t!==0&&t<Ps[s].priority;s++);Ps.splice(s,0,e),s===0&&Mf(e)}};function Ru(e){return!(!e||e.nodeType!==1&&e.nodeType!==9&&e.nodeType!==11)}function Si(e){return!(!e||e.nodeType!==1&&e.nodeType!==9&&e.nodeType!==11&&(e.nodeType!==8||e.nodeValue!==" react-mount-point-unstable "))}function sp(){}function g0(e,t,s,r,a){if(a){if(typeof r=="function"){var o=r;r=function(){var u=ql(l);o.call(u)}}var l=nh(t,r,e,0,null,!1,!1,"",sp);return e._reactRootContainer=l,e[Es]=l.current,ao(e.nodeType===8?e.parentNode:e),Nr(),l}for(;a=e.lastChild;)e.removeChild(a);if(typeof r=="function"){var c=r;r=function(){var u=ql(i);c.call(u)}}var i=Au(e,0,!1,null,null,!1,!1,"",sp);return e._reactRootContainer=i,e[Es]=i.current,ao(e.nodeType===8?e.parentNode:e),Nr(function(){bi(t,i,s,r)}),i}function wi(e,t,s,r,a){var o=s._reactRootContainer;if(o){var l=o;if(typeof a=="function"){var c=a;a=function(){var i=ql(l);c.call(i)}}bi(t,l,e,a)}else l=g0(s,t,e,a,r);return ql(l)}Df=function(e){switch(e.tag){case 3:var t=e.stateNode;if(t.current.memoizedState.isDehydrated){var s=Fa(t.pendingLanes);s!==0&&(qd(t,s|1),yn(t,Ct()),!(at&6)&&(aa=Ct()+500,tr()))}break;case 13:Nr(function(){var r=ks(e,1);if(r!==null){var a=dn();Yn(r,e,1,a)}}),Iu(e,1)}};Xd=function(e){if(e.tag===13){var t=ks(e,134217728);if(t!==null){var s=dn();Yn(t,e,134217728,s)}Iu(e,134217728)}};Lf=function(e){if(e.tag===13){var t=qs(e),s=ks(e,t);if(s!==null){var r=dn();Yn(s,e,t,r)}Iu(e,t)}};_f=function(){return dt};Of=function(e,t){var s=dt;try{return dt=e,t()}finally{dt=s}};Jc=function(e,t,s){switch(t){case"input":if(zc(e,s),t=s.name,s.type==="radio"&&t!=null){for(s=e;s.parentNode;)s=s.parentNode;for(s=s.querySelectorAll("input[name="+JSON.stringify(""+t)+'][type="radio"]'),t=0;t<s.length;t++){var r=s[t];if(r!==e&&r.form===e.form){var a=pi(r);if(!a)throw Error(pe(90));mf(r),zc(r,a)}}}break;case"textarea":ff(e,s);break;case"select":t=s.value,t!=null&&Kr(e,!!s.multiple,t,!1)}};vf=wu;Sf=Nr;var y0={usingClientEntryPoint:!1,Events:[Io,Br,pi,Nf,bf,wu]},Da={findFiberByHostInstance:cr,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},N0={bundleType:Da.bundleType,version:Da.version,rendererPackageName:Da.rendererPackageName,rendererConfig:Da.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:Is.ReactCurrentDispatcher,findHostInstanceByFiber:function(e){return e=Ef(e),e===null?null:e.stateNode},findFiberByHostInstance:Da.findFiberByHostInstance||h0,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var al=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!al.isDisabled&&al.supportsFiber)try{ci=al.inject(N0),cs=al}catch{}}En.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=y0;En.createPortal=function(e,t){var s=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!Ru(t))throw Error(pe(200));return x0(e,t,null,s)};En.createRoot=function(e,t){if(!Ru(e))throw Error(pe(299));var s=!1,r="",a=sh;return t!=null&&(t.unstable_strictMode===!0&&(s=!0),t.identifierPrefix!==void 0&&(r=t.identifierPrefix),t.onRecoverableError!==void 0&&(a=t.onRecoverableError)),t=Au(e,1,!1,null,null,s,!1,r,a),e[Es]=t.current,ao(e.nodeType===8?e.parentNode:e),new Tu(t)};En.findDOMNode=function(e){if(e==null)return null;if(e.nodeType===1)return e;var t=e._reactInternals;if(t===void 0)throw typeof e.render=="function"?Error(pe(188)):(e=Object.keys(e).join(","),Error(pe(268,e)));return e=Ef(t),e=e===null?null:e.stateNode,e};En.flushSync=function(e){return Nr(e)};En.hydrate=function(e,t,s){if(!Si(t))throw Error(pe(200));return wi(null,e,t,!0,s)};En.hydrateRoot=function(e,t,s){if(!Ru(e))throw Error(pe(405));var r=s!=null&&s.hydratedSources||null,a=!1,o="",l=sh;if(s!=null&&(s.unstable_strictMode===!0&&(a=!0),s.identifierPrefix!==void 0&&(o=s.identifierPrefix),s.onRecoverableError!==void 0&&(l=s.onRecoverableError)),t=nh(t,null,e,1,s??null,a,!1,o,l),e[Es]=t.current,ao(e),r)for(e=0;e<r.length;e++)s=r[e],a=s._getVersion,a=a(s._source),t.mutableSourceEagerHydrationData==null?t.mutableSourceEagerHydrationData=[s,a]:t.mutableSourceEagerHydrationData.push(s,a);return new vi(t)};En.render=function(e,t,s){if(!Si(t))throw Error(pe(200));return wi(null,e,t,!1,s)};En.unmountComponentAtNode=function(e){if(!Si(e))throw Error(pe(40));return e._reactRootContainer?(Nr(function(){wi(null,null,e,!1,function(){e._reactRootContainer=null,e[Es]=null})}),!0):!1};En.unstable_batchedUpdates=wu;En.unstable_renderSubtreeIntoContainer=function(e,t,s,r){if(!Si(s))throw Error(pe(200));if(e==null||e._reactInternals===void 0)throw Error(pe(38));return wi(e,t,s,!1,r)};En.version="18.3.1-next-f1338f8080-20240426";function rh(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(rh)}catch(e){console.error(e)}}rh(),sf.exports=En;var b0=sf.exports,rp=b0;Pc.createRoot=rp.createRoot,Pc.hydrateRoot=rp.hydrateRoot;/**
 * @license
 * (c) Copyright 2023 Grammarly, Inc.
 * 
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 * 
 *     http://www.apache.org/licenses/LICENSE-2.0
 * 
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ol(e,t,s){return t in e?Object.defineProperty(e,t,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[t]=s,e}var ap=new Map;class xo extends Error{constructor(t,s){super(),ol(this,"args",void 0),ol(this,"code",void 0),ol(this,"url",void 0),ol(this,"_c",void 0);var r=new URL("https://developer.grammarly.com/docs/error-explainer");r.searchParams.set("code",t.toString()),s.forEach(a=>r.searchParams.append("args",function(o){if(o instanceof Error)return o.message+`
`+String(o.stack);if(o==null)return"null";if(typeof o=="object")try{return Object.prototype.toString.call(o)}catch{}return String(o)}(a))),this.stack!=null&&r.searchParams.set("trace",this.stack),this.message="Minified error #".concat(t,": See ").concat(r.toString()," for details."),this.args=s,this.code=t,this.url=r.toString()}toUserMessage(){var t=ap.get("".concat(this.code));if(t==null)return[this];var s=new Map(this.args.map((a,o)=>["${".concat(o,"}"),a])),r=t.split(/(\${\d+})/).filter(a=>a!=="");return r.map(a=>{var o;return(o=s.get(a))!==null&&o!==void 0?o:a})}toJSON(){return{name:"InvariantError",message:this.message,description:this._m,code:this.code,args:this.args,stack:this.stack}}static setMessages(t){ap=t}static create(t,s,r,a){a!=null&&s.push(a);var o=new xo(t,s,r);return o.stack=a==null?void 0:a.stack,o._m=r,o}}const op=new WeakMap;async function v0(e,t){const s=op.get(e);if(s!=null)return await s;(function(a){a.Grammarly==null&&(a.Grammarly={})})(e);const r=new Promise((a,o)=>{try{let c=function(i,u){return i.document.querySelectorAll(`script[src^="${u.replace(/\?.*$/,"")}"]`)[0]}(e,t);c!=null?l():(c=function(i,u){const p=i.document.createElement("script");return p.src=u,i.document.head.appendChild(p),p}(e,t),c.addEventListener("load",l),c.addEventListener("error",function(){try{throw new xo(23,[])}catch(i){o(i)}}))}catch(c){return o(c)}function l(){try{if(e.Grammarly==null||typeof e.Grammarly.EditorSDK!="function")throw new xo(22,[]);a(e.Grammarly)}catch(c){o(c)}}});return op.set(e,r),await r}async function lp(e,t,s,r){if(typeof window>"u"&&r===void 0)throw new xo(21,[]);const a=function(c){return c.location.origin!=="null"?c.location.origin:c.origin!=="null"?c.origin:"null"}(r??window);a==="null"&&(r??window).top!==(r??window)&&console.warn("Grammarly is not supported in IFrames with `null` origin. Consider adding `sandbox='allow-same-origin allow-scripts'` to <iframe> element.");const o=new URL("https://js.grammarly.com/grammarly-editor-sdk@2.5",a);t!=null&&o.searchParams.set("clientId",t),o.searchParams.set("packageName",e);const l=await v0(r??window,o.toString());if(t!=null)return new l.EditorSDK(t,s)}const Sc={onBeforeSuggestionCardOpen:"before-suggestion-card-open",onSuggestionCardOpen:"suggestion-card-open",onSuggestionCardClose:"suggestion-card-close",onSuggestionCardAction:"suggestion-card-action",onPluginTurnedOff:"plugin-turned-off",onPluginError:"plugin-error",onDocumentStats:"document-stats",onSessionStats:"session-stats"};/**
 * @license
 * (c) Copyright 2023 Grammarly, Inc.
 * 
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 * 
 *     http://www.apache.org/licenses/LICENSE-2.0
 * 
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const S0=ii.createContext({});function w0(e,t,s){const r=g.useCallback(a=>e==null?void 0:e(new CustomEvent("plugin-error",{detail:a})),[e]);g.useEffect(()=>{var a;typeof navigator<"u"&&(t!=null&&((a=s==null?void 0:s.current)===null||a===void 0?void 0:a.ownerDocument.defaultView)!=null&&window!==s.current.ownerDocument.defaultView?lp("@grammarly/editor-sdk-react",t,void 0,s.current.ownerDocument.defaultView).catch(r):lp("@grammarly/editor-sdk-react").catch(r))},s!=null&&t!=null?[s,t]:[])}function ip(e){return typeof e=="function"}const ho=e=>{const[t,{clientId:s,config:r,children:a,className:o,...l}]=function(E){const W={},N={...E};return Object.keys(Sc).forEach(h=>{W[h]=E[h],h in N&&delete N[h]}),[W,N]}(e),c=g.useContext(S0),i=g.useRef(),u=g.useRef(),p=g.useRef(),y=g.useCallback(E=>{i.current=E,w()},[]),b=function(E){const[W,N]=g.useState({}),h=g.useCallback(()=>{customElements.whenDefined(E).then(()=>N(S=>({...S,[E]:!0}))).catch(()=>{})},[E]);return g.useEffect(h,[h]),!!W[E]}("grammarly-editor-plugin"),w=g.useCallback(()=>{var E;i.current!=null&&u.current!=null&&b&&i.current.connect(u.current,(E=p.current)!==null&&E!==void 0?E:void 0)},[b]),R=g.useMemo(()=>({...c.config,...r}),[c.config,r]);return g.useEffect(()=>{i.current&&(i.current.config=R)},[i,R]),g.useEffect(()=>{if(i.current==null)return;const{current:E}=i,W=[];return Object.keys(Sc).forEach(N=>{const h=t[N],S=Sc[N];h!=null&&(E.addEventListener(S,h),W.push(()=>E.removeEventListener(S,h)))}),()=>W.forEach(N=>N())},[...Object.values(t),b,i.current]),w0(e.onPluginError,s??c.clientId,i),ii.createElement("grammarly-editor-plugin",{...l,ref:y,clientId:s??c.clientId,autodetect:ip(a)?"off":"on",class:o},ip(a)?a({setEditor:E=>{u.current=E,w()},setViewport:E=>{p.current=E,w()}}):a)};/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */var j0={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const E0=e=>e.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase().trim(),Je=(e,t)=>{const s=g.forwardRef(({color:r="currentColor",size:a=24,strokeWidth:o=2,absoluteStrokeWidth:l,className:c="",children:i,...u},p)=>g.createElement("svg",{ref:p,...j0,width:a,height:a,stroke:r,strokeWidth:l?Number(o)*24/Number(a):o,className:["lucide",`lucide-${E0(e)}`,c].join(" "),...u},[...t.map(([y,b])=>g.createElement(y,b)),...Array.isArray(i)?i:[i]]));return s.displayName=`${e}`,s};/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const qa=Je("AlertTriangle",[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3Z",key:"c3ski4"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ah=Je("ArrowRight",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"m12 5 7 7-7 7",key:"xquz4c"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Xl=Je("Bell",[["path",{d:"M6 8a6 6 0 0 1 12 0c0 7 3 9 3 9H3s3-2 3-9",key:"1qo2s2"}],["path",{d:"M10.3 21a1.94 1.94 0 0 0 3.4 0",key:"qgo35s"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const k0=Je("Calculator",[["rect",{width:"16",height:"20",x:"4",y:"2",rx:"2",key:"1nb95v"}],["line",{x1:"8",x2:"16",y1:"6",y2:"6",key:"x4nwl0"}],["line",{x1:"16",x2:"16",y1:"14",y2:"18",key:"wjye3r"}],["path",{d:"M16 10h.01",key:"1m94wz"}],["path",{d:"M12 10h.01",key:"1nrarc"}],["path",{d:"M8 10h.01",key:"19clt8"}],["path",{d:"M12 14h.01",key:"1etili"}],["path",{d:"M8 14h.01",key:"6423bh"}],["path",{d:"M12 18h.01",key:"mhygvu"}],["path",{d:"M8 18h.01",key:"lrp35t"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const A0=Je("Calendar",[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const oh=Je("Check",[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const I0=Je("ChevronDown",[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Jl=Je("ChevronLeft",[["path",{d:"m15 18-6-6 6-6",key:"1wnfg3"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const os=Je("ChevronRight",[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const T0=Je("ChevronUp",[["path",{d:"m18 15-6-6-6 6",key:"153udz"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const R0=Je("Clock",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polyline",{points:"12 6 12 12 16 14",key:"68esgv"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const C0=Je("FilePlus2",[["path",{d:"M4 22h14a2 2 0 0 0 2-2V7l-5-5H6a2 2 0 0 0-2 2v4",key:"1pf5j1"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M3 15h6",key:"4e2qda"}],["path",{d:"M6 12v6",key:"1u72j0"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const D0=Je("FileSpreadsheet",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M8 13h2",key:"yr2amv"}],["path",{d:"M14 13h2",key:"un5t4a"}],["path",{d:"M8 17h2",key:"2yhykz"}],["path",{d:"M14 17h2",key:"10kma7"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const go=Je("FileText",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M10 9H8",key:"b1mrlr"}],["path",{d:"M16 13H8",key:"t4e002"}],["path",{d:"M16 17H8",key:"z1uh3a"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const lh=Je("FolderOpen",[["path",{d:"m6 14 1.5-2.9A2 2 0 0 1 9.24 10H20a2 2 0 0 1 1.94 2.5l-1.54 6a2 2 0 0 1-1.95 1.5H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h3.9a2 2 0 0 1 1.69.9l.81 1.2a2 2 0 0 0 1.67.9H18a2 2 0 0 1 2 2v2",key:"usdka0"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const L0=Je("Globe",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 2a14.5 14.5 0 0 0 0 20 14.5 14.5 0 0 0 0-20",key:"13o1zl"}],["path",{d:"M2 12h20",key:"9i4pu4"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Cu=Je("HelpCircle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3",key:"1u773s"}],["path",{d:"M12 17h.01",key:"p32p05"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ih=Je("History",[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}],["path",{d:"M12 7v5l4 2",key:"1fdv2h"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Du=Je("Home",[["path",{d:"m3 9 9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z",key:"y5dka4"}],["polyline",{points:"9 22 9 12 15 12 15 22",key:"e2us08"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const _0=Je("KeyRound",[["path",{d:"M2 18v3c0 .6.4 1 1 1h4v-3h3v-3h2l1.4-1.4a6.5 6.5 0 1 0-4-4Z",key:"167ctg"}],["circle",{cx:"16.5",cy:"7.5",r:".5",fill:"currentColor",key:"w0ekpg"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const oa=Je("Lightbulb",[["path",{d:"M15 14c.2-1 .7-1.7 1.5-2.5 1-.9 1.5-2.2 1.5-3.5A6 6 0 0 0 6 8c0 1 .2 2.2 1.5 3.5.7.7 1.3 1.5 1.5 2.5",key:"1gvzjb"}],["path",{d:"M9 18h6",key:"x1upvd"}],["path",{d:"M10 22h4",key:"ceow96"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const O0=Je("ListPlus",[["path",{d:"M11 12H3",key:"51ecnj"}],["path",{d:"M16 6H3",key:"1wxfjs"}],["path",{d:"M16 18H3",key:"12xzn7"}],["path",{d:"M18 9v6",key:"1twb98"}],["path",{d:"M21 12h-6",key:"bt1uis"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Mt=Je("Loader2",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ch=Je("LogOut",[["path",{d:"M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4",key:"1uf3rs"}],["polyline",{points:"16 17 21 12 16 7",key:"1gabdz"}],["line",{x1:"21",x2:"9",y1:"12",y2:"12",key:"1uyos4"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Lu=Je("NotebookPen",[["path",{d:"M13.4 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2v-7.4",key:"re6nr2"}],["path",{d:"M2 6h4",key:"aawbzj"}],["path",{d:"M2 10h4",key:"l0bgd4"}],["path",{d:"M2 14h4",key:"1gsvsf"}],["path",{d:"M2 18h4",key:"1bu2t1"}],["path",{d:"M18.4 2.6a2.17 2.17 0 0 1 3 3L16 11l-4 1 1-4Z",key:"1dba1m"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const M0=Je("Paperclip",[["path",{d:"m21.44 11.05-9.19 9.19a6 6 0 0 1-8.49-8.49l8.57-8.57A4 4 0 1 1 18 8.84l-8.59 8.57a2 2 0 0 1-2.83-2.83l8.49-8.48",key:"1u3ebp"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const _u=Je("Plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const dh=Je("Receipt",[["path",{d:"M4 2v20l2-1 2 1 2-1 2 1 2-1 2 1 2-1 2 1V2l-2 1-2-1-2 1-2-1-2 1-2-1-2 1Z",key:"q3az6g"}],["path",{d:"M16 8h-6a2 2 0 1 0 0 4h4a2 2 0 1 1 0 4H8",key:"1h4pet"}],["path",{d:"M12 17.5v-11",key:"1jc1ny"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const P0=Je("Search",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["path",{d:"m21 21-4.3-4.3",key:"1qie3q"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ql=Je("Send",[["path",{d:"m22 2-7 20-4-9-9-4Z",key:"1q3vgg"}],["path",{d:"M22 2 11 13",key:"nzbqef"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const F0=Je("ShieldAlert",[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}],["path",{d:"M12 8v4",key:"1got3b"}],["path",{d:"M12 16h.01",key:"1drbdi"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const B0=Je("Sparkles",[["path",{d:"m12 3-1.912 5.813a2 2 0 0 1-1.275 1.275L3 12l5.813 1.912a2 2 0 0 1 1.275 1.275L12 21l1.912-5.813a2 2 0 0 1 1.275-1.275L21 12l-5.813-1.912a2 2 0 0 1-1.275-1.275L12 3Z",key:"17u4zn"}],["path",{d:"M5 3v4",key:"bklmnn"}],["path",{d:"M19 17v4",key:"iiml17"}],["path",{d:"M3 5h4",key:"nem4j1"}],["path",{d:"M17 19h4",key:"lbex7p"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $0=Je("Star",[["polygon",{points:"12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2",key:"8f66p6"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const uh=Je("Table",[["path",{d:"M12 3v18",key:"108xh3"}],["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}],["path",{d:"M3 9h18",key:"1pudct"}],["path",{d:"M3 15h18",key:"5xshup"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Bs=Je("Trash2",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const yo=Je("Upload",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"17 8 12 3 7 8",key:"t8dd8p"}],["line",{x1:"12",x2:"12",y1:"3",y2:"15",key:"widbto"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const H0=Je("UserCheck",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["polyline",{points:"16 11 18 13 22 9",key:"1pwet4"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const U0=Je("User",[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const W0=Je("Wand2",[["path",{d:"m21.64 3.64-1.28-1.28a1.21 1.21 0 0 0-1.72 0L2.36 18.64a1.21 1.21 0 0 0 0 1.72l1.28 1.28a1.2 1.2 0 0 0 1.72 0L21.64 5.36a1.2 1.2 0 0 0 0-1.72Z",key:"1bcowg"}],["path",{d:"m14 7 3 3",key:"1r5n42"}],["path",{d:"M5 6v4",key:"ilb8ba"}],["path",{d:"M19 14v4",key:"blhpug"}],["path",{d:"M10 2v2",key:"7u0qdc"}],["path",{d:"M7 8H3",key:"zfb6yr"}],["path",{d:"M21 16h-4",key:"1cnmox"}],["path",{d:"M11 3H9",key:"1obp7u"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ft=Je("X",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]]),mh=["The facts outlined in the statement of claim","Statement of Claim  Factual Summary"],Us="Factual background  Statement of Claim",ph=["Factual Summary from the Letter of Demand"],Ro="Factual background  Letter of Demand",Ou="The plaintiff's expert opinion",Mu="The claimant's expert opinion",Ss=[{id:"u1",username:"lior",password:"lior123",name:"Lior Perry",email:"lior@lp-law.co.il",role:"ADMIN"},{id:"u2",username:"lidor",password:"lidor123",name:"Lidor Kabilo",email:"Lidor@lp-law.co.il",role:"SUB_ADMIN"},{id:"u3",username:"iris",password:"iris123",name:"Iris Alfman",email:"Iris@lp-law.co.il",role:"FINANCE"},{id:"u4",username:"hava",password:"hava123",name:"Hava Kabilo",email:"Hava@lp-law.co.il",role:"LAWYER"},{id:"u5",username:"may",password:"may123",name:"May Harari",email:"May@lp-law.co.il",role:"LAWYER"},{id:"u6",username:"vlada",password:"vlada123",name:"Vlada Boltach",email:"Vlada@lp-law.co.il",role:"LAWYER"},{id:"u7",username:"orly",password:"orly123",name:"Orly Day",email:"Orly@lp-law.co.il",role:"LAWYER"}],cp=["W/R/B Underwriting","QBE Insurance Group","Market Form Underwriting","Dale Underwriting Partners","MedPro & CNA Syndicate","Hardy (Underwriting Agencies) Limited"],Lr=[Us,Ro,Ou,Mu,"The insured's expert opinion","Insurance Coverage","Risk Assessment","MPL","Strategy","Expenses breakdown","Expenses & Compensation breakdown","Recommendations","Strategy & Recommendations","Request for Approval of a Settlement Agreement"],fh=["New lawsuit","Letter of demand","New third-party notice","Caution Notice"],No="/api/templates",bo=async e=>{if(!e.ok){const s=await e.text().catch(()=>"");throw new Error(s||`Request failed with status ${e.status}`)}const t=await e.json();return Array.isArray(t)?t:[]},dp=async()=>{const e=await fetch(No);return bo(e)},up=async(e,t)=>{const s={"Content-Type":"application/json","x-user-role":t};if(!e.id){const a=await fetch(No,{method:"POST",headers:s,body:JSON.stringify(e)});return bo(a)}const r=await fetch(`${No}/${encodeURIComponent(e.id)}`,{method:"PUT",headers:s,body:JSON.stringify(e)});return bo(r)},z0=async(e,t)=>{const s=await fetch(`${No}/${encodeURIComponent(e)}`,{method:"DELETE",headers:{"x-user-role":t}});return bo(s)},V0=async(e,t,s)=>{const r=await fetch(`${No}/${encodeURIComponent(e)}/reorder`,{method:"POST",headers:{"Content-Type":"application/json","x-user-role":s},body:JSON.stringify({direction:t})});return bo(r)},Rd=async e=>{if(!e||!e.trim())return"";try{const t=await fetch("/api/translate",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({text:e})});if(!t.ok)throw new Error(`Server error: ${t.statusText}`);return(await t.json()).translation||""}catch(t){return console.error("Translation error:",t),"Error translation."}},K0=async(e,t)=>{try{const s=await fetch("/api/extract-policy",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({image:e,mimeType:t})});if(!s.ok)throw new Error("Server error");return await s.json()}catch(s){return console.error(s),{}}},Y0=async(e,t="SAFE_POLISH")=>{try{const s=await fetch("/api/refine-text",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({text:e,mode:t})}),r=await s.json().catch(()=>({}));if(s.status===422&&r&&r.error&&r.error.code==="FACT_PROTECTION_FAILED")return{text:typeof r.refined=="string"?r.refined:e,factProtectionBlocked:!0};if(!s.ok)throw new Error("Refinement failed");return{text:typeof r.refined=="string"&&r.refined.trim()?r.refined:e,factProtectionBlocked:!1}}catch(s){throw console.error("Hebrew refinement error:",s),s}},xh=async e=>{if(!e||!e.trim())return e;try{const t=await fetch("/api/improve-english",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({text:e})});if(!t.ok)throw new Error("English improvement failed");const s=await t.json(),r=typeof s.improved=="string"?s.improved:"";return r.trim()?r:e}catch(t){throw console.error("English improvement error:",t),t}},G0=async e=>{if(!e||!e.trim())return"";try{const t=await fetch("/api/hebrew-report-summary",{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({text:e})}),s=await t.json().catch(()=>({}));if(!t.ok){const a=s&&typeof s.error=="string"&&s.error||"Hebrew report summary failed";throw new Error(a)}return typeof s.summary=="string"&&s.summary.trim()?s.summary.trim():""}catch(t){throw console.error("Hebrew report summary error:",t),t instanceof Error?t:new Error("Hebrew report summary error")}},q0=async(e,t,s="CLAIM",r)=>{const a=await fetch("/api/analyze-medical-complaint",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({fileBase64:e,mimeType:t,analysisType:s,expertCountMode:r==null?void 0:r.expertCountMode,partyRole:r==null?void 0:r.partyRole,sectionKey:r==null?void 0:r.sectionKey,plaintiffName:r==null?void 0:r.plaintiffName,insuredName:r==null?void 0:r.insuredName,insurerName:r==null?void 0:r.insurerName,reportSubject:r==null?void 0:r.reportSubject})}),o=await a.json().catch(()=>({})),l=o.analysis??null,c=typeof o.claimSummary=="string"?o.claimSummary:"";return a.ok?o.success===!1?{analysis:null,claimSummary:"",success:!1,reason:o.reason}:{analysis:l,claimSummary:c,success:!0}:(console.error("Medical complaint analysis failed",a.status,o),{analysis:null,claimSummary:"",success:!1,reason:o.reason||"REQUEST_FAILED"})},X0=async(e,t)=>{const s=await fetch("/api/analyze-dental-opinion",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({fileBase64:e,mimeType:t})}),r=await s.json().catch(()=>({})),a=typeof r.result=="string"?r.result:"",o=typeof r.reason=="string"?r.reason:void 0;return s.ok?r.success===!1?{success:!1,text:"",reason:o||"AI_UNAVAILABLE"}:{success:!0,text:a}:(console.error("Dental opinion analysis failed",s.status,r),{success:!1,text:"",reason:o||"REQUEST_FAILED"})},J0=async(e,t)=>{try{const s=await fetch("/api/extract-expenses",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({fileBase64:e,mimeType:t})});if(!s.ok)throw new Error("Expenses extraction failed");return await s.json()}catch(s){return console.error(s),{items:[]}}},Q0=async e=>{try{const t=await fetch("/api/help-chat",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({question:e})});if(!t.ok)throw new Error("Chat failed");return(await t.json()).answer||"Sorry, I could not answer that."}catch(t){return console.error(t),"System error. Please try again."}},Z0=async e=>{try{const t=await fetch("/api/assistant/help",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)}),s=await t.json().catch(()=>({}));t.ok||console.error("Assistant help HTTP error:",t.status,s);const r=typeof s.title=="string"&&s.title.trim()?s.title.trim():"    ",a=Array.isArray(s.bullets)?s.bullets.filter(c=>typeof c=="string"&&c.trim().length>0):["        -AI.","       (, ,  PDF).","  ,      ."],o=typeof s.warning=="string"&&s.warning.trim()?s.warning.trim():void 0,l=typeof s.nextSuggestion=="string"&&s.nextSuggestion.trim()?s.nextSuggestion.trim():void 0;return{title:r,bullets:a,warning:o,nextSuggestion:l}}catch(t){throw console.error("Assistant help error:",t),t}},mp=async e=>{try{if(!(await fetch("/api/send-email",{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify(e)})).ok)throw new Error("Email failed");return!0}catch(t){return console.error(t),!1}},wc=async e=>{try{const t=await fetch("/api/render-report-pdf",{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({report:e})});if(!t.ok)throw new Error("PDF rendering failed");return await t.blob()}catch(t){throw console.error("PDF render error:",t),t}};async function eN(e,t){try{const s=await fetch("/api/analyze-tone-risk",{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({content:e})});let r=null;try{r=await s.json()}catch{r=null}if(!s.ok){const p=r&&r.error&&typeof r.error.message=="string"?r.error.message:"Tone & Risk analysis failed";throw new Error(p)}const a=!!(r&&r.ok),o=r&&typeof r.runAt=="string"?r.runAt:new Date().toISOString(),l=Array.isArray(r==null?void 0:r.issues)?r.issues:[],c=r&&typeof r.promptVersion=="string"?r.promptVersion:"unknown",i=r&&typeof r.meta=="object"?{sectionsSent:Number(r.meta.sectionsSent)||0,charsBefore:Number(r.meta.charsBefore)||0,charsAfter:Number(r.meta.charsAfter)||0,truncatedSections:Number(r.meta.truncatedSections)||0}:{sectionsSent:0,charsBefore:0,charsAfter:0,truncatedSections:0},u=r&&typeof r.error=="object"?{code:r.error.code,message:r.error.message}:void 0;if(!a){const p=u&&typeof u.message=="string"&&u.message||"Tone & Risk analysis failed",y=new Error(p);throw y.code=(u==null?void 0:u.code)||"LLM_FAILED",y}return{ok:!0,runAt:o,promptVersion:c,issues:l,meta:i,error:void 0}}catch(s){throw console.error("Tone & Risk analysis error:",s),s instanceof Error?s:new Error("Tone & Risk analysis error")}}async function tN(e,t){const s=await fetch("/api/review-hebrew-style",{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({content:e})}),r=await s.json().catch(()=>({})),a=Array.isArray(r.issues)?r.issues:[],o=typeof r.runAt=="string"?r.runAt:new Date().toISOString();return s.ok?r.success===!1?{runAt:o,issues:a,success:!1,reason:r.reason}:{runAt:o,issues:a,success:!0}:(console.error("Hebrew style review failed",s.status,r),{runAt:o,issues:a,success:!1,reason:r.reason||"REQUEST_FAILED"})}const la="/api/best-practices",ia=async e=>{if(!e.ok){const s=await e.text().catch(()=>"");throw new Error(s||`Request failed with status ${e.status}`)}const t=await e.json();return Array.isArray(t)?t:[]},nN=async()=>{const e=await fetch(la);return ia(e)},pp=async(e,t)=>{const s={"Content-Type":"application/json","x-user-role":t};if(!e.id){const a=await fetch(la,{method:"POST",headers:s,body:JSON.stringify(e)});return ia(a)}const r=await fetch(`${la}/${encodeURIComponent(e.id)}`,{method:"PUT",headers:s,body:JSON.stringify(e)});return ia(r)},sN=async(e,t)=>{const s=await fetch(`${la}/${encodeURIComponent(e)}`,{method:"DELETE",headers:{"x-user-role":t}});return ia(s)},rN=async(e,t,s)=>{const r=await fetch(`${la}/${encodeURIComponent(e)}`,{method:"PUT",headers:{"Content-Type":"application/json","x-user-role":s},body:JSON.stringify({isEnabled:t})});return ia(r)},fp=async(e,t,s)=>{const r=await fetch(`${la}/${encodeURIComponent(e)}/usage`,{method:"POST",headers:{"Content-Type":"application/json","x-user-role":s},body:JSON.stringify({mode:t})});return ia(r)},Pu=e=>e===Ou,Fu=e=>e===Mu,xp=e=>Pu(e)||Fu(e),aN=e=>Pu(e)||e===Us?"PLAINTIFF":Fu(e)||e===Ro?"CLAIMANT":null,hp=(e,t="SINGLE")=>`${t==="MULTIPLE"?"Expert opinions":"Expert opinion"}  ${e==="PLAINTIFF"?"Statement of Claim":"Letter of Demand"}`,Cd=(e,t)=>Pu(e)?hp("PLAINTIFF",t):Fu(e)?hp("CLAIMANT",t):e,oN=({data:e})=>{const[t,s]=g.useState(""),[r,a]=g.useState(!1),[o,l]=g.useState(null);if(g.useEffect(()=>{let i=!1;return(async()=>{a(!0),l(null);try{const p=await fetch("/api/render-report-html",{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({report:e})});if(!p.ok)throw new Error("Failed to load report HTML");const y=await p.text();i||s(y)}catch(p){console.error(p),i||l("   ")}finally{i||a(!1)}})(),()=>{i=!0}},[e]),o)return n.jsx("div",{className:"w-[210mm] min-h-[297mm] bg-panel border border-borderDark shadow-2xl mx-auto flex items-center justify-center text-sm text-red-300",children:o});if(r&&!t)return n.jsx("div",{className:"w-[210mm] min-h-[297mm] bg-panel shadow-2xl mx-auto flex flex-col items-center justify-center text-sm text-textMuted",children:n.jsx("span",{children:"  ..."})});const c=!!e.policyFile&&(e.attachPolicyAsAppendix??!0);return n.jsxs("div",{className:"space-y-2",children:[n.jsx("iframe",{title:"Report Preview",className:"w-[210mm] min-h-[297mm] bg-panel shadow-2xl mx-auto border-none print:shadow-none print:w-full",srcDoc:t}),c&&n.jsx("p",{className:"w-[210mm] mx-auto text-[11px] text-textMuted text-right",children:"The policy file will be attached as Appendix A in the final PDF (not shown in this preview)."})]})},lN=e=>{switch(e){case"HEBREW_SUBMITTED":return" ";case"HEBREW_CHANGES_REQUESTED":return" ";case"HEBREW_APPROVED":return" ";case"HEBREW_REOPENED_EXTERNAL":return"  ()";case"HEBREW_DRAFT":default:return" "}},iN=e=>{switch(e){case"SUBMITTED":return"  ";case"CHANGES_REQUESTED":return"  ";case"APPROVED":return"  ";case"DRAFT":default:return"  (  )"}},El="report-review-panel",Dd="external-feedback-panel",cN=({report:e,currentUser:t,onSubmitToAdmin:s,onApproveHebrew:r,onRequestChanges:a,onMarkIssueDone:o,onAddExternalFeedbackIssues:l,onReopenHebrewDueToExternalFeedback:c})=>{const[i,u]=g.useState(!1),[p,y]=g.useState(""),[b,w]=g.useState(""),[R,E]=g.useState("NORMAL"),[W,N]=g.useState(""),[h,S]=g.useState("INTERNAL"),[M,H]=g.useState("ENGLISH_ONLY"),V=g.useMemo(()=>{const F=e.reportReview;return F||{status:"DRAFT",issues:[]}},[e.reportReview]),q=g.useMemo(()=>{const F={};return V.issues.filter(C=>(C.origin??"INTERNAL")==="INTERNAL").forEach(C=>{const L=C.sectionKey||"GENERAL";F[L]||(F[L]=[]),F[L]=[...F[L],C]}),F},[V.issues]),te=g.useMemo(()=>{const F={};return V.issues.filter(C=>C.origin==="EXTERNAL").forEach(C=>{const L=C.sectionKey||"GENERAL";F[L]||(F[L]=[]),F[L]=[...F[L],C]}),F},[V.issues]),G=(t==null?void 0:t.role)==="LAWYER",re=(t==null?void 0:t.role)==="ADMIN",j=V.issues.some(F=>(F.origin??"INTERNAL")==="EXTERNAL"&&F.status!=="DONE"&&F.externalAction==="REQUIRES_HEBREW"),P=F=>{S(F),y(""),w(""),E("NORMAL"),N(""),H("ENGLISH_ONLY"),u(!0)},D=()=>{const F=p.trim(),C=b.trim();if(!F||!C)return;const L={title:F,instruction:C,severity:R,type:"OTHER",sectionKey:void 0,externalAction:h==="EXTERNAL"?M:void 0};h==="EXTERNAL"&&l?l([L],W.trim()||void 0):a([L]),u(!1)},O=iN(V.status),z=lN(e.hebrewWorkflowStatus);return n.jsxs("section",{id:El,className:"mt-4 rounded-xl border border-borderDark bg-navySecondary px-4 py-3",dir:"rtl",lang:"he",children:[n.jsxs("div",{className:"mb-2 flex items-center justify-between gap-3",children:[n.jsxs("div",{children:[n.jsx("div",{className:"text-xs font-semibold text-textMuted500",children:" "}),n.jsx("div",{className:"text-sm font-medium text-textLight",children:O})]}),n.jsx("span",{className:"inline-flex items-center rounded-full bg-navySecondary px-3 py-1 text-xs font-medium text-textMuted700",children:z})]}),G&&n.jsx("div",{className:"mb-3 text-xs text-amber-700",children:e.hebrewWorkflowStatus==="HEBREW_REOPENED_EXTERNAL"?"            .":V.status==="SUBMITTED"?"   .       .":V.status==="CHANGES_REQUESTED"?"   .      .":null}),re&&j&&n.jsx("div",{className:"mb-3 text-xs font-semibold text-red-700",children:"      .    ."}),V.issues.length>0&&n.jsxs("div",{className:"mb-3 space-y-3",children:[Object.keys(q).length>0&&n.jsxs("div",{children:[n.jsx("div",{className:"mb-1 text-xs font-semibold text-textMuted",children:"  ()"}),Object.entries(q).map(([F,C])=>n.jsxs("div",{className:"rounded-lg bg-panel p-2 mb-1",children:[F!=="GENERAL"&&n.jsxs("div",{className:"mb-1 text-[11px] font-semibold text-textMuted500",children:[": ",F]}),n.jsx("ul",{className:"space-y-1",children:C.map(L=>n.jsxs("li",{className:"flex items-start justify-between gap-2 rounded-md border border-borderDark bg-navySecondary px-2 py-1.5",children:[n.jsxs("div",{children:[n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsx("span",{className:`inline-flex items-center rounded-full px-2 py-0.5 text-[10px] font-semibold ${L.severity==="CRITICAL"?"bg-red-100 text-red-700":L.severity==="NORMAL"?"bg-amber-50 text-amber-700":"bg-navySecondary text-textMuted"}`,children:L.severity==="CRITICAL"?"":L.severity==="NORMAL"?"":""}),n.jsx("span",{className:"text-xs font-medium text-textLight",children:L.title})]}),n.jsx("div",{className:"mt-1 text-[11px] text-textMuted700",children:L.instruction})]}),(G||re)&&n.jsx("button",{type:"button",className:"mt-1 inline-flex items-center rounded-full border border-emerald-200 bg-emerald-50 px-2 py-0.5 text-[10px] font-medium text-emerald-700 hover:bg-emerald-100 disabled:opacity-50",disabled:L.status==="DONE",onClick:()=>o(L.id),children:L.status==="DONE"?"":" "})]},L.id))})]},F))]}),Object.keys(te).length>0&&n.jsxs("div",{id:Dd,children:[n.jsx("div",{className:"mb-1 text-xs font-semibold text-textMuted",children:"  "}),Object.entries(te).map(([F,C])=>n.jsxs("div",{className:"rounded-lg bg-panel p-2 mb-1",children:[F!=="GENERAL"&&n.jsxs("div",{className:"mb-1 text-[11px] font-semibold text-textMuted500",children:[": ",F]}),n.jsx("ul",{className:"space-y-1",children:C.map(L=>n.jsxs("li",{className:"flex items-start justify-between gap-2 rounded-md border border-borderDark bg-navySecondary px-2 py-1.5",children:[n.jsxs("div",{children:[n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsx("span",{className:`inline-flex items-center rounded-full px-2 py-0.5 text-[10px] font-semibold ${L.severity==="CRITICAL"?"bg-red-100 text-red-700":L.severity==="NORMAL"?"bg-amber-50 text-amber-700":"bg-navySecondary text-textMuted"}`,children:L.severity==="CRITICAL"?"":L.severity==="NORMAL"?"":""}),n.jsx("span",{className:"text-xs font-medium text-textLight",children:L.title})]}),n.jsx("div",{className:"mt-1 text-[11px] text-textMuted700",children:L.instruction})]}),(G||re)&&n.jsx("button",{type:"button",className:"mt-1 inline-flex items-center rounded-full border border-emerald-200 bg-emerald-50 px-2 py-0.5 text-[10px] font-medium text-emerald-700 hover:bg-emerald-100 disabled:opacity-50",disabled:L.status==="DONE",onClick:()=>o(L.id),children:L.status==="DONE"?"":" "})]},L.id))})]},F))]})]}),n.jsxs("div",{className:"mt-3 flex flex-wrap items-center gap-2",children:[G&&n.jsx("button",{type:"button",className:"rounded-md bg-sky-700 px-3 py-1.5 text-xs font-semibold text-white hover:bg-sky-800 disabled:opacity-50",onClick:s,disabled:V.status==="SUBMITTED"||V.status==="APPROVED",children:"  "}),re&&n.jsxs(n.Fragment,{children:[n.jsx("button",{type:"button",className:"rounded-md bg-emerald-700 px-3 py-1.5 text-xs font-semibold text-white hover:bg-emerald-800 disabled:opacity-50",onClick:r,children:"  "}),n.jsx("button",{type:"button",className:"rounded-md bg-amber-700 px-3 py-1.5 text-xs font-semibold text-white hover:bg-amber-800",onClick:()=>P("INTERNAL"),children:" "}),l&&n.jsx("button",{type:"button",className:"rounded-md bg-slate-700 px-3 py-1.5 text-xs font-semibold text-white hover:bg-slate-800",onClick:()=>P("EXTERNAL"),children:"   "}),c&&e.status==="SENT"&&n.jsx("button",{type:"button",className:"rounded-md bg-red-700 px-3 py-1.5 text-xs font-semibold text-white hover:bg-red-800",onClick:c,children:"   ( )"}),c&&e.status!=="SENT"&&n.jsx("span",{className:"text-[11px] text-textMuted500",children:"       (SENT)."})]})]}),i&&n.jsx("div",{className:"fixed inset-0 z-[180] flex items-center justify-center bg-black/40",children:n.jsxs("div",{className:"w-full max-w-md rounded-xl bg-panel p-4 shadow-2xl",dir:"rtl",lang:"he",children:[n.jsx("h3",{className:"mb-3 text-sm font-bold text-textLight",children:"   "}),n.jsxs("div",{className:"mb-3 space-y-2",children:[n.jsxs("div",{children:[n.jsx("label",{className:"mb-1 block text-xs font-semibold text-textMuted700",children:"  ()"}),n.jsx("input",{type:"text",className:"w-full rounded-md border border-borderDark px-2 py-1.5 text-sm",value:p,onChange:F=>y(F.target.value)})]}),n.jsxs("div",{children:[n.jsx("label",{className:"mb-1 block text-xs font-semibold text-textMuted700",children:"  ()"}),n.jsx("textarea",{className:"w-full rounded-md border border-borderDark px-2 py-1.5 text-sm",rows:3,value:b,onChange:F=>w(F.target.value)})]}),n.jsxs("div",{children:[n.jsx("label",{className:"mb-1 block text-xs font-semibold text-textMuted700",children:" "}),n.jsxs("select",{className:"w-full rounded-md border border-borderDark px-2 py-1.5 text-xs",value:R,onChange:F=>E(F.target.value),children:[n.jsx("option",{value:"NORMAL",children:""}),n.jsx("option",{value:"CRITICAL",children:""}),n.jsx("option",{value:"STYLE",children:""})]})]}),h==="EXTERNAL"&&n.jsxs("div",{children:[n.jsx("label",{className:"mb-1 block text-xs font-semibold text-textMuted700",children:"    ()"}),n.jsx("input",{type:"text",className:"w-full rounded-md border border-borderDark px-2 py-1.5 text-sm",value:W,onChange:F=>N(F.target.value)}),n.jsx("label",{className:"mb-1 mt-3 block text-xs font-semibold text-textMuted700",children:" "}),n.jsxs("select",{className:"w-full rounded-md border border-borderDark px-2 py-1.5 text-xs",value:M,onChange:F=>H(F.target.value),children:[n.jsx("option",{value:"ENGLISH_ONLY",children:"  "}),n.jsx("option",{value:"REQUIRES_HEBREW",children:"  "})]})]})]}),n.jsxs("div",{className:"mt-4 flex justify-end gap-2",children:[n.jsx("button",{type:"button",className:"rounded-md border border-borderDark px-3 py-1.5 text-xs font-medium text-textMuted700 hover:bg-navySecondary",onClick:()=>u(!1),children:""}),n.jsx("button",{type:"button",className:"rounded-md bg-amber-700 px-3 py-1.5 text-xs font-semibold text-white hover:bg-amber-800 disabled:opacity-50",onClick:D,disabled:!p.trim()||!b.trim(),children:" "})]})]})})]})},vo="REPLACE_WITH_GRAMMARLY_CLIENT_ID",Bu={[Us]:"Statement of Claim",[Ro]:"Letter of Demand",[Ou]:"Statement of Claim Expert Opinion",[Mu]:"Letter of Demand Expert Opinion","The plaintiff's expert opinion":"Plaintiff Expert Opinion","The claimant's expert opinion":"Claimant Expert Opinion","The insured's expert opinion":"Insured Expert Opinion","Insurance Coverage":"Insurance Coverage","Risk Assessment":"Risk Assessment",MPL:"MPL",Strategy:"Strategy","Expenses breakdown":"Expenses Breakdown","Expenses & Compensation breakdown":"Expenses & Compensation",Recommendations:"Recommendations","Strategy & Recommendations":"Strategy & Recommendations","Request for Approval of a Settlement Agreement":"Settlement Approval",Update:"Update"};mh.forEach(e=>{Bu[e]="Statement of Claim"});ph.forEach(e=>{Bu[e]="Letter of Demand"});const dN=e=>(Bu[e]||e||"").trim(),hh=e=>e.map(dN).filter(Boolean),Ld=e=>{const t=new Set;return e.map(s=>s.trim()).filter(s=>{if(!s)return!1;const r=s.toLowerCase();return t.has(r)?!1:(t.add(r),!0)})},$u=/[\\/:*?"<>|]/g,jc=e=>(e||"").trim(),uN=e=>{const t=(e.filenameTag||"").toLowerCase(),s=(e.plaintiffTitle||"").toLowerCase();return t.includes("demand")||s==="claimant"},mN=e=>{var t;return(((t=e.reportHistory)==null?void 0:t.length)||0)+1},pN=120,fN=e=>{if(!e.length)return"";if(e.length===1)return e[0];if(e.length===2)return`${e[0]} & ${e[1]}`;const t=e.slice(0,-1),s=e[e.length-1];return`${t.join(", ")} & ${s}`},ir=e=>{const t=jc(e.insurerName),s=jc(e.insuredName),r=jc(e.plaintiffName),a=mN(e);let o=[];const l=Array.isArray(e.fileNameTitles)?sn(e.fileNameTitles.map(R=>Kt(R))):[];l.length>0?o=Ld(l):a===1?o=[uN(e)?"New Letter of demand":"New Lawsuit"]:(o=Ld(hh(e.selectedSections||[])),o.length||(o=["Update"]));const c=fN(o),i=`Report ${a}`;let p=[t||void 0,s||void 0,r||void 0,c||void 0].filter(Boolean).join(" - ");if(p=p.replace($u," ").replace(/\s+/g," ").replace(/-+/g,"-").trim(),!p){const R=i;return R.toLowerCase().endsWith(".pdf")?R:`${R}.pdf`}const y=` - ${i}`,b=Math.max(0,pN-y.length);if(p.length>b){const R=p.slice(0,b),E=R.lastIndexOf(" ");p=(E>0?R.slice(0,E):R).trim()}let w=`${p}${y}`;return w=w.replace(/\s+/g," ").replace(/-+/g,"-").trim(),w||(w=`Report-${Date.now()}`),w.toLowerCase().endsWith(".pdf")?w:`${w}.pdf`},Zl=e=>ir(e).replace(/\.pdf$/i,""),gh=e=>`fileNameTopics:${e||"default"}`,xN=["Update","Expenses","New Lawsuit","New Third Party Notice","New Letter of Demand","Risk Assessment","Strategy","Recommendation","Request for Settlement Approval","Judgment","Request to Reopen a Claim","Dismissal for Inaction"],Kt=e=>{const t=(e||"").trim();return t?t.replace($u," ").replace(/\s+/g," ").trim():""},ei=e=>Kt(e).trim().toLowerCase(),sn=e=>{const t=new Set,s=[];for(const r of e){const a=Kt(r),o=ei(a);o&&(t.has(o)||(t.add(o),s.push(a)))}return s},hN=e=>{if(typeof window>"u")return[];try{const t=window.localStorage.getItem(gh(e));if(!t)return[];const s=JSON.parse(t);return Array.isArray(s)?sn(s.map(r=>typeof r=="string"?r:"").map(Kt)):[]}catch{return[]}},gN=(e,t)=>{if(!(typeof window>"u"))try{const s=sn(t.map(Kt)).filter(Boolean);window.localStorage.setItem(gh(e),JSON.stringify(s))}catch{}},yN=(e,t,s=15)=>{const r=Kt(t),a=ei(r);if(!a)return sn(e).slice(0,s);const o=(e||[]).filter(c=>ei(c)!==a),l=[r,...o];return sn(l).slice(0,s)},yh=e=>`topicCombos:${e||"default"}`,Nh=e=>`insurerDefaultTopics:${e||"default"}`,bh=e=>{if(!e)return null;try{return JSON.parse(e)}catch{return null}},_d=e=>{if(typeof window>"u")return[];const t=window.localStorage.getItem(yh(e)),s=bh(t);return Array.isArray(s)?s.filter(a=>Array.isArray(a)).map(a=>a.map(o=>Kt(o)).filter(Boolean)).filter(a=>a.length>0):[]},gp=(e,t)=>{if(typeof window>"u")return;const s=t.map(r=>sn(r.map(a=>Kt(a))).filter(Boolean)).filter(r=>r.length>0);try{window.localStorage.setItem(yh(e),JSON.stringify(s))}catch{}},yp=e=>e.map(s=>ei(s)).filter(Boolean).sort().join("|"),Np=(e,t,s=6)=>{const r=sn(t.map(c=>Kt(c))).filter(Boolean);if(!r.length)return e;const a=yp(r),o=[],l=new Set;o.push(r),l.add(a);for(const c of e){const i=yp(c);if(!l.has(i)&&(o.push(sn(c.map(u=>Kt(u))).filter(Boolean)),l.add(i),o.length>=s))break}return o.slice(0,s)},Hu=e=>(e||"").trim().toLowerCase(),Uu=e=>{if(typeof window>"u")return{};const t=window.localStorage.getItem(Nh(e)),s=bh(t);if(!s||typeof s!="object")return{};const r={};for(const[a,o]of Object.entries(s)){if(!Array.isArray(o))continue;const l=sn(o.map(c=>Kt(c))).filter(Boolean).slice(0,8);l.length&&(r[a]=l)}return r},vh=(e,t)=>{if(typeof window>"u")return;const s={};for(const[r,a]of Object.entries(t)){const o=sn((a||[]).map(l=>Kt(l))).filter(Boolean).slice(0,8);o.length&&(s[r]=o)}try{window.localStorage.setItem(Nh(e),JSON.stringify(s))}catch{}},NN=(e,t)=>{const s=Uu(e),r=Hu(t);return s[r]||[]},bN=(e,t,s)=>{if(!t)return;const r=Hu(t),a=Uu(e),o=sn(s.map(l=>Kt(l))).filter(Boolean).slice(0,8);o.length?a[r]=o:delete a[r],vh(e,a)},vN=(e,t)=>{if(!t)return;const s=Hu(t),r=Uu(e);r[s]&&(delete r[s],vh(e,r))},bp=[{id:"general_update",label:"General Update",body:`Dear Sir/Madam,

Please find below our general update regarding the above-captioned matter.

Best regards,
Lior Perry, Adv.`},{id:"risk_assessment",label:"Risk Assessment",body:`Dear Sir/Madam,

Kindly review the following risk assessment prepared for the insurer.

Best regards,
Lior Perry, Adv.`},{id:"expert_opinion",label:"Expert Opinion",body:`Dear Sir/Madam,

Please find our expert opinion summary for your review and records.

Best regards,
Lior Perry, Adv.`},{id:"full_report",label:"Full Report Delivery",body:`Dear Sir/Madam,

Attached is the full report for the current update, including all relevant sections.

Best regards,
Lior Perry, Adv.`},{id:"zeev_new_demand",label:"Zeev  New demand letter",body:`Dear Zeev,

I've attached a report regarding a new demand letter.

Sincerely,
Lior`},{id:"zeev_claim_update",label:"Zeev  Claim update",body:`Dear Zeev,

I've attached a report on the claim in question.

Sincerely,
Lior`},{id:"zeev_new_lawsuit",label:"Zeev  New lawsuit",body:`Dear Zeev,

I've attached a report regarding a new lawsuit.

Sincerely,
Lior`},{id:"zeev_lawsuit_update",label:"Zeev  Lawsuit update",body:`Dear Zeev,

I've attached a report on the lawsuit in question.

Sincerely,
Lior`}],vp=e=>`emailTemplates:${e||"default"}`,SN=({isOpen:e,report:t,userId:s,isSending:r=!1,recipientsPreview:a,defaultSubject:o,subjectDraft:l,onSubjectDraftChange:c,selectedTopics:i,onSelectedTopicsChange:u,isResendMode:p,onClose:y,onSend:b})=>{const w=bp[0],[R,E]=g.useState(w.id),[W,N]=g.useState(w.body),[h,S]=g.useState([]),[M,H]=g.useState([]),[V,q]=g.useState(l),[te,G]=g.useState(""),[re,j]=g.useState(""),[P,D]=g.useState([]),[O,z]=g.useState([]),F=se=>{if(typeof window>"u")return[];try{const I=localStorage.getItem(vp(se));if(!I)return[];const ae=JSON.parse(I);return Array.isArray(ae)?ae.filter(ne=>typeof(ne==null?void 0:ne.id)=="string"&&typeof(ne==null?void 0:ne.label)=="string"&&typeof(ne==null?void 0:ne.body)=="string"):[]}catch{return[]}},C=se=>{typeof window>"u"||localStorage.setItem(vp(s),JSON.stringify(se))},L=g.useMemo(()=>[...bp,...h],[h]),Q=g.useMemo(()=>L.reduce((se,I)=>(se[I.id]=I,se),{}),[L]);g.useEffect(()=>{if(!e)return;const se=F(s);S(se);const I=hN(s);H(I),D(_d(s)),z(NN(s,t.insurerName)),q(l),j(""),G("")},[e,s,l,t.insurerName]),g.useEffect(()=>{if(!e)return;const se=t.selectedEmailTemplate&&Q[t.selectedEmailTemplate]?t.selectedEmailTemplate:w.id;E(se),N(t.emailBodyDraft||Q[se].body)},[e,w.id,t.emailBodyDraft,t.selectedEmailTemplate,Q]);const me=se=>{E(se);const I=Q[se];I&&N(I.body)},ce=()=>{const se=window.prompt("  ?");if(!se)return;const I=se.trim();if(!I)return;const ae={id:`custom_${Date.now()}`,label:I,body:W},ne=[...h,ae];S(ne),C(ne),E(ae.id)},le=g.useMemo(()=>sn([...M,...xN]),[M]),fe=g.useMemo(()=>{const se=re.trim().toLowerCase();return se?le.filter(I=>I.toLowerCase().includes(se)):le},[le,re]),Te=g.useMemo(()=>{if(!p)return null;const se=typeof t.reportNumber=="number"&&t.reportNumber>0?`#${t.reportNumber}`:"",I=t.sentAt?new Date(t.sentAt).toLocaleDateString("en-GB",{day:"2-digit",month:"short",year:"numeric"}):"";return n.jsxs("div",{className:"mb-3 flex items-start gap-2 rounded-md border border-amber-300 bg-amber-50 px-3 py-2 text-[11px] text-amber-900",children:[n.jsx(qa,{className:"w-3 h-3 mt-[2px]"}),n.jsxs("div",{children:[n.jsxs("p",{className:"font-semibold",children:["    ",se||"",I?`   ${I}`:"","."]}),n.jsx("p",{className:"mt-1",children:"   (resend)   ,    .       ."})]})]})},[p,t.reportNumber,t.sentAt]),ge=se=>{const I=Kt(se);if(!I)return;const ae=I.toLowerCase(),ne=i.some(ye=>ye.trim().toLowerCase()===ae)?i.filter(ye=>ye.trim().toLowerCase()!==ae):[...i,I];u(sn(ne))},Be=()=>{const se=Kt(te);if(!se)return;const I=yN(M,se,15);H(I),gN(s,I);const ae=sn([...i,se]);u(ae),G("")},Ye=g.useMemo(()=>ir({...t,fileNameTitles:i}),[t,i]),He=!a.cc.some(se=>se.toLowerCase()!=="reports@lp-law.co.il"),ct=a.to[0]||"",X=a.to.length===1&&ct.toLowerCase()==="lidor@lp-law.co.il";return e?n.jsx("div",{className:"fixed inset-0 bg-black/50 z-[999] flex items-center justify-center p-4",children:n.jsxs("div",{className:"bg-panel rounded-2xl shadow-2xl w-full max-w-3xl max-h-[90vh] overflow-hidden flex flex-col",children:[n.jsxs("div",{className:"flex items-center justify-between border-b px-6 py-4",children:[n.jsxs("div",{className:"flex items-center gap-3",children:[n.jsx("h2",{className:"text-lg font-semibold text-gray-800",children:"Compose Email"}),X&&n.jsx("span",{className:"inline-flex items-center rounded-full bg-blue-50 px-2.5 py-0.5 text-[11px] font-semibold text-blue-800 border border-blue-200",children:"SANDBOX"})]}),n.jsx("button",{onClick:y,className:"text-gray-500 hover:text-gray-700",children:n.jsx(Ft,{className:"w-5 h-5"})})]}),n.jsxs("div",{className:"flex-1 overflow-y-auto px-6 py-4 space-y-4",children:[Te,He&&n.jsxs("div",{className:"flex items-start gap-2 text-xs text-amber-800 bg-amber-50 border border-amber-200 rounded-md px-3 py-2",children:[n.jsx(qa,{className:"w-3.5 h-3.5 mt-[1px]"}),n.jsx("p",{children:"         .       (To)   CC."})]}),X&&n.jsxs("div",{className:"flex items-start gap-2 text-xs text-blue-800 bg-blue-50 border border-blue-200 rounded-md px-3 py-2",children:[n.jsx(qa,{className:"w-3.5 h-3.5 mt-[1px]"}),n.jsx("p",{children:" :         ,    ."})]}),n.jsxs("div",{className:"text-xs text-gray-600 space-y-1 border rounded-md border-gray-200 bg-gray-50 px-3 py-2",children:[n.jsxs("div",{className:"flex items-center justify-between",children:[n.jsx("span",{className:"font-semibold",children:"To:"})," ",n.jsx("span",{children:a.to.join("; ")||""})]}),a.cc.length>0&&n.jsxs("div",{className:"flex items-center justify-between",children:[n.jsx("span",{className:"font-semibold",children:"CC:"})," ",n.jsx("span",{children:a.cc.join("; ")})]}),n.jsxs("p",{className:"text-[11px] text-gray-500 mt-1",children:["To: ",ct||""," (primary), CC: Office + report owner ( )."]}),n.jsxs("div",{children:[n.jsx("span",{className:"font-semibold",children:"Subject:"})," ",V||"(will be generated from case data)"]}),n.jsxs("div",{children:[n.jsx("span",{className:"font-semibold",children:"Attachment:"})," ",Ye]}),n.jsx("p",{className:"text-[11px] text-amber-700 mt-1",children:" :       ,        -PDF ."})]}),n.jsxs("div",{children:[n.jsxs("div",{className:"flex items-center justify-between mb-1",children:[n.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Subject"}),n.jsx("button",{type:"button",onClick:()=>{q(o),c(void 0)},className:"text-[11px] text-blue-700 hover:underline disabled:opacity-50",disabled:r,children:"Reset"})]}),n.jsx("input",{type:"text",value:V,onChange:se=>{const I=se.target.value;q(I),c(I)},className:"w-full border rounded-md p-2 text-sm",disabled:r})]}),n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Template"}),n.jsxs("div",{className:"flex gap-3",children:[n.jsx("select",{value:R,onChange:se=>me(se.target.value),className:"flex-1 border rounded-md p-2",children:L.map(se=>n.jsx("option",{value:se.id,children:se.label},se.id))}),n.jsx("button",{type:"button",onClick:ce,className:"px-3 py-2 bg-panel border rounded-md text-sm font-medium text-gray-700 hover:bg-gray-100",disabled:r,children:"Save Template"})]})]}),n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"PDF Filename Topics"}),P.length>0&&n.jsxs("div",{className:"mb-2",children:[n.jsx("p",{className:"text-[11px] font-semibold text-gray-700 mb-1",children:"Recent combinations"}),n.jsx("div",{className:"flex flex-wrap gap-2",children:P.map((se,I)=>n.jsx("button",{type:"button",onClick:()=>u(se),className:"inline-flex items-center gap-1 rounded-full bg-gray-100 px-3 py-1 text-[11px] text-gray-800 border border-gray-300 hover:bg-gray-200",children:se.join(" + ")},I))})]}),n.jsx("div",{className:"flex flex-wrap gap-2 mb-2",children:i.length===0?n.jsx("span",{className:"text-xs text-gray-400",children:"No topics selected yet. You can choose from the list below or add your own."}):i.map(se=>n.jsxs("button",{type:"button",onClick:()=>ge(se),className:"inline-flex items-center gap-1 rounded-full bg-blue-50 px-3 py-1 text-xs text-blue-800 border border-blue-200 hover:bg-blue-100",children:[n.jsx("span",{children:se}),n.jsx("span",{className:"text-[10px]",children:""})]},se))}),n.jsx("button",{type:"button",onClick:()=>{u([]),j("")},className:"mb-2 text-[11px] text-blue-700 hover:underline",disabled:r,children:"  "}),n.jsx("div",{className:"flex items-center gap-2 mb-2",children:n.jsx("input",{type:"text",value:re,onChange:se=>j(se.target.value),placeholder:"  ...",className:"flex-1 border rounded-md p-1.5 text-[11px]",disabled:r})}),n.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-1 mb-2 max-h-32 overflow-y-auto border rounded-md p-2 bg-panel",children:fe.map(se=>{const I=`topic-${se}`,ae=se.toLowerCase(),ne=i.some(ye=>ye.trim().toLowerCase()===ae);return n.jsxs("label",{htmlFor:I,className:"flex items-center gap-1 text-xs text-gray-700 cursor-pointer",children:[n.jsx("input",{id:I,type:"checkbox",className:"h-3 w-3",checked:ne,onChange:()=>ge(se),disabled:r}),n.jsx("span",{className:"whitespace-normal break-words",children:se})]},se)})}),n.jsxs("div",{className:"flex gap-2 mt-1",children:[n.jsx("input",{type:"text",value:te,onChange:se=>G(se.target.value),placeholder:"Add custom topic",className:"flex-1 border rounded-md p-2 text-xs",disabled:r}),n.jsx("button",{type:"button",onClick:Be,className:"px-3 py-1.5 bg-panel border rounded-md text-xs font-medium text-gray-700 hover:bg-gray-100 disabled:opacity-50",disabled:r,children:"Add"})]}),n.jsxs("div",{className:"mt-3 space-y-1 text-[11px] text-gray-700",children:[n.jsxs("div",{className:"flex gap-2 flex-wrap items-center",children:[n.jsx("button",{type:"button",onClick:()=>{const se=sn(i.map(I=>Kt(I)));se.length&&(bN(s,t.insurerName,se),z(se))},className:"px-2 py-1 rounded-full border border-gray-300 bg-panel hover:bg-gray-100",disabled:r||i.length===0,children:"     "}),O.length>0&&n.jsxs(n.Fragment,{children:[n.jsx("button",{type:"button",onClick:()=>u(O),className:"px-2 py-1 rounded-full border border-blue-300 bg-blue-50 text-blue-800 hover:bg-blue-100 disabled:opacity-50",disabled:r,children:"     "}),n.jsx("button",{type:"button",onClick:()=>{vN(s,t.insurerName),z([])},className:"text-[11px] text-red-600 hover:underline",disabled:r,children:"    "})]})]}),O.length>0&&i.length===0&&n.jsx("p",{className:"text-[11px] text-gray-500",children:"     .       ."})]})]}),n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Email Body"}),n.jsx(ho,{clientId:vo,children:n.jsx("textarea",{value:W,onChange:se=>N(se.target.value),rows:12,dir:"ltr",className:"w-full border rounded-md p-3 text-sm",style:{direction:"ltr",textAlign:"left",unicodeBidi:"plaintext"}})})]}),n.jsxs("div",{className:"border-t pt-4 text-right",children:[n.jsx("p",{className:"text-sm font-semibold text-gray-600 mb-2",children:"Signature"}),n.jsxs("div",{className:"inline-flex flex-col items-end",children:[n.jsx("img",{src:"/assets/branding/signature.png",alt:"Signature placeholder",className:"h-16 object-contain mb-2 opacity-80",onError:se=>{se.currentTarget.style.display="none"}}),n.jsx("span",{className:"text-sm text-gray-700 font-semibold",children:"Adv. Lior Perry"})]})]})]}),n.jsxs("div",{className:"flex justify-end gap-3 border-t px-6 py-4 bg-gray-50",children:[n.jsx("button",{onClick:y,className:"px-4 py-2 rounded-md text-gray-600 hover:bg-gray-200",disabled:r,children:"Cancel"}),n.jsx("button",{onClick:()=>b({body:W,templateId:R,subjectBase:V.trim(),topics:sn(i.map(se=>Kt(se)))}),className:"px-5 py-2 rounded-md bg-lpBlue text-white font-semibold hover:bg-blue-900 disabled:opacity-60 disabled:cursor-not-allowed",disabled:r,children:r?"Sending":"Send Email"})]})]})}):null},wN=({isOpen:e,availableTitles:t,selectedTitles:s,onClose:r,onSave:a})=>{const o=g.useMemo(()=>b=>{const w=new Set,R=[];return b.forEach(E=>{const W=t.find(N=>N.label===E&&!w.has(N.id));W&&(R.push(W.id),w.add(W.id))}),R},[t]),l=g.useCallback(()=>{const b=o(s);return b.length?b:t.map(w=>w.id)},[o,s,t]),[c,i]=g.useState(l);if(g.useEffect(()=>{e&&i(l())},[e,l]),!e)return null;const u=b=>{i(w=>w.includes(b)?w.filter(R=>R!==b):[...w,b])},p=()=>{i(t.map(b=>b.id))},y=()=>{const b=c.map(w=>{var R;return(R=t.find(E=>E.id===w))==null?void 0:R.label}).filter(Boolean);a(b)};return n.jsx("div",{className:"fixed inset-0 bg-black/40 z-[900] flex items-center justify-center p-4",children:n.jsxs("div",{className:"bg-panel rounded-2xl shadow-2xl w-full max-w-md max-h-[90vh] overflow-hidden flex flex-col",children:[n.jsxs("div",{className:"flex items-center justify-between px-5 py-3 border-b bg-navySecondary50",children:[n.jsx("h3",{className:"text-lg font-semibold text-gray-800",children:"Select File Name Titles"}),n.jsx("button",{onClick:r,className:"text-gray-500 hover:text-gray-800",children:n.jsx(Ft,{className:"w-5 h-5"})})]}),n.jsxs("div",{className:"flex-1 overflow-y-auto p-5 space-y-3",children:[t.length===0&&n.jsx("p",{className:"text-sm text-gray-500",children:"No sections available to include."}),t.map(b=>n.jsxs("label",{className:"flex items-center gap-3 border rounded-lg px-3 py-2 text-sm",children:[n.jsx("input",{type:"checkbox",className:"h-4 w-4 text-lpBlue",checked:c.includes(b.id),onChange:()=>u(b.id)}),n.jsx("span",{className:"text-gray-800",children:b.label||"[Untitled Section]"})]},b.id)),t.length>0&&n.jsx("button",{type:"button",className:"text-xs text-lpBlue hover:underline",onClick:p,children:"Select All"})]}),n.jsxs("div",{className:"flex justify-end gap-3 border-t px-5 py-4 bg-navySecondary50",children:[n.jsx("button",{onClick:r,className:"px-4 py-2 text-gray-600 hover:bg-navySecondary200 rounded-md",children:"Cancel"}),n.jsx("button",{onClick:y,className:"px-5 py-2 bg-lpBlue text-white rounded-md font-semibold hover:bg-blue-900",children:"Save"})]})]})})},we=e=>(e||"").replace(/\u00A0/g," ").replace(/\s+/g,"").trim();var ma=1e9,jN={precision:20,rounding:4,toExpNeg:-7,toExpPos:21,LN10:"2.302585092994045684017991454684364207601101488628772976033327900967572609677352480235997205089598298341967784042286"},zu,St=!0,Fn="[DecimalError] ",fr=Fn+"Invalid argument: ",Wu=Fn+"Exponent out of range: ",pa=Math.floor,lr=Math.pow,EN=/^(\d+(\.\d*)?|\.\d+)(e[+-]?\d+)?$/i,vn,Ht=1e7,Nt=7,Sh=9007199254740991,ti=pa(Sh/Nt),Ie={};Ie.absoluteValue=Ie.abs=function(){var e=new this.constructor(this);return e.s&&(e.s=1),e};Ie.comparedTo=Ie.cmp=function(e){var t,s,r,a,o=this;if(e=new o.constructor(e),o.s!==e.s)return o.s||-e.s;if(o.e!==e.e)return o.e>e.e^o.s<0?1:-1;for(r=o.d.length,a=e.d.length,t=0,s=r<a?r:a;t<s;++t)if(o.d[t]!==e.d[t])return o.d[t]>e.d[t]^o.s<0?1:-1;return r===a?0:r>a^o.s<0?1:-1};Ie.decimalPlaces=Ie.dp=function(){var e=this,t=e.d.length-1,s=(t-e.e)*Nt;if(t=e.d[t],t)for(;t%10==0;t/=10)s--;return s<0?0:s};Ie.dividedBy=Ie.div=function(e){return ws(this,new this.constructor(e))};Ie.dividedToIntegerBy=Ie.idiv=function(e){var t=this,s=t.constructor;return ft(ws(t,new s(e),0,1),s.precision)};Ie.equals=Ie.eq=function(e){return!this.cmp(e)};Ie.exponent=function(){return _t(this)};Ie.greaterThan=Ie.gt=function(e){return this.cmp(e)>0};Ie.greaterThanOrEqualTo=Ie.gte=function(e){return this.cmp(e)>=0};Ie.isInteger=Ie.isint=function(){return this.e>this.d.length-2};Ie.isNegative=Ie.isneg=function(){return this.s<0};Ie.isPositive=Ie.ispos=function(){return this.s>0};Ie.isZero=function(){return this.s===0};Ie.lessThan=Ie.lt=function(e){return this.cmp(e)<0};Ie.lessThanOrEqualTo=Ie.lte=function(e){return this.cmp(e)<1};Ie.logarithm=Ie.log=function(e){var t,s=this,r=s.constructor,a=r.precision,o=a+5;if(e===void 0)e=new r(10);else if(e=new r(e),e.s<1||e.eq(vn))throw Error(Fn+"NaN");if(s.s<1)throw Error(Fn+(s.s?"NaN":"-Infinity"));return s.eq(vn)?new r(0):(St=!1,t=ws(So(s,o),So(e,o),o),St=!0,ft(t,a))};Ie.minus=Ie.sub=function(e){var t=this;return e=new t.constructor(e),t.s==e.s?Eh(t,e):wh(t,(e.s=-e.s,e))};Ie.modulo=Ie.mod=function(e){var t,s=this,r=s.constructor,a=r.precision;if(e=new r(e),!e.s)throw Error(Fn+"NaN");return s.s?(St=!1,t=ws(s,e,0,1).times(e),St=!0,s.minus(t)):ft(new r(s),a)};Ie.naturalExponential=Ie.exp=function(){return jh(this)};Ie.naturalLogarithm=Ie.ln=function(){return So(this)};Ie.negated=Ie.neg=function(){var e=new this.constructor(this);return e.s=-e.s||0,e};Ie.plus=Ie.add=function(e){var t=this;return e=new t.constructor(e),t.s==e.s?wh(t,e):Eh(t,(e.s=-e.s,e))};Ie.precision=Ie.sd=function(e){var t,s,r,a=this;if(e!==void 0&&e!==!!e&&e!==1&&e!==0)throw Error(fr+e);if(t=_t(a)+1,r=a.d.length-1,s=r*Nt+1,r=a.d[r],r){for(;r%10==0;r/=10)s--;for(r=a.d[0];r>=10;r/=10)s++}return e&&t>s?t:s};Ie.squareRoot=Ie.sqrt=function(){var e,t,s,r,a,o,l,c=this,i=c.constructor;if(c.s<1){if(!c.s)return new i(0);throw Error(Fn+"NaN")}for(e=_t(c),St=!1,a=Math.sqrt(+c),a==0||a==1/0?(t=ls(c.d),(t.length+e)%2==0&&(t+="0"),a=Math.sqrt(t),e=pa((e+1)/2)-(e<0||e%2),a==1/0?t="5e"+e:(t=a.toExponential(),t=t.slice(0,t.indexOf("e")+1)+e),r=new i(t)):r=new i(a.toString()),s=i.precision,a=l=s+3;;)if(o=r,r=o.plus(ws(c,o,l+2)).times(.5),ls(o.d).slice(0,l)===(t=ls(r.d)).slice(0,l)){if(t=t.slice(l-3,l+1),a==l&&t=="4999"){if(ft(o,s+1,0),o.times(o).eq(c)){r=o;break}}else if(t!="9999")break;l+=4}return St=!0,ft(r,s)};Ie.times=Ie.mul=function(e){var t,s,r,a,o,l,c,i,u,p=this,y=p.constructor,b=p.d,w=(e=new y(e)).d;if(!p.s||!e.s)return new y(0);for(e.s*=p.s,s=p.e+e.e,i=b.length,u=w.length,i<u&&(o=b,b=w,w=o,l=i,i=u,u=l),o=[],l=i+u,r=l;r--;)o.push(0);for(r=u;--r>=0;){for(t=0,a=i+r;a>r;)c=o[a]+w[r]*b[a-r-1]+t,o[a--]=c%Ht|0,t=c/Ht|0;o[a]=(o[a]+t)%Ht|0}for(;!o[--l];)o.pop();return t?++s:o.shift(),e.d=o,e.e=s,St?ft(e,y.precision):e};Ie.toDecimalPlaces=Ie.todp=function(e,t){var s=this,r=s.constructor;return s=new r(s),e===void 0?s:(us(e,0,ma),t===void 0?t=r.rounding:us(t,0,8),ft(s,e+_t(s)+1,t))};Ie.toExponential=function(e,t){var s,r=this,a=r.constructor;return e===void 0?s=br(r,!0):(us(e,0,ma),t===void 0?t=a.rounding:us(t,0,8),r=ft(new a(r),e+1,t),s=br(r,!0,e+1)),s};Ie.toFixed=function(e,t){var s,r,a=this,o=a.constructor;return e===void 0?br(a):(us(e,0,ma),t===void 0?t=o.rounding:us(t,0,8),r=ft(new o(a),e+_t(a)+1,t),s=br(r.abs(),!1,e+_t(r)+1),a.isneg()&&!a.isZero()?"-"+s:s)};Ie.toInteger=Ie.toint=function(){var e=this,t=e.constructor;return ft(new t(e),_t(e)+1,t.rounding)};Ie.toNumber=function(){return+this};Ie.toPower=Ie.pow=function(e){var t,s,r,a,o,l,c=this,i=c.constructor,u=12,p=+(e=new i(e));if(!e.s)return new i(vn);if(c=new i(c),!c.s){if(e.s<1)throw Error(Fn+"Infinity");return c}if(c.eq(vn))return c;if(r=i.precision,e.eq(vn))return ft(c,r);if(t=e.e,s=e.d.length-1,l=t>=s,o=c.s,l){if((s=p<0?-p:p)<=Sh){for(a=new i(vn),t=Math.ceil(r/Nt+4),St=!1;s%2&&(a=a.times(c),wp(a.d,t)),s=pa(s/2),s!==0;)c=c.times(c),wp(c.d,t);return St=!0,e.s<0?new i(vn).div(a):ft(a,r)}}else if(o<0)throw Error(Fn+"NaN");return o=o<0&&e.d[Math.max(t,s)]&1?-1:1,c.s=1,St=!1,a=e.times(So(c,r+u)),St=!0,a=jh(a),a.s=o,a};Ie.toPrecision=function(e,t){var s,r,a=this,o=a.constructor;return e===void 0?(s=_t(a),r=br(a,s<=o.toExpNeg||s>=o.toExpPos)):(us(e,1,ma),t===void 0?t=o.rounding:us(t,0,8),a=ft(new o(a),e,t),s=_t(a),r=br(a,e<=s||s<=o.toExpNeg,e)),r};Ie.toSignificantDigits=Ie.tosd=function(e,t){var s=this,r=s.constructor;return e===void 0?(e=r.precision,t=r.rounding):(us(e,1,ma),t===void 0?t=r.rounding:us(t,0,8)),ft(new r(s),e,t)};Ie.toString=Ie.valueOf=Ie.val=Ie.toJSON=Ie[Symbol.for("nodejs.util.inspect.custom")]=function(){var e=this,t=_t(e),s=e.constructor;return br(e,t<=s.toExpNeg||t>=s.toExpPos)};function wh(e,t){var s,r,a,o,l,c,i,u,p=e.constructor,y=p.precision;if(!e.s||!t.s)return t.s||(t=new p(e)),St?ft(t,y):t;if(i=e.d,u=t.d,l=e.e,a=t.e,i=i.slice(),o=l-a,o){for(o<0?(r=i,o=-o,c=u.length):(r=u,a=l,c=i.length),l=Math.ceil(y/Nt),c=l>c?l+1:c+1,o>c&&(o=c,r.length=1),r.reverse();o--;)r.push(0);r.reverse()}for(c=i.length,o=u.length,c-o<0&&(o=c,r=u,u=i,i=r),s=0;o;)s=(i[--o]=i[o]+u[o]+s)/Ht|0,i[o]%=Ht;for(s&&(i.unshift(s),++a),c=i.length;i[--c]==0;)i.pop();return t.d=i,t.e=a,St?ft(t,y):t}function us(e,t,s){if(e!==~~e||e<t||e>s)throw Error(fr+e)}function ls(e){var t,s,r,a=e.length-1,o="",l=e[0];if(a>0){for(o+=l,t=1;t<a;t++)r=e[t]+"",s=Nt-r.length,s&&(o+=Os(s)),o+=r;l=e[t],r=l+"",s=Nt-r.length,s&&(o+=Os(s))}else if(l===0)return"0";for(;l%10===0;)l/=10;return o+l}var ws=function(){function e(r,a){var o,l=0,c=r.length;for(r=r.slice();c--;)o=r[c]*a+l,r[c]=o%Ht|0,l=o/Ht|0;return l&&r.unshift(l),r}function t(r,a,o,l){var c,i;if(o!=l)i=o>l?1:-1;else for(c=i=0;c<o;c++)if(r[c]!=a[c]){i=r[c]>a[c]?1:-1;break}return i}function s(r,a,o){for(var l=0;o--;)r[o]-=l,l=r[o]<a[o]?1:0,r[o]=l*Ht+r[o]-a[o];for(;!r[0]&&r.length>1;)r.shift()}return function(r,a,o,l){var c,i,u,p,y,b,w,R,E,W,N,h,S,M,H,V,q,te,G=r.constructor,re=r.s==a.s?1:-1,j=r.d,P=a.d;if(!r.s)return new G(r);if(!a.s)throw Error(Fn+"Division by zero");for(i=r.e-a.e,q=P.length,H=j.length,w=new G(re),R=w.d=[],u=0;P[u]==(j[u]||0);)++u;if(P[u]>(j[u]||0)&&--i,o==null?h=o=G.precision:l?h=o+(_t(r)-_t(a))+1:h=o,h<0)return new G(0);if(h=h/Nt+2|0,u=0,q==1)for(p=0,P=P[0],h++;(u<H||p)&&h--;u++)S=p*Ht+(j[u]||0),R[u]=S/P|0,p=S%P|0;else{for(p=Ht/(P[0]+1)|0,p>1&&(P=e(P,p),j=e(j,p),q=P.length,H=j.length),M=q,E=j.slice(0,q),W=E.length;W<q;)E[W++]=0;te=P.slice(),te.unshift(0),V=P[0],P[1]>=Ht/2&&++V;do p=0,c=t(P,E,q,W),c<0?(N=E[0],q!=W&&(N=N*Ht+(E[1]||0)),p=N/V|0,p>1?(p>=Ht&&(p=Ht-1),y=e(P,p),b=y.length,W=E.length,c=t(y,E,b,W),c==1&&(p--,s(y,q<b?te:P,b))):(p==0&&(c=p=1),y=P.slice()),b=y.length,b<W&&y.unshift(0),s(E,y,W),c==-1&&(W=E.length,c=t(P,E,q,W),c<1&&(p++,s(E,q<W?te:P,W))),W=E.length):c===0&&(p++,E=[0]),R[u++]=p,c&&E[0]?E[W++]=j[M]||0:(E=[j[M]],W=1);while((M++<H||E[0]!==void 0)&&h--)}return R[0]||R.shift(),w.e=i,ft(w,l?o+_t(w)+1:o)}}();function jh(e,t){var s,r,a,o,l,c,i=0,u=0,p=e.constructor,y=p.precision;if(_t(e)>16)throw Error(Wu+_t(e));if(!e.s)return new p(vn);for(St=!1,c=y,l=new p(.03125);e.abs().gte(.1);)e=e.times(l),u+=5;for(r=Math.log(lr(2,u))/Math.LN10*2+5|0,c+=r,s=a=o=new p(vn),p.precision=c;;){if(a=ft(a.times(e),c),s=s.times(++i),l=o.plus(ws(a,s,c)),ls(l.d).slice(0,c)===ls(o.d).slice(0,c)){for(;u--;)o=ft(o.times(o),c);return p.precision=y,t==null?(St=!0,ft(o,y)):o}o=l}}function _t(e){for(var t=e.e*Nt,s=e.d[0];s>=10;s/=10)t++;return t}function Ec(e,t,s){if(t>e.LN10.sd())throw St=!0,s&&(e.precision=s),Error(Fn+"LN10 precision limit exceeded");return ft(new e(e.LN10),t)}function Os(e){for(var t="";e--;)t+="0";return t}function So(e,t){var s,r,a,o,l,c,i,u,p,y=1,b=10,w=e,R=w.d,E=w.constructor,W=E.precision;if(w.s<1)throw Error(Fn+(w.s?"NaN":"-Infinity"));if(w.eq(vn))return new E(0);if(t==null?(St=!1,u=W):u=t,w.eq(10))return t==null&&(St=!0),Ec(E,u);if(u+=b,E.precision=u,s=ls(R),r=s.charAt(0),o=_t(w),Math.abs(o)<15e14){for(;r<7&&r!=1||r==1&&s.charAt(1)>3;)w=w.times(e),s=ls(w.d),r=s.charAt(0),y++;o=_t(w),r>1?(w=new E("0."+s),o++):w=new E(r+"."+s.slice(1))}else return i=Ec(E,u+2,W).times(o+""),w=So(new E(r+"."+s.slice(1)),u-b).plus(i),E.precision=W,t==null?(St=!0,ft(w,W)):w;for(c=l=w=ws(w.minus(vn),w.plus(vn),u),p=ft(w.times(w),u),a=3;;){if(l=ft(l.times(p),u),i=c.plus(ws(l,new E(a),u)),ls(i.d).slice(0,u)===ls(c.d).slice(0,u))return c=c.times(2),o!==0&&(c=c.plus(Ec(E,u+2,W).times(o+""))),c=ws(c,new E(y),u),E.precision=W,t==null?(St=!0,ft(c,W)):c;c=i,a+=2}}function Sp(e,t){var s,r,a;for((s=t.indexOf("."))>-1&&(t=t.replace(".","")),(r=t.search(/e/i))>0?(s<0&&(s=r),s+=+t.slice(r+1),t=t.substring(0,r)):s<0&&(s=t.length),r=0;t.charCodeAt(r)===48;)++r;for(a=t.length;t.charCodeAt(a-1)===48;)--a;if(t=t.slice(r,a),t){if(a-=r,s=s-r-1,e.e=pa(s/Nt),e.d=[],r=(s+1)%Nt,s<0&&(r+=Nt),r<a){for(r&&e.d.push(+t.slice(0,r)),a-=Nt;r<a;)e.d.push(+t.slice(r,r+=Nt));t=t.slice(r),r=Nt-t.length}else r-=a;for(;r--;)t+="0";if(e.d.push(+t),St&&(e.e>ti||e.e<-ti))throw Error(Wu+s)}else e.s=0,e.e=0,e.d=[0];return e}function ft(e,t,s){var r,a,o,l,c,i,u,p,y=e.d;for(l=1,o=y[0];o>=10;o/=10)l++;if(r=t-l,r<0)r+=Nt,a=t,u=y[p=0];else{if(p=Math.ceil((r+1)/Nt),o=y.length,p>=o)return e;for(u=o=y[p],l=1;o>=10;o/=10)l++;r%=Nt,a=r-Nt+l}if(s!==void 0&&(o=lr(10,l-a-1),c=u/o%10|0,i=t<0||y[p+1]!==void 0||u%o,i=s<4?(c||i)&&(s==0||s==(e.s<0?3:2)):c>5||c==5&&(s==4||i||s==6&&(r>0?a>0?u/lr(10,l-a):0:y[p-1])%10&1||s==(e.s<0?8:7))),t<1||!y[0])return i?(o=_t(e),y.length=1,t=t-o-1,y[0]=lr(10,(Nt-t%Nt)%Nt),e.e=pa(-t/Nt)||0):(y.length=1,y[0]=e.e=e.s=0),e;if(r==0?(y.length=p,o=1,p--):(y.length=p+1,o=lr(10,Nt-r),y[p]=a>0?(u/lr(10,l-a)%lr(10,a)|0)*o:0),i)for(;;)if(p==0){(y[0]+=o)==Ht&&(y[0]=1,++e.e);break}else{if(y[p]+=o,y[p]!=Ht)break;y[p--]=0,o=1}for(r=y.length;y[--r]===0;)y.pop();if(St&&(e.e>ti||e.e<-ti))throw Error(Wu+_t(e));return e}function Eh(e,t){var s,r,a,o,l,c,i,u,p,y,b=e.constructor,w=b.precision;if(!e.s||!t.s)return t.s?t.s=-t.s:t=new b(e),St?ft(t,w):t;if(i=e.d,y=t.d,r=t.e,u=e.e,i=i.slice(),l=u-r,l){for(p=l<0,p?(s=i,l=-l,c=y.length):(s=y,r=u,c=i.length),a=Math.max(Math.ceil(w/Nt),c)+2,l>a&&(l=a,s.length=1),s.reverse(),a=l;a--;)s.push(0);s.reverse()}else{for(a=i.length,c=y.length,p=a<c,p&&(c=a),a=0;a<c;a++)if(i[a]!=y[a]){p=i[a]<y[a];break}l=0}for(p&&(s=i,i=y,y=s,t.s=-t.s),c=i.length,a=y.length-c;a>0;--a)i[c++]=0;for(a=y.length;a>l;){if(i[--a]<y[a]){for(o=a;o&&i[--o]===0;)i[o]=Ht-1;--i[o],i[a]+=Ht}i[a]-=y[a]}for(;i[--c]===0;)i.pop();for(;i[0]===0;i.shift())--r;return i[0]?(t.d=i,t.e=r,St?ft(t,w):t):new b(0)}function br(e,t,s){var r,a=_t(e),o=ls(e.d),l=o.length;return t?(s&&(r=s-l)>0?o=o.charAt(0)+"."+o.slice(1)+Os(r):l>1&&(o=o.charAt(0)+"."+o.slice(1)),o=o+(a<0?"e":"e+")+a):a<0?(o="0."+Os(-a-1)+o,s&&(r=s-l)>0&&(o+=Os(r))):a>=l?(o+=Os(a+1-l),s&&(r=s-a-1)>0&&(o=o+"."+Os(r))):((r=a+1)<l&&(o=o.slice(0,r)+"."+o.slice(r)),s&&(r=s-l)>0&&(a+1===l&&(o+="."),o+=Os(r))),e.s<0?"-"+o:o}function wp(e,t){if(e.length>t)return e.length=t,!0}function kh(e){var t,s,r;function a(o){var l=this;if(!(l instanceof a))return new a(o);if(l.constructor=a,o instanceof a){l.s=o.s,l.e=o.e,l.d=(o=o.d)?o.slice():o;return}if(typeof o=="number"){if(o*0!==0)throw Error(fr+o);if(o>0)l.s=1;else if(o<0)o=-o,l.s=-1;else{l.s=0,l.e=0,l.d=[0];return}if(o===~~o&&o<1e7){l.e=0,l.d=[o];return}return Sp(l,o.toString())}else if(typeof o!="string")throw Error(fr+o);if(o.charCodeAt(0)===45?(o=o.slice(1),l.s=-1):l.s=1,EN.test(o))Sp(l,o);else throw Error(fr+o)}if(a.prototype=Ie,a.ROUND_UP=0,a.ROUND_DOWN=1,a.ROUND_CEIL=2,a.ROUND_FLOOR=3,a.ROUND_HALF_UP=4,a.ROUND_HALF_DOWN=5,a.ROUND_HALF_EVEN=6,a.ROUND_HALF_CEIL=7,a.ROUND_HALF_FLOOR=8,a.clone=kh,a.config=a.set=kN,e===void 0&&(e={}),e)for(r=["precision","rounding","toExpNeg","toExpPos","LN10"],t=0;t<r.length;)e.hasOwnProperty(s=r[t++])||(e[s]=this[s]);return a.config(e),a}function kN(e){if(!e||typeof e!="object")throw Error(Fn+"Object expected");var t,s,r,a=["precision",1,ma,"rounding",0,8,"toExpNeg",-1/0,0,"toExpPos",0,1/0];for(t=0;t<a.length;t+=3)if((r=e[s=a[t]])!==void 0)if(pa(r)===r&&r>=a[t+1]&&r<=a[t+2])this[s]=r;else throw Error(fr+s+": "+r);if((r=e[s="LN10"])!==void 0)if(r==Math.LN10)this[s]=new this(r);else throw Error(fr+s+": "+r);return this}var zu=kh(jN);vn=new zu(1);const gs=zu;gs.set({precision:20,rounding:gs.ROUND_HALF_UP});const Gn=e=>new gs(e??0),ys=e=>e.toDecimalPlaces(2).toNumber(),Ah=(e,t)=>{const s=Gn(e),r=Gn(t);return ys(s.mul(r))},Ih=(e,t)=>{const s=Gn(e),r=Gn(t).div(100);return ys(s.mul(r))},Th=(e,t)=>{const s=Gn(e),r=Gn(t);return ys(s.add(r))},kc=e=>{if(e.lineTotalAmount!=null)return Gn(e.lineTotalAmount);const t=e.lineNetAmount!=null?e.lineNetAmount:Ah(e.quantity??0,e.unitPrice??0),s=e.lineVatAmount!=null?e.lineVatAmount:Ih(t,e.vatRate??0);return Gn(Th(t,s))},On=(e,t)=>{const s=t.reduce((w,R)=>w.add(kc(R)),new gs(0)),r=t.reduce((w,R)=>R.isIncludedInRequestedAmount===!1?w:w.add(kc(R)),new gs(0)),a=t.reduce((w,R)=>R.lineVatAmount==null?w:w.add(Gn(R.lineVatAmount)),new gs(0)),l=t.filter(w=>(w.kind==="ADJUSTMENT"||w.kind==="COMPENSATION")&&w.isIncludedInRequestedAmount===!1).reduce((w,R)=>w.add(kc(R)),new gs(0)),c=Gn(e.deductibleAmount??0),i=Gn(e.alreadyPaidAmount??0),u=c.add(i).add(l),p=r.sub(u),y=!!e.infoOnly,b=y?new gs(0):p.greaterThan(0)?p:new gs(0);return{grossExpensesTotal:ys(s),includedExpensesTotal:ys(r),vatTotal:ys(a),adjustmentsTotal:ys(u),amountBeforeInfoOnly:ys(p),amountToRequest:ys(b),infoOnlyApplied:y}},Rh="financial_expenses_store_v1",ll=()=>({sheets:{},lineItems:{},attachments:{},auditEvents:{},insurerRulesets:{},exceptionAnnotations:{},payments:{},officialSheetIdByCaseId:{}}),AN=e=>{let t=e.officialSheetIdByCaseId;if(t&&Object.keys(t).length>0)return e;t={};const s=Object.values(e.sheets),r=new Map;return s.forEach(a=>{const o=we(a.caseId);if(!o)return;const l=r.get(o),c=new Date(a.updatedAt||a.createdAt).getTime();(!l||new Date(l.updatedAt||l.createdAt).getTime()<c)&&r.set(o,a)}),r.forEach((a,o)=>{t[o]=a.id}),{...e,officialSheetIdByCaseId:t}},ht=()=>{if(typeof window>"u")return ll();try{const e=window.localStorage.getItem(Rh);if(!e)return ll();const t=JSON.parse(e);if(!t||typeof t!="object")return ll();let s={sheets:t.sheets||{},lineItems:t.lineItems||{},attachments:t.attachments||{},auditEvents:t.auditEvents||{},insurerRulesets:t.insurerRulesets||{},exceptionAnnotations:t.exceptionAnnotations||{},payments:t.payments||{},officialSheetIdByCaseId:t.officialSheetIdByCaseId||{}};return s=AN(s),(!t.officialSheetIdByCaseId||Object.keys(t.officialSheetIdByCaseId||{}).length===0)&&Object.keys(s.officialSheetIdByCaseId||{}).length>0&&an(s),s}catch(e){return console.error("Failed to load financial expenses store",e),ll()}},an=e=>{if(!(typeof window>"u"))try{window.localStorage.setItem(Rh,JSON.stringify(e))}catch(t){console.error("Failed to persist financial expenses store",t)}},IN=e=>{let t=0;for(let s=0;s<e.length;s++)t=(t<<5)-t+e.charCodeAt(s),t|=0;return Math.abs(t).toString(16)},TN=(e,t,s)=>{const r={sheet:e,lineItems:t.map(a=>({id:a.id,sheetId:a.sheetId,kind:a.kind,expenseType:a.expenseType,providerName:a.providerName,description:a.description,date:a.date,quantity:a.quantity,unitPrice:a.unitPrice,vatRate:a.vatRate,isIncludedInRequestedAmount:a.isIncludedInRequestedAmount,lineNetAmount:a.lineNetAmount,lineVatAmount:a.lineVatAmount,lineTotalAmount:a.lineTotalAmount,attachmentId:a.attachmentId})),attachments:s.map(a=>({id:a.id,sheetId:a.sheetId,fileKey:a.fileKey,originalFileName:a.originalFileName,mimeType:a.mimeType,sizeBytes:a.sizeBytes,linkedLineItemId:a.linkedLineItemId}))};return IN(JSON.stringify(r))},Nn=()=>new Date().toISOString(),fa=e=>`${e}_${Math.random().toString(36).slice(2,10)}_${Date.now().toString(36)}`,wo=(e,t)=>{const s=Object.values(e.lineItems).filter(a=>a.sheetId===t),r=Object.values(e.attachments).filter(a=>a.sheetId===t);return{lineItems:s,attachments:r}},RN=e=>{const t=ht(),s=we(e);return Object.values(t.payments).filter(r=>!r.isDeleted&&we(r.caseId)===s).sort((r,a)=>{const o=new Date(r.paidAt).getTime(),l=new Date(a.paidAt).getTime();return o-l})},CN=e=>{let t=ht();const s=fa("fpay"),r=Nn(),a={id:s,caseId:we(e.caseId),sheetId:e.sheetId??null,amount:e.amount,paidAt:e.paidAt,reference:e.reference??null,note:e.note??null,isDeleted:!1,createdAt:r,updatedAt:r};return t={...t,payments:{...t.payments,[s]:a}},an(t),a},DN=e=>{let t=ht();const s=t.payments[e];if(!s)return null;const r={...s,isDeleted:!0,updatedAt:Nn()};return t={...t,payments:{...t.payments,[e]:r}},an(t),r},jp=(e,t,s)=>{const r=ht(),a=we(e);if(!a)return s??0;const o=t?new Date(t).getTime():Date.now();if(Number.isNaN(o))return s??0;let l=0,c=!1;return Object.values(r.payments).forEach(i=>{if(i.isDeleted||we(i.caseId)!==a)return;c=!0;const u=new Date(i.paidAt).getTime();if(Number.isNaN(u)||u>o)return;const p=Number(i.amount)||0;p<=0||(l+=p)}),c?l:s??0},LN=e=>ht().insurerRulesets[e]||null,Ac=()=>{const e=ht();return Object.values(e.sheets).sort((t,s)=>{const r=new Date(t.updatedAt||t.createdAt).getTime();return new Date(s.updatedAt||s.createdAt).getTime()-r})},_N=(e,t,s,r)=>{let a=ht();a.sheets[e]&&(a=Xn(a,e,t,s,"SHEET_DELETED_BY_ADMIN","SHEET",e,{reason:r.trim()}),an(a))},ON=(e,t,s,r)=>{let a=ht();a.sheets[e]&&(a=Xn(a,e,t,s,"ADMIN_EDIT_AFTER_PAID","SHEET",e,{reason:r.trim()}),an(a))},MN=e=>{var a;const t=ht(),s=we(e);if(!s)return null;const r=(a=t.officialSheetIdByCaseId)==null?void 0:a[s];return!r||!t.sheets[r]?null:r},il=e=>{const t=ht(),s=t.sheets[e];if(!s)return null;const{lineItems:r,attachments:a}=wo(t,e);return{sheet:s,lineItems:r,attachments:a}},Ts=(e,t)=>{const s=e.sheets[t];if(!s)return e;const{lineItems:r,attachments:a}=wo(e,t),o={...s,sheetVersionNumber:s.sheetVersionNumber+1,sheetVersionHash:TN(s,r,a),updatedAt:Nn()};return{...e,sheets:{...e.sheets,[t]:o}}},Xn=(e,t,s,r,a,o,l,c)=>{const i=e.sheets[t];if(!i)return e;const u=fa("fae"),p={id:u,sheetId:t,actorUserId:s,actorRole:r,eventType:a,eventAt:Nn(),entityType:o,entityId:l??null,diffJson:c,sheetVersionNumberAtEvent:i.sheetVersionNumber,sheetVersionHashAtEvent:i.sheetVersionHash};return{...e,auditEvents:{...e.auditEvents,[u]:p}}},PN=e=>{const t=ht(),s=fa("fes"),r=Nn(),a={id:s,caseId:e.caseId,insurerId:e.insurerId??null,insurerName:e.insurerName??null,periodStart:e.periodStart??null,periodEnd:e.periodEnd??null,periodLabel:e.periodLabel??null,versionIndex:e.versionIndex,status:"DRAFT",archivedReason:null,currency:e.currency||"ILS",deductibleAmount:e.deductibleAmount??null,alreadyPaidAmount:e.alreadyPaidAmount??null,infoOnly:!!e.infoOnly,attachedToReportId:null,attachedAt:null,createdByUserId:e.createdByUserId,createdAt:r,updatedAt:r,readyAt:null,sheetVersionNumber:1,sheetVersionHash:"",insurerRulesetId:e.insurerRulesetId??null,insurerRulesetVersion:e.insurerRulesetVersion??null};let o={...t,sheets:{...t.sheets,[s]:a}};const l=we(e.caseId);return l&&(o={...o,officialSheetIdByCaseId:{...o.officialSheetIdByCaseId||{},[l]:s}}),o=Ts(o,s),o=Xn(o,s,e.createdByUserId,"FINANCE","SHEET_CREATED","SHEET",s,{caseId:e.caseId,insurerId:e.insurerId??null,insurerName:e.insurerName??null}),an(o),o.sheets[s]},FN=e=>{let t=ht();const s=t.sheets[e];if(!s)return console.warn("deleteFinancialExpenseSheet: sheet not found",e),t;const r={...t.sheets};delete r[e];const a={};Object.values(t.lineItems).forEach(i=>{i.sheetId!==e&&(a[i.id]=i)});const o={};Object.values(t.attachments).forEach(i=>{i.sheetId!==e&&(o[i.id]=i)});let l={...t.officialSheetIdByCaseId||{}};const c=we(s.caseId);if(c&&l[c]===e){const i=Object.values(r).filter(u=>we(u.caseId)===c).sort((u,p)=>{const y=new Date(u.updatedAt||u.createdAt).getTime();return new Date(p.updatedAt||p.createdAt).getTime()-y});i.length>0?l[c]=i[0].id:delete l[c]}return t={...t,sheets:r,lineItems:a,attachments:o,officialSheetIdByCaseId:l},an(t),t},BN=e=>{let t=ht();const s=t.sheets[e.sheetId];if(!s)return console.warn("updateFinancialExpenseSheetMeta: sheet not found",e.sheetId),null;const r={...s,...e.patch,updatedAt:Nn()};t={...t,sheets:{...t.sheets,[e.sheetId]:r}};const a={};return Object.keys(e.patch).forEach(o=>{const l=s[o],c=r[o];l!==c&&(a[o]={before:l,after:c})}),t=Ts(t,e.sheetId),t=Xn(t,e.sheetId,e.actorUserId,e.actorRole,"SHEET_META_UPDATED","SHEET",e.sheetId,Object.keys(a).length?a:void 0),an(t),t.sheets[e.sheetId]},$N=e=>{let t=ht();if(!t.sheets[e.sheetId])return console.warn("addFinancialExpenseLineItem: sheet not found",e.sheetId),null;const s=fa("fli"),r=Nn(),a={id:s,sheetId:e.sheetId,kind:e.kind,expenseType:e.expenseType??null,providerName:e.providerName??null,providerId:e.providerId??null,description:e.description,date:e.date??null,quantity:e.quantity??null,unitPrice:e.unitPrice??null,vatRate:e.vatRate??null,isIncludedInRequestedAmount:e.isIncludedInRequestedAmount??!0,lineNetAmount:e.lineNetAmount??null,lineVatAmount:e.lineVatAmount??null,lineTotalAmount:e.lineTotalAmount??null,attachmentId:e.attachmentId??null,createdAt:r,updatedAt:r};return t={...t,lineItems:{...t.lineItems,[s]:a}},t=Ts(t,e.sheetId),t=Xn(t,e.sheetId,e.actorUserId,e.actorRole,"LINE_ITEM_CREATED","LINE_ITEM",s,{kind:e.kind,description:e.description,amount:e.lineTotalAmount??null}),an(t),a},HN=e=>{let t=ht();const s=t.lineItems[e.lineItemId];if(!s||s.sheetId!==e.sheetId)return console.warn("updateFinancialExpenseLineItem: line item not found",e.lineItemId),null;const r={...s,...e.patch,updatedAt:Nn()};t={...t,lineItems:{...t.lineItems,[e.lineItemId]:r}};const a={};return Object.keys(e.patch).forEach(o=>{const l=s[o],c=r[o];l!==c&&(a[o]={before:l,after:c})}),t=Ts(t,e.sheetId),t=Xn(t,e.sheetId,e.actorUserId,e.actorRole,"LINE_ITEM_UPDATED","LINE_ITEM",e.lineItemId,Object.keys(a).length?a:void 0),an(t),t.lineItems[e.lineItemId]},UN=e=>{let t=ht();const s=t.lineItems[e.lineItemId];if(!s||s.sheetId!==e.sheetId)return console.warn("deleteFinancialExpenseLineItem: line item not found",e.lineItemId),!1;const{[e.lineItemId]:r,...a}=t.lineItems;return t={...t,lineItems:a},t=Ts(t,e.sheetId),t=Xn(t,e.sheetId,e.actorUserId,e.actorRole,"LINE_ITEM_DELETED","LINE_ITEM",e.lineItemId,{deleted:r}),an(t),!0},WN=e=>{let t=ht();if(!t.sheets[e.sheetId])return console.warn("addFinancialExpenseAttachment: sheet not found",e.sheetId),null;const s=fa("fat"),r=Nn(),a={id:s,sheetId:e.sheetId,fileKey:e.fileKey,originalFileName:e.originalFileName,mimeType:e.mimeType??null,sizeBytes:e.sizeBytes??null,uploadedByUserId:e.uploadedByUserId,uploadedAt:r,linkedLineItemId:e.linkedLineItemId??null};return t={...t,attachments:{...t.attachments,[s]:a}},t=Ts(t,e.sheetId),t=Xn(t,e.sheetId,e.uploadedByUserId,"FINANCE","ATTACHMENT_ADDED","ATTACHMENT",s,{fileKey:e.fileKey,originalFileName:e.originalFileName}),an(t),a},zN=e=>{let t=ht();const s=t.attachments[e.attachmentId];if(!s||s.sheetId!==e.sheetId)return console.warn("linkAttachmentToLineItem: attachment not found",e.attachmentId),null;const r=s.linkedLineItemId??null,a={...s,linkedLineItemId:e.lineItemId};if(t={...t,attachments:{...t.attachments,[e.attachmentId]:a}},e.lineItemId){const o=t.lineItems[e.lineItemId];o&&(t={...t,lineItems:{...t.lineItems,[e.lineItemId]:{...o,attachmentId:e.attachmentId,updatedAt:Nn()}}})}else if(r){const o=t.lineItems[r];o&&o.attachmentId===e.attachmentId&&(t={...t,lineItems:{...t.lineItems,[r]:{...o,attachmentId:null,updatedAt:Nn()}}})}return t=Ts(t,e.sheetId),t=Xn(t,e.sheetId,e.actorUserId,e.actorRole,"ATTACHMENT_LINKED","ATTACHMENT",e.attachmentId,{before:r,after:e.lineItemId}),an(t),t.attachments[e.attachmentId]},VN=e=>{let t=ht();const s=t.sheets[e.sheetId];if(!s)return console.warn("recordSheetReadyAttempt: sheet not found",e.sheetId),null;let r=s;if(e.success){const a=Nn();r={...s,status:"READY_FOR_REPORT",readyAt:a,updatedAt:a,insurerRulesetId:e.decisionLog.rulesetId??s.insurerRulesetId??null,insurerRulesetVersion:e.decisionLog.rulesetVersion??s.insurerRulesetVersion??null},t={...t,sheets:{...t.sheets,[e.sheetId]:r}},t=Ts(t,e.sheetId)}return t=Xn(t,e.sheetId,e.actorUserId,e.actorRole,"SHEET_READY_ATTEMPT","SHEET",e.sheetId,{success:e.success,decisionLog:e.decisionLog}),an(t),t.sheets[e.sheetId]},KN=e=>{let t=ht();const s=t.sheets[e.sheetId];if(!s||s.status!=="READY_FOR_REPORT")return s||null;const r=Nn(),a={...s,status:"DRAFT",readyAt:null,updatedAt:r};return t={...t,sheets:{...t.sheets,[e.sheetId]:a}},t=Ts(t,e.sheetId),t=Xn(t,e.sheetId,e.actorUserId,e.actorRole,"SHEET_REVERTED_TO_DRAFT","SHEET",e.sheetId,{from:"READY_FOR_REPORT",to:"DRAFT"}),an(t),t.sheets[e.sheetId]},YN=(e,t)=>{const s=ht(),r=Object.values(s.sheets),a=new Map;t.forEach(c=>{a.set(c.id,c)});const o=r.map(c=>{var E,W;const{lineItems:i}=wo(s,c.id),u=On(c,i),p=c.attachedToReportId?a.get(c.attachedToReportId):void 0,y=Object.values(s.auditEvents).filter(N=>N.sheetId===c.id&&N.diffJson&&N.diffJson.decisionLog);y.sort((N,h)=>new Date(h.eventAt).getTime()-new Date(N.eventAt).getTime());const b=((W=(E=y[0])==null?void 0:E.diffJson)==null?void 0:W.decisionLog)||null,w=b!=null&&b.blockingIssueCodes&&Array.isArray(b.blockingIssueCodes)?b.blockingIssueCodes:void 0,R=(p==null?void 0:p.expensesSheetId)===c.id?!!p.expensesOutOfSync:!1;return{sheetId:c.id,caseId:c.caseId,insurerName:c.insurerName??null,status:c.status,versionIndex:c.versionIndex,updatedAt:c.updatedAt,readyAt:c.readyAt??null,attachedAt:c.attachedAt??null,sentAt:(p==null?void 0:p.sentAt)||null,amountToRequest:u.amountToRequest,infoOnly:c.infoOnly,expensesOutOfSync:R,blockingIssueCodesLatest:w}}),l=c=>{if(!c)return!1;const i=new Date(c).getTime();return!(Number.isNaN(i)||e.dateFrom&&i<new Date(e.dateFrom).getTime()||e.dateTo&&i>new Date(e.dateTo).getTime())};return o.filter(c=>{var i,u;if(e.status&&c.status!==e.status||e.insurerId&&((i=s.sheets[c.sheetId])==null?void 0:i.insurerId)!==e.insurerId||e.insurerName&&!(c.insurerName||"").toLowerCase().includes(e.insurerName.toLowerCase()))return!1;if(e.caseIdOrSearch){const p=e.caseIdOrSearch.toLowerCase();if(!`${c.caseId} ${c.insurerName||""}`.toLowerCase().includes(p))return!1}return!(e.isInfoOnly!=null&&c.infoOnly!==e.isInfoOnly||e.minAmountToRequest!=null&&c.amountToRequest<e.minAmountToRequest||e.maxAmountToRequest!=null&&c.amountToRequest>e.maxAmountToRequest||(e.dateFrom||e.dateTo)&&!l(c.updatedAt)||e.hasMissingAttachments&&!((u=c.blockingIssueCodesLatest)!=null&&u.includes("MISSING_ATTACHMENT_REQUIRED")))}).sort((c,i)=>new Date(i.updatedAt).getTime()-new Date(c.updatedAt).getTime())},GN=e=>{const t=ht(),s=Object.values(t.sheets),r=new Map;e.forEach(i=>{r.set(i.id,i)});let a=0,o=0,l=0,c=0;return s.forEach(i=>{i.status==="READY_FOR_REPORT"&&(a+=1),i.status==="ATTACHED_TO_REPORT"&&(o+=1);const u=i.attachedToReportId?r.get(i.attachedToReportId):void 0;(u==null?void 0:u.status)==="SENT"&&(l+=1);const p=(u==null?void 0:u.expensesSheetId)===i.id&&u.expensesOutOfSync===!0,y=Object.values(t.auditEvents).some(b=>{var w;return b.sheetId===i.id&&b.eventType==="SHEET_READY_ATTEMPT"&&((w=b.diffJson)==null?void 0:w.success)===!1});(p||y)&&(c+=1)}),{readyCount:a,attachedCount:o,sentCount:l,exceptionsCount:c}},Ic=(e,t)=>{if(!e||!t)return null;const s=new Date(e).getTime(),r=new Date(t).getTime();return Number.isNaN(s)||Number.isNaN(r)?null:(r-s)/(1e3*60*60)},Tc=e=>e.length?e.reduce((s,r)=>s+r,0)/e.length:null,Rc=e=>{if(!e.length)return null;const t=[...e].sort((r,a)=>r-a),s=Math.floor(t.length/2);return t.length%2===0?(t[s-1]+t[s])/2:t[s]},cl=(e,t=5)=>({count:e.length,samples:e.slice(0,t)}),qN=e=>{let t=ht();const s=fa("fexa"),r=Nn(),a={id:s,sheetId:e.sheetId,noteType:"EXCEPTION_STATUS",value:e.value,actorUserId:e.actorUserId,createdAt:r};return t={...t,exceptionAnnotations:{...t.exceptionAnnotations,[s]:a}},an(t),a},XN=e=>{const t=ht(),s=Object.values(t.exceptionAnnotations).filter(r=>r.sheetId===e&&r.noteType==="EXCEPTION_STATUS");return s.length?(s.sort((r,a)=>new Date(a.createdAt).getTime()-new Date(r.createdAt).getTime()),s[0].value):null},JN=e=>{const t=ht(),s=Object.values(t.sheets),r=new Map;e.forEach(G=>{r.set(G.id,G)});const a=[],o=[],l=[];let c=0,i=0;const u=[],p=[],y=[],b=[],w=3,R=3,E=Date.now(),W=new Map;Object.values(t.auditEvents).forEach(G=>{const re=W.get(G.sheetId)||[];re.push(G),W.set(G.sheetId,re)});const N=[];s.forEach(G=>{const{lineItems:re}=wo(t,G.id),j=On(G,re);if(c+=j.amountToRequest,G.infoOnly&&(i+=1),G.createdAt&&G.readyAt){const D=Ic(G.createdAt,G.readyAt);D!=null&&a.push(D)}if(G.readyAt&&G.attachedAt){const D=Ic(G.readyAt,G.attachedAt);D!=null&&o.push(D)}const P=G.attachedToReportId?r.get(G.attachedToReportId):void 0;if(G.attachedAt&&(P!=null&&P.sentAt)){const D=Ic(G.attachedAt,P.sentAt);D!=null&&l.push(D)}j.amountToRequest>0&&N.push(j.amountToRequest)});let h=0;if(N.length>=5){const G=[...N].sort((j,P)=>j-P),re=Math.floor(G.length*.95)-1;h=G[Math.max(0,re)]}else N.length>0&&(h=Math.max(...N));s.forEach(G=>{var me,ce;const{lineItems:re}=wo(t,G.id),j=On(G,re),P=G.attachedToReportId?r.get(G.attachedToReportId):void 0,D=W.get(G.id)||[],O=D.filter(le=>le.diffJson&&le.diffJson.decisionLog);O.sort((le,fe)=>new Date(fe.eventAt).getTime()-new Date(le.eventAt).getTime());const z=((ce=(me=O[0])==null?void 0:me.diffJson)==null?void 0:ce.decisionLog)||null,F=z!=null&&z.blockingIssueCodes&&Array.isArray(z.blockingIssueCodes)?z.blockingIssueCodes:[];if((P==null?void 0:P.expensesSheetId)===G.id&&P.expensesOutOfSync===!0){const le=new Date(G.updatedAt||G.createdAt).getTime();Number.isNaN(le)||(E-le)/864e5>=w&&u.push({sheetId:G.id,caseId:G.caseId,reason:"DIVERGENCE_OLD",updatedAt:G.updatedAt})}(G.status==="READY_FOR_REPORT"||G.status==="ATTACHED_TO_REPORT")&&F.includes("MISSING_ATTACHMENT_REQUIRED")&&j.amountToRequest>0&&p.push({sheetId:G.id,caseId:G.caseId,reason:"MISSING_ATTACHMENTS",updatedAt:G.updatedAt}),h>0&&j.amountToRequest>=h&&y.push({sheetId:G.id,caseId:G.caseId,reason:"HIGH_AMOUNT",updatedAt:G.updatedAt,amountToRequest:j.amountToRequest});const Q=D.filter(le=>{var fe;return le.eventType==="SHEET_READY_ATTEMPT"&&((fe=le.diffJson)==null?void 0:fe.success)===!1}).length;Q>=R&&b.push({sheetId:G.id,caseId:G.caseId,reason:"REPEATED_BLOCKS",failedAttempts:Q,updatedAt:G.updatedAt})});const S=s.length,M=s.filter(G=>{const re=G.attachedToReportId?r.get(G.attachedToReportId):void 0;return(re==null?void 0:re.status)==="SENT"}).length,H=S>0?Number((i/S).toFixed(3)):null,V={draftToReadyAvgHours:Tc(a),draftToReadyMedianHours:Rc(a),readyToAttachedAvgHours:Tc(o),readyToAttachedMedianHours:Rc(o),attachedToSentAvgHours:Tc(l),attachedToSentMedianHours:Rc(l)},q={totalSheets:S,totalSentReports:M,totalAmountRequested:c,infoOnlyRatio:H},te={divergenceOld:cl(u),missingAttachments:cl(p),highAmounts:{threshold:h,...cl(y)},repeatedBlocks:{threshold:R,...cl(b)}};return{sla:V,volumes:q,exceptions:te}},QN=(e,t=10)=>{const s=ht();return Object.values(s.auditEvents).filter(r=>r.sheetId===e).sort((r,a)=>new Date(a.eventAt).getTime()-new Date(r.eventAt).getTime()).slice(0,t)},ZN=5e3,Cc=new Map,La=e=>({actorUserId:e.id,actorRole:e.role}),Ge={async listSheets(){return Ac()},async listPaymentsForCase(e){return RN(e)},getPaidToDateForSheet(e){const t=e.updatedAt||e.createdAt||new Date().toISOString();return jp(e.caseId,t,e.alreadyPaidAmount??0)},async getLatestSheetForCase(e){const t=MN(e);return t?il(t):null},async isNewFinancialModel(e){if(!e)return!1;const t=await Ac(),s=we(e);return t.some(r=>we(r.caseId)===s)},logIfMixedModel(e){if(!!!e.expensesSheetId)return;(e.expensesItems&&e.expensesItems.length>0||!!e.expenseWorksheet||!!e.expensesSum)&&console.error("[FinancialExpenses] Mixed model detected for report",e.id," expensesSheetId is set but legacy expenses fields are also populated.")},async getSheet(e){return il(e)},async getRulesetForSheet(e){const t=e.insurerRulesetId||e.insurerId||"default",s=LN(t);if(s)return s;const r=new Date().toISOString();return{insurerId:t,policyFamily:"FLEXIBLE",requiredAttachmentTypes:[],requireAttachmentPerLine:!1,requireAttachmentForExpenseTypes:[],amountThresholdRequiringAttachment:null,infoOnlyTextVariant:null,notesInternal:null,rulesetVersion:"default",updatedAt:r}},async createSheet(e,t){const s={...t,createdByUserId:e.id};return PN(s)},async createPaymentEvent(e,t){return CN(t)},async updateSheetMeta(e,t,s){const r={sheetId:t,...La(e),patch:s};return BN(r)},async addLineItem(e,t,s){const r={...s,sheetId:t,...La(e)};return $N(r)},async updateLineItem(e,t,s,r){const a={sheetId:t,lineItemId:s,...La(e),patch:r};return HN(a)},async deleteLineItem(e,t,s){const r={sheetId:t,lineItemId:s,...La(e)};return UN(r)},async softDeletePaymentEvent(e){return DN(e)},buildCumulativeExpensesSnapshot(e,t){const s=`${e}::${t||"now"}`,r=Cc.get(s),a=Date.now();if(r&&a-r.ts<ZN)return r.value;const o=il(e);if(!o)return Cc.set(s,{ts:a,value:null}),null;const l=o.sheet,c=t||l.updatedAt||l.createdAt||new Date().toISOString(),i=jp(l.caseId,c,l.alreadyPaidAmount??0),u={...l,alreadyPaidAmount:i},p=Ac(),y=we(l.caseId),b=new Date(c).getTime(),w=p.filter(M=>{if(M.id===l.id||we(M.caseId)!==y)return!1;const H=new Date(M.updatedAt||M.createdAt).getTime();return Number.isNaN(H)||Number.isNaN(b)?!0:H<=b}),R=[];w.forEach(M=>{const H=il(M.id);H&&H.lineItems.forEach(V=>{V.kind==="EXPENSE"&&R.push(V)})});const E=o.lineItems,N=[...[...R,...E]].sort((M,H)=>{const V=j=>{const P=j.date?new Date(j.date).getTime():NaN;if(!Number.isNaN(P))return P;const D=j.createdAt?new Date(j.createdAt).getTime():NaN;return Number.isNaN(D)?0:D},q=V(M),te=V(H);if(q!==te)return q-te;const G=`${M.sheetId||""}-${M.id}`,re=`${H.sheetId||""}-${H.id}`;return G.localeCompare(re)}),S={effectiveSheet:u,currentLines:E,historicalLines:R,allLines:N,opts:{isNewLine:M=>M.kind==="EXPENSE"&&M.sheetId===l.id,isHistoricalLine:M=>M.kind==="EXPENSE"&&M.sheetId!==l.id}};return Cc.set(s,{ts:a,value:S}),S},async deleteSheet(e){FN(e)},async addAttachment(e,t,s){const r={...s,sheetId:t,uploadedByUserId:e.id};return WN(r)},async linkAttachmentToLineItem(e,t,s,r){const a={sheetId:t,attachmentId:s,lineItemId:r,...La(e)};return zN(a)},async recordReadyAttempt(e,t){const s={...t,actorUserId:e.id,actorRole:e.role};return VN(s)},async revertSheetToDraft(e,t){return KN({sheetId:t,actorUserId:e.id,actorRole:e.role})},recordAdminEditAfterPaid(e,t,s){ON(t,e.id,e.role,s)},recordSheetDeletionByAdmin(e,t,s){_N(t,e.id,e.role,s)},async listSheetsForLidor(e,t,s){if(e.role!=="ADMIN"&&e.role!=="SUB_ADMIN")throw new Error("Access denied: only ADMIN or SUB_ADMIN can view financial control data.");return YN(t,s)},async getLidorCounts(e,t){if(e.role!=="ADMIN"&&e.role!=="SUB_ADMIN")throw new Error("Access denied: only ADMIN or SUB_ADMIN can view financial control data.");return GN(t)},async getLidorKpis(e,t){if(e.role!=="ADMIN"&&e.role!=="SUB_ADMIN")throw new Error("Access denied: only ADMIN or SUB_ADMIN can view financial control data.");return JN(t)},async getExceptionStatusForSheet(e,t){if(e.role!=="ADMIN"&&e.role!=="SUB_ADMIN")throw new Error("Access denied: only ADMIN or SUB_ADMIN can view financial control data.");return XN(t)},async setExceptionStatusForSheet(e,t,s){if(e.role!=="ADMIN"&&e.role!=="SUB_ADMIN")throw new Error("Access denied: only ADMIN or SUB_ADMIN can view financial control data.");return qN({sheetId:t,value:s,actorUserId:e.id})},async getSheetAuditForLidor(e,t,s=10){if(e.role!=="ADMIN"&&e.role!=="SUB_ADMIN")throw new Error("Access denied: only ADMIN or SUB_ADMIN can view financial control data.");return QN(t,s)}},eb={dashboardTitle:" ",brandName:"Lior Perry",brandSubtitle:"  ",welcomeBack:" ",roleLawyer:"",gettingStartedTitle:" ",gettingStartedBodyLine1:"  .",gettingStartedBodyLine2:"   .          .",gettingStartedStep1:"  ",gettingStartedStep2:" ",gettingStartedStep3:"  ",gettingStartedCta:"  ",searchSectionLabel:" ",searchLabel:" ",searchPlaceholder:"  , ,     ...",statusLabel:"",sortByLabel:" ",sortByUpdated:" ",sortByReportDate:" ",sortByInsured:"",onlyMyCases:"  ",clearFilters:" ",searchByOdakanit:"    ",searchOdakanitPlaceholder:"    ...",noCaseFolderFound:"       .",statsSectionLabel:"  ",statsActiveCases:" ",statsActionRequired:"  ",statsWaitingOnOthers:" ",statsFinanceTasks:"  ",statsDraftsReady:" /  ",caseListTitle:"   ",caseListHeaderTitle:" ",caseListHeaderReportNo:"REPORT NO",caseListHeaderPlaintiff:"PLAINTIFF / CLAIMANT",caseListHeaderInsured:"INSURED",caseListHeaderInsurer:"INSURER",caseListHeaderOdakanit:"  ",caseListStatusAttention:"  ",caseListStatusOpen:"  ",caseListStatusNone:"  ",caseListEmpty:"   .",caseListHintActiveOnly:"(     )",financeBannerTitle:"    ",financeBannerBody:"      .         .",bucketActionRequiredTitle:"  ",bucketActionRequiredDescription:"    .",bucketWaitingTitle:" ",bucketWaitingDescription:"   ,     .",bucketInProgressTitle:"",bucketInProgressDescription:"   .",bucketSentTitle:" / ",bucketSentDescription:"     .",emptyActionRequiredTitle:"    ",emptyActionRequiredDesc:"    ,   .",emptyWaitingTitle:"   ",emptyWaitingDesc:"      .",emptyInProgressTitle:"  ",emptyInProgressDesc:"    .",emptySentTitle:"   ",emptySentDesc:"  ,     .",emptyInProgressCta:"  ",defaultEmptyTitle:"  ",defaultEmptyDescription:"     .",untitledCase:"  ",labelInsured:"",labelPlaintiff:"",labelInsurer:" ",labelFile:" ",labelUpdated:":",labelNextStep:" :",nextStepReview:"  ",nextStepWaitingInvoices:" ",nextStepReadyToSend:" ",nextStepDraft:"  ",nextStepSent:"",nextStepContinue:" ",openContinue:" / ",preview:" ",viewSections:"  ",deleteDraftConfirm:"   ?     .",deleteDraftAria:" ",deleteTitle:"",pin:" ",unpin:" ",alertTimeBreach:" ",alertResponseDelay:" ",openNotificationsAria:" ",openNotificationsTitle:"",openNewCaseFolderAria:"  ",openNewCaseFolderTitle:"  ",openHelpCenterAria:"  ",openHelpCenterTitle:" ",logoutAria:"",logoutTitle:"",workQueuesAria:"  ",expand:"",collapse:"",statusDraft:"",statusActionRequired:" ",statusWaitingInvoices:" ",statusPendingReview:" ",statusApproved:"",statusReadyToSend:" ",statusSent:"",densityLabel:" :",densityComfortable:"",densityCompact:"",resumeLastCase:"   ",resumeLabel:"",internalFile:" ",workloadTitle:"  ",workloadActionLabel:"  ",workloadWaitingLabel:"   ",workloadDraftLabel:" ",financeReportsTitle:" /    ",financeReportsHint:"           .",financeReportsHeaderOdakanit:" ",financeReportsHeaderInsured:"",financeReportsHeaderPlaintiff:"",financeReportsHeaderStatus:" ",financeReportsHeaderUpdated:" ",financeReportsEmpty:"     .",focusModeLabel:"    ",tagNewCase:" ",tagOngoingCase:" ",notificationTitle:" ",dailySummary:" ",noNotifications:"  .",clearAll:" ",footerArchiveNote:"      "},Le=e=>eb[e],Dc=({label:e,value:t,icon:s,accentClass:r,selected:a,onClick:o})=>{const l=n.jsxs("div",{className:["flex items-center justify-between rounded-2xl border px-4 py-3 shadow-sm transition","focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-gold focus-visible:ring-offset-2",a?"border-gold bg-gold/10":"border-borderDark bg-panel hover:bg-navySecondary"].join(" "),children:[n.jsxs("div",{children:[n.jsx("p",{className:["text-[11px] uppercase tracking-wide",a?"font-bold text-textLight":"font-semibold text-textMuted"].join(" "),children:e}),n.jsx("p",{className:"mt-1 text-xl font-bold text-gray-900",children:t})]}),n.jsx("div",{className:["inline-flex h-9 w-9 items-center justify-center rounded-full",r].join(" "),"aria-hidden":"true",children:s})]});return o?n.jsx("button",{type:"button",onClick:o,className:"w-full text-left",children:l}):l},tb=({activeCases:e,actionRequired:t,waitingOnOthers:s,draftsAndReady:r,financeTasks:a,selectedFilter:o,onChangeFilter:l})=>{const c=i=>{l&&l(o===i?null:i)};return n.jsxs("section",{"aria-label":Le("statsSectionLabel"),className:"mb-6 grid gap-4 grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-3 xl:grid-cols-3",children:[n.jsx(Dc,{label:Le("statsFinanceTasks"),value:a,icon:n.jsx(D0,{className:"h-4 w-4 text-goldLight"}),accentClass:"bg-gold/20",selected:o==="FINANCE",onClick:()=>c("FINANCE")}),n.jsx(Dc,{label:Le("statsWaitingOnOthers"),value:s,icon:n.jsx(R0,{className:"h-4 w-4 text-goldLight"}),accentClass:"bg-gold/20",selected:o==="WAITING",onClick:()=>c("WAITING")}),n.jsx(Dc,{label:Le("statsDraftsReady"),value:r,icon:n.jsx(Ql,{className:"h-4 w-4 text-goldLight"}),accentClass:"bg-gold/20",selected:o==="DRAFTS",onClick:()=>c("DRAFTS")})]})};Le("statusDraft"),Le("statusActionRequired"),Le("statusWaitingInvoices"),Le("statusPendingReview"),Le("statusApproved"),Le("statusReadyToSend"),Le("statusSent");const _a=e=>(e||"").trim().toLowerCase(),Lc=e=>{const t=(e.odakanitNo||"").trim();if(t)return`odakanit:${t}`;const s=[`umr:${_a(e.marketRef)}`,`line:${_a(e.lineSlipNo)}`,`cert:${_a(e.certificateRef)}`,`insured:${_a(e.insuredName)}`,`plaintiff:${_a(e.plaintiffName)}`].filter(r=>!r.endsWith(":"));return s.length?s.join("|"):`id:${e.id}`},nb=24*60*60*1e3,sb=e=>{const t=e.updatedAt||e.reportDate;if(!t)return null;const s=new Date(t).getTime();return Number.isFinite(s)?s:null},rb=e=>{const t=sb(e);return!t||(Date.now()-t)/nb<=3?null:e.status==="DRAFT"?Le("alertResponseDelay"):e.status==="WAITING_FOR_INVOICES"||e.status==="READY_TO_SEND"?Le("alertTimeBreach"):null},ab=e=>e.status==="TASK_ASSIGNED"||e.status==="PENDING_REVIEW"||e.status==="READY_TO_SEND",ob=({report:e})=>e.expensesSheetId?e.supersededByReportId?n.jsx("span",{className:"inline-flex items-center rounded-full bg-slate-100 px-1.5 py-0.5 text-[9px] font-semibold text-slate-700 border border-slate-200",title:"        ",children:""}):n.jsx("span",{className:"inline-flex items-center rounded-full bg-emerald-50 px-1.5 py-0.5 text-[9px] font-semibold text-emerald-800 border border-emerald-200",title:"      ",children:" ()"}):null,lb=Le("brandName"),ib=Le("brandSubtitle"),cb={DRAFT:Le("statusDraft"),TASK_ASSIGNED:Le("statusActionRequired"),WAITING_FOR_INVOICES:Le("statusWaitingInvoices"),PENDING_REVIEW:Le("statusPendingReview"),APPROVED:Le("statusApproved"),READY_TO_SEND:Le("statusReadyToSend"),SENT:Le("statusSent")},Ep=e=>e==="TASK_ASSIGNED"||e==="PENDING_REVIEW"?"ACTION_REQUIRED":e==="WAITING_FOR_INVOICES"?"WAITING_ON_OTHERS":e==="READY_TO_SEND"?"IN_PROGRESS":e==="SENT"?"SENT_COMPLETED":"IN_PROGRESS",_c=e=>`lp_pins:${e}`,db=e=>`lp_dashboard_density:${e}`,ub="lp_current_report",kp=e=>`lp_pins_migrated:${e}`,mb=({user:e,reports:t,caseFolders:s,notifications:r,showNotifications:a,setShowNotifications:o,onClearNotifications:l,dailySummaryOptIn:c,setDailySummaryOptIn:i,archiveAfterMs:u,onSelectReport:p,onNewReport:y,onOpenCaseFolder:b,onLogout:w,deleteReportById:R})=>{const[E,W]=g.useState(""),[N,h]=g.useState("ALL"),[S,M]=g.useState(!0),[H,V]=g.useState(null),[q,te]=g.useState("UPDATED"),[G,re]=g.useState(()=>{if(typeof window>"u")return[];try{const Z=window.localStorage.getItem(_c(e.id)),ve=Z?JSON.parse(Z):[];return Array.isArray(ve)?ve.filter(xe=>typeof xe=="string"):[]}catch{return[]}}),[j,P]=g.useState(()=>{if(typeof window>"u")return"COMFORTABLE";try{return window.localStorage.getItem(db(e.id))==="COMPACT"?"COMPACT":"COMFORTABLE"}catch{return"COMFORTABLE"}}),D=Date.now(),O=u??Number.MAX_SAFE_INTEGER,[z,F]=g.useState(!1),[C,L]=g.useState({}),Q=g.useMemo(()=>r.filter(ve=>!ve.targetUserId||ve.targetUserId===e.id).filter(ve=>{if(!ve.reportId)return!0;const xe=t.find(Se=>Se.id===ve.reportId);return xe?xe.status!=="SENT":!0}),[r,e.id,t]),me=g.useMemo(()=>Q.filter(Z=>{if(!Z.reportId)return!1;const ve=t.find(xe=>xe.id===Z.reportId);return!(!ve||!ve.expensesSheetId||ve.status==="SENT")}).length,[Q,t]),{mine:ce,buckets:le,filteredReports:fe}=g.useMemo(()=>{const Z=t.filter(J=>{if(J.deletedAt)return!1;const he=(J.odakanitNo||"").trim();if(!he)return!0;const Re=s[he];return!(Re&&Re.closedAt)}),ve=Z.filter(J=>J.createdBy===e.id),xe=S?ve:Z,Se=N==="ALL"?xe:xe.filter(J=>J.status===N),Me=H==="FINANCE"?Se.filter(J=>!!J.expensesSheetId):Se,_e=(()=>{const J=E.trim().toLowerCase();return J?Me.filter(he=>[he.odakanitNo,he.insuredName,he.plaintiffName,he.insurerName,he.marketRef].filter(Boolean).join(" ").toLowerCase().includes(J)):Me})(),Ue=z?_e.filter(J=>ab(J)||!!rb(J)):_e,U={ACTION_REQUIRED:[],WAITING_ON_OTHERS:[],IN_PROGRESS:[],SENT_COMPLETED:[]};return Ue.forEach(J=>{const he=Ep(J.status);U[he].push(J)}),{mine:ve,buckets:U,filteredReports:Ue}},[t,s,e.id,E,N,S,z,D,O,H]),Te=g.useMemo(()=>{const Z=new Set;let ve=0,xe=0,Se=0,Me=0;return ce.forEach(_e=>{_e.status!=="SENT"&&(xe+=1,Z.add(Lc(_e))),Ep(_e.status)==="ACTION_REQUIRED"&&(ve+=1),_e.status==="READY_TO_SEND"&&(Se+=1),_e.expensesSheetId&&_e.status!=="SENT"&&(Me+=1)}),{activeCasesCount:Z.size,actionRequiredCount:ve,draftsInWorkCount:xe,readyToSendCount:Se,financeTasksCount:Me}},[ce]),{activeCasesCount:ge,actionRequiredCount:Be,draftsInWorkCount:Ye,readyToSendCount:Ve,financeTasksCount:He}=Te,ct=g.useMemo(()=>ce.filter(Z=>Z.status==="WAITING_FOR_INVOICES").length,[ce]),X=ce.filter(Z=>!!Z.expensesSheetId&&Z.status!=="SENT");g.useEffect(()=>{const ve=Array.from(new Set(X.map(xe=>xe.expensesSheetId).filter(xe=>!!xe))).filter(xe=>!C[xe]);ve.length&&ve.forEach(xe=>{(async()=>{try{const Se=await Ge.getSheet(xe);if(!Se)return;const Me=On(Se.sheet,Se.lineItems);L(_e=>({..._e,[xe]:Me}))}catch{}})()})},[X,C]);const se=g.useMemo(()=>{const Z=new Map,ve=Se=>{const Me=Zl(Se);if(!Me)return"";const _e=Me.split(" - ");return _e.length<=2?Me:_e[_e.length-2]||Me};return ce.forEach(Se=>{if(!Se.odakanitNo)return;const Me=Se.odakanitNo.trim();if(!Me)return;const _e=Z.get(Me)||{odakanitNo:Me,insuredName:Se.insuredName||void 0,plaintiffName:Se.plaintiffName||void 0,insurerName:Se.insurerName||void 0,latestUpdatedAt:null,latestReportTitle:void 0,latestReportNumber:void 0,nextReportNumber:void 0,hasOpenWork:!1,hasUrgentWork:!1},Ue=Se.updatedAt||Se.reportDate,U=Ue&&new Date(Ue).getTime()||0,J=_e.latestUpdatedAt&&new Date(_e.latestUpdatedAt).getTime()||0;U>=J&&(_e.latestUpdatedAt=Ue||_e.latestUpdatedAt||null,_e.insuredName=Se.insuredName||_e.insuredName,_e.plaintiffName=Se.plaintiffName||_e.plaintiffName,_e.insurerName=Se.insurerName||_e.insurerName,_e.latestReportTitle=ve(Se)),Se.status!=="SENT"&&!Se.deletedAt&&(_e.hasOpenWork=!0),(Se.status==="TASK_ASSIGNED"||Se.status==="WAITING_FOR_INVOICES"||Se.status==="PENDING_REVIEW"||Se.status==="READY_TO_SEND")&&(_e.hasUrgentWork=!0),Z.set(Me,_e)}),Array.from(Z.values()).map(Se=>{var J;const Me=Se.odakanitNo.trim(),_e=[],Ue=s[Me];(J=Ue==null?void 0:Ue.sentReports)!=null&&J.length&&Ue.sentReports.forEach(he=>{typeof he.reportNo=="number"&&he.reportNo>0&&_e.push(he.reportNo)}),t.forEach(he=>{var Re;if((he.odakanitNo||"").trim()===Me&&he.status==="SENT")if(typeof he.reportNumber=="number"&&he.reportNumber>0)_e.push(he.reportNumber);else{const de=(((Re=he.reportHistory)==null?void 0:Re.length)||0)+1;_e.push(de)}});const U=_e.length?Math.max(..._e):0;return{...Se,latestReportNumber:U||void 0,nextReportNumber:(U||0)+1}}).sort((Se,Me)=>{const _e=Se.latestUpdatedAt&&new Date(Se.latestUpdatedAt).getTime()||0;return(Me.latestUpdatedAt&&new Date(Me.latestUpdatedAt).getTime()||0)-_e})},[ce]);g.useMemo(()=>new Set(G),[G]);const I=Z=>{p(Z.id)},ae=Z=>{const ve=H===Z?null:Z;switch(V(ve),ve){case"ACTION":h("TASK_ASSIGNED");break;case"WAITING":h("WAITING_FOR_INVOICES");break;case"DRAFTS":h("READY_TO_SEND");break;case"FINANCE":h("ALL");break;case"ACTIVE":h("ALL");break;default:h("ALL");break}};N!=="ALL"||E.trim(),g.useEffect(()=>{if(!a)return;const Z=ve=>{ve.key==="Escape"&&o(!1)};return window.addEventListener("keydown",Z),()=>window.removeEventListener("keydown",Z)},[a,o]),g.useEffect(()=>{if(typeof window>"u"||!t.length)return;const Z=kp(e.id);if(window.localStorage.getItem(Z)!=="1")try{const xe=window.localStorage.getItem(_c(e.id));if(!xe){window.localStorage.setItem(Z,"1");return}const Se=JSON.parse(xe);if(!Array.isArray(Se)){window.localStorage.setItem(Z,"1");return}const Me=[],_e=Ue=>{Ue&&(Me.includes(Ue)||Me.push(Ue))};Se.forEach(Ue=>{if(typeof Ue!="string")return;const U=Ue.trim();if(!U)return;const J=U.toLowerCase();if(J.startsWith("odakanit:")||J.startsWith("umr:")||J.startsWith("line:")||J.startsWith("cert:")||J.startsWith("insured:")||J.startsWith("plaintiff:")||J.startsWith("id:")){_e(U);return}const Re=t.find(de=>Lc(de)===U?!0:de.id===U||de.odakanitNo&&de.odakanitNo===U||de.marketRef&&de.marketRef===U);_e(Re?Lc(Re):`odakanit:${U}`)}),re(Me),window.localStorage.setItem(_c(e.id),JSON.stringify(Me)),window.localStorage.setItem(Z,"1")}catch{window.localStorage.setItem(kp(e.id),"1")}},[t,e.id]),g.useMemo(()=>{if(!ce.length)return null;if(typeof window<"u")try{const ve=window.localStorage.getItem(ub),xe=ve?ce.find(Se=>Se.id===ve&&!Se.deletedAt):null;if(xe)return xe}catch{}return[...ce].sort((ve,xe)=>{const Se=Ue=>{const U=Ue.updatedAt||Ue.reportDate;return U&&new Date(U).getTime()||0},Me=Se(ve);return Se(xe)-Me})[0]||null},[ce]);const ne=()=>n.jsxs("div",{className:"relative",children:[n.jsxs("button",{type:"button",onClick:()=>o(!a),className:"relative inline-flex h-9 w-9 items-center justify-center rounded-full bg-gold/10 text-xs font-medium text-blue-700 hover:bg-blue-100 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-lpBlue focus-visible:ring-offset-2","aria-label":Le("openNotificationsAria"),title:Le("openNotificationsTitle"),children:[n.jsx(Xl,{className:"h-4 w-4","aria-hidden":"true"}),me>0&&n.jsx("span",{className:"absolute -top-1.5 -right-1.5 inline-flex h-4 min-w-[16px] items-center justify-center rounded-full bg-red-500 px-1 text-[10px] font-bold text-white",children:me})]}),a&&n.jsxs("div",{className:"absolute right-0 mt-2 w-80 rounded-lg border border-borderDark bg-panel text-xs shadow-xl z-50",children:[n.jsxs("div",{className:"flex items-center justify-between border-b px-3 py-2",children:[n.jsx("span",{className:"font-semibold text-textLight",children:Le("notificationTitle")}),n.jsxs("label",{className:"flex items-center gap-1 text-[11px] text-textMuted",children:[n.jsx("input",{type:"checkbox",checked:c,onChange:Z=>i(Z.target.checked),className:"h-3 w-3 rounded border-borderDark text-gold focus:ring-gold"}),Le("dailySummary")]})]}),n.jsxs("div",{className:"max-h-64 overflow-auto divide-y",children:[Q.length===0&&n.jsx("div",{className:"p-4 text-center text-textMuted",children:Le("noNotifications")}),Q.map(Z=>n.jsxs("div",{className:"p-3 space-y-1",children:[n.jsx("p",{className:"font-medium text-textLight",children:Z.message}),n.jsx("p",{className:"text-[10px] text-textMuted",children:new Date(Z.createdAt).toLocaleString()}),Z.reportId&&n.jsx("button",{type:"button",className:"mt-1 text-[11px] text-blue-700 hover:underline",onClick:()=>{p(Z.reportId),o(!1)},children:' " '})]},Z.id))]}),n.jsx("div",{className:"px-3 py-2 text-right",children:n.jsx("button",{type:"button",onClick:l,className:"text-[11px] font-medium text-red-500 hover:underline",children:Le("clearAll")})})]})]}),[ye,Pe]=g.useState(""),[ke,De]=g.useState(!1),[Qe,Ke]=g.useState(-1),Fe=g.useMemo(()=>{const Z=ye.trim();if(!Z)return[];const ve=Z.toLowerCase(),xe=Object.values(s),Se=xe.filter(Ue=>Ue.odakanitNo.toLowerCase().startsWith(ve)),Me=xe.filter(Ue=>!Ue.odakanitNo.toLowerCase().startsWith(ve)&&Ue.odakanitNo.toLowerCase().includes(ve));return[...Se,...Me].slice(0,8).map(Ue=>({odakanitNo:Ue.odakanitNo,insuredName:Ue.insuredName,plaintiffName:Ue.plaintiffName}))},[ye,s]);return g.useEffect(()=>{if(!ye.trim()){De(!1),Ke(-1);return}Fe.length>0?(De(!0),Ke(0)):(De(!1),Ke(-1))},[ye,Fe.length]),n.jsx("div",{className:"min-h-screen bg-navySecondary px-0 pb-6 text-[15px]",dir:"rtl",lang:"he",children:n.jsxs("div",{className:"w-full px-6 md:px-8 lg:px-10 xl:px-12",children:[n.jsxs("header",{className:"sticky top-0 z-20 mb-4 flex flex-col gap-3 border-b border-borderDark bg-panel/80 pb-3 pt-2 backdrop-blur-sm md:flex-row md:items-center md:justify-between",children:[n.jsxs("div",{children:[n.jsx("h1",{className:"text-2xl font-bold text-gold font-heebo",children:Le("dashboardTitle")}),n.jsxs("p",{className:"text-base text-textMuted text-right",children:[n.jsx("span",{className:"font-semibold",children:lb})," ",n.jsx("span",{className:"text-textMuted",children:ib}),n.jsx("span",{className:"text-textMuted",children:"  "}),Le("welcomeBack"),","," ",n.jsx("span",{className:"font-semibold",children:e.name})," ",n.jsxs("span",{className:"text-textMuted",children:["(",Le("roleLawyer"),")"]})]})]}),n.jsxs("div",{className:"flex flex-wrap items-center justify-start gap-2 md:justify-end",children:[n.jsx("button",{type:"button",onClick:y,className:"inline-flex h-9 w-9 items-center justify-center rounded-full bg-lpBlue text-sm font-semibold text-white shadow-sm hover:bg-blue-900 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-lpBlue focus-visible:ring-offset-2","aria-label":Le("openNewCaseFolderAria"),title:Le("openNewCaseFolderTitle"),children:n.jsx(_u,{className:"h-4 w-4","aria-hidden":"true"})}),ne(),n.jsx("button",{type:"button",className:"inline-flex h-9 w-9 items-center justify-center rounded-full bg-gold/10 text-sm font-medium text-blue-700 hover:bg-blue-100 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-lpBlue focus-visible:ring-offset-2",onClick:()=>{const Z=new CustomEvent("openUserGuide");window.dispatchEvent(Z)},"aria-label":Le("openHelpCenterAria"),title:Le("openHelpCenterTitle"),children:n.jsx(Cu,{className:"h-4 w-4","aria-hidden":"true"})}),n.jsx("button",{type:"button",onClick:w,className:"inline-flex h-9 w-9 items-center justify-center rounded-full text-sm font-semibold text-red-600 hover:bg-red-50 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-red-500 focus-visible:ring-offset-2","aria-label":Le("logoutAria"),title:Le("logoutTitle"),children:n.jsx(ch,{className:"h-4 w-4","aria-hidden":"true"})})]})]}),!1,n.jsxs("section",{className:"mb-3 rounded-2xl border border-borderDark bg-panel px-4 py-3 text-xs text-textLight shadow-sm",children:[n.jsx("h2",{className:"mb-1 text-sm font-semibold text-textLight",children:Le("workloadTitle")}),n.jsxs("div",{className:"flex flex-wrap gap-3 text-[11px] text-textLight mb-2",children:[n.jsxs("span",{children:[He," ",Le("statsFinanceTasks")]}),n.jsxs("span",{children:[ct," ",Le("statsWaitingOnOthers")]}),n.jsxs("span",{children:[Ve," ",Le("statsDraftsReady")]})]}),n.jsx("div",{className:"max-h-40 overflow-y-auto rounded-xl border border-dashed border-borderDark bg-navySecondary px-3 py-2",children:ce.filter(Z=>Z.status!=="SENT").length===0?n.jsx("p",{className:"text-[11px] text-textMuted",children:Le("emptyInProgressTitle")}):n.jsx("ul",{className:"space-y-1 text-[11px]",children:ce.filter(Z=>Z.status!=="SENT").sort((Z,ve)=>{const xe=Se=>{const Me=Se.updatedAt||Se.reportDate;return Me&&new Date(Me).getTime()||0};return xe(ve)-xe(Z)}).map(Z=>n.jsxs("li",{className:"flex items-center justify-between gap-2 border-b border-borderDark/70 pb-1 last:border-b-0",children:[n.jsxs("button",{type:"button",onClick:()=>I(Z),className:"flex-1 text-right hover:text-gold",children:[n.jsx("span",{className:"font-semibold",children:Z.insuredName||Z.plaintiffName||Le("untitledCase")}),Z.odakanitNo&&n.jsxs("span",{className:"text-textMuted",children:["  ",Z.odakanitNo]})]}),n.jsxs("span",{className:"whitespace-nowrap text-[10px] text-textMuted flex items-center gap-1",children:[n.jsx("span",{children:cb[Z.status]}),n.jsx(ob,{report:Z})]})]},Z.id))})})]}),!1,n.jsxs("section",{className:"mb-3 rounded-2xl border border-borderDark bg-panel px-4 py-3 text-xs text-textLight shadow-sm",children:[n.jsxs("div",{className:"flex items-center justify-between mb-2",children:[n.jsx("h2",{className:"text-sm font-semibold text-textLight",children:Le("caseListTitle")}),n.jsxs("span",{className:"text-[11px] text-textMuted",children:[se.length," ",Le("statsActiveCases")]})]}),n.jsx("p",{className:"mb-2 text-[11px] text-textMuted",children:Le("caseListHintActiveOnly")}),se.length===0?n.jsx("p",{className:"text-[11px] text-textMuted",children:Le("caseListEmpty")}):n.jsx("div",{className:"overflow-x-auto",children:n.jsxs("table",{className:"min-w-full table-fixed text-[11px]",children:[n.jsx("thead",{children:n.jsxs("tr",{className:"border-b border-borderDark bg-navySecondary",children:[n.jsx("th",{className:"px-2 py-1 text-right font-semibold w-32",children:Le("caseListHeaderOdakanit")}),n.jsx("th",{className:"px-2 py-1 text-right font-semibold w-40",children:Le("caseListHeaderInsurer")}),n.jsx("th",{className:"px-2 py-1 text-right font-semibold w-40",children:Le("caseListHeaderInsured")}),n.jsx("th",{className:"px-2 py-1 text-right font-semibold w-40",children:Le("caseListHeaderPlaintiff")}),n.jsx("th",{className:"px-2 py-1 text-right font-semibold w-20",children:Le("caseListHeaderReportNo")}),n.jsx("th",{className:"px-2 py-1 text-right font-semibold w-20",children:Le("caseListHeaderNextReportNo")??"Next report"})]})}),n.jsx("tbody",{children:se.map((Z,ve)=>{const xe=Z.hasUrgentWork,Se=Z.hasOpenWork,Me=ve%2===0?"bg-panel":"bg-navySecondary",_e=xe?"border-l-4 border-red-400 bg-red-50/80":Se?"border-l-4 border-amber-300 bg-amber-50/70":"border-l border-transparent";return n.jsxs("tr",{className:`cursor-pointer border-b border-borderDark ${Me} ${_e}`,onClick:()=>b(Z.odakanitNo),children:[n.jsx("td",{className:"px-2 py-1 text-right font-mono text-[11px]",children:n.jsx("button",{type:"button",className:"text-gold hover:underline",onClick:()=>b(Z.odakanitNo),children:Z.odakanitNo})}),n.jsx("td",{className:"px-2 py-1 text-right",children:Z.insurerName||""}),n.jsx("td",{className:"px-2 py-1 text-right",children:Z.insuredName||""}),n.jsx("td",{className:"px-2 py-1 text-right",children:Z.plaintiffName||""}),n.jsx("td",{className:"px-2 py-1 text-right font-mono text-[11px]",children:Z.latestReportNumber??""}),n.jsx("td",{className:"px-2 py-1 text-right font-mono text-[11px]",children:Z.nextReportNumber??(Z.latestReportNumber||0)+1})]},Z.odakanitNo)})})]})})]}),!1,!1,n.jsx(tb,{activeCases:ge,actionRequired:Be,waitingOnOthers:ct,draftsAndReady:Ve,financeTasks:He,selectedFilter:H,onChangeFilter:ae}),n.jsxs("section",{className:"mb-3 rounded-2xl border border-emerald-100 bg-panel px-4 py-3 text-xs text-textLight shadow-sm",children:[n.jsxs("div",{className:"flex items-center justify-between mb-2",children:[n.jsx("h2",{className:"text-sm font-semibold text-textLight",children:Le("financeReportsTitle")}),n.jsx("span",{className:"text-[11px] text-textMuted",children:He})]}),n.jsx("p",{className:"mb-2 text-[11px] text-textMuted",children:Le("financeReportsHint")}),X.length===0?n.jsx("p",{className:"text-[11px] text-textMuted",children:Le("financeReportsEmpty")}):n.jsx("div",{className:"overflow-x-auto",children:n.jsxs("table",{className:"min-w-full table-fixed text-[11px]",children:[n.jsx("thead",{children:n.jsxs("tr",{className:"border-b border-borderDark bg-navySecondary",children:[n.jsx("th",{className:"px-2 py-1 text-right font-semibold w-48",children:Le("caseListHeaderTitle")}),n.jsx("th",{className:"px-2 py-1 text-right font-semibold w-20",children:Le("caseListHeaderReportNo")}),n.jsx("th",{className:"px-2 py-1 text-right font-semibold w-40",children:Le("caseListHeaderPlaintiff")}),n.jsx("th",{className:"px-2 py-1 text-right font-semibold w-40",children:Le("caseListHeaderInsured")}),n.jsx("th",{className:"px-2 py-1 text-right font-semibold w-40",children:Le("caseListHeaderInsurer")}),n.jsx("th",{className:"px-2 py-1 text-right font-semibold w-32",children:Le("caseListHeaderOdakanit")})]})}),n.jsx("tbody",{children:X.slice().sort((Z,ve)=>{const xe=Se=>{const Me=Se.updatedAt||Se.reportDate;return Me&&new Date(Me).getTime()||0};return xe(ve)-xe(Z)}).map(Z=>{var _e;const ve=Zl(Z),xe=ve.split(" - "),Se=xe.length>2&&xe[xe.length-2]||ve,Me=(((_e=Z.reportHistory)==null?void 0:_e.length)||0)+1;return n.jsxs("tr",{className:"cursor-pointer border-b border-borderDark hover:bg-emerald-50/60",onClick:()=>{Z.odakanitNo?b(Z.odakanitNo):I(Z)},children:[n.jsxs("td",{className:"px-2 py-1 text-right",children:[n.jsx("div",{className:"font-semibold text-textLight",children:Se||""}),Z.updatedAt&&n.jsx("div",{className:"text-[10px] text-textMuted",children:new Date(Z.updatedAt).toLocaleString("he-IL")})]}),n.jsx("td",{className:"px-2 py-1 text-right font-mono text-[11px]",children:Me}),n.jsx("td",{className:"px-2 py-1 text-right",children:Z.plaintiffName||""}),n.jsx("td",{className:"px-2 py-1 text-right",children:Z.insuredName||""}),n.jsx("td",{className:"px-2 py-1 text-right",children:Z.insurerName||""}),n.jsx("td",{className:"px-2 py-1 text-right font-mono text-[11px]",children:Z.odakanitNo||""})]},Z.id)})})]})})]}),!1]})})},pb="modulepreload",fb=function(e){return"/"+e},Ap={},xb=function(t,s,r){let a=Promise.resolve();if(s&&s.length>0){document.getElementsByTagName("link");const l=document.querySelector("meta[property=csp-nonce]"),c=(l==null?void 0:l.nonce)||(l==null?void 0:l.getAttribute("nonce"));a=Promise.allSettled(s.map(i=>{if(i=fb(i),i in Ap)return;Ap[i]=!0;const u=i.endsWith(".css"),p=u?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${i}"]${p}`))return;const y=document.createElement("link");if(y.rel=u?"stylesheet":pb,u||(y.as="script"),y.crossOrigin="",y.href=i,c&&y.setAttribute("nonce",c),document.head.appendChild(y),u)return new Promise((b,w)=>{y.addEventListener("load",b),y.addEventListener("error",()=>w(new Error(`Unable to preload CSS for ${i}`)))})}))}function o(l){const c=new Event("vite:preloadError",{cancelable:!0});if(c.payload=l,window.dispatchEvent(c),!c.defaultPrevented)throw l}return a.then(l=>{for(const c of l||[])c.status==="rejected"&&o(c.reason);return t().catch(o)})},hb={:"January",:"February",:"March",:"April",:"May",:"June",:"July",:"August",:"September",:"October",:"November",:"December"},gb=e=>{let t=e.trim();return t=t.replace(/Reporl/gi,"Report"),t=t.replace(/Rep0rt/gi,"Report"),t=t.replace(/Repcrt/gi,"Report"),t=t.replace(/\s+/g," "),t},yb=e=>{try{let t=e;Object.entries(hb).forEach(([r,a])=>{const o=new RegExp(r,"gi");t=t.replace(o,a)});const s=new Date(t);return Number.isNaN(s.getTime())?void 0:s.toISOString().slice(0,10)}catch{return}};async function Nb(e){var t,s,r;try{const o=await(await xb(()=>import("./index-D-ffnTCE.js").then(E=>E.i),[])).recognize(e,"eng+heb",{logger:()=>{}}),l=((t=o==null?void 0:o.data)==null?void 0:t.lines)||((r=(s=o==null?void 0:o.data)==null?void 0:s.text)==null?void 0:r.split(/\r?\n/).filter(E=>E.trim().length>0).map(E=>({text:E})))||[],c=[],i={},u="(January|February|March|April|May|June|July|August|September|October|November|December||||||||||||)",p=new RegExp(`Report\\s*(\\d+)\\s*-\\s*(.*?),\\s*(${u}\\s+\\d{1,2},\\s*\\d{4})\\.?$`,"i"),y=/^\s*(Line\s*Slip\s*No\.?|LineSlip\s*No\.?)\s*[:\-]?\s*(.+)\s*$/i,b=/^\s*Unique\s+Market\s+Ref\.?\s*[:\-]?\s*(.+)\s*$/i,w=/^\s*Insured\s*[:\-]?\s*(.+)\s*$/i,R=/^\s*(Plaintiff|Claimant)\s*[:\-]?\s*(.+)\s*$/i;return l.forEach(E=>{const W=E.text||"";if(!W.trim())return;const N=gb(W),h=N.match(p);if(h){const q=Number.parseInt(h[1],10),te=(h[2]||"").trim().replace(/[.,]\s*$/,""),G=h[3]||"",re=yb(G);if(!q||!re||!te||te.length<2)return;c.push({reportNo:q,title:te,sentAt:re,rawLine:W,confidence:typeof E.confidence=="number"?Math.round(E.confidence):void 0});return}const S=N.match(y);S&&!i.lineSlipNo&&(i.lineSlipNo=S[2].trim());const M=N.match(b);M&&!i.marketRef&&(i.marketRef=M[1].trim());const H=N.match(w);H&&!i.insuredName&&(i.insuredName=H[1].trim());const V=N.match(R);V&&!i.plaintiffOrClaimant&&(i.plaintiffOrClaimant=V[2].trim())}),c.sort((E,W)=>(E.reportNo||0)-(W.reportNo||0)),{previousReports:c,identifiers:i}}catch(a){return console.error("OCR failed",a),{previousReports:[],identifiers:{}}}}const Ip="seedShortcutsStickerCollapsed_v1",bb=()=>{const[e,t]=g.useState(()=>{if(typeof window>"u")return!1;try{return window.localStorage.getItem(Ip)==="1"}catch{return!1}});return g.useEffect(()=>{if(!(typeof window>"u"))try{window.localStorage.setItem(Ip,e?"1":"0")}catch{}},[e]),n.jsx("div",{className:"fixed bottom-4 right-4 z-[260] max-w-xs text-[11px] text-slate-800",style:{pointerEvents:"none"},children:n.jsxs("div",{className:"rounded-xl shadow-lg border border-amber-200 bg-amber-50/95 px-3 py-2",style:{pointerEvents:"auto"},children:[n.jsxs("div",{className:"flex items-center justify-between gap-2 mb-1",children:[n.jsxs("div",{className:"font-semibold flex items-center gap-1",children:[n.jsx("span",{children:""}),n.jsx("span",{children:"Shortcuts"})]}),n.jsx("button",{type:"button",className:"text-[10px] text-slate-600 hover:text-slate-900",onClick:()=>t(s=>!s),children:e?"+":""})]}),!e&&n.jsxs("div",{className:"space-y-1",children:[n.jsx("div",{className:"font-semibold text-[10px] text-slate-700",children:"Screenshot"}),n.jsxs("ul",{className:"space-y-0.5",children:[n.jsx("li",{children:"Ctrl /  + V  Paste screenshot"}),n.jsx("li",{children:"Ctrl /  + Shift + O  Run OCR"})]}),n.jsx("div",{className:"font-semibold text-[10px] text-slate-700 mt-1",children:"Reports table"}),n.jsxs("ul",{className:"space-y-0.5",children:[n.jsx("li",{children:"Enter  Next field"}),n.jsx("li",{children:"Shift + Enter  New report row (below)"}),n.jsx("li",{children:"Ctrl /  + Enter  New report row"})]}),n.jsx("div",{className:"font-semibold text-[10px] text-slate-700 mt-1",children:"Apply"}),n.jsx("ul",{className:"space-y-0.5",children:n.jsx("li",{children:"Ctrl /  + S  Approve & Apply"})}),n.jsx("div",{className:"font-semibold text-[10px] text-slate-700 mt-1",children:"Navigation"}),n.jsx("ul",{className:"space-y-0.5",children:n.jsx("li",{children:"Ctrl + Alt +  /   Previous / Next case"})}),n.jsx("div",{className:"text-[9px] text-slate-500 mt-1",children:"Shortcuts work only in this screen."})]})]})})},Vu="seedDraftCases_v1",Ch="seedDraftFinalized_v1",vb=7,Sb=e=>e.replace(/^\uFEFF/,"").trim().toLowerCase().replace(/[\s_]+/g,"").replace(/[^a-z0-9]/g,""),Tp=(e,t)=>{const s=[];let r="",a=!1;for(let o=0;o<e.length;o+=1){const l=e[o];if(l==='"'){a&&e[o+1]==='"'?(r+='"',o+=1):a=!a;continue}if(l===t&&!a){s.push(r),r="";continue}r+=l}return s.push(r),s.map(o=>o.trim())},wb=e=>{const s=e.split(/\r?\n/).map(R=>R.trim()).filter(R=>R.length>0);if(!s.length)return{drafts:[],error:" CSV .         ."};const r=s[0].replace(/^\uFEFF/,""),a=(r.match(/,/g)||[]).length,o=(r.match(/;/g)||[]).length,l=r.includes("	"),c=o>a?";":a>0?",":l?"	":",",i=Tp(r,c);if(!i.length)return{drafts:[],error:"  CSV  .    : odakanitNo,assignedLawyer"};const u=i.map(R=>Sb(R)),p=u.findIndex(R=>R==="odakanitno"),y=u.findIndex(R=>R==="assignedlawyer");if(p<0||y<0)return{drafts:[],error:`   .       : odakanitNo,assignedLawyer ( ). :
odakanitNo,assignedLawyer`};const b=[],w=new Set;for(let R=1;R<s.length;R+=1){const E=s[R];if(!E)continue;const W=Tp(E,c),N=W[p]||"",h=we(N);if(!h||w.has(h))continue;w.add(h);const S=(W[y]||"").trim();if(!S)return{drafts:[],error:` ${R+1}  AssignedLawyer   ${h}.    /  .`,delimiter:c};const M=S.toLowerCase();if(!Ss.find(V=>V.id.toLowerCase()===M||V.username.toLowerCase()===M)){const V=Ss.map(q=>`${q.username} (id: ${q.id})`).join(", ");return{drafts:[],error:` ${R+1}  AssignedLawyer="${S}"   ${h}     .
       (id)    .
  : ${V}`,delimiter:c}}b.push({odakanitNo:h,assignedLawyer:S,reports:[],status:"MISSING_HISTORY"})}return b.length?{drafts:b,delimiter:c}:{drafts:[],error:"    CSV.       odakanitNo assignedLawyer  .",delimiter:c}},Dh=e=>{try{return JSON.stringify(e)}catch{return"[]"}},jb=()=>{if(typeof window>"u")return[];try{const e=window.localStorage.getItem(Vu);if(!e)return[];const t=JSON.parse(e);return Array.isArray(t)?t:[]}catch{return[]}},Eb=e=>{if(!(typeof window>"u"))try{window.localStorage.setItem(Vu,Dh(e))}catch{}},kb=()=>{if(typeof window>"u")return!1;try{return window.localStorage.getItem(Ch)==="1"}catch{return!1}},Ab=()=>{if(!(typeof window>"u"))try{window.localStorage.setItem(Ch,"1")}catch{}},Ib=(e,t,s=vb)=>{if(!e)return!1;const{odakanitNo:r,seededAt:a,seedSourceLastReportNo:o,seedSourceLastReportDate:l}=e,c=we(r);if(!c||!!!(a||o||l))return!1;const u=t.filter(p=>!p.deletedAt&&we(p.odakanitNo)===c);if(u.length>0){const p=typeof o=="number"?o:0,y=l?new Date(l).getTime():0;let b=0,w=0;if(u.forEach(R=>{typeof R.reportNumber=="number"&&R.reportNumber>b&&(b=R.reportNumber);const E=new Date(R.sentAt||R.reportDate).getTime();!Number.isNaN(E)&&E>w&&(w=E)}),b>p&&p>0||w>y&&y>0)return!0}if(a){const p=new Date(a).getTime();if(!Number.isNaN(p)&&(Date.now()-p)/(1e3*60*60*24)>s)return!0}return!!(a&&(o==null||Number.isNaN(o)))},Tb=({caseFolders:e,onUpdateCaseFolders:t,reports:s})=>{const[r,a]=g.useState(()=>jb()),[o,l]=g.useState(""),[c,i]=g.useState(null),[u,p]=g.useState(!1),[y,b]=g.useState(null),[w,R]=g.useState(null);g.useEffect(()=>{Eb(r)},[r]);const E=kb(),W=g.useMemo(()=>r.find(j=>j.odakanitNo===c)||null,[r,c]),N=()=>{const j=`odakanitNo,assignedLawyer
`,P=new Blob([j],{type:"text/csv;charset=utf-8;"}),D=URL.createObjectURL(P),O=document.createElement("a");O.href=D,O.download="seed-cases-template.csv",document.body.appendChild(O),O.click(),document.body.removeChild(O),URL.revokeObjectURL(D)},h=()=>{const{drafts:j,error:P,delimiter:D}=wb(o);if(P){b(P),R(null);return}b(null),j.length?R(`Loaded ${j.length} cases. Detected delimiter: "${D||","}".`):R(null),a(j)},S=()=>{const j=Dh(r),P=new Blob([j],{type:"application/json;charset=utf-8;"}),D=URL.createObjectURL(P),O=document.createElement("a");O.href=D,O.download="seedDraftCases_v1.json",document.body.appendChild(O),O.click(),document.body.removeChild(O),URL.revokeObjectURL(D)},M=()=>{window.confirm("   -Seed (   CaseFolders)?")&&(a([]),typeof window<"u"&&window.localStorage.removeItem(Vu))},H=()=>{window.confirm(" Finalize    . ?")&&Ab()},V=j=>j.status==="APPLIED"?"APPLIED":j.reports&&j.reports.length>0?"READY":"MISSING_HISTORY",q=j=>{j.reports.length&&(t(P=>{var Ye,Ve,He,ct;const D=we(j.odakanitNo);if(!D)return P;const O=P[D],z=new Date().toISOString(),F=O||{odakanitNo:D,reTemplate:(O==null?void 0:O.reTemplate)||"",insuredName:(O==null?void 0:O.insuredName)||"",insurerName:(O==null?void 0:O.insurerName)||"",plaintiffName:(O==null?void 0:O.plaintiffName)||"",marketRef:(O==null?void 0:O.marketRef)||"",lineSlipNo:(O==null?void 0:O.lineSlipNo)||"",certificateRef:(O==null?void 0:O.certificateRef)||"",createdAt:(O==null?void 0:O.createdAt)||z,updatedAt:(O==null?void 0:O.updatedAt)||z,reportIds:(O==null?void 0:O.reportIds)||[],sentReports:(O==null?void 0:O.sentReports)||[]},C=[...F.sentReports];let L=0,Q=null;j.reports.forEach(X=>{if(!X.reportNo||!X.title||!X.sentAt)return;const se=C.findIndex(ae=>ae.reportNo===X.reportNo),I={odakanitNo:D,reportNumber:X.reportNo,insurerName:F.insurerName,insuredName:j.insuredName||F.insuredName,plaintiffName:j.plaintiffName||F.plaintiffName,reportSubject:X.title,reportDate:X.sentAt};se>=0?C[se]={...C[se],reportNo:X.reportNo,sentAt:X.sentAt,snapshot:{...C[se].snapshot||{},...I}}:C.push({reportId:`seed-${D.replace(/[^\w-]+/g,"_")}-${X.reportNo}`,reportNo:X.reportNo,sentAt:X.sentAt,fileName:void 0,snapshot:I}),X.reportNo>L&&(L=X.reportNo),X.sentAt&&(!Q||X.sentAt>Q)&&(Q=X.sentAt)}),C.sort((X,se)=>(X.reportNo||0)-(se.reportNo||0));const me=((Ye=j.insuredName)==null?void 0:Ye.trim())||F.insuredName||void 0,ce=((Ve=j.plaintiffName)==null?void 0:Ve.trim())||F.plaintiffName||void 0,le=((He=j.lineSlipNo)==null?void 0:He.trim())||F.lineSlipNo||void 0,fe=((ct=j.marketRef)==null?void 0:ct.trim())||F.marketRef||void 0,Te=[];(me||ce)&&Te.push(`Re: ${me||""}${me&&ce?" / ":""}${ce||""}`.trim()),le&&Te.push(`LineSlip No. ${le}`),fe&&Te.push(`Unique Market Ref: ${fe}`);const ge=Te.join(`
`),Be={...F,insuredName:me||F.insuredName,plaintiffName:ce||F.plaintiffName,lineSlipNo:le||F.lineSlipNo,marketRef:fe||F.marketRef,assignedLawyer:j.assignedLawyer||(O==null?void 0:O.assignedLawyer),reTemplate:ge||F.reTemplate,seededAt:z,seedSourceLastReportNo:L||F.seedSourceLastReportNo,seedSourceLastReportDate:Q||F.seedSourceLastReportDate,updatedAt:z,sentReports:C};return{...P,[D]:Be}}),a(P=>P.map(D=>D.odakanitNo===j.odakanitNo?{...D,status:"APPLIED"}:D)))},te=r.map(j=>{const P=V(j),D=j.reports.length,O=D>0?j.reports.map(Q=>Q.sentAt).filter(Boolean).sort().slice(-1)[0]:"",z=e[we(j.odakanitNo)],F=Ib(z,s),C=(z==null?void 0:z.seededAt)||null,L=z!=null&&z.seedSourceLastReportNo&&z.seedSourceLastReportDate?`#${z.seedSourceLastReportNo} (${z.seedSourceLastReportDate})`:"";return{draft:j,status:P,reportsCount:D,lastDate:O,stale:F,lastSeedInfo:C,seedSummary:L}}).filter(j=>u?j.stale:!0),G=r.length,re=r.filter(j=>V(j)==="APPLIED").length;return n.jsxs("div",{className:"mt-6 border border-slate-200 rounded-xl p-4 bg-white",children:[n.jsxs("div",{className:"flex items-center justify-between mb-3",children:[n.jsxs("div",{className:"space-y-0.5",children:[n.jsx("h2",{className:"text-sm font-semibold text-slate-900",children:"Seed Existing Cases (Admin only)"}),n.jsxs("div",{className:"text-[11px] text-slate-600",children:[n.jsxs("span",{className:"font-semibold",children:[re," / ",G||0]})," ","cases completed",G>0&&re===G&&n.jsx("span",{className:"ml-2 text-emerald-600 font-medium",children:" All cases completed"})]})]}),E&&n.jsx("span",{className:"text-[11px] px-2 py-0.5 rounded-full bg-emerald-50 text-emerald-700 border border-emerald-200",children:"Finalized  read only"})]}),n.jsxs("div",{className:"grid md:grid-cols-2 gap-4 text-xs",children:[n.jsxs("div",{className:"space-y-2",children:[n.jsx("h3",{className:"font-semibold text-slate-800",children:"1) Download Template CSV"}),n.jsx("p",{className:"text-slate-600",children:"       CSV   .  : odakanitNo, assignedLawyer."}),n.jsx("button",{type:"button",className:"px-3 py-1.5 rounded bg-slate-800 text-white hover:bg-slate-900",onClick:N,children:"Download Seed Template (CSV)"})]}),n.jsxs("div",{className:"space-y-2",children:[n.jsx("h3",{className:"font-semibold text-slate-800",children:"2) Import Cases CSV"}),n.jsx("p",{className:"text-slate-600",children:"     CSV (  )  Parse.      (localStorage)."}),n.jsx("textarea",{className:"w-full border border-slate-300 rounded p-2 h-24 font-mono",value:o,onChange:j=>l(j.target.value),disabled:E}),y&&n.jsx("div",{className:"mt-1 text-[11px] text-rose-700 bg-rose-50 border border-rose-200 rounded px-2 py-1 whitespace-pre-line",children:y}),w&&!y&&n.jsx("div",{className:"mt-1 text-[11px] text-slate-600",children:w}),n.jsx("button",{type:"button",className:"px-3 py-1.5 rounded bg-blue-600 text-white hover:bg-blue-700 disabled:opacity-50",onClick:h,disabled:E,children:"Parse CSV"})]})]}),n.jsxs("div",{className:"mt-4",children:[n.jsxs("div",{className:"flex items-center justify-between mb-1",children:[n.jsx("h3",{className:"text-xs font-semibold text-slate-800",children:"Imported Cases"}),n.jsxs("label",{className:"flex items-center gap-1 text-[11px] text-slate-600",children:[n.jsx("input",{type:"checkbox",className:"rounded border-slate-300",checked:u,onChange:j=>p(j.target.checked)}),"Show only stale cases"]})]}),te.length===0?n.jsx("p",{className:"text-xs text-slate-500",children:"   ."}):n.jsx("div",{className:"border border-slate-200 rounded overflow-hidden",children:n.jsxs("table",{className:"min-w-full text-[11px]",children:[n.jsx("thead",{className:"bg-slate-50",children:n.jsxs("tr",{children:[n.jsx("th",{className:"px-2 py-1 text-right",children:"odakanitNo"}),n.jsx("th",{className:"px-2 py-1 text-right",children:"Lawyer"}),n.jsx("th",{className:"px-2 py-1 text-right",children:"Status"}),n.jsx("th",{className:"px-2 py-1 text-right",children:"Fresh / Stale"}),n.jsx("th",{className:"px-2 py-1 text-right",children:"#Reports"}),n.jsx("th",{className:"px-2 py-1 text-right",children:"Last date"}),n.jsx("th",{className:"px-2 py-1 text-right",children:"Actions"})]})}),n.jsx("tbody",{children:te.map(({draft:j,status:P,reportsCount:D,lastDate:O,stale:z,lastSeedInfo:F,seedSummary:C})=>{var L;return n.jsxs("tr",{className:`border-t border-slate-200 ${z?"bg-amber-50":""}`,children:[n.jsx("td",{className:"px-2 py-1 font-mono",children:j.odakanitNo}),n.jsx("td",{className:"px-2 py-1",children:j.assignedLawyer||((L=Ss.find(Q=>Q.id===j.assignedLawyer||Q.username===j.assignedLawyer))==null?void 0:L.name)||""}),n.jsx("td",{className:"px-2 py-1",children:P==="APPLIED"?"APPLIED":P==="READY"?"READY":"MISSING_HISTORY"}),n.jsx("td",{className:"px-2 py-1",children:P==="APPLIED"?n.jsxs("div",{className:"space-y-0.5",children:[n.jsx("div",{className:z?"text-amber-700 font-semibold":"text-emerald-700 font-semibold",children:z?"STALE":"FRESH"}),F&&n.jsxs("div",{className:"text-[9px] text-slate-500",children:["Last seeded: ",new Date(F).toLocaleDateString()]}),C&&n.jsxs("div",{className:"text-[9px] text-slate-500",children:["Seed based on ",C]})]}):n.jsx("span",{className:"text-[10px] text-slate-400",children:""})}),n.jsx("td",{className:"px-2 py-1 text-center",children:D}),n.jsx("td",{className:"px-2 py-1",children:O||""}),n.jsxs("td",{className:"px-2 py-1 text-left",children:[n.jsx("button",{type:"button",className:"px-2 py-0.5 rounded border border-slate-300 text-slate-700 hover:bg-slate-50 mr-2",onClick:()=>i(j.odakanitNo),disabled:E,children:z?"Re-seed":"Edit"}),n.jsx("button",{type:"button",className:"px-2 py-0.5 rounded border border-emerald-400 text-emerald-700 hover:bg-emerald-50 disabled:opacity-50",onClick:()=>q(j),disabled:P==="MISSING_HISTORY"||E,children:"Apply"})]})]},j.odakanitNo)})})]})})]}),W&&n.jsx("div",{className:"mt-6 border-t border-slate-200 pt-4",children:n.jsx(Rb,{draft:W,index:r.findIndex(j=>j.odakanitNo===W.odakanitNo),total:r.length,finalized:E,onChangeDraft:j=>{a(P=>P.map(D=>D.odakanitNo===j.odakanitNo?j:D))},onApply:q,onNavigateRelative:j=>{const P=r.findIndex(O=>O.odakanitNo===W.odakanitNo);if(P<0)return;const D=P+j;D<0||D>=r.length||i(r[D].odakanitNo)},onResetSeedMeta:()=>{const j=we(W.odakanitNo);j&&(t(P=>{const D=P[j];if(!D)return P;const{seededAt:O,seedSourceLastReportNo:z,seedSourceLastReportDate:F,...C}=D;return{...P,[j]:C}}),a(P=>P.map(D=>D.odakanitNo===W.odakanitNo?{...D,reports:[],status:"MISSING_HISTORY"}:D)))}})}),n.jsxs("div",{className:"mt-4 flex flex-wrap gap-2 text-xs",children:[n.jsx("button",{type:"button",className:"px-3 py-1.5 rounded border border-slate-300 text-slate-700 hover:bg-slate-50",onClick:S,children:"Export Draft JSON"}),n.jsx("button",{type:"button",className:"px-3 py-1.5 rounded border border-rose-300 text-rose-700 hover:bg-rose-50",onClick:M,disabled:E,children:"Clear Draft Only"}),n.jsx("button",{type:"button",className:"px-3 py-1.5 rounded border border-emerald-400 text-emerald-700 hover:bg-emerald-50 ml-auto disabled:opacity-50",onClick:H,disabled:E,children:"Finalize (readonly)"})]})]})};function Rb({draft:e,index:t,total:s,finalized:r,onChangeDraft:a,onApply:o,onNavigateRelative:l,onResetSeedMeta:c}){const[i,u]=g.useState(null),[p,y]=g.useState([]),[b,w]=g.useState([]),[R,E]=g.useState(!1),W=g.useRef([]),N=g.useRef(null);g.useEffect(()=>{u(null),y([]),w([])},[e.odakanitNo]),g.useEffect(()=>{const P=D=>{var L;if(!e||r)return;const O=(L=D.clipboardData)==null?void 0:L.items;if(!O||O.length===0)return;const z=Array.from(O).find(Q=>Q.type&&Q.type.startsWith("image/"));if(!z){u("Clipboard does not contain an image.");return}const F=z.getAsFile();if(!F)return;const C=new FileReader;C.onload=()=>{const Q=C.result;a({...e,screenshotDataUrl:Q}),u(null)},C.readAsDataURL(F)};return window.addEventListener("paste",P),()=>{window.removeEventListener("paste",P)}},[e,r,a]),g.useEffect(()=>{const P=D=>{const O=D.target,z=O&&(O.tagName==="INPUT"||O.tagName==="TEXTAREA"||O.isContentEditable),C=navigator.platform.toUpperCase().includes("MAC")?D.metaKey:D.ctrlKey;if(!(z&&!C)){if(C&&!D.shiftKey&&!D.altKey&&D.key.toLowerCase()==="s"){if(D.preventDefault(),!r){if(h())return;o(e)}return}if(C&&D.shiftKey&&!D.altKey&&D.key.toLowerCase()==="o"){D.preventDefault(),!r&&e.screenshotDataUrl&&!R&&te();return}if(C&&!D.shiftKey&&!D.altKey&&D.key==="Enter"){D.preventDefault(),r||S();return}if(C&&D.altKey&&(D.key==="ArrowDown"||D.key==="ArrowUp")){D.preventDefault();const L=D.key==="ArrowDown"?1:-1;if(h(!0)&&!window.confirm("This case has invalid rows. Navigate to another case anyway?"))return;l(L)}if(!C&&!D.altKey&&!D.shiftKey&&D.key==="/"){const L=document.getElementById("seed-cases-search-input");L&&(D.preventDefault(),L.focus())}}};return window.addEventListener("keydown",P),()=>{window.removeEventListener("keydown",P)}},[e,r,o,l,R]);const h=(P=!1)=>{var F;const D=[];let O=!1;if(!e.reports||e.reports.length===0)return u("   ."),!0;const z=new Set;if(e.reports.forEach((C,L)=>{const Q={};!Number.isInteger(C.reportNo)||C.reportNo<=0?Q.reportNo="     .":z.has(C.reportNo)?Q.reportNo="  .":z.add(C.reportNo),C.sentAt?Number.isNaN(new Date(C.sentAt).getTime())&&(Q.sentAt="  ."):Q.sentAt=" .",(!C.title||C.title.trim().length<2)&&(Q.title="  ( 2 )."),(Q.reportNo||Q.sentAt||Q.title)&&(O=!0),D[L]=Q}),y(D),u(O?"    .":null),O&&!P){const C=D.findIndex(L=>L.reportNo||L.sentAt||L.title);C>=0&&W.current[C]&&((F=W.current[C])==null||F.focus())}return O},S=()=>{const P=e.reports.length>0?Math.max(...e.reports.map(O=>O.reportNo||0)):0,D={...e,reports:[...e.reports,{reportNo:P+1,sentAt:"",title:""}]};a(D)},M=P=>{const D=e.reports[P],O=e.reports.length>0?Math.max(...e.reports.map(L=>L.reportNo||0)):0,F={reportNo:(D&&Number.isInteger(D.reportNo)&&D.reportNo>0?D.reportNo:O)+1,sentAt:"",title:""},C=[...e.reports];C.splice(P+1,0,F),a({...e,reports:C}),setTimeout(()=>{const L=W.current[P+1];L&&L.focus()},0)},H=(P,D)=>{P.key==="Enter"&&P.shiftKey&&!P.ctrlKey&&!P.metaKey&&!P.altKey&&(P.preventDefault(),r||M(D))},V=(P,D,O)=>{const z=e.reports.map((F,C)=>C===P?{...F,[D]:D==="reportNo"?Number(O.replace(/[^\d]/g,""))||0:O}:F);a({...e,reports:z})},q=P=>{const D=e.reports.filter((O,z)=>z!==P);a({...e,reports:D})},te=async()=>{if(e.screenshotDataUrl){E(!0);try{const{previousReports:P,identifiers:D}=await Nb(e.screenshotDataUrl);w(P);const O={...e,insuredName:D.insuredName||e.insuredName,plaintiffName:D.plaintiffOrClaimant||e.plaintiffName,lineSlipNo:D.lineSlipNo||e.lineSlipNo,marketRef:D.marketRef||e.marketRef};a(O),P.length?u(null):u("   .   .")}catch{u("OCR .   .")}finally{E(!1)}}},G=()=>{if(!b.length)return;const P=b.filter(D=>D.reportNo&&D.sentAt&&D.title).map(D=>({reportNo:D.reportNo,sentAt:D.sentAt,title:D.title}));P.length&&(a({...e,reports:P}),u(null),y([]))},re=P=>{var z;const D=(z=P.target.files)==null?void 0:z[0];if(!D)return;const O=new FileReader;O.onload=()=>{const F=O.result;a({...e,screenshotDataUrl:F}),u(null)},O.readAsDataURL(D)},j=e.screenshotDataUrl;return n.jsxs("div",{className:"mt-2 rounded-lg border border-slate-200 bg-slate-50 p-3 text-[11px] relative",children:[n.jsxs("div",{className:"flex items-center justify-between mb-2",children:[n.jsxs("div",{className:"font-semibold text-slate-800",children:["Case editor  ",e.odakanitNo," ",n.jsxs("span",{className:"text-slate-500",children:["(",t+1,"/",s,")"]})]}),n.jsxs("div",{className:"flex items-center gap-3",children:[n.jsx("button",{type:"button",className:"text-[10px] px-2 py-1 rounded border border-amber-300 text-amber-700 hover:bg-amber-50",onClick:c,disabled:r,children:"Re-seed this case"}),n.jsx("div",{className:"text-[10px] text-slate-500 hidden md:block",children:" : Ctrl+S / S  Apply, Ctrl+Enter   , Ctrl+Shift+O  OCR, Ctrl+Alt+/   "})]})]}),i&&n.jsx("div",{className:"mb-2 rounded bg-amber-50 border border-amber-200 px-2 py-1 text-[11px] text-amber-900",children:i}),n.jsxs("div",{className:"grid md:grid-cols-2 gap-3",children:[n.jsxs("div",{className:"space-y-2",children:[n.jsx("div",{className:"font-semibold text-slate-800",children:"Screenshot / OCR"}),n.jsxs("div",{ref:N,tabIndex:0,className:"border border-dashed border-slate-300 rounded-lg p-2 text-center text-slate-600 bg-white cursor-pointer hover:border-slate-400 focus:outline-none focus:ring-1 focus:ring-slate-400",onClick:()=>{var P;return(P=N.current)==null?void 0:P.focus()},children:[n.jsx("div",{className:"mb-1 font-medium text-slate-800",children:"Click here and press Ctrl+V / V to paste screenshot"}),n.jsx("div",{className:"text-[10px] text-slate-500 mb-2",children:"or choose file from disk"}),n.jsx("input",{type:"file",accept:"image/*",onChange:re,disabled:r,className:"mx-auto block text-[10px]"})]}),j&&n.jsxs("div",{className:"mt-2",children:[n.jsx("div",{className:"text-[10px] text-slate-600 mb-1",children:"Preview:"}),n.jsx("div",{className:"border border-slate-200 rounded overflow-hidden bg-white max-h-64 flex items-center justify-center",children:n.jsx("img",{src:j,alt:"Seed screenshot",className:"max-h-64"})})]}),n.jsx("div",{className:"flex items-center gap-2 mt-2",children:n.jsx("button",{type:"button",onClick:te,disabled:!j||r||R,className:"px-3 py-1.5 rounded bg-indigo-600 text-white disabled:opacity-50 text-[11px]",children:R?"Running OCR":"Extract Previous Reports from Screenshot"})}),b.length>0&&n.jsxs("div",{className:"mt-2 border border-slate-200 rounded bg-white p-2",children:[n.jsxs("div",{className:"flex items-center justify-between mb-1",children:[n.jsxs("div",{className:"font-semibold text-slate-800 text-[11px]",children:["Proposed extraction (",b.length,")"]}),n.jsx("button",{type:"button",className:"px-2 py-0.5 rounded bg-slate-800 text-white text-[10px]",onClick:G,disabled:r,children:"Apply to table"})]}),n.jsx("div",{className:"max-h-40 overflow-auto text-[10px]",children:n.jsxs("table",{className:"min-w-full border-collapse",children:[n.jsx("thead",{children:n.jsxs("tr",{className:"bg-slate-50",children:[n.jsx("th",{className:"px-1 py-0.5 text-right",children:"#"}),n.jsx("th",{className:"px-1 py-0.5 text-right",children:"Title"}),n.jsx("th",{className:"px-1 py-0.5 text-right",children:"Date"}),n.jsx("th",{className:"px-1 py-0.5 text-right",children:"Conf."})]})}),n.jsx("tbody",{children:b.map((P,D)=>n.jsxs("tr",{className:"border-t border-slate-100",children:[n.jsx("td",{className:"px-1 py-0.5 text-right",children:P.reportNo??""}),n.jsx("td",{className:"px-1 py-0.5 text-right",children:P.title||""}),n.jsx("td",{className:"px-1 py-0.5 text-right",children:P.sentAt||""}),n.jsx("td",{className:"px-1 py-0.5 text-right",children:typeof P.confidence=="number"?`${Math.round(P.confidence)}%`:""})]},D))})]})})]})]}),n.jsxs("div",{className:"space-y-3",children:[n.jsxs("div",{className:"flex items-center justify-between",children:[n.jsx("div",{className:"font-semibold text-slate-800",children:"Previous reports table"}),n.jsx("button",{type:"button",onClick:S,disabled:r,className:"px-2 py-1 rounded border border-slate-300 text-[10px] hover:bg-slate-100",children:"+ Add row (Ctrl+Enter)"})]}),n.jsx("div",{className:"border border-slate-200 rounded bg-white max-h-72 overflow-auto",children:n.jsxs("table",{className:"min-w-full text-[11px]",children:[n.jsx("thead",{className:"bg-slate-50",children:n.jsxs("tr",{children:[n.jsx("th",{className:"px-1 py-1 text-right w-16",children:"Report #"}),n.jsx("th",{className:"px-1 py-1 text-right w-32",children:"Date"}),n.jsx("th",{className:"px-1 py-1 text-right",children:"Title"}),n.jsx("th",{className:"px-1 py-1 text-left w-16"})]})}),n.jsx("tbody",{children:e.reports.length===0?n.jsx("tr",{children:n.jsx("td",{colSpan:4,className:"px-2 py-2 text-center text-slate-400 text-[10px]",children:"  .      OCR ."})}):e.reports.map((P,D)=>{var O,z,F,C,L,Q,me,ce,le;return n.jsxs("tr",{className:"border-t border-slate-100",children:[n.jsxs("td",{className:"px-1 py-1 align-top",children:[n.jsx("input",{ref:fe=>{W.current[D]=fe},type:"number",className:`w-full border rounded px-1 py-0.5 text-[11px] ${(O=p[D])!=null&&O.reportNo?"border-rose-400":"border-slate-300"}`,value:P.reportNo??"",onChange:fe=>V(D,"reportNo",fe.target.value),onKeyDown:fe=>H(fe,D),disabled:r}),((z=p[D])==null?void 0:z.reportNo)&&n.jsx("div",{className:"mt-0.5 text-[9px] text-rose-600",children:(F=p[D])==null?void 0:F.reportNo})]}),n.jsxs("td",{className:"px-1 py-1 align-top",children:[n.jsx("input",{type:"date",className:`w-full border rounded px-1 py-0.5 text-[11px] ${(C=p[D])!=null&&C.sentAt?"border-rose-400":"border-slate-300"}`,value:P.sentAt||"",onChange:fe=>V(D,"sentAt",fe.target.value),onKeyDown:fe=>H(fe,D),disabled:r}),((L=p[D])==null?void 0:L.sentAt)&&n.jsx("div",{className:"mt-0.5 text-[9px] text-rose-600",children:(Q=p[D])==null?void 0:Q.sentAt})]}),n.jsxs("td",{className:"px-1 py-1 align-top",children:[n.jsx("input",{type:"text",className:`w-full border rounded px-1 py-0.5 text-[11px] ${(me=p[D])!=null&&me.title?"border-rose-400":"border-slate-300"}`,value:P.title,onChange:fe=>V(D,"title",fe.target.value),onKeyDown:fe=>H(fe,D),disabled:r}),((ce=p[D])==null?void 0:ce.title)&&n.jsx("div",{className:"mt-0.5 text-[9px] text-rose-600",children:(le=p[D])==null?void 0:le.title})]}),n.jsx("td",{className:"px-1 py-1 align-top text-left",children:n.jsx("button",{type:"button",onClick:()=>q(D),disabled:r,className:"px-1.5 py-0.5 rounded border border-slate-300 text-[10px] text-slate-700 hover:bg-slate-100",children:""})})]},D)})})]})}),n.jsxs("div",{className:"border border-slate-200 rounded bg-white p-2 space-y-2",children:[n.jsx("div",{className:"font-semibold text-slate-800 text-[11px]",children:"Extracted identifiers"}),n.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-2 text-[11px]",children:[n.jsxs("div",{className:"space-y-1",children:[n.jsx("label",{className:"block text-[10px] text-slate-600",children:"Insured"}),n.jsx("input",{type:"text",className:"w-full border rounded px-2 py-0.5 text-[11px] border-slate-300",value:e.insuredName||"",onChange:P=>a({...e,insuredName:P.target.value}),disabled:r})]}),n.jsxs("div",{className:"space-y-1",children:[n.jsx("label",{className:"block text-[10px] text-slate-600",children:"Plaintiff / Claimant"}),n.jsx("input",{type:"text",className:"w-full border rounded px-2 py-0.5 text-[11px] border-slate-300",value:e.plaintiffName||"",onChange:P=>a({...e,plaintiffName:P.target.value}),disabled:r})]}),n.jsxs("div",{className:"space-y-1",children:[n.jsx("label",{className:"block text-[10px] text-slate-600",children:"LineSlip No."}),n.jsx("input",{type:"text",className:"w-full border rounded px-2 py-0.5 text-[11px] border-slate-300",value:e.lineSlipNo||"",onChange:P=>a({...e,lineSlipNo:P.target.value}),disabled:r})]}),n.jsxs("div",{className:"space-y-1",children:[n.jsx("label",{className:"block text-[10px] text-slate-600",children:"Unique Market Ref"}),n.jsx("input",{type:"text",className:"w-full border rounded px-2 py-0.5 text-[11px] border-slate-300",value:e.marketRef||"",onChange:P=>a({...e,marketRef:P.target.value}),disabled:r})]})]})]})]})]}),n.jsx(bb,{})]})}const dl={title:"    ",subtitle:"     ,    ",actions:{openNewReport:"  "},queueItem:{noDate:" "}},Ku=(e,t)=>{console.error(`[LP-CRM] ${e}`,t)},Cb=e=>{if(!e)return!1;const t=new Date(e);return Number.isNaN(t.getTime())?!1:t.getTime()>Date.now()},rs=e=>{const{messageHe:t,...s}=e;return t?{...s,messageHe:t}:{...s,messageHe:{MISSING_PROVIDER:"    .",MISSING_DESCRIPTION:"  .",INVALID_DATE_FUTURE:"     .",INVALID_QUANTITY:"     -0.",INVALID_UNIT_PRICE:"     .",INVALID_VAT_RATE:"     .",NEGATIVE_AMOUNT:"     .",MISSING_ATTACHMENT_REQUIRED:"      .",SHEET_STATUS_INVALID_FOR_READY:"     -READY_FOR_REPORT.",SHEET_STATUS_INVALID_FOR_ATTACH:"     .",SHEET_STATUS_INVALID_FOR_SEND:"    .",SUMS_INCONSISTENT:"     .",INFO_ONLY_INCONSISTENT:'  " "     0.',SNAPSHOT_HASH_MISMATCH:"-Hash        ."}[s.code]||"  ."}},Db=(e,t,s)=>{const r=s.filter(u=>u.severity==="ERROR").map(u=>u.code),a=s.filter(u=>u.severity==="WARNING").map(u=>u.code),o=!s.some(u=>u.code==="SUMS_INCONSISTENT"),l=!s.some(u=>u.code==="MISSING_ATTACHMENT_REQUIRED"&&u.severity==="ERROR"),c=!s.some(u=>["MISSING_PROVIDER","MISSING_DESCRIPTION"].includes(u.code)),i=!s.some(u=>u.code==="INFO_ONLY_INCONSISTENT");return{evaluatedAt:new Date().toISOString(),insurerId:e.insurerId||void 0,rulesetId:t==null?void 0:t.insurerId,rulesetVersion:t==null?void 0:t.rulesetVersion,checks:{sumsValid:o,attachmentsOk:l,requiredFieldsOk:c,infoOnlyConsistent:i},blockingIssueCodes:r,warningIssueCodes:a}},Lb=e=>{const t=[];return e.kind==="EXPENSE"&&!e.providerName&&t.push(rs({code:"MISSING_PROVIDER",severity:"ERROR",scope:"LINE_ITEM",entityId:e.id})),e.description||t.push(rs({code:"MISSING_DESCRIPTION",severity:"ERROR",scope:"LINE_ITEM",entityId:e.id})),Cb(e.date)&&t.push(rs({code:"INVALID_DATE_FUTURE",severity:"WARNING",scope:"LINE_ITEM",entityId:e.id})),e.quantity!=null&&e.quantity<=0&&t.push(rs({code:"INVALID_QUANTITY",severity:"ERROR",scope:"LINE_ITEM",entityId:e.id})),e.unitPrice!=null&&e.unitPrice<0&&t.push(rs({code:"INVALID_UNIT_PRICE",severity:"ERROR",scope:"LINE_ITEM",entityId:e.id})),e.vatRate!=null&&e.vatRate<0&&t.push(rs({code:"INVALID_VAT_RATE",severity:"ERROR",scope:"LINE_ITEM",entityId:e.id})),[e.lineNetAmount,e.lineVatAmount,e.lineTotalAmount].filter(r=>r!=null).some(r=>r<0)&&t.push(rs({code:"NEGATIVE_AMOUNT",severity:"ERROR",scope:"LINE_ITEM",entityId:e.id})),t},_b=(e,t,s,r)=>{if(!r)return[];const a=[],o={};s.forEach(c=>{o[c.id]=c});const l=r.amountThresholdRequiringAttachment??null;return t.forEach(c=>{const i=c.isIncludedInRequestedAmount!==!1,u=!!(c.attachmentId&&o[c.attachmentId]),p=c.lineTotalAmount??0;let y=!1;if(r.policyFamily==="STRICT")i&&c.kind==="EXPENSE"&&(!l||p>=l)&&(y=!0);else if(r.policyFamily==="PARTIAL"){const b=!!c.expenseType&&r.requireAttachmentForExpenseTypes.includes(c.expenseType),w=!!l&&p>=l;i&&(b||w)&&(y=!0)}else r.policyFamily==="FLEXIBLE"&&i&&c.kind==="EXPENSE"&&(!l||p>=l)&&(y=!0);if(y&&!u){const b=r.policyFamily==="FLEXIBLE"?"WARNING":"ERROR";a.push(rs({code:"MISSING_ATTACHMENT_REQUIRED",severity:b,scope:"LINE_ITEM",entityId:c.id,messageHe:b==="ERROR"?"      .":"       ."}))}}),r.requiredAttachmentTypes.length>0&&a.push(rs({code:"ATTACHMENT_TYPES_NOT_ENFORCED",severity:"INFO",scope:"SHEET",messageHe:"     ,      ."})),e.infoOnly&&a.length&&r.policyFamily,a},Ob=e=>{const{sheet:t,lineItems:s,attachments:r,ruleset:a}=e,o=[];s.forEach(i=>{o.push(...Lb(i))});const l=On(t,s);t.infoOnly&&l.amountToRequest!==0&&o.push(rs({code:"INFO_ONLY_INCONSISTENT",severity:"ERROR",scope:"SHEET"})),o.push(..._b(t,s,r,a));const c=Db(t,a,o);return{issues:o,decisionLog:c}},Rp=e=>Ob(e),Mb=e=>{if(!e)return"";const t=new Date(e);if(Number.isNaN(t.getTime()))return"";const s=String(t.getDate()).padStart(2,"0"),r=String(t.getMonth()+1).padStart(2,"0"),a=t.getFullYear();return`${s}/${r}/${a}`},ss=e=>(e??0).toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2}),ni=e=>{if(e.lineTotalAmount!=null)return e.lineTotalAmount;const t=e.lineNetAmount!=null?e.lineNetAmount:Ah(e.quantity??0,e.unitPrice??0),s=e.lineVatAmount!=null?e.lineVatAmount:Ih(t,e.vatRate??0);return Th(t,s)},Lh=(e,t,s)=>{const r=On(e,t),a=[`Expenses Table  Case ${e.caseId}`,"",`Deductible: ${ss(e.deductibleAmount??0)}`,`Payments already made: ${ss(e.alreadyPaidAmount??0)}`,`Amount to request: ${ss(r.amountToRequest)}`,"","Expenses:"],o=[],l=[];let c=0;t.forEach(p=>{var V,q;const y=Mb(p.date||null),b=p.providerName||"",w=p.description||"",R=p.kind==="EXPENSE"?"Expense":p.kind==="COMPENSATION"?p.compensationSource==="COURT"?"Compensation pursuant to a judgment":"Compensation pursuant to a settlement":"Adjustment",E=((V=s==null?void 0:s.isNewLine)==null?void 0:V.call(s,p))??!1,W=((q=s==null?void 0:s.isHistoricalLine)==null?void 0:q.call(s,p))??!1,N=ss(ni(p)),h=p.vatRate!=null?`, VAT ${p.vatRate}%`:"",S=p.isIncludedInRequestedAmount===!1?" (not included in request)":"",H=` ${y||"-"}  ${E?"[] ":W?"[] ":""}${w}${b?` (${b})`:""}  ${N} (${R}${h})${S}`;if(p.kind==="EXPENSE"){const te=ni(p);E&&(c+=te),o.push(H)}else l.push(H)}),o.length||o.push(" No expense items.");const i=s&&typeof s.newExpensesTotal=="number"?s.newExpensesTotal:c;return{text:[...a,...o,"","Adjustments and compensations:",...l.length?l:[" No adjustments or compensations."],"",...i>0?[`Current report expenses only: ${ss(i)}`]:[],`Total gross expenses: ${ss(r.grossExpensesTotal)}`,`Total deductions (Deductible + Payments already made + adjustments): ${ss(r.adjustmentsTotal)}`,`Amount to request: ${ss(r.amountToRequest)}`].join(`
`),totals:r}},si=(e,t,s)=>{const r=On(e,t),a=r.amountToRequest<=0,o=[],l=(S,M,H)=>{const V=H!=null&&H.isTotal?"total-balance-row":H!=null&&H.isSummary?"summary-row":"",q=(H==null?void 0:H.rowClass)??"",te=`${V} ${q}`.trim();o.push(`<tr class="${te}"><td>${Pb(S)}</td><td class="amount-cell">${ss(M??0)}</td></tr>`)},c=t.filter(S=>S.kind==="EXPENSE");let i=0;const u=c.reduce((S,M)=>{var D,O;const H=ni(M),V=((D=s==null?void 0:s.isNewLine)==null?void 0:D.call(s,M))??!1,q=((O=s==null?void 0:s.isHistoricalLine)==null?void 0:O.call(s,M))??!1;V&&(i+=H);const te=M.providerName?` (${M.providerName})`:"",G=M.description?`${M.description}${te}`:te||"Expense",j=`${V?"  ":q?"  ":""}${G}`;return l(j,H,{rowClass:V?"expense-row-new":q?"expense-row-history":""}),S+H},0),p=e.deductibleAmount??0;t.filter(S=>S.kind==="COMPENSATION").forEach(S=>{const M=S.compensationSource==="COURT"?"Court-awarded compensation":"Settlement compensation";l(M,ni(S))}),l("Total expenses so far",u,{isSummary:!0});const b=s&&typeof s.newExpensesTotal=="number"?s.newExpensesTotal:i;b>0&&l("Current report expenses only",b,{isSummary:!0}),l("Deductible",p,{isSummary:!0}),l("Payments already made",e.alreadyPaidAmount??0,{isSummary:!0}),l(a?"Total Balance Due (no payment requested)":"Total Balance Due",r.amountToRequest,{isTotal:!0});const w=['<div class="expenses-table-wrapper">','<table class="expenses-table">',"<thead>",'<tr><th>Expenses</th><th class="amount-cell">Amount ()</th></tr>',"</thead>","<tbody>",...o,"</tbody>","</table>","</div>"].join(""),R=t.some(S=>S.kind==="COMPENSATION"&&S.compensationSource!=="COURT"),E=t.some(S=>S.kind==="COMPENSATION"&&S.compensationSource==="COURT"),W=`${ss(r.amountToRequest)}`;let N;return E?N='<p class="expenses-payment-note">Pursuant to the judgment rendered in this matter, we kindly request that the Insurer arrange payment of the total amount set out in the attached Expenses Table, in order to bring this claim to a conclusion.<br/><br/><strong>Payment is required within 30 days of receipt of this report.</strong></p>':R?a?N='<p class="expenses-payment-note">Although a settlement has been agreed in principle, the total expenses and compensation fall within the applicable deductible. Accordingly, no payment is required from the Insurer in respect of this claim.</p>':N=`<p class="expenses-payment-note">Should the Insurer approve the settlement, we would be obliged if the Insurer could arrange payment of ${W} to the Brokers bank account in order to bring this claim to a conclusion. This amount represents an all-inclusive settlement, covering both the agreed compensation and the associated expenses. In the event that the settlement is not approved, no payment is required at this stage.</p>`:N=a?'<p class="expenses-payment-note">Given that the deductible exceeds the total expenses incurred in this matter, the Insurer is not required to make any payment in respect of this claim.</p>':`<p class="expenses-payment-note">Accordingly, we would appreciate it if the Insurer could transfer the amount of ${W} to the Brokers bank account.</p>`,{html:w+N+'<p class="expenses-payment-note">All amounts are stated in New Israeli Shekels ().</p>',totals:r}},Pb=e=>e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;"),Fb=({open:e,title:t,message:s,confirmText:r,cancelText:a,destructive:o=!1,onConfirm:l,onCancel:c})=>{const i=g.useRef(null);if(g.useEffect(()=>{if(!e)return;const y=b=>{b.key==="Escape"&&(b.stopPropagation(),c())};if(typeof window<"u"&&window.addEventListener("keydown",y),i.current)try{i.current.focus()}catch{}return()=>{typeof window<"u"&&window.removeEventListener("keydown",y)}},[e,c]),!e)return null;const u=y=>{y.target===y.currentTarget&&c()},p=o?"bg-danger text-white hover:bg-red-800":"bg-navy text-gold hover:bg-navySecondary";return n.jsx("div",{className:"fixed inset-0 z-[300] flex items-center justify-center bg-black/50",onClick:u,children:n.jsxs("div",{className:"bg-panel border border-borderDark rounded-xl shadow-xl max-w-md w-full mx-4 p-5 space-y-3",dir:"rtl",children:[n.jsx("h2",{className:"text-sm font-bold text-gold text-right",children:t}),s&&n.jsx("p",{className:"text-xs text-textMuted text-right whitespace-pre-line",children:s}),n.jsxs("div",{className:"flex justify-end gap-2 mt-4",children:[n.jsx("button",{type:"button",onClick:c,className:"px-3 py-1.5 rounded-md border border-borderDark text-xs text-textLight bg-navySecondary hover:bg-borderDark",children:a}),n.jsx("button",{type:"button",ref:i,onClick:l,className:`px-3 py-1.5 rounded-md text-xs font-semibold ${p}`,children:r})]})]})})},Bb=({user:e,sheet:t,paymentEvents:s,onChangeEvents:r})=>{const[a,o]=g.useState(""),[l,c]=g.useState(()=>new Date().toISOString().slice(0,10)),[i,u]=g.useState(""),[p,y]=g.useState(""),[b,w]=g.useState(!1),[R,E]=g.useState(null),W=async()=>{const S=Number(a);if(!Number.isFinite(S)||S<=0){E("     .");return}if(!l){E("    .");return}const H=new Date(l).getTime();if(Number.isNaN(H)){E("   .");return}const V=Date.now();if(H>V){E("     .");return}E(null),w(!0);try{const q=new Date(l).toISOString(),te=await Ge.createPaymentEvent(e,{caseId:t.caseId,sheetId:t.id,amount:S,paidAt:q,reference:i||null,note:p||null});r([...s,te]),o(""),u(""),y(""),E(null)}finally{w(!1)}},N=async S=>{await Ge.softDeletePaymentEvent(S),r(s.filter(M=>M.id!==S))},h=s.filter(S=>!S.isDeleted).sort((S,M)=>{const H=new Date(S.paidAt).getTime();return new Date(M.paidAt).getTime()-H});return n.jsxs("div",{className:"space-y-3",children:[n.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-2 items-end",children:[n.jsxs("div",{children:[n.jsx("label",{className:"block text-[11px] font-medium text-slate-700 mb-1",children:"  ()"}),n.jsx("input",{type:"number",className:"w-full border rounded px-2 py-1 text-xs",value:a,onChange:S=>o(S.target.value),min:0})]}),n.jsxs("div",{children:[n.jsx("label",{className:"block text-[11px] font-medium text-slate-700 mb-1",children:" "}),n.jsx("input",{type:"date",className:"w-full border rounded px-2 py-1 text-xs",value:l,onChange:S=>c(S.target.value)})]}),n.jsxs("div",{children:[n.jsx("label",{className:"block text-[11px] font-medium text-slate-700 mb-1",children:" (  / )"}),n.jsx("input",{type:"text",className:"w-full border rounded px-2 py-1 text-xs",value:i,onChange:S=>u(S.target.value)})]}),n.jsxs("div",{children:[n.jsx("label",{className:"block text-[11px] font-medium text-slate-700 mb-1",children:"  ()"}),n.jsxs("div",{className:"flex gap-2",children:[n.jsx("input",{type:"text",className:"flex-1 border rounded px-2 py-1 text-xs",value:p,onChange:S=>y(S.target.value)}),n.jsx("button",{type:"button",className:"px-3 py-1 text-xs rounded bg-emerald-600 text-white hover:bg-emerald-700 disabled:opacity-50",onClick:W,disabled:b,children:" "})]})]})]}),R&&n.jsx("div",{className:"text-[11px] text-red-600 px-1",children:R}),n.jsx("div",{className:"border-t border-slate-200 pt-2",children:h.length===0?n.jsx("p",{className:"text-[11px] text-slate-500",children:"    .       ."}):n.jsx("div",{className:"space-y-1",children:h.map(S=>n.jsxs("div",{className:"flex flex-wrap items-baseline gap-x-4 gap-y-1 rounded border border-slate-200 bg-white px-2 py-1",children:[n.jsxs("span",{className:"font-medium text-slate-800",children:["",S.amount.toLocaleString("he-IL")]}),n.jsxs("span",{className:"text-slate-600",children:[""," ",new Date(S.paidAt).toLocaleDateString("he-IL",{year:"numeric",month:"2-digit",day:"2-digit"})]}),S.reference&&n.jsxs("span",{className:"text-slate-600",children:[": ",S.reference]}),S.note&&n.jsxs("span",{className:"text-slate-600",children:[": ",S.note]}),n.jsx("button",{type:"button",className:"ml-auto text-xs text-red-600 hover:underline",onClick:()=>N(S.id),children:""})]},S.id))})})]})},Cp={DRAFT:"",READY_FOR_REPORT:" ",ATTACHED_TO_REPORT:" ",ARCHIVED:""},_h=({user:e,sheetWithRelations:t,onSheetUpdated:s,onBack:r,onNotifyLawyer:a,linkedReportForLawyer:o})=>{const[l,c]=g.useState(t.sheet),[i,u]=g.useState(t.lineItems),[p,y]=g.useState(!1),[b,w]=g.useState(null),[R,E]=g.useState(null),[W,N]=g.useState([]),[h,S]=g.useState(t.attachments),[M,H]=g.useState(!1),[V,q]=g.useState(""),[te,G]=g.useState([]),[re,j]=g.useState([]),[P,D]=g.useState("AUTO"),[O,z]=g.useState([]),[F,C]=g.useState([]),[L,Q]=g.useState([]),[me,ce]=g.useState(null),[le,fe]=g.useState(""),Te=(o==null?void 0:o.isPaid)===!0,ge=Te&&e.role!=="ADMIN",Be=Te&&e.role==="ADMIN",Ye=g.useMemo(()=>Ge.getPaidToDateForSheet(l),[l,F]),Ve=g.useMemo(()=>({...l,alreadyPaidAmount:Ye}),[l,Ye]);g.useEffect(()=>{c(t.sheet),u(t.lineItems),S(t.attachments),(async()=>{try{const J=t.sheet.caseId,he=we(J);if(!he){z([]),C([]);return}const Re=await Ge.listPaymentsForCase(J);C(Re);const je=(await Ge.listSheets()).filter(At=>At.id!==t.sheet.id).filter(At=>we(At.caseId)===he);if(!je.length){z([]),Q([]);return}je.sort((At,ie)=>{const nt=new Date(At.updatedAt||At.createdAt).getTime();return new Date(ie.updatedAt||ie.createdAt).getTime()-nt});const Ze=je.slice(0,3),We=[],tt=[];for(const At of Ze){const ie=await Ge.getSheet(At.id);if(!ie)continue;const nt=Ge.getPaidToDateForSheet(ie.sheet),on=On({...ie.sheet,alreadyPaidAmount:nt},ie.lineItems),Rs=ie.lineItems.filter(lt=>lt.kind==="EXPENSE");tt.push(...Rs),We.push({id:ie.sheet.id,versionIndex:ie.sheet.versionIndex,status:ie.sheet.status,createdAt:ie.sheet.createdAt,updatedAt:ie.sheet.updatedAt,deductibleAmount:ie.sheet.deductibleAmount??0,alreadyPaidAmount:nt,amountToRequest:on.amountToRequest})}We.sort((At,ie)=>{const nt=new Date(At.updatedAt||At.createdAt).getTime();return new Date(ie.updatedAt||ie.createdAt).getTime()-nt}),z(We),Q(tt);const qt=Ge.buildCumulativeExpensesSnapshot(t.sheet.id,new Date().toISOString());if(qt){const At=On(qt.effectiveSheet,qt.allLines);ce(At)}else ce(null)}catch{z([]),C([]),Q([]),ce(null)}})()},[t]);const He=g.useMemo(()=>On(Ve,i),[Ve,i]),ct=g.useMemo(()=>{const U=new Set;return W.forEach(J=>{J.scope==="LINE_ITEM"&&J.entityId&&U.add(J.entityId)}),U},[W]),X=()=>{const U=Rp({sheet:l,lineItems:i,attachments:h,ruleset:void 0});N(U.issues)};g.useEffect(()=>{X()},[l,i]),g.useEffect(()=>{if(!(typeof window>"u"))try{const U=window.localStorage.getItem("financeProviderSuggestions"),J=window.localStorage.getItem("financeDescriptionSuggestions");if(U){const he=JSON.parse(U);Array.isArray(he)&&G(he.filter(Re=>typeof Re=="string"))}if(J){const he=JSON.parse(J);Array.isArray(he)&&j(he.filter(Re=>typeof Re=="string"))}}catch{}},[]),g.useEffect(()=>{if(typeof window>"u")return;const U=new Set(te);let J=!1;if(i.forEach(de=>{const je=(de.providerName||"").trim();je&&!U.has(je)&&(U.add(je),J=!0)}),J){const de=Array.from(U).sort((je,Ze)=>je.localeCompare(Ze,"he-IL"));G(de);try{window.localStorage.setItem("financeProviderSuggestions",JSON.stringify(de))}catch{}}const he=new Set(re);let Re=!1;if(i.forEach(de=>{const je=(de.description||"").trim();je&&!he.has(je)&&(he.add(je),Re=!0)}),Re){const de=Array.from(he).sort((je,Ze)=>je.localeCompare(Ze,"he-IL"));j(de);try{window.localStorage.setItem("financeDescriptionSuggestions",JSON.stringify(de))}catch{}}},[i]);const se=U=>{ge||c(J=>({...J,...U}))},I=(U,J)=>{ge||u(he=>{const Re=[...he];return Re[U]={...Re[U],...J,sheetId:l.id},Re})},ae=()=>{if(ge)return;const U={id:`tmp-${Date.now()}`,sheetId:l.id,kind:"EXPENSE",expenseType:null,providerName:"",providerId:null,description:"",date:new Date().toISOString().slice(0,10),quantity:1,unitPrice:0,vatRate:18,isIncludedInRequestedAmount:!0,lineNetAmount:null,lineVatAmount:null,lineTotalAmount:null,attachmentId:null,createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()};u(J=>[...J,U])},ne=U=>{if(ge)return;const J=i[U];J&&(u(he=>he.filter((Re,de)=>de!==U)),J.id.startsWith("tmp-")||Ge.deleteLineItem(e,l.id,J.id))},ye=async U=>{if(ge)return;const J=Array.from(U);if(J.length)for(let he=0;he<J.length;he++){const Re=J[he],de=new FileReader,je=await new Promise((We,tt)=>{de.onload=()=>We(String(de.result)),de.onerror=()=>tt(de.error),de.readAsDataURL(Re)}),Ze=await Ge.addAttachment(e,l.id,{fileKey:je,originalFileName:Re.name,mimeType:Re.type||"application/octet-stream",sizeBytes:Re.size});Ze&&S(We=>[...We,Ze])}},Pe=async U=>{const{files:J}=U.target;!J||!J.length||(await ye(J),U.target.value="")},ke=async U=>{U.preventDefault(),U.stopPropagation();const{files:J}=U.dataTransfer;!J||!J.length||await ye(J)},De=async(U,J)=>{if(ge)return;const he=J||"";try{const Re=await Ge.linkAttachmentToLineItem(e,l.id,he,J?U.id:null);S(de=>de.map(je=>Re&&je.id===Re.id?Re:!Re&&je.id===he?{...je,linkedLineItemId:J?U.id:null}:je)),u(de=>de.map(je=>je.id===U.id?{...je,attachmentId:J||null}:je.id===U.attachmentId&&!J?{...je,attachmentId:null}:je)),w(J?" /     .":"    .")}catch(Re){console.error("Failed to link attachment to line item",Re)}},Qe=async()=>{if(ge)return;if(Be){const J=le.trim();if(!J){w("   (     ).");return}Ge.recordAdminEditAfterPaid(e,l.id,J)}if(!((e.role==="SUB_ADMIN"||e.role==="ADMIN")&&!Be&&(l.status==="READY_FOR_REPORT"||l.status==="ATTACHED_TO_REPORT"||l.status==="ARCHIVED")&&!window.confirm(`     (  /   / ).
         .

  ?`))){y(!0);try{const J=await Ge.updateSheetMeta(e,l.id,{insurerName:l.insurerName,periodLabel:l.periodLabel,deductibleAmount:l.deductibleAmount??0,alreadyPaidAmount:l.alreadyPaidAmount??0,infoOnly:l.infoOnly}),he=[];for(const de of i)if(de.id.startsWith("tmp-")){const je=await Ge.addLineItem(e,l.id,{kind:de.kind,expenseType:de.expenseType,providerName:de.providerName,providerId:de.providerId,description:de.description,date:de.date,quantity:de.quantity,unitPrice:de.unitPrice,vatRate:de.vatRate,isIncludedInRequestedAmount:de.isIncludedInRequestedAmount,lineNetAmount:de.lineNetAmount,lineVatAmount:de.lineVatAmount,lineTotalAmount:de.lineTotalAmount,attachmentId:de.attachmentId});je&&he.push(je)}else{const je=await Ge.updateLineItem(e,l.id,de.id,{kind:de.kind,expenseType:de.expenseType,providerName:de.providerName,providerId:de.providerId,description:de.description,date:de.date,quantity:de.quantity,unitPrice:de.unitPrice,vatRate:de.vatRate,isIncludedInRequestedAmount:de.isIncludedInRequestedAmount,lineNetAmount:de.lineNetAmount,lineVatAmount:de.lineVatAmount,lineTotalAmount:de.lineTotalAmount,attachmentId:de.attachmentId});je&&he.push(je)}const Re=await Ge.getSheet(l.id)||{sheet:J||l,lineItems:he,attachments:[]};s(Re),w("  .")}finally{y(!1)}}},Ke=async()=>{y(!0);try{const U=await Ge.getRulesetForSheet(l),J=Rp({sheet:l,lineItems:i,attachments:h,ruleset:U}),he=J.issues.map(je=>je.code==="MISSING_ATTACHMENT_REQUIRED"&&je.severity==="ERROR"?{...je,severity:"WARNING"}:je);N(he);const Re=he.filter(je=>je.severity==="ERROR"&&je.code!=="MISSING_ATTACHMENT_REQUIRED");if(Re.length){const je=Re.map(Ze=>` ${Ze.messageHe}`).join(`
`);q(je),H(!0),w("          .");return}const de=await Ge.recordReadyAttempt(e,{sheetId:l.id,success:!0,decisionLog:J.decisionLog});if(de){c(de);const je=await Ge.getSheet(de.id)||{sheet:de,lineItems:i,attachments:h};s(je),a&&a({caseId:de.caseId,sheetId:de.id,lawyerId:P==="AUTO"?void 0:P});const Ze=P==="AUTO"?(o==null?void 0:o.ownerName)||"  ":(o==null?void 0:o.ownerName)||" ";w(`       ${Ze}   ${de.caseId}.`)}}finally{y(!1)}},Fe=()=>{const U=Ge.buildCumulativeExpensesSnapshot(l.id,new Date().toISOString());if(!U)return;const{effectiveSheet:J,allLines:he,opts:Re}=U,{html:de}=si(J,he,Re);E(de)},Z=U=>ct.has(U),ve=g.useMemo(()=>{const U=new Set(te);return i.forEach(J=>{J.providerName&&U.add(J.providerName)}),Array.from(U).sort((J,he)=>J.localeCompare(he,"he-IL"))},[i,te]),xe=g.useMemo(()=>{const U=new Set(re);return i.forEach(J=>{J.description&&U.add(J.description)}),Array.from(U).sort((J,he)=>J.localeCompare(he,"he-IL"))},[i,re]),Se=()=>{const U={sheet:l,lineItems:i,attachments:h,totals:He},J=new Blob([JSON.stringify(U,null,2)],{type:"application/json"}),he=URL.createObjectURL(J),Re=document.createElement("a");Re.href=he,Re.download=`expenses-${l.caseId||l.id}.json`,Re.click(),URL.revokeObjectURL(he)},Me=()=>{const U=["LineId","Date","Provider","Description","Quantity","UnitPrice","VatRate","IncludedInRequest","LineTotal"],J=i.map(Ze=>[Ze.id,Ze.date||"",(Ze.providerName||"").replace(/"/g,'""'),(Ze.description||"").replace(/"/g,'""'),Ze.quantity??"",Ze.unitPrice??"",Ze.vatRate??"",Ze.isIncludedInRequestedAmount!==!1?"YES":"NO",Ze.lineTotalAmount??""]),he=[U.join(","),...J.map(Ze=>Ze.map(We=>{const tt=String(We??"");return/[",\n]/.test(tt)?`"${tt}"`:tt}).join(","))].join(`
`),Re=new Blob(["\uFEFF"+he],{type:"text/csv;charset=utf-8;"}),de=URL.createObjectURL(Re),je=document.createElement("a");je.href=de,je.download=`expenses-${l.caseId||l.id}.csv`,je.click(),URL.revokeObjectURL(de)},_e=g.useMemo(()=>{if(!o)return l.status==="READY_FOR_REPORT"?"   (  ).":l.status==="ATTACHED_TO_REPORT"||l.status==="ARCHIVED"?"     .":"  .";switch(o.status){case"TASK_ASSIGNED":return"      .";case"WAITING_FOR_INVOICES":return"   /  .";case"PENDING_REVIEW":return'"   / .';case"READY_TO_SEND":return'"    .';case"SENT":return'"   .';default:return"    ."}},[o,l.status]),Ue=g.useMemo(()=>o?[{id:o.createdBy,name:o.ownerName||'" '}]:[],[o]);return n.jsxs("div",{className:"flex flex-col gap-4",children:[Te&&n.jsx("div",{className:"rounded-lg border border-amber-300 bg-amber-50 px-4 py-3 text-sm text-amber-900",children:ge?n.jsx("strong",{children:"      ."}):n.jsxs("div",{children:[n.jsx("strong",{children:"    (ADMIN)."}),n.jsx("p",{className:"mt-2 text-amber-800",children:"     ."}),n.jsx("input",{type:"text",className:"mt-2 w-full max-w-md border border-amber-300 rounded px-3 py-1.5 text-sm",placeholder:"  ()",value:le,onChange:U=>fe(U.target.value)})]})}),n.jsxs("div",{className:"flex items-center justify-between",children:[n.jsxs("div",{children:[n.jsxs("h2",{className:"text-xl font-semibold text-gray-900",children:["  : ",n.jsx("span",{className:"font-mono",children:l.caseId})]}),n.jsxs("p",{className:"text-sm text-gray-600",children:[": ",n.jsx("span",{children:Cp[l.status]})]}),n.jsxs("p",{className:"mt-1 text-xs text-gray-600",children:['  ":'," ",n.jsx("span",{className:"font-medium text-gray-800",children:_e})]})]}),n.jsxs("div",{className:"flex gap-3 flex-wrap justify-end items-center",children:[Ue.length>0&&n.jsxs("div",{className:"text-xs text-gray-700",children:[n.jsx("label",{className:"block mb-1 font-medium",children:"     "}),n.jsxs("select",{className:"border rounded px-2 py-1 text-xs bg-white",value:P,onChange:U=>D(U.target.value||"AUTO"),children:[n.jsx("option",{value:"AUTO",children:'   "  '}),Ue.map(U=>n.jsx("option",{value:U.id,children:U.name},U.id))]})]}),n.jsx("button",{type:"button",className:"px-3 py-1 text-sm rounded border border-gray-300 text-gray-700 hover:bg-gray-50",onClick:r,children:" "}),n.jsx("button",{type:"button",className:"px-3 py-1.5 text-sm rounded border border-blue-300 text-blue-700 hover:bg-blue-50",onClick:Fe,children:" "}),!ge&&n.jsx("button",{type:"button",className:"px-4 py-1.5 text-sm rounded bg-emerald-600 text-white hover:bg-emerald-700 disabled:opacity-50",onClick:Ke,disabled:p,children:"   "}),n.jsx("button",{type:"button",className:"px-4 py-1.5 text-sm rounded bg-blue-600 text-white hover:bg-blue-700 disabled:opacity-50",onClick:Qe,disabled:p||ge,children:p?"":" "}),n.jsx("button",{type:"button",className:"px-3 py-1.5 text-xs rounded border border-gray-300 text-gray-700 hover:bg-gray-50",onClick:Se,children:" JSON"}),n.jsx("button",{type:"button",className:"px-3 py-1.5 text-xs rounded border border-gray-300 text-gray-700 hover:bg-gray-50",onClick:Me,children:" Excel (CSV)"})]})]}),b&&n.jsx("div",{className:"mt-2 rounded border border-green-200 bg-green-50 px-3 py-2 text-sm text-green-800",children:b}),R&&n.jsxs("div",{className:"mt-2 rounded border border-gray-300 bg-white px-3 py-3 text-sm text-left",children:[n.jsxs("div",{className:"flex justify-between items-center mb-2",children:[n.jsx("span",{className:"font-semibold text-gray-800",children:"Expenses Table  Preview"}),n.jsx("button",{type:"button",className:"text-sm text-blue-600 hover:underline",onClick:()=>E(null),children:""})]}),n.jsx("div",{className:"overflow-x-auto text-base",dangerouslySetInnerHTML:{__html:R}})]}),n.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 bg-white border rounded-lg p-4 shadow-sm",children:[n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:""}),n.jsx("input",{className:"w-full border rounded px-2 py-1 text-sm disabled:bg-gray-100 disabled:cursor-not-allowed",value:l.insurerName||"",onChange:U=>se({insurerName:U.target.value}),disabled:ge})]}),n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:" / "}),n.jsx("input",{className:"w-full border rounded px-2 py-1 text-sm disabled:bg-gray-100 disabled:cursor-not-allowed",value:l.periodLabel||"",onChange:U=>se({periodLabel:U.target.value}),disabled:ge})]}),n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:" "}),n.jsx("input",{type:"number",className:"w-full border rounded px-2 py-1 text-sm disabled:bg-gray-100 disabled:cursor-not-allowed",value:l.deductibleAmount??0,onChange:U=>{const J=Number(U.target.value),he=Number.isFinite(J)?Math.max(0,J):0;se({deductibleAmount:he})},disabled:ge})]}),n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"  "}),n.jsx("input",{type:"number",className:"w-full border rounded px-2 py-1 text-sm bg-gray-50",value:Ye,readOnly:!0})]}),n.jsxs("div",{className:"flex items-center gap-2 mt-2",children:[n.jsx("input",{id:"infoOnly",type:"checkbox",checked:l.infoOnly,onChange:U=>se({infoOnly:U.target.checked}),disabled:ge}),n.jsx("label",{htmlFor:"infoOnly",className:"text-sm text-gray-800",children:"   (  )"})]})]}),n.jsxs("div",{className:"flex flex-col gap-2",children:[n.jsxs("div",{className:"flex items-center justify-between text-xs text-gray-700 px-1",children:[n.jsx("span",{className:"font-semibold",children:"    (  )"}),n.jsx("span",{className:"text-gray-500",children:"   / PDF     ."})]}),n.jsxs("div",{className:"flex flex-wrap gap-4 items-center bg-blue-50 border border-blue-100 rounded-lg p-4 text-sm",children:[n.jsxs("div",{children:[n.jsx("div",{className:"text-gray-600",children:"   "}),n.jsxs("div",{className:"font-semibold",children:[He.grossExpensesTotal.toLocaleString("he-IL")," "]})]}),n.jsxs("div",{children:[n.jsx("div",{className:"text-gray-600",children:"   (  +  + )"}),n.jsxs("div",{className:"font-semibold",children:[He.adjustmentsTotal.toLocaleString("he-IL")," "]})]}),n.jsxs("div",{children:[n.jsx("div",{className:"text-gray-600",children:"     INFO_ONLY"}),n.jsxs("div",{className:"font-semibold",children:[He.amountBeforeInfoOnly.toLocaleString("he-IL")," "]})]}),n.jsxs("div",{children:[n.jsx("div",{className:"text-gray-600",children:"   "}),n.jsxs("div",{className:"font-semibold text-blue-700",children:[He.amountToRequest.toLocaleString("he-IL")," "]})]}),He.infoOnlyApplied&&n.jsx("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-yellow-100 text-yellow-800",children:"INFO_ONLY    (  )"})]}),n.jsx("div",{className:"px-1 text-[11px] text-gray-500",children:" :         .   (Expenses Table)   -PDF        ."})]}),me&&n.jsxs("div",{className:"mt-3 flex flex-col gap-2",children:[n.jsx("div",{className:"flex items-center justify-between text-xs text-slate-700 px-1",children:n.jsx("span",{className:"font-semibold",children:"   ( +  )"})}),n.jsxs("div",{className:"flex flex-wrap gap-4 items-center bg-indigo-50 border border-indigo-100 rounded-lg p-4 text-sm",children:[n.jsxs("div",{children:[n.jsx("div",{className:"text-slate-600",children:"   "}),n.jsxs("div",{className:"font-semibold",children:[me.grossExpensesTotal.toLocaleString("he-IL")," "]})]}),n.jsxs("div",{children:[n.jsx("div",{className:"text-slate-600",children:"  (  +  + )"}),n.jsxs("div",{className:"font-semibold",children:[me.adjustmentsTotal.toLocaleString("he-IL")," "]})]}),n.jsxs("div",{children:[n.jsx("div",{className:"text-slate-600",children:"   "}),n.jsxs("div",{className:"font-semibold",children:[Ye.toLocaleString("he-IL")," "]})]}),n.jsxs("div",{children:[n.jsx("div",{className:"text-slate-600",children:"  /  ()"}),n.jsxs("div",{className:"font-semibold text-indigo-700",children:[me.amountToRequest.toLocaleString("he-IL")," "]})]})]})]}),n.jsxs("div",{className:"mt-2 text-xs text-gray-500 bg-white border border-dashed border-gray-300 rounded-md p-2",children:[n.jsx("span",{className:"font-semibold mr-1",children:" :"}),"    (, , , ,  ).       ,            ."]}),n.jsxs("div",{className:"bg-white border rounded-lg p-4 shadow-sm flex flex-col gap-2 text-sm",onDragOver:U=>{U.preventDefault(),U.stopPropagation()},onDrop:ke,children:[n.jsxs("div",{className:"flex items-center justify-between",children:[n.jsx("div",{className:"font-medium text-gray-900",children:""}),n.jsxs("label",{className:"inline-flex items-center gap-2 cursor-pointer text-xs text-blue-700 hover:text-blue-800",children:[n.jsx("span",{className:"px-2 py-1 border border-blue-400 rounded bg-blue-50",children:" "}),n.jsx("input",{type:"file",className:"hidden",multiple:!0,onChange:Pe})]})]}),n.jsx("p",{className:"text-xs text-gray-500",children:"         ."}),h.length===0?n.jsx("div",{className:"text-gray-500 text-xs",children:"    ."}):n.jsx("ul",{className:"divide-y divide-gray-100",children:h.map(U=>n.jsxs("li",{className:"py-1 flex items-center justify-between gap-4",children:[n.jsxs("div",{className:"flex flex-col",children:[n.jsx("span",{className:"text-gray-900 text-xs",children:U.originalFileName}),n.jsxs("span",{className:"text-gray-500 text-[11px]",children:[": ",U.sizeBytes!=null?`${(U.sizeBytes/1024).toFixed(1)} KB`:" ","  "," ",U.uploadedAt?new Date(U.uploadedAt).toLocaleString("he-IL",{dateStyle:"short",timeStyle:"short"}):""]})]}),n.jsx("button",{type:"button",className:"text-xs text-blue-700 hover:underline",onClick:()=>{U.fileKey.startsWith("data:")&&window.open(U.fileKey,"_blank")},children:" / "})]},U.id))})]}),W.length>0&&n.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-lg p-3 text-sm",children:[n.jsx("div",{className:"font-semibold text-red-800 mb-1",children:"  :"}),n.jsx("ul",{className:"list-disc pr-5 space-y-0.5",children:W.map(U=>n.jsxs("li",{children:[n.jsxs("span",{className:"font-mono text-xs text-gray-500 ml-1",children:["[",U.severity,"]"]}),n.jsxs("span",{className:"text-red-900",children:[" ",U.messageHe]})]},`${U.code}-${U.scope}-${U.entityId||"sheet"}`))})]}),n.jsxs("div",{className:"bg-white border rounded-lg shadow-sm overflow-x-auto",children:[n.jsxs("table",{className:"min-w-full text-sm",children:[n.jsx("thead",{className:"bg-gray-50",children:n.jsxs("tr",{children:[n.jsx("th",{className:"px-2 py-1 border-b text-right",children:""}),n.jsx("th",{className:"px-2 py-1 border-b text-right",children:""}),n.jsx("th",{className:"px-2 py-1 border-b text-right",children:""}),n.jsx("th",{className:"px-2 py-1 border-b text-right",children:""}),n.jsx("th",{className:"px-2 py-1 border-b text-right",children:""}),n.jsx("th",{className:"px-2 py-1 border-b text-right",children:" "}),n.jsx("th",{className:"px-2 py-1 border-b text-right",children:" %"}),n.jsx("th",{className:"px-2 py-1 border-b text-right",children:" "}),n.jsx("th",{className:"px-2 py-1 border-b text-right",children:" "}),n.jsx("th",{className:"px-2 py-1 border-b text-right",children:""}),n.jsx("th",{className:"px-2 py-1 border-b"})]})}),n.jsxs("tbody",{children:[L.length>0&&n.jsx("tr",{children:n.jsx("td",{className:"px-2 py-1 border-b text-xs text-slate-600 bg-slate-50",colSpan:9,children:"  ( )      ."})}),L.map((U,J)=>{if(U.kind!=="EXPENSE")return null;const he=U.lineTotalAmount??(U.quantity??0)*(U.unitPrice??0)*(1+(U.vatRate??0)/100);return n.jsxs("tr",{className:"bg-slate-50 text-slate-700",children:[n.jsx("td",{className:"px-2 py-1 border-b text-[11px] text-slate-500",children:""}),n.jsx("td",{className:"px-2 py-1 border-b text-xs",children:U.providerName||""}),n.jsx("td",{className:"px-2 py-1 border-b text-xs",children:U.description||""}),n.jsx("td",{className:"px-2 py-1 border-b text-xs whitespace-nowrap",children:U.date||""}),n.jsx("td",{className:"px-2 py-1 border-b text-xs",children:U.quantity??""}),n.jsx("td",{className:"px-2 py-1 border-b text-xs",children:U.unitPrice??""}),n.jsx("td",{className:"px-2 py-1 border-b text-xs",children:U.vatRate??""}),n.jsx("td",{className:"px-2 py-1 border-b text-xs",children:Number.isFinite(he)?he.toLocaleString("he-IL"):""}),n.jsx("td",{className:"px-2 py-1 border-b text-[11px] text-slate-400",children:" "})]},`hist-${U.id}-${J}`)}),i.map((U,J)=>{const he=Z(U.id),Re=h.find(We=>We.id===U.attachmentId),de=U.kind==="COMPENSATION",je=U.kind==="EXPENSE",Ze=U.kind==="COMPENSATION"?U.compensationSource==="COURT"?"COMPENSATION_COURT":"COMPENSATION_SETTLEMENT":U.kind;return n.jsxs("tr",{className:`${he?"bg-red-50":J%2===0?"bg-white":"bg-gray-50"} ${je?"border-l-4 border-emerald-300 bg-emerald-50/60":""}`,children:[n.jsx("td",{className:"px-2 py-1 border-b",children:n.jsxs("select",{className:"border rounded px-1 py-0.5 text-xs",value:Ze,onChange:We=>{const tt=We.target.value;tt==="EXPENSE"?I(J,{kind:"EXPENSE",compensationSource:null}):tt==="ADJUSTMENT"?I(J,{kind:"ADJUSTMENT",compensationSource:null}):tt==="COMPENSATION_SETTLEMENT"?I(J,{kind:"COMPENSATION",compensationSource:"SETTLEMENT",providerName:"",expenseType:null,vatRate:0,quantity:1}):tt==="COMPENSATION_COURT"&&I(J,{kind:"COMPENSATION",compensationSource:"COURT",providerName:"",expenseType:null,vatRate:0,quantity:1})},children:[n.jsx("option",{value:"EXPENSE",children:"Expense"}),n.jsx("option",{value:"COMPENSATION_SETTLEMENT",children:"Compensation pursuant to a settlement"}),n.jsx("option",{value:"COMPENSATION_COURT",children:"Compensation pursuant to a judgment"}),n.jsx("option",{value:"ADJUSTMENT",children:"Adjustment"})]})}),n.jsx("td",{className:"px-2 py-1 border-b",children:de?n.jsx("span",{className:"text-[11px] text-gray-400 whitespace-nowrap",children:"  "}):n.jsxs("div",{className:"flex items-center gap-1",children:[je&&n.jsx("span",{className:"inline-flex items-center rounded-full bg-emerald-100 text-emerald-700 text-[10px] px-2 py-[1px]",children:""}),n.jsx("input",{list:"provider-suggestions",className:"border rounded px-1 py-0.5 w-32 text-xs",placeholder:" ",value:U.providerName||"",onChange:We=>I(J,{providerName:We.target.value})})]})}),n.jsx("td",{className:"px-2 py-1 border-b",children:n.jsx("input",{className:"border rounded px-1 py-0.5 w-64 text-xs",list:"description-suggestions",value:U.description,onChange:We=>I(J,{description:We.target.value})})}),n.jsx("td",{className:"px-2 py-1 border-b",children:n.jsx("input",{type:"date",className:"border rounded px-1 py-0.5 text-xs",value:U.date||"",onChange:We=>I(J,{date:We.target.value||null})})}),n.jsx("td",{className:"px-2 py-1 border-b",children:n.jsx("input",{type:"number",className:"border rounded px-1 py-0.5 w-20 text-xs disabled:bg-gray-100 disabled:text-gray-400",value:U.quantity??1,disabled:de,onChange:We=>{if(de)return;const tt=Number(We.target.value),qt=Number.isFinite(tt)?Math.max(0,tt):0;I(J,{quantity:qt})}})}),n.jsx("td",{className:"px-2 py-1 border-b",children:n.jsx("input",{type:"number",className:"border rounded px-1 py-0.5 w-24 text-xs",value:U.unitPrice??0,onChange:We=>{const tt=Number(We.target.value),qt=Number.isFinite(tt)?Math.max(0,tt):0;I(J,{unitPrice:qt})}})}),n.jsx("td",{className:"px-2 py-1 border-b",children:n.jsx("input",{type:"number",className:"border rounded px-1 py-0.5 w-16 text-xs disabled:bg-gray-100 disabled:text-gray-400",value:U.vatRate??0,disabled:de,onChange:We=>{if(de)return;const tt=Number(We.target.value),qt=Number.isFinite(tt)?Math.max(0,tt):0;I(J,{vatRate:qt})}})}),n.jsx("td",{className:"px-2 py-1 border-b text-center",children:n.jsx("input",{type:"checkbox",checked:U.isIncludedInRequestedAmount!==!1,onChange:We=>I(J,{isIncludedInRequestedAmount:We.target.checked})})}),n.jsx("td",{className:"px-2 py-1 border-b text-left font-mono text-xs",children:U.lineTotalAmount!=null?U.lineTotalAmount.toLocaleString("he-IL"):""}),n.jsxs("td",{className:"px-2 py-1 border-b text-right",children:[n.jsxs("div",{className:"flex items-center justify-end gap-2",children:[n.jsxs("select",{className:"border rounded px-1 py-0.5 text-xs max-w-[190px]",value:U.attachmentId||"",title:Re?` : ${Re.originalFileName}`:"   ",onChange:We=>void De(U,We.target.value?We.target.value:null),children:[n.jsx("option",{value:"",children:h.length?"   ":"  "}),h.map(We=>n.jsx("option",{value:We.id,children:We.originalFileName},We.id))]}),U.attachmentId?n.jsxs("span",{className:"inline-flex items-center gap-1 text-[11px] text-emerald-700 font-semibold whitespace-nowrap",children:[n.jsx("span",{className:"text-emerald-600",children:""}),n.jsx("span",{children:" "})]}):n.jsx("span",{className:"inline-flex items-center gap-1 text-[11px] text-gray-500 whitespace-nowrap",children:" "})]}),Re&&n.jsxs("div",{className:"mt-0.5 text-[11px] text-gray-700 text-left",children:[n.jsx("span",{className:"text-gray-500",children:":"})," ",n.jsx("span",{className:"font-mono break-all",children:Re.originalFileName})]})]}),n.jsx("td",{className:"px-2 py-1 border-b text-center",children:n.jsx("button",{type:"button",className:"text-xs text-red-600 hover:underline disabled:opacity-50 disabled:cursor-not-allowed disabled:no-underline",onClick:()=>ne(J),disabled:ge,children:""})})]},U.id)})]})]}),n.jsx("datalist",{id:"provider-suggestions",children:ve.map(U=>n.jsx("option",{value:U},U))}),n.jsx("datalist",{id:"description-suggestions",children:xe.map(U=>n.jsx("option",{value:U},U))}),n.jsx("div",{className:"p-2",children:n.jsx("button",{type:"button",className:"px-3 py-1 text-xs rounded border border-dashed border-gray-400 text-gray-700 hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed",onClick:ae,disabled:ge,children:" "})})]}),n.jsxs("div",{className:"mt-4 rounded-lg border border-slate-200 bg-slate-50 p-3 text-xs",children:[n.jsxs("div",{className:"flex justify-between items-center mb-2",children:[n.jsx("span",{className:"font-semibold text-slate-800",children:" "}),n.jsxs("span",{className:"text-slate-700",children:["    : ",Ye.toLocaleString("he-IL")]})]}),n.jsx(Bb,{user:e,sheet:l,paymentEvents:F,onChangeEvents:C})]}),O.length>0&&n.jsxs("div",{className:"mt-4 rounded-lg border border-slate-200 bg-slate-50 p-3 text-xs",children:[n.jsxs("div",{className:"flex justify-between items-center mb-2",children:[n.jsx("span",{className:"font-semibold text-slate-800",children:"  "}),n.jsxs("span",{className:"text-slate-500",children:["  ",O.length,"    "]})]}),n.jsx("div",{className:"space-y-2",children:O.map(U=>n.jsxs("div",{className:"rounded border border-slate-200 bg-white px-2 py-1 flex flex-wrap gap-x-4 gap-y-1 items-baseline",children:[n.jsxs("span",{className:"font-semibold text-slate-800",children:[" #",U.versionIndex||1]}),n.jsxs("span",{className:"text-slate-600",children:[": ",Cp[U.status]||U.status]}),n.jsxs("span",{className:"text-slate-500",children:[":"," ",new Date(U.updatedAt||U.createdAt).toLocaleString("he-IL",{dateStyle:"short",timeStyle:"short"})]}),n.jsxs("span",{className:"text-slate-700",children:[" : ",U.deductibleAmount.toLocaleString("he-IL")]}),n.jsxs("span",{className:"text-slate-700",children:["  : ",U.alreadyPaidAmount.toLocaleString("he-IL")]}),n.jsxs("span",{className:"text-slate-700",children:[" : ",U.amountToRequest.toLocaleString("he-IL")]})]},U.id))})]}),n.jsx(Fb,{open:M,title:"    ",message:V?`      :

${V}`:"      .",confirmText:"",cancelText:"",onConfirm:()=>H(!1),onCancel:()=>H(!1)})]})},$b=[{id:"READY",label:" "},{id:"ATTACHED",label:" "},{id:"SENT",label:""},{id:"EXCEPTIONS",label:""}],Dp={DRAFT:"",READY_FOR_REPORT:" ",ATTACHED_TO_REPORT:" ",ARCHIVED:""},Hb=({user:e,reports:t,onOpenReport:s})=>{var ct;const[r,a]=g.useState("READY"),[o,l]=g.useState(""),[c,i]=g.useState(""),[u,p]=g.useState(""),[y,b]=g.useState(""),[w,R]=g.useState(""),[E,W]=g.useState([]),[N,h]=g.useState(null),[S,M]=g.useState(null),[H,V]=g.useState(!1),[q,te]=g.useState(null),[G,re]=g.useState(null),[j,P]=g.useState(null),[D,O]=g.useState(!1),[z,F]=g.useState(null),[C,L]=g.useState(null),[Q,me]=g.useState(!1),[ce,le]=g.useState(!1),[fe,Te]=g.useState(0);g.useMemo(()=>{if(!N)return 0;switch(r){case"READY":return N.readyCount;case"ATTACHED":return N.attachedCount;case"SENT":return N.sentCount;case"EXCEPTIONS":return N.exceptionsCount;default:return 0}},[N,r]);const ge=X=>{if(X==null)return"";if(X<24)return`${X.toFixed(1)} `;const se=Math.floor(X/24),I=X%24;return I<1?`${se} `:`${se}  ${I.toFixed(1)} `};g.useEffect(()=>{let X=!1;return(async()=>{V(!0),te(null);try{const[I,ae]=await Promise.all([Ge.getLidorCounts(e,t),Ge.getLidorKpis(e,t)]);X||(h(I),M(ae));const ne={};r==="READY"?ne.status="READY_FOR_REPORT":r==="ATTACHED"&&(ne.status="ATTACHED_TO_REPORT"),o.trim()&&(ne.insurerName=o.trim()),u&&(ne.dateFrom=u),y&&(ne.dateTo=y),w.trim()&&(ne.caseIdOrSearch=w.trim()),c&&(ne.status=c);const ye=await Ge.listSheetsForLidor(e,ne,t);let Pe=ye;r==="SENT"?Pe=ye.filter(ke=>ke.sentAt):r==="EXCEPTIONS"&&(Pe=ye.filter(ke=>ke.expensesOutOfSync||ke.blockingIssueCodesLatest&&ke.blockingIssueCodesLatest.length>0)),X||(W(Pe),re(null),L(null))}catch(I){console.error(I),X||te("    . /   .")}finally{X||V(!1)}})(),()=>{X=!0}},[e,t,r,o,c,u,y,w,fe]);const Be=async X=>{re(X),L(null),F(null),O(!0);try{const se=await Ge.getSheet(X.sheetId),I=await Ge.getSheetAuditForLidor(e,X.sheetId,200),ae=await Ge.getExceptionStatusForSheet(e,X.sheetId);L(se?{sheet:se.sheet,lineItems:se.lineItems,attachments:se.attachments,audit:I,exceptionStatus:ae}:{sheet:null,lineItems:[],attachments:[],audit:I,exceptionStatus:ae})}catch(se){console.error(se),F("     .")}finally{O(!1)}},Ye=()=>{if(!C||!C.sheet)return;const X={sheet:C.sheet,lineItems:C.lineItems,attachments:C.attachments};P(X)},Ve=()=>{P(null),Te(X=>X+1)};if(j)return n.jsxs("div",{className:"bg-white rounded-xl border border-slate-200 shadow-sm p-4 mt-4",dir:"rtl",children:[n.jsxs("header",{className:"flex items-center justify-between mb-4",children:[n.jsxs("div",{children:[n.jsx("h2",{className:"text-xl font-bold text-slate-900",children:"   ()"}),n.jsx("p",{className:"text-sm text-slate-600 mt-1",children:"           ."})]}),n.jsx("button",{type:"button",className:"px-3 py-1.5 rounded border border-slate-300 text-sm text-slate-700 hover:bg-slate-100",onClick:Ve,children:"  "})]}),n.jsx(_h,{user:e,sheetWithRelations:j,onSheetUpdated:X=>{P(X)},onBack:Ve})]});const He=async X=>{if(!(!G||!C))try{await Ge.setExceptionStatusForSheet(e,G.sheetId,X),L({...C,exceptionStatus:X})}catch(se){Ku("Failed to update financial exception status",se),F("     .")}};return n.jsxs("div",{className:"bg-white rounded-xl border border-slate-200 shadow-sm p-4 mt-4",dir:"rtl",children:[n.jsx("header",{className:"flex flex-col md:flex-row md:items-center md:justify-between gap-4 mb-4",children:n.jsxs("div",{children:[n.jsx("h2",{className:"text-xl font-bold text-slate-900",children:" "}),n.jsx("p",{className:"text-sm text-slate-600 mt-1",children:"-    ,      ."}),S&&n.jsxs("p",{className:"mt-1 text-xs text-slate-500",children:["  :"," ",S.exceptions.divergenceOld.count+S.exceptions.missingAttachments.count+S.exceptions.repeatedBlocks.count]})]})}),S&&n.jsxs("section",{className:"mb-4 grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 xl:grid-cols-4 gap-3 text-xs",children:[n.jsxs("div",{className:"rounded-xl border border-slate-200 bg-slate-50 px-3 py-2.5",children:[n.jsx("p",{className:"text-slate-500 mb-1",children:"   "}),n.jsx("p",{className:"text-sm font-semibold text-slate-900",children:ge(S.sla.draftToReadyAvgHours)})]}),n.jsxs("div",{className:"rounded-xl border border-slate-200 bg-slate-50 px-3 py-2.5",children:[n.jsx("p",{className:"text-slate-500 mb-1",children:"   "}),n.jsx("p",{className:"text-sm font-semibold text-slate-900",children:ge(S.sla.readyToAttachedAvgHours)})]}),n.jsxs("div",{className:"rounded-xl border border-slate-200 bg-slate-50 px-3 py-2.5",children:[n.jsx("p",{className:"text-slate-500 mb-1",children:"   "}),n.jsx("p",{className:"text-sm font-semibold text-slate-900",children:ge(S.sla.attachedToSentAvgHours)})]}),n.jsxs("div",{className:"rounded-xl border border-blue-100 bg-blue-50 px-3 py-2.5",children:[n.jsx("p",{className:"text-slate-600 mb-1",children:"  "}),n.jsxs("p",{className:"text-sm font-semibold text-blue-800",children:[S.volumes.totalAmountRequested.toLocaleString("he-IL")," "]}),n.jsxs("p",{className:"text-[11px] text-slate-500 mt-0.5",children:[S.volumes.totalSheets||0,"  "," ",S.volumes.totalSentReports||0,"  "]})]})]}),S&&n.jsxs("section",{className:"mb-4",children:[n.jsx("h3",{className:"text-sm font-semibold text-slate-700 mb-1",children:"  "}),n.jsxs("div",{className:"flex flex-wrap gap-2 text-xs",children:[n.jsxs("button",{type:"button",className:"inline-flex items-center gap-1 px-3 py-1.5 rounded-full border border-amber-200 bg-amber-50 text-amber-800 hover:bg-amber-100 transition disabled:opacity-40 disabled:hover:bg-amber-50",disabled:S.exceptions.divergenceOld.count===0,onClick:()=>a("EXCEPTIONS"),children:[n.jsx("span",{children:"    "}),n.jsxs("span",{className:"font-semibold",children:["(",S.exceptions.divergenceOld.count,")"]})]}),n.jsxs("button",{type:"button",className:"inline-flex items-center gap-1 px-3 py-1.5 rounded-full border border-rose-200 bg-rose-50 text-rose-800 hover:bg-rose-100 transition disabled:opacity-40 disabled:hover:bg-rose-50",disabled:S.exceptions.missingAttachments.count===0,onClick:()=>a("EXCEPTIONS"),children:[n.jsx("span",{children:"  "}),n.jsxs("span",{className:"font-semibold",children:["(",S.exceptions.missingAttachments.count,")"]})]}),n.jsxs("button",{type:"button",className:"inline-flex items-center gap-1 px-3 py-1.5 rounded-full border border-purple-200 bg-purple-50 text-purple-800 hover:bg-purple-100 transition disabled:opacity-40 disabled:hover:bg-purple-50",disabled:S.exceptions.repeatedBlocks.count===0,onClick:()=>a("EXCEPTIONS"),children:[n.jsx("span",{children:"   "}),n.jsxs("span",{className:"font-semibold",children:["(",S.exceptions.repeatedBlocks.count,")"]})]})]})]}),n.jsx("div",{className:"flex flex-wrap gap-2 mb-4",children:$b.map(X=>n.jsxs("button",{type:"button",onClick:()=>a(X.id),className:`px-3 py-1.5 text-xs font-semibold rounded-full border transition ${r===X.id?"bg-lpBlue text-white border-lpBlue":"bg-slate-50 text-slate-700 border-slate-200 hover:bg-slate-100"}`,children:[n.jsx("span",{children:X.label}),N&&n.jsxs("span",{className:"ml-2 inline-flex items-center justify-center px-2 py-0.5 rounded-full bg-white/20 text-[10px]",children:[X.id==="READY"&&N.readyCount,X.id==="ATTACHED"&&N.attachedCount,X.id==="SENT"&&N.sentCount,X.id==="EXCEPTIONS"&&N.exceptionsCount]})]},X.id))}),n.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-3 mb-4 text-sm",children:[n.jsxs("div",{children:[n.jsx("label",{className:"block text-xs font-medium text-slate-600 mb-1",children:""}),n.jsx("input",{className:"w-full border border-slate-200 rounded-lg px-2 py-1.5",placeholder:"   ",value:o,onChange:X=>l(X.target.value)})]}),n.jsxs("div",{children:[n.jsx("label",{className:"block text-xs font-medium text-slate-600 mb-1",children:""}),n.jsxs("select",{className:"w-full border border-slate-200 rounded-lg px-2 py-1.5",value:c,onChange:X=>i(X.target.value),children:[n.jsx("option",{value:"",children:""}),n.jsx("option",{value:"DRAFT",children:""}),n.jsx("option",{value:"READY_FOR_REPORT",children:" "}),n.jsx("option",{value:"ATTACHED_TO_REPORT",children:" "}),n.jsx("option",{value:"ARCHIVED",children:""})]})]}),n.jsxs("div",{children:[n.jsx("label",{className:"block text-xs font-medium text-slate-600 mb-1",children:" "}),n.jsxs("div",{className:"flex gap-2",children:[n.jsx("input",{type:"date",className:"w-1/2 border border-slate-200 rounded-lg px-2 py-1.5",value:u,onChange:X=>p(X.target.value)}),n.jsx("input",{type:"date",className:"w-1/2 border border-slate-200 rounded-lg px-2 py-1.5",value:y,onChange:X=>b(X.target.value)})]})]}),n.jsxs("div",{children:[n.jsx("label",{className:"block text-xs font-medium text-slate-600 mb-1",children:"   / ID"}),n.jsx("input",{className:"w-full border border-slate-200 rounded-lg px-2 py-1.5",placeholder:'/  ,    "',value:w,onChange:X=>R(X.target.value)})]})]}),H&&n.jsx("div",{className:"mt-6 text-sm text-slate-500 text-center",children:" "}),q&&!H&&n.jsx("div",{className:"mt-6 text-sm text-red-600 text-center",children:q}),!H&&!q&&E.length===0&&n.jsxs("div",{className:"mt-6 border border-dashed border-slate-300 rounded-xl py-10 flex flex-col items-center justify-center text-center text-sm text-slate-500",children:[n.jsx("p",{className:"mb-1",children:"  "}),n.jsx("p",{className:"text-xs text-slate-400",children:"/       ."})]}),!H&&!q&&E.length>0&&n.jsx("div",{className:"mt-4 overflow-x-auto border border-slate-200 rounded-xl",children:n.jsxs("table",{className:"w-full text-sm",children:[n.jsx("thead",{className:"bg-slate-50 text-slate-700",children:n.jsxs("tr",{children:[n.jsx("th",{className:"px-3 py-2 text-right",children:""}),n.jsx("th",{className:"px-3 py-2 text-right",children:""}),n.jsx("th",{className:"px-3 py-2 text-right",children:""}),n.jsx("th",{className:"px-3 py-2 text-right",children:" #"}),n.jsx("th",{className:"px-3 py-2 text-right",children:" "}),n.jsx("th",{className:"px-3 py-2 text-right",children:" "}),n.jsx("th",{className:"px-3 py-2 text-right",title:"         ",children:"INFO_ONLY"}),n.jsx("th",{className:"px-3 py-2 text-right",title:"       ",children:""}),n.jsx("th",{className:"px-3 py-2 text-left",children:""})]})}),n.jsx("tbody",{children:E.map(X=>{var ye;const se=(ye=X.blockingIssueCodesLatest)==null?void 0:ye.includes("MISSING_ATTACHMENT_REQUIRED"),I=X.expensesOutOfSync,ae=(X.blockingIssueCodesLatest||[]).some(Pe=>Pe!=="MISSING_ATTACHMENT_REQUIRED");let ne="";return I?ne=" ":se?ne=" ":ae&&(ne=""),n.jsxs("tr",{className:"border-t border-slate-100 hover:bg-slate-50",children:[n.jsx("td",{className:"px-3 py-2 text-right font-mono text-xs text-slate-800",children:X.caseId}),n.jsx("td",{className:"px-3 py-2 text-right text-slate-800",children:X.insurerName||""}),n.jsx("td",{className:"px-3 py-2 text-right text-slate-800 text-xs",children:Dp[X.status]||X.status}),n.jsxs("td",{className:"px-3 py-2 text-right text-slate-800 text-xs",children:[" #",X.versionIndex]}),n.jsx("td",{className:"px-3 py-2 text-right text-slate-700 text-xs",children:new Date(X.updatedAt).toLocaleString("he-IL",{dateStyle:"short",timeStyle:"short"})}),n.jsxs("td",{className:"px-3 py-2 text-right text-blue-700 font-semibold text-xs",children:[X.amountToRequest.toLocaleString("he-IL")," "]}),n.jsx("td",{className:"px-3 py-2 text-right text-xs text-slate-700",children:X.infoOnly?"":""}),n.jsx("td",{className:"px-3 py-2 text-right text-xs",children:ne?n.jsx("span",{className:"inline-flex px-2 py-0.5 rounded-full bg-amber-100 text-amber-800 border border-amber-200",children:ne}):n.jsx("span",{className:"text-slate-400",children:""})}),n.jsxs("td",{className:"px-3 py-2 text-left text-xs space-x-2 space-x-reverse",children:[n.jsx("button",{type:"button",className:"px-2 py-1 rounded border border-slate-300 text-slate-700 hover:bg-slate-100",onClick:()=>Be(X),children:""}),n.jsx("button",{type:"button",className:"px-2 py-1 rounded border border-slate-300 text-slate-600 hover:bg-slate-100",onClick:()=>{var Pe;(Pe=navigator.clipboard)!=null&&Pe.writeText?navigator.clipboard.writeText(X.sheetId).catch(()=>{}):window.prompt(" :",X.sheetId)},children:" "})]})]},X.sheetId)})})]})}),G&&n.jsxs("div",{className:"mt-6 bg-slate-50 border border-slate-200 rounded-xl p-4",children:[n.jsxs("div",{className:"flex flex-col md:flex-row md:items-center md:justify-between gap-2 mb-2",children:[n.jsxs("h3",{className:"text-sm font-bold text-slate-900",children:["   ",G.caseId," (",G.sheetId,")"]}),n.jsxs("div",{className:"flex flex-wrap gap-2 text-[11px]",children:[n.jsx("button",{type:"button",className:"px-2 py-1 rounded border border-slate-300 text-slate-700 hover:bg-slate-100",onClick:()=>{var X;(X=navigator.clipboard)!=null&&X.writeText?navigator.clipboard.writeText(G.sheetId).catch(()=>{}):window.prompt(" :",G.sheetId)},children:"  "}),((ct=C==null?void 0:C.sheet)==null?void 0:ct.attachedToReportId)&&n.jsx("button",{type:"button",className:"px-2 py-1 rounded border border-slate-300 text-slate-700 hover:bg-slate-100",onClick:()=>{var se;const X=C.sheet.attachedToReportId;(se=navigator.clipboard)!=null&&se.writeText?navigator.clipboard.writeText(X).catch(()=>{}):window.prompt(" :",X)},children:"  "}),n.jsx("button",{type:"button",className:"px-2 py-1 rounded border border-slate-300 text-slate-700 hover:bg-slate-100",onClick:()=>{var se;const X=`${window.location.origin}${window.location.pathname}?financialSheetId=${encodeURIComponent(G.sheetId)}`;(se=navigator.clipboard)!=null&&se.writeText?navigator.clipboard.writeText(X).catch(()=>{}):window.prompt("  :",X)},children:"  "})]})]}),D&&n.jsx("p",{className:"text-xs text-slate-500",children:" "}),z&&n.jsx("p",{className:"text-xs text-red-600",children:z}),!D&&C&&C.sheet&&n.jsxs("div",{className:"space-y-3 text-xs text-slate-800",children:[n.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-2",children:[n.jsxs("div",{children:[n.jsx("span",{className:"font-semibold",children:":"})," ",n.jsx("span",{className:"font-mono",children:C.sheet.caseId})]}),n.jsxs("div",{children:[n.jsx("span",{className:"font-semibold",children:":"})," ",n.jsx("span",{children:C.sheet.insurerName||""})]}),n.jsxs("div",{children:[n.jsx("span",{className:"font-semibold",children:":"})," ",n.jsx("span",{children:Dp[C.sheet.status]||C.sheet.status})]}),n.jsxs("div",{children:[n.jsx("span",{className:"font-semibold",children:" #:"})," ",n.jsx("span",{children:C.sheet.versionIndex})]}),n.jsxs("div",{children:[n.jsx("span",{className:"font-semibold",children:":"})," ",n.jsx("span",{children:new Date(C.sheet.updatedAt).toLocaleString("he-IL",{dateStyle:"short",timeStyle:"short"})})]}),n.jsxs("div",{children:[n.jsx("span",{className:"font-semibold",children:" :"})," ",n.jsx("span",{children:C.sheet.readyAt||""})]}),n.jsxs("div",{children:[n.jsx("span",{className:"font-semibold",children:" :"})," ",n.jsx("span",{children:C.sheet.attachedAt||""})]})]}),n.jsxs("div",{className:"mt-3",children:[n.jsx("h4",{className:"font-semibold text-slate-900 mb-1 text-xs",children:"  (  )"}),n.jsx("p",{className:"text-[11px] text-slate-500 mb-1",children:"       ,      ."}),n.jsxs("div",{className:"inline-flex rounded-full bg-slate-100 p-1 text-[11px] font-semibold text-slate-700",children:[n.jsx("button",{type:"button",className:`px-3 py-1 rounded-full transition ${C.exceptionStatus?"text-slate-600 hover:text-slate-900":"bg-white shadow-sm text-slate-900"}`,onClick:()=>He("IN_PROGRESS"),children:""}),n.jsx("button",{type:"button",className:`px-3 py-1 rounded-full transition ${C.exceptionStatus==="RESOLVED"?"bg-emerald-500 text-white shadow-sm":"text-slate-600 hover:text-slate-900"}`,onClick:()=>He("RESOLVED"),children:""})]})]}),C.audit&&C.audit.length>0&&n.jsxs("div",{className:"mt-2",children:[n.jsxs("div",{className:"flex items-center justify-between mb-1",children:[n.jsx("h4",{className:"font-semibold text-slate-900",children:"Decision Logs"}),n.jsxs("label",{className:"flex items-center gap-1 text-[11px] text-slate-600",children:[n.jsx("input",{type:"checkbox",className:"rounded border-slate-300",checked:ce,onChange:X=>le(X.target.checked)}),n.jsx("span",{children:" Decision Logs "})]})]}),(()=>{const X=C.audit.filter(I=>I.diffJson&&I.diffJson.decisionLog).sort((I,ae)=>new Date(ae.eventAt).getTime()-new Date(I.eventAt).getTime());if(!X.length)return n.jsx("p",{className:"text-slate-500 text-[11px]",children:"   ."});const se=ce?X:[X[0]];return n.jsx("div",{className:"space-y-2 text-[11px]",children:se.map((I,ae)=>{const ne=I.diffJson.decisionLog;return n.jsxs("div",{className:"border border-slate-200 rounded-lg px-2 py-1.5 bg-white/60",children:[ce&&n.jsxs("div",{className:"flex items-center justify-between mb-0.5 text-[10px] text-slate-500",children:[n.jsx("span",{children:new Date(I.eventAt).toLocaleString("he-IL",{dateStyle:"short",timeStyle:"short"})}),n.jsxs("span",{children:["#",ae+1]})]}),n.jsxs("div",{className:"space-y-1",children:[n.jsxs("div",{children:[n.jsx("span",{className:"font-semibold",title:"      ",children:"Ruleset:"})," ",n.jsxs("span",{children:[ne.rulesetId||""," ("," ",ne.rulesetVersion||"-",")"]})]}),n.jsxs("div",{className:"space-y-0.5",children:[n.jsxs("div",{children:[n.jsx("span",{className:ne.checks.requiredFieldsOk?"text-green-600":"text-red-600",children:ne.checks.requiredFieldsOk?"":""})," ",n.jsx("span",{children:"   "})]}),n.jsxs("div",{children:[n.jsx("span",{className:ne.checks.sumsValid?"text-green-600":"text-red-600",children:ne.checks.sumsValid?"":""})," ",n.jsx("span",{children:" "})]}),n.jsxs("div",{children:[n.jsx("span",{className:ne.checks.attachmentsOk?"text-green-600":"text-red-600",children:ne.checks.attachmentsOk?"":""})," ",n.jsx("span",{children:"    "})]}),n.jsxs("div",{children:[n.jsx("span",{className:ne.checks.infoOnlyConsistent?"text-green-600":"text-red-600",children:ne.checks.infoOnlyConsistent?"":""})," ",n.jsx("span",{children:" INFO_ONLY"})]})]}),n.jsxs("div",{children:[n.jsx("span",{className:"font-semibold",children:" :"})," ",n.jsx("span",{children:(ne.blockingIssueCodes||ne.blockingIssueCodesLatest||[]).join(", ")||""})]})]})]},I.id)})})})()]}),C.audit&&C.audit.length>0&&n.jsxs("div",{className:"mt-3",children:[n.jsxs("div",{className:"flex items-center justify-between mb-1",children:[n.jsx("h4",{className:"font-semibold text-slate-900",children:"Audit Log"}),n.jsxs("label",{className:"flex items-center gap-1 text-[11px] text-slate-600",children:[n.jsx("input",{type:"checkbox",className:"rounded border-slate-300",checked:Q,onChange:X=>me(X.target.checked)}),n.jsx("span",{children:" Audit Log "})]})]}),n.jsx("ul",{className:"space-y-0.5 text-[11px] text-slate-700",children:(Q?C.audit:C.audit.slice(0,10)).map(X=>n.jsxs("li",{children:[n.jsx("span",{className:"font-mono text-slate-500 mr-1",children:new Date(X.eventAt).toLocaleString("he-IL",{dateStyle:"short",timeStyle:"short"})})," ",n.jsx("span",{className:"font-semibold",children:X.eventType})," "," ",n.jsx("span",{className:"text-slate-500",children:X.actorRole})]},X.id))})]}),C.sheet.attachedToReportId&&n.jsxs("div",{className:"mt-3",children:[n.jsx("button",{type:"button",className:"px-3 py-1.5 rounded border border-slate-300 text-xs text-slate-700 hover:bg-slate-100",onClick:()=>s(C.sheet.attachedToReportId),children:"  "}),n.jsx("button",{type:"button",className:"ml-2 px-3 py-1.5 rounded border border-blue-500 text-xs text-blue-700 hover:bg-blue-50",onClick:Ye,children:"  "})]}),!C.sheet.attachedToReportId&&n.jsx("div",{className:"mt-3",children:n.jsx("button",{type:"button",className:"px-3 py-1.5 rounded border border-blue-500 text-xs text-blue-700 hover:bg-blue-50",onClick:Ye,children:"  "})})]})]})]})},ri=e=>{const t=e.updatedAt||e.sentAt||e.reportDate;return t?new Date(t).getTime():0},Ub=e=>{var s;return(((s=e.reportReview)==null?void 0:s.issues)??[]).some(r=>(r.origin??"INTERNAL")==="EXTERNAL"&&r.status!=="DONE")},Wb=e=>{var s;return(((s=e.reportReview)==null?void 0:s.issues)??[]).some(r=>(r.origin??"INTERNAL")==="EXTERNAL"&&r.status!=="DONE"&&r.externalAction==="REQUIRES_HEBREW")},zb=e=>e.filter(t=>t.deletedAt?!1:t.hebrewWorkflowStatus==="HEBREW_REOPENED_EXTERNAL"?!0:Ub(t)).sort((t,s)=>ri(s)-ri(t)),Vb=(e,t)=>e.filter(s=>!(s.deletedAt||s.status!=="SENT"||!t(s)||Wb(s))).sort((s,r)=>ri(r)-ri(s)),Kb="adminDashboardUiState:v1",Yb=["u6","u5","u7","u4"],ul=Yb.map(e=>Ss.find(t=>t.id===e&&t.role==="LAWYER")).filter(e=>!!e);function Gb(e){var a;if(e.status==="SENT")return"GREEN";const t=(a=e.reportReview)==null?void 0:a.status,s=e.hebrewWorkflowStatus;return(t==="SUBMITTED"||t==="APPROVED"||t==="CHANGES_REQUESTED"||s==="HEBREW_SUBMITTED"||s==="HEBREW_APPROVED"||s==="HEBREW_CHANGES_REQUESTED"||s==="HEBREW_REOPENED_EXTERNAL")&&e.status!=="SENT"?"RED":"YELLOW"}const qb=({user:e,reports:t,onSelectReport:s,onSelectReportWithFocus:r,onMarkExternalIssuesDone:a,onReopenHebrewDueToExternalFeedback:o,onNewReport:l,caseFolders:c,onUpdateCaseFolders:i,canTranslate:u,onLogout:p,onOpenAssistant:y,onOpenCaseFolder:b})=>{var F;const w=g.useMemo(()=>t.filter(C=>!C.deletedAt),[t]),R=g.useMemo(()=>zb(w),[w]),E=g.useMemo(()=>Vb(w,u),[w,u]),W=g.useMemo(()=>{const C=new Map;return w.forEach(L=>{if(!L.createdBy)return;const Q=C.get(L.createdBy)||[];Q.push(L),C.set(L.createdBy,Q)}),C},[w]),N=g.useMemo(()=>ul.map(C=>{const Q=(W.get(C.id)||[]).filter(fe=>fe.status!=="SENT"),me=Q.filter(fe=>fe.status==="READY_TO_SEND").length,ce=R.filter(fe=>fe.createdBy===C.id).length,le=E.filter(fe=>fe.createdBy===C.id).length;return{lawyer:C,totalOpen:Q.length,readyToSendCount:me,feedbackCount:ce,resendCount:le}}),[R,E,W]),h=C=>{var L;return C.hebrewWorkflowStatus?C.hebrewWorkflowStatus:((L=C.reportReview)==null?void 0:L.status)??"-"},S=C=>{if(!C)return dl.queueItem.noDate;try{const L=new Date(C);return`${L.toLocaleDateString("he-IL")} ${L.toLocaleTimeString("he-IL",{hour:"2-digit",minute:"2-digit"}).replace(":00","")}`}catch{return C}},[M,H]=g.useState("ADMIN"),[V,q]=g.useState(((F=ul[0])==null?void 0:F.id)||""),[te,G]=g.useState("SUMMARY"),[re,j]=g.useState(null),P=g.useMemo(()=>c?Object.values(c).filter(C=>C.closedAt):[],[c]),D=g.useMemo(()=>ul.find(C=>C.id===V)||ul[0],[V]),O=g.useMemo(()=>{if(!D)return[];const C=W.get(D.id)||[],L=new Map;C.filter(le=>!le.deletedAt).forEach(le=>{const fe=le.odakanitNo&&le.odakanitNo.trim().length>0?le.odakanitNo.trim():"NO_ODAKANIT",Te=L.get(fe)||[];Te.push(le),L.set(fe,Te)});const Q=Array.from(L.entries()).map(([le,fe])=>{let Te=fe[0];fe.forEach(Ve=>{const He=new Date(Ve.updatedAt||Ve.reportDate).getTime(),ct=new Date(Te.updatedAt||Te.reportDate).getTime();He>ct&&(Te=Ve)});const ge=le==="NO_ODAKANIT"?"":le,Be=ge||"  ",Ye=Te.updatedAt||Te.reportDate;return{odakanitNo:ge,displayOdakanit:Be,representative:Te,lastUpdatedIso:Ye,reportsCount:fe.length}}),me=[];return c&&Object.values(c).forEach(le=>{var ge;if(!le.odakanitNo||le.assignedLawyer!==D.id)return;const fe=le.odakanitNo.trim();if(!fe||L.has(fe))return;const Te={id:`seed-folder-${fe}`,createdBy:D.id,ownerName:D.name,ownerEmail:D.email,reportDate:le.updatedAt||le.createdAt,status:"DRAFT",reportSubject:le.reTemplate||"",recipientId:"1",insurerName:le.insurerName||"",lineSlipNo:le.lineSlipNo||"",marketRef:le.marketRef||"",certificateRef:le.certificateRef||"",insuredName:le.insuredName||"",plaintiffName:le.plaintiffName||"",plaintiffTitle:"Plaintiff",sentAt:void 0,reportHistory:[],selectedTimeline:"standard",filenameTag:"New lawsuit",selectedSections:["Update","Recommendations"],content:{},translatedContent:{},invoiceFiles:[],isWaitingForInvoices:!1,requiresExpenses:!1,isTranslated:!1,expensesItems:[],expenseWorksheet:void 0,reportNotes:[],complaintAnalysis:void 0};me.push({odakanitNo:le.odakanitNo,displayOdakanit:le.odakanitNo||"  ",representative:Te,lastUpdatedIso:le.updatedAt||le.createdAt,reportsCount:((ge=le.sentReports)==null?void 0:ge.length)||0})}),[...Q,...me].sort((le,fe)=>{const Te=le.lastUpdatedIso?new Date(le.lastUpdatedIso).getTime():0;return(fe.lastUpdatedIso?new Date(fe.lastUpdatedIso).getTime():0)-Te})},[W,D,c]),z=g.useMemo(()=>{if(!D||!re)return[];const C=W.get(D.id)||[],L=re.trim();return C.filter(Q=>!Q.deletedAt).filter(Q=>(Q.odakanitNo||"").trim()===L)},[W,D,re]);return n.jsx("div",{className:"min-h-screen bg-navySecondary",dir:"rtl",children:n.jsxs("div",{className:"w-full px-6 md:px-8 lg:px-10 xl:px-12 py-6",children:[n.jsxs("header",{className:"flex flex-col md:flex-row items-start md:items-center justify-between gap-4 mb-6",children:[n.jsxs("div",{children:[n.jsx("h1",{className:"text-2xl font-bold text-textLight",children:dl.title}),n.jsx("p",{className:"text-sm text-textMuted mt-1",children:dl.subtitle}),n.jsxs("p",{className:"text-xs text-textMuted mt-1",children:["/ ",n.jsx("span",{className:"font-semibold",children:e.name})," ",n.jsxs("span",{className:"ml-1 text-textMuted",children:["(",e.role==="SUB_ADMIN"?"SUB_ADMIN":"ADMIN",")"]})]})]}),n.jsxs("div",{className:"flex flex-col items-stretch md:flex-row md:items-center gap-3",children:[n.jsxs("div",{className:"inline-flex rounded-full bg-slate-100 p-1 text-xs font-semibold text-textMuted",children:[n.jsx("button",{type:"button",onClick:()=>H("ADMIN"),className:`px-3 py-1 rounded-full transition ${M==="ADMIN"?"bg-panel text-textLight shadow-sm":"text-textMuted hover:text-textLight"}`,children:" "}),n.jsx("button",{type:"button",onClick:()=>H("FINANCIAL_CONTROL"),className:`px-3 py-1 rounded-full transition ${M==="FINANCIAL_CONTROL"?"bg-panel text-textLight shadow-sm":"text-textMuted hover:text-textLight"}`,children:" "})]}),y&&n.jsx("button",{type:"button",onClick:()=>y(),className:"inline-flex items-center justify-center px-3 py-2 rounded-lg border border-indigo-200 bg-panel text-xs font-semibold text-indigo-800 hover:bg-indigo-50 transition",children:" "}),n.jsx("button",{type:"button",onClick:p,className:"inline-flex items-center justify-center px-3 py-2 rounded-lg border border-red-200 bg-panel text-sm font-semibold text-red-700 hover:bg-red-50 transition",children:""}),n.jsx("button",{onClick:l,className:"inline-flex items-center justify-center px-4 py-2 rounded-lg bg-lpBlue text-white text-sm font-semibold shadow-sm hover:bg-blue-800 transition",children:dl.actions.openNewReport})]})]}),M==="FINANCIAL_CONTROL"?n.jsx(Hb,{user:e,reports:t,onOpenReport:s}):n.jsxs(n.Fragment,{children:[n.jsxs("section",{className:"mb-6",children:[n.jsx("h2",{className:"text-sm font-semibold text-textLight mb-2",children:"   "}),n.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 xl:grid-cols-5 gap-3 text-xs",children:N.map(C=>{const L=(D==null?void 0:D.id)===C.lawyer.id;return n.jsxs("button",{type:"button",onClick:()=>{q(C.lawyer.id),j(null),G("LAWYER_CASES")},className:`flex flex-col items-stretch rounded-2xl border px-3 py-3 text-right shadow-sm transition ${L?"border-gold bg-blue-50/80":"border-borderDark bg-panel hover:bg-navySecondary"}`,children:[n.jsxs("div",{className:"flex items-center justify-between mb-1",children:[n.jsx("span",{className:"text-[11px] font-semibold text-slate-700",children:C.lawyer.name}),n.jsxs("span",{className:"inline-flex items-center rounded-full bg-slate-100 px-2 py-0.5 text-[10px] text-textMuted",children:[C.totalOpen," "]})]}),n.jsxs("div",{className:"flex flex-col gap-0.5 text-[11px] text-textMuted",children:[n.jsxs("span",{children:[" :",n.jsx("span",{className:"font-semibold text-emerald-700",children:C.readyToSendCount})]}),n.jsxs("span",{children:["  :",n.jsx("span",{className:"font-semibold text-purple-700",children:C.feedbackCount})]})]})]},C.lawyer.id)})})]}),e.role==="ADMIN"&&c&&i&&n.jsx(Tb,{caseFolders:c,onUpdateCaseFolders:i,reports:t}),e.role==="ADMIN"&&P.length>0&&n.jsxs("section",{className:"mb-6 bg-panel rounded-2xl border border-borderDark shadow-sm p-4",children:[n.jsx("div",{className:"flex items-center justify-between mb-3",children:n.jsxs("div",{children:[n.jsx("h2",{className:"text-sm font-semibold text-textLight",children:" "}),n.jsx("p",{className:"text-[11px] text-textMuted",children:"      .   ,   (  )   ."})]})}),n.jsx("div",{className:"overflow-x-auto",children:n.jsxs("table",{className:"min-w-full text-[11px]",children:[n.jsx("thead",{children:n.jsxs("tr",{className:"border-b border-borderDark bg-navySecondary",children:[n.jsx("th",{className:"px-2 py-1 text-right font-semibold",children:"  "}),n.jsx("th",{className:"px-2 py-1 text-right font-semibold",children:""}),n.jsx("th",{className:"px-2 py-1 text-right font-semibold",children:""}),n.jsx("th",{className:"px-2 py-1 text-right font-semibold",children:" "}),n.jsx("th",{className:"px-2 py-1 text-right font-semibold",children:""})]})}),n.jsx("tbody",{children:P.map(C=>{const L=C.closedAt?new Date(C.closedAt).toLocaleDateString("he-IL"):"";return n.jsxs("tr",{className:"border-b border-borderDark",children:[n.jsx("td",{className:"px-2 py-1 text-right font-semibold text-textLight",children:C.odakanitNo}),n.jsx("td",{className:"px-2 py-1 text-right text-slate-700",children:C.insuredName||""}),n.jsx("td",{className:"px-2 py-1 text-right text-slate-700",children:C.plaintiffName||""}),n.jsx("td",{className:"px-2 py-1 text-right text-textMuted",children:L}),n.jsx("td",{className:"px-2 py-1 text-left",children:b&&n.jsx("button",{type:"button",onClick:()=>b(C.odakanitNo),className:"inline-flex items-center rounded-full bg-panel px-3 py-1 text-[11px] font-semibold text-gold border border-gold hover:bg-navySecondary",children:" "})})]},C.odakanitNo)})})]})})]}),te==="LAWYER_CASES"&&D&&n.jsxs("section",{className:"mb-6 bg-panel rounded-2xl border border-borderDark shadow-sm p-4",children:[n.jsxs("div",{className:"flex items-center justify-between mb-3",children:[n.jsxs("div",{children:[n.jsxs("h2",{className:"text-sm font-semibold text-textLight",children:["     ",D.name]}),n.jsx("p",{className:"text-[11px] text-textMuted",children:"        ."})]}),n.jsx("button",{type:"button",onClick:()=>{G("SUMMARY"),j(null)},className:"text-[11px] px-3 py-1.5 rounded-full border border-borderDark text-slate-700 hover:bg-navySecondary",children:" "})]}),O.length===0?n.jsx("p",{className:"text-xs text-textMuted",children:"       ."}):n.jsx("div",{className:"overflow-x-auto",children:n.jsxs("table",{className:"min-w-full text-[11px]",children:[n.jsx("thead",{children:n.jsxs("tr",{className:"border-b border-borderDark bg-navySecondary",children:[n.jsx("th",{className:"px-2 py-1 text-right font-semibold",children:" "}),n.jsx("th",{className:"px-2 py-1 text-right font-semibold w-20",children:"REPORT NO."}),n.jsx("th",{className:"px-2 py-1 text-right font-semibold w-40",children:"PLAINTIFF/CLAIMANT"}),n.jsx("th",{className:"px-2 py-1 text-right font-semibold w-40",children:"INSURED"}),n.jsx("th",{className:"px-2 py-1 text-right font-semibold w-40",children:"INSURER"}),n.jsx("th",{className:"px-2 py-1 text-right font-semibold w-28",children:"'  "})]})}),n.jsx("tbody",{children:O.map(C=>{var Ye;const{representative:L}=C,Q=!!C.odakanitNo,me=Zl(L),ce=me?me.split(" - "):[],le=ce.length<=2?me:ce[ce.length-2]||me,fe=typeof L.reportNumber=="number"&&L.reportNumber>0?L.reportNumber:(((Ye=L.reportHistory)==null?void 0:Ye.length)||0)+1,Te=L.plaintiffName||"",ge=L.insuredName||"",Be=L.insurerName||"";return n.jsxs("tr",{className:`border-b border-borderDark ${Q?"hover:bg-navySecondary cursor-pointer":"bg-navySecondary/40 text-textMuted"}`,onClick:()=>{Q&&(j(C.odakanitNo),G("CASE_REPORTS"))},children:[n.jsxs("td",{className:"px-2 py-1 text-right",children:[n.jsx("div",{className:"text-textLight",children:le||""}),n.jsx("div",{className:"text-[10px] text-textMuted",children:S(C.lastUpdatedIso)})]}),n.jsx("td",{className:"px-2 py-1 text-right text-slate-700 font-mono text-[11px]",children:fe}),n.jsx("td",{className:"px-2 py-1 text-right text-slate-700",children:Te}),n.jsx("td",{className:"px-2 py-1 text-right text-slate-700",children:ge}),n.jsx("td",{className:"px-2 py-1 text-right text-slate-700",children:Be}),n.jsx("td",{className:"px-2 py-1 text-right font-mono text-[11px]",children:C.displayOdakanit})]},C.displayOdakanit)})})]})})]}),te==="CASE_REPORTS"&&D&&re&&n.jsxs("section",{className:"mb-6 bg-panel rounded-2xl border border-borderDark shadow-sm p-4",children:[n.jsxs("div",{className:"flex items-center justify-between mb-3",children:[n.jsxs("div",{children:[n.jsxs("h2",{className:"text-sm font-semibold text-textLight",children:["  ",re,"  ",D.name]}),n.jsx("p",{className:"text-[11px] text-textMuted",children:"  ,     ."})]}),n.jsx("button",{type:"button",onClick:()=>G("LAWYER_CASES"),className:"text-[11px] px-3 py-1.5 rounded-full border border-borderDark text-slate-700 hover:bg-navySecondary",children:" "})]}),z.length===0?n.jsx("p",{className:"text-xs text-textMuted",children:"     ."}):n.jsx("div",{className:"overflow-x-auto",children:n.jsxs("table",{className:"min-w-full text-[11px]",children:[n.jsx("thead",{children:n.jsxs("tr",{className:"border-b border-borderDark bg-navySecondary",children:[n.jsx("th",{className:"px-2 py-1 text-right font-semibold w-64",children:" /  / "}),n.jsx("th",{className:"px-2 py-1 text-right font-semibold w-24",children:' \\"'}),n.jsx("th",{className:"px-2 py-1 text-right font-semibold w-32",children:""}),n.jsx("th",{className:"px-2 py-1 text-right font-semibold w-32",children:" "}),n.jsx("th",{className:"px-2 py-1 text-right font-semibold w-28"})]})}),n.jsx("tbody",{children:z.map(C=>{var fe;const L=Gb(C),Q=L==="GREEN"?"bg-emerald-50":L==="RED"?"bg-red-50":"bg-yellow-50",me=!!C.expensesSheetId,ce=C.reportSubject||C.insuredName||C.plaintiffName||"",le=typeof C.reportNumber=="number"&&C.reportNumber>0?C.reportNumber:(((fe=C.reportHistory)==null?void 0:fe.length)||0)+1;return n.jsxs("tr",{className:`border-b border-borderDark hover:bg-slate-100 cursor-pointer ${Q}`,onClick:()=>s(C.id),children:[n.jsxs("td",{className:"px-2 py-1 text-right",children:[n.jsxs("div",{className:"text-textLight flex flex-wrap items-center gap-1 justify-end",children:[n.jsx("span",{children:ce}),me&&n.jsx("span",{className:"inline-flex items-center rounded-full bg-purple-100 px-2 py-0.5 text-[10px] font-medium text-purple-700",children:" /  "})]}),(C.insuredName||C.plaintiffName)&&n.jsx("div",{className:"text-[10px] text-textMuted",children:[C.insuredName,C.plaintiffName].filter(Boolean).join(" / ")})]}),n.jsx("td",{className:"px-2 py-1 text-right text-slate-700",children:le}),n.jsxs("td",{className:"px-2 py-1 text-right text-slate-700",children:[h(C)," (",C.status,")"]}),n.jsx("td",{className:"px-2 py-1 text-right text-textMuted whitespace-nowrap",children:S(C.updatedAt||C.reportDate)}),n.jsx("td",{className:"px-2 py-1 text-left",children:n.jsx("button",{type:"button",onClick:Te=>{Te.stopPropagation(),s(C.id)},className:"inline-flex items-center rounded-full bg-lpBlue px-3 py-1 text-[11px] font-semibold text-white shadow-sm hover:bg-blue-900",children:' \\"'})})]},C.id)})})]})})]})]})]})})},Xb={DRAFT:"",READY_FOR_REPORT:" ",ATTACHED_TO_REPORT:" ",ARCHIVED:""},Jb=({user:e,reports:t,onLogout:s,onNotifyLawyer:r,onMarkReportPaid:a,onSheetDeleted:o,onOpenAssistant:l,caseFolders:c})=>{const[i,u]=g.useState([]),[p,y]=g.useState(null),[b,w]=g.useState(!1),[R,E]=g.useState("ALL"),[W,N]=g.useState(""),[h,S]=g.useState(null),[M,H]=g.useState(null),[V,q]=g.useState({}),te=async()=>{w(!0);try{const z=await Ge.listSheets();u(z)}finally{w(!1)}};g.useEffect(()=>{te()},[]);const G=g.useMemo(()=>{const z=new Map;return t.forEach(F=>{if(!F.expensesSheetId)return;const C=z.get(F.expensesSheetId);if(!C){z.set(F.expensesSheetId,F);return}const L=C.updatedAt&&new Date(C.updatedAt).getTime()||0;(F.updatedAt&&new Date(F.updatedAt).getTime()||0)>L&&z.set(F.expensesSheetId,F)}),z},[t]),re=g.useMemo(()=>i.filter(z=>{if(R!=="ALL"&&z.status!==R)return!1;const F=W.trim().toLowerCase();return!(F&&!(z.insurerName||"").toLowerCase().includes(F))}),[i,R,W]);g.useEffect(()=>{const z=re.map(F=>F.id).filter(F=>!V[F]);z.length&&z.forEach(F=>{(async()=>{try{const C=await Ge.getSheet(F);if(!C)return;const L=On(C.sheet,C.lineItems);q(Q=>({...Q,[F]:L}))}catch{}})()})},[re,V]);const j=async z=>{const F=await Ge.getSheet(z);F&&(S(z),H(F))},P=async()=>{const F=(window.prompt("  / :")||"").trim();if(!F)return;const C=we(F),L=t.filter(Te=>we(Te.odakanitNo||"")===C);let Q=null;L.length>0&&(Q=L.reduce((ge,Be)=>{const Ye=ge.updatedAt?new Date(ge.updatedAt).getTime()||0:new Date(ge.reportDate||"").getTime()||0;return(Be.updatedAt?new Date(Be.updatedAt).getTime()||0:new Date(Be.reportDate||"").getTime()||0)>Ye?Be:ge}).insurerName||null);let me=1,ce=0,le=0;try{const ge=(await Ge.listSheets()).filter(Be=>we(Be.caseId)===C);if(ge.length>0){ge.sort((Ve,He)=>{const ct=new Date(Ve.updatedAt||Ve.createdAt).getTime();return new Date(He.updatedAt||He.createdAt).getTime()-ct});const Be=ge[0];ce=Be.deductibleAmount??0,le=Be.alreadyPaidAmount??0,me=ge.reduce((Ve,He)=>He.versionIndex&&He.versionIndex>Ve?He.versionIndex:Ve,1)+1}}catch{}const fe=await Ge.createSheet(e,{caseId:F,insurerId:null,insurerName:Q,periodLabel:"",versionIndex:me,currency:"ILS",deductibleAmount:ce,alreadyPaidAmount:le,infoOnly:!1});await te(),await j(fe.id)},D=z=>{H(z),u(F=>F.map(C=>C.id===z.sheet.id?z.sheet:C));try{const F=On(z.sheet,z.lineItems);q(C=>({...C,[z.sheet.id]:F}))}catch{}},O=()=>{S(null),H(null)};if(h&&M){const z=G.get(M.sheet.id)||null;return n.jsx("div",{className:"w-full px-6 md:px-8 lg:px-10 xl:px-12 py-6",children:n.jsx(_h,{user:e,sheetWithRelations:M,onSheetUpdated:D,onBack:O,onNotifyLawyer:r,linkedReportForLawyer:z})})}return n.jsxs("div",{className:"w-full px-6 md:px-8 lg:px-10 xl:px-12 py-6",children:[n.jsxs("div",{className:"flex items-center justify-between mb-5",children:[n.jsxs("div",{children:[n.jsx("h1",{className:"text-3xl font-semibold text-gray-900",children:" "}),n.jsx("p",{className:"text-base text-gray-600 mt-1",children:"        ()."})]}),n.jsxs("div",{className:"flex gap-2 items-center",children:[l&&n.jsx("button",{type:"button",className:"px-3 py-1.5 text-base rounded border border-indigo-200 text-indigo-800 bg-indigo-50 hover:bg-indigo-100",onClick:l,children:" "}),n.jsx("button",{type:"button",className:"px-3 py-1.5 text-base rounded border border-gray-300 text-gray-700 hover:bg-gray-50",onClick:s,children:""}),n.jsx("button",{type:"button",className:"px-4 py-1.5 text-base rounded bg-blue-600 text-white hover:bg-blue-700",onClick:P,children:"   "})]})]}),n.jsxs("div",{className:"flex flex-wrap gap-4 mb-4 items-end",children:[n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"  "}),n.jsxs("select",{className:"border rounded px-2 py-1 text-base",value:R,onChange:z=>E(z.target.value==="ALL"?"ALL":z.target.value),children:[n.jsx("option",{value:"ALL",children:""}),n.jsx("option",{value:"DRAFT",children:""}),n.jsx("option",{value:"READY_FOR_REPORT",children:" "}),n.jsx("option",{value:"ATTACHED_TO_REPORT",children:" "}),n.jsx("option",{value:"ARCHIVED",children:""})]})]}),n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:""}),n.jsx("input",{className:"border rounded px-2 py-1 text-base",placeholder:"   ",value:W,onChange:z=>N(z.target.value)})]})]}),n.jsx("div",{className:"bg-white border rounded-lg shadow-sm overflow-x-auto text-base",children:n.jsxs("table",{className:"min-w-full",children:[n.jsx("thead",{className:"bg-gray-50",children:n.jsxs("tr",{children:[n.jsx("th",{className:"px-3 py-2 border-b text-right",children:""}),n.jsx("th",{className:"px-3 py-2 border-b text-right",children:""}),n.jsx("th",{className:"px-3 py-2 border-b text-right",children:""}),n.jsx("th",{className:"px-3 py-2 border-b text-right",children:""}),n.jsx("th",{className:"px-3 py-2 border-b text-right",children:" "}),n.jsx("th",{className:"px-3 py-2 border-b text-right",children:" "}),n.jsx("th",{className:"px-3 py-2 border-b text-right",children:""})]})}),n.jsxs("tbody",{children:[b&&n.jsx("tr",{children:n.jsx("td",{colSpan:7,className:"px-3 py-4 text-center text-gray-500",children:" "})}),!b&&re.length===0&&n.jsx("tr",{children:n.jsx("td",{colSpan:7,className:"px-3 py-4 text-center text-gray-500",children:"    ."})}),!b&&re.map(z=>{const F=G.get(z.id),C=V[z.id],L=F?F.status==="TASK_ASSIGNED"?" ":F.status==="WAITING_FOR_INVOICES"?" ":F.status==="READY_TO_SEND"?"   ":F.status==="SENT"?"  ":"  ":"",Q=F?F.status==="SENT"?F.isPaid?"":"  ":L:Xb[z.status],me=(()=>{const ce=we(z.caseId),le=c==null?void 0:c[ce];return le&&le.closedAt?"":!le&&!t.some(Te=>we(Te.odakanitNo)===ce)?"  ":""})();return n.jsxs("tr",{className:"hover:bg-gray-50",children:[n.jsx("td",{className:"px-3 py-2 border-b font-mono text-sm text-gray-800",children:n.jsxs("div",{className:"flex flex-col items-start gap-0.5",children:[n.jsx("span",{children:z.caseId}),n.jsx("span",{className:"inline-flex px-2 py-0.5 rounded-full text-[11px] bg-gray-100 text-gray-700 border border-gray-200",children:me===""?" ":me==="  "?"  ":" "})]})}),n.jsx("td",{className:"px-3 py-2 border-b text-gray-800",children:z.insurerName||""}),n.jsxs("td",{className:"px-3 py-2 border-b text-gray-800",children:["  #",z.versionIndex]}),n.jsx("td",{className:"px-3 py-2 border-b",children:n.jsx("span",{className:"inline-flex px-2 py-0.5 rounded-full text-sm bg-gray-100 text-gray-700 border border-gray-200",children:Q})}),n.jsx("td",{className:"px-3 py-2 border-b text-gray-700",children:z.updatedAt?new Date(z.updatedAt).toLocaleString("he-IL",{dateStyle:"short",timeStyle:"short"}):""}),n.jsx("td",{className:"px-3 py-2 border-b text-blue-700 font-semibold",children:C?`${C.amountToRequest.toLocaleString("he-IL")} `:""}),n.jsx("td",{className:"px-3 py-2 border-b text-left",children:n.jsxs("div",{className:"flex items-center gap-2 justify-start",children:[n.jsx("button",{type:"button",className:"px-3 py-1 text-sm rounded border border-blue-500 text-blue-700 hover:bg-blue-50",onClick:()=>void j(z.id),children:""}),F&&F.status==="SENT"&&!F.isPaid&&a&&n.jsx("button",{type:"button",className:"px-3 py-1 text-sm rounded border border-green-500 text-green-700 hover:bg-green-50",onClick:()=>a(F.id),children:""}),(()=>{const ce=t.some(Ve=>Ve.expensesSheetId===z.id),le=t.find(Ve=>Ve.expensesSheetId===z.id),fe=!!(le!=null&&le.isPaid),Te=!ce||!fe,ge=fe&&e.role==="ADMIN";if(!(Te||ge))return null;const Ye=()=>{if(ge)y({sheet:z,reason:""});else{if(!window.confirm("    ?   ."))return;(async()=>(await Ge.deleteSheet(z.id),o==null||o(z.id),await te()))()}};return n.jsx("button",{type:"button",className:"px-2 py-1 text-sm rounded border border-red-400 text-red-600 hover:bg-red-50",onClick:Ye,children:""})})()]})})]},z.id)})]})]})}),p&&n.jsx("div",{className:"fixed inset-0 bg-black/50 z-[200] flex items-center justify-center p-4",dir:"rtl",children:n.jsxs("div",{className:"bg-white rounded-xl shadow-xl max-w-md w-full p-6",children:[n.jsx("h3",{className:"text-lg font-bold text-gray-900 mb-2",children:"    "}),n.jsx("p",{className:"text-sm text-gray-700 mb-4",children:"    ()."}),n.jsx("input",{type:"text",className:"w-full border rounded px-3 py-2 text-sm mb-4",placeholder:" ",value:p.reason,onChange:z=>y(F=>F?{...F,reason:z.target.value}:null)}),n.jsxs("div",{className:"flex gap-2 justify-end",children:[n.jsx("button",{type:"button",className:"px-3 py-1.5 rounded border border-gray-300 text-gray-700",onClick:()=>y(null),children:""}),n.jsx("button",{type:"button",className:"px-3 py-1.5 rounded bg-red-600 text-white disabled:opacity-50",disabled:!p.reason.trim(),onClick:()=>{p.reason.trim()&&(Ge.recordSheetDeletionByAdmin(e,p.sheet.id,p.reason.trim()),(async()=>(await Ge.deleteSheet(p.sheet.id),o==null||o(p.sheet.id),y(null),await te()))())},children:"  "})]})]})})]})},Qb=g.createContext(void 0);let Zb=0;const ev=({children:e})=>{const[t,s]=g.useState([]),r=g.useCallback(l=>{s(c=>c.filter(i=>i.id!==l))},[]),a=g.useCallback(({message:l,type:c="info"})=>{const i=++Zb;s(u=>[...u,{id:i,message:l,type:c}]),window.setTimeout(()=>{r(i)},3e3)},[r]),o=l=>l==="success"?"border-l-gold text-goldLight":l==="error"?"border-l-danger text-red-300":"border-l-gold text-textLight";return n.jsxs(Qb.Provider,{value:{showToast:a},children:[e,n.jsx("div",{className:"fixed top-4 right-4 z-[260] flex flex-col gap-2 items-end pointer-events-none",dir:"rtl",children:t.map(l=>n.jsxs("div",{className:`pointer-events-auto max-w-xs bg-panel border border-borderDark rounded-lg shadow-lg px-3 py-2 border-l-4 text-xs flex items-center gap-2 text-textLight ${o(l.type)}`,children:[n.jsx("span",{className:"whitespace-pre-line",children:l.message}),n.jsx("button",{type:"button",onClick:()=>r(l.id),className:"ml-1 p-1 rounded hover:bg-navySecondary text-textMuted",children:n.jsx(Ft,{className:"w-3 h-3"})})]},l.id))})]})},tv=({folder:e,reports:t,onBack:s,onUpdateReTemplate:r,onCreateReportInCase:a,onOpenReport:o,currentUserRole:l,onCloseCase:c,onReopenCase:i,onDeleteCase:u})=>{const[p,y]=g.useState(e.reTemplate||""),b=()=>{const h=p.trim();h!==e.reTemplate&&r(h)},E=t.filter(h=>h.odakanitNo&&h.odakanitNo.trim()===e.odakanitNo).filter(h=>h.status!=="SENT"&&!h.deletedAt)[0]||null,W=!!e.closedAt,N=g.useMemo(()=>{const h=new Map;return e.sentReports.forEach(S=>{if(!S||!S.reportId)return;const M=h.get(S.reportId);if(!M){h.set(S.reportId,S);return}const H=new Date(M.sentAt).getTime()||0;(new Date(S.sentAt).getTime()||0)>=H&&h.set(S.reportId,S)}),Array.from(h.values()).sort((S,M)=>{const H=new Date(S.sentAt).getTime()||0,V=new Date(M.sentAt).getTime()||0;return H-V})},[e.sentReports]);return n.jsx("div",{className:"min-h-screen bg-bgDark px-0 pb-8",children:n.jsxs("div",{className:"w-full px-6 md:px-8 lg:px-10 xl:px-12 pt-4",children:[n.jsx("button",{type:"button",onClick:s,className:"mb-4 inline-flex items-center rounded-full bg-panel border border-borderDark px-3 py-1.5 text-xs font-medium text-textLight shadow-sm hover:bg-navySecondary focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-gold focus-visible:ring-offset-2",children:"  "}),n.jsxs("header",{className:"mb-4 rounded-2xl bg-panel px-5 py-4 shadow-sm border border-borderDark flex flex-col gap-2 md:flex-row md:items-center md:justify-between",children:[n.jsxs("div",{children:[n.jsxs("h1",{className:"text-xl font-serif font-bold text-navy",children:["   ",e.odakanitNo]}),n.jsx("p",{className:"mt-1 text-xs text-textMuted",children:"       ."}),W&&n.jsx("p",{className:"mt-1 text-[11px] font-semibold text-amber-700",children:" :    .        ."})]}),n.jsxs("div",{className:"flex flex-wrap items-center gap-2 text-xs",children:[l==="ADMIN"&&!W&&c&&n.jsx("button",{type:"button",onClick:c,className:"inline-flex items-center rounded-full bg-red-50 px-3 py-1.5 font-semibold text-red-700 border border-red-200 hover:bg-red-100",children:" "}),l==="ADMIN"&&W&&n.jsxs(n.Fragment,{children:[i&&n.jsx("button",{type:"button",onClick:i,className:"inline-flex items-center rounded-full bg-green-50 px-3 py-1.5 font-semibold text-green-700 border border-green-200 hover:bg-green-100",children:"  "}),u&&n.jsx("button",{type:"button",onClick:u,className:"inline-flex items-center rounded-full bg-panel px-3 py-1.5 font-semibold text-textLight border border-borderDark hover:bg-navySecondary",children:" "})]})]})]}),n.jsxs("section",{className:"mb-4 grid gap-4 md:grid-cols-2",children:[n.jsxs("div",{className:"rounded-2xl bg-panel p-4 shadow-sm border border-borderDark",children:[n.jsx("h2",{className:"mb-2 text-xs font-semibold uppercase tracking-wide text-textMuted",children:" "}),n.jsxs("dl",{className:"space-y-1 text-xs text-textLight",children:[n.jsxs("div",{children:[n.jsx("dt",{className:"font-semibold text-textMuted",children:""}),n.jsx("dd",{children:e.insuredName||""})]}),n.jsxs("div",{children:[n.jsx("dt",{className:"font-semibold text-textMuted",children:""}),n.jsx("dd",{children:e.plaintiffName||""})]}),n.jsxs("div",{children:[n.jsx("dt",{className:"font-semibold text-textMuted",children:""}),n.jsx("dd",{children:e.insurerName||""})]}),n.jsxs("div",{children:[n.jsx("dt",{className:"font-semibold text-textMuted",children:"UMR /  "}),n.jsx("dd",{children:e.marketRef||""})]}),n.jsxs("div",{children:[n.jsx("dt",{className:"font-semibold text-textMuted",children:"Line Slip"}),n.jsx("dd",{children:e.lineSlipNo||""})]}),n.jsxs("div",{children:[n.jsx("dt",{className:"font-semibold text-textMuted",children:" "}),n.jsx("dd",{children:e.certificateRef||""})]}),n.jsxs("div",{children:[n.jsx("dt",{className:"font-semibold text-textMuted",children:"  "}),n.jsx("dd",{children:e.reportIds.length})]}),W&&n.jsxs("div",{children:[n.jsx("dt",{className:"font-semibold text-textMuted",children:" "}),n.jsx("dd",{className:"text-amber-700",children:""})]})]})]}),n.jsxs("div",{className:"rounded-2xl bg-panel p-4 shadow-sm border border-borderDark",children:[n.jsx("h2",{className:"mb-2 text-xs font-semibold uppercase tracking-wide text-textMuted",children:"  (RE)"}),n.jsx("textarea",{className:"w-full rounded-lg border border-borderDark p-2 text-xs text-textLight placeholder:text-textMuted focus:border-navy focus:outline-none focus:ring-1 focus:ring-navy",rows:4,value:p,onChange:h=>y(h.target.value),onBlur:b,placeholder:"Example: John Doe v. XYZ Medical Center - Claim Update"}),n.jsx("div",{className:"mt-3 flex justify-end",children:n.jsx("button",{type:"button",onClick:a,className:"inline-flex items-center rounded-full bg-navy px-4 py-1.5 text-[11px] font-semibold text-white shadow-sm hover:bg-blue-900 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-navy focus-visible:ring-offset-2",children:"    "})})]})]}),n.jsxs("section",{className:"mb-4 rounded-2xl bg-panel p-4 shadow-sm border border-borderDark",children:[n.jsxs("div",{className:"mb-3 flex items-center justify-between gap-3",children:[n.jsxs("div",{children:[n.jsx("h2",{className:"text-sm font-semibold text-textLight",children:"   "}),n.jsx("p",{className:"text-xs text-textMuted",children:"     SENT   ( )."})]}),n.jsxs("div",{className:"flex items-center gap-2",children:[E&&n.jsx("button",{type:"button",onClick:()=>o(E.id),className:"rounded-full bg-amber-50 px-3 py-1 text-[11px] font-semibold text-amber-800 border border-amber-200 hover:bg-amber-100",children:"     "}),!W&&n.jsx(n.Fragment,{children:l==="LAWYER"?!E&&n.jsx("button",{type:"button",onClick:a,className:"inline-flex items-center rounded-full bg-navy px-4 py-1.5 text-xs font-semibold text-white shadow-sm hover:bg-blue-900 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-navy focus-visible:ring-offset-2",children:"    "}):n.jsx("button",{type:"button",onClick:a,className:"inline-flex items-center rounded-full bg-navy px-4 py-1.5 text-xs font-semibold text-white shadow-sm hover:bg-blue-900 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-navy focus-visible:ring-offset-2",children:E?"   ()":"    "})})]})]}),n.jsx("div",{className:"overflow-x-auto",children:n.jsxs("table",{className:"min-w-full text-xs text-left text-textLight",children:[n.jsx("thead",{className:"bg-navySecondary text-[11px] uppercase tracking-wide text-textMuted",children:n.jsxs("tr",{children:[n.jsx("th",{className:"px-3 py-2",children:"' "}),n.jsx("th",{className:"px-3 py-2",children:""}),n.jsx("th",{className:"px-3 py-2",children:" "}),n.jsx("th",{className:"px-3 py-2",children:"  / "}),n.jsx("th",{className:"px-3 py-2",children:""})]})}),n.jsxs("tbody",{className:"divide-y divide-gray-100",children:[N.length===0&&n.jsx("tr",{children:n.jsx("td",{colSpan:4,className:"px-3 py-4 text-center text-textMuted",children:"No sent reports recorded for this case yet."})}),N.map(h=>{const S=h.sentAt?new Date(h.sentAt).toLocaleDateString("en-GB",{day:"2-digit",month:"short",year:"numeric"}):"",M=h.snapshot&&h.snapshot.reportSubject||"",H=h.fileName||M||"";return n.jsxs("tr",{children:[n.jsx("td",{className:"px-3 py-2",children:h.reportNo?`#${h.reportNo}`:""}),n.jsx("td",{className:"px-3 py-2",children:h.isResend?n.jsx("span",{className:"inline-flex items-center rounded-full bg-amber-50 px-2 py-0.5 text-[10px] font-semibold text-amber-800 border border-amber-200",children:" "}):n.jsx("span",{className:"inline-flex items-center rounded-full bg-navySecondary px-2 py-0.5 text-[10px] font-semibold text-textMuted border border-borderDark",children:" "})}),n.jsx("td",{className:"px-3 py-2",children:S}),n.jsx("td",{className:"px-3 py-2",children:H}),n.jsx("td",{className:"px-3 py-2",children:n.jsx("button",{type:"button",onClick:()=>o(h.reportId),className:"inline-flex items-center rounded-full bg-panel px-3 py-1 text-[11px] font-semibold text-navy ring-1 ring-navy hover:bg-blue-50 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-navy focus-visible:ring-offset-2","aria-label":` " ${h.reportId}`,children:""})})]},`${h.reportId}-${h.sentAt}`)})]})]})})]})]})})},Oh="lp_case_folders",Mh="lp_case_folders_migrated",nv=()=>{if(typeof window>"u")return{};try{const e=window.localStorage.getItem(Oh),t=e?JSON.parse(e):{};return!t||typeof t!="object"?{}:t}catch(e){return console.error("Failed to load case folders",e),{}}},Tn=e=>{if(!(typeof window>"u"))try{window.localStorage.setItem(Oh,JSON.stringify(e))}catch(t){console.error("Failed to persist case folders",t)}},sv=e=>{if(!e||typeof e!="object")return{};const t={};let s=!1;return Object.entries(e).forEach(([r,a])=>{const o=a.odakanitNo||r,l=we(o);if(!l){s=!0;return}const c=t[l];if(!c){t[l]={...a,odakanitNo:l},l!==r&&(s=!0);return}s=!0;const i=(b,w)=>{if(!b)return w;if(!w)return b;const R=new Date(b.updatedAt||b.createdAt||"").getTime()||0;return(new Date(w.updatedAt||w.createdAt||"").getTime()||0)>R?w:b};let u=c,p=a;(!c.closedAt&&a.closedAt||i(c,a)===a)&&(u=a,p=c);const y={...u,odakanitNo:l,reTemplate:u.reTemplate||p.reTemplate||"",insuredName:u.insuredName||p.insuredName||"",insurerName:u.insurerName||p.insurerName||"",plaintiffName:u.plaintiffName||p.plaintiffName||"",marketRef:u.marketRef||p.marketRef||"",lineSlipNo:u.lineSlipNo||p.lineSlipNo||"",certificateRef:u.certificateRef||p.certificateRef||"",createdAt:u.createdAt||p.createdAt,updatedAt:u.updatedAt||p.updatedAt,closedAt:u.closedAt||p.closedAt||null,closedByUserId:u.closedByUserId||p.closedByUserId||null,reportIds:Array.from(new Set([...u.reportIds||[],...p.reportIds||[]])),sentReports:[...u.sentReports||[],...p.sentReports||[]]};t[l]=y}),s?t:e},Od=(e,t,s)=>{if(!t.odakanitNo)return e;const r=we(t.odakanitNo);if(!r)return e;const a=s||new Date().toISOString(),o=e[r],l=o||{odakanitNo:r,reTemplate:"",insuredName:"",insurerName:"",plaintiffName:"",marketRef:"",lineSlipNo:"",certificateRef:"",createdAt:(o==null?void 0:o.createdAt)||a,updatedAt:(o==null?void 0:o.updatedAt)||a,reportIds:[],sentReports:(o==null?void 0:o.sentReports)||[]},c={...l,insuredName:t.insuredName||l.insuredName,insurerName:t.insurerName||l.insurerName,plaintiffName:t.plaintiffName||l.plaintiffName,marketRef:t.marketRef||l.marketRef,lineSlipNo:t.lineSlipNo||l.lineSlipNo,certificateRef:t.certificateRef||l.certificateRef,updatedAt:a,reportIds:l.reportIds.includes(t.id)?l.reportIds:[...l.reportIds,t.id],sentReports:l.sentReports},i=(t.reportSubject||"").trim();return i&&(!l.reTemplate||i!==l.reTemplate)&&(c.reTemplate=i),{...e,[r]:c}},Ph=(e,t,s,r,a)=>{var b;if(!t.odakanitNo)return e;const o=we(t.odakanitNo);if(!o)return e;const l=s||new Date().toISOString(),c=e[o];if(!c)return e;const i=typeof t.reportNumber=="number"&&t.reportNumber>0?t.reportNumber:(((b=t.reportHistory)==null?void 0:b.length)||0)+1,u={id:t.id,odakanitNo:t.odakanitNo,insuredName:t.insuredName,plaintiffName:t.plaintiffName,insurerName:t.insurerName,marketRef:t.marketRef,lineSlipNo:t.lineSlipNo,certificateRef:t.certificateRef,reportDate:t.reportDate,status:"SENT",reportSubject:t.reportSubject},p={reportId:t.id,sentAt:l,reportNo:i,fileName:r,snapshot:u,isResend:!!a,resendIndex:i},y={...c,updatedAt:l,sentReports:[...c.sentReports,p]};return{...e,[o]:y}},Oc=(e,t)=>{let s={...e};return t.forEach(r=>{if(r.odakanitNo&&(s=Od(s,r,r.updatedAt||r.reportDate),r.status==="SENT")){const a=r.sentAt||r.reportDate||new Date().toISOString();s=Ph(s,r,a)}}),s},rv=()=>{if(!(typeof window>"u"))try{window.localStorage.setItem(Mh,"1")}catch{}},av=()=>{if(typeof window>"u")return!0;try{return window.localStorage.getItem(Mh)==="1"}catch{return!0}},ov=(e,t)=>{const s=e.split(/\s+/).filter(Boolean),r=t.split(/\s+/).filter(Boolean),a=s.length,o=r.length;if(!a&&!o)return[];const l=Array.from({length:a+1},()=>Array(o+1).fill(0));for(let p=a-1;p>=0;p-=1)for(let y=o-1;y>=0;y-=1)s[p]===r[y]?l[p][y]=l[p+1][y+1]+1:l[p][y]=Math.max(l[p+1][y],l[p][y+1]);const c=[];let i=0,u=0;for(;i<a&&u<o;)s[i]===r[u]?(c.push({type:"same",text:s[i]}),i+=1,u+=1):l[i+1][u]>=l[i][u+1]?(c.push({type:"remove",text:s[i]}),i+=1):(c.push({type:"add",text:r[u]}),u+=1);for(;i<a;)c.push({type:"remove",text:s[i]}),i+=1;for(;u<o;)c.push({type:"add",text:r[u]}),u+=1;return c},lv=e=>e==="STEP2"?2:e==="PREVIEW"?3:1,iv=e=>{switch(e){case"STEP1":return"Setup";case"STEP2":return"Draft";case"PREVIEW":return"Preview";case"CASE_FOLDER":return"Case Folder";default:return"Dashboard"}},cv=e=>e?e.role:"Guest",dv=e=>e===1?[{intent:"explain_current_screen",label:"   ?"},{intent:"explain_buttons_in_step",label:"    "},{intent:"common_mistakes_here",label:"   1"}]:e===2?[{intent:"explain_current_screen",label:"    2"},{intent:"when_to_use_ai_tools",label:"   -AI "},{intent:"explain_hebrew_rewrite",label:"    "},{intent:"explain_tone_risk",label:"  Tone & Risk"},{intent:"common_mistakes_here",label:"   2"}]:[{intent:"pre_send_checks",label:"    "},{intent:"explain_tone_risk",label:"   Tone & Risk?"},{intent:"common_mistakes_here",label:"   "}],uv=({isOpen:e,onClose:t,view:s,currentUser:r,currentReport:a,loading:o,error:l,response:c,onRunIntent:i})=>{if(!e)return null;const u=lv(s),p=iv(s),y=cv(r),b=dv(u),w=!!a;return n.jsxs(n.Fragment,{children:[n.jsx("div",{className:"fixed inset-0 bg-black/10 z-[180]",onClick:t}),n.jsxs("div",{className:"fixed inset-y-0 right-0 z-[190] w-full max-w-md bg-panel border-l border-borderDark200 shadow-2xl flex flex-col",children:[n.jsxs("div",{className:"px-4 py-3 border-b border-borderDark200 flex items-center justify-between bg-navySecondary",children:[n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsx("div",{className:"h-8 w-8 rounded-full bg-indigo-600 flex items-center justify-center text-white",children:n.jsx(oa,{className:"w-4 h-4"})}),n.jsxs("div",{className:"flex flex-col",children:[n.jsx("span",{className:"text-sm font-semibold text-textLight",children:" "}),n.jsxs("span",{className:"text-[11px] text-textMuted",children:["Step ",u,"  ",p,"  ",y]})]})]}),n.jsx("button",{type:"button",onClick:t,className:"p-1 rounded hover:bg-navySecondary text-textMuted",children:n.jsx(Ft,{className:"w-4 h-4"})})]}),n.jsxs("div",{className:"px-4 py-3 border-b border-borderDark bg-panel",children:[n.jsxs("div",{className:"flex items-center justify-between mb-2",children:[n.jsx("span",{className:"text-[11px] font-semibold text-textMuted600",children:"   "}),!w&&n.jsx("span",{className:"text-[10px] text-textMuted",children:'     ".'})]}),n.jsx("div",{className:"flex flex-wrap gap-2",children:b.map(R=>n.jsx("button",{type:"button",disabled:o||!w,onClick:()=>i(R.intent),className:`text-[11px] px-3 py-1.5 rounded-full border transition ${o||!w?"border-borderDark200 text-textMuted bg-navySecondary cursor-not-allowed":"border-indigo-200 text-indigo-800 bg-indigo-50 hover:bg-indigo-100"}`,children:R.label},R.intent))})]}),n.jsxs("div",{className:"flex-1 overflow-auto px-4 py-3 space-y-3",dir:"rtl",children:[o&&n.jsxs("div",{className:"flex items-center gap-2 text-[12px] text-textMuted600",children:[n.jsx(Mt,{className:"w-4 h-4 animate-spin"}),n.jsx("span",{children:"      "})]}),!o&&l&&n.jsxs("div",{className:"rounded-md border border-red-200 bg-red-50 px-3 py-2 text-[12px] text-red-800",children:[n.jsx("div",{className:"font-semibold mb-1",children:"    "}),n.jsx("div",{children:"      .   ,   ."})]}),!o&&!l&&c&&n.jsxs("div",{className:"space-y-2",children:[n.jsx("div",{className:"text-sm font-semibold text-textLight",children:c.title}),n.jsx("ul",{className:"list-disc pr-4 space-y-1 text-[12px] text-textLight",children:c.bullets.map((R,E)=>n.jsx("li",{children:R},E))}),c.warning&&n.jsxs("div",{className:"mt-2 rounded-md border border-amber-200 bg-amber-50 px-3 py-2 text-[11px] text-amber-900",children:[n.jsx("span",{className:"font-semibold",children:" : "}),c.warning]}),c.nextSuggestion&&n.jsxs("div",{className:"mt-1 text-[11px] text-textMuted600",children:[n.jsx("span",{className:"font-semibold",children:" : "}),c.nextSuggestion]})]}),!o&&!l&&!c&&n.jsxs("div",{className:"text-[12px] text-textMuted space-y-1",children:[n.jsx("div",{children:'         ,    " .'}),n.jsx("div",{children:"         ."})]})]}),n.jsxs("div",{className:"px-4 py-3 border-t border-borderDark bg-navySecondary",children:[n.jsx("div",{className:"text-[10px] text-textMuted mb-1",children:"   '        ."}),n.jsx("input",{type:"text",disabled:!0,className:"w-full text-[11px] px-2 py-1.5 rounded border border-dashed border-borderDark200 bg-navySecondary text-textMuted",placeholder:"          ."})]})]})]})},Lp=24*60*60*1e3;function gt(e,t,s=new Date){const r={isLocked:!1,lockType:"NONE",lockAt:null,autoLockAt:null,remainingDays:null,reasonSummary:null},a=s.getTime();if(t!=null&&t.closedAt){const o=t.closedAt;return{...r,isLocked:!0,lockType:"MANUAL",lockAt:o,autoLockAt:null,remainingDays:null,reasonSummary:"      ."}}if(e.manualLockedAt)return{...r,isLocked:!0,lockType:"MANUAL",lockAt:e.manualLockedAt,autoLockAt:null,remainingDays:null,reasonSummary:e.manualLockReason?` : ${e.manualLockReason}`:"   ."};if(e.firstSentAt){const l=new Date(e.firstSentAt).getTime();if(!Number.isFinite(l))return r;const i=35+((e.lockExtensions||[]).reduce((E,W)=>{const N=typeof W.days=="number"&&!Number.isNaN(W.days)?W.days:0;return E+N},0)||0),u=l+i*Lp,p=new Date(u),y=p.toISOString();if(a>=u)return{...r,isLocked:!0,lockType:"AUTO",lockAt:y,autoLockAt:y,remainingDays:null,reasonSummary:"    35    ."};const w=(u-a)/Lp,R=w>0?Math.ceil(w):0;return{...r,isLocked:!1,lockType:"NONE",lockAt:null,autoLockAt:y,remainingDays:R,reasonSummary:`    -${R}  (-${p.toLocaleDateString("he-IL")}).`}}return r}const _p=new Map,mv=60*1e3;function ml(e){const t=`${e.reason}::${e.reportId??"unknown"}`,s=Date.now(),r=_p.get(t)??0;s-r<mv||(_p.set(t,s),console.info("[blocked-edit]",e))}const pv="personal_snippets",Fh=e=>`${pv}:${e}`,fv=(e,t)=>{if(!e)return[];try{const s=JSON.parse(e);if(!Array.isArray(s))return[];const r=new Date().toISOString();return s.map((a,o)=>{const l=a||{},c=typeof l.id=="string"&&l.id?l.id:`ps-${Date.now()}-${o}-${Math.random().toString(36).slice(2,6)}`,i=typeof l.title=="string"&&l.title.trim()?l.title:"Untitled snippet",u=typeof l.body=="string"?l.body:"",p=typeof l.createdAt=="string"&&l.createdAt?l.createdAt:r,y=typeof l.updatedAt=="string"&&l.updatedAt?l.updatedAt:p,b=typeof l.createdByUserId=="string"&&l.createdByUserId?l.createdByUserId:t,w=typeof l.usageCount=="number"&&Number.isFinite(l.usageCount)&&l.usageCount>=0?l.usageCount:0,R=typeof l.lastUsedAt=="string"&&l.lastUsedAt.trim()?l.lastUsedAt:null,E=typeof l.sectionKey=="string"&&l.sectionKey?l.sectionKey:void 0,W=Array.isArray(l.tags)?l.tags.filter(h=>typeof h=="string"&&h.trim()).map(h=>h.trim()):void 0;return{id:c,title:i,body:u,sectionKey:E,tags:W,createdByUserId:b,createdAt:p,updatedAt:y,usageCount:w,lastUsedAt:R}})}catch{return[]}},jo=e=>{if(typeof window>"u")return[];if(!e)return[];const t=window.localStorage.getItem(Fh(e));return fv(t,e)},Yu=(e,t)=>{if(!(typeof window>"u")&&e)try{window.localStorage.setItem(Fh(e),JSON.stringify(t))}catch{}},xv=(e,t)=>{const s=new Date().toISOString(),r=jo(e);let a;if(t.id)a=r.map(o=>o.id===t.id?{...o,title:t.title,body:t.body,sectionKey:t.sectionKey,tags:t.tags,updatedAt:s}:o);else{const l={id:`ps-${Date.now()}-${Math.random().toString(36).slice(2,8)}`,title:t.title,body:t.body,sectionKey:t.sectionKey,tags:t.tags,createdByUserId:e,createdAt:s,updatedAt:s,usageCount:0,lastUsedAt:null};a=[...r,l]}return Yu(e,a),a},Op=(e,t)=>{const r=jo(e).filter(a=>a.id!==t);return Yu(e,r),r},hv=(e,t)=>{const s=jo(e),r=new Date().toISOString(),a=s.map(o=>o.id===t?{...o,usageCount:(o.usageCount||0)+1,lastUsedAt:r}:o);return Yu(e,a),a},Mp="           (OCR). /     /  .",Cr="     .       .",gv={title:"Final Preview",toggleHide:"Hide Preview",toggleShow:"Show Preview",downloadPdf:"Download PDF",editFileNames:"Edit file name titles",finalize:"Finalize & Close",backToEditing:"Back to Editing",backToStep2:"Back to Step 2",backToDashboard:"Back to dashboard",helperScroll:"Scroll to review entire document",collapsedHint:'Click "Show Preview" to review the document before sending.'},yv={title:" ",toggleHide:" ",toggleShow:" ",downloadPdf:" PDF",editFileNames:"  ",finalize:" ",backToEditing:" ",backToStep2:"  2",backToDashboard:"  ",helperScroll:"    ",collapsedHint:'  " "     .'},Nv=e=>e==="LAWYER"?yv:gv,Pp={SOC:["   ___________     ____________ ____________   ,   ____________________.","","        ____________________.","","      ,       ________________________."].join(`
`),LOD:["   ___________      .","","        ____________________.","",",    Claimant    ,      ______________________."].join(`
`)},bv=({message:e,type:t,onClose:s})=>{const r="fixed top-4 right-4 z-[100] p-4 rounded-lg shadow-xl border-l-4 flex items-center gap-3 animate-slide-in bg-panel border-borderDark text-textLight",a=t==="success"?"border-l-gold text-goldLight":t==="error"?"border-l-danger text-red-300":t==="warning"?"border-l-gold text-goldLight":"border-l-gold text-textLight";return n.jsxs("div",{className:`${r} ${a}`,children:[n.jsx("span",{children:e}),n.jsx("button",{onClick:s,className:"hover:bg-navySecondary p-1 rounded text-textMuted",children:n.jsx(Ft,{className:"w-4 h-4"})})]})},vv=({onSubmit:e,onCancel:t,initialTitle:s})=>{const[r,a]=g.useState(s||""),[o,l]=g.useState("BEST_PRACTICE"),[c,i]=g.useState(""),[u,p]=g.useState("INSERTABLE"),y=b=>{b.preventDefault();const w=r.trim();if(!w)return;const R=c.split(",").map(E=>E.trim()).filter(Boolean);e({title:w,label:o,tags:R,behavior:u})};return n.jsxs("form",{onSubmit:y,className:"px-4 py-3 space-y-3 text-xs",children:[n.jsxs("div",{className:"space-y-1",children:[n.jsx("label",{className:"block font-semibold text-textLight",children:"Title"}),n.jsx("input",{type:"text",className:"w-full border border-borderDark rounded px-2 py-1 text-xs",value:r,onChange:b=>a(b.target.value),required:!0})]}),n.jsxs("div",{className:"space-y-1",children:[n.jsx("label",{className:"block font-semibold text-textLight",children:"Label / Type"}),n.jsxs("select",{className:"w-full border border-borderDark rounded px-2 py-1 text-xs",value:o,onChange:b=>l(b.target.value==="LLOYDS_RECOMMENDED"?"LLOYDS_RECOMMENDED":"BEST_PRACTICE"),children:[n.jsx("option",{value:"BEST_PRACTICE",children:"Best practice"}),n.jsx("option",{value:"LLOYDS_RECOMMENDED",children:"Lloyds recommended"})]})]}),n.jsxs("div",{className:"space-y-1",children:[n.jsx("label",{className:"block font-semibold text-textLight",children:"Tags (optional)"}),n.jsx("input",{type:"text",className:"w-full border border-borderDark rounded px-2 py-1 text-xs",placeholder:"e.g. lloyds, settlement, high exposure",value:c,onChange:b=>i(b.target.value)})]}),n.jsxs("div",{className:"space-y-1",children:[n.jsx("label",{className:"block font-semibold text-textLight",children:"Behavior"}),n.jsxs("div",{className:"flex items-center gap-3",children:[n.jsxs("label",{className:"flex items-center gap-1",children:[n.jsx("input",{type:"radio",name:"bp-behavior",checked:u==="INSERTABLE",onChange:()=>p("INSERTABLE")}),n.jsx("span",{children:"Insertable (insert into body)"})]}),n.jsxs("label",{className:"flex items-center gap-1",children:[n.jsx("input",{type:"radio",name:"bp-behavior",checked:u==="COPY_ONLY",onChange:()=>p("COPY_ONLY")}),n.jsx("span",{children:"Copy only"})]})]})]}),n.jsxs("div",{className:"flex items-center justify-end gap-2 pt-2 border-t border-borderDark mt-2",children:[n.jsx("button",{type:"button",onClick:t,className:"px-3 py-1.5 rounded border border-borderDark text-[11px] text-textLight hover:bg-slate-100",children:""}),n.jsx("button",{type:"submit",className:"px-3 py-1.5 rounded bg-emerald-600 text-white text-[11px] hover:bg-emerald-700",children:" Best Practice"})]})]})},Fp=({value:e,onChange:t,placeholder:s,disabled:r,readOnly:a,dir:o="ltr",className:l,style:c={},textareaRef:i})=>{const u=g.useRef(null),p=i||u;return g.useEffect(()=>{const y=p&&"current"in p?p.current:u.current;y&&(y.style.height="auto",y.style.height=y.scrollHeight+"px")},[e,p]),n.jsx(ho,{clientId:vo,children:n.jsx("textarea",{ref:p,className:l,dir:o,value:e,onChange:a?void 0:t,placeholder:s,disabled:r||a,rows:3,style:{...c,overflow:"hidden",resize:"none"}})})},Sv=({onClose:e})=>{const[t,s]=g.useState("MANUAL"),[r,a]=g.useState(""),[o,l]=g.useState([]),[c,i]=g.useState(!1),u=async()=>{if(!r.trim())return;i(!0);const p=await Q0(r);l(y=>[...y,{q:r,a:p}]),a(""),i(!1)};return n.jsx("div",{className:"fixed inset-0 bg-black/50 z-[200] flex items-center justify-center p-4",children:n.jsxs("div",{className:"bg-panel w-full max-w-3xl h-[600px] rounded-xl shadow-2xl flex flex-col overflow-hidden animate-scale-in",children:[n.jsxs("div",{className:"bg-navy p-4 text-gold flex justify-between items-center",children:[n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsx(Cu,{className:"w-6 h-6"}),n.jsx("h2",{className:"font-bold text-lg",children:"  "})]}),n.jsx("button",{onClick:e,className:"hover:bg-panel/20 rounded p-1",children:n.jsx(Ft,{className:"w-5 h-5"})})]}),n.jsxs("div",{className:"flex border-b",children:[n.jsx("button",{onClick:()=>s("MANUAL"),className:`flex-1 p-3 font-bold ${t==="MANUAL"?"text-lpBlue border-b-2 border-lpBlue":"text-textMuted"}`,children:" "}),n.jsx("button",{onClick:()=>s("CHAT"),className:`flex-1 p-3 font-bold ${t==="CHAT"?"text-lpBlue border-b-2 border-lpBlue":"text-textMuted"}`,children:"   "})]}),n.jsx("div",{className:"flex-1 overflow-auto p-6 bg-navySecondary",dir:"rtl",children:t==="MANUAL"?n.jsxs("div",{className:"space-y-4",children:[n.jsxs("details",{className:"bg-panel p-4 rounded shadow-sm group",children:[n.jsxs("summary",{className:"font-bold text-textLight cursor-pointer list-none flex justify-between",children:["   ",n.jsx(os,{className:"group-open:rotate-90 transition"})]}),n.jsxs("div",{className:"mt-2 text-textMuted text-sm space-y-1",children:[n.jsx("p",{children:"1.       (CRM / Finance /    )."}),n.jsx("p",{children:"2.       +  Notifications   ."}),n.jsx("p",{children:`3.  ""     ' .`})]})]}),n.jsxs("details",{className:"bg-panel p-4 rounded shadow-sm group",children:[n.jsxs("summary",{className:"font-bold text-textLight cursor-pointer list-none flex justify-between",children:['    " ',n.jsx(os,{className:"group-open:rotate-90 transition"})]}),n.jsxs("div",{className:"mt-2 text-textMuted text-sm space-y-1",children:[n.jsxs("p",{children:["1.   ",n.jsx("strong",{children:"Open New Case Folder"}),",      ."]}),n.jsx("p",{children:"2.  ,   4  (Word/PDF)    ."}),n.jsx("p",{children:"3.   FINANCE FINALIZE     ."})]})]}),n.jsxs("details",{className:"bg-panel p-4 rounded shadow-sm group",children:[n.jsxs("summary",{className:"font-bold text-textLight cursor-pointer list-none flex justify-between",children:["   ",n.jsx(os,{className:"group-open:rotate-90 transition"})]}),n.jsxs("div",{className:"mt-2 text-textMuted text-sm space-y-1",children:[n.jsx("p",{children:'   View Worksheet  , ,   " .'}),n.jsx("p",{children:" /     ( ADD),    ."}),n.jsx("p",{children:'  ,      "     Expenses.'})]})]}),n.jsxs("details",{className:"bg-panel p-4 rounded shadow-sm group",children:[n.jsxs("summary",{className:"font-bold text-textLight cursor-pointer list-none flex justify-between",children:["    ",n.jsx(os,{className:"group-open:rotate-90 transition"})]}),n.jsxs("div",{className:"mt-2 text-textMuted text-sm space-y-1",children:[n.jsx("p",{children:"  Manage Favorite Providers     ."}),n.jsx("p",{children:"        ."}),n.jsx("p",{children:'    4   (PDF/Word)  "    .'})]})]}),n.jsxs("details",{className:"bg-panel p-4 rounded shadow-sm group",children:[n.jsxs("summary",{className:"font-bold text-textLight cursor-pointer list-none flex justify-between",children:[' "     ',n.jsx(os,{className:"group-open:rotate-90 transition"})]}),n.jsxs("div",{className:"mt-2 text-textMuted text-sm space-y-1",children:[n.jsx("p",{children:"       -FINANCE   FINALIZE."}),n.jsx("p",{children:' FINALIZE  "     (READY TO SEND)   .'}),n.jsx("p",{children:"     (48   , 30   )     ."})]})]})]}):n.jsxs("div",{className:"flex flex-col h-full",children:[n.jsxs("div",{className:"flex-1 space-y-4 mb-4 overflow-auto",children:[o.length===0&&n.jsx("div",{className:"text-center text-gray-400 mt-10",children:"     !"}),o.map((p,y)=>n.jsxs("div",{className:"space-y-1",children:[n.jsx("div",{className:"bg-blue-100 text-blue-900 p-2 rounded-lg rounded-tr-none self-end w-fit ml-auto max-w-[80%]",children:p.q}),n.jsx("div",{className:"bg-panel border text-textLight p-2 rounded-lg rounded-tl-none self-start w-fit mr-auto max-w-[80%]",children:p.a})]},y))]}),n.jsxs("div",{className:"flex gap-2",dir:"ltr",children:[n.jsx("input",{className:"flex-1 border p-2 rounded",placeholder:"/   ...",value:r,onChange:p=>a(p.target.value),onKeyDown:p=>p.key==="Enter"&&u()}),n.jsx("button",{onClick:u,disabled:c,className:"bg-navy text-gold px-4 rounded hover:bg-navySecondary",children:c?n.jsx(Mt,{className:"w-5 h-5 animate-spin"}):n.jsx(Ql,{className:"w-5 h-5"})})]})]})})]})})},wv=({reports:e,currentUser:t,onMarkPaid:s})=>{const r=e.filter(l=>l.expensesSum&&!l.isPaid),a=r.reduce((l,c)=>{var u;const i=parseFloat(((u=c.expensesSum)==null?void 0:u.replace(/,/g,""))||"0");return l+(isNaN(i)?0:i)},0),o=t.role==="SUB_ADMIN";return r.length?n.jsxs("div",{className:"mb-8 bg-panel rounded-xl shadow-sm border border-indigo-100 overflow-hidden",children:[n.jsxs("div",{className:"bg-gradient-to-r from-indigo-600 to-indigo-800 p-4 text-white flex justify-between items-center",children:[n.jsxs("h3",{className:"font-bold text-lg flex items-center",children:[n.jsx(k0,{className:"w-6 h-6 mr-2"})," Financial Control - Outstanding Expenses"]}),n.jsxs("div",{className:"text-xl font-bold bg-panel/20 px-4 py-1 rounded",children:["Total: ",a.toLocaleString()]})]}),n.jsx("div",{className:"overflow-x-auto",children:n.jsxs("table",{className:"w-full text-left text-sm",children:[n.jsx("thead",{className:"bg-indigo-50 text-indigo-800",children:n.jsxs("tr",{children:[n.jsx("th",{className:"p-3",children:"Report Date"}),n.jsx("th",{className:"p-3",children:"Insured / File"}),n.jsx("th",{className:"p-3",children:"Amount Requested"}),n.jsx("th",{className:"p-3",children:"Action"})]})}),n.jsx("tbody",{className:"divide-y divide-gray-100",children:r.map(l=>n.jsxs("tr",{className:"hover:bg-navySecondary",children:[n.jsx("td",{className:"p-3",children:new Date(l.reportDate).toLocaleDateString()}),n.jsxs("td",{className:"p-3 font-medium",children:[l.insuredName," (",l.marketRef,")"]}),n.jsxs("td",{className:"p-3 font-bold text-indigo-700",children:["",l.expensesSum]}),n.jsx("td",{className:"p-3",children:o?n.jsx("button",{onClick:()=>s(l.id),className:"text-red-400 hover:text-red-600 hover:bg-red-50 p-1.5 rounded transition",title:"Mark as Paid",children:n.jsx(Bs,{className:"w-4 h-4"})}):n.jsx("span",{className:"text-gray-400 cursor-not-allowed",children:n.jsx(Bs,{className:"w-4 h-4"})})})]},l.id))})]})})]}):null};new URL("/assets/statement%20of%20claim-BbEIHM0L.jpg",import.meta.url).href,new URL("/assets/statement%20of%20defence-BIigMwUC.jpg",import.meta.url).href,new URL("/assets/preliminary%20proceedings-BoY9iCcP.jpg",import.meta.url).href,new URL("/assets/evidence%20submission-CZIKo1E1.jpg",import.meta.url).href,new URL("/assets/evidentiary%20hearing-BibkA_Ru.jpg",import.meta.url).href,new URL("/assets/summaries-BEUvavav.jpg",import.meta.url).href,new URL("/assets/judgment-cIMuyU1R.jpg",import.meta.url).href;const jv=[{value:"LETTER_OF_DEMAND",label:"Letter of Demand"},{value:"FIRST_INSTANCE",label:"First Instance Proceedings"},{value:"APPEAL",label:"Appeal Proceedings"}],Oa={LETTER_OF_DEMAND:[{id:"LOD_ISSUED",label:"Letter of Demand Issued"},{id:"LOD_INTERNAL_REVIEW",label:"Internal Review & Coverage Assessment"},{id:"LOD_RESPONSE",label:"Response to Letter of Demand"},{id:"LOD_PRE_LITIGATION",label:"Pre-Litigation Negotiations"},{id:"LOD_OUTCOME_ESCALATION",label:"Outcome / Escalation Decision"},{id:"LOD_CLAIM_SETTLED",label:"Claim Settled"},{id:"LOD_DEMAND_REJECTED",label:"Demand Rejected"}],FIRST_INSTANCE:[{id:"FI_STATEMENT_OF_CLAIM",label:"Statement of Claim Filed"},{id:"FI_STATEMENT_OF_DEFENCE",label:"Statement of Defence Filed"},{id:"FI_DISCOVERY_DISCLOSURE",label:"Discovery & Disclosure"},{id:"FI_COURT_APPOINTED_EXPERT",label:"Court-Appointed Expert",isDynamic:!0},{id:"FI_RD_DOCS_DAMAGE_SUBMISSIONS",label:"R & D Docs  Damage Assessment Submissions",isDynamic:!0},{id:"FI_EVIDENTIARY_HEARINGS",label:"Evidentiary Hearings"},{id:"FI_SUMMATIONS",label:"Summations"},{id:"FI_JUDGMENT",label:"Judgment"}],APPEAL:[{id:"AP_DECISION_TO_APPEAL",label:"Decision to Appeal"},{id:"AP_NOTICE_OF_APPEAL",label:"Notice of Appeal Filed"},{id:"AP_RESPONSE_TO_APPEAL",label:"Response to Appeal"},{id:"AP_APPEAL_HEARINGS",label:"Appeal Hearings"},{id:"AP_APPEAL_JUDGMENT",label:"Appeal Judgment"}]},is=[{value:"EXPERT_OUR",label:"Expert fees on our behalf",type:"EXPENSE"},{value:"EXPERT_COURT",label:"Expert fees on behalf of the court",type:"EXPENSE"},{value:"INVESTIGATION",label:"Private Investigation fees",type:"EXPENSE"},{value:"SECONDARY_FEE",label:"Payment of secondary procedure fee",type:"EXPENSE"},{value:"COURT_FEES",label:"Court fees",type:"EXPENSE"},{value:"PHOTOCOPY",label:"Photocopying and binding of documents",type:"EXPENSE"},{value:"MEDICAL_RECORDS",label:"Medical Records Collection",type:"EXPENSE"},{value:"ATTORNEY_PHASE_1",label:"Attorney fees for phase 1",type:"EXPENSE"},{value:"ATTORNEY_PHASE_2",label:"Attorney fees for phase 2",type:"EXPENSE"},{value:"ATTORNEY_PHASE_3",label:"Attorney fees for phase 3",type:"EXPENSE"},{value:"ATTORNEY_PHASE_4",label:"Attorney fees for phase 4",type:"EXPENSE"},{value:"ATTORNEY_PHASE_5",label:"Attorney fees for phase 5",type:"EXPENSE"},{value:"ATTORNEY_EXTRA_HEARING",label:"Attorney fees for extra court hearing",type:"EXPENSE"},{value:"ATTORNEY_THIRD_PARTY",label:"Attorney fees for third party notice",type:"EXPENSE"},{value:"OTHER",label:"Other",type:"EXPENSE"},{value:"COMPENSATION_JUDGMENT",label:"Compensation by Judgment",type:"ADJUSTMENT"},{value:"COMPENSATION_SETTLEMENT",label:"Compensation under Settlement",type:"ADJUSTMENT"},{value:"DEDUCTIBLE",label:"Deductible paid by the insured",type:"ADJUSTMENT"},{value:"PAID_BY_INSURER",label:"Expenses already paid by the insurer",type:"ADJUSTMENT"}],Ms=()=>({status:"DRAFT",rows:[],history:[],notes:[],favorites:[],totals:{totalExpenses:0,totalAdjustments:0,totalBalance:0}}),Ev=1e3*60*60*48,Bh=1e3*60*60*24*30,$h=7*24*60*60*1e3,Bp={lineSlip:"UNIQUE MARKET REF",certificate:"CERTIFICATE REF"},pt={REPORTS:"lp_reports",USER:"lp_current_user",VIEW:"lp_view",CURRENT_REPORT:"lp_current_report",CASE_FOLDERS:"lp_case_folders",NOTIFICATIONS:"lp_notifications"},kv="financial_expenses_store_v1",Av=(e,t,s)=>{if(!(typeof window>"u"))try{const r=[...e];if(t){const i=r.findIndex(p=>p.id===t.id),u=i>=0?{...r[i],...t}:t;i>=0?r[i]=u:r.push(u)}const a={version:1,exportedAt:new Date().toISOString(),reports:r,caseFolders:s,notifications:(()=>{try{const i=localStorage.getItem(pt.NOTIFICATIONS);return i?JSON.parse(i):[]}catch{return[]}})(),financialStore:(()=>{try{const i=localStorage.getItem(kv);return i?JSON.parse(i):{}}catch{return{}}})(),caseTemplates:(()=>{try{const i=localStorage.getItem("caseTemplates");return i?JSON.parse(i):[]}catch{return[]}})(),favoriteProviders:(()=>{try{const i=localStorage.getItem("favoriteProviders");return i?JSON.parse(i):{}}catch{return{}}})()},o=new Blob([JSON.stringify(a,null,2)],{type:"application/json"}),l=URL.createObjectURL(o),c=document.createElement("a");c.href=l,c.download=`report-crm-backup-${new Date().toISOString().slice(0,10)}.json`,c.click(),URL.revokeObjectURL(l)}catch(r){console.error("Backup download failed",r)}},Xa="Expenses breakdown",Qr=e=>e?e===Xa?!0:/\bexpenses\b/i.test(e):!1,Iv=()=>{},$p=(e,t,s)=>{if(!e)return e;let r=!1;const a={...e};if(a.content&&t.forEach(o=>{var c;const l=(c=a.content)==null?void 0:c[o];l!==void 0&&(a.content={...a.content},!a.content[s]&&l&&(a.content[s]=l),delete a.content[o],r=!0)}),a.translatedContent&&t.forEach(o=>{var c;const l=(c=a.translatedContent)==null?void 0:c[o];l!==void 0&&(a.translatedContent={...a.translatedContent},!a.translatedContent[s]&&l&&(a.translatedContent[s]=l),delete a.translatedContent[o],r=!0)}),Array.isArray(a.selectedSections)&&a.selectedSections.some(l=>t.includes(l))){const l=a.selectedSections.map(c=>t.includes(c)?s:c);a.selectedSections=Array.from(new Set(l)),r=!0}return a.expertSummaryMode&&t.forEach(o=>{var c;const l=(c=a.expertSummaryMode)==null?void 0:c[o];l&&(a.expertSummaryMode={...a.expertSummaryMode,[s]:l},delete a.expertSummaryMode[o],r=!0)}),r?a:e},Tv=e=>{let t=$p(e,mh,Us);return t=$p(t,ph,Ro),t},Rv=e=>{const t={...e};return t.reportReview||(t.reportReview={status:"DRAFT",issues:[]}),t.hebrewWorkflowStatus||(t.hebrewWorkflowStatus="HEBREW_DRAFT"),Array.isArray(t.reportReview.issues)&&t.reportReview.issues.length>0&&(t.reportReview={...t.reportReview,issues:t.reportReview.issues.map(s=>{const r=s.origin??"INTERNAL";let a=s.externalAction;return r==="EXTERNAL"&&!a&&(a="ENGLISH_ONLY"),{...s,origin:r,externalAction:a}})}),t},Cv=()=>{if(typeof window>"u")return[];try{Iv();const e=localStorage.getItem(pt.REPORTS);return(e?JSON.parse(e):[]).map(Tv).map(Rv)}catch(e){return console.error("Failed to load stored reports",e),[]}},Dv=()=>{if(typeof window>"u")return"DASHBOARD";const e=localStorage.getItem(pt.VIEW);return e&&(e==="STEP1"||e==="STEP2"||e==="PREVIEW"||e==="DASHBOARD"||e==="CASE_FOLDER")?e:"DASHBOARD"},ai=e=>{const t=e.filter(r=>r.type==="EXPENSE").reduce((r,a)=>r+(a.amount||0),0),s=e.filter(r=>r.type==="ADJUSTMENT").reduce((r,a)=>r+(a.amount||0),0);return{totalExpenses:t,totalAdjustments:s,totalBalance:t-s}},Hp=e=>{var t,s;if((t=e.expenseWorksheet)!=null&&t.totals)return e.expenseWorksheet.totals.totalBalance;if(e.expensesSum){const r=parseFloat(e.expensesSum.replace(/,/g,""));if(!isNaN(r))return r}return(s=e.expensesItems)!=null&&s.length?e.expensesItems.reduce((r,a)=>r+(a.amount||0),0):0},Up=e=>{var t,s,r;return(((s=(t=e.expenseWorksheet)==null?void 0:t.rows)==null?void 0:s.length)??0)>0||(((r=e.expensesItems)==null?void 0:r.length)??0)>0||!!(e.expensesSum&&e.expensesSum!=="0")},Rn=()=>Math.random().toString(36).slice(2,10),Dr=e=>e==null?e:JSON.parse(JSON.stringify(e)),Wp=e=>new Promise((t,s)=>{const r=new FileReader;r.onloadend=()=>{const a=r.result,o=a.includes(",")?a.split(",")[1]:a;t(o)},r.onerror=()=>s(new Error("Failed to convert blob")),r.readAsDataURL(e)}),oi=e=>e?e.replace(/\r\n/g,`
`).replace(/\t/g," ").split(`
`).map(r=>r.replace(/\s+$/g,"").replace(/ {2,}/g," ")).join(`
`).trim().replace(/\n{3,}/g,`

`):"",Hh=e=>{if(!e)return e;let t=e;const s=[{pattern:/\bprosecutor\b/gi,replacement:"plaintiff"},{pattern:/\ba specialist\b/gi,replacement:"an expert"},{pattern:/\bthe specialist\b/gi,replacement:"the expert"},{pattern:/\bProf\.(?=\s|$)/gi,replacement:"prof"},{pattern:/\bNational Insurance Institute\b/gi,replacement:"NII"},{pattern:/\boperation\b/gi,replacement:"surgery"},{pattern:/\bdamage calculations\b/gi,replacement:"R & D Docs"},{pattern:/\bdemander\b/gi,replacement:"claimant"},{pattern:/\bapplicant\b/gi,replacement:"claimant"},{pattern:/\bbranch\b/gi,replacement:"clinic"},{pattern:/\bverdict\b/gi,replacement:"judgment"},{pattern:/\binterrogation\b/gi,replacement:"cross-examination"},{pattern:/\bDr\.(?=\s|$)/gi,replacement:"Dr"},{pattern:/\bversion\b/gi,replacement:"position"},{pattern:/\bpolicyholder\b/gi,replacement:"insured"}];for(const{pattern:r,replacement:a}of s)t=t.replace(r,a);return t=t.replace(/\bopinion\b/gi,(r,a,o)=>{const l=Math.max(0,a-20),c=o.slice(l,a).toLowerCase();return/\bexpert\s*$/.test(c)?r:"expert opinion"}),t},Mc=e=>{const t=e||{};return Object.keys(t).reduce((s,r)=>(s[r]=oi(t[r]),s),{})},Lv=e=>e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),Uh=e=>{if(!e)return{protectedText:e,map:{}};let t=e;const s={};let r=0;const a=(l,c)=>{t=t.replace(l,i=>{const u=`${c}_${++r}`;return s[u]||(s[u]=i),u})};a(/(?:|\$||)\s*\d[\d,]*(?:\.\d+)?/g,"MONEY"),a(/\b(?:USD|NIS|ILS|EUR|GBP)\s*\d[\d,]*(?:\.\d+)?\b/gi,"MONEY"),a(/\d[\d,]*(?:\.\d+)?\s*(?:NIS|ILS|USD|EUR|GBP)\b/gi,"MONEY"),a(/\d[\d,]*(?:\.\d+)?%/g,"PCT"),a(/\b\d{1,2}[\/\.]\d{1,2}[\/\.]\d{4}\b/g,"DATE");const o="(January|February|March|April|May|June|July|August|September|October|November|December|Jan|Feb|Mar|Apr|Jun|Jul|Aug|Sep|Oct|Nov|Dec)";return a(new RegExp(`\\b\\d{1,2}\\s+${o}\\s+\\d{4}\\b`,"g"),"DATE"),a(new RegExp(`\\b${o}\\s+\\d{1,2},\\s+\\d{4}\\b`,"g"),"DATE"),a(/\b(?:Policy\s+No\.?|Claim\s+#?|File|Case)\s+[A-Za-z0-9\/\-]+\b/gi,"ID"),a(/\b[A-Za-z0-9]{3,}[A-Za-z0-9\-\/]{3,}\b/g,"ID"),a(/\b\d{1,3}(?:,\d{3})*(?:\.\d+)?\b/g,"NUM"),{protectedText:t,map:s}},Wh=(e,t)=>{if(!e||!t||!Object.keys(t).length)return e;let s=e;for(const[r,a]of Object.entries(t)){const o=new RegExp(Lv(r),"g");s=s.replace(o,a)}return s},_v=`
               . ,   ,          .

          , ,  ,            .

      -  ,     .

   ,     ,                .

      .
`.trim(),Ov=["The policy period is from [policyStartDate] to [policyEndDate].","","The retroactive date is [retroactiveDate].","","    _______________, ,   .","","      ,     ____________  ____________.","",",         ."].join(`
`),zh=(e,t,s,r,a)=>{const o=Ov,l=M=>`${M}`,c=t||"",i=s||"",u=r||a||"",p=l(`The policy period is from ${c} to ${i}.`),y=l(`The retroactive date is ${u}.`),b=["    _______________, ,   .","","      ,     ____________  ____________.","",",         ."].join(`
`),w=M=>M.replace(/\[policyStartDate\]/gi,c).replace(/\[policyEndDate\]/gi,i).replace(/\[retroactiveDate\]/gi,u),R=`${p}

${y}

${b}`,E=o?w(o):"";if(!E&&!e)return R;let N=e&&e.trim().length?e:E||R;(/\[policyStartDate\]/i.test(N)||/\[policyEndDate\]/i.test(N)||/\[retroactiveDate\]/i.test(N))&&(N=w(N));const h=/The policy period is[^\n]*/i;h.test(N)?N=N.replace(h,p):(!e||!e.trim())&&(N=`${p}

${N}`);const S=/The retroactive date is[^\n]*/i;return S.test(N)?N=N.replace(S,y):(!e||!e.trim())&&(N=N.includes(p)?N.replace(p,`${p}

${y}`):`${y}

${N}`),N.includes("   ")||(N=`${N.trim()}

${b}`),N},Md=(e,t)=>e.map(s=>{var l;const r=is.find(c=>c.value===s.category),a=(r==null?void 0:r.type)||"EXPENSE",o=s.category==="OTHER"?((l=s.customLabel)==null?void 0:l.trim())||"Other expense":(r==null?void 0:r.label)||"Expense";return{id:s.id||Rn(),type:a,category:s.category,label:o,serviceProvider:a==="EXPENSE"?s.serviceProvider:void 0,amount:Number(s.amount)||0,locked:!1,createdBy:t==null?void 0:t.id,createdAt:new Date().toISOString(),updatedBy:t==null?void 0:t.id,updatedAt:new Date().toISOString()}}),Mv=e=>e.filter(t=>t.type==="EXPENSE").map(t=>({id:t.id,date:new Date().toISOString().split("T")[0],description:`${t.label}${t.serviceProvider?` (${t.serviceProvider})`:""}`,amount:t.amount,currency:"NIS"})),zp=e=>/[\u0590-\u05FF]/.test(e||""),Pv=({data:e,updateData:t,onNext:s,currentUser:r,timelineGallery:a,onAddTimelineImages:o,onRemoveTimelineImage:l,onSaveAndExit:c,readOnly:i})=>{var He,ct,X,se;const[u,p]=g.useState(""),[y,b]=g.useState(!1),w=e.insurerName===""||cp.includes(e.insurerName),[R,E]=g.useState(!w),[W,N]=g.useState(!1),[h,S]=g.useState(!1);g.useRef(null);const M=g.useRef(e.insuredName),H=g.useRef(e.plaintiffName);g.useEffect(()=>{M.current=e.insuredName},[e.insuredName]),g.useEffect(()=>{H.current=e.plaintiffName},[e.plaintiffName]);const[V,q]=g.useState(()=>({})),te=I=>I?new Date(I).toISOString().split("T")[0]:new Date().toISOString().split("T")[0],G=I=>I.trim().replace(/\s+/g," "),re=I=>{const ae=e,ne="plaintiffName"in I?I.plaintiffName??ae.plaintiffName:ae.plaintiffName,ye="insuredName"in I?I.insuredName??ae.insuredName:ae.insuredName;if(!(!!ne&&!!ye))return I;const ke=G(ne),De=G(ye),Qe=`${ke} v. ${De}`,Ke="reportSubject"in I?I.reportSubject??ae.reportSubject:ae.reportSubject,Fe="isSubjectAuto"in I?I.isSubjectAuto??ae.isSubjectAuto:ae.isSubjectAuto;return!Ke||!Ke.trim()||Fe?{...I,reportSubject:Qe,isSubjectAuto:!0}:I},j=I=>{i||(I==="OTHER"?(E(!0),t(re({insurerName:""}))):(E(!1),t(re({insurerName:I}))))},P=()=>{if(!e.odakanitNo||!we(e.odakanitNo)){alert("     (Odakanit)    .");return}s()},D=I=>{i||((e.expensesSheetId||e.expensesHtml)&&Qr(I)&&(I=Xa),e.selectedSections.includes(I)||t({selectedSections:[...e.selectedSections,I]}),b(!1))},O=I=>{if(i||I==="Update")return;if(!!(e.expensesSheetId||e.expensesHtml)&&Qr(I)){window.alert("           .");return}t({selectedSections:e.selectedSections.filter(ne=>ne!==I)})},z=()=>{i||u.trim()&&!e.selectedSections.includes(u)&&(t({selectedSections:[...e.selectedSections,u]}),p(""))},F=(I,ae)=>{const ne=ae==="UP"?I-1:I+1;if(ne<0||ne>=e.selectedSections.length)return;const ye=[...e.selectedSections];[ye[I],ye[ne]]=[ye[ne],ye[I]],t({selectedSections:ye})},C=()=>{const I=e.proceduralTimeline;return I&&I.procedureType?I:{procedureType:"FIRST_INSTANCE",currentStageId:"FI_STATEMENT_OF_CLAIM",stages:[]}},L=typeof e.selectedTimeline=="string"?e.selectedTimeline.trim().length>0:!!e.selectedTimelineImage;g.useEffect(()=>{if(e.proceduralTimeline||L)return;const I=C();t({proceduralTimeline:I})},[e.proceduralTimeline,L]),g.useEffect(()=>{const I=e.proceduralTimeline;if(!I)return;const ae=Oa[I.procedureType];if(!ae||!ae.length)return;const ne=[];if(ae.forEach(Pe=>{var Qe;const ke=((Qe=I.stages)==null?void 0:Qe.find(Ke=>Ke.id===Pe.id))||void 0;(Pe.isDynamic?!!(ke!=null&&ke.include):(ke==null?void 0:ke.include)!==!1)&&ne.push(Pe.id)}),!ne.length||ne.includes(I.currentStageId))return;const ye=ne[0];ye&&ye!==I.currentStageId&&t({proceduralTimeline:{...I,currentStageId:ye}})},[e.proceduralTimeline,t]);const Q=I=>{var ke;const ae=C(),ye=(ke=Oa[I][0])==null?void 0:ke.id,Pe={...ae,procedureType:I,currentStageId:ye||ae.currentStageId,stages:ae.stages.filter(De=>Oa[ae.procedureType].some(Qe=>Qe.id===De.id)).map(De=>({...De}))};t({proceduralTimeline:Pe}),q({})},me=I=>{const ne={...C(),currentStageId:I};t({proceduralTimeline:ne})},ce=(I,ae)=>{const ne=C(),ye=Array.isArray(ne.stages)?[...ne.stages]:[],Pe=ye.findIndex(Qe=>Qe.id===I);Pe>=0?ye[Pe]={...ye[Pe],include:ae}:ye.push({id:I,label:"",include:ae,isDynamic:!0,monthYear:null});let ke=ne.currentStageId;if(!ae&&I===ne.currentStageId){const Qe=Oa[ne.procedureType];if(Qe&&Qe.length){const Ke=[];if(Qe.forEach(Fe=>{const Z=ye.find(xe=>xe.id===Fe.id)||void 0;(Fe.isDynamic?!!(Z!=null&&Z.include):(Z==null?void 0:Z.include)!==!1)&&Ke.push(Fe.id)}),Ke.length){const Fe=Qe.findIndex(ve=>ve.id===I);let Z=null;if(Fe>0)for(let ve=Fe-1;ve>=0;ve-=1){const xe=Qe[ve].id;if(Ke.includes(xe)){Z=xe;break}}Z||(Z=Ke[0]),ke=Z}}}const De={...ne,currentStageId:ke,stages:ye};t({proceduralTimeline:De})},le=(I,ae,ne)=>{q(Ke=>{const Fe={...Ke};return!!!ae&&!!!ne?delete Fe[I]:Fe[I]={month:ae,year:ne},Fe});const ye=C(),Pe=Array.isArray(ye.stages)?[...ye.stages]:[],ke=Pe.findIndex(Ke=>Ke.id===I);let De=null;if(ae&&ne){const Ke=ae.padStart(2,"0");De=`${ne}-${Ke}`}ke>=0?Pe[ke]={...Pe[ke],monthYear:De}:Pe.push({id:I,label:"",include:!0,isDynamic:!1,monthYear:De});const Qe={...ye,stages:Pe};t({proceduralTimeline:Qe})},fe=async I=>{var ne;if(i){I.preventDefault();return}const ae=(ne=I.target.files)==null?void 0:ne[0];if(ae){N(!0);try{const ye=new FileReader;ye.onload=async()=>{var Ke;const Pe=ye.result.split(",")[1],ke=await K0(Pe,ae.type);let De={};if(ke.insuredName){const Fe={...De,insuredName:ke.insuredName},Z=e.isSubjectAuto!==!1;De=re(Z?{...Fe,isSubjectAuto:!0}:Fe),Z&&(!e.reportSubject||!e.reportSubject.trim())&&(De.reportSubject=ke.insuredName,De.isSubjectAuto=!0)}ke.marketRef?(De.marketRef=ke.marketRef,De.lineSlipNo=ke.marketRef):ke.lineSlipNo&&!De.lineSlipNo&&(De.lineSlipNo=ke.lineSlipNo),ke.certificateRef&&(De.certificateRef=ke.certificateRef),typeof ke.policyPeriodStart=="string"&&(De.policyPeriodStart=ke.policyPeriodStart),typeof ke.policyPeriodEnd=="string"&&(De.policyPeriodEnd=ke.policyPeriodEnd),typeof ke.retroStart=="string"&&(De.retroStart=ke.retroStart),typeof ke.retroEnd=="string"&&(De.retroEnd=ke.retroEnd),De.policyFile={id:"policy-doc",name:ae.name,data:Pe,type:ae.type};const Qe=zh((Ke=e.content)==null?void 0:Ke["Insurance Coverage"],De.policyPeriodStart||e.policyPeriodStart,De.policyPeriodEnd||e.policyPeriodEnd,De.retroStart||e.retroStart,De.retroEnd||e.retroEnd);Qe&&(De.content={...e.content,"Insurance Coverage":Qe}),t(De),N(!1)},ye.readAsDataURL(ae)}catch(ye){console.error("Error reading file",ye),N(!1)}}},Te=10,ge=10,Be=async I=>{if(i){I.preventDefault(),I.target.value="";return}const ae=I.target.files;if(!ae||!ae.length)return;const ne=e.lawyerAppendixFiles??[];if(ne.length>=Te){alert(`You can attach up to ${Te} appendices.`),I.target.value="";return}const ye=Te-ne.length,Pe=Array.from(ae).slice(0,ye),ke=[];for(const De of Pe){if(De.size/1048576>ge){alert(`${De.name} is larger than ${ge}MB and will not be attached.`);continue}let Ke=De.type;Ke||(/\.(tif|tiff)$/i.test(De.name)?Ke="image/tiff":Ke="application/octet-stream");const Fe=new FileReader,Z=await new Promise((ve,xe)=>{Fe.onload=()=>{const Me=String(Fe.result||"").split(",");ve(Me[1]||"")},Fe.onerror=()=>xe(Fe.error),Fe.readAsDataURL(De)});ke.push({id:`lawyer-appx-${Date.now()}-${Math.random().toString(36).slice(2,8)}`,name:De.name,data:Z,type:Ke})}ke.length&&t({lawyerAppendixFiles:[...ne,...ke]}),I.target.value=""},Ye=I=>{if(i)return;const ne=(e.lawyerAppendixFiles??[]).filter(ye=>ye.id!==I);t({lawyerAppendixFiles:ne})},Ve=(I,ae,ne,ye)=>n.jsxs("div",{className:"relative group",children:[n.jsx("input",{className:"w-full border border-borderDark p-2 rounded focus:ring-2 focus:ring-lpBlue outline-none pr-8",placeholder:ne,value:I,onChange:i?void 0:Pe=>ae(Pe.target.value),onBlur:i?void 0:ye?()=>ye(I):void 0,disabled:i}),I&&n.jsx("button",{type:"button",onClick:i?void 0:()=>ae(""),className:`absolute right-2 top-1/2 -translate-y-1/2 text-gray-300 transition-colors ${i?"cursor-not-allowed opacity-50":"hover:text-red-500"}`,disabled:i,children:n.jsx(Bs,{className:"w-4 h-4"})})]});return n.jsxs("div",{className:"space-y-8",children:[n.jsx("div",{className:"flex justify-end",children:n.jsxs("button",{type:"button",onClick:i?void 0:c,disabled:i,className:`flex items-center text-sm bg-blue-50 px-3 py-1.5 rounded-full ${i?"text-gray-400 cursor-not-allowed":"text-lpBlue hover:text-blue-900"}`,title:i?"  .":void 0,children:[n.jsx(Du,{className:"w-4 h-4 mr-1"}),"  "]})}),n.jsx("h2",{className:"text-3xl font-bold text-lpBlue font-serif border-b pb-2",children:"1. Case Setup & Structure"}),e.odakanitNo&&n.jsx("div",{className:"bg-indigo-50 border-l-4 border-indigo-600 p-4 mb-6",children:n.jsx("div",{className:"flex justify-between items-center",children:n.jsxs("div",{children:[n.jsxs("h3",{className:"font-bold text-indigo-900 flex items-center",children:[n.jsx(lh,{className:"w-5 h-5 mr-2"})," Odakanit Case #",e.odakanitNo]}),n.jsx("p",{className:"text-sm text-indigo-700",children:"This report folder was initiated by Finance."})]})})}),n.jsxs("div",{className:"bg-panel p-6 rounded-lg shadow-sm border border-borderDark relative overflow-hidden",children:[n.jsx("div",{className:"absolute top-0 left-0 w-1 h-full bg-lpGold"}),n.jsxs("h3",{className:"font-bold text-lg mb-4 text-textLight flex items-center",children:[n.jsx(go,{className:"w-5 h-5 mr-2 text-lpGold"}),"Re: Case Details (Mandatory Fields - English)"]}),n.jsx("div",{className:"mb-6 bg-blue-50 border-2 border-dashed border-blue-200 rounded-lg p-4 text-center relative group",children:W?n.jsxs("div",{className:"flex flex-col items-center justify-center py-2",children:[n.jsx(Mt,{className:"w-8 h-8 text-lpBlue animate-spin mb-2"}),n.jsx("span",{className:"text-sm font-bold text-lpBlue",children:"Analyzing Policy Document..."})]}):n.jsx(n.Fragment,{children:e.policyFile?n.jsxs("div",{className:"flex flex-col items-center justify-center gap-3",children:[n.jsxs("div",{className:"flex items-center justify-center gap-3",children:[n.jsxs("div",{className:"flex flex-col items-center text-green-700 font-bold text-center",children:[n.jsxs("div",{className:"flex items-center",children:[n.jsx(oh,{className:"w-6 h-6 mr-2"}),"Policy Document Attached"]}),n.jsxs("span",{className:"text-xs font-normal text-green-800",children:["Original file: ",e.policyFile.name]})]}),n.jsx("button",{className:"text-xs text-red-500 hover:underline disabled:text-gray-400 disabled:cursor-not-allowed",onClick:i?void 0:()=>t({policyFile:void 0}),disabled:i,children:"Remove"})]}),n.jsxs("div",{className:"flex items-center justify-center gap-2 text-xs text-textLight bg-panel/70 px-3 py-1 rounded-full border border-borderDark",children:[n.jsx("input",{id:"attach-policy-appendix",type:"checkbox",className:"h-3 w-3 accent-lpBlue",checked:e.attachPolicyAsAppendix??!0,onChange:i?void 0:I=>t({attachPolicyAsAppendix:I.target.checked}),disabled:i}),n.jsx("label",{htmlFor:"attach-policy-appendix",className:"cursor-pointer",children:"Attach policy as Appendix A to final PDF"})]})]}):n.jsxs(n.Fragment,{children:[n.jsxs("div",{className:`flex flex-col items-center justify-center text-center px-4 ${i?"cursor-not-allowed opacity-60":"cursor-pointer"}`,children:[n.jsx(yo,{className:"w-8 h-8 text-lpBlue mb-2 group-hover:scale-110 transition-transform"}),n.jsx("span",{className:"text-sm font-bold text-textLight",children:"Upload Policy Document"}),n.jsx("span",{className:"text-xs text-textMuted mt-1",children:"Any file uploaded here (PDF/DOCX/scan) is treated as the official policy for this case."})]}),n.jsx("input",{type:"file",className:"absolute inset-0 opacity-0 cursor-pointer",accept:"application/pdf,application/vnd.openxmlformats-officedocument.wordprocessingml.document,text/plain,image/*",onChange:fe,disabled:i})]})})}),n.jsxs("div",{className:"mb-6 mt-4 bg-slate-50 border border-dashed border-borderDark rounded-lg p-4",children:[n.jsxs("h4",{className:"text-sm font-semibold text-textLight mb-2 flex items-center justify-between",children:[n.jsx("span",{children:"Additional Appendices (Lawyer)"}),n.jsxs("span",{className:"text-[11px] text-textMuted",children:[((He=e.lawyerAppendixFiles)==null?void 0:He.length)||0,"/",Te]})]}),n.jsx("div",{className:"flex flex-col md:flex-row gap-3 md:items-center",children:n.jsx("div",{className:"flex-1",children:n.jsxs("label",{htmlFor:"lawyer-appendix-input",className:`flex flex-col items-center justify-center px-3 py-3 border-2 border-dashed border-borderDark rounded-lg text-xs text-textMuted bg-panel transition-colors ${i?"cursor-not-allowed opacity-60":"cursor-pointer hover:border-lpBlue hover:text-lpBlue"}`,children:[n.jsx(yo,{className:"w-5 h-5 mb-1"}),n.jsx("span",{className:"font-semibold",children:"Upload / drag legal appendices"}),n.jsxs("span",{className:"mt-1 text-[11px] text-textMuted",children:["Supported: PDF, PNG, JPG, TIFF (up to ",ge,"MB per file)"]}),n.jsx("input",{id:"lawyer-appendix-input",type:"file",multiple:!0,className:"hidden",accept:"application/pdf,image/png,image/jpeg,image/jpg,image/tiff,image/x-tiff",onChange:Be,disabled:i})]})})}),(((ct=e.lawyerAppendixFiles)==null?void 0:ct.length)||0)>0&&n.jsx("div",{className:"mt-3 border-t border-borderDark pt-2 space-y-1 max-h-40 overflow-y-auto text-xs text-textLight text-left",children:(X=e.lawyerAppendixFiles)==null?void 0:X.map(I=>n.jsxs("div",{className:"flex items-center justify-between gap-2 rounded bg-panel px-2 py-1 border border-borderDark",children:[n.jsxs("div",{className:"flex-1 min-w-0",children:[n.jsx("div",{className:"truncate font-medium",children:I.name}),n.jsx("div",{className:"text-[11px] text-textMuted truncate",children:I.type||"Unknown type"})]}),n.jsx("button",{type:"button",onClick:i?void 0:()=>Ye(I.id),className:"text-[11px] text-red-500 hover:text-red-700 disabled:text-gray-400 disabled:cursor-not-allowed",disabled:i,children:"Remove"})]},I.id))})]}),n.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-5",children:[n.jsxs("div",{className:"space-y-1",children:[n.jsxs("label",{className:"text-xs font-bold text-textMuted uppercase flex items-center",children:[n.jsx(A0,{className:"w-3 h-3 mr-1"})," Report Date"]}),n.jsx("input",{type:"date",className:"w-full border border-borderDark p-2 rounded disabled:bg-navySecondary disabled:text-textMuted",value:te(e.reportDate),onChange:i?void 0:I=>t({reportDate:new Date(I.target.value).toISOString()}),disabled:i})]}),n.jsxs("div",{className:"space-y-1",children:[n.jsx("label",{className:"text-xs font-bold text-textMuted uppercase",children:"RE (Subject)"}),n.jsx("input",{type:"text",className:"w-full border border-borderDark p-2 rounded text-sm disabled:bg-navySecondary disabled:text-textMuted",placeholder:"e.g. John Doe v. XYZ Medical Center  Claim Update",value:e.reportSubject||"",onChange:i?void 0:I=>t({reportSubject:I.target.value,isSubjectAuto:!1}),disabled:i})]}),n.jsxs("div",{className:"space-y-1",children:[n.jsx("label",{className:"text-xs font-bold text-textMuted uppercase",children:"Odakanit Case Number (Internal File)"}),Ve(e.odakanitNo||"",I=>t({odakanitNo:I}),"e.g., 1/123")]}),n.jsxs("div",{className:"space-y-1",children:[n.jsx("label",{className:"text-xs font-bold text-textMuted uppercase",children:"Insurer Name"}),n.jsxs("select",{className:"w-full border border-borderDark p-2 rounded disabled:bg-navySecondary disabled:text-textMuted",value:R?"OTHER":e.insurerName,onChange:i?void 0:I=>j(I.target.value),disabled:i,children:[n.jsx("option",{value:"",disabled:!0,children:"-- Select Insurer --"}),cp.map(I=>n.jsx("option",{value:I,children:I},I)),n.jsx("option",{value:"OTHER",children:"Other (Enter Manually)"})]}),R&&n.jsx("div",{className:"mt-2 animate-fade-in",children:Ve(e.insurerName,I=>t({insurerName:I}),"Type custom insurer name...")})]}),n.jsxs("div",{className:"space-y-1",children:[n.jsx("label",{className:"text-xs font-bold text-textMuted uppercase",children:Bp.lineSlip}),Ve(e.lineSlipNo,I=>t({lineSlipNo:I,marketRef:I}),"e.g., B0180PD2391439")]}),n.jsxs("div",{className:"space-y-1",children:[n.jsx("label",{className:"text-xs font-bold text-textMuted uppercase",children:Bp.certificate}),Ve(e.certificateRef||"",I=>t({certificateRef:I}),"e.g., 516902624")]}),n.jsxs("div",{className:"space-y-1",children:[n.jsx("label",{className:"text-xs font-bold text-textMuted uppercase",children:"Insured Name"}),Ve(e.insuredName,I=>t(re({insuredName:I})),"e.g., Dr. Cohen",I=>{const ae=(I||"").trim();!ae||!zp(ae)||Rd(ae).then(ne=>{!ne||ne.trim()===""||ne==="Error translation."||M.current===ae&&t(re({insuredName:ne.trim()}))}).catch(()=>{})})]}),n.jsxs("div",{className:"space-y-1 md:col-span-2",children:[n.jsxs("div",{className:"flex justify-between items-end mb-1",children:[n.jsx("label",{className:"text-xs font-bold text-textMuted uppercase",children:"Party Name"}),n.jsxs("div",{className:"flex bg-navySecondary rounded p-0.5 text-xs",children:[n.jsx("button",{className:`px-3 py-1 rounded-sm transition-all ${e.plaintiffTitle==="Plaintiff"?"bg-panel shadow text-lpBlue font-bold":"text-textMuted"}`,onClick:()=>t({plaintiffTitle:"Plaintiff"}),children:"Plaintiff"}),n.jsx("button",{className:`px-3 py-1 rounded-sm transition-all ${e.plaintiffTitle==="Claimant"?"bg-panel shadow text-lpBlue font-bold":"text-textMuted"}`,onClick:()=>t({plaintiffTitle:"Claimant"}),children:"Claimant"})]})]}),Ve(e.plaintiffName,I=>t(re({plaintiffName:I})),"e.g., Mr. Levi",I=>{const ae=(I||"").trim();!ae||!zp(ae)||Rd(ae).then(ne=>{!ne||ne.trim()===""||ne==="Error translation."||H.current===ae&&t(re({plaintiffName:ne.trim()}))}).catch(()=>{})})]})]})]}),n.jsxs("div",{className:"bg-panel p-6 rounded-lg shadow-sm border border-borderDark",children:[n.jsx("div",{className:"flex justify-between items-center mb-4",children:n.jsxs("div",{children:[n.jsxs("h3",{className:"font-bold text-lg text-textLight flex items-center",children:[n.jsx(ih,{className:"w-5 h-5 mr-2 text-lpBlue"}),"Procedural Timeline"]}),n.jsx("p",{className:"text-sm text-textMuted",children:'   ,    Month/Year    ".'})]})}),n.jsxs("div",{className:"mb-4",children:[n.jsx("label",{className:"block text-xs font-semibold text-textMuted mb-1",children:"Procedure Type"}),n.jsx("select",{className:"border border-borderDark rounded px-3 py-1 text-sm",value:((se=e.proceduralTimeline)==null?void 0:se.procedureType)||"FIRST_INSTANCE",onChange:I=>Q(I.target.value),children:jv.map(I=>n.jsx("option",{value:I.value,children:I.label},I.value))})]}),!e.proceduralTimeline&&L&&n.jsxs("div",{className:"border border-dashed border-borderDark rounded-md p-3 bg-navySecondary text-xs text-textLight",children:[n.jsx("p",{className:"mb-2",children:"This report uses the legacy timeline. You can enable the new Procedural Timeline (recommended for new reports)."}),n.jsx("button",{type:"button",className:"inline-flex items-center px-3 py-1 rounded-full bg-navy text-gold text-[11px] font-semibold hover:bg-navySecondary",onClick:()=>t({proceduralTimeline:C()}),children:"Enable Procedural Timeline"})]}),e.proceduralTimeline&&n.jsx("div",{className:"space-y-3",children:Oa[e.proceduralTimeline.procedureType].map(I=>{var Fe,Z,ve;const ae=((Z=(Fe=e.proceduralTimeline)==null?void 0:Fe.stages)==null?void 0:Z.find(xe=>xe.id===I.id))||void 0,ne=V[I.id],ye=!!I.isDynamic,Pe=ye?!!(ae!=null&&ae.include):!0,ke=(ae==null?void 0:ae.monthYear)||"";let De="",Qe="";if(ne)De=ne.month||"",Qe=ne.year||"";else if(typeof ke=="string"&&ke.includes("-")){const[xe,Se]=ke.split("-");xe&&Se&&(Qe=xe,De=Se)}const Ke=((ve=e.proceduralTimeline)==null?void 0:ve.currentStageId)===I.id;return n.jsxs("div",{className:"flex items-start justify-between border border-borderDark rounded-lg px-3 py-2 bg-panel",children:[n.jsxs("div",{className:"flex items-start gap-3",children:[n.jsx("input",{type:"radio",name:"currentStage",className:"mt-1",checked:Ke,disabled:!Pe,onChange:()=>Pe&&me(I.id)}),n.jsxs("div",{children:[n.jsxs("div",{className:"font-semibold text-sm text-textLight flex items-center gap-2",children:[n.jsx("span",{children:I.label}),ye&&n.jsx("span",{className:"text-[10px] px-2 py-0.5 rounded-full bg-navySecondary text-textMuted",children:"Dynamic"})]}),n.jsxs("div",{className:"mt-1 flex items-center gap-2 text-xs text-textMuted flex-wrap",children:[n.jsx("span",{children:"Month / Year:"}),n.jsxs("select",{className:"border border-borderDark rounded px-2 py-0.5 text-xs",value:De,disabled:!Pe,onChange:xe=>le(I.id,xe.target.value,Qe),children:[n.jsx("option",{value:"",children:""}),n.jsx("option",{value:"01",children:"January"}),n.jsx("option",{value:"02",children:"February"}),n.jsx("option",{value:"03",children:"March"}),n.jsx("option",{value:"04",children:"April"}),n.jsx("option",{value:"05",children:"May"}),n.jsx("option",{value:"06",children:"June"}),n.jsx("option",{value:"07",children:"July"}),n.jsx("option",{value:"08",children:"August"}),n.jsx("option",{value:"09",children:"September"}),n.jsx("option",{value:"10",children:"October"}),n.jsx("option",{value:"11",children:"November"}),n.jsx("option",{value:"12",children:"December"})]}),n.jsx("input",{type:"number",className:"w-20 border border-borderDark rounded px-2 py-0.5 text-xs",placeholder:"Year",value:Qe,disabled:!Pe,onChange:xe=>le(I.id,De,xe.target.value),min:1900,max:2100})]})]})]}),ye&&n.jsxs("div",{className:"flex items-center gap-1 text-xs text-textMuted",children:[n.jsx("span",{children:"Include"}),n.jsx("input",{type:"checkbox",checked:Pe,onChange:xe=>ce(I.id,xe.target.checked)})]})]},I.id)})})]}),n.jsxs("div",{className:"bg-panel p-6 rounded-lg shadow-sm border border-borderDark",children:[n.jsxs("h3",{className:"font-bold text-lg mb-4 text-textLight flex items-center",children:[n.jsx(O0,{className:"w-5 h-5 mr-2 text-green-600"}),"Current Report Sections"]}),n.jsx("div",{className:"space-y-2 mb-6",children:e.selectedSections.map((I,ae)=>{const ne=ae>0,ye=ae<e.selectedSections.length-1,ke=!!(e.expensesSheetId||e.expensesHtml)&&Qr(I),De=I==="Update"||ke;return n.jsxs("div",{className:"flex items-center justify-between p-3 bg-panel border border-borderDark rounded shadow-sm",children:[n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsx("span",{className:"w-6 h-6 rounded-full bg-navySecondary text-textMuted flex items-center justify-center text-xs font-bold",children:ae+1}),n.jsx("span",{className:"font-medium text-textLight",children:I}),I==="Update"&&n.jsx("span",{className:"text-xs bg-blue-100 text-blue-800 px-2 py-0.5 rounded",children:"Fixed"}),ke&&n.jsx("span",{className:"text-xs bg-amber-100 text-amber-800 px-2 py-0.5 rounded",children:"   "})]}),n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsxs("div",{className:"flex flex-col gap-1",children:[n.jsx("button",{onClick:()=>F(ae,"UP"),disabled:!ne,className:`p-1 rounded border ${ne?"text-textMuted hover:bg-navySecondary":"text-gray-300 cursor-not-allowed"}`,title:" ",children:n.jsx(T0,{className:"w-4 h-4"})}),n.jsx("button",{onClick:()=>F(ae,"DOWN"),disabled:!ye,className:`p-1 rounded border ${ye?"text-textMuted hover:bg-navySecondary":"text-gray-300 cursor-not-allowed"}`,title:" ",children:n.jsx(I0,{className:"w-4 h-4"})})]}),!De&&n.jsx("button",{onClick:()=>O(I),className:"p-2 rounded-md text-textMuted hover:text-red-400 hover:bg-red-500/10 border border-transparent hover:border-red-400/40 transition",title:" ",children:n.jsx(Ft,{className:"w-4 h-4"})})]})]},`${I}-${ae}`)})}),y?n.jsxs("div",{className:"bg-navySecondary p-4 rounded border animate-fade-in",children:[n.jsxs("div",{className:"flex gap-2",children:[n.jsxs("select",{className:"flex-1 border p-2 rounded",onChange:I=>D(I.target.value),defaultValue:"",children:[n.jsx("option",{value:"",disabled:!0,children:"-- Select a Header --"}),Lr.filter(I=>!e.selectedSections.includes(I)).map(I=>n.jsx("option",{value:I,children:I},I))]}),n.jsx("button",{onClick:()=>b(!1),className:"px-4 py-2 bg-borderDark text-textMuted rounded hover:bg-borderDark",children:"Cancel"})]}),n.jsx("div",{className:"mt-4 pt-4 border-t border-borderDark",children:n.jsxs("div",{className:"flex gap-2",children:[n.jsx("input",{className:"flex-1 border p-2 rounded",placeholder:"Type custom header name...",value:u,onChange:I=>p(I.target.value)}),n.jsx("button",{onClick:()=>{z(),b(!1)},className:"px-4 py-2 bg-purple-600 text-white rounded hover:bg-purple-700",children:"Add Custom"})]})})]}):n.jsxs("button",{onClick:()=>b(!0),className:"w-full py-2 border-2 border-dashed border-borderDark text-textMuted rounded hover:border-green-500 hover:text-green-600 transition flex items-center justify-center font-medium",children:[n.jsx(_u,{className:"w-4 h-4 mr-2"})," Add Report Section"]})]}),n.jsxs("div",{className:"flex flex-wrap justify-between gap-2",children:[n.jsxs("button",{onClick:c,className:"flex items-center text-textMuted px-4 py-2 border rounded hover:bg-navySecondary transition",children:[n.jsx(Jl,{className:"mr-2 w-4 h-4"})," Back to Dashboard"]}),n.jsxs("button",{onClick:P,className:"flex items-center bg-navy text-gold px-6 py-2 rounded hover:bg-navySecondary transition shadow-md",children:["Next Step ",n.jsx(os,{className:"ml-2 w-4 h-4"})]})]})]})},Vp=e=>{if(!e)return null;try{const t=JSON.stringify(e);let s=0;for(let r=0;r<t.length;r+=1){const a=t.charCodeAt(r);s=(s<<5)-s+a,s|=0}return String(s)}catch{return null}},Fv=({data:e,updateData:t,onBack:s,onNext:r,currentUser:a,onSaveAndExit:o,onSaveDraft:l,onTranslate:c,onImproveEnglish:i,onFormatContent:u,onSubmitHebrewForReview:p,onApproveHebrewForTranslation:y,onAddReviewIssues:b,onMarkReviewIssueDone:w,onAddExternalFeedbackIssues:R,onReopenHebrewDueToExternalFeedback:E,step1Focus:W,onStep1FocusConsumed:N,isTranslating:h,isImprovingEnglish:S,onOpenAssistant:M,onActiveSectionChange:H,readOnly:V})=>{var $o;const q=Us,te=Ro,[G,re]=g.useState(null),[j,P]=g.useState(!1),[D,O]=g.useState(null),[z,F]=g.useState([]),[C,L]=g.useState(""),[Q,me]=g.useState(!1),[ce,le]=g.useState(()=>Lr[0]||"Update"),[fe,Te]=g.useState([]),[ge,Be]=g.useState(!1),[Ye,Ve]=g.useState(null),[He,ct]=g.useState(null),[X,se]=g.useState(null),[I,ae]=g.useState([]),[ne,ye]=g.useState(!1),[Pe,ke]=g.useState(null),[De,Qe]=g.useState("SAFE_POLISH"),[Ke,Fe]=g.useState(null),[Z,ve]=g.useState([]),[xe,Se]=g.useState("TEMPLATES"),[Me,_e]=g.useState(""),[Ue,U]=g.useState(!1),[J,he]=g.useState(()=>Lr[0]||"Update"),[Re,de]=g.useState(null),[je,Ze]=g.useState(()=>jo(a.id)),[We,tt]=g.useState(""),[qt,At]=g.useState(!1),[ie,nt]=g.useState(null),[on,Rs]=g.useState("DUAL"),[lt,ms]=g.useState(null),[Jn,An]=g.useState(null),[wr,nr]=g.useState(null),[In,sr]=g.useState(null),[Qn,Bn]=g.useState(null),ps=g.useRef(null),$n=g.useRef(null),A=g.useRef({}),[Ne,Oe]=g.useState({date:new Date().toISOString().split("T")[0],description:"",amount:0,currency:"NIS"}),Ce=a.role==="FINANCE"||a.role==="SUB_ADMIN"&&!0,ut=e.selectedSections.some(f=>f.toLowerCase().includes("expenses")),rt=a.role==="LAWYER"&&e.requiresExpenses===!0&&ut,Xt=a.role==="ADMIN"&&e.isTranslated,Cs=a.role==="LAWYER"||a.role==="ADMIN",Jt=a.role==="FINANCE"||a.role==="SUB_ADMIN"||a.role==="ADMIN",Rt=(($o=e.reportReview)==null?void 0:$o.status)==="APPROVED"||e.hebrewWorkflowStatus==="HEBREW_APPROVED",Co=e.translatedContent||{},xa=Object.keys(Co).some(f=>{if(f.toLowerCase().includes("expenses"))return!1;const T=Co[f];return typeof T=="string"&&T.trim().length>0});g.useEffect(()=>{Ze(jo(a.id))},[a.id]);const jr=async f=>{var K,ee;if(V||!Xt||!e.isTranslated||f.toLowerCase().includes("expenses"))return;const T=((K=e.translatedContent)==null?void 0:K[f])||"";if(T.trim()){Bn(f);try{const{protectedText:ue,map:d}=Uh(T),m=await xh(ue),x=Wh(m||ue,d),k=Hh(x),v={...e.translatedContent||{},[f]:oi(k)};t({translatedContent:v}),typeof l=="function"&&l()}catch(ue){console.error("Improve English (single section) failed",ue);const d=Cd(f,(ee=e.expertSummaryMode)==null?void 0:ee[f]);window.alert(`   "${d}" .      .`)}finally{Bn(ue=>ue===f?null:ue)}}},ji=f=>typeof f.reportNumber=="number"&&f.reportNumber===1,Ei=f=>xp(f)?"EXPERT":f===te?"DEMAND":"CLAIM";g.useEffect(()=>{if(!W)return;const f=()=>{let T=null;W==="EXTERNAL_FEEDBACK"?T=Dd:W==="REVIEW"&&(T=El);let K=null;if(T&&(K=document.getElementById(T)),K||(K=document.getElementById(El)),K)try{K.scrollIntoView({behavior:"smooth",block:"start"})}catch{}N&&N()};typeof window<"u"?window.requestAnimationFrame(()=>{const T=W==="EXTERNAL_FEEDBACK"&&document.getElementById(Dd)||document.getElementById(El);if(T){try{T.scrollIntoView({behavior:"smooth",block:"start"})}catch{}N&&N()}else setTimeout(f,0)}):f()},[W,N]);const ki=()=>{if(V||!Jt||!Ne.description||!Ne.amount)return;const f={id:Date.now().toString(),date:Ne.date||"",description:Ne.description,amount:Number(Ne.amount),currency:Ne.currency||"NIS"},T=[...e.expensesItems,f],K=T.reduce((ee,ue)=>ee+ue.amount,0);t({expensesItems:T,expensesSum:K.toLocaleString()}),Oe({date:new Date().toISOString().split("T")[0],description:"",amount:0,currency:"NIS"})},Ai=f=>{if(V)return;const T=e.expensesItems.filter(ee=>ee.id!==f),K=T.reduce((ee,ue)=>ee+ue.amount,0);t({expensesItems:T,expensesSum:K.toLocaleString()})},zt=async f=>{if(V)return;const T=f.target.files;if(!T)return;const K=e.invoiceFiles.length;if(K>=4){O({msg:"   4   (PDF  Word).",type:"info"}),f.target.value="";return}const ee=Array.from(T).slice(0,4-K),ue=[];for(let v=0;v<ee.length;v++){const _=ee[v],$=new FileReader;await new Promise(B=>{$.onload=Y=>{var oe;ue.push({id:`inv-${Date.now()}-${v}`,name:_.name,data:((oe=Y.target)==null?void 0:oe.result).split(",")[1],type:_.type}),B()},$.readAsDataURL(_)})}const d=[...e.invoiceFiles,...ue],m=d.length>0,k=Jt&&e.status==="WAITING_FOR_INVOICES"&&m?"TASK_ASSIGNED":e.status;t({invoiceFiles:d,isWaitingForInvoices:!m,status:k}),O({msg:"   ( 4 ).",type:"success"})},ln=f=>{const T=e.invoiceFiles.filter(d=>d.id!==f),K=T.length>0,ue=Jt&&!K&&e.status==="TASK_ASSIGNED"?"WAITING_FOR_INVOICES":e.status;t({invoiceFiles:T,isWaitingForInvoices:!K,status:ue})},Qt=(f,T)=>{Ce||t({content:{...e.content,[f]:T}})},Ii=f=>f.replace(/{plaintiff}/g,e.plaintiffName||"").replace(/{insured}/g,e.insuredName||"").replace(/\[DATE\]/g,new Date().toLocaleDateString("he-IL"));g.useEffect(()=>{let f=!1;return(async()=>{try{const K=await dp();f||F(K)}catch(K){console.error("Failed to load templates",K)}try{const K=await nN();f||ve(K)}catch(K){console.error("Failed to load best practices",K)}})(),()=>{f=!0}},[]);const Ti=(f,T)=>{Xt&&t({translatedContent:{...e.translatedContent,[f]:T}})},Er=f=>z.filter(T=>T.sectionKey===f&&T.isEnabled!==!1).sort((T,K)=>(T.orderIndex||0)-(K.orderIndex||0)||T.createdAt.localeCompare(K.createdAt)),fs=(f,T)=>{if(Ce)return;let K=T.body.replace(/{plaintiff}/g,e.plaintiffName||"the claimant").replace(/{insured}/g,e.insuredName||"the insured").replace(/\[DATE\]/g,new Date().toLocaleDateString("he-IL"));const ee=e.content[f]||"";Qt(f,ee?`${ee}

${K}`:K),re(null)},Ri=async f=>{try{const T=await dp();F(T)}catch(T){console.error("Failed to refresh templates",T)}L(""),_e(""),re(T=>T===f?null:f)},Ci=async f=>{if(a.role!=="ADMIN")return;const T=A.current[f],K=T==null?void 0:T.current;if(!K){O({msg:"     .",type:"error"});return}const ee=K.selectionStart??0,ue=K.selectionEnd??0;if(ee===ue){O({msg:"     .",type:"info"});return}let m=(e.content[f]||"").slice(ee,ue).trim();if(!m){O({msg:"    .",type:"info"});return}if(m.length<15&&!window.confirm("   .    ?"))return;const x=m.split(/\s+/).slice(0,6).join(" "),v=(window.prompt(" :",x)||"").trim();if(!v){O({msg:"   ( ).",type:"info"});return}const _=new Date().toISOString(),$={id:"",sectionKey:f,title:v,body:m,createdByUserId:a.id,createdAt:_,updatedAt:_,isEnabled:!0};try{const B=await up($,a.role);F(B),O({msg:"  .",type:"success"})}catch(B){console.error("Failed to save template",B),O({msg:"  .",type:"error"})}},kr=async(f,T)=>{if(a.role!=="ADMIN")return;const K=z.find(ue=>ue.id===f);if(!K)return;const ee={...K,...T,updatedAt:new Date().toISOString()};try{const ue=await up(ee,a.role);F(ue)}catch(ue){console.error("Failed to update template",ue),O({msg:"  .",type:"error"})}},ha=async f=>{if(a.role==="ADMIN")try{const T=await z0(f,a.role);F(T)}catch(T){console.error("Failed to delete template",T),O({msg:"  .",type:"error"})}},ga=async(f,T)=>{if(a.role==="ADMIN")try{const K=await V0(f,T,a.role);F(K)}catch(K){console.error("Failed to reorder template",K),O({msg:"   .",type:"error"})}},Do=(f,T)=>{if(!f||!T||f===T)return"  ";const K=f.split(/\s+/).filter(Boolean),ee=T.split(/\s+/).filter(Boolean);if(!K.length||!ee.length)return"  ";const ue=Math.max(K.length,ee.length)||1;let d=0;const m=Math.min(K.length,ee.length);for(let k=0;k<m;k+=1)K[k]!==ee[k]&&(d+=1);d+=Math.abs(K.length-ee.length);const x=d/ue;return x<.05?"  ":x<.15?" ":x<.35?" ":" "},Di=async f=>{if(Ce)return;const T=e.content[f];if(T){nr(f),P(!0);try{const K=await Y0(T,De);if(K.factProtectionBlocked){O({msg:"    ( ).    .",type:"info"});return}const ee=K.text,ue=Do(T,ee),d=ov(T,ee),m=d.filter(x=>x.type==="add"||x.type==="remove").length;if(m>0){const x=Date.now()+2e4;Fe({sectionKey:f,tokens:d,changedWords:m,expiresAt:x,open:!1}),setTimeout(()=>{Fe(k=>k&&k.sectionKey===f&&k.expiresAt===x?null:k)},2e4)}else Fe(null);O({msg:`  (${De==="SAFE_POLISH"?"SAFE_POLISH":"REWRITE"}): ${ue}`,type:"success"}),Qt(f,ee)}catch(K){console.error("Refine text failed",K),O({msg:"  .   .",type:"error"})}finally{P(!1),nr(null)}}},Li=async(f,T,K)=>{var ee;P(!0);try{const ue=await J0(T,K);if((ee=ue.items)!=null&&ee.length){const d=[...e.expensesItems,...ue.items],m=d.reduce((x,k)=>x+(k.amount||0),0);t({expensesItems:d,expensesSum:m.toLocaleString()}),O({msg:`  "${f}"  .`,type:"success"})}else O({msg:"    .",type:"info"})}catch(ue){console.error("Expenses extraction failed",ue),O({msg:" .   PDF/Word .",type:"error"})}finally{P(!1)}},_i=f=>new Promise((T,K)=>{const ee=new FileReader;ee.onload=()=>T(ee.result.split(",")[1]),ee.onerror=()=>K(new Error("Failed to read file")),ee.readAsDataURL(f)}),Lo=f=>{var k,v,_,$,B,Y,oe,Ee;if(!f)return;const T=[...e.selectedSections],K=be=>{T.includes(be)||T.push(be)},ee=be=>be&&be.length?be.map(ze=>` ${ze}`).join(`
`):"",ue=(k=f.timeline)!=null&&k.length?f.timeline.map(be=>` ${(be==null?void 0:be.date)||"  "}  ${(be==null?void 0:be.event)||""}`).join(`
`):"",d={...e.content};if(f.briefSummary||ue||(v=f.injuries)!=null&&v.length){K("Update");const be=ee(f.injuries),ze=ee(f.requestedRelief),qe=[f.briefSummary||"",be?`
 :
${be}`:"",ze?`
 :
${ze}`:"",ue?`
 :
${ue}`:""].filter(Boolean);d.Update=qe.join(`
`).trim()}if((_=f.facts)!=null&&_.length){const be=Us;K(be),d[be]=ee(f.facts)}const m=[];if(($=f.allegations)!=null&&$.length&&m.push(` :
${ee(f.allegations)}`),(B=f.negligenceTheory)!=null&&B.length&&m.push(` :
${ee(f.negligenceTheory)}`),(Y=f.medicalFindings)!=null&&Y.length&&m.push(` :
${ee(f.medicalFindings)}`),m.length){const be=e.selectedSections.includes("Strategy & Recommendations")?"Strategy & Recommendations":"Strategy";K(be),d[be]=m.join(`

`)}f.riskAssessment&&(K("Risk Assessment"),d["Risk Assessment"]=f.riskAssessment);const x=[];(oe=f.recommendedActions)!=null&&oe.length&&x.push(ee(f.recommendedActions)),(Ee=f.requestedRelief)!=null&&Ee.length&&x.push(` :
${ee(f.requestedRelief)}`),x.length&&(K("Recommendations"),d.Recommendations=x.join(`

`)),t({content:d,selectedSections:T,complaintAnalysis:f}),O({msg:"     .",type:"success"})},Oi=(f,T)=>{var $t,Ot,Dt;if(!f)return"";const K=(T==null?void 0:T.analysisType)==="DEMAND"||(T==null?void 0:T.section)===te?"DEMAND":"CLAIM",ee=K==="DEMAND"?"":"",ue=K==="DEMAND"?"   ":"  ",d=(Ot=($t=f.entities)==null?void 0:$t.plaintiff)==null?void 0:Ot.trim(),m=(f.defendants||[]).filter(Boolean).join(", "),x=[];x.push(d?`${ee}, ${d}`:ee),m&&x.push(`${ue} ${m}`);const k=`${x.join(" ")}.`.replace(/\s+/g," ").trim(),v=($e,Hn,pn,Zn=!1)=>{const ot=Hn.map(mt=>(mt||"").trim()).filter(Boolean);if(!ot.length&&Zn)return"";const It=ot.length?ot:pn?[pn]:[];if(!It.length)return"";const Zt=It.map((mt,es)=>`${es+1}. ${mt}`.trim()).join(`
`);return`${$e}
${Zt}`.trim()},_=(f.timeline||[]).map($e=>{var es,Sa,rr,wa,Ho,Uo;if(!($e!=null&&$e.event)&&!($e!=null&&$e.date))return"";const Hn=(($e==null?void 0:$e.date)||"").toString().trim(),pn=Hn||" ",Zn=(($e==null?void 0:$e.actor)||"").toString().trim()||(((es=f.entities)==null?void 0:es.plaintiff)||"").toString().trim()||ee,ot=(($e==null?void 0:$e.location)||"").toString().trim()||((Uo=(wa=(rr=(Sa=f.entities)==null?void 0:Sa.institution)==null?void 0:rr.toString)==null?void 0:(Ho=wa.call(rr)).trim)==null?void 0:Uo.call(Ho))||"",It=(($e==null?void 0:$e.event)||"").toString().trim(),Zt=(($e==null?void 0:$e.result)||"").toString().trim(),mt=[];return mt.push(pn),mt.push(` ${Zn}`),It&&mt.push(` ${It}`),ot&&mt.push(` ${ot}`),Zt&&mt.push(` ${Zt}`),mt.join(" ").replace(/\s+/g," ").trim()}).filter(Boolean)||[],$=(f.facts||[]).filter(Boolean),B=_.length?_:$,oe=v(K==="DEMAND"?"  ,  :":"  ,  :",B,"    ."),Ee=[];(Dt=f.entities)!=null&&Dt.plaintiff&&Ee.push(String(f.entities.plaintiff).trim()),Array.isArray(f.defendants)&&Ee.push(...f.defendants.map(String).map($e=>$e.trim())),Array.isArray(f.providers)&&Ee.push(...f.providers.map(String).map($e=>$e.trim()));const be=Array.from(new Set(Ee.filter(Boolean))),ze=be.length?`      : ${be.join(", ")}.`:"",Xe=(Array.isArray(f.gaps)&&f.gaps||Array.isArray(f.missingDetails)&&f.missingDetails||[]).filter(Boolean).map($e=>String($e).trim()).filter(Boolean),it=Xe.length?Xe:["   ,        ."],st=v("  :",it),wt=(()=>{const $e=(f.injuries||[]).find(pn=>pn&&String(pn).trim())||(f.medicalFindings||[]).find(pn=>pn&&String(pn).trim());return $e?` ${K==="DEMAND"?"":""},         : ${String($e).trim()}.`:""})();return[k,oe,ze,st,wt].filter($e=>$e&&String($e).trim()).join(`

`).trim()},_o=()=>{Qt("Strategy",_v),O({msg:' " "  .',type:"success"})},Mi=(f,T)=>{var ue;const K=(ue=f.target.files)==null?void 0:ue[0];if(!K)return;if(!T.includes("Expenses")){f.target.value="";return}const ee=new FileReader;ee.onload=async d=>{var x;const m=((x=d.target)==null?void 0:x.result).split(",")[1];await Li(K.name,m,K.type)},ee.readAsDataURL(K),f.target.value=""},Ar=f=>{sr(null),ms(f),setTimeout(()=>{var T;(T=ps.current)==null||T.click()},0)},Oo=async f=>{var ee,ue,d;const T=(ee=f.target.files)==null?void 0:ee[0];if(!T||!lt){ms(null),f.target.value="";return}P(!0);const K=lt.section||lt.mode;An(K);try{const m=await _i(T),x=lt.mode==="SECTION"&&lt.section||Us;if(lt.domain==="dental"&&lt.mode==="SECTION"){try{const oe=await X0(m,T.type||"application/octet-stream"),Ee=((ue=oe.text)==null?void 0:ue.trim())??"";if(!oe.success||!Ee){const be=oe.reason==="INVALID_DOCUMENT"?Mp:Cr;O({msg:be,type:"info"})}else{const be=Ee,ze=lt.section||q,qe=e.content[ze]||"",Xe=qe?`${qe}

${be}`:be,it={content:{...e.content,[ze]:Xe},selectedSections:e.selectedSections.includes(ze)?e.selectedSections:[...e.selectedSections,ze]};if(lt.analysisType==="EXPERT"&&lt.section){const wt=!!qe.trim()?"MULTIPLE":"SINGLE";it.expertSummaryMode={...e.expertSummaryMode||{},[ze]:wt}}t(it),O({msg:"  ()    .",type:"success"})}}catch(oe){console.error("Dental opinion analysis failed",oe),O({msg:Cr,type:"info"})}finally{P(!1),An(null),ms(null),f.target.value=""}return}const v=x===q||x===te,_=xp(x),$={expertCountMode:lt.analysisType==="EXPERT"?((d=e.expertSummaryMode)==null?void 0:d[x])||"SINGLE":void 0,partyRole:aN(x)||void 0};(v||_)&&($.sectionKey=x,$.plaintiffName=e.plaintiffName||"",$.insuredName=e.insuredName||"",$.insurerName=e.insurerName||"",$.reportSubject=e.reportSubject||"");const B=await q0(m,T.type||"application/octet-stream",lt.analysisType||"CLAIM",$);if(B.success===!1){const oe=B.reason==="INVALID_DOCUMENT"?Mp:Cr;O({msg:oe,type:"info"});return}const Y=(B==null?void 0:B.analysis)||null;if(lt.mode==="SECTION"){const oe=((B==null?void 0:B.claimSummary)||"").trim()||Oi(Y,{analysisType:lt.analysisType,section:lt.section});if(!oe)O({msg:Cr,type:"info"});else{const Ee=lt.section||q,be=e.content[Ee]||"",ze=be?`${be}

${oe}`:oe,qe={content:{...e.content,[Ee]:ze},selectedSections:e.selectedSections.includes(Ee)?e.selectedSections:[...e.selectedSections,Ee]};if(lt.analysisType==="EXPERT"&&lt.section){const it=!!be.trim()?"MULTIPLE":"SINGLE";qe.expertSummaryMode={...e.expertSummaryMode||{},[Ee]:it}}Y&&(qe.complaintAnalysis=Y),t(qe),O({msg:"     .",type:"success"})}}else Y?(Lo(Y),lt.mode==="POLICY"&&t({policyFile:{id:`policy-${Date.now()}`,name:T.name,data:m,type:T.type}})):O({msg:Cr,type:"info"})}catch(m){console.error(m),O({msg:Cr,type:"info"})}finally{P(!1),An(null),ms(null),f.target.value=""}},Pi=()=>{const{policyPeriodStart:f,policyPeriodEnd:T,retroStart:K,retroEnd:ee}=e;if(!f&&!T&&!K&&!ee){O({msg:"    .  POLCY .",type:"info"});return}const ue=zh(e.content["Insurance Coverage"],f,T,K,ee);Qt("Insurance Coverage",ue),O({msg:"   .",type:"success"})},Fi=!!(e.policyPeriodStart||e.policyPeriodEnd||e.retroStart||e.retroEnd),Bi=async f=>{if(e.odakanitNo)try{const ee=await Ge.getLatestSheetForCase(e.odakanitNo);if(ee&&ee.lineItems&&ee.lineItems.length>0){const ue=Ge.buildCumulativeExpensesSnapshot(ee.sheet.id,new Date().toISOString());if(!ue)return;const{effectiveSheet:d,allLines:m,opts:x}=ue,{text:k}=Lh(d,m,x),{html:v}=si(d,m,x);if(Qt(f,k),ee.attachments&&ee.attachments.length){const $=e.invoiceFiles||[],B=Math.max(0,4-$.length);if(B>0){const Y=ee.attachments.slice(0,B).map((oe,Ee)=>{const[be,ze]=oe.fileKey.split(",");let qe=oe.mimeType||"application/octet-stream";if(be&&be.startsWith("data:")){const it=be.match(/^data:(.*?);base64$/);it&&it[1]&&(qe=it[1])}const Xe=ze||oe.fileKey;return{id:`fes-inv-${oe.id}-${Ee}`,name:oe.originalFileName,data:Xe,type:qe}});if(Y.length){const oe=[...$,...Y],Ee=oe.length>0,ze=Jt&&e.status==="WAITING_FOR_INVOICES"&&Ee?"TASK_ASSIGNED":e.status;t({invoiceFiles:oe,isWaitingForInvoices:!Ee,status:ze,expensesSheetId:ee.sheet.id,expensesSnapshotAt:ee.sheet.updatedAt||new Date().toISOString(),expensesHtml:v||e.expensesHtml})}}}O({msg:"Expenses Table was inserted into the EXPENSES section.",type:"success"});return}}catch(ee){Ku("Failed to load Expenses Table for report",ee)}const T=e.expenseWorksheet;if(!T||!T.rows||T.rows.length===0){O({msg:"    .",type:"info"});return}if(T.status!=="LOCKED"){O({msg:'       ".',type:"info"});return}const K=qi(T);Qt(f,K),O({msg:'   ".',type:"success"})},$i=()=>{u&&(u(),O({msg:"    .",type:"success"}))},Hi=async()=>{if(!Ce){Be(!0);try{const f=await eN(e.content||{},a.role),T=f.issues||[];Te(T);const K=f.runAt||new Date().toISOString();Ve(K),t({toneRiskLastRunAt:K}),ct(f.meta||null),T.length?O({msg:"     .",type:"info"}):O({msg:"   Tone & Risk .",type:"success"})}catch(f){console.error("Tone & Risk check failed",f),O({msg:" Tone & Risk        .",type:"error"})}finally{Be(!1)}}},Ui=()=>{Te([]),Ve(null),ct(null),se(null)},Wi=(f,T)=>{if(!f||!T)return!1;const K=/(\d{1,2}\/\d{1,2}\/\d{2,4}|\d+(?:\.\d+)?%?)/g,ee=[];let ue;for(;(ue=K.exec(f))!==null;)ue[0]&&ee.push(ue[0]);return ee.length?ee.some(d=>!T.includes(d)):!1},zi=f=>{var ue,d;if(!f.suggestion)return;const T=f.sectionKey,K=e.content[T]||"";if(!K||!f.excerpt||!K.includes(f.excerpt)){(ue=navigator.clipboard)==null||ue.writeText(f.suggestion).catch(()=>{}),O({msg:"    .   .",type:"info"});return}if(Wi(f.excerpt,f.suggestion)){(d=navigator.clipboard)==null||d.writeText(f.suggestion).catch(()=>{}),O({msg:"    /      .",type:"info"});return}se({sectionKey:T,prevText:K});const ee=K.replace(f.excerpt,f.suggestion);Qt(T,ee)},Vi=()=>{if(!X)return;const{sectionKey:f,prevText:T}=X;Qt(f,T),se(null),O({msg:"  .",type:"info"})},Ki=async()=>{if(!Ce){ye(!0);try{const f=await tN(e.content||{},a.role),T=f.issues||[];if(ae(T),ke(f.runAt||new Date().toISOString()),f.success===!1){O({msg:"    .    .",type:"info"});return}T.length?O({msg:"       .",type:"info"}):O({msg:"     .",type:"success"})}catch(f){console.error("Hebrew style review failed",f),O({msg:"    .    .",type:"info"})}finally{ye(!1)}}},Yi=(f,T)=>{if(Ce||V)return;const K=Ii(T.body),ee=e.content[f]||"";Qt(f,ee?`${ee}

${K}`:K),re(null);const ue=hv(a.id,T.id);Ze(ue)},ya=async f=>{try{await navigator.clipboard.writeText(f.body),O({msg:"  .",type:"info"})}catch{O({msg:"     ",type:"warning"})}},Na=f=>{var m;if(!f.suggestion)return;const T=f.sectionKey,K=e.content[T]||"",ee=f.excerpt;if(!(ee&&K.includes(ee))){(m=navigator.clipboard)==null||m.writeText(f.suggestion).catch(()=>{}),O({msg:"    .   .",type:"info"});return}const d=K.replace(ee,f.suggestion);Qt(T,d)},Ir=f=>Z.filter(T=>T.sectionKey===f&&T.isEnabled!==!1).sort((T,K)=>{const ee=T.label==="LLOYDS_RECOMMENDED"?0:1,ue=K.label==="LLOYDS_RECOMMENDED"?0:1;if(ee!==ue)return ee-ue;const d=T.usageCount||0;return(K.usageCount||0)-d}),Mo=f=>{if(a.role!=="ADMIN")return;const T=A.current[f],K=T==null?void 0:T.current;if(!K){O({msg:"     .",type:"error"});return}const ee=K.selectionStart??0,ue=K.selectionEnd??0;if(ee===ue){O({msg:"     -Best Practice.",type:"info"});return}const m=(e.content[f]||"").slice(ee,ue).trim();if(!m){O({msg:"    .",type:"info"});return}de({sectionKey:f,body:m})},Gi=async({title:f,label:T,tags:K,behavior:ee})=>{if(!Re)return;const ue=new Date().toISOString(),d={id:"",sectionKey:Re.sectionKey,title:f,body:Re.body,label:T,tags:K.length?K:void 0,isEnabled:!0,createdByUserId:a.id,createdAt:ue,updatedAt:ue,usageCount:0,lastUsedAt:null,behavior:ee};try{const m=await pp(d,a.role);ve(m),O({msg:"Best Practice  .",type:"success"})}catch(m){console.error("Failed to save best practice",m),O({msg:" -Best Practice .",type:"error"})}de(null)},ba=()=>{de(null)},Po=async(f,T)=>{if(Ce)return;const K=e.content[f]||"",ee=K?`${K}

${T.body}`:T.body;Qt(f,ee);try{const ue=await fp(T.id,"INSERT",a.role);ve(ue)}catch(ue){console.error("Failed to record best practice usage (insert)",ue)}},va=async f=>{var T;(T=navigator.clipboard)==null||T.writeText(f.body).catch(()=>{});try{const K=await fp(f.id,"COPY",a.role);ve(K)}catch(K){console.error("Failed to record best practice usage (copy)",K)}O({msg:"  .",type:"info"})},Tr=async(f,T)=>{const K=Z.find(ue=>ue.id===f);if(!K)return;const ee={...K,...T,updatedAt:new Date().toISOString()};try{const ue=await pp(ee,a.role);ve(ue)}catch(ue){console.error("Failed to update best practice",ue),O({msg:" -Best Practice .",type:"error"})}},Fo=async f=>{try{const T=await sN(f,a.role);ve(T)}catch(T){console.error("Failed to delete best practice",T),O({msg:" -Best Practice .",type:"error"})}},Bo=async(f,T)=>{try{const K=await rN(f,T,a.role);ve(K)}catch(K){console.error("Failed to toggle best practice enabled",K),O({msg:"  -Best Practice .",type:"error"})}},qi=f=>{const T=f.rows.filter(d=>d.type==="EXPENSE"),K=f.rows.filter(d=>d.type==="ADJUSTMENT"),ee=T.map(d=>` ${d.label}${d.serviceProvider?` (${d.serviceProvider})`:""}  ${d.amount.toLocaleString()}`),ue=K.map(d=>` ${d.label}  ${d.amount.toLocaleString()}`);return["     ","",":",ee.length?ee.join(`
`):"   ",""," / :",ue.length?ue.join(`
`):"  ","",`" : ${f.totals.totalExpenses.toLocaleString()}`,`" : ${f.totals.totalAdjustments.toLocaleString()}`,` : ${f.totals.totalBalance.toLocaleString()}`].join(`
`)};return n.jsxs(n.Fragment,{children:[n.jsx("input",{type:"file",ref:ps,className:"hidden",accept:".pdf,.doc,.docx,.txt,.jpg,.jpeg,.png,application/pdf,application/msword,application/vnd.openxmlformats-officedocument.wordprocessingml.document,text/plain,image/*",onChange:Oo}),n.jsxs("div",{className:"space-y-6",children:[n.jsxs("div",{className:"flex flex-wrap justify-between items-center gap-2",children:[n.jsxs("button",{onClick:s,className:"flex items-center text-sm text-textMuted bg-navySecondary px-3 py-1.5 rounded-full hover:bg-borderDark",children:[n.jsx(Jl,{className:"w-4 h-4 mr-1"}),"   1"]}),n.jsxs("div",{className:"flex items-center gap-3",children:[a.role==="ADMIN"&&(c||i)&&n.jsxs("div",{className:"flex flex-col items-end gap-1",children:[c&&n.jsx("button",{onClick:c,disabled:!Rt||h,className:`flex items-center text-sm px-3 py-1.5 rounded-full transition ${Rt&&!h?"text-indigo-700 bg-indigo-50 hover:bg-indigo-100":"text-slate-400 bg-slate-100 cursor-not-allowed"}`,children:h?n.jsxs(n.Fragment,{children:[n.jsx(Mt,{className:"w-4 h-4 mr-1 animate-spin"})," ..."]}):n.jsxs(n.Fragment,{children:[n.jsx(L0,{className:"w-4 h-4 mr-1"})," Auto-Translate"]})}),i&&n.jsx("button",{onClick:i,disabled:!e.isTranslated||!xa||!!S,className:`flex items-center text-sm px-3 py-1.5 rounded-full transition ${e.isTranslated&&xa&&!S?"text-emerald-700 bg-emerald-50 hover:bg-emerald-100":"text-slate-400 bg-slate-100 cursor-not-allowed"}`,children:S?n.jsxs(n.Fragment,{children:[n.jsx(Mt,{className:"w-4 h-4 mr-1 animate-spin"})," Improving..."]}):n.jsx(n.Fragment,{children:"Improve English"})}),c&&!Rt&&!h&&n.jsx("p",{className:"text-[11px] text-textMuted",children:"      ."}),e.translationStale&&n.jsx("p",{className:"text-[11px] text-amber-700 max-w-xs text-right",children:" :      ,      ."}),h&&n.jsx("p",{className:"text-[11px] text-indigo-600",children:"      ."})]}),a.role==="ADMIN"&&Xt&&n.jsxs("div",{className:"flex flex-col items-end gap-1 text-[11px] text-textLight",children:[n.jsx("span",{className:"font-semibold",children:"  "}),n.jsxs("div",{className:"inline-flex rounded-full border border-borderDark overflow-hidden bg-panel",children:[n.jsx("button",{type:"button",onClick:()=>Rs("DUAL"),className:`px-3 py-1 ${on==="DUAL"?"bg-slate-800 text-white":"bg-panel text-textLight hover:bg-slate-100"} text-[11px]`,children:" + "}),n.jsx("button",{type:"button",onClick:()=>Rs("ENGLISH_ONLY"),className:`px-3 py-1 border-r border-borderDark ${on==="ENGLISH_ONLY"?"bg-slate-800 text-white":"bg-panel text-textLight hover:bg-slate-100"} text-[11px]`,children:" "})]})]}),a.role==="ADMIN"&&u&&n.jsxs("button",{onClick:$i,className:"flex items-center text-sm text-purple-700 bg-purple-50 px-3 py-1.5 rounded-full hover:bg-purple-100",children:[n.jsx(Lu,{className:"w-4 h-4 mr-1"})," Format Text"]}),n.jsxs("button",{onClick:o,className:"flex items-center text-sm text-lpBlue bg-blue-50 px-3 py-1.5 rounded-full hover:bg-blue-100",children:[n.jsx(Du,{className:"w-4 h-4 mr-1"}),"  "]})]})]}),j&&n.jsxs("div",{className:"flex items-center justify-end gap-2 text-[11px] text-indigo-600",children:[n.jsx(Mt,{className:"w-3 h-3 animate-spin"}),n.jsx("span",{children:"   ,     "})]}),D&&n.jsx(bv,{message:D.msg,type:D.type,onClose:()=>O(null)}),n.jsxs("div",{className:"flex items-center justify-between gap-2",children:[n.jsx("h2",{className:"text-2xl font-bold text-lpBlue font-serif",children:"2. Draft Content"}),!Ce&&M&&n.jsxs("button",{type:"button",onClick:()=>M(),className:"flex items-center text-[11px] px-3 py-1.5 rounded-full bg-indigo-50 text-indigo-800 border border-indigo-200 hover:bg-indigo-100",title:"         (  ).",children:[n.jsx(oa,{className:"w-3 h-3 ml-1"})," "]})]}),!Ce&&n.jsxs("div",{className:"mb-3 mt-1 space-y-1",children:[n.jsxs("div",{className:"flex items-center justify-between gap-2",children:[n.jsx("div",{className:"flex items-center gap-2",children:n.jsx("span",{className:"text-[11px] font-semibold text-textMuted",children:"  "})}),Ye&&n.jsxs("div",{className:"text-[11px] text-textMuted",children:[" Tone & Risk :"," ",new Date(Ye).toLocaleString("he-IL",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"})]})]}),n.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[n.jsx("button",{type:"button",onClick:Ki,disabled:ne,title:"        .        .",className:`flex items-center text-sm font-semibold px-4 py-2 rounded-lg border ${ne?"bg-slate-100 text-slate-400 border-borderDark cursor-not-allowed":"bg-blue-500/20 text-blue-200 border-blue-400/60 hover:bg-blue-500/30"}`,children:ne?n.jsxs(n.Fragment,{children:[n.jsx(Mt,{className:"w-4 h-4 mr-1.5 animate-spin"}),"   ..."]}):n.jsx(n.Fragment,{children:"  ( )"})}),I.length>0&&n.jsxs("button",{type:"button",onClick:()=>{const f=document.getElementById("hebrew-style-panel");f&&f.scrollIntoView({behavior:"smooth",block:"start"})},className:"inline-flex items-center text-xs font-medium px-2.5 py-1 rounded-full bg-blue-500/20 text-blue-200 border border-blue-400/60 hover:bg-blue-500/30",children:[" ",I.length>1&&` (${I.length})`]}),n.jsx("button",{type:"button",onClick:Hi,disabled:ge,title:"         .        .",className:`flex items-center text-sm font-semibold px-4 py-2 rounded-lg border ${ge?"bg-slate-100 text-slate-400 border-borderDark cursor-not-allowed":"bg-amber-500/20 text-amber-200 border-amber-400/60 hover:bg-amber-500/30"}`,children:ge?n.jsxs(n.Fragment,{children:[n.jsx(Mt,{className:"w-4 h-4 mr-1.5 animate-spin"}),"  Tone & Risk..."]}):n.jsx(n.Fragment,{children:" Tone & Risk ()"})}),fe.length>0&&n.jsx("button",{type:"button",onClick:Ui,className:"text-[11px] text-textMuted hover:text-textLight underline",children:"  Tone & Risk"})]}),n.jsxs("div",{className:"flex flex-wrap items-center gap-4 text-[11px] text-textMuted",children:[Pe&&!I.length&&!ne&&n.jsx("span",{children:"  ."}),Ye&&!fe.length&&!ge&&n.jsx("span",{children:"  Tone & Risk."})]})]}),!Ce&&fe.length>0&&n.jsxs("div",{id:"tone-risk-panel",className:"mb-4 border border-amber-200 bg-amber-50 rounded-md p-3 text-xs space-y-2",children:[n.jsxs("div",{className:"flex items-center justify-between gap-2 mb-1",children:[n.jsxs("div",{className:"font-semibold text-amber-900",children:[" ",fe.length,"  Tone & Risk"]}),X&&n.jsx("button",{type:"button",onClick:Vi,className:"text-[11px] text-textMuted hover:text-textLight underline",children:"  "})]}),He&&n.jsxs("div",{className:"text-[11px] text-textMuted",children:[" ",He.sectionsSent,"  |  : ",He.charsBefore," |  : ",He.charsAfter,He.truncatedSections>0&&n.jsxs("span",{className:"ml-2 text-amber-700",children:["      (",He.truncatedSections,")"]})]}),n.jsx("div",{className:"space-y-2 max-h-60 overflow-y-auto",children:fe.map(f=>n.jsxs("div",{className:"bg-panel border border-amber-200 rounded px-2 py-2 space-y-1",children:[n.jsx("div",{className:"flex items-center justify-between gap-2",children:n.jsxs("div",{className:"flex items-center gap-1",children:[n.jsx("span",{className:"inline-flex items-center rounded-full px-2 py-0.5 text-[10px] font-semibold bg-slate-100 text-textLight",children:f.sectionKey||"Unknown section"}),n.jsx("span",{className:`inline-flex items-center rounded-full px-2 py-0.5 text-[10px] font-semibold ${f.severity==="CRITICAL"?"bg-red-100 text-red-700":f.severity==="WARNING"?"bg-amber-100 text-amber-700":"bg-slate-100 text-textMuted"}`,children:f.severity}),n.jsx("span",{className:"inline-flex items-center rounded-full px-2 py-0.5 text-[10px] bg-indigo-50 text-indigo-700 font-mono",children:f.kind})]})}),n.jsxs("div",{className:"text-[11px] text-textLight",children:[n.jsx("span",{className:"font-semibold",children:":"})," ",n.jsxs("span",{className:"italic",children:['"',f.excerpt,'"']})]}),n.jsxs("div",{className:"text-[11px] text-textLight",children:[n.jsx("span",{className:"font-semibold",children:":"})," ",f.message]}),f.suggestion&&n.jsxs("div",{className:"text-[11px] text-textLight",children:[n.jsx("span",{className:"font-semibold",children:" :"})," ",n.jsx("span",{className:"whitespace-pre-wrap",children:f.suggestion})]}),n.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[f.suggestion&&n.jsxs(n.Fragment,{children:[n.jsx("button",{type:"button",onClick:()=>{var T;return(T=navigator.clipboard)==null?void 0:T.writeText(f.suggestion||"").catch(()=>{})},className:"px-2 py-0.5 rounded border border-borderDark text-[11px] text-textLight hover:bg-slate-100",children:"  "}),n.jsx("button",{type:"button",onClick:()=>zi(f),className:"px-2 py-0.5 rounded border border-emerald-300 text-[11px] text-emerald-700 hover:bg-emerald-50",children:" "})]}),n.jsx("button",{type:"button",onClick:()=>ae(T=>T.filter(K=>K.id!==f.id)),className:"px-2 py-0.5 rounded border border-borderDark text-[11px] text-textMuted hover:bg-slate-100 ml-auto",children:""})]})]},f.id))})]}),!Ce&&I.length>0&&n.jsxs("div",{id:"hebrew-style-panel",className:"mb-4 border border-blue-200 bg-blue-50 rounded-md p-3 text-xs space-y-2",children:[n.jsxs("div",{className:"flex items-center justify-between gap-2 mb-1",children:[n.jsxs("div",{className:"font-semibold text-blue-900",children:[" ",I.length,"   "]}),Pe&&n.jsxs("div",{className:"text-[11px] text-textMuted",children:[" :"," ",new Date(Pe).toLocaleString("he-IL",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"})]})]}),n.jsx("div",{className:"space-y-2 max-h-60 overflow-y-auto",children:I.map(f=>{const T=e.content[f.sectionKey]||"",K=!!f.suggestion&&!!f.excerpt&&T.includes(f.excerpt);return n.jsxs("div",{className:"bg-panel border border-blue-200 rounded px-2 py-2 space-y-1",children:[n.jsx("div",{className:"flex items-center justify-between gap-2",children:n.jsxs("div",{className:"flex items-center gap-1",children:[n.jsx("span",{className:"inline-flex items-center rounded-full px-2 py-0.5 text-[10px] font-semibold bg-slate-100 text-textLight",children:f.sectionKey||"Unknown section"}),n.jsx("span",{className:`inline-flex items-center rounded-full px-2 py-0.5 text-[10px] font-semibold ${f.severity==="CRITICAL"?"bg-red-100 text-red-700":f.severity==="WARNING"?"bg-amber-100 text-amber-700":"bg-slate-100 text-textMuted"}`,children:f.severity}),n.jsx("span",{className:"inline-flex items-center rounded-full px-2 py-0.5 text-[10px] bg-blue-50 text-blue-700 font-mono",children:f.category})]})}),n.jsxs("div",{className:"text-[11px] text-textLight",children:[n.jsx("span",{className:"font-semibold",children:":"})," ",n.jsxs("span",{className:"italic",children:['"',f.excerpt,'"']})]}),n.jsxs("div",{className:"text-[11px] text-textLight",children:[n.jsx("span",{className:"font-semibold",children:":"})," ",f.message]}),f.suggestion&&n.jsxs("div",{className:"text-[11px] text-textLight",children:[n.jsx("span",{className:"font-semibold",children:" :"})," ",n.jsx("span",{className:"whitespace-pre-wrap",children:f.suggestion})]}),f.suggestion&&n.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[n.jsx("button",{type:"button",onClick:()=>{var ee;return(ee=navigator.clipboard)==null?void 0:ee.writeText(f.suggestion||"").catch(()=>{})},className:"px-2 py-0.5 rounded border border-borderDark text-[11px] text-textLight hover:bg-slate-100",children:" "}),K&&n.jsx("button",{type:"button",onClick:()=>Na(f),className:"px-2 py-0.5 rounded border border-emerald-300 text-[11px] text-emerald-700 hover:bg-emerald-50",children:" "})]})]},f.id)})})]}),Ce&&n.jsxs("div",{className:"bg-orange-100 border-l-4 border-orange-500 p-4 text-orange-800",children:[n.jsxs("p",{className:"font-bold flex items-center",children:[n.jsx(F0,{className:"w-5 h-5 mr-2"})," Restricted Access Mode"]}),n.jsxs("p",{className:"text-sm",children:["You are logged in as ",a.role,". You can only modify the Invoice Attachments in the Expenses section."]})]}),e.financeInstructions&&n.jsx("div",{className:"bg-red-50 border-l-4 border-red-600 p-4 shadow-md rounded-r-lg animate-pulse-slow",children:n.jsxs("div",{className:"flex items-start",children:[n.jsx("div",{className:"flex-shrink-0",children:n.jsx(qa,{className:"h-5 w-5 text-red-600"})}),n.jsxs("div",{className:"ml-3 w-full",children:[n.jsx("h3",{className:"text-sm font-bold text-red-800",children:"Instruction from Finance"}),n.jsx("div",{className:"mt-2 text-sm text-red-700 whitespace-pre-wrap",children:e.financeInstructions}),e.expensesSourceFile&&n.jsxs("div",{className:"mt-4 pt-2 border-t border-red-200",children:[n.jsx("p",{className:"text-xs font-bold text-red-800 mb-1",children:"Attached Expenses Source File (Word/Excel):"}),n.jsxs("div",{className:"flex items-center bg-panel p-2 rounded border border-red-200 max-w-md",children:[n.jsx(go,{className:"w-4 h-4 text-blue-600 mr-2"}),n.jsx("span",{className:"text-sm text-textLight flex-1",children:e.expensesSourceFile.name}),n.jsx("a",{href:`data:${e.expensesSourceFile.type};base64,${e.expensesSourceFile.data}`,download:e.expensesSourceFile.name,className:"text-xs bg-blue-100 text-blue-700 px-2 py-1 rounded hover:bg-blue-200 font-bold",children:"Download"})]})]})]})]})}),rt&&n.jsxs("div",{className:"bg-amber-50 border-l-4 border-amber-500 p-4 shadow rounded-r-lg flex gap-3 items-start",children:[n.jsx(qa,{className:"w-5 h-5 text-amber-600 mt-1"}),n.jsxs("div",{children:[n.jsx("p",{className:"font-bold text-amber-900",children:"    "}),n.jsx("p",{className:"text-sm text-amber-800",children:"  /   .              ."})]})]}),n.jsx(cN,{report:e,currentUser:a,onSubmitToAdmin:()=>p&&p(),onApproveHebrew:()=>y&&y(),onRequestChanges:f=>b&&b(f),onMarkIssueDone:f=>w&&w(f),onAddExternalFeedbackIssues:(f,T)=>R&&R(f,T),onReopenHebrewDueToExternalFeedback:()=>E&&E()}),n.jsx("div",{className:"space-y-8",children:e.selectedSections.map(f=>{var d,m,x,k;const T=Cd(f,(d=e.expertSummaryMode)==null?void 0:d[f]),K=/expert/i.test(T),ee=fe.filter(v=>v.sectionKey===f).length,ue=I.filter(v=>v.sectionKey===f).length;return n.jsxs("div",{className:`bg-panel p-6 rounded-lg shadow-sm border transition-all ${Ce&&!f.includes("Expenses")?"opacity-60 pointer-events-none border-gray-100":"border-borderDark"}`,onClick:v=>{if(!H||typeof f!="string"||!f.trim())return;const _=v.target;!_||_.closest('button, a, input, textarea, select, svg, [role="button"]')||H(f)},children:[n.jsxs("div",{className:"flex justify-between items-center mb-3 pb-3 border-b border-gold/30",children:[n.jsxs("div",{className:"flex flex-col gap-1",children:[n.jsx("h3",{className:"font-bold text-xl text-gold uppercase tracking-wider border-r-2 border-gold/50 pr-2",children:T}),f.includes("Expenses")&&e.expensesSnapshotAt&&n.jsxs("p",{className:"text-[11px] text-textMuted",children:["Based on the latest Expenses Table as of"," ",new Date(e.expensesSnapshotAt).toLocaleString("en-GB",{day:"2-digit",month:"short",year:"numeric",hour:"2-digit",minute:"2-digit"}),"."]}),!f.includes("Expenses")&&(ue>0||ee>0)&&n.jsxs("div",{className:"flex flex-wrap gap-1 text-[10px]",children:[ue>0&&n.jsxs("button",{type:"button",onClick:()=>{const v=document.getElementById("hebrew-style-panel");v&&v.scrollIntoView({behavior:"smooth",block:"start"})},className:"inline-flex items-center rounded-full px-2 py-0.5 bg-blue-50 text-blue-800 border border-blue-200 hover:bg-blue-100",children:[" ",ue>1&&` (${ue})`]}),ee>0&&n.jsxs("button",{type:"button",onClick:()=>{const v=document.getElementById("tone-risk-panel");v&&v.scrollIntoView({behavior:"smooth",block:"start"})},className:"inline-flex items-center rounded-full px-2 py-0.5 bg-amber-50 text-amber-800 border border-amber-200 hover:bg-amber-100",children:[" Tone & Risk",ee>1&&` (${ee})`]})]})]}),!Ce&&n.jsxs("div",{className:"flex items-center gap-2",children:[!f.includes("Expenses")&&n.jsx("button",{className:"inline-flex items-center px-2.5 py-2 rounded-lg border border-borderDark hover:border-gold/50 hover:bg-gold/10 text-textMuted hover:text-goldLight transition",disabled:j,onClick:()=>{Ar({mode:"SECTION",section:f,analysisType:Ei(f)})},title:"   ",children:Jn===f?n.jsx(Mt,{className:"w-4 h-4 animate-spin"}):n.jsx(M0,{className:"w-4 h-4"})}),K&&n.jsx("button",{className:"inline-flex items-center px-2.5 py-2 rounded-lg border border-borderDark hover:border-gold/50 hover:bg-gold/10 text-textMuted hover:text-goldLight transition",disabled:j,onClick:()=>{Ar({mode:"SECTION",section:f,analysisType:"EXPERT",domain:"dental"})},title:"     ",children:Jn===f&&(lt==null?void 0:lt.domain)==="dental"?n.jsx(Mt,{className:"w-4 h-4 animate-spin"}):n.jsx("span",{className:"text-lg leading-none",children:""})}),f.includes("Expenses")&&Cs&&n.jsx("button",{onClick:()=>Bi(f),className:"p-1.5 hover:bg-green-50 rounded text-textMuted hover:text-green-600",title:"   ",children:n.jsx(uh,{className:"w-4 h-4"})}),!f.includes("Expenses")&&n.jsxs(n.Fragment,{children:[f==="Strategy"&&!Ce&&n.jsx("button",{onClick:_o,className:"px-3 py-1 text-xs font-semibold text-blue-700 bg-blue-50 border border-blue-200 rounded-full hover:bg-blue-100",children:" "}),n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsxs("button",{onClick:()=>Di(f),className:"inline-flex items-center px-4 py-2 rounded-lg text-sm font-semibold text-white bg-purple-600 hover:bg-purple-500 border border-purple-500/50 transition",title:"      ,     .     .",children:[wr===f?n.jsx(Mt,{className:"w-4 h-4 mr-1.5 animate-spin"}):n.jsx(B0,{className:"w-4 h-4 mr-1.5"}),"  "]}),n.jsxs("div",{className:"flex rounded-full border border-purple-200 overflow-hidden text-[10px] bg-panel",title:"    ",children:[n.jsx("button",{type:"button",onClick:()=>Qe("SAFE_POLISH"),className:`px-2 py-0.5 ${De==="SAFE_POLISH"?"bg-purple-100 text-purple-800":"text-purple-500 hover:bg-purple-50"}`,children:" "}),n.jsx("button",{type:"button",onClick:()=>Qe("REWRITE"),className:`px-2 py-0.5 border-l border-purple-100 ${De==="REWRITE"?"bg-purple-100 text-purple-800":"text-purple-500 hover:bg-purple-50"}`,children:" "})]})]}),f==="Insurance Coverage"&&Fi&&n.jsx("button",{onClick:Pi,className:"p-1.5 hover:bg-blue-50 rounded text-textMuted hover:text-blue-600",title:"Auto-fill policy data",children:n.jsx(W0,{className:"w-4 h-4"})})]}),Ke&&Ke.sectionKey===f&&Ke.changedWords>0&&Ke.expiresAt>Date.now()&&n.jsxs("div",{className:"mt-1 text-[11px] text-textMuted bg-purple-50/40 border border-purple-100 rounded px-2 py-1",children:[n.jsxs("div",{className:"flex items-center justify-between gap-2",children:[n.jsxs("span",{children:["  ",Ke.changedWords,"   ."]}),n.jsx("button",{type:"button",className:"underline text-purple-700 hover:text-purple-900",onClick:()=>Fe(v=>v&&v.sectionKey===f?{...v,open:!v.open}:v),children:Ke.open?" ":" "})]}),Ke.open&&n.jsx("div",{className:"mt-1 text-[11px] text-textLight whitespace-pre-wrap leading-relaxed",children:Ke.tokens.map((v,_)=>v.type==="same"?` ${v.text}`:v.type==="add"?` [+${v.text}+]`:` [-${v.text}-]`)})]}),Er(f).length>0&&n.jsxs("button",{onClick:()=>Ri(f),className:"flex items-center gap-1 px-2 py-1 rounded text-xs font-bold bg-navySecondary text-textMuted border hover:bg-yellow-50",children:[n.jsx(oa,{className:"w-3 h-3"})," Ideas"]}),a.role==="ADMIN"&&n.jsxs("div",{className:"flex items-center gap-1",children:[n.jsx("button",{type:"button",onClick:()=>Ci(f),className:"px-2 py-1 rounded text-[11px] border border-dashed border-borderDark text-textMuted hover:bg-slate-50",children:"Save selection as template"}),n.jsx("button",{type:"button",onClick:()=>Mo(f),className:"px-2 py-1 rounded text-[11px] border border-dashed border-emerald-300 text-emerald-700 hover:bg-emerald-50",children:"Save selection as Best Practice"})]})]})]}),f==="Update"&&ji(e)&&n.jsxs("div",{className:"mb-3 text-xs text-textLight",children:[n.jsx("span",{className:"block mb-1 font-semibold",children:"    ()"}),n.jsxs("div",{className:"flex flex-wrap gap-2",children:[n.jsx("button",{type:"button",className:"px-3 py-1 rounded-full border border-borderDark bg-navySecondary hover:bg-navySecondary text-[11px] font-semibold text-textLight",onClick:()=>{const v=Pp.SOC,_=e.content.Update||"",$=v.split(`
`)[0];if(_.trimStart().startsWith($))return;const Y=_.trim().length>0?`${v}

${_.trimStart()}`:v;Qt("Update",Y)},children:"  (Statement of Claim)"}),n.jsx("button",{type:"button",className:"px-3 py-1 rounded-full border border-borderDark bg-navySecondary hover:bg-navySecondary text-[11px] font-semibold text-textLight",onClick:()=>{const v=Pp.LOD,_=e.content.Update||"",$=v.split(`
`)[0];if(_.trimStart().startsWith($))return;const Y=_.trim().length>0?`${v}

${_.trimStart()}`:v;Qt("Update",Y)},children:"  (Letter of Demand)"})]})]}),G===f&&!Ce&&n.jsxs("div",{className:"mb-4 p-3 bg-yellow-50 rounded border border-yellow-200",children:[n.jsxs("div",{className:"flex items-center justify-between gap-2 mb-2",children:[n.jsxs("div",{className:"flex items-center gap-2 text-[11px]",children:[n.jsx("button",{type:"button",className:`px-2 py-1 rounded-full border ${xe==="TEMPLATES"?"bg-panel border-yellow-400 text-yellow-800 font-semibold":"bg-yellow-100/60 border-yellow-200 text-yellow-700"}`,onClick:()=>Se("TEMPLATES"),children:"Templates"}),n.jsx("button",{type:"button",className:`px-2 py-1 rounded-full border ${xe==="BEST_PRACTICES"?"bg-panel border-emerald-400 text-emerald-800 font-semibold":"bg-emerald-50/70 border-emerald-200 text-emerald-700"}`,onClick:()=>Se("BEST_PRACTICES"),children:"Best Practices"}),n.jsx("button",{type:"button",className:`px-2 py-1 rounded-full border ${xe==="MY_SNIPPETS"?"bg-panel border-sky-400 text-sky-800 font-semibold":"bg-sky-50/70 border-sky-200 text-sky-700"}`,onClick:()=>Se("MY_SNIPPETS"),children:" "})]}),xe==="TEMPLATES"&&n.jsx("input",{type:"text",className:"flex-1 border border-yellow-300 rounded px-2 py-1 text-xs",placeholder:"Search templates",value:C,onChange:v=>L(v.target.value)}),xe==="BEST_PRACTICES"&&n.jsx("input",{type:"text",className:"flex-1 border border-emerald-300 rounded px-2 py-1 text-xs",placeholder:"Search best practices",value:Me,onChange:v=>_e(v.target.value)}),xe==="MY_SNIPPETS"&&n.jsx("input",{type:"text",className:"flex-1 border border-sky-300 rounded px-2 py-1 text-xs",placeholder:"  ",value:We,onChange:v=>tt(v.target.value)}),a.role==="ADMIN"&&xe==="TEMPLATES"&&n.jsx("button",{type:"button",onClick:()=>{le(f),me(!0)},className:"text-[11px] px-2 py-1 rounded bg-panel text-textLight border border-borderDark hover:bg-slate-50",children:"Manage templates"}),a.role==="ADMIN"&&xe==="BEST_PRACTICES"&&n.jsx("button",{type:"button",onClick:()=>{he(f),U(!0)},className:"text-[11px] px-2 py-1 rounded bg-panel text-textLight border border-borderDark hover:bg-slate-50",children:"Manage best practices"}),xe==="MY_SNIPPETS"&&n.jsx("button",{type:"button",onClick:()=>{At(!0),nt(null)},className:"text-[11px] px-2 py-1 rounded bg-panel text-textLight border border-borderDark hover:bg-slate-50",children:" "})]}),n.jsx("div",{className:"grid grid-cols-1 gap-2 max-h-60 overflow-y-auto text-xs",children:xe==="TEMPLATES"?(()=>{const v=Er(f),_=C.trim().toLowerCase(),$=_?v.filter(B=>B.title.toLowerCase().includes(_)||B.body.toLowerCase().includes(_)):v;return $.length?$.map(B=>{const Y=B.body.length>160?`${B.body.slice(0,160)}`:B.body;return n.jsxs("div",{className:"flex items-center gap-2 bg-panel border border-yellow-100 rounded px-2 py-2 hover:bg-yellow-100 cursor-pointer",onClick:()=>fs(f,B),children:[n.jsxs("div",{className:"flex-1 min-w-0 text-right",children:[n.jsx("div",{className:"font-semibold text-textLight truncate",children:B.title}),n.jsx("div",{className:"text-[11px] text-textMuted max-h-10 overflow-hidden whitespace-pre-wrap",children:Y})]}),n.jsx("button",{type:"button",className:"text-[11px] px-2 py-1 rounded bg-yellow-50 text-yellow-800 border border-yellow-200 hover:bg-yellow-100",children:"Insert"})]},B.id)}):n.jsx("p",{className:"text-[11px] text-textMuted",children:"No templates found for this section."})})():xe==="BEST_PRACTICES"?(()=>{const v=Ir(f),_=Me.trim().toLowerCase(),$=_?v.filter(B=>{const Y=(B.tags||[]).join(" ").toLowerCase();return B.title.toLowerCase().includes(_)||B.body.toLowerCase().includes(_)||Y.includes(_)}):v;return $.length?$.map(B=>{const Y=B.body.length>160?`${B.body.slice(0,160)}`:B.body,oe=B.behavior!=="COPY_ONLY";return n.jsxs("div",{className:"flex items-center gap-2 bg-panel border border-emerald-100 rounded px-2 py-2 hover:bg-emerald-50 cursor-default",children:[n.jsxs("div",{className:"flex-1 min-w-0 text-right",children:[n.jsxs("div",{className:"flex flex-wrap items-center justify-end gap-1 mb-0.5",children:[n.jsx("span",{className:"font-semibold text-textLight truncate",children:B.title}),n.jsx("span",{className:`inline-flex items-center rounded-full px-2 py-0.5 text-[9px] font-semibold ${B.label==="LLOYDS_RECOMMENDED"?"bg-purple-100 text-purple-700":"bg-emerald-100 text-emerald-700"}`,children:B.label==="LLOYDS_RECOMMENDED"?"Lloyds recommended":"Best practice"}),B.tags&&B.tags.length>0&&n.jsx("span",{className:"inline-flex items-center rounded-full px-2 py-0.5 text-[9px] bg-slate-100 text-textLight",children:B.tags.join(", ")})]}),n.jsx("div",{className:"text-[11px] text-textMuted max-h-10 overflow-hidden whitespace-pre-wrap",children:Y})]}),n.jsxs("div",{className:"flex flex-col items-stretch gap-1",children:[oe&&n.jsx("button",{type:"button",onClick:()=>Po(f,B),className:"text-[11px] px-2 py-0.5 rounded bg-emerald-50 text-emerald-800 border border-emerald-200 hover:bg-emerald-100",children:"Insert"}),n.jsx("button",{type:"button",onClick:()=>va(B),className:"text-[11px] px-2 py-0.5 rounded bg-slate-50 text-textLight border border-borderDark hover:bg-slate-100",children:"Copy"})]})]},B.id)}):n.jsx("p",{className:"text-[11px] text-textMuted",children:"No best practices found for this section."})})():(()=>{const v=We.trim().toLowerCase(),$=je.filter(B=>!B.sectionKey||B.sectionKey===f).filter(B=>{if(!v)return!0;const Y=(B.tags||[]).join(" ").toLowerCase();return B.title.toLowerCase().includes(v)||B.body.toLowerCase().includes(v)||Y.includes(v)}).slice().sort((B,Y)=>{const oe=B.lastUsedAt||"",Ee=Y.lastUsedAt||"";if(oe&&Ee&&oe!==Ee)return Ee.localeCompare(oe);if(oe&&!Ee)return-1;if(!oe&&Ee)return 1;const be=B.updatedAt||B.createdAt;return(Y.updatedAt||Y.createdAt).localeCompare(be)});return $.length?$.map(B=>{const Y=B.body.length>160?`${B.body.slice(0,160)}`:B.body;return n.jsxs("div",{className:"flex items-center gap-2 bg-panel border border-sky-100 rounded px-2 py-2 hover:bg-sky-50 cursor-default",children:[n.jsxs("div",{className:"flex-1 min-w-0 text-right",children:[n.jsxs("div",{className:"flex flex-wrap items-center justify-end gap-1 mb-0.5",children:[n.jsx("span",{className:"font-semibold text-textLight truncate",children:B.title}),B.tags&&B.tags.length>0&&n.jsx("span",{className:"inline-flex items-center rounded-full px-2 py-0.5 text-[9px] bg-slate-100 text-textLight",children:B.tags.join(", ")})]}),n.jsx("div",{className:"text-[11px] text-textMuted max-h-10 overflow-hidden whitespace-pre-wrap",children:Y})]}),n.jsxs("div",{className:"flex flex-col items-stretch gap-1",children:[n.jsx("button",{type:"button",onClick:()=>Yi(f,B),className:"text-[11px] px-2 py-0.5 rounded bg-sky-50 text-sky-800 border border-sky-200 hover:bg-sky-100 disabled:opacity-50 disabled:cursor-not-allowed",disabled:V,title:V?"       .":void 0,children:""}),n.jsx("button",{type:"button",onClick:()=>ya(B),className:"text-[11px] px-2 py-0.5 rounded bg-slate-50 text-textLight border border-borderDark hover:bg-slate-100",children:""}),n.jsx("button",{type:"button",onClick:()=>{At(!0),nt({id:B.id,title:B.title,sectionKey:B.sectionKey||"",tagsInput:(B.tags||[]).join(", "),body:B.body})},className:"text-[11px] px-2 py-0.5 rounded bg-slate-50 text-textLight border border-borderDark hover:bg-slate-100",children:""}),n.jsx("button",{type:"button",onClick:()=>{if(window.confirm("    ?")){const oe=Op(a.id,B.id);Ze(oe)}},className:"text-[11px] px-2 py-0.5 rounded bg-red-50 text-red-700 border border-red-200 hover:bg-red-100",children:""})]})]},B.id)}):n.jsx("p",{className:"text-[11px] text-textMuted",children:"   ."})})()})]}),f.includes("Expenses")?n.jsxs("div",{className:"space-y-4",children:[Jt&&n.jsxs("div",{className:"bg-blue-50 p-4 rounded border border-blue-100 mb-4",children:[n.jsx("h4",{className:"text-sm font-bold text-blue-800 mb-2",children:"Add Expense Item"}),n.jsxs("div",{className:"flex gap-2 flex-wrap",children:[n.jsx("input",{type:"date",className:"border p-2 rounded text-sm",value:Ne.date,onChange:v=>Oe({...Ne,date:v.target.value})}),n.jsx("input",{type:"text",className:"border p-2 rounded text-sm flex-1",placeholder:"Description (e.g. Court Fee)",value:Ne.description,onChange:v=>Oe({...Ne,description:v.target.value})}),n.jsx("input",{type:"number",className:"border p-2 rounded text-sm w-24",placeholder:"Amount",value:Ne.amount,onChange:v=>Oe({...Ne,amount:Number(v.target.value)})}),n.jsx("button",{onClick:ki,className:"bg-blue-600 text-white px-4 py-2 rounded text-sm font-bold hover:bg-blue-700",children:"Add"})]})]}),Jt&&n.jsxs("div",{className:"flex items-center justify-between mb-2",children:[n.jsxs("div",{className:"relative text-xs",children:[n.jsxs("button",{className:"flex items-center text-indigo-600 bg-panel px-2 py-1 rounded hover:bg-indigo-50",onClick:()=>sr(In===f?null:f),children:[n.jsx(yo,{className:"w-3 h-3 mr-1"})," Auto-extract"]}),In===f&&n.jsxs("div",{className:"absolute right-0 mt-2 w-44 bg-panel border border-borderDark rounded-lg shadow-lg z-20",children:[n.jsxs("label",{className:"w-full block px-3 py-2 hover:bg-navySecondary cursor-pointer text-right",children:["  ",n.jsx("input",{type:"file",className:"hidden",onChange:v=>{sr(null),Mi(v,f)},accept:".pdf,.jpg,.png"})]}),n.jsx("button",{className:"w-full text-right px-3 py-2 hover:bg-navySecondary",onClick:()=>Ar({mode:"EXPENSES",section:f}),children:"  OCR"})]})]}),j&&n.jsxs("span",{className:"text-xs text-indigo-500 flex items-center",children:[n.jsx(Mt,{className:"w-3 h-3 animate-spin mr-1"}),"   ,     "]})]}),n.jsxs("div",{className:"space-y-2",children:[n.jsxs("div",{className:"flex justify-between items-center bg-indigo-50 p-2 rounded border border-indigo-200",children:[n.jsxs("span",{className:"text-sm font-bold text-indigo-900",children:["Total Extracted: ",e.expensesSum||"0"]}),Jt&&n.jsx("button",{onClick:()=>t({expensesItems:[],expensesSum:"0"}),className:"text-xs text-red-500 hover:underline",children:"Clear All"})]}),n.jsx("div",{className:"overflow-x-auto border rounded",children:n.jsxs("table",{className:"w-full text-sm border-collapse border-borderDark",children:[n.jsx("thead",{className:"bg-navySecondary",children:n.jsxs("tr",{children:[n.jsx("th",{className:"p-2 text-left text-textMuted",children:"Date"}),n.jsx("th",{className:"p-2 text-left text-textMuted",children:"Description"}),n.jsx("th",{className:"p-2 text-right text-textMuted",children:"Amount"}),!Ce&&n.jsx("th",{className:"p-2 w-8"})]})}),n.jsxs("tbody",{children:[e.expensesItems.length===0&&n.jsx("tr",{children:n.jsx("td",{colSpan:4,className:"p-4 text-center text-gray-400 italic",children:"No expenses added."})}),e.expensesItems.map((v,_)=>n.jsxs("tr",{className:"border-t",children:[n.jsx("td",{className:"p-2",children:v.date}),n.jsx("td",{className:"p-2",children:v.description}),n.jsxs("td",{className:"p-2 text-right",children:[v.amount," ",v.currency]}),Jt&&n.jsx("td",{className:"p-2 text-center",children:n.jsx("button",{onClick:()=>Ai(v.id),className:"text-red-400 hover:text-red-600",children:n.jsx(Ft,{className:"w-3 h-3"})})})]},_))]})]})}),Jt&&n.jsx("div",{className:"bg-indigo-50 p-3 rounded border",children:n.jsxs("select",{className:"w-full text-sm border p-2 rounded",value:e.paymentRecommendation||"",onChange:v=>t({paymentRecommendation:v.target.value}),children:[n.jsx("option",{value:"",children:"-- Select Recommendation --"}),n.jsx("option",{value:"The expenses are lower than the Deductible...",children:"Option A: Lower than Deductible"}),n.jsxs("option",{value:`It would be appreciated... transfer ${e.expensesSum||"..."}`,children:["Option B: Transfer Funds (",e.expensesSum," )"]})]})})]}),n.jsxs("div",{className:`border-t-2 pt-4 mt-6 ${Ce?"bg-green-50 p-4 rounded border-green-200":""}`,children:[n.jsxs("h4",{className:"font-bold text-sm text-textLight mb-2 flex items-center",children:[n.jsx(dh,{className:"w-4 h-4 mr-2"})," Tax Invoices (Appendices)"]}),(Jt||!e.isWaitingForInvoices)&&n.jsxs("div",{className:"flex flex-wrap items-center gap-2 mb-2",children:[n.jsxs("button",{onClick:()=>{var v;return(v=$n.current)==null?void 0:v.click()},className:"px-3 py-1.5 text-xs bg-navySecondary text-textLight rounded hover:bg-borderDark flex items-center gap-1",children:[n.jsx(yo,{className:"w-3 h-3"})," "]}),n.jsx("button",{onClick:()=>Ar({mode:"INVOICE"}),className:"px-3 py-1.5 text-xs bg-red-100 text-red-700 rounded hover:bg-red-200 flex items-center gap-1",children:Jn==="INVOICE"?n.jsx(Mt,{className:"w-3 h-3 animate-spin"}):" "}),n.jsx("input",{ref:$n,type:"file",className:"hidden",multiple:!0,accept:".pdf,.doc,.docx,application/msword,application/vnd.openxmlformats-officedocument.wordprocessingml.document,application/pdf",onChange:zt})]}),n.jsx("div",{className:"mt-2 space-y-2",children:e.invoiceFiles.map(v=>n.jsxs("div",{className:"flex items-center justify-between bg-panel p-2 rounded border shadow-sm text-xs",children:[n.jsxs("span",{className:"flex items-center",children:[n.jsx(go,{className:"w-3 h-3 mr-2 text-blue-500"})," ",v.name]}),n.jsx("button",{onClick:()=>ln(v.id),className:"text-red-400 hover:text-red-600",children:n.jsx(Ft,{className:"w-3 h-3"})})]},v.id))})]})]}):n.jsxs("div",{className:"relative",children:[!(Xt&&on==="ENGLISH_ONLY")&&n.jsx(Fp,{className:"w-full border border-borderDark rounded-md p-4 min-h-[100px] text-right font-sans focus:ring-1 focus:ring-lpBlue outline-none transition-all",dir:"rtl",value:e.content[f]||"",onChange:v=>Qt(f,v.target.value),disabled:Ce,readOnly:V,placeholder:"Type Hebrew content here...",style:{lineHeight:"1.6",textAlign:"justify"},textareaRef:(A.current[f]||(A.current[f]=ii.createRef()),A.current[f])}),Xt&&n.jsxs("div",{className:on==="ENGLISH_ONLY"?"":"mt-4 border-t pt-4",children:[n.jsxs("div",{className:"flex items-center justify-between mb-2",children:[n.jsx("label",{className:"text-xs font-bold text-textMuted uppercase block",children:"English Output (Editable)"}),a.role==="ADMIN"&&e.isTranslated&&!f.toLowerCase().includes("expenses")&&n.jsx("button",{type:"button",onClick:()=>jr(f),disabled:!!Qn&&Qn===f||!(((m=e.translatedContent)==null?void 0:m[f])||"").trim(),className:`text-[11px] px-2 py-1 rounded-full border transition ${Qn===f?"border-emerald-400 text-emerald-600 bg-emerald-50 cursor-wait":(((x=e.translatedContent)==null?void 0:x[f])||"").trim()?"border-emerald-500 text-emerald-700 hover:bg-emerald-50":"border-borderDark text-slate-400 cursor-not-allowed"}`,children:Qn===f?n.jsxs("span",{className:"inline-flex items-center gap-1",children:[n.jsx(Mt,{className:"w-3 h-3 animate-spin"}),"Improving..."]}):"Improve this section"})]}),n.jsx(Fp,{className:"w-full border border-indigo-200 rounded-md p-4 min-h-[100px] font-serif focus:ring-1 focus:ring-indigo-300 outline-none transition-all",dir:"ltr",value:((k=e.translatedContent)==null?void 0:k[f])||"",onChange:v=>Ti(f,v.target.value),placeholder:"Translated text will appear here after Auto-Translate...",readOnly:V,style:{lineHeight:"1.6",textAlign:"justify"}})]})]})]},f)})}),a.role==="ADMIN"&&Q&&n.jsx("div",{className:"fixed inset-0 z-[120] flex items-center justify-center bg-black/40",children:n.jsxs("div",{className:"bg-panel rounded-lg shadow-xl w-full max-w-3xl max-h-[80vh] overflow-hidden flex flex-col",children:[n.jsxs("div",{className:"px-4 py-2 border-b flex items-center justify-between",children:[n.jsx("h3",{className:"text-sm font-semibold text-textLight",children:"Manage Templates"}),n.jsx("button",{type:"button",onClick:()=>me(!1),className:"text-textMuted hover:text-textLight",children:n.jsx(Ft,{className:"w-4 h-4"})})]}),n.jsx("div",{className:"px-4 py-3 border-b flex items-center gap-3 text-xs",children:n.jsxs("label",{className:"font-semibold text-textLight",children:["Section:",n.jsx("select",{className:"ml-2 border border-borderDark rounded px-2 py-1 text-xs",value:ce,onChange:f=>le(f.target.value),children:Lr.map(f=>n.jsx("option",{value:f,children:f},f))})]})}),n.jsx("div",{className:"flex-1 overflow-y-auto px-4 py-3 space-y-3 text-xs",children:(()=>{const f=z.filter(T=>T.sectionKey===ce).sort((T,K)=>(T.orderIndex||0)-(K.orderIndex||0)||T.createdAt.localeCompare(K.createdAt));return f.length?f.map((T,K)=>n.jsxs("div",{className:"border border-borderDark rounded-md p-2 bg-slate-50 space-y-1",children:[n.jsxs("div",{className:"flex items-center justify-between gap-2",children:[n.jsx("input",{type:"text",className:"flex-1 border border-borderDark rounded px-2 py-1 text-xs",value:T.title,onChange:ee=>kr(T.id,{title:ee.target.value})}),n.jsxs("label",{className:"flex items-center gap-1 text-[11px] text-textLight",children:[n.jsx("input",{type:"checkbox",checked:T.isEnabled!==!1,onChange:ee=>kr(T.id,{isEnabled:ee.target.checked})}),"Enabled"]})]}),n.jsx("textarea",{className:"w-full border border-borderDark rounded px-2 py-1 text-xs mt-1",rows:3,value:T.body,onChange:ee=>kr(T.id,{body:ee.target.value})}),n.jsxs("div",{className:"flex items-center justify-between mt-1",children:[n.jsxs("div",{className:"flex items-center gap-1",children:[n.jsx("button",{type:"button",className:"px-2 py-0.5 rounded border border-borderDark text-[11px] text-textLight hover:bg-slate-100",onClick:()=>ga(T.id,"UP"),disabled:K===0,children:""}),n.jsx("button",{type:"button",className:"px-2 py-0.5 rounded border border-borderDark text-[11px] text-textLight hover:bg-slate-100",onClick:()=>ga(T.id,"DOWN"),disabled:K===f.length-1,children:""})]}),n.jsx("button",{type:"button",className:"px-2 py-0.5 rounded border border-red-200 text-[11px] text-red-700 hover:bg-red-50",onClick:()=>{window.confirm("Delete this template?")&&ha(T.id)},children:"Delete"})]})]},T.id)):n.jsx("p",{className:"text-[11px] text-textMuted",children:"No templates defined yet for this section."})})()})]})}),a.role==="ADMIN"&&Ue&&n.jsx("div",{className:"fixed inset-0 z-[120] flex items-center justify-center bg-black/40",children:n.jsxs("div",{className:"bg-panel rounded-lg shadow-xl w-full max-w-3xl max-h-[80vh] overflow-hidden flex flex-col",children:[n.jsxs("div",{className:"px-4 py-2 border-b flex items-center justify-between",children:[n.jsx("h3",{className:"text-sm font-semibold text-textLight",children:"Manage Best Practices"}),n.jsx("button",{type:"button",onClick:()=>U(!1),className:"text-textMuted hover:text-textLight",children:n.jsx(Ft,{className:"w-4 h-4"})})]}),n.jsx("div",{className:"px-4 py-3 border-b flex items-center gap-3 text-xs",children:n.jsxs("label",{className:"font-semibold text-textLight",children:["Section:",n.jsx("select",{className:"ml-2 border border-borderDark rounded px-2 py-1 text-xs",value:J,onChange:f=>he(f.target.value),children:Lr.map(f=>n.jsx("option",{value:f,children:f},f))})]})}),n.jsx("div",{className:"flex-1 overflow-y-auto px-4 py-3 space-y-3 text-xs",children:(()=>{const f=Z.filter(T=>T.sectionKey===J).sort((T,K)=>{const ee=T.label==="LLOYDS_RECOMMENDED"?0:1,ue=K.label==="LLOYDS_RECOMMENDED"?0:1;if(ee!==ue)return ee-ue;const d=T.usageCount||0;return(K.usageCount||0)-d});return f.length?f.map(T=>n.jsxs("div",{className:"border border-borderDark rounded-md p-2 bg-slate-50 space-y-1",children:[n.jsxs("div",{className:"flex items-center justify-between gap-2",children:[n.jsx("input",{type:"text",className:"flex-1 border border-borderDark rounded px-2 py-1 text-xs",value:T.title,onChange:K=>Tr(T.id,{title:K.target.value})}),n.jsxs("select",{className:"border border-borderDark rounded px-2 py-1 text-[11px]",value:T.label,onChange:K=>Tr(T.id,{label:K.target.value==="LLOYDS_RECOMMENDED"?"LLOYDS_RECOMMENDED":"BEST_PRACTICE"}),children:[n.jsx("option",{value:"BEST_PRACTICE",children:"Best practice"}),n.jsx("option",{value:"LLOYDS_RECOMMENDED",children:"Lloyds recommended"})]}),n.jsxs("label",{className:"flex items-center gap-1 text-[11px] text-textLight",children:[n.jsx("input",{type:"checkbox",checked:T.isEnabled!==!1,onChange:K=>Bo(T.id,K.target.checked)}),"Enabled"]})]}),n.jsx("textarea",{className:"w-full border border-borderDark rounded px-2 py-1 text-xs mt-1",rows:3,value:T.body,onChange:K=>Tr(T.id,{body:K.target.value})}),n.jsx("input",{type:"text",className:"w-full border border-borderDark rounded px-2 py-1 text-[11px] mt-1",placeholder:"Tags (comma separated)",value:(T.tags||[]).join(", "),onChange:K=>Tr(T.id,{tags:K.target.value.split(",").map(ee=>ee.trim()).filter(Boolean)})}),n.jsxs("div",{className:"flex items-center justify-between mt-1",children:[n.jsxs("div",{className:"flex items-center gap-2 text-[10px] text-textMuted",children:[n.jsxs("span",{children:["Usage: ",T.usageCount||0]}),T.lastUsedAt&&n.jsxs("span",{children:["Last used:"," ",new Date(T.lastUsedAt).toLocaleString("he-IL",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"})]})]}),n.jsx("button",{type:"button",className:"px-2 py-0.5 rounded border border-red-200 text-[11px] text-red-700 hover:bg-red-50",onClick:()=>{window.confirm("Delete this best practice?")&&Fo(T.id)},children:"Delete"})]})]},T.id)):n.jsx("p",{className:"text-[11px] text-textMuted",children:"No best practices defined yet for this section."})})()})]})}),qt&&n.jsx("div",{className:"fixed inset-0 z-[120] flex items-center justify-center bg-black/40",children:n.jsxs("div",{className:"bg-panel rounded-lg shadow-xl w-full max-w-3xl max-h-[80vh] overflow-hidden flex flex-col",children:[n.jsxs("div",{className:"px-4 py-2 border-b flex items-center justify-between",children:[n.jsx("h3",{className:"text-sm font-semibold text-textLight",children:" "}),n.jsx("button",{type:"button",onClick:()=>{At(!1),nt(null)},className:"text-textMuted hover:text-textLight",children:n.jsx(Ft,{className:"w-4 h-4"})})]}),n.jsxs("div",{className:"flex-1 overflow-y-auto px-4 py-3 space-y-4 text-xs",children:[n.jsxs("div",{className:"flex items-center justify-between gap-2",children:[n.jsx("p",{className:"text-[11px] text-textMuted",children:"          ."}),n.jsx("button",{type:"button",className:"px-3 py-1.5 rounded bg-sky-600 text-white text-[11px] font-semibold hover:bg-sky-700",onClick:()=>nt({id:void 0,title:"",sectionKey:"",tagsInput:"",body:""}),children:" "})]}),je.length===0&&n.jsx("p",{className:"text-[11px] text-textMuted",children:'    .     " ".'}),je.length>0&&n.jsxs("div",{className:"space-y-2",children:[n.jsx("h4",{className:"text-[11px] font-semibold text-textLight",children:" "}),n.jsx("div",{className:"space-y-1",children:je.slice().sort((f,T)=>(T.updatedAt||T.createdAt).localeCompare(f.updatedAt||f.createdAt)).map(f=>n.jsxs("div",{className:"flex items-center justify-between gap-2 border border-borderDark rounded-md px-2 py-1 bg-slate-50",children:[n.jsx("div",{className:"flex-1 min-w-0 text-right",children:n.jsxs("div",{className:"flex flex-wrap items-center justify-end gap-1",children:[n.jsx("span",{className:"font-semibold text-textLight truncate",children:f.title}),f.sectionKey&&n.jsx("span",{className:"inline-flex items-center rounded-full px-2 py-0.5 text-[9px] bg-slate-100 text-textLight",children:f.sectionKey}),f.tags&&f.tags.length>0&&n.jsx("span",{className:"inline-flex items-center rounded-full px-2 py-0.5 text-[9px] bg-slate-100 text-textLight",children:f.tags.join(", ")})]})}),n.jsxs("div",{className:"flex items-center gap-1",children:[n.jsx("button",{type:"button",className:"px-2 py-0.5 rounded border border-borderDark text-[11px] text-textLight hover:bg-slate-100",onClick:()=>nt({id:f.id,title:f.title,sectionKey:f.sectionKey||"",tagsInput:(f.tags||[]).join(", "),body:f.body}),children:""}),n.jsx("button",{type:"button",className:"px-2 py-0.5 rounded border border-red-200 text-[11px] text-red-700 hover:bg-red-50",onClick:()=>{if(window.confirm("Delete this personal snippet?")){const T=Op(a.id,f.id);Ze(T),ie&&ie.id===f.id&&nt(null)}},children:""})]})]},f.id))})]}),ie&&n.jsxs("form",{className:"border-t border-borderDark pt-3 space-y-3",onSubmit:f=>{f.preventDefault();const T=ie.title.trim(),K=ie.body.trim();if(!T||!K)return;const ee=ie.tagsInput.split(",").map(d=>d.trim()).filter(Boolean)||[],ue=xv(a.id,{id:ie.id,title:T,body:K,sectionKey:ie.sectionKey||void 0,tags:ee});Ze(ue),nt(null)},children:[n.jsx("h4",{className:"text-[11px] font-semibold text-textLight",children:ie.id?" ":" "}),n.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-2",children:[n.jsxs("div",{className:"space-y-1",children:[n.jsx("label",{className:"block font-semibold text-textLight",children:""}),n.jsx("input",{type:"text",className:"w-full border border-borderDark rounded px-2 py-1 text-xs",value:ie.title,onChange:f=>nt(T=>T&&{...T,title:f.target.value}),required:!0})]}),n.jsxs("div",{className:"space-y-1",children:[n.jsx("label",{className:"block font-semibold text-textLight",children:" ()"}),n.jsxs("select",{className:"w-full border border-borderDark rounded px-2 py-1 text-xs",value:ie.sectionKey,onChange:f=>nt(T=>T&&{...T,sectionKey:f.target.value}),children:[n.jsx("option",{value:"",children:" "}),Lr.map(f=>n.jsx("option",{value:f,children:f},f))]})]})]}),n.jsxs("div",{className:"space-y-1",children:[n.jsx("label",{className:"block font-semibold text-textLight",children:" (,  )"}),n.jsx("input",{type:"text",className:"w-full border border-borderDark rounded px-2 py-1 text-xs",value:ie.tagsInput,onChange:f=>nt(T=>T&&{...T,tagsInput:f.target.value})})]}),n.jsxs("div",{className:"space-y-1",children:[n.jsx("label",{className:"block font-semibold text-textLight",children:" "}),n.jsx("textarea",{className:"w-full border border-borderDark rounded px-2 py-1 text-xs",rows:5,value:ie.body,onChange:f=>nt(T=>T&&{...T,body:f.target.value})})]}),n.jsxs("div",{className:"flex items-center justify-end gap-2 pt-2 border-t border-borderDark",children:[n.jsx("button",{type:"button",className:"px-3 py-1.5 rounded border border-borderDark text-[11px] text-textLight hover:bg-slate-100",onClick:()=>nt(null),children:""}),n.jsx("button",{type:"submit",className:"px-3 py-1.5 rounded bg-sky-600 text-white text-[11px] font-semibold hover:bg-sky-700",children:""})]})]})]})]})}),a.role==="ADMIN"&&Re&&n.jsx("div",{className:"fixed inset-0 z-[130] flex items-center justify-center bg-black/40",children:n.jsxs("div",{className:"bg-panel rounded-lg shadow-xl w-full max-w-md max-h-[80vh] overflow-hidden flex flex-col",children:[n.jsxs("div",{className:"px-4 py-2 border-b flex items-center justify-between",children:[n.jsx("h3",{className:"text-sm font-semibold text-textLight",children:"Save Best Practice"}),n.jsx("button",{type:"button",onClick:ba,className:"text-textMuted hover:text-textLight",children:n.jsx(Ft,{className:"w-4 h-4"})})]}),n.jsx(vv,{onSubmit:Gi,onCancel:ba,initialTitle:Re.body.split(/\s+/).slice(0,6).join(" ")})]})}),n.jsxs("div",{className:"flex justify-between pt-4",children:[n.jsxs("button",{onClick:s,className:"flex items-center text-textMuted px-4 py-2 hover:bg-navySecondary rounded",children:[n.jsx(Jl,{className:"mr-2 w-4 h-4"})," Back"]}),n.jsxs("button",{onClick:r,className:"flex items-center bg-navy text-white px-6 py-2 rounded hover:bg-navySecondary transition",children:["Next Step ",n.jsx(os,{className:"ml-2 w-4 h-4"})]})]})]})]})},Bv=({onClose:e,onSubmit:t,currentUser:s,favoriteProviders:r=[],onSaveFavorite:a})=>{const o=s.role==="LAWYER",[l,c]=g.useState(o?s.id:""),[i,u]=g.useState(""),[p,y]=g.useState(""),[b,w]=g.useState(null),[R,E]=g.useState([{id:Rn(),category:"EXPERT_OUR",serviceProvider:"",amount:""}]),[W,N]=g.useState([]),h=4,S=async()=>{if(!l||!p)return;let j=null;const P=D=>t({lawyerId:l,instructions:i,odakanitNo:p,file:D,worksheet:R,invoiceFiles:W});if(b){const D=new FileReader;D.onload=O=>{var z;j={name:b.name,type:b.type,data:((z=O.target)==null?void 0:z.result).split(",")[1]},P(j)},D.readAsDataURL(b)}else P()},M=async j=>{const P=j.target.files;if(!P)return;if(W.length>=h){alert("   4 ."),j.target.value="";return}const D=Array.from(P).slice(0,h-W.length),O=await Promise.all(D.map(z=>new Promise(F=>{const C=new FileReader;C.onload=L=>{var Q;return F({id:`inv-${Date.now()}-${Math.random().toString(36).slice(2,6)}`,name:z.name,data:((Q=L.target)==null?void 0:Q.result).split(",")[1],type:z.type})},C.readAsDataURL(z)})));N(z=>[...z,...O]),j.target.value=""},H=j=>{N(P=>P.filter(D=>D.id!==j))},V=(j,P,D)=>{E(O=>O.map(z=>z.id===j?{...z,[P]:D}:z))},q=j=>{const P=is.find(D=>D.type===j)||is[0];E(D=>[...D,{id:Rn(),category:P.value,serviceProvider:"",amount:"",customLabel:""}])},te=j=>{E(P=>P.length===1?P:P.filter(D=>D.id!==j))},G=Md(R,s),re=ai(G);return n.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-[200]",children:n.jsxs("div",{className:"bg-panel p-6 rounded-lg shadow-xl w-96 animate-scale-in",children:[n.jsx("h3",{className:"font-bold text-lg mb-4 text-textLight",children:o?"  ":"Open New Finance Case"}),n.jsxs("div",{className:"space-y-3",children:[n.jsxs("div",{children:[n.jsx("label",{className:"block text-xs font-bold text-textMuted",children:"Internal Case # (Odakanit)"}),n.jsx("input",{className:"w-full border p-2 rounded",value:p,onChange:j=>y(j.target.value),placeholder:"e.g. 55492"})]}),!o&&n.jsxs(n.Fragment,{children:[n.jsxs("div",{children:[n.jsx("label",{className:"block text-xs font-bold text-textMuted",children:"Assign Lawyer"}),n.jsxs("select",{className:"w-full border p-2 rounded",value:l,onChange:j=>c(j.target.value),children:[n.jsx("option",{value:"",children:"-- Select --"}),Ss.filter(j=>j.role==="LAWYER").map(j=>n.jsx("option",{value:j.id,children:j.name},j.id))]})]}),n.jsxs("div",{children:[n.jsx("label",{className:"block text-xs font-bold text-textMuted",children:"Instructions"}),n.jsx(ho,{clientId:vo,children:n.jsx("textarea",{className:"w-full border p-2 rounded",rows:3,value:i,onChange:j=>u(j.target.value),placeholder:"Notes for lawyer..."})})]}),n.jsxs("div",{children:[n.jsx("label",{className:"block text-xs font-bold text-textMuted",children:"Attach Expenses File"}),n.jsx("input",{type:"file",onChange:j=>{var P;return w(((P=j.target.files)==null?void 0:P[0])||null)},className:"text-xs"})]}),n.jsxs("div",{className:"border rounded-lg p-3 bg-amber-50",children:[n.jsxs("div",{className:"flex justify-between items-center mb-2",children:[n.jsx("label",{className:"block text-xs font-bold text-amber-700",children:"Expense Worksheet"}),n.jsxs("div",{className:"flex gap-2 text-xs text-amber-700 font-semibold",children:[n.jsx("button",{type:"button",onClick:()=>q("EXPENSE"),className:"hover:underline",children:"+ Expense"}),n.jsx("button",{type:"button",onClick:()=>q("ADJUSTMENT"),className:"hover:underline",children:"+ Adjustment"})]})]}),n.jsx("div",{className:"space-y-2 max-h-48 overflow-auto pr-1",children:R.map(j=>{const P=is.find(F=>F.value===j.category),D=(P==null?void 0:P.type)!=="ADJUSTMENT",O=r.filter(F=>F.category===j.category||F.category==="OTHER"),z=Md([j],s)[0];return n.jsxs("div",{className:"border border-amber-100 bg-panel rounded-lg p-2 space-y-2",children:[n.jsxs("div",{children:[n.jsx("label",{className:"block text-[10px] font-bold text-textMuted",children:"Expense Details"}),n.jsx("select",{value:j.category,onChange:F=>V(j.id,"category",F.target.value),className:"w-full border rounded text-xs p-2",children:is.map(F=>n.jsx("option",{value:F.value,children:F.label},F.value))})]}),j.category==="OTHER"&&n.jsxs("div",{children:[n.jsx("label",{className:"block text-[10px] font-bold text-textMuted",children:"Custom Label"}),n.jsx("input",{className:"w-full border rounded text-xs p-2",placeholder:"Describe expense",value:j.customLabel||"",onChange:F=>V(j.id,"customLabel",F.target.value)})]}),D&&n.jsxs("div",{children:[n.jsx("label",{className:"block text-[10px] font-bold text-textMuted",children:"Service Provider"}),n.jsx("input",{list:`provider-${j.id}`,className:"w-full border rounded text-xs p-2",placeholder:"Provider name",value:j.serviceProvider,onChange:F=>V(j.id,"serviceProvider",F.target.value)}),n.jsx("datalist",{id:`provider-${j.id}`,children:O.map(F=>n.jsx("option",{value:F.serviceProvider,children:F.label},F.id))}),n.jsx("button",{type:"button",onClick:()=>a&&j.serviceProvider.trim()&&a({id:Rn(),category:j.category,label:(z==null?void 0:z.label)||"Expense",serviceProvider:j.serviceProvider.trim()}),className:"text-[10px] text-amber-600 hover:underline mt-1",children:"Save to favorites"})]}),n.jsxs("div",{children:[n.jsx("label",{className:"block text-[10px] font-bold text-textMuted",children:"Cost ()"}),n.jsx("input",{type:"number",min:"0",className:"w-full border rounded text-xs p-2",placeholder:"",value:j.amount,onChange:F=>V(j.id,"amount",F.target.value)})]}),n.jsx("div",{className:"text-right",children:n.jsx("button",{type:"button",onClick:()=>te(j.id),className:"text-[10px] text-red-500 hover:underline",children:"Remove"})})]},j.id)})}),n.jsxs("div",{className:"text-right text-xs font-bold text-amber-800 mt-2",children:["Total balance preview: ",re.totalBalance.toLocaleString()]})]}),n.jsxs("div",{className:"border rounded-lg p-3 bg-panel",children:[n.jsxs("div",{className:"flex justify-between items-center mb-2",children:[n.jsx("label",{className:"block text-xs font-bold text-textLight",children:"Tax Invoices (PDF / Word)"}),n.jsxs("span",{className:"text-[11px] text-textMuted",children:[W.length,"/",h]})]}),n.jsxs("label",{className:"flex flex-col items-center justify-center w-full h-24 border-2 border-borderDark border-dashed rounded-lg cursor-pointer bg-panel hover:bg-navySecondary",children:[n.jsxs("div",{className:"flex flex-col items-center justify-center pt-5 pb-6",children:[n.jsx(yo,{className:"w-6 h-6 text-gray-400 mb-2"}),n.jsx("p",{className:"text-xs text-textMuted",children:"   ( 4 )"})]}),n.jsx("input",{type:"file",className:"hidden",multiple:!0,accept:".pdf,.doc,.docx,application/msword,application/vnd.openxmlformats-officedocument.wordprocessingml.document,application/pdf",onChange:M})]}),n.jsxs("div",{className:"mt-2 space-y-2 max-h-32 overflow-auto",children:[W.map(j=>n.jsxs("div",{className:"flex items-center justify-between bg-navySecondary p-2 rounded border text-xs",children:[n.jsxs("span",{className:"flex items-center gap-2 text-textLight",children:[n.jsx(go,{className:"w-3 h-3 text-blue-500"}),j.name]}),n.jsx("button",{type:"button",onClick:()=>H(j.id),className:"text-red-400 hover:text-red-600",children:n.jsx(Ft,{className:"w-3 h-3"})})]},j.id)),W.length===0&&n.jsx("p",{className:"text-xs text-gray-400 text-center",children:"   ."})]})]})]}),o&&n.jsx("p",{className:"text-xs text-textMuted",children:"    .    ."}),n.jsx("button",{onClick:S,className:"w-full bg-indigo-600 text-white py-2 rounded font-bold mt-2 hover:bg-indigo-700",children:o?"Create Personal Folder":"Create Folder"}),n.jsx("button",{onClick:e,className:"w-full text-textMuted text-sm hover:underline mt-1",children:"Cancel"})]})]})})},$v=({user:e,reports:t,onSelectReport:s,onNewReport:r,onLogout:a,onUpdateReport:o,onDeleteReport:l,onFinanceTaskCreate:c,onNotifyLawyerFromFinance:i,onSheetDeleted:u,caseTemplates:p=[],onStartTemplate:y,onStartNextReport:b,archiveAfterMs:w,favoriteProviders:R={},onSaveFavorite:E,onDeleteFavorite:W,onOpenWorksheet:N,onRequestReminder:h,onRequestNote:S,onSoftDeleteReport:M,onRestoreReport:H,notifications:V=[],showNotifications:q,setShowNotifications:te,onClearNotifications:G,dailySummaryOptIn:re,setDailySummaryOptIn:j,caseFolders:P,onOpenCaseFolder:D,onOpenAssistant:O})=>{const z=e.role==="ADMIN"||e.role==="SUB_ADMIN"||e.role==="FINANCE",F=e.role==="LAWYER"||e.role==="SUB_ADMIN"||e.role==="FINANCE",[C,L]=g.useState(!1),[Q,me]=g.useState(!1),[ce,le]=g.useState(!1),[fe,Te]=g.useState(!1),[ge,Be]=g.useState({category:"EXPERT_OUR",label:"",provider:""}),[Ye,Ve]=g.useState(""),[He,ct]=g.useState(null),X=e.role==="ADMIN",se=e.role==="SUB_ADMIN"||e.role==="FINANCE";if(e.role==="FINANCE"){const A=Ne=>{o(Ne,{isPaid:!0})};return n.jsx(Jb,{user:e,reports:t,onLogout:a,onNotifyLawyer:i,onMarkReportPaid:A,onSheetDeleted:u,onOpenAssistant:()=>O&&O(),caseFolders:P})}if(!z&&e.role==="LAWYER")return n.jsx(mb,{user:e,reports:t,caseFolders:P||{},notifications:V,showNotifications:q,setShowNotifications:te,onClearNotifications:G,dailySummaryOptIn:re,setDailySummaryOptIn:j,archiveAfterMs:w,onSelectReport:s,onNewReport:r,onOpenCaseFolder:D,onLogout:a,deleteReportById:l});const I=Date.now(),ae=w??Number.MAX_SAFE_INTEGER,ne=A=>A.status==="SENT"&&A.sentAt&&I-new Date(A.sentAt).getTime()>=ae,ye=z?t:t.filter(A=>A.createdBy===e.id),Pe=ye.filter(ne),ke=ye.filter(A=>!ne(A)&&!A.deletedAt),De=ye.filter(A=>A.deletedAt&&I-new Date(A.deletedAt).getTime()<$h),Qe=ye.filter(A=>!A.deletedAt),Ke=X?ke:F?Qe:ye,Fe=X?Pe:F?De:[],Z=z?[]:t.filter(A=>A.status==="READY_TO_SEND"&&A.createdBy===e.id&&!A.deletedAt),ve=z?[]:t.filter(A=>["TASK_ASSIGNED","WAITING_FOR_INVOICES"].includes(A.status)&&A.createdBy===e.id&&!A.deletedAt),xe=A=>{var Ne;if((Ne=A.reportHistory)!=null&&Ne.length)return A.reportHistory;if(A.status==="SENT"){const Oe=A.sentAt||A.reportDate||new Date().toISOString();return[{id:`${A.id}-legacy`,reportNumber:1,subject:`${A.insurerName||"Report"}${A.insuredName?` - ${A.insuredName}`:""}`,date:Oe,sent:!0}]}return[]},Se=z?[]:t.filter(A=>A.createdBy===e.id&&!A.deletedAt).flatMap(A=>{const Ne=xe(A);return Ne.length?Ne.map((Oe,Ce)=>{var ut;return{parent:A,entry:Oe,reportNumber:Oe.reportNumber||Ce+1,sentAt:Oe.date||((ut=Oe.snapshot)==null?void 0:ut.createdAt)||A.sentAt,isLatest:Ce===Ne.length-1}}):[]}).sort((A,Ne)=>{const Oe=A.sentAt?new Date(A.sentAt).getTime():0;return(Ne.sentAt?new Date(Ne.sentAt).getTime():0)-Oe}),Me=A=>{const Ne=xe(A),Oe=Ne[Ne.length-1],Ce=(Oe==null?void 0:Oe.date)||A.sentAt;return Ce?new Date(Ce).getTime():0},_e=z?[]:t.filter(A=>A.createdBy!==e.id||A.deletedAt||A.status!=="SENT"?!1:xe(A).length>0).sort((A,Ne)=>Me(Ne)-Me(A)),Ue=z?[]:[{id:"ready",title:"  ",subtitle:"    ",items:Z,empty:"   .",actionLabel:" ",action:A=>s(A.id),tone:"border-red-100"},{id:"finance",title:"   ",subtitle:"  /   ",items:ve,empty:"   .",actionLabel:" ",action:A=>s(A.id),tone:"border-amber-100"},{id:"followup",title:'"  ',subtitle:' "    "   ',items:_e,empty:' "   .',actionLabel:'" ',action:b?A=>b(A.id):void 0,tone:"border-blue-100"},{id:"sent",title:" ",subtitle:'      "   ',items:Se,empty:"     .",tone:"border-green-100"}],U=z?t.filter(A=>A.odakanitNo&&!A.deletedAt):[],J=(R==null?void 0:R[e.id])||[],he=()=>{if(!ge.provider.trim())return;const A=is.find(Oe=>Oe.value===ge.category),Ne=ge.label.trim()||(A==null?void 0:A.label)||"Favorite provider";E&&E(e.id,{id:Rn(),category:ge.category,label:Ne,serviceProvider:ge.provider.trim()}),Be({category:ge.category,label:"",provider:""})},Re=A=>{W&&W(e.id,A)};p.filter(A=>A.ownerId===e.id);const de=t.filter(A=>Up(A)&&!A.deletedAt),je=e.role==="FINANCE"||e.role==="SUB_ADMIN",Ze=X||F,We=X?`Items move here ${w/(1e3*60*60)}h after sending and are deleted after ${Bh/(1e3*60*60*24)} days.`:F?"     7    .":"",tt=de.filter(A=>!["READY_TO_SEND","SENT"].includes(A.status)),qt=de.filter(A=>A.status==="READY_TO_SEND"),At=de.filter(A=>A.status==="SENT"),ie=At.reduce((A,Ne)=>A+Hp(Ne),0),nt=A=>A==="SENT"?"bg-gold/20 text-goldLight border-gold":A==="READY_TO_SEND"?"bg-danger/30 text-red-300 border-danger":"bg-navySecondary text-textMuted border-borderDark",on=A=>A==="READY_TO_SEND"?"READY TO SEND":A.replace(/_/g," "),Rs=A=>{o(A,{isPaid:!0})},lt=ce?Fe:Ke,ms=A=>{const Ne=A.createdBy||"unknown",Oe=A.odakanitNo||A.marketRef||A.id||"unknown",Ce=(A.plaintiffName||"unknown").toLowerCase();return`${Ne}::${Oe}::${Ce}`},Jn=je?lt.filter(Up):lt,An=new Set((je?[]:lt).map(A=>ms(A))),wr=!z&&!je?p.filter(A=>A.ownerId===e.id&&!An.has(A.caseKey)).map(A=>({id:`template-${A.caseKey}`,createdBy:A.ownerId,ownerName:A.ownerName,reportDate:A.lastUpdated,status:"TASK_ASSIGNED",recipientId:"1",insurerName:A.insurerName||"",lineSlipNo:A.lineSlipNo||"",marketRef:A.marketRef||"",insuredName:A.insuredName||"",plaintiffName:A.plaintiffName||"",plaintiffTitle:A.plaintiffTitle||"Plaintiff",odakanitNo:A.odakanitNo,selectedTimeline:"standard",filenameTag:fh[0],selectedSections:["Update"],content:{},translatedContent:{},expertSummaryMode:{},invoiceFiles:[],isWaitingForInvoices:!1,isTranslated:!1,expensesItems:[],expenseWorksheet:Ms(),reportNotes:[],__templateKey:A.caseKey})):[],nr=je?Jn:[...Jn,...wr],In=Ye.trim().toLowerCase(),sr=A=>In?`${A.odakanitNo||""} ${A.insuredName||""} ${A.plaintiffName||""} ${A.ownerName||""}`.toLowerCase().includes(In):!0,Qn=In?nr.filter(sr):nr,Bn=je?[]:(()=>{const A=new Map;return Qn.forEach(Ne=>{if(Ne.__templateKey)return;const Oe=Ne.odakanitNo||Ne.marketRef||Ne.insuredName||Ne.id,Ce=Ne.reportDate?new Date(Ne.reportDate).getTime():0,ut=A.get(Oe);ut?(ut.reports.push(Ne),Ce>ut.latestDate&&(ut.latestDate=Ce),!ut.caseLabel&&(Ne.insuredName||Ne.plaintiffName)&&(ut.caseLabel=Ne.insuredName||Ne.plaintiffName||ut.caseLabel),!ut.insuredName&&Ne.insuredName&&(ut.insuredName=Ne.insuredName),!ut.plaintiffName&&Ne.plaintiffName&&(ut.plaintiffName=Ne.plaintiffName)):A.set(Oe,{key:Oe,odakanitNo:Ne.odakanitNo||"",caseLabel:Ne.insuredName||Ne.plaintiffName||Ne.marketRef||"",insuredName:Ne.insuredName||"",plaintiffName:Ne.plaintiffName||"",reports:[Ne],latestDate:Ce})}),Array.from(A.values()).sort((Ne,Oe)=>Oe.latestDate-Ne.latestDate)})(),ps=A=>!["READY_TO_SEND","SENT"].includes(A.status),$n=A=>{if(!ps(A)){alert("      -READY TO SEND  .");return}const Ne=A.insuredName||A.plaintiffName||A.odakanitNo||A.id;window.confirm(`  " "${Ne}"?    .`)&&l&&l(A.id)};return g.useEffect(()=>{He&&(Bn.some(A=>A.key===He)||ct(null))},[He,Bn]),n.jsxs("div",{className:"min-h-screen bg-bgDark p-6 relative",children:[Q&&n.jsx(Sv,{onClose:()=>me(!1)}),C&&n.jsx(Bv,{currentUser:e,onClose:()=>L(!1),onSubmit:A=>{c(A),L(!1)},favoriteProviders:R[e.id]||[],onSaveFavorite:A=>E&&E(e.id,A)}),fe&&n.jsx("div",{className:"fixed inset-0 bg-black/40 flex items-center justify-center z-[200] p-4",children:n.jsxs("div",{className:"bg-panel rounded-2xl shadow-2xl w-full max-w-2xl p-6 space-y-4",children:[n.jsxs("div",{className:"flex items-center justify-between",children:[n.jsxs("h3",{className:"text-lg font-bold text-textLight flex items-center gap-2",children:[n.jsx($0,{className:"w-4 h-4 text-amber-500"}),"   "]}),n.jsx("button",{onClick:()=>Te(!1),className:"text-textMuted hover:text-textLight",children:n.jsx(Ft,{className:"w-5 h-5"})})]}),n.jsxs("div",{className:"grid md:grid-cols-3 gap-3",children:[n.jsxs("div",{children:[n.jsx("label",{className:"block text-xs font-bold text-textMuted mb-1",children:""}),n.jsx("select",{value:ge.category,onChange:A=>Be({...ge,category:A.target.value}),className:"w-full border rounded text-sm p-2",children:is.filter(A=>A.type==="EXPENSE").map(A=>n.jsx("option",{value:A.value,children:A.label},A.value))})]}),n.jsxs("div",{children:[n.jsx("label",{className:"block text-xs font-bold text-textMuted mb-1",children:" "}),n.jsx("input",{className:"w-full border rounded text-sm p-2",value:ge.label,onChange:A=>Be({...ge,label:A.target.value}),placeholder:":  "})]}),n.jsxs("div",{children:[n.jsx("label",{className:"block text-xs font-bold text-textMuted mb-1",children:" "}),n.jsx("input",{className:"w-full border rounded text-sm p-2",value:ge.provider,onChange:A=>Be({...ge,provider:A.target.value}),placeholder:'"  '})]})]}),n.jsx("div",{className:"text-right",children:n.jsx("button",{onClick:he,className:"bg-amber-500 text-white px-4 py-2 rounded font-bold hover:bg-amber-600",children:" "})}),n.jsxs("div",{className:"max-h-64 overflow-y-auto border rounded-lg divide-y",children:[J.length===0&&n.jsx("p",{className:"text-sm text-gray-400 text-center py-6",children:"   ."}),J.map(A=>n.jsxs("div",{className:"p-3 flex items-center justify-between",children:[n.jsxs("div",{children:[n.jsx("p",{className:"text-sm font-bold text-textLight",children:A.label}),n.jsx("p",{className:"text-xs text-textMuted",children:A.serviceProvider})]}),n.jsx("button",{onClick:()=>Re(A.id),className:"text-xs text-red-500 hover:underline",children:""})]},A.id))]})]})}),n.jsxs("div",{className:"w-full px-6 md:px-8 lg:px-10 xl:px-12",children:[n.jsxs("div",{className:"flex justify-between items-center mb-8",children:[n.jsxs("div",{children:[n.jsx("h1",{className:"text-3xl font-serif font-bold text-lpBlue",children:"Lior Perry Law Office"}),n.jsxs("p",{className:"text-textMuted",children:["Welcome back, ",n.jsx("span",{className:"font-bold",children:e.name})," (",e.role,")"]})]}),n.jsxs("div",{className:"flex items-center gap-3 flex-wrap justify-end",children:[Ze&&n.jsxs("button",{onClick:()=>le(A=>!A),className:`flex items-center px-4 py-2 rounded shadow text-sm font-bold ${ce?"bg-gray-300 text-textLight":"bg-borderDark text-textLight"} hover:bg-borderDark`,children:[n.jsx(Bs,{className:"w-4 h-4 mr-2"})," ",ce?"Back to Reports":`Recycle Bin (${Fe.length})`]}),n.jsxs("button",{onClick:()=>L(!0),className:"flex items-center bg-indigo-600 text-white px-4 py-2 rounded shadow hover:bg-indigo-700 font-bold",children:[n.jsx(_u,{className:"w-4 h-4 mr-2"})," Open New Case Folder"]}),n.jsxs("button",{type:"button",onClick:()=>O&&O(),className:"flex items-center text-indigo-700 bg-indigo-50 px-3 py-2 rounded hover:bg-indigo-100",children:[n.jsx(oa,{className:"w-4 h-4 mr-2"}),"  "]}),n.jsxs("div",{className:"relative",children:[n.jsxs("button",{onClick:()=>te(A=>!A),className:"flex items-center text-blue-600 bg-blue-50 px-3 py-2 rounded hover:bg-blue-100 relative",children:[n.jsx(Xl,{className:"w-4 h-4 mr-2"})," Notifications",V.length>0&&n.jsx("span",{className:"absolute -top-2 -right-2 bg-red-500 text-white text-[10px] rounded-full px-1",children:V.length})]}),q&&n.jsxs("div",{className:"absolute right-0 mt-2 w-80 bg-panel border border-borderDark shadow-xl rounded-lg z-50",children:[n.jsxs("div",{className:"flex items-center justify-between px-3 py-2 border-b",children:[n.jsx("span",{className:"text-sm font-bold text-textLight",children:"Smart Notifications"}),n.jsxs("label",{className:"text-xs text-textMuted flex items-center gap-1",children:[n.jsx("input",{type:"checkbox",checked:re,onChange:A=>j(A.target.checked)}),"Daily summary"]})]}),n.jsxs("div",{className:"max-h-64 overflow-auto divide-y",children:[V.length===0&&n.jsx("div",{className:"p-4 text-xs text-gray-400 text-center",children:"No notifications yet."}),V.map(A=>n.jsxs("div",{className:"p-3 text-sm",children:[n.jsx("p",{className:"font-medium text-textLight",children:A.message}),n.jsx("p",{className:"text-[10px] text-gray-400",children:new Date(A.createdAt).toLocaleString()})]},A.id))]}),n.jsx("div",{className:"px-3 py-2 text-right text-xs",children:n.jsx("button",{onClick:G,className:"text-red-500 hover:underline",children:"Clear all"})})]})]}),n.jsxs("button",{onClick:()=>me(!0),className:"flex items-center text-blue-600 bg-blue-50 px-3 py-2 rounded hover:bg-blue-100",children:[n.jsx(Cu,{className:"w-4 h-4 mr-2"})," "]}),!1,n.jsxs("button",{onClick:a,className:"flex items-center text-red-600 hover:bg-red-50 px-4 py-2 rounded",children:[n.jsx(ch,{className:"w-4 h-4 mr-2"})," Logout"]})]})]}),z&&n.jsx(wv,{reports:t,currentUser:e,onMarkPaid:Rs}),se&&n.jsxs("div",{className:"mb-8 bg-panel border border-amber-200 rounded-2xl shadow p-6 space-y-4",children:[n.jsxs("div",{className:"flex items-center justify-between flex-wrap gap-3",children:[n.jsxs("div",{children:[n.jsxs("h3",{className:"text-lg font-bold text-amber-700 flex items-center gap-2",children:[n.jsx(dh,{className:"w-5 h-5"})," Expenses Overview"]}),n.jsx("p",{className:"text-sm text-textMuted",children:"Tracking all reports that include expense tables."})]}),n.jsxs("div",{className:"flex items-center gap-4 text-sm",children:[n.jsx("button",{onClick:()=>Te(!0),className:"text-xs text-amber-700 underline hover:text-amber-900",children:"Manage Favorite Providers"}),n.jsxs("div",{className:"text-center",children:[n.jsx("p",{className:"text-xs uppercase text-gray-400",children:"Assigned to Lawyers"}),n.jsx("p",{className:"text-xl font-bold text-amber-700",children:tt.length})]}),n.jsxs("div",{className:"text-center",children:[n.jsx("p",{className:"text-xs uppercase text-gray-400",children:"Waiting for Lior"}),n.jsx("p",{className:"text-xl font-bold text-blue-600",children:qt.length})]}),n.jsxs("div",{className:"text-center",children:[n.jsx("p",{className:"text-xs uppercase text-gray-400",children:"Sent to Insurer"}),n.jsx("p",{className:"text-xl font-bold text-green-600",children:At.length})]}),n.jsxs("div",{className:"text-center",children:[n.jsx("p",{className:"text-xs uppercase text-gray-400",children:"Total Sent Balance"}),n.jsxs("p",{className:"text-xl font-bold text-green-700",children:["",ie.toLocaleString()]})]})]})]}),n.jsx("div",{className:"overflow-x-auto",children:n.jsxs("table",{className:"w-full text-sm",children:[n.jsx("thead",{className:"bg-amber-50 text-amber-800",children:n.jsxs("tr",{children:[n.jsx("th",{className:"p-2 text-left",children:"Case / Lawyer"}),n.jsx("th",{className:"p-2 text-left",children:"Status"}),n.jsx("th",{className:"p-2 text-right",children:"Total Balance ()"}),n.jsx("th",{className:"p-2 text-right",children:"Action"})]})}),n.jsxs("tbody",{className:"divide-y",children:[de.length===0&&n.jsx("tr",{children:n.jsx("td",{colSpan:4,className:"p-4 text-center text-gray-400",children:"No expense reports yet."})}),de.map(A=>n.jsxs("tr",{className:"hover:bg-amber-50 transition",children:[n.jsxs("td",{className:"p-2",children:[n.jsx("div",{className:"font-semibold text-textLight",children:A.insuredName||"Unnamed Case"}),n.jsxs("div",{className:"text-xs text-textMuted",children:["Lawyer: ",A.ownerName]})]}),n.jsx("td",{className:"p-2",children:n.jsx("span",{className:`px-2 py-1 rounded-full text-[10px] font-bold uppercase tracking-wide shadow-sm border ${nt(A.status)}`,children:on(A.status)})}),n.jsxs("td",{className:"p-2 text-right font-bold",children:["",Hp(A).toLocaleString()]}),n.jsx("td",{className:"p-2 text-right",children:n.jsx("button",{onClick:()=>s(A.id),className:"text-lpBlue hover:underline text-xs font-bold",children:"Open"})})]},`expense-${A.id}`))]})]})})]}),!z&&Ue.length>0&&n.jsx("div",{className:"space-y-6 mb-8",children:Ue.map(A=>n.jsxs("div",{className:"bg-panel border rounded-2xl shadow-sm",children:[n.jsx("div",{className:"flex flex-wrap justify-between items-center gap-3 px-4 py-3 border-b",children:n.jsxs("div",{children:[n.jsx("h3",{className:"font-bold text-textLight",children:A.title}),n.jsx("p",{className:"text-sm text-textMuted",children:A.subtitle})]})}),A.items.length===0?n.jsx("div",{className:"p-6 text-center text-gray-400 text-sm",children:A.empty}):n.jsx("div",{className:"p-4 space-y-3",children:A.items.map(Ne=>{var ut;if(A.id==="sent"){const rt=Ne,Xt=rt.sentAt?new Date(rt.sentAt).toLocaleDateString("he-IL"):"",Cs=rt.isLatest&&rt.parent.status==="SENT"&&typeof b=="function",Jt=rt.isLatest&&rt.parent.status!=="SENT";return n.jsxs("div",{className:`border ${A.tone} rounded-xl p-4`,children:[n.jsxs("div",{className:"grid md:grid-cols-4 gap-4 text-sm text-textMuted",children:[n.jsxs("div",{children:[n.jsx("p",{className:"text-xs uppercase text-gray-400",children:" "}),n.jsx("p",{className:"font-bold text-textLight",children:rt.parent.odakanitNo||""})]}),n.jsxs("div",{children:[n.jsx("p",{className:"text-xs uppercase text-gray-400",children:" "}),n.jsx("p",{className:"font-bold text-textLight",children:rt.parent.insuredName||""})]}),n.jsxs("div",{children:[n.jsx("p",{className:"text-xs uppercase text-gray-400",children:rt.parent.plaintiffTitle}),n.jsx("p",{className:"font-bold text-textLight",children:rt.parent.plaintiffName||""})]}),n.jsxs("div",{children:[n.jsxs("p",{className:"text-xs uppercase text-gray-400",children:[" #",rt.reportNumber]}),n.jsx("p",{className:"font-bold text-textLight",children:Xt})]})]}),n.jsxs("div",{className:"mt-2 text-sm text-textMuted space-y-1",children:[n.jsxs("p",{children:[n.jsx("span",{className:"font-semibold text-textLight",children:":"})," ",rt.entry.subject||""]}),rt.entry.fileName&&n.jsxs("p",{className:"text-xs text-textMuted",children:[" : ",rt.entry.fileName]})]}),n.jsxs("div",{className:"mt-3 flex flex-wrap gap-2 justify-end",children:[Cs&&b&&n.jsx("button",{onClick:()=>b(rt.parent.id),className:"px-4 py-2 rounded-full bg-navy text-white text-sm font-semibold hover:bg-navySecondary",children:'" '}),Jt&&n.jsx("span",{className:"text-xs text-textMuted font-semibold px-3 py-1 rounded-full bg-navySecondary",children:'"  '})]})]},`${rt.parent.id}-${rt.entry.id}`)}const Oe=Ne,Ce=typeof Oe.reportNumber=="number"&&Oe.reportNumber>0?Oe.reportNumber:(((ut=Oe.reportHistory)==null?void 0:ut.length)||0)+1;return n.jsxs("div",{className:`border ${A.tone} rounded-xl p-4`,children:[n.jsxs("div",{className:"grid md:grid-cols-4 gap-4 text-sm text-textMuted",children:[n.jsxs("div",{children:[n.jsx("p",{className:"text-xs uppercase text-gray-400",children:" "}),n.jsx("p",{className:"font-bold text-textLight",children:Oe.odakanitNo||""})]}),n.jsxs("div",{children:[n.jsx("p",{className:"text-xs uppercase text-gray-400",children:" "}),n.jsx("p",{className:"font-bold text-textLight",children:Oe.plaintiffName||""})]}),n.jsxs("div",{children:[n.jsx("p",{className:"text-xs uppercase text-gray-400",children:" "}),n.jsx("p",{className:"font-bold text-textLight",children:Oe.insuredName||""})]}),n.jsxs("div",{children:[n.jsx("p",{className:"text-xs uppercase text-gray-400",children:" "}),n.jsxs("p",{className:"font-bold text-textLight",children:["#",Ce]})]})]}),A.id==="followup"&&n.jsx("div",{className:"mt-2 text-xs text-textMuted",children:(()=>{var Cs;const rt=(Cs=Oe.reportHistory)==null?void 0:Cs[Oe.reportHistory.length-1],Xt=rt!=null&&rt.date?new Date(rt.date).toLocaleDateString("he-IL"):Oe.sentAt?new Date(Oe.sentAt).toLocaleDateString("he-IL"):"";return`"  : #${(rt==null?void 0:rt.reportNumber)||Ce-1}  ${Xt}`})()}),n.jsxs("div",{className:"mt-3 flex flex-wrap gap-2 justify-end",children:[A.id==="finance"&&ps(Oe)&&n.jsxs("button",{onClick:()=>$n(Oe),className:"px-3 py-2 rounded-full border border-red-200 text-red-600 text-sm font-semibold flex items-center gap-1 hover:bg-red-50",title:"  ",children:[n.jsx(Bs,{className:"w-4 h-4"}),""]}),A.action&&n.jsx("button",{onClick:()=>A.action&&A.action(Oe),className:"px-4 py-2 rounded-full bg-navy text-white text-sm font-semibold hover:bg-navySecondary",children:A.actionLabel})]})]},Oe.id)})})]},A.id))}),z&&n.jsxs("div",{className:"mb-8",children:[n.jsx("div",{className:"flex justify-between items-end mb-4",children:n.jsxs("h3",{className:"text-lg font-bold text-textLight flex items-center",children:[n.jsx(lh,{className:"w-6 h-6 mr-2 text-indigo-600"})," Active Case Folders"]})}),n.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[U.length===0&&n.jsx("p",{className:"text-gray-400 italic col-span-3 text-center py-4",children:"No active finance folders."}),U.map(A=>{var Ce;const Ne=(()=>{switch(A.status){case"WAITING_FOR_INVOICES":return{badge:"bg-yellow-50 text-yellow-700",text:"Awaiting Finance Finalize",icon:n.jsx(Mt,{className:"text-yellow-500 w-5 h-5 animate-spin"})};case"TASK_ASSIGNED":return{badge:"bg-blue-50 text-blue-700",text:"Pending Lawyer Action",icon:n.jsx(ah,{className:"text-blue-500 w-5 h-5"})};case"READY_TO_SEND":return{badge:"bg-orange-50 text-orange-700",text:"Waiting for Lior",icon:n.jsx(Mt,{className:"text-orange-500 w-5 h-5 animate-spin"})};case"SENT":return{badge:"bg-green-50 text-green-700",text:"Completed",icon:n.jsx(oh,{className:"text-green-500 w-6 h-6"})};default:return{badge:"bg-navySecondary text-textMuted",text:A.status,icon:n.jsx(Mt,{className:"text-gray-400 w-5 h-5 animate-spin"})}}})(),Oe=(Ce=Ss.find(ut=>ut.id===A.createdBy))==null?void 0:Ce.name;return n.jsxs("div",{className:"bg-panel p-4 rounded-lg shadow border-t-4 relative border-indigo-100",children:[n.jsxs("div",{className:"flex justify-between items-start mb-2",children:[n.jsxs("h4",{className:"font-bold text-lg",children:["Case #",A.odakanitNo]}),Ne.icon]}),n.jsxs("div",{className:"text-sm text-textMuted mb-1 flex items-center",children:[n.jsx(H0,{className:"w-4 h-4 mr-1"})," Assigned to: ",Oe]}),n.jsx("div",{className:"text-xs text-textMuted mb-4",children:new Date(A.reportDate).toLocaleDateString()}),n.jsx("div",{className:"flex justify-end gap-2 mt-2",children:A.status==="SENT"?n.jsxs("button",{onClick:()=>l(A.id),className:"text-red-500 hover:bg-red-50 px-3 py-1 rounded text-sm flex items-center",children:[n.jsx(Bs,{className:"w-4 h-4 mr-1"})," Delete Folder"]}):n.jsx("span",{className:`text-xs font-bold px-2 py-1 rounded ${Ne.badge}`,children:Ne.text})})]},A.id)})]})]}),(z||je)&&n.jsxs("div",{className:"bg-panel rounded-xl shadow-sm border border-borderDark overflow-hidden",children:[n.jsxs("div",{className:"p-4 border-b border-gray-100 bg-navySecondary/50 flex flex-wrap gap-3 items-center justify-between",children:[n.jsxs("h3",{className:"font-bold text-textLight flex items-center",children:[n.jsx(ih,{className:"w-4 h-4 mr-2 text-gray-400"})," ",ce?"Recycle Bin":"All Reports"]}),n.jsxs("div",{className:"flex items-center gap-3 flex-wrap justify-end",children:[ce&&We&&n.jsx("span",{className:"text-xs text-textMuted",children:We}),n.jsxs("div",{className:"relative w-full sm:w-72",children:[n.jsx(P0,{className:"w-4 h-4 text-gray-400 absolute left-3 top-1/2 -translate-y-1/2"}),n.jsx("input",{value:Ye,onChange:A=>Ve(A.target.value),placeholder:"     ",className:"w-full border border-borderDark rounded-full pl-9 pr-10 py-1.5 text-sm focus:ring-2 focus:ring-blue-200 outline-none"}),Ye&&n.jsx("button",{onClick:()=>Ve(""),className:"absolute right-3 top-1/2 -translate-y-1/2 text-gray-400 hover:text-red-500",children:n.jsx(Ft,{className:"w-4 h-4"})})]})]})]}),je?n.jsxs("table",{className:"w-full text-left",children:[n.jsx("thead",{className:"bg-navySecondary text-textMuted text-xs uppercase tracking-wider font-semibold",children:n.jsxs("tr",{children:[n.jsx("th",{className:"p-4",children:"Insurer / Subject"}),z&&n.jsx("th",{className:"p-4",children:"Lawyer"}),n.jsx("th",{className:"p-4",children:"Status"}),n.jsx("th",{className:"p-4 text-right",children:"Action"})]})}),n.jsxs("tbody",{className:"divide-y divide-gray-100",children:[Qn.length===0&&n.jsx("tr",{children:n.jsx("td",{colSpan:z?4:3,className:"p-6 text-center text-gray-400 text-sm",children:In?"    .":"  ."})}),Qn.map(A=>{const Ne=A.status==="READY_TO_SEND",Oe=A.status==="SENT",Ce=!!A.__templateKey;return n.jsxs("tr",{className:`transition cursor-default ${Ne?"bg-red-50":Oe?"bg-green-50/50":"hover:bg-blue-50/30"}`,children:[n.jsxs("td",{className:"p-4",children:[n.jsx("div",{className:"font-bold text-textLight",children:A.insurerName||"Untitled"}),n.jsxs("div",{className:"text-xs text-textMuted",children:[A.marketRef," ",A.insuredName?` - ${A.insuredName}`:""]})]}),z&&n.jsx("td",{className:"p-4 text-sm text-textMuted font-medium",children:A.ownerName}),n.jsx("td",{className:"p-4",children:n.jsx("span",{className:`px-2.5 py-1 rounded-full text-[10px] font-bold uppercase tracking-wide shadow-sm border ${nt(A.status)}`,children:on(A.status)})}),n.jsx("td",{className:"p-4 text-right",children:n.jsxs("div",{className:"flex justify-end gap-2 flex-wrap",children:[n.jsxs(n.Fragment,{children:[n.jsxs("button",{onClick:()=>N(A.id),className:"text-xs bg-navySecondary hover:bg-borderDark px-3 py-1.5 rounded flex items-center gap-1",children:[n.jsx(uh,{className:"w-3 h-3"})," View Expenses"]}),n.jsxs("button",{onClick:()=>h(A),className:"text-xs bg-blue-50 text-blue-700 hover:bg-blue-100 px-3 py-1.5 rounded flex items-center gap-1",children:[n.jsx(Xl,{className:"w-3 h-3"})," Reminder"]}),n.jsxs("button",{onClick:()=>S(A),className:"text-xs bg-purple-50 text-purple-700 hover:bg-purple-100 px-3 py-1.5 rounded flex items-center gap-1",children:[n.jsx(Lu,{className:"w-3 h-3"})," Add Note"]})]}),F&&!X&&!ce&&n.jsxs("button",{onClick:()=>!Ce&&M(A.id),disabled:Ce,className:`text-xs px-3 py-1.5 rounded flex items-center gap-1 ${Ce?"bg-navySecondary text-gray-400 cursor-not-allowed":"bg-red-50 text-red-700 hover:bg-red-100"}`,children:[n.jsx(Bs,{className:"w-3 h-3"})," Delete"]}),ce&&n.jsxs(n.Fragment,{children:[X&&n.jsx("button",{onClick:()=>o(A.id,{sentAt:new Date().toISOString()}),className:"text-green-600 hover:bg-green-50 px-3 py-1.5 rounded text-sm font-bold",children:"Restore"}),!X&&F&&n.jsx("button",{onClick:()=>H(A.id),className:"text-green-600 hover:bg-green-50 px-3 py-1.5 rounded text-sm font-bold",children:"Restore"})]})]})})]},A.id)})]})]}):n.jsx("div",{children:Bn.length===0?n.jsx("div",{className:"p-6 text-center text-gray-400 text-sm",children:In?"    .":"  ."}):n.jsx("div",{className:"divide-y divide-gray-100",children:Bn.map(A=>{const Ne=A.latestDate?new Date(A.latestDate).toLocaleDateString("he-IL"):"-",Oe=[...A.reports].sort((Ce,ut)=>{const rt=Ce.reportDate?new Date(Ce.reportDate).getTime():0;return(ut.reportDate?new Date(ut.reportDate).getTime():0)-rt});return n.jsxs("div",{className:"p-4",children:[n.jsxs("div",{className:"flex flex-wrap justify-between gap-3",children:[n.jsxs("div",{children:[n.jsx("p",{className:"text-xs uppercase text-gray-400",children:" "}),n.jsx("p",{className:"text-xl font-bold text-textLight",children:A.odakanitNo||""}),n.jsxs("p",{className:"text-xs text-textMuted",children:[" : ",n.jsx("span",{className:"font-semibold",children:A.plaintiffName||""}),"   : ",n.jsx("span",{className:"font-semibold",children:A.insuredName||""})]}),n.jsxs("p",{className:"text-xs text-gray-400",children:[" : ",Ne]})]}),n.jsxs("div",{className:"text-right",children:[n.jsx("p",{className:"text-xs text-textMuted",children:'" '}),n.jsx("p",{className:"text-2xl font-bold text-textLight",children:A.reports.length}),n.jsx("button",{onClick:()=>ct(Ce=>Ce===A.key?null:A.key),className:"mt-2 px-4 py-1.5 text-sm font-semibold rounded-full border border-borderDark text-textLight hover:bg-navySecondary",children:He===A.key?" ":" "})]})]}),He===A.key&&n.jsx("div",{className:"mt-4 bg-navySecondary border border-borderDark rounded-xl overflow-hidden",children:n.jsxs("table",{className:"w-full text-sm",children:[n.jsx("thead",{className:"bg-navySecondary text-textMuted text-xs uppercase tracking-wide",children:n.jsxs("tr",{children:[n.jsx("th",{className:"p-3 text-left",children:" "}),n.jsx("th",{className:"p-3 text-left",children:" "}),n.jsx("th",{className:"p-3 text-left",children:" "}),n.jsx("th",{className:"p-3 text-left",children:""}),n.jsx("th",{className:"p-3 text-right",children:""})]})}),n.jsx("tbody",{className:"divide-y divide-gray-200",children:Oe.map(Ce=>{const ut=Ce.status==="READY_TO_SEND",rt=Ce.status==="SENT",Xt=!!Ce.__templateKey;return n.jsxs("tr",{className:`bg-panel ${ut?"bg-red-50":rt?"bg-green-50/60":""}`,children:[n.jsx("td",{className:"p-3",children:Ce.reportDate?new Date(Ce.reportDate).toLocaleDateString("he-IL"):""}),n.jsx("td",{className:"p-3",children:Ce.plaintiffName||""}),n.jsx("td",{className:"p-3",children:Ce.insuredName||""}),n.jsx("td",{className:"p-3",children:n.jsx("span",{className:`px-2.5 py-1 rounded-full text-[10px] font-bold uppercase tracking-wide shadow-sm border ${nt(Ce.status)}`,children:on(Ce.status)})}),n.jsx("td",{className:"p-3 text-right",children:n.jsxs("div",{className:"flex justify-end gap-2 flex-wrap",children:[n.jsxs("button",{onClick:()=>s(Ce.id),className:"text-lpBlue hover:bg-blue-50 px-3 py-1.5 rounded transition font-bold text-xs flex items-center",children:["Open ",n.jsx(os,{className:"w-3 h-3 ml-1"})]}),F&&!X&&!ce&&n.jsxs("button",{onClick:()=>!Xt&&M(Ce.id),disabled:Xt,className:`text-xs px-3 py-1.5 rounded flex items-center gap-1 ${Xt?"bg-navySecondary text-gray-400 cursor-not-allowed":"bg-red-50 text-red-700 hover:bg-red-100"}`,children:[n.jsx(Bs,{className:"w-3 h-3"})," Delete"]}),ce&&n.jsxs(n.Fragment,{children:[X&&n.jsx("button",{onClick:()=>o(Ce.id,{sentAt:new Date().toISOString()}),className:"text-green-600 hover:bg-green-50 px-3 py-1.5 rounded text-xs font-bold",children:"Restore"}),!X&&F&&n.jsx("button",{onClick:()=>H(Ce.id),className:"text-green-600 hover:bg-green-50 px-3 py-1.5 rounded text-xs font-bold",children:"Restore"})]})]})})]},Ce.id)})})]})})]},A.key)})})})]}),!z&&n.jsx("div",{className:"fixed bottom-8 right-8",children:n.jsx("button",{onClick:r,className:"bg-navy text-white p-4 rounded-full shadow-xl hover:bg-navySecondary transition transform hover:scale-110",children:n.jsx(C0,{className:"w-6 h-6"})})})]})]})},Hv=({onLogin:e})=>{const[t,s]=g.useState(""),[r,a]=g.useState(""),[o,l]=g.useState(!1),c=async()=>{if(!t||!r){alert("    .");return}l(!0);try{const i=await fetch("/api/login",{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({username:t,password:r})});if(!i.ok){const p=await i.json().catch(()=>({})),y=(p==null?void 0:p.error)||"    .";alert(y);return}const u=await i.json();u&&u.user?e(u.user):alert("Login response was invalid.")}catch(i){console.error("Login failed",i),alert("  (  ?).  .")}finally{l(!1)}};return n.jsx("div",{className:"min-h-screen flex items-center justify-center px-4 bg-bgDark",children:n.jsxs("div",{className:"w-full max-w-sm bg-panel border border-borderDark rounded-2xl p-10 text-center shadow-2xl",children:[n.jsx("div",{className:"mx-auto mb-6 h-20 w-20 rounded-full bg-gold/20 border border-gold flex items-center justify-center text-4xl font-bold text-gold shadow-lg",children:"LP"}),n.jsx("div",{className:"text-sm tracking-[0.5em] text-gold uppercase mb-2",children:"Lloyd's"}),n.jsx("div",{className:"text-3xl font-serif text-textLight mb-1",children:"REPORT"}),n.jsx("div",{className:"text-xs text-textMuted uppercase tracking-[0.4em] mb-8",children:"Builder System"}),n.jsxs("div",{className:"space-y-4 text-left",children:[n.jsx("label",{className:"text-xs uppercase text-textMuted tracking-[0.2em]",children:"Username"}),n.jsxs("div",{className:"relative",children:[n.jsx(U0,{className:"w-4 h-4 text-gold absolute left-3 top-1/2 -translate-y-1/2"}),n.jsx("input",{className:"w-full bg-navy border border-borderDark rounded-full py-3 pl-10 pr-4 text-textLight placeholder-textMuted focus:outline-none focus:ring-2 focus:ring-gold/50",placeholder:"Username",value:t,onChange:i=>s(i.target.value)})]}),n.jsx("label",{className:"text-xs uppercase text-textMuted tracking-[0.2em]",children:"Password"}),n.jsxs("div",{className:"relative",children:[n.jsx(_0,{className:"w-4 h-4 text-gold absolute left-3 top-1/2 -translate-y-1/2"}),n.jsx("input",{type:"password",className:"w-full bg-navy border border-borderDark rounded-full py-3 pl-10 pr-4 text-textLight placeholder-textMuted focus:outline-none focus:ring-2 focus:ring-gold/50",placeholder:"Password",value:r,onChange:i=>a(i.target.value)})]})]}),n.jsxs("button",{onClick:c,disabled:o,className:"mt-8 w-full bg-navy text-gold border border-gold py-3 rounded-full font-semibold tracking-wide flex items-center justify-center gap-2 hover:bg-navySecondary transition-colors disabled:opacity-60 disabled:cursor-not-allowed",children:[o?"Signing in":"Sign In"," ",n.jsx(ah,{className:"w-4 h-4"})]}),n.jsx("div",{className:"mt-6 text-[11px] text-textMuted tracking-[0.3em] uppercase",children:"Lior Perry Law Office & Notary  2024"})]})})},Uv=()=>{var ee,ue;const[e,t]=g.useState(null),[s,r]=g.useState(!1),[a,o]=g.useState(()=>Dv()),[l,c]=g.useState(()=>Cv()),[i,u]=g.useState(null),p=g.useRef(l),y=g.useRef(i),[b,w]=g.useState(null);console.log("AppInner render",{currentUser:e,view:a,reportsCount:l.length});const R=g.useRef(!1),[E,W]=g.useState(null),[N,h]=g.useState([]),[S,M]=g.useState(!1);e==null||e.role;const[H,V]=g.useState(()=>{if(typeof window>"u")return[];try{const d=window.localStorage.getItem(pt.NOTIFICATIONS),m=d?JSON.parse(d):[];return Array.isArray(m)?m.filter(x=>x&&typeof x.id=="string"&&typeof x.message=="string"&&typeof x.createdAt=="string"):[]}catch{return[]}}),[q,te]=g.useState(!1),[G,re]=g.useState(!1),[j,P]=g.useState([]),[D,O]=g.useState(null),[z,F]=g.useState(()=>{if(typeof window>"u")return{};try{const d=localStorage.getItem("favoriteProviders");return d?JSON.parse(d):{}}catch(d){return console.error("Failed to load favorite providers",d),{}}});g.useEffect(()=>{let d=!1;return fetch("/api/me",{credentials:"include"}).then(m=>m.ok?m.json():null).then(m=>{!d&&(m!=null&&m.user)&&t(m.user)}).catch(()=>{}).finally(()=>{d||r(!0)}),()=>{d=!0}},[]),g.useEffect(()=>{if(!(typeof window>"u"))try{window.localStorage.setItem(pt.NOTIFICATIONS,JSON.stringify(H))}catch{}},[H]);const[C,L]=g.useState(null),[Q,me]=g.useState(""),[ce,le]=g.useState(null),[fe,Te]=g.useState(""),[ge,Be]=g.useState("LAWYER"),[Ye,Ve]=g.useState(!1),[He,ct]=g.useState(!1),[X,se]=g.useState(!1),[I,ae]=g.useState(!1),[ne,ye]=g.useState(!1),[Pe,ke]=g.useState(!1),[De,Qe]=g.useState(!1),[Ke,Fe]=g.useState(!1),[Z,ve]=g.useState(!1),[xe,Se]=g.useState(null),[Me,_e]=g.useState(null),[Ue,U]=g.useState(()=>{if(typeof window>"u")return[];try{const d=localStorage.getItem("caseTemplates");return d?JSON.parse(d):[]}catch(d){return console.error("Failed to load case templates",d),[]}}),[J,he]=g.useState(null),[Re,de]=g.useState(""),[je,Ze]=g.useState(!1),[We,tt]=g.useState(null),[qt,At]=g.useState(void 0);g.useEffect(()=>{if(!i&&b!==null){w(null);return}i&&b&&i.id!==b&&w(null)},[i,b]),g.useEffect(()=>{typeof window>"u"||av()||l.length&&nt(d=>{const m=Oc(d,l);return Tn(m),rv(),m})},[l]);const[ie,nt]=g.useState(()=>{const d=nv(),m=sv(d);return m!==d&&Tn(m),m}),on=g.useRef(ie);g.useEffect(()=>{p.current=l,y.current=i,on.current=ie},[l,i,ie]),g.useEffect(()=>{if(typeof window>"u"||!e)return;const d=m=>{const x=p.current,k=y.current;if(on.current,x&&k){const v=[...x],_=v.findIndex(B=>B.id===k.id),$=_>=0?{...v[_],...k}:k;_>=0?v[_]=$:v.push($);try{localStorage.setItem(pt.REPORTS,JSON.stringify(v))}catch(B){console.error("beforeunload save failed",B)}}(x!=null&&x.length||k)&&(m.preventDefault(),m.returnValue="")};return window.addEventListener("beforeunload",d),()=>window.removeEventListener("beforeunload",d)},[e]),g.useEffect(()=>{a!=="PREVIEW"&&M(!1)},[a]);const Rs=d=>d?d==="SUB_ADMIN"?"OPS":d==="FINANCE"||d==="LAWYER"||d==="ADMIN"?d:"LAWYER":"LAWYER",lt=d=>d.deletedAt?Date.now()-new Date(d.deletedAt).getTime()>=$h:d.status==="SENT"&&d.sentAt?Date.now()-new Date(d.sentAt).getTime()>=Bh:!1;g.useEffect(()=>{const d=()=>{c(x=>x.filter(k=>!lt(k)))};d();const m=setInterval(d,60*60*1e3);return()=>clearInterval(m)},[]),g.useEffect(()=>{if(!G)return;const d=setInterval(()=>{if(!l.length)return;const m=l.filter(v=>v.status==="READY_TO_SEND").length,x=l.filter(v=>v.status==="SENT").length,k=`Daily summary: ${m} ready to send, ${x} sent reports.`;V(v=>[{id:`daily-${Date.now()}`,message:k,createdAt:new Date().toISOString(),severity:"info"},...v])},1e3*60*60*12);return()=>clearInterval(d)},[G,l]),g.useEffect(()=>{try{localStorage.setItem("caseTemplates",JSON.stringify(Ue))}catch(d){console.error("Failed to persist case templates",d)}},[Ue]),g.useEffect(()=>{try{localStorage.setItem("favoriteProviders",JSON.stringify(z))}catch(d){console.error("Failed to persist favorites",d)}},[z]);const ms=async d=>{if(!e||!i){Fe(!0),Se(null),_e({title:"   ",bullets:["           .","  ,         .","  ,          ."]});return}const m=a==="STEP2"?2:a==="PREVIEW"?3:1,x=a==="STEP1"?"Step1":a==="STEP2"?"Step2Draft":a==="PREVIEW"?"Step3Preview":"Dashboard",k={step:m,role:Rs(e.role),screen:x,section:m===2&&qt?qt:void 0},v={hebrewApproved:i.hebrewWorkflowStatus==="HEBREW_APPROVED",hasTranslation:!!i.isTranslated,translationOutdated:!!i.translationStale,toneRiskRun:!!i.toneRiskLastRunAt,expensesLastUpdatedAt:i.expensesSnapshotAt||void 0};Fe(!0),ve(!0),Se(null);try{const _=await Z0({intent:d,context:k,reportMeta:v});_e(_)}catch(_){console.error("Smart assistant request failed",_),Se("REQUEST_FAILED"),_e(null)}finally{ve(!1)}},Jn=(d,m)=>{if(!d||!m)return[];const x=[];d.translationStale&&x.push({id:"translation-outdated",kind:"TRANSLATION_OUTDATED",label:"       (translationStale=true).     .",intent:"pre_send_checks"});const k=m.role;return(k==="LAWYER"||k==="ADMIN")&&!d.toneRiskLastRunAt&&x.push({id:"tone-risk-not-run",kind:"TONE_RISK_NOT_RUN",label:"   Tone & Risk  .       .",intent:"explain_tone_risk"}),x};g.useEffect(()=>{let d=!1;return(async()=>{var _;if(typeof window>"u")return;const x=l.filter($=>!!$.expensesSheetId&&!$.expensesHtml&&!$.expensesHtmlMissing);if(!x.length)return;let k=!1;const v=[...l];for(const $ of x)try{const B=await Ge.getSheet($.expensesSheetId);if(B&&B.sheet&&((_=B.lineItems)!=null&&_.length)){const Y=Ge.buildCumulativeExpensesSnapshot(B.sheet.id,new Date().toISOString());if(!Y)continue;const{effectiveSheet:oe,allLines:Ee,opts:be}=Y,{html:ze}=si(oe,Ee,be);if(ze){const qe=v.findIndex(Xe=>Xe.id===$.id);qe!==-1&&(v[qe]={...v[qe],expensesHtml:ze},k=!0)}}else{const Y=v.findIndex(oe=>oe.id===$.id);Y!==-1&&(v[Y]={...v[Y],expensesHtmlMissing:!0},k=!0)}}catch(B){console.error("Failed to migrate expensesHtml for report",$.id,B);const Y=v.findIndex(oe=>oe.id===$.id);Y!==-1&&(v[Y]={...v[Y],expensesHtmlMissing:!0},k=!0)}!d&&k&&c(v)})(),()=>{d=!0}},[l]),g.useEffect(()=>{if(!(typeof window>"u"))try{localStorage.setItem(pt.REPORTS,JSON.stringify(l))}catch(d){console.error("Failed to persist reports",d)}},[l]),g.useEffect(()=>{typeof window>"u"||(e?localStorage.setItem(pt.USER,e.username):localStorage.removeItem(pt.USER))},[e]),g.useEffect(()=>{typeof window>"u"||localStorage.setItem(pt.VIEW,a)},[a]),g.useEffect(()=>{typeof window>"u"||(i?localStorage.setItem(pt.CURRENT_REPORT,i.id):localStorage.removeItem(pt.CURRENT_REPORT))},[i]),g.useEffect(()=>{if(typeof window>"u"||R.current)return;const d=localStorage.getItem(pt.CURRENT_REPORT);if(!d){R.current=!0;return}const m=l.find(x=>x.id===d);if(m){const x=!!(m.expensesSheetId||m.expensesHtml);let k=m;if(x&&Array.isArray(m.selectedSections)&&!m.selectedSections.some(v=>Qr(v))){const v=[...m.selectedSections],_=v.includes("Update"),$=v.includes("Recommendations"),B=_?Math.min(v.indexOf("Update")+1,$?v.indexOf("Recommendations"):v.length):0;v.splice(B,0,Xa),k={...m,selectedSections:Array.from(new Set(v))}}u(k)}R.current=!0},[l,e]),g.useEffect(()=>{a==="DASHBOARD"||a==="CASE_FOLDER"||i||(o("DASHBOARD"),typeof window<"u"&&(localStorage.setItem(pt.VIEW,"DASHBOARD"),localStorage.removeItem(pt.CURRENT_REPORT)))},[i,a]);const An=()=>({id:Date.now().toString(),createdBy:e.id,ownerName:e.name,ownerEmail:e.email,reportNumber:1,reportDate:new Date().toISOString(),updatedAt:new Date().toISOString(),status:"DRAFT",reportSubject:"",recipientId:"1",insurerName:"",lineSlipNo:"",marketRef:"",certificateRef:"",insuredName:"",plaintiffName:"",plaintiffTitle:"Plaintiff",policyPeriodStart:"",policyPeriodEnd:"",retroStart:"",retroEnd:"",sentAt:void 0,reportHistory:[],selectedTimeline:"standard",filenameTag:fh[0],selectedSections:["Update","Recommendations"],content:{},translatedContent:{},invoiceFiles:[],isWaitingForInvoices:!1,requiresExpenses:!1,isTranslated:!1,expensesItems:[],expenseWorksheet:Ms(),reportNotes:[],complaintAnalysis:void 0,attachPolicyAsAppendix:!0}),wr=({odakanitNo:d,reports:m,caseFolder:x})=>{var $;const k=we(d);if(!k)return 1;const v=[];return($=x==null?void 0:x.sentReports)!=null&&$.length&&x.sentReports.forEach(B=>{typeof B.reportNo=="number"&&B.reportNo>0&&v.push(B.reportNo)}),m.forEach(B=>{var Y;if(we(B.odakanitNo)===k&&B.status==="SENT")if(typeof B.reportNumber=="number"&&B.reportNumber>0)v.push(B.reportNumber);else{const oe=(((Y=B.reportHistory)==null?void 0:Y.length)||0)+1;v.push(oe)}}),(v.length?Math.max(...v):0)+1},nr=d=>{const m=d.createdBy||"unknown",x=d.odakanitNo||d.marketRef||d.id,k=(d.plaintiffName||"unknown").toLowerCase();return`${m}::${x}::${k}`},In=d=>{const m=nr(d),x={caseKey:m,ownerId:d.createdBy,ownerName:d.ownerName,odakanitNo:d.odakanitNo,plaintiffName:d.plaintiffName,plaintiffTitle:d.plaintiffTitle,insurerName:d.insurerName,lineSlipNo:d.lineSlipNo,marketRef:d.marketRef,certificateRef:d.certificateRef,insuredName:d.insuredName,policyPeriodStart:d.policyPeriodStart,policyPeriodEnd:d.policyPeriodEnd,retroStart:d.retroStart,retroEnd:d.retroEnd,lastUpdated:new Date().toISOString()};U(k=>k.find(_=>_.caseKey===m)?k.map(_=>_.caseKey===m?x:_):[...k,x])},sr=d=>{if(!e)return;const m=Ue.find(k=>k.caseKey===d&&k.ownerId===e.id);if(!m)return;const x={...An(),odakanitNo:m.odakanitNo||"",insurerName:m.insurerName||"",lineSlipNo:m.lineSlipNo||"",marketRef:m.marketRef||"",certificateRef:m.certificateRef||"",insuredName:m.insuredName||"",plaintiffName:m.plaintiffName||"",plaintiffTitle:m.plaintiffTitle||"Plaintiff",policyPeriodStart:m.policyPeriodStart||"",policyPeriodEnd:m.policyPeriodEnd||"",retroStart:m.retroStart||"",retroEnd:m.retroEnd||""};u(x),o("STEP1")},Qn=d=>{var oe;if(!e)return;const m=Bn(d);if(!m||m.createdBy!==e.id||(((oe=m.reportHistory)==null?void 0:oe.length)||0)===0||m.status!=="SENT")return;const x=m.reportHistory[m.reportHistory.length-1];if(!x)return;const v=x.snapshot||m,_=v.selectedSections&&v.selectedSections.length?[...v.selectedSections]:[...m.selectedSections||[]],$=_.length?_:["Update","Recommendations"],B=new Date().toISOString(),Y={...m,reportDate:B,updatedAt:B,status:"DRAFT",sentAt:void 0,reportNotes:[],content:{},translatedContent:{},executiveSummary:void 0,complaintAnalysis:void 0,expensesItems:[],expensesSum:void 0,paymentRecommendation:void 0,expenseWorksheet:Ms(),invoiceFiles:[],expensesSourceFile:void 0,requiresExpenses:!1,isWaitingForInvoices:!1,isTranslated:!1,selectedEmailTemplate:void 0,emailBodyDraft:void 0,fileNameTitles:[],deletedAt:void 0,deletedBy:void 0,selectedSections:$,reportHistory:[...m.reportHistory||[]]};Y.insurerName=v.insurerName||"",Y.lineSlipNo=v.lineSlipNo||"",Y.marketRef=v.marketRef||"",Y.certificateRef=v.certificateRef||"",Y.insuredName=v.insuredName||"",Y.plaintiffName=v.plaintiffName||"",Y.plaintiffTitle=v.plaintiffTitle||m.plaintiffTitle,Y.policyPeriodStart=v.policyPeriodStart||"",Y.policyPeriodEnd=v.policyPeriodEnd||"",Y.retroStart=v.retroStart||"",Y.retroEnd=v.retroEnd||"",Y.filenameTag=v.filenameTag||Y.filenameTag,Y.fileNameTitles=[],Y.selectedTimeline=v.selectedTimeline||Y.selectedTimeline,Y.selectedTimelineImage=v.selectedTimelineImage,Y.odakanitNo=v.odakanitNo||m.odakanitNo,Y.recipientId=v.recipientId||m.recipientId,c(Ee=>Ee.map(be=>be.id===m.id?Y:be)),u(Y),In(Y),o("STEP1")},Bn=d=>l.find(m=>m.id===d),ps=(d,m)=>{if(d.status!==m.status||d.hebrewWorkflowStatus!==m.hebrewWorkflowStatus||d.insuredName!==m.insuredName||d.plaintiffName!==m.plaintiffName||d.insurerName!==m.insurerName||d.odakanitNo!==m.odakanitNo||d.marketRef!==m.marketRef||d.lineSlipNo!==m.lineSlipNo||d.certificateRef!==m.certificateRef||d.policyPeriodStart!==m.policyPeriodStart||d.policyPeriodEnd!==m.policyPeriodEnd||d.retroStart!==m.retroStart||d.retroEnd!==m.retroEnd||d.reportSubject!==m.reportSubject||d.executiveSummary!==m.executiveSummary)return!0;const x=(k,v)=>JSON.stringify(k)===JSON.stringify(v);return!x(d.content,m.content)||!x(d.translatedContent,m.translatedContent)||!x(d.expenseWorksheet,m.expenseWorksheet)||!x(d.expensesItems,m.expensesItems)||d.expensesSum!==m.expensesSum||d.paymentRecommendation!==m.paymentRecommendation||!x(d.complaintAnalysis,m.complaintAnalysis)||!x(d.reportReview,m.reportReview)},$n=(d,m)=>{d.odakanitNo&&nt(x=>{const k=Od(x,d,m);return Tn(k),k})},A=(d,m,x,k)=>{d.odakanitNo&&nt(v=>{const _=Ph(v,d,m,x,k);return Tn(_),_})},Ne=d=>{var x;return(x=d==null?void 0:d.sentReports)!=null&&x.length?d.sentReports.map((k,v)=>{var Y,oe;const _=typeof k.reportNo=="number"&&k.reportNo>0?k.reportNo:v+1,$=k.sentAt||((Y=k.snapshot)==null?void 0:Y.reportDate)||"",B=((oe=k.snapshot)==null?void 0:oe.reportSubject)||k.fileName||"";return!B||!$?null:{id:k.reportId,reportNumber:_,subject:B,date:$,sent:!0,fileName:k.fileName,snapshot:k.snapshot}}).filter(k=>!!k).sort((k,v)=>k.reportNumber-v.reportNumber):[]},Oe=(d,m)=>{const x=d.reportReview??{status:"DRAFT",issues:[]};return{...d,reportReview:m(x)}},Ce=d=>{Rt(d,m=>{const x=(e==null?void 0:e.id)||"unknown",k=new Date().toISOString();return{...Oe(m,_=>({..._,status:"SUBMITTED",submittedAt:k,submittedByUserId:_.submittedByUserId||x})),hebrewWorkflowStatus:"HEBREW_SUBMITTED"}})},ut=d=>{(e==null?void 0:e.role)==="ADMIN"&&Rt(d,m=>{const x=(e==null?void 0:e.id)||"unknown",k=new Date().toISOString();return{...Oe(m,_=>({..._,status:"APPROVED",reviewedAt:k,reviewedByUserId:x})),hebrewWorkflowStatus:"HEBREW_APPROVED"}})},rt=(d,m)=>{m.length&&Rt(d,x=>{const k=(e==null?void 0:e.id)||"unknown",v=new Date().toISOString();return{...Oe(x,$=>({...$,status:"CHANGES_REQUESTED",reviewedAt:v,reviewedByUserId:k,issues:[...$.issues,...m.map(B=>({id:`issue-${Date.now()}-${Math.random().toString(36).slice(2)}`,createdAt:v,createdByUserId:k,sectionKey:B.sectionKey,severity:B.severity,type:B.type,title:B.title,instruction:B.instruction,status:"OPEN"}))]})),hebrewWorkflowStatus:"HEBREW_CHANGES_REQUESTED"}})},Xt=(d,m)=>{Rt(d,x=>{const k=new Date().toISOString();return Oe(x,v=>({...v,issues:v.issues.map(_=>_.id===m&&_.status!=="DONE"?{..._,status:"DONE",doneAt:k}:_)}))})},Cs=d=>{(e==null?void 0:e.role)==="ADMIN"&&Rt(d,m=>{const x=new Date().toISOString();return Oe(m,k=>({...k,issues:k.issues.map(v=>(v.origin??"INTERNAL")==="EXTERNAL"&&v.status!=="DONE"?{...v,status:"DONE",doneAt:x}:v)}))})},Jt=d=>{var x;return d?((x=d.reportReview)==null?void 0:x.status)==="APPROVED"||d.hebrewWorkflowStatus==="HEBREW_APPROVED":!1},Rt=(d,m)=>{const x=new Date().toISOString();let k=null,v=null;if(c(_=>_.map($=>{var it;if($.id!==d)return $;const B=we($.odakanitNo),Y=B&&ie?ie[B]:void 0,oe=gt($,Y||void 0),Ee=!!(Y!=null&&Y.closedAt),be=(e==null?void 0:e.role)==="ADMIN"&&b===$.id&&!Ee;if((e==null?void 0:e.role)==="LAWYER"&&$.status==="SENT"&&!be)return ml({reason:"LAWYER_SENT_BLOCK",reportId:$.id,odakanitNo:$.odakanitNo,role:e==null?void 0:e.role,status:$.status,lockType:oe.lockType}),$;if(!be&&oe.isLocked)return ml({reason:ie&&((it=ie[B])!=null&&it.closedAt)?"CASE_CLOSED_BLOCK":"LOCKSTATE_BLOCK",reportId:$.id,odakanitNo:$.odakanitNo,role:e==null?void 0:e.role,status:$.status,lockType:oe.lockType}),$;const qe=m($);return k=$,v=qe,ps($,qe)?{...qe,updatedAt:x}:qe})),k&&v&&k.odakanitNo&&v.odakanitNo){const _=k.odakanitNo.trim(),$=v.odakanitNo.trim();_&&$&&_!==$&&nt(B=>{let Y={...B};const oe=Y[_];if(oe){const Ee=oe.reportIds.filter(be=>be!==v.id);Y[_]={...oe,reportIds:Ee}}return Y=Od(Y,v,x),Tn(Y),Y})}u(_=>{if(!_||_.id!==d)return _;const $=m(_);return ps(_,$)?{...$,updatedAt:x}:$})},Co=(d,m,x)=>{m.length&&(e==null?void 0:e.role)==="ADMIN"&&Rt(d,k=>{const v=(e==null?void 0:e.id)||"unknown",_=new Date().toISOString();return{...Oe(k,B=>({...B,status:"CHANGES_REQUESTED",reviewedAt:_,reviewedByUserId:v,issues:[...B.issues,...m.map(Y=>({id:`issue-${Date.now()}-${Math.random().toString(36).slice(2)}`,createdAt:_,createdByUserId:v,sectionKey:Y.sectionKey,severity:Y.severity,type:Y.type,title:Y.title,instruction:Y.instruction,status:"OPEN",origin:"EXTERNAL",externalRefId:x,externalAction:Y.externalAction??"ENGLISH_ONLY"}))]})),postSendFeedbackMeta:{...k.postSendFeedbackMeta||{},lastFeedbackAt:_}}})},xa=d=>{(e==null?void 0:e.role)==="ADMIN"&&Rt(d,m=>{const x=new Date().toISOString(),k=m.reportReview??{status:"DRAFT",issues:[]};return{...m,hebrewWorkflowStatus:"HEBREW_REOPENED_EXTERNAL",reportReview:{...k,status:k.status==="CHANGES_REQUESTED"?k.status:"CHANGES_REQUESTED"},postSendFeedbackMeta:{...m.postSendFeedbackMeta||{},reopenedDueToFeedbackAt:x}}})},jr=d=>{V(m=>[d,...m])},ji=d=>{P(m=>m.some(x=>x.reportId===d)?m:[...m,{reportId:d}]),O(d)},Ei=d=>{P(m=>m.filter(x=>x.reportId!==d)),O(m=>m===d?null:m)},ki=(d,m)=>{F(x=>{const k=x[d]||[];return k.some(v=>v.serviceProvider.toLowerCase()===m.serviceProvider.toLowerCase()&&v.category===m.category)?x:{...x,[d]:[m,...k]}})},Ai=(d,m)=>{F(x=>{const k=x[d]||[];return{...x,[d]:k.filter(v=>v.id!==m)}})},zt=d=>{var m;if(i){const x=we(i.odakanitNo),k=x&&ie?ie[x]:void 0,v=gt(i,k||void 0),_=!!(k!=null&&k.closedAt),$=(e==null?void 0:e.role)==="ADMIN"&&b===i.id&&!_;if((e==null?void 0:e.role)==="LAWYER"&&i.status==="SENT"&&!$){ml({reason:"LAWYER_SENT_BLOCK",reportId:i.id,odakanitNo:i.odakanitNo,role:e==null?void 0:e.role,status:i.status,lockType:v.lockType});return}if(!$&&v.isLocked){ml({reason:ie&&x&&((m=ie[x])!=null&&m.closedAt)?"CASE_CLOSED_BLOCK":"LOCKSTATE_BLOCK",reportId:i.id,odakanitNo:i.odakanitNo,role:e==null?void 0:e.role,status:i.status,lockType:v.lockType});return}const Y=i;let oe={...i,...d};if(Y.translationBaseHash&&d.content){const be=Y.translationBaseHash,ze=Vp(d.content);ze&&ze!==be&&(oe={...oe,translationStale:!0})}Y.updateAutoSummarySourceReportId&&d.content&&d.content.Update!==void 0&&(oe={...oe,updateAutoSummaryEdited:!0});const Ee=ps(Y,oe);u(Ee?{...oe,updatedAt:new Date().toISOString()}:oe)}},ln=()=>{i&&c(d=>{const x=d.find(k=>k.id===i.id)?d.map(k=>k.id===i.id?i:k):[...d,i];return $n(i),x})},Qt=()=>{if(!i)return;const d=Mc(i.content),m=Mc(i.translatedContent);zt({content:d,translatedContent:m})},Ii=async()=>{if(i){if(!Jt(i)){window.alert("       .");return}ct(!0);try{const d=Mc(i.content),m={};for(const k of Object.keys(d)){const v=d[k];if(v){const _=await Rd(v);m[k]=oi(_)}}const x=Vp(d);zt({content:d,translatedContent:m,isTranslated:!0,translationBaseHash:x,translationStale:!1}),window.alert("  .")}catch(d){console.error("Translate failed",d),window.alert(" .    .")}finally{ct(!1)}}},Ti=async()=>{if(!i)return;if(!i.isTranslated){window.alert("    (Auto-Translate)   .");return}const d=i.translatedContent||{},m=Object.keys(d).filter(x=>!x.toLowerCase().includes("expenses")&&typeof d[x]=="string"&&d[x].trim().length>0);if(!m.length){window.alert("   .");return}se(!0);try{const x={...d},k=[];for(const v of m){const _=d[v];if(!(!_||!_.trim()))try{const{protectedText:$,map:B}=Uh(_),Y=await xh($),oe=Wh(Y||$,B),Ee=Hh(oe);x[v]=oi(Ee)}catch($){console.error(`Improve English failed for section "${v}"`,$),k.push(v),x[v]=_}}if(zt({translatedContent:x}),ln(),!k.length)window.alert("   .");else{const v=k.map(_=>{var $;return Cd(_,($=i.expertSummaryMode)==null?void 0:$[_])});window.alert(`   .
  : ${v.join(", ")}.
   .`)}}catch(x){console.error("Improve English failed",x),window.alert("  .    .")}finally{se(!1)}},Er=d=>{const m=new Set(["lidor@lp-law.co.il"]),x=new Set(["reports@lp-law.co.il"]);if(d.ownerEmail)x.add(d.ownerEmail);else{const k=Ss.find(v=>v.id===d.createdBy);k!=null&&k.email&&x.add(k.email)}return{to:Array.from(m),cc:Array.from(x)}},fs=d=>Zl(d),Ri=d=>({...d,invoiceFiles:[],policyFile:void 0,expensesSourceFile:void 0}),Ci=(d,m)=>{var v,_,$;const x=d.content?Dr(d.content):{},k=d.translatedContent?Dr(d.translatedContent):{};return{createdAt:m,reportDate:d.reportDate,subject:((v=d.emailSubjectDraft)==null?void 0:v.trim())||fs(d),status:"SENT",odakanitNo:d.odakanitNo,recipientId:d.recipientId,insurerName:d.insurerName,lineSlipNo:d.lineSlipNo,marketRef:d.marketRef,insuredName:d.insuredName,plaintiffName:d.plaintiffName,plaintiffTitle:d.plaintiffTitle,policyPeriodStart:d.policyPeriodStart,policyPeriodEnd:d.policyPeriodEnd,retroStart:d.retroStart,retroEnd:d.retroEnd,filenameTag:d.filenameTag,fileNameTitles:d.fileNameTitles?[...d.fileNameTitles]:void 0,selectedSections:[...d.selectedSections||[]],content:x,translatedContent:k,executiveSummary:d.executiveSummary,complaintAnalysis:d.complaintAnalysis?Dr(d.complaintAnalysis):void 0,requiresExpenses:!!d.requiresExpenses,isWaitingForInvoices:!!d.isWaitingForInvoices,isTranslated:!!d.isTranslated,selectedTimeline:d.selectedTimeline,selectedTimelineImage:d.selectedTimelineImage,expensesItems:(_=d.expensesItems)!=null&&_.length?Dr(d.expensesItems):void 0,expenseWorksheet:d.expenseWorksheet?Dr(d.expenseWorksheet):void 0,expensesSum:d.expensesSum,paymentRecommendation:d.paymentRecommendation,reportNotes:($=d.reportNotes)!=null&&$.length?Dr(d.reportNotes):void 0,ownerName:d.ownerName,ownerEmail:d.ownerEmail}},kr=(d,m,x)=>{var $,B;const k=(($=d.emailSubjectDraft)==null?void 0:$.trim())||fs(d),v=((B=d.reportHistory)==null?void 0:B.length)||0,_=typeof d.reportNumber=="number"&&d.reportNumber>0?d.reportNumber:v+1;return{id:Rn(),reportNumber:_,subject:k,date:x,sent:!0,fileName:m,snapshot:Ci(d,x)}},ha=d=>{if(!d)return d;const m="",x="";return d.startsWith(m)?d:`${m}${d}${x}`},ga=(d,m,x)=>{if(typeof window>"u")return;const k=d.to.join(";"),v=B=>encodeURIComponent(B),_=[];d.cc.length&&_.push(`cc=${v(d.cc.join(";"))}`),_.push(`subject=${v(m)}`),_.push(`body=${v(ha(x))}`);const $=`mailto:${k}?${_.join("&")}`;window.location.href=$},Do=async()=>{if(i){Ve(!0);try{const d=await wc(i),m=ir(i),x=URL.createObjectURL(d),k=document.createElement("a");k.href=x,k.download=m,document.body.appendChild(k),k.click(),k.remove(),URL.revokeObjectURL(x)}catch(d){console.error("PDF download failed",d),alert(" -PDF .  .")}finally{Ve(!1)}}},Di=async()=>{const d=Jn(i,e);if(!d.length){await Do();return}tt({issues:d,onContinue:()=>{tt(null),Do()}})},Li=()=>{i&&((e==null?void 0:e.role)==="ADMIN"?(ke(!1),ae(!0)):Oo())},_i=()=>{var x,k;if(!i||(e==null?void 0:e.role)!=="ADMIN")return;if(i.status!=="SENT"){setShowToast({msg:"       (SENT).",type:"error"});return}if(!Jt(i)){setShowToast({msg:"   /   .       .",type:"error"});return}if(((k=(x=i.reportReview)==null?void 0:x.issues)==null?void 0:k.some(v=>(v.origin??"INTERNAL")==="EXTERNAL"&&v.status!=="DONE"&&v.externalAction==="REQUIRES_HEBREW"))??!1){setShowToast({msg:"      .    /      .",type:"error"});return}if(!(i.isTranslated&&i.translatedContent&&Object.values(i.translatedContent).some(v=>v&&v.trim().length>0))){setShowToast({msg:"    .      .",type:"error"});return}ke(!0),ae(!0)},Lo=async({body:d,templateId:m,subjectBase:x,topics:k},v)=>{const _=v??i;if(!_||_.translationStale&&!window.confirm("     .      .    ?"))return;const $={..._,selectedEmailTemplate:m,emailBodyDraft:d,emailSubjectDraft:x.trim()?x.trim():void 0,fileNameTitles:k};if(zt({selectedEmailTemplate:m,emailBodyDraft:d,emailSubjectDraft:$.emailSubjectDraft,fileNameTitles:k}),e){const Xe=_d(e.id),it=Np(Xe,k,6);gp(e.id,it)}const B=ha(d);ye(!0);let Y=null,oe="";const Ee=x.trim()||fs($);let be="",ze=null,qe=!1;try{ze=await wc($);const Xe=await Wp(ze);be=ir($),Y=Er($),oe=Ee,qe=await mp({to:Y.to,cc:Y.cc,subject:oe,body:B,attachmentBase64:Xe,attachmentName:be}),qe?setShowToast({msg:"  .",type:"success"}):setShowToast({msg:"          ( PDF  ,    ).",type:"error"})}catch(Xe){console.error("Email send failed",Xe),setShowToast({msg:"          ( PDF  ,    ).",type:"error"})}finally{if(Y){if(!qe){if(ze){const Xe=be||ir($),it=URL.createObjectURL(ze),st=document.createElement("a");st.href=it,st.download=Xe,document.body.appendChild(st),st.click(),document.body.removeChild(st),URL.revokeObjectURL(it)}ga(Y,oe||Ee,B)}Oo(be||void 0),ae(!1)}ye(!1)}},Oi=async d=>{if(!i)return;let m=i;if(m.odakanitNo){const _=we(m.odakanitNo);if(_){const B=l.filter(oe=>we(oe.odakanitNo)===_).reduce((oe,Ee)=>{const be=typeof Ee.reportNumber=="number"&&Ee.reportNumber>0?Ee.reportNumber:oe;return be>oe?be:oe},0);if((typeof m.reportNumber=="number"&&m.reportNumber>0?m.reportNumber:B)<B){window.alert("       .       .       .");return}}}const x=!!i.expensesSheetId||!!i.expensesHtml,k=Array.isArray(i.selectedSections)&&i.selectedSections.some(_=>Qr(_));if(x&&!k){if(!window.confirm(`       ,        .

       ?`))return;const $=[...i.selectedSections||[]],B=$.includes("Update"),Y=$.includes("Recommendations"),oe=B?Math.min($.indexOf("Update")+1,Y?$.indexOf("Recommendations"):$.length):0;$.splice(oe,0,Xa);const Ee=Array.from(new Set($)),be={...i,selectedSections:Ee};zt({selectedSections:Ee}),m=be}const v=Jn(m,e);if(!v.length){await Lo(d,m);return}tt({issues:v,onContinue:()=>{tt(null),Lo(d,m)}})},_o=async({body:d,templateId:m,subjectBase:x,topics:k},v)=>{var qe,Xe,it;const _=v??i;if(!_||(e==null?void 0:e.role)!=="ADMIN"||_.translationStale&&!window.confirm("     .      .     ?"))return;const $={..._,selectedEmailTemplate:m,emailBodyDraft:d,emailSubjectDraft:x.trim()?x.trim():void 0,fileNameTitles:k};if(zt({selectedEmailTemplate:m,emailBodyDraft:d,emailSubjectDraft:$.emailSubjectDraft,fileNameTitles:k}),e&&k.length){const st=_d(e.id),wt=Np(st,k,6);gp(e.id,wt)}const B=ha(d);ye(!0);let Y=null,oe="",Ee="";const be=x.trim()||fs($);let ze=!1;try{const st=await wc($),wt=await Wp(st);Ee=ir($),Y=Er($),oe=`Resend  ${be}`,ze=await mp({to:Y.to,cc:Y.cc,subject:oe,body:B,attachmentBase64:wt,attachmentName:Ee}),ze?setShowToast({msg:"   ( ).",type:"success"}):setShowToast({msg:"         .",type:"error"});const $t=new Date().toISOString(),Ot=kr({..._,status:"SENT",sentAt:$t},Ee,$t),Dt=typeof _.reportNumber=="number"&&_.reportNumber>0?_.reportNumber:(((qe=_.reportHistory)==null?void 0:qe.length)||0)+1,$e=we(_.odakanitNo),Hn=$e&&ie?ie[$e]:void 0,Zn=!gt(_,Hn||void 0).isLocked,ot={...Ot,subject:Zn?`Corrected resend #${Dt}  ${Ot.subject}`:`Resent #${Dt}  ${Ot.subject}`,isCorrection:Zn,revisionIndex:Zn?(((it=(Xe=_.reportHistory)==null?void 0:Xe.filter(Zt=>Zt.isCorrection))==null?void 0:it.length)||0)+1:void 0},It={..._,status:"SENT",sentAt:$t,reportHistory:[..._.reportHistory||[],ot],selectedEmailTemplate:void 0,emailBodyDraft:void 0};In(It),$n(It,$t),A(It,$t,ot.fileName||Ee,!0),u(It),c(Zt=>Zt.map(mt=>mt.id===It.id?It:mt))}catch(st){console.error("Resend email failed",st),setShowToast({msg:"         .",type:"error"})}finally{if(Y){const st=be||fs(_),wt=oe||`UPDATED: ${st}`;ze||ga(Y,wt,B),ae(!1)}ke(!1),ye(!1)}},Mi=async d=>{if(!i)return;let m=i;const x=!!i.expensesSheetId||!!i.expensesHtml,k=Array.isArray(i.selectedSections)&&i.selectedSections.some(_=>Qr(_));if(x&&!k){if(!window.confirm(`        ,        .

        ?`))return;const $=[...i.selectedSections||[]],B=$.includes("Update"),Y=$.includes("Recommendations"),oe=B?Math.min($.indexOf("Update")+1,Y?$.indexOf("Recommendations"):$.length):0;$.splice(oe,0,Xa);const Ee=Array.from(new Set($)),be={...i,selectedSections:Ee};zt({selectedSections:Ee}),m=be}const v=Jn(m,e);if(!v.length){await _o(d,m);return}tt({issues:v,onContinue:()=>{tt(null),_o(d,m)}})},Ar=d=>{if(!d)return;let m=d.trim();if(!(!m||(m=m.replace($u," ").replace(/\s+/g," ").trim(),!m)||(m.toLowerCase().endsWith(".pdf.pdf")&&(m=m.slice(0,-4)),m.toLowerCase().endsWith(".pdf")||(m=`${m}.pdf`),m.length>255)))return m},Oo=d=>{var _;if(!i)return;let m="READY_TO_SEND",x=i.sentAt,k=i;if((e==null?void 0:e.role)==="ADMIN"){m="SENT";const $=new Date().toISOString();x=$;const Y=Ar(d)||ir(Ri(i)),oe=kr({...i},Y,x);k={...i,reportHistory:[...i.reportHistory||[],oe],selectedEmailTemplate:void 0,emailBodyDraft:void 0,firstSentAt:i.firstSentAt||$}}else((e==null?void 0:e.role)==="FINANCE"||(e==null?void 0:e.role)==="SUB_ADMIN")&&(m="TASK_ASSIGNED");const v={...k,status:m,sentAt:x};if(In(v),$n(v,x||new Date().toISOString()),m==="SENT"&&x){const $=(_=v.reportHistory)==null?void 0:_[v.reportHistory.length-1];A(v,x,$==null?void 0:$.fileName,!1)}u(v),c($=>$.find(Y=>Y.id===v.id)?$.map(Y=>Y.id===v.id?v:Y):[...$,v]),o("DASHBOARD")},Pi=(d,m)=>{e&&(Rt(d,x=>{const k=[{id:Rn(),authorId:e.id,authorName:e.name,message:m,createdAt:new Date().toISOString()},...x.reportNotes||[]];return{...x,reportNotes:k}}),jr({id:`note-${Date.now()}`,message:`${e.name} added a note: "${m}"`,createdAt:new Date().toISOString()}))},Fi=(d,m)=>{Rt(d,x=>{const k=x.expenseWorksheet||Ms(),v={id:Rn(),timestamp:new Date().toISOString(),userId:(e==null?void 0:e.id)||"system",userName:(e==null?void 0:e.name)||"System",action:m.action||"UPDATE",details:m.details};return{...x,expenseWorksheet:{...k,history:[v,...k.history||[]]}}})},Bi=(d,m,x)=>{e&&(Rt(d,k=>{const v=k.expenseWorksheet||Ms(),_={id:Rn(),rowId:m,authorId:e.id,authorName:e.name,message:x,createdAt:new Date().toISOString()};return{...k,expenseWorksheet:{...v,notes:[_,...v.notes||[]]}}}),Fi(d,{action:"NOTE_ADDED",details:x}))},$i=d=>{const m=new Date().toISOString();Rt(d,x=>({...x,deletedAt:m,deletedBy:e==null?void 0:e.id}))},Hi=d=>{Rt(d,m=>{const x={...m};return delete x.deletedAt,delete x.deletedBy,x})},Ui=(d,m)=>{Rt(d,x=>{const k=x.expenseWorksheet||Ms();return{...x,expenseWorksheet:{...k,notes:k.notes.map(v=>v.id===m?{...v,resolved:!0,resolvedAt:new Date().toISOString()}:v)}}})},Wi=(d,m)=>{!m.amount||m.amount<=0||Rt(d,x=>{var ze,qe;const k=x.expenseWorksheet||Ms(),v=is.find(Xe=>Xe.value===m.category),_=(v==null?void 0:v.type)||"EXPENSE",$=m.category==="OTHER"?((ze=m.customLabel)==null?void 0:ze.trim())||"Other expense":(v==null?void 0:v.label)||"Expense",B={id:Rn(),type:_,category:m.category,label:$,serviceProvider:_==="EXPENSE"?(qe=m.serviceProvider)==null?void 0:qe.trim():void 0,amount:m.amount,createdBy:e==null?void 0:e.id,createdAt:new Date().toISOString()},Y=[...k.rows||[],B],oe=ai(Y),Ee=Mv(Y),be={id:Rn(),timestamp:new Date().toISOString(),userId:(e==null?void 0:e.id)||"system",userName:(e==null?void 0:e.name)||"System",action:"ROW_ADDED",details:`${$} ${B.amount.toLocaleString()}`};return{...x,expenseWorksheet:{...k,rows:Y,totals:oe,history:[be,...k.history||[]]},expensesItems:Ee,expensesSum:oe.totalExpenses.toLocaleString()}})},zi=d=>{const m=Ss.find(Y=>Y.id===d.lawyerId);if(!m)return;const x=Md(d.worksheet||[],e||void 0),k=ai(x),v=d.invoiceFiles||[],_=v.length===0,$={...An(),createdBy:m.id,ownerName:m.name,ownerEmail:m.email,status:_?"WAITING_FOR_INVOICES":"TASK_ASSIGNED",odakanitNo:d.odakanitNo,financeInstructions:d.instructions,expensesSourceFile:d.file,selectedSections:["Update","Expenses breakdown"],isWaitingForInvoices:_,requiresExpenses:!0},B={...$,expensesItems:x.filter(Y=>Y.type==="EXPENSE").map(Y=>({id:Y.id,date:new Date().toISOString().split("T")[0],description:`${Y.label}${Y.serviceProvider?` (${Y.serviceProvider})`:""}`,amount:Y.amount,currency:"NIS"})),expensesSum:x.length?k.totalExpenses.toLocaleString():$.expensesSum,invoiceFiles:v,expenseWorksheet:{status:"DRAFT",rows:x,history:[{id:Rn(),timestamp:new Date().toISOString(),userId:(e==null?void 0:e.id)||"system",userName:(e==null?void 0:e.name)||"System",action:"WORKSHEET_CREATED",details:`${x.length} rows added via finance request`}],notes:[],favorites:z[d.lawyerId]||[],totals:k}};c(Y=>[...Y,B]),jr({id:`worksheet-${Date.now()}`,message:`New expense worksheet created for case ${d.odakanitNo||B.id}`,createdAt:new Date().toISOString(),reportId:B.id,severity:"info"})},Vi=async({caseId:d,sheetId:m,lawyerId:x})=>{var Dt,$e,Hn,pn,Zn;const k=we(d),v=ie==null?void 0:ie[k],_=l.filter(ot=>we(ot.odakanitNo)===k);if(v&&v.closedAt){window.alert("        .   ,     .");return}if(!_.length&&!v){window.alert("     ( ).       .");return}if(!_.length)return;const $=(ot,It)=>{const Zt=ot.updatedAt?new Date(ot.updatedAt).getTime():0;return(It.updatedAt?new Date(It.updatedAt).getTime():0)-Zt};let B=_.filter(ot=>!x||ot.createdBy===x).sort($)[0];if(B||(B=_.sort($)[0]),!B)return;const Y=x||B.createdBy;if(!Y)return;const oe=B.odakanitNo||d,Ee=B.insuredName||B.plaintiffName||"case",be=`New financial update (Expenses breakdown) is available for Odakanit case ${oe} (${Ee}).`;let ze=null,qe,Xe=null,it=[];try{const ot=await Ge.getSheet(m);if(ot&&ot.sheet&&((Dt=ot.lineItems)!=null&&Dt.length)){const It=Ge.buildCumulativeExpensesSnapshot(ot.sheet.id,new Date().toISOString());if(!It)return;const{effectiveSheet:Zt,allLines:mt,opts:es}=It,{text:Sa,totals:rr}=Lh(Zt,mt,es),wa=(($e=ot.attachments)==null?void 0:$e.length)??0,Ho=rr.amountToRequest.toLocaleString("he-IL",{minimumFractionDigits:2,maximumFractionDigits:2}),Uo="This expenses breakdown was prepared by the finance department and is attached for your review.",Vh=`Summary: total amount to request ${Ho}${wa>0?` (invoices attached: ${wa})`:""}.`;ze=`${Uo}

${Vh}`;const{html:Kh}=si(Zt,mt,es);if(Xe=Kh,qe=ot.sheet.updatedAt||new Date().toISOString(),ot.attachments&&ot.attachments.length){const qu=ot.attachments.slice(0,4).map((ja,Yh)=>({id:`fes-inv-${ja.id}-${Yh}`,name:ja.originalFileName,data:ja.fileKey.split(",").pop()||ja.fileKey,type:ja.mimeType||"application/pdf"}));qu.length&&(it=qu)}}}catch(ot){Ku("Failed to build Expenses Breakdown text for finance notification",ot)}const st=new Date().toISOString(),wt=ze||"An expenses table has been prepared by the finance department for this case. Please review the attached sheet or coordinate with Finance as needed.",$t=typeof B.reportNumber=="number"&&B.reportNumber>0?B.reportNumber+1:(((Hn=B.reportHistory)==null?void 0:Hn.length)||0)+1;let Ot={...B,id:`${Date.now()}-finance`,createdBy:Y,status:"TASK_ASSIGNED",reportDate:st,updatedAt:st,expensesSheetId:m,expensesSnapshotAt:qe||st,invoiceFiles:it,reportNumber:$t,reportHistory:B.reportHistory||[],attachPolicyAsAppendix:!1,expensesHtml:Xe||void 0,content:{...B.content,Update:((pn=B.content)==null?void 0:pn.Update)||"","Expenses breakdown":wt,Recommendations:((Zn=B.content)==null?void 0:Zn.Recommendations)||""},selectedSections:["Update","Expenses breakdown","Recommendations"],supersededByReportId:null,supersedesReportId:null};c(ot=>{const It=[...ot].filter(mt=>mt.expensesSheetId===m&&!mt.deletedAt&&mt.id!==Ot.id).sort((mt,es)=>{const Sa=new Date(mt.updatedAt||mt.reportDate||"").getTime()||0;return(new Date(es.updatedAt||es.reportDate||"").getTime()||0)-Sa})[0];let Zt=ot;return It&&(Zt=ot.map(mt=>mt.id===It.id?{...mt,supersededByReportId:Ot.id}:mt),Ot={...Ot,supersedesReportId:It.id}),[...Zt,Ot]}),jr({id:`${Date.now()}`,message:be,createdAt:new Date().toISOString(),reportId:Ot.id,severity:"info",targetUserId:Y})},Ki=d=>{t(d),o("DASHBOARD"),u(null),w(null),R.current=!1,typeof window<"u"&&(localStorage.setItem(pt.USER,d.username),localStorage.setItem(pt.VIEW,"DASHBOARD"),localStorage.removeItem(pt.CURRENT_REPORT))},[Yi,ya]=g.useState(!1),[Na,Ir]=g.useState(!1),Mo=()=>{if(!(l.length>0||i)){ba();return}Ir(!1),ya(!0)},Gi=()=>{ya(!1),Ir(!1),ba()},ba=()=>{if(t(null),u(null),w(null),R.current=!1,o("DASHBOARD"),W(null),M(!1),ae(!1),ye(!1),ke(!1),Qe(!1),L(null),me(""),le(null),Te(""),Be("LAWYER"),P([]),O(null),te(!1),he(null),h([]),typeof window<"u")try{localStorage.removeItem(pt.USER),localStorage.removeItem(pt.CURRENT_REPORT),localStorage.setItem(pt.VIEW,"DASHBOARD"),localStorage.removeItem(Kb)}catch(d){console.error("Failed to clear session storage on logout",d)}};if(!s)return n.jsx("div",{className:"min-h-screen flex items-center justify-center bg-bgDark",children:n.jsxs("div",{className:"text-textMuted text-sm flex items-center gap-2",children:[n.jsx(Mt,{className:"w-5 h-5 animate-spin","aria-hidden":!0}),n.jsx("span",{children:"..."})]})});if(!e)return n.jsx(Hv,{onLogin:Ki});if(a==="CASE_FOLDER"&&J){const d=ie[J]||null,m=()=>{o("DASHBOARD")};return d?n.jsx(tv,{folder:d,reports:l,currentUserRole:e.role,onBack:m,onUpdateReTemplate:x=>{nt(k=>{const v=k[J];if(!v)return k;const _={...v,reTemplate:x,updatedAt:new Date().toISOString()},$={...k,[J]:_};return Tn($),$})},onCloseCase:e.role==="ADMIN"?()=>{const x=J;if(!x)return;const k=we(x);if(l.some($=>we($.odakanitNo)===k&&$.status!=="SENT"&&!$.deletedAt)){window.alert("         .        .");return}if(!window.confirm("        .   ?"))return;const _=new Date().toISOString();nt($=>{const B=$[x];if(!B)return $;const Y={...B,closedAt:_,closedByUserId:e.id,updatedAt:_},oe={...$,[x]:Y};return Tn(oe),oe})}:void 0,onReopenCase:e.role==="ADMIN"?()=>{const x=J;x&&window.confirm("         .   ?")&&nt(k=>{const v=k[x];if(!v)return k;const _={...v,closedAt:null,closedByUserId:null,updatedAt:new Date().toISOString()},$={...k,[x]:_};return Tn($),$})}:void 0,onDeleteCase:e.role==="ADMIN"?()=>{const x=J;if(!x)return;const k=we(x);if(l.some(_=>we(_.odakanitNo)===k&&_.status!=="SENT"&&!_.deletedAt)){window.alert("       .        .");return}window.confirm("           (  ).   ?")&&window.confirm(" :      ?     .")&&(nt(_=>{const $={..._};return delete $[x],Tn($),$}),c(_=>_.filter($=>we($.odakanitNo)!==k)),he(null),o("DASHBOARD"))}:void 0,onCreateReportInCase:()=>{const x=ie[J];if(!x||!e)return;if(x.closedAt){window.alert("  .      .");return}const k=l.find(Xe=>Xe.odakanitNo&&we(Xe.odakanitNo)===we(x.odakanitNo)&&Xe.status!=="SENT"&&!Xe.deletedAt);if(k&&e.role==="LAWYER"){window.alert("     .     .      .");return}if(k&&e.role==="ADMIN"&&!window.confirm("     .       ( ,    )?"))return;const v=new Date().toISOString(),_=An(),$=Ne(x),B=wr({odakanitNo:x.odakanitNo,reports:l,caseFolder:x}),Y=Array.isArray(x.sentReports)?x.sentReports:[];let oe=null,Ee="";if(Y.length>0){oe=[...Y].sort((Ot,Dt)=>{const $e=new Date(Ot.sentAt||"").getTime()||0;return(new Date(Dt.sentAt||"").getTime()||0)-$e})[0];const Xe=(oe==null?void 0:oe.snapshot)||{},it=Xe.content||{},st=Array.isArray(Xe.selectedSections)?Xe.selectedSections:[],wt=st.length>0?st:Object.keys(it),$t=[];wt.forEach(Ot=>{const Dt=it[Ot];typeof Dt=="string"&&Dt.trim()&&$t.push(Dt.trim())}),Ee=$t.join(`

`).trim()}const be=!!(oe&&Ee),ze="    ",qe={..._,odakanitNo:x.odakanitNo,reportSubject:x.reTemplate||"",insuredName:x.insuredName||"",plaintiffName:x.plaintiffName||"",insurerName:x.insurerName||"",marketRef:x.marketRef||"",lineSlipNo:x.lineSlipNo||"",certificateRef:x.certificateRef||"",reportDate:v,updatedAt:v,reportHistory:$,reportNumber:B,content:be?{..._.content||{},Update:ze}:_.content,updateAutoSummarySourceReportId:be?oe.reportId:null,updateAutoSummaryGeneratedAt:be?v:null,updateAutoSummaryEdited:!1};if(u(qe),w(null),o("STEP1"),typeof window<"u")try{localStorage.setItem(pt.CURRENT_REPORT,qe.id)}catch{}if($n(qe,v),be){const Xe=Ee,it=oe.reportId;(async()=>{try{let st=await G0(Xe);st=(st||"").trim(),st||(st=`,     ${Xe.trim().slice(0,600)}`),st.startsWith(",  ")||(st=`,     ${st}`),Rt(qe.id,wt=>{var $t;return wt.updateAutoSummaryEdited||(($t=wt.content)==null?void 0:$t.Update)!==ze?wt:{...wt,content:{...wt.content||{},Update:st},updateAutoSummarySourceReportId:it,updateAutoSummaryGeneratedAt:new Date().toISOString()}})}catch(st){console.error("Auto summary generation failed, falling back to snippet.",st);const wt=Xe.trim();if(!wt)return;const Ot=`,     ${wt.slice(0,600)}`;Rt(qe.id,Dt=>{var $e;return Dt.updateAutoSummaryEdited||(($e=Dt.content)==null?void 0:$e.Update)!==ze?Dt:{...Dt,content:{...Dt.content||{},Update:Ot},updateAutoSummarySourceReportId:it,updateAutoSummaryGeneratedAt:new Date().toISOString()}})}})()}},onOpenReport:x=>{const k=l.find(v=>v.id===x);if(k&&(u(k),w(null),o("STEP1"),typeof window<"u"))try{localStorage.setItem(pt.CURRENT_REPORT,k.id)}catch{}}}):n.jsx("div",{className:"min-h-screen flex items-center justify-center bg-bgDark px-4",children:n.jsxs("div",{className:"max-w-md rounded-2xl bg-panel p-6 text-center text-sm text-textLight shadow-sm border border-borderDark",children:[n.jsx("p",{className:"mb-3 font-semibold text-gold",children:"Case folder not found"}),n.jsx("p",{className:"mb-4 text-xs text-textMuted",children:"The requested case folder is no longer available. You can return to the dashboard and select another case."}),n.jsx("button",{type:"button",onClick:m,className:"inline-flex items-center rounded-full bg-navy px-4 py-1.5 text-xs font-semibold text-gold shadow-sm hover:bg-navySecondary focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-gold focus-visible:ring-offset-2",children:"Back to dashboard"})]})})}const Po=()=>{if((e==null?void 0:e.role)==="LAWYER"){de(""),Ze(!0);return}const d=An();if(u(d),w(null),o("STEP1"),typeof window<"u")try{localStorage.setItem(pt.CURRENT_REPORT,d.id)}catch{}},va=(d,m)=>{const x=l.find(k=>k.id===d);if(x&&(u(x),w(null),o("STEP1"),W(m||null),typeof window<"u"))try{localStorage.setItem(pt.CURRENT_REPORT,x.id)}catch{}};if(a==="DASHBOARD")return(e==null?void 0:e.role)==="ADMIN"||(e==null?void 0:e.role)==="SUB_ADMIN"?n.jsx(qb,{user:e,reports:l,caseFolders:ie,onUpdateCaseFolders:d=>{nt(m=>{const x=d(m);return Tn(x),x})},onNewReport:Po,onSelectReport:va,onSelectReportWithFocus:(d,m)=>va(d,m),onMarkExternalIssuesDone:Cs,onReopenHebrewDueToExternalFeedback:d=>xa(d),canTranslate:Jt,onLogout:Mo,onOpenAssistant:()=>Fe(!0),onOpenCaseFolder:d=>{const m=we(d);m&&(nt(x=>{const k=Oc(x,l);return Tn(k),k}),he(m),o("CASE_FOLDER"))}}):n.jsxs(n.Fragment,{children:[n.jsx($v,{user:e,reports:l,onNewReport:Po,onSelectReport:va,onLogout:Mo,onUpdateReport:(d,m)=>{Rt(d,x=>({...x,...m}))},onDeleteReport:d=>c(m=>m.filter(x=>x.id!==d)),onFinanceTaskCreate:zi,onNotifyLawyerFromFinance:Vi,onSheetDeleted:d=>{c(m=>m.map(x=>x.expensesSheetId===d?{...x,expensesSheetId:void 0,expensesHtml:void 0,expensesSnapshotAt:void 0}:x))},caseTemplates:Ue,onStartTemplate:sr,onStartNextReport:Qn,archiveAfterMs:Ev,favoriteProviders:z,onSaveFavorite:ki,onDeleteFavorite:Ai,onOpenWorksheet:ji,onRequestReminder:d=>{le(d),Te(`Reminder for ${d.insuredName||"case"}`)},onRequestNote:d=>{L(d),me("")},onSoftDeleteReport:$i,onRestoreReport:Hi,notifications:H.filter(d=>!d.targetUserId||d.targetUserId===(e==null?void 0:e.id)),showNotifications:q,setShowNotifications:te,onClearNotifications:()=>V([]),dailySummaryOptIn:G,setDailySummaryOptIn:re,caseFolders:ie,onOpenCaseFolder:d=>{const m=we(d);m&&(nt(x=>{const k=Oc(x,l);return Tn(k),k}),he(m),o("CASE_FOLDER"))},onOpenAssistant:()=>Fe(!0)}),(e==null?void 0:e.role)==="LAWYER"&&je&&n.jsx("div",{className:"fixed inset-0 z-[250] flex items-center justify-center bg-black/40",children:n.jsxs("div",{className:"bg-panel rounded-2xl shadow-xl max-w-sm w-full mx-4 p-5 space-y-3",dir:"rtl",children:[n.jsx("h2",{className:"text-sm font-bold text-textLight text-right",children:"    "}),n.jsx("p",{className:"text-xs text-textMuted text-right",children:'/   .         / " .          .'}),n.jsx("input",{type:"text",className:"w-full border border-borderDark rounded px-3 py-1.5 text-sm text-textLight",placeholder:": 1/123",value:Re,onChange:d=>de(d.target.value)}),n.jsxs("div",{className:"flex justify-end gap-2 mt-2",children:[n.jsx("button",{type:"button",className:"px-3 py-1.5 rounded-md border border-borderDark text-xs text-textLight bg-panel hover:bg-slate-50",onClick:()=>{Ze(!1),de("")},children:""}),n.jsx("button",{type:"button",className:"px-3 py-1.5 rounded-md bg-navy text-xs font-semibold text-gold hover:bg-navySecondary",onClick:()=>{const d=Re.trim();if(!d){alert("    .");return}const m=d,x=ie[m],k=new Date().toISOString();if(x){const v=An(),_=Ne(x),$=wr({odakanitNo:x.odakanitNo,reports:l,caseFolder:x}),B={...v,odakanitNo:x.odakanitNo,reportSubject:x.reTemplate||"",insuredName:x.insuredName||"",plaintiffName:x.plaintiffName||"",insurerName:x.insurerName||"",marketRef:x.marketRef||"",lineSlipNo:x.lineSlipNo||"",certificateRef:x.certificateRef||"",reportDate:k,updatedAt:k,reportHistory:_,reportNumber:$};if(u(B),o("STEP1"),typeof window<"u")try{localStorage.setItem(pt.CURRENT_REPORT,B.id)}catch{}$n(B,k)}else{const _={...An(),odakanitNo:m};if(u(_),o("STEP1"),typeof window<"u")try{localStorage.setItem(pt.CURRENT_REPORT,_.id)}catch{}$n(_,k)}Ze(!1),de("")},children:""})]})]})})]});if(!i)return null;const Tr=typeof i.reportNumber=="number"&&i.reportNumber>0?i.reportNumber:(((ee=i.reportHistory)==null?void 0:ee.length)||0)+1,Fo=hh(i.selectedSections||[]),Bo=Fo.map((d,m)=>({id:`${m}-${d.replace(/\s+/g,"-")||"title"}`,label:d})).filter(d=>!!d.label),qi=Ld(Fo),$o=i.fileNameTitles&&i.fileNameTitles.length?i.fileNameTitles:qi,f=Tr!==1&&Bo.length>0,T=j.map(d=>{const m=Bn(d.reportId);return m?{...d,report:m,title:`${m.insuredName||"Case"} (${m.ownerName})`}:null}).filter(Boolean),K=D?Bn(D):null;return n.jsxs(n.Fragment,{children:[n.jsx("div",{className:"min-h-screen bg-navySecondary pb-12",children:n.jsxs("div",{className:"w-full pt-6 px-6 md:px-8 lg:px-10 xl:px-12",children:[n.jsxs("div",{className:"flex justify-between items-center mb-8",children:[n.jsxs("div",{className:"flex items-center bg-panel p-2 rounded-full shadow-sm",children:[n.jsx("div",{className:`px-4 py-1 rounded-full ${a==="STEP1"?"bg-navy text-white font-bold":"text-textMuted"}`,children:"1. Setup"}),n.jsx(os,{className:"w-4 h-4 text-gray-300 mx-2"}),n.jsx("div",{className:`px-4 py-1 rounded-full ${a==="STEP2"?"bg-navy text-white font-bold":"text-textMuted"}`,children:"2. Draft"}),n.jsx(os,{className:"w-4 h-4 text-gray-300 mx-2"}),n.jsx("div",{className:`px-4 py-1 rounded-full ${a==="PREVIEW"?"bg-navy text-white font-bold":"text-textMuted"}`,children:"3. Preview"})]}),n.jsxs("button",{type:"button",onClick:()=>Fe(!0),className:"flex items-center text-[11px] px-3 py-1.5 rounded-full bg-indigo-50 text-indigo-800 border border-indigo-200 hover:bg-indigo-100",title:"     ,     .",children:[n.jsx(oa,{className:"w-3 h-3 ml-1"})," "]})]}),i&&(()=>{const d=we(i.odakanitNo),m=d&&ie?ie[d]:void 0,x=gt(i,m||void 0),k=!!(m!=null&&m.closedAt),v=(e==null?void 0:e.role)==="ADMIN"&&b===i.id;return(x.isLocked||k)&&!(v&&!k)})()&&n.jsxs("div",{className:"mb-4 rounded-2xl border border-amber-300 bg-amber-50 px-4 py-3 text-xs text-amber-900 flex items-start justify-between gap-3",children:[n.jsxs("div",{children:[n.jsx("p",{className:"font-semibold text-[13px]",children:(()=>{const d=we(i.odakanitNo),m=d&&ie?ie[d]:void 0,x=gt(i,m||void 0);return m!=null&&m.closedAt?"      .":x.lockType==="MANUAL"?"   .":x.lockType==="AUTO"&&x.lockAt?`    ${new Date(x.lockAt).toLocaleDateString("he-IL")}.`:"  ."})()}),n.jsx("p",{className:"mt-1 text-[11px]",children:'  ,    PDF,      "     .'})]}),(e==null?void 0:e.role)==="ADMIN"&&n.jsxs("div",{className:"flex flex-col items-end gap-2",children:[(()=>{const d=we(i.odakanitNo),m=d&&ie?ie[d]:void 0,x=gt(i,m||void 0);return i.status==="SENT"&&!x.isLocked})()&&n.jsx("button",{type:"button",className:"shrink-0 inline-flex items-center rounded-full bg-panel px-3 py-1.5 text-[11px] font-semibold text-amber-900 border border-amber-300 hover:bg-amber-100",onClick:()=>{const d=window.prompt(`      .
 /     (  ):`);if(!d||!d.trim())return;w(i.id);const m=new Date().toISOString(),x=e.id,k=e.name;zt({lastAdminOverrideAt:m,lastAdminOverrideById:x,lastAdminOverrideByName:k,lastAdminOverrideReason:d.trim()})},children:"  ()"}),(()=>{const d=we(i.odakanitNo),m=d&&ie?ie[d]:void 0,x=gt(i,m||void 0),k=!x.isLocked&&!!i.firstSentAt&&!(m!=null&&m.closedAt),v=!(m!=null&&m.closedAt)&&!i.manualLockedAt&&!x.isLocked;return n.jsxs("div",{className:"flex flex-wrap gap-2 justify-end",children:[k&&n.jsx("button",{type:"button",className:"inline-flex items-center rounded-full bg-amber-100 px-3 py-1.5 text-[10px] font-semibold text-amber-900 border border-amber-300 hover:bg-amber-200",onClick:()=>{const _=window.prompt(`   -35  .
 /   (  ):`);if(!_||!_.trim())return;const $=new Date().toISOString(),B=i.lockExtensions||[];zt({lockExtensions:[...B,{extendedAt:$,extendedById:e.id,extendedByName:e.name,days:35,reason:_.trim()}]})},children:"   (+35 )"}),v&&n.jsx("button",{type:"button",className:"inline-flex items-center rounded-full bg-amber-100 px-3 py-1.5 text-[10px] font-semibold text-amber-900 border border-amber-300 hover:bg-amber-200",onClick:()=>{const _=window.prompt(`     .
 /     (  ):`);if(!_||!_.trim())return;const $=new Date().toISOString();zt({manualLockedAt:$,manualLockedById:e.id,manualLockedByName:e.name,manualLockReason:_.trim()})},children:"  "})]})})()]})]}),a==="STEP1"&&n.jsx(Pv,{data:i,updateData:zt,onNext:()=>{if(i){const d=we(i.odakanitNo),m=d&&ie?ie[d]:void 0;gt(i,m||void 0).isLocked||ln()}o("STEP2")},onBack:()=>{if(i){const d=we(i.odakanitNo),m=d&&ie?ie[d]:void 0;gt(i,m||void 0).isLocked||ln()}o("DASHBOARD")},currentUser:e,timelineGallery:N,onAddTimelineImages:d=>h(m=>[...m,...d.map(x=>({...x,id:Date.now().toString()}))]),onRemoveTimelineImage:d=>h(m=>m.filter(x=>x.id!==d)),onSaveAndExit:()=>{if(i){const d=we(i.odakanitNo),m=d&&ie?ie[d]:void 0;gt(i,m||void 0).isLocked||ln()}o("DASHBOARD")},readOnly:!!i&&(()=>{const d=we(i.odakanitNo),m=d&&ie?ie[d]:void 0,x=gt(i,m||void 0),k=!!(m!=null&&m.closedAt),v=(e==null?void 0:e.role)==="ADMIN"&&b===i.id&&!k,_=(e==null?void 0:e.role)==="LAWYER"&&i.status==="SENT";return v?!1:_||k?!0:x.isLocked})()}),a==="STEP2"&&n.jsx(Fv,{data:i,updateData:zt,onNext:()=>{if(i){const d=we(i.odakanitNo),m=d&&ie?ie[d]:void 0;gt(i,m||void 0).isLocked||ln()}o("PREVIEW")},onBack:()=>{if(i){const d=we(i.odakanitNo),m=d&&ie?ie[d]:void 0;gt(i,m||void 0).isLocked||ln()}o("STEP1")},currentUser:e,timelineGallery:N,onAddTimelineImages:d=>{},onSaveAndExit:()=>{if(i){const d=we(i.odakanitNo),m=d&&ie?ie[d]:void 0;gt(i,m||void 0).isLocked||ln()}o("DASHBOARD")},onSaveDraft:i&&(()=>{const d=we(i.odakanitNo),m=d&&ie?ie[d]:void 0,x=gt(i,m||void 0);if(!((e==null?void 0:e.role)==="LAWYER"&&i.status==="SENT"||x.isLocked))return ln})(),onTranslate:i&&(()=>{const d=we(i.odakanitNo),m=d&&ie?ie[d]:void 0,x=gt(i,m||void 0);if(!((e==null?void 0:e.role)==="LAWYER"&&i.status==="SENT"||x.isLocked))return Ii})(),onFormatContent:i&&(()=>{const d=we(i.odakanitNo),m=d&&ie?ie[d]:void 0,x=gt(i,m||void 0);if(!((e==null?void 0:e.role)==="LAWYER"&&i.status==="SENT"||x.isLocked))return Qt})(),onSubmitHebrewForReview:i&&(()=>{const d=we(i.odakanitNo),m=d&&ie?ie[d]:void 0,x=gt(i,m||void 0);if(!((e==null?void 0:e.role)==="LAWYER"&&i.status==="SENT"||x.isLocked))return()=>Ce(i.id)})(),onApproveHebrewForTranslation:i&&(()=>{const d=we(i.odakanitNo),m=d&&ie?ie[d]:void 0,x=gt(i,m||void 0);if(!((e==null?void 0:e.role)==="LAWYER"&&i.status==="SENT"||x.isLocked))return()=>ut(i.id)})(),onAddReviewIssues:i&&(()=>{const d=we(i.odakanitNo),m=d&&ie?ie[d]:void 0,x=gt(i,m||void 0);if(!((e==null?void 0:e.role)==="LAWYER"&&i.status==="SENT"||x.isLocked))return v=>rt(i.id,v)})(),onMarkReviewIssueDone:i&&(()=>{const d=we(i.odakanitNo),m=d&&ie?ie[d]:void 0,x=gt(i,m||void 0);if(!((e==null?void 0:e.role)==="LAWYER"&&i.status==="SENT"||x.isLocked))return v=>Xt(i.id,v)})(),onAddExternalFeedbackIssues:i&&(()=>{const d=we(i.odakanitNo),m=d&&ie?ie[d]:void 0,x=gt(i,m||void 0);if(!((e==null?void 0:e.role)==="LAWYER"&&i.status==="SENT"||x.isLocked))return(v,_)=>Co(i.id,v,_)})(),onReopenHebrewDueToExternalFeedback:i&&(()=>{const d=we(i.odakanitNo),m=d&&ie?ie[d]:void 0,x=gt(i,m||void 0);if(!((e==null?void 0:e.role)==="LAWYER"&&i.status==="SENT"||x.isLocked))return()=>xa(i.id)})(),step1Focus:E,onStep1FocusConsumed:()=>W(null),isTranslating:He,isImprovingEnglish:X,onImproveEnglish:i&&(()=>{const d=we(i.odakanitNo),m=d&&ie?ie[d]:void 0,x=gt(i,m||void 0);if(!((e==null?void 0:e.role)==="LAWYER"&&i.status==="SENT"||x.isLocked))return Ti})(),onOpenAssistant:()=>Fe(!0),onActiveSectionChange:d=>At(d),readOnly:!!i&&(()=>{const d=(e==null?void 0:e.role)==="ADMIN"&&b===i.id;if(!i)return!1;const m=we(i.odakanitNo),x=m&&ie?ie[m]:void 0,k=gt(i,x||void 0);return!d&&k.isLocked})()}),a==="PREVIEW"&&(()=>{const d=Nv(e==null?void 0:e.role),m=(e==null?void 0:e.role)==="LAWYER";return n.jsxs("div",{className:"space-y-6 animate-fade-in",dir:m?"rtl":void 0,lang:m?"he":void 0,children:[n.jsxs("div",{className:"flex justify-between items-center flex-wrap gap-2",children:[n.jsxs("button",{onClick:()=>{ln(),o("STEP2")},className:"flex items-center text-sm text-textMuted bg-navySecondary px-3 py-1.5 rounded-full hover:bg-borderDark",children:[n.jsx(Jl,{className:"w-4 h-4 mr-1"}),d.backToStep2]}),n.jsxs("button",{onClick:()=>{ln(),o("DASHBOARD")},className:"flex items-center text-sm text-lpBlue bg-blue-50 px-3 py-1.5 rounded-full hover:bg-blue-100",children:[n.jsx(Du,{className:"w-4 h-4 mr-1"}),d.backToDashboard]})]}),n.jsxs("div",{className:"flex justify-between items-center bg-panel p-4 rounded shadow mb-4",children:[n.jsxs("div",{children:[n.jsx("h2",{className:"text-xl font-bold text-lpBlue",children:d.title}),n.jsx("p",{className:"mt-1 text-xs text-textMuted",children:"Export options let you back up the current report data (JSON/CSV) in addition to the PDF."})]}),n.jsxs("div",{className:"flex gap-2 flex-wrap justify-end items-center",children:[n.jsxs("button",{type:"button",onClick:()=>Fe(!0),className:"flex items-center text-[11px] px-3 py-1.5 rounded-full bg-indigo-50 text-indigo-800 border border-indigo-200 hover:bg-indigo-100",title:"         PDF.",children:[n.jsx(oa,{className:"w-3 h-3 mr-1"})," "]}),n.jsx("button",{onClick:()=>M(x=>!x),className:"flex items-center bg-borderDark text-textLight px-4 py-2 rounded hover:bg-borderDark",children:S?d.toggleHide:d.toggleShow}),n.jsxs("button",{onClick:Di,disabled:Ye,className:"flex items-center bg-panel text-textLight border border-borderDark px-4 py-2 rounded hover:bg-navySecondary disabled:opacity-50",children:[Ye?n.jsx(Mt,{className:"w-4 h-4 mr-2 animate-spin"}):n.jsx(go,{className:"w-4 h-4 mr-2"}),d.downloadPdf]}),n.jsx("button",{onClick:()=>Qe(!0),disabled:!f,className:"flex items-center bg-panel text-textLight border border-borderDark px-4 py-2 rounded hover:bg-navySecondary disabled:opacity-40",children:d.editFileNames}),n.jsx("button",{onClick:()=>{const x={report:i},k=new Blob([JSON.stringify(x,null,2)],{type:"application/json"}),v=URL.createObjectURL(k),_=document.createElement("a");_.href=v,_.download=`report-${i.odakanitNo||i.id}.json`,_.click(),URL.revokeObjectURL(v)},className:"flex items-center bg-panel text-textLight border border-borderDark px-3 py-2 rounded hover:bg-navySecondary text-xs",children:"JSON Export"}),n.jsx("button",{onClick:()=>{const x=["OdakanitNo","InsuredName","PlaintiffName","InsurerName","MarketRef","LineSlipNo","CertificateRef","ReportDate","Status"],k=[i.odakanitNo||"",i.insuredName||"",i.plaintiffName||"",i.insurerName||"",i.marketRef||"",i.lineSlipNo||"",i.certificateRef||"",i.reportDate||"",i.status||""],v=oe=>{const Ee=String(oe??"");return/[",\n]/.test(Ee)?`"${Ee.replace(/"/g,'""')}"`:Ee},_=[x.join(","),k.map(v).join(",")].join(`
`),$=new Blob(["\uFEFF"+_],{type:"text/csv;charset=utf-8;"}),B=URL.createObjectURL($),Y=document.createElement("a");Y.href=B,Y.download=`report-${i.odakanitNo||i.id}.csv`,Y.click(),URL.revokeObjectURL(B)},className:"flex items-center bg-panel text-textLight border border-borderDark px-3 py-2 rounded hover:bg-navySecondary text-xs",children:"CSV Export"}),n.jsxs("button",{onClick:Li,className:"flex items-center bg-green-600 text-white px-4 py-2 rounded hover:bg-green-700",children:[n.jsx(Ql,{className:"w-4 h-4 mr-2"}),d.finalize]}),e.role==="ADMIN"&&n.jsxs("button",{onClick:_i,className:"flex items-center bg-orange-600 text-white px-4 py-2 rounded hover:bg-orange-700",children:[n.jsx(Ql,{className:"w-4 h-4 mr-2"}),"   "]})]})]}),S?n.jsxs("div",{className:"bg-panel rounded-2xl shadow p-4 space-y-4",children:[n.jsx("div",{className:"flex items-center justify-end flex-wrap gap-3",children:n.jsx("span",{className:"text-xs text-textMuted",children:d.helperScroll})}),n.jsx("div",{className:"border rounded-2xl bg-navySecondary p-4 pr-6 max-h-[900px] overflow-auto shadow-inner",children:n.jsx("div",{className:"scale-[0.85] origin-top flex justify-center overflow-visible",children:n.jsx(oN,{data:i})})})]}):n.jsx("div",{className:"text-center text-textMuted border border-dashed border-borderDark rounded-2xl p-6 bg-navySecondary",children:d.collapsedHint}),n.jsx("div",{className:"flex justify-start mt-4",children:n.jsx("button",{onClick:()=>o("STEP2"),className:"px-6 py-2 bg-borderDark text-textLight rounded hover:bg-borderDark",children:d.backToEditing})})]})})()]})}),i&&n.jsx(SN,{isOpen:I,isSending:ne,report:i,userId:e==null?void 0:e.id,recipientsPreview:Er(i),defaultSubject:fs(i),subjectDraft:((ue=i.emailSubjectDraft)==null?void 0:ue.trim())||fs(i),onSubjectDraftChange:d=>zt({emailSubjectDraft:d&&d.trim()?d.trim():void 0}),selectedTopics:i.fileNameTitles||[],onSelectedTopicsChange:d=>zt({fileNameTitles:d}),isResendMode:Pe,onClose:()=>{ne||(ke(!1),ae(!1))},onSend:Pe?Mi:Oi}),i&&n.jsx(wN,{isOpen:De,availableTitles:Bo,selectedTitles:$o,onClose:()=>Qe(!1),onSave:d=>{const m=d.map(x=>x.trim()).filter(Boolean);zt({fileNameTitles:m}),Qe(!1)}}),n.jsx(uv,{isOpen:Ke,onClose:()=>{Fe(!1)},view:a,currentUser:e,currentReport:i,loading:Z,error:xe,response:Me,onRunIntent:ms}),C&&n.jsx("div",{className:"fixed inset-0 bg-black/40 z-[200] flex items-center justify-center p-4",children:n.jsxs("div",{className:"bg-panel rounded-xl shadow-xl w-full max-w-md p-6 space-y-4",children:[n.jsxs("h3",{className:"text-lg font-bold text-textLight flex items-center gap-2",children:[n.jsx(Lu,{className:"w-4 h-4"})," Add Note"]}),n.jsxs("p",{className:"text-sm text-textMuted",children:["Case: ",C.insuredName||C.odakanitNo||C.id]}),n.jsx(ho,{clientId:vo,children:n.jsx("textarea",{className:"w-full border rounded p-3 text-sm",rows:4,value:Q,onChange:d=>me(d.target.value),placeholder:"Write your note..."})}),n.jsxs("div",{className:"flex justify-end gap-2",children:[n.jsx("button",{onClick:()=>{L(null),me("")},className:"px-4 py-2 text-textMuted hover:bg-navySecondary rounded",children:"Cancel"}),n.jsx("button",{onClick:()=>{C&&Q.trim()&&(Pi(C.id,Q.trim()),L(null),me(""))},className:"px-4 py-2 bg-navy text-white rounded hover:bg-navySecondary",children:"Save"})]})]})}),ce&&n.jsx("div",{className:"fixed inset-0 bg-black/40 z-[200] flex items-center justify-center p-4",children:n.jsxs("div",{className:"bg-panel rounded-xl shadow-xl w-full max-w-md p-6 space-y-4",children:[n.jsxs("h3",{className:"text-lg font-bold text-textLight flex items-center gap-2",children:[n.jsx(Xl,{className:"w-4 h-4"})," Send Reminder"]}),n.jsxs("p",{className:"text-sm text-textMuted",children:["Case: ",ce.insuredName||ce.odakanitNo||ce.id]}),n.jsx("label",{className:"text-xs font-bold text-textMuted",children:"Recipients"}),n.jsxs("select",{className:"w-full border rounded p-2 text-sm",value:ge,onChange:d=>Be(d.target.value),children:[n.jsx("option",{value:"LAWYER",children:"Lawyer"}),n.jsx("option",{value:"SUB_ADMIN",children:"Sub-Admin"}),n.jsx("option",{value:"BOTH",children:"Both"})]}),n.jsx("label",{className:"text-xs font-bold text-textMuted",children:"Message"}),n.jsx(ho,{clientId:vo,children:n.jsx("textarea",{className:"w-full border rounded p-3 text-sm",rows:4,value:fe,onChange:d=>Te(d.target.value),placeholder:"Reminder details..."})}),n.jsxs("div",{className:"flex justify-end gap-2",children:[n.jsx("button",{onClick:()=>{le(null),Te("")},className:"px-4 py-2 text-textMuted hover:bg-navySecondary rounded",children:"Cancel"}),n.jsx("button",{onClick:()=>{if(ce&&fe.trim()){const d=[];(ge==="LAWYER"||ge==="BOTH")&&d.push(ce.ownerName),(ge==="SUB_ADMIN"||ge==="BOTH")&&d.push(...Ss.filter(m=>m.role==="SUB_ADMIN").map(m=>m.name)),jr({id:`reminder-${Date.now()}`,message:`Reminder to ${d.join(", ")}: ${fe.trim()}`,createdAt:new Date().toISOString(),reportId:ce.id}),le(null),Te("")}},className:"px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700",children:"Send"})]})]})}),Yi&&n.jsx("div",{className:"fixed inset-0 bg-black/50 z-[250] flex items-center justify-center p-4",dir:"rtl",children:n.jsxs("div",{className:"bg-panel rounded-2xl shadow-2xl w-full max-w-md p-6 space-y-4",children:[n.jsx("h3",{className:"text-lg font-bold text-gold",children:"  "}),n.jsx("p",{className:"text-sm text-textLight",children:"     .        ."}),n.jsxs("div",{className:"flex flex-wrap gap-2 justify-end",children:[n.jsx("button",{type:"button",onClick:()=>{Av(l,i,ie),Ir(!0)},className:"px-4 py-2 rounded-lg bg-navy text-gold text-sm font-semibold hover:bg-navySecondary",children:" "}),n.jsx("button",{type:"button",onClick:Gi,disabled:!Na,title:Na?"":"    ",className:"px-4 py-2 rounded-lg bg-red-600 text-white text-sm font-semibold hover:bg-red-700 disabled:opacity-50 disabled:cursor-not-allowed",children:""}),n.jsx("button",{type:"button",onClick:()=>{ya(!1),Ir(!1)},className:"px-4 py-2 rounded-lg border border-borderDark text-textLight text-sm hover:bg-navySecondary",children:""})]}),Na&&n.jsx("p",{className:"text-xs text-green-600",children:" .   ."})]})}),We&&We.issues.length>0&&n.jsx("div",{className:"fixed inset-0 bg-black/40 z-[210] flex items-center justify-center p-4",children:n.jsxs("div",{className:"bg-panel rounded-2xl shadow-2xl w-full max-w-lg p-6 space-y-4",dir:"rtl",children:[n.jsxs("div",{className:"flex items-center justify-between gap-2",children:[n.jsx("h3",{className:"text-lg font-bold text-textLight",children:"  "}),n.jsx("button",{type:"button",onClick:()=>tt(null),className:"p-1 rounded hover:bg-slate-100 text-textMuted",children:n.jsx(Ft,{className:"w-4 h-4"})})]}),n.jsx("p",{className:"text-xs text-textMuted",children:"       PDF    .       ."}),n.jsx("ul",{className:"space-y-2 text-sm text-textLight",children:We.issues.map(d=>n.jsxs("li",{className:"flex items-start justify-between gap-3 border border-slate-100 rounded-md px-3 py-2 bg-slate-50",children:[n.jsx("span",{className:"flex-1",children:d.label}),n.jsxs("div",{className:"flex flex-col items-end gap-1",children:[n.jsx("button",{type:"button",className:"text-[11px] text-indigo-700 hover:text-indigo-900 underline whitespace-nowrap",onClick:()=>{Fe(!0),ms(d.intent)},children:"  ?"}),n.jsx("button",{type:"button",className:"text-[11px] text-textLight hover:text-textLight underline whitespace-nowrap",onClick:()=>{tt(null),(d.kind==="TRANSLATION_OUTDATED"||d.kind==="TONE_RISK_NOT_RUN"||d.kind==="EXPENSES_OLD")&&(ln(),o("STEP2"))},children:d.kind==="TRANSLATION_OUTDATED"?" ":d.kind==="TONE_RISK_NOT_RUN"?" Tone & Risk":d.kind==="EXPENSES_OLD"?"  ":" "})]})]},d.id))}),n.jsx("div",{className:"flex items-center justify-between pt-3 border-t border-slate-100 gap-3",children:n.jsx("button",{type:"button",className:"px-4 py-1.5 rounded-md bg-green-600 text-xs text-white hover:bg-green-700",onClick:()=>{const d=We;tt(null),d!=null&&d.onContinue&&d.onContinue()},children:"  "})})]})}),K&&n.jsx(Wv,{report:K,sessions:T,onSwitch:O,onClose:Ei,currentUser:e,onAddRowNote:Bi,onResolveRowNote:Ui,onAddWorksheetRow:Wi,previousReport:l.filter(d=>d.id!==K.id&&d.odakanitNo&&d.odakanitNo===K.odakanitNo).sort((d,m)=>new Date(m.reportDate).getTime()-new Date(d.reportDate).getTime())[0]})]})},Wv=({report:e,sessions:t,onSwitch:s,onClose:r,currentUser:a,onAddRowNote:o,onResolveRowNote:l,onAddWorksheetRow:c,previousReport:i})=>{const[u,p]=g.useState("table"),[y,b]=g.useState(""),[w,R]=g.useState(null),[E,W]=g.useState({category:"EXPERT_OUR",serviceProvider:"",amount:"",customLabel:""}),N=e.expenseWorksheet||Ms(),h=N.rows.filter(j=>j.type==="EXPENSE"),S=N.rows.filter(j=>j.type==="ADJUSTMENT"),M=N.notes.filter(j=>!j.resolved),H=N.totals||ai(N.rows),V=(a==null?void 0:a.role)==="FINANCE"||(a==null?void 0:a.role)==="SUB_ADMIN",q=is.find(j=>j.value===E.category),te=(q==null?void 0:q.type)!=="ADJUSTMENT",G=j=>{y.trim()&&(o(e.id,j,y.trim()),b(""),R(null))},re=()=>{const j=parseFloat(E.amount);isNaN(j)||j<=0||(c(e.id,{category:E.category,serviceProvider:te?E.serviceProvider:void 0,amount:j,customLabel:E.customLabel}),W({category:"EXPERT_OUR",serviceProvider:"",amount:"",customLabel:""}))};return n.jsx("div",{className:"fixed inset-0 bg-black/40 z-[220] flex items-center justify-center p-4",children:n.jsxs("div",{className:"bg-panel rounded-2xl shadow-2xl w-full max-w-5xl max-h-[90vh] overflow-hidden flex flex-col",children:[n.jsxs("div",{className:"flex justify-between items-center px-5 py-3 border-b bg-navySecondary",children:[n.jsxs("div",{children:[n.jsx("p",{className:"text-xs text-textMuted uppercase",children:"Expense Worksheet"}),n.jsxs("h2",{className:"text-lg font-bold text-textLight",children:[e.insuredName||e.odakanitNo||"Case","  ",e.ownerName]})]}),n.jsx("button",{onClick:()=>r(e.id),className:"text-textMuted hover:text-textLight",children:n.jsx(Ft,{className:"w-5 h-5"})})]}),n.jsx("div",{className:"flex border-b bg-panel px-4 overflow-x-auto",children:t.map(j=>n.jsxs("button",{onClick:()=>s(j.reportId),className:`flex items-center gap-2 px-3 py-2 text-sm border-b-2 ${j.reportId===e.id?"border-lpBlue text-lpBlue font-bold":"border-transparent text-gray-400"}`,children:[j.title,n.jsx("span",{onClick:P=>{P.stopPropagation(),r(j.reportId)},className:"text-gray-400 hover:text-red-500",children:n.jsx(Ft,{className:"w-3 h-3"})})]},j.reportId))}),n.jsx("div",{className:"flex gap-2 px-5 pt-4 text-sm font-semibold",children:["table","history","notes","compare"].map(j=>n.jsx("button",{onClick:()=>p(j),className:`px-3 py-1 rounded-full ${u===j?"bg-navy text-white":"bg-navySecondary text-textMuted"}`,children:j==="table"?"Worksheet":j==="history"?"History":j==="notes"?`Notes (${M.length})`:"Compare"},j))}),n.jsxs("div",{className:"flex-1 overflow-auto p-5 space-y-4",children:[u==="table"&&n.jsxs(n.Fragment,{children:[n.jsxs("div",{className:"grid grid-cols-3 gap-4 text-center bg-navySecondary rounded-lg py-3",children:[n.jsxs("div",{children:[n.jsx("p",{className:"text-xs uppercase text-gray-400",children:"Total Expenses"}),n.jsxs("p",{className:"text-lg font-bold text-textLight",children:["",H.totalExpenses.toLocaleString()]})]}),n.jsxs("div",{children:[n.jsx("p",{className:"text-xs uppercase text-gray-400",children:"Adjustments"}),n.jsxs("p",{className:"text-lg font-bold text-yellow-700",children:["",H.totalAdjustments.toLocaleString()]})]}),n.jsxs("div",{children:[n.jsx("p",{className:"text-xs uppercase text-gray-400",children:"Balance Due"}),n.jsxs("p",{className:"text-lg font-bold text-green-700",children:["",H.totalBalance.toLocaleString()]})]})]}),V&&n.jsxs("div",{className:"border rounded-lg p-3 bg-amber-50 space-y-2",children:[n.jsx("p",{className:"text-xs font-bold text-amber-700",children:"  "}),n.jsxs("div",{className:"grid md:grid-cols-3 gap-2",children:[n.jsx("select",{value:E.category,onChange:j=>W({...E,category:j.target.value}),className:"border rounded text-xs p-2",children:is.map(j=>n.jsx("option",{value:j.value,children:j.label},j.value))}),E.category==="OTHER"&&n.jsx("input",{className:"border rounded text-xs p-2",placeholder:" ",value:E.customLabel,onChange:j=>W({...E,customLabel:j.target.value})}),te&&n.jsx("input",{className:"border rounded text-xs p-2",placeholder:" ",value:E.serviceProvider,onChange:j=>W({...E,serviceProvider:j.target.value})}),n.jsx("input",{className:"border rounded text-xs p-2",placeholder:" ",type:"number",min:"0",value:E.amount,onChange:j=>W({...E,amount:j.target.value})}),n.jsx("button",{onClick:re,className:"bg-amber-500 text-white rounded text-xs font-bold px-3 py-2 hover:bg-amber-600",children:"Add"})]})]}),n.jsxs("div",{className:"grid md:grid-cols-2 gap-6",children:[n.jsxs("div",{children:[n.jsx("h4",{className:"text-sm font-bold text-textMuted mb-2",children:"Service Expenses"}),n.jsxs("div",{className:"space-y-2",children:[h.length===0&&n.jsx("p",{className:"text-xs text-gray-400",children:"No expenses recorded."}),h.map(j=>{const P=N.notes.filter(D=>D.rowId===j.id&&!D.resolved).length;return n.jsxs("div",{className:"border rounded-lg p-3 bg-panel shadow-sm",children:[n.jsxs("div",{className:"flex justify-between",children:[n.jsxs("div",{children:[n.jsx("p",{className:"font-semibold text-sm",children:j.label}),j.serviceProvider&&n.jsx("p",{className:"text-xs text-textMuted",children:j.serviceProvider})]}),n.jsxs("div",{className:"text-right",children:[n.jsxs("p",{className:"font-bold text-lpBlue",children:["",j.amount.toLocaleString()]}),n.jsxs("button",{className:"text-[10px] text-gray-400",onClick:()=>R(w===j.id?null:j.id),children:[" Notes (",P,")"]})]})]}),w===j.id&&n.jsxs("div",{className:"mt-2 flex gap-2",children:[n.jsx("input",{className:"flex-1 border rounded text-xs p-2",value:y,onChange:D=>b(D.target.value),placeholder:"Add note..."}),n.jsx("button",{onClick:()=>G(j.id),className:"px-3 py-1 text-xs bg-navy text-white rounded",children:"Save"})]})]},j.id)})]})]}),n.jsxs("div",{children:[n.jsx("h4",{className:"text-sm font-bold text-textMuted mb-2",children:"Adjustments"}),n.jsxs("div",{className:"space-y-2",children:[S.length===0&&n.jsx("p",{className:"text-xs text-gray-400",children:"No adjustments yet."}),S.map(j=>n.jsx("div",{className:"border rounded-lg p-3 bg-navySecondary",children:n.jsxs("div",{className:"flex justify-between",children:[n.jsx("p",{className:"font-semibold text-sm",children:j.label}),n.jsxs("p",{className:"font-bold text-red-600",children:["",j.amount.toLocaleString()]})]})},j.id))]})]})]}),n.jsxs("div",{className:"border rounded-lg p-3 bg-navySecondary",children:[n.jsx("label",{className:"block text-xs font-bold text-textMuted mb-1",children:"General Note"}),n.jsxs("div",{className:"flex gap-2",children:[n.jsx("input",{className:"flex-1 border rounded text-xs p-2",value:y,onChange:j=>b(j.target.value),placeholder:"Add note for worksheet..."}),n.jsx("button",{onClick:()=>G(void 0),className:"px-3 py-1 text-xs bg-navy text-white rounded",children:"Save"})]})]})]}),u==="history"&&n.jsxs("div",{className:"space-y-2",children:[N.history.length===0&&n.jsx("p",{className:"text-xs text-gray-400",children:"No history recorded yet."}),N.history.map(j=>n.jsxs("div",{className:"border rounded-lg p-3 bg-panel flex justify-between",children:[n.jsxs("div",{children:[n.jsx("p",{className:"text-sm font-semibold",children:j.action}),j.details&&n.jsx("p",{className:"text-xs text-textMuted",children:j.details})]}),n.jsxs("div",{className:"text-right text-[10px] text-gray-400",children:[n.jsx("p",{children:j.userName}),n.jsx("p",{children:new Date(j.timestamp).toLocaleString()})]})]},j.id))]}),u==="notes"&&n.jsxs("div",{className:"space-y-2",children:[N.notes.length===0&&n.jsx("p",{className:"text-xs text-gray-400",children:"No notes yet."}),N.notes.map(j=>n.jsx("div",{className:`border rounded-lg p-3 ${j.resolved?"bg-green-50":"bg-panel"}`,children:n.jsxs("div",{className:"flex justify-between",children:[n.jsxs("div",{children:[n.jsx("p",{className:"text-sm font-semibold",children:j.authorName}),n.jsx("p",{className:"text-xs text-textMuted",children:j.message})]}),n.jsxs("div",{className:"text-right text-[10px] text-gray-400",children:[n.jsx("p",{children:new Date(j.createdAt).toLocaleString()}),!j.resolved&&n.jsx("button",{onClick:()=>l(e.id,j.id),className:"text-xs text-green-600 hover:underline",children:"Resolve"})]})]})},j.id))]}),u==="compare"&&n.jsx("div",{children:i!=null&&i.expenseWorksheet?n.jsxs("div",{className:"grid md:grid-cols-2 gap-4",children:[n.jsxs("div",{className:"border rounded-lg p-3",children:[n.jsx("h4",{className:"text-sm font-bold text-textMuted mb-2",children:"Previous Report"}),n.jsx("p",{className:"text-xs text-gray-400 mb-2",children:new Date(i.reportDate).toLocaleDateString()}),n.jsxs("p",{className:"text-lg font-bold text-textLight",children:["",i.expenseWorksheet.totals.totalBalance.toLocaleString()]})]}),n.jsxs("div",{className:"border rounded-lg p-3",children:[n.jsx("h4",{className:"text-sm font-bold text-textMuted mb-2",children:"Current Report"}),n.jsx("p",{className:"text-xs text-gray-400 mb-2",children:new Date(e.reportDate).toLocaleDateString()}),n.jsxs("p",{className:"text-lg font-bold text-textLight",children:["",H.totalBalance.toLocaleString()]})]})]}):n.jsx("p",{className:"text-xs text-gray-400",children:"No previous worksheet available for comparison."})})]})]})})},zv=()=>n.jsx(ev,{children:n.jsx(Uv,{})}),Gu=document.getElementById("root");console.log("Bootstrapping LP app, rootElement exists?",!!Gu);if(!Gu)throw new Error("Could not find root element to mount to");const Vv=Pc.createRoot(Gu);Vv.render(n.jsx(ii.StrictMode,{children:n.jsx(zv,{})}));export{Gh as g};
