(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))r(a);new MutationObserver(a=>{for(const o of a)if(o.type==="childList")for(const l of o.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&r(l)}).observe(document,{childList:!0,subtree:!0});function s(a){const o={};return a.integrity&&(o.integrity=a.integrity),a.referrerPolicy&&(o.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?o.credentials="include":a.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function r(a){if(a.ep)return;a.ep=!0;const o=s(a);fetch(a.href,o)}})();function Bh(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var $p={exports:{}},ai={},Hp={exports:{}},et={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var vo=Symbol.for("react.element"),$h=Symbol.for("react.portal"),Hh=Symbol.for("react.fragment"),Uh=Symbol.for("react.strict_mode"),Wh=Symbol.for("react.profiler"),zh=Symbol.for("react.provider"),Vh=Symbol.for("react.context"),Kh=Symbol.for("react.forward_ref"),Yh=Symbol.for("react.suspense"),Gh=Symbol.for("react.memo"),qh=Symbol.for("react.lazy"),Ku=Symbol.iterator;function Xh(e){return e===null||typeof e!="object"?null:(e=Ku&&e[Ku]||e["@@iterator"],typeof e=="function"?e:null)}var Up={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},Wp=Object.assign,zp={};function oa(e,t,s){this.props=e,this.context=t,this.refs=zp,this.updater=s||Up}oa.prototype.isReactComponent={};oa.prototype.setState=function(e,t){if(typeof e!="object"&&typeof e!="function"&&e!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,e,t,"setState")};oa.prototype.forceUpdate=function(e){this.updater.enqueueForceUpdate(this,e,"forceUpdate")};function Vp(){}Vp.prototype=oa.prototype;function Rd(e,t,s){this.props=e,this.context=t,this.refs=zp,this.updater=s||Up}var Cd=Rd.prototype=new Vp;Cd.constructor=Rd;Wp(Cd,oa.prototype);Cd.isPureReactComponent=!0;var Yu=Array.isArray,Kp=Object.prototype.hasOwnProperty,Dd={current:null},Yp={key:!0,ref:!0,__self:!0,__source:!0};function Gp(e,t,s){var r,a={},o=null,l=null;if(t!=null)for(r in t.ref!==void 0&&(l=t.ref),t.key!==void 0&&(o=""+t.key),t)Kp.call(t,r)&&!Yp.hasOwnProperty(r)&&(a[r]=t[r]);var i=arguments.length-2;if(i===1)a.children=s;else if(1<i){for(var c=Array(i),m=0;m<i;m++)c[m]=arguments[m+2];a.children=c}if(e&&e.defaultProps)for(r in i=e.defaultProps,i)a[r]===void 0&&(a[r]=i[r]);return{$$typeof:vo,type:e,key:o,ref:l,props:a,_owner:Dd.current}}function Jh(e,t){return{$$typeof:vo,type:e.type,key:t,ref:e.ref,props:e.props,_owner:e._owner}}function Ld(e){return typeof e=="object"&&e!==null&&e.$$typeof===vo}function Qh(e){var t={"=":"=0",":":"=2"};return"$"+e.replace(/[=:]/g,function(s){return t[s]})}var Gu=/\/+/g;function Vi(e,t){return typeof e=="object"&&e!==null&&e.key!=null?Qh(""+e.key):t.toString(36)}function ul(e,t,s,r,a){var o=typeof e;(o==="undefined"||o==="boolean")&&(e=null);var l=!1;if(e===null)l=!0;else switch(o){case"string":case"number":l=!0;break;case"object":switch(e.$$typeof){case vo:case $h:l=!0}}if(l)return l=e,a=a(l),e=r===""?"."+Vi(l,0):r,Yu(a)?(s="",e!=null&&(s=e.replace(Gu,"$&/")+"/"),ul(a,t,s,"",function(m){return m})):a!=null&&(Ld(a)&&(a=Jh(a,s+(!a.key||l&&l.key===a.key?"":(""+a.key).replace(Gu,"$&/")+"/")+e)),t.push(a)),1;if(l=0,r=r===""?".":r+":",Yu(e))for(var i=0;i<e.length;i++){o=e[i];var c=r+Vi(o,i);l+=ul(o,t,s,c,a)}else if(c=Xh(e),typeof c=="function")for(e=c.call(e),i=0;!(o=e.next()).done;)o=o.value,c=r+Vi(o,i++),l+=ul(o,t,s,c,a);else if(o==="object")throw t=String(e),Error("Objects are not valid as a React child (found: "+(t==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":t)+"). If you meant to render a collection of children, use an array instead.");return l}function $o(e,t,s){if(e==null)return e;var r=[],a=0;return ul(e,r,"","",function(o){return t.call(s,o,a++)}),r}function Zh(e){if(e._status===-1){var t=e._result;t=t(),t.then(function(s){(e._status===0||e._status===-1)&&(e._status=1,e._result=s)},function(s){(e._status===0||e._status===-1)&&(e._status=2,e._result=s)}),e._status===-1&&(e._status=0,e._result=t)}if(e._status===1)return e._result.default;throw e._result}var nn={current:null},ml={transition:null},eg={ReactCurrentDispatcher:nn,ReactCurrentBatchConfig:ml,ReactCurrentOwner:Dd};function qp(){throw Error("act(...) is not supported in production builds of React.")}et.Children={map:$o,forEach:function(e,t,s){$o(e,function(){t.apply(this,arguments)},s)},count:function(e){var t=0;return $o(e,function(){t++}),t},toArray:function(e){return $o(e,function(t){return t})||[]},only:function(e){if(!Ld(e))throw Error("React.Children.only expected to receive a single React element child.");return e}};et.Component=oa;et.Fragment=Hh;et.Profiler=Wh;et.PureComponent=Rd;et.StrictMode=Uh;et.Suspense=Yh;et.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=eg;et.act=qp;et.cloneElement=function(e,t,s){if(e==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+e+".");var r=Wp({},e.props),a=e.key,o=e.ref,l=e._owner;if(t!=null){if(t.ref!==void 0&&(o=t.ref,l=Dd.current),t.key!==void 0&&(a=""+t.key),e.type&&e.type.defaultProps)var i=e.type.defaultProps;for(c in t)Kp.call(t,c)&&!Yp.hasOwnProperty(c)&&(r[c]=t[c]===void 0&&i!==void 0?i[c]:t[c])}var c=arguments.length-2;if(c===1)r.children=s;else if(1<c){i=Array(c);for(var m=0;m<c;m++)i[m]=arguments[m+2];r.children=i}return{$$typeof:vo,type:e.type,key:a,ref:o,props:r,_owner:l}};et.createContext=function(e){return e={$$typeof:Vh,_currentValue:e,_currentValue2:e,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},e.Provider={$$typeof:zh,_context:e},e.Consumer=e};et.createElement=Gp;et.createFactory=function(e){var t=Gp.bind(null,e);return t.type=e,t};et.createRef=function(){return{current:null}};et.forwardRef=function(e){return{$$typeof:Kh,render:e}};et.isValidElement=Ld;et.lazy=function(e){return{$$typeof:qh,_payload:{_status:-1,_result:e},_init:Zh}};et.memo=function(e,t){return{$$typeof:Gh,type:e,compare:t===void 0?null:t}};et.startTransition=function(e){var t=ml.transition;ml.transition={};try{e()}finally{ml.transition=t}};et.unstable_act=qp;et.useCallback=function(e,t){return nn.current.useCallback(e,t)};et.useContext=function(e){return nn.current.useContext(e)};et.useDebugValue=function(){};et.useDeferredValue=function(e){return nn.current.useDeferredValue(e)};et.useEffect=function(e,t){return nn.current.useEffect(e,t)};et.useId=function(){return nn.current.useId()};et.useImperativeHandle=function(e,t,s){return nn.current.useImperativeHandle(e,t,s)};et.useInsertionEffect=function(e,t){return nn.current.useInsertionEffect(e,t)};et.useLayoutEffect=function(e,t){return nn.current.useLayoutEffect(e,t)};et.useMemo=function(e,t){return nn.current.useMemo(e,t)};et.useReducer=function(e,t,s){return nn.current.useReducer(e,t,s)};et.useRef=function(e){return nn.current.useRef(e)};et.useState=function(e){return nn.current.useState(e)};et.useSyncExternalStore=function(e,t,s){return nn.current.useSyncExternalStore(e,t,s)};et.useTransition=function(){return nn.current.useTransition()};et.version="18.3.1";Hp.exports=et;var y=Hp.exports;const oi=Bh(y);/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var tg=y,ng=Symbol.for("react.element"),sg=Symbol.for("react.fragment"),rg=Object.prototype.hasOwnProperty,ag=tg.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,og={key:!0,ref:!0,__self:!0,__source:!0};function Xp(e,t,s){var r,a={},o=null,l=null;s!==void 0&&(o=""+s),t.key!==void 0&&(o=""+t.key),t.ref!==void 0&&(l=t.ref);for(r in t)rg.call(t,r)&&!og.hasOwnProperty(r)&&(a[r]=t[r]);if(e&&e.defaultProps)for(r in t=e.defaultProps,t)a[r]===void 0&&(a[r]=t[r]);return{$$typeof:ng,type:e,key:o,ref:l,props:a,_owner:ag.current}}ai.Fragment=sg;ai.jsx=Xp;ai.jsxs=Xp;$p.exports=ai;var n=$p.exports,Cc={},Jp={exports:{}},Nn={},Qp={exports:{}},Zp={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(e){function t(P,X){var ie=P.length;P.push(X);e:for(;0<ie;){var fe=ie-1>>>1,se=P[fe];if(0<a(se,X))P[fe]=X,P[ie]=se,ie=fe;else break e}}function s(P){return P.length===0?null:P[0]}function r(P){if(P.length===0)return null;var X=P[0],ie=P.pop();if(ie!==X){P[0]=ie;e:for(var fe=0,se=P.length,ue=se>>>1;fe<ue;){var we=2*(fe+1)-1,He=P[we],Ue=we+1,Ze=P[Ue];if(0>a(He,ie))Ue<se&&0>a(Ze,He)?(P[fe]=Ze,P[Ue]=ie,fe=Ue):(P[fe]=He,P[we]=ie,fe=we);else if(Ue<se&&0>a(Ze,ie))P[fe]=Ze,P[Ue]=ie,fe=Ue;else break e}}return X}function a(P,X){var ie=P.sortIndex-X.sortIndex;return ie!==0?ie:P.id-X.id}if(typeof performance=="object"&&typeof performance.now=="function"){var o=performance;e.unstable_now=function(){return o.now()}}else{var l=Date,i=l.now();e.unstable_now=function(){return l.now()-i}}var c=[],m=[],p=1,h=null,v=3,A=!1,D=!1,I=!1,W=typeof setTimeout=="function"?setTimeout:null,N=typeof clearTimeout=="function"?clearTimeout:null,x=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function b(P){for(var X=s(m);X!==null;){if(X.callback===null)r(m);else if(X.startTime<=P)r(m),X.sortIndex=X.expirationTime,t(c,X);else break;X=s(m)}}function B(P){if(I=!1,b(P),!D)if(s(c)!==null)D=!0,V(H);else{var X=s(m);X!==null&&_(B,X.startTime-P)}}function H(P,X){D=!1,I&&(I=!1,N(Q),Q=-1),A=!0;var ie=v;try{for(b(X),h=s(c);h!==null&&(!(h.expirationTime>X)||P&&!E());){var fe=h.callback;if(typeof fe=="function"){h.callback=null,v=h.priorityLevel;var se=fe(h.expirationTime<=X);X=e.unstable_now(),typeof se=="function"?h.callback=se:h===s(c)&&r(c),b(X)}else r(c);h=s(c)}if(h!==null)var ue=!0;else{var we=s(m);we!==null&&_(B,we.startTime-X),ue=!1}return ue}finally{h=null,v=ie,A=!1}}var z=!1,Y=null,Q=-1,G=5,ae=-1;function E(){return!(e.unstable_now()-ae<G)}function R(){if(Y!==null){var P=e.unstable_now();ae=P;var X=!0;try{X=Y(!0,P)}finally{X?k():(z=!1,Y=null)}}else z=!1}var k;if(typeof x=="function")k=function(){x(R)};else if(typeof MessageChannel<"u"){var C=new MessageChannel,ee=C.port2;C.port1.onmessage=R,k=function(){ee.postMessage(null)}}else k=function(){W(R,0)};function V(P){Y=P,z||(z=!0,k())}function _(P,X){Q=W(function(){P(e.unstable_now())},X)}e.unstable_IdlePriority=5,e.unstable_ImmediatePriority=1,e.unstable_LowPriority=4,e.unstable_NormalPriority=3,e.unstable_Profiling=null,e.unstable_UserBlockingPriority=2,e.unstable_cancelCallback=function(P){P.callback=null},e.unstable_continueExecution=function(){D||A||(D=!0,V(H))},e.unstable_forceFrameRate=function(P){0>P||125<P?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):G=0<P?Math.floor(1e3/P):5},e.unstable_getCurrentPriorityLevel=function(){return v},e.unstable_getFirstCallbackNode=function(){return s(c)},e.unstable_next=function(P){switch(v){case 1:case 2:case 3:var X=3;break;default:X=v}var ie=v;v=X;try{return P()}finally{v=ie}},e.unstable_pauseExecution=function(){},e.unstable_requestPaint=function(){},e.unstable_runWithPriority=function(P,X){switch(P){case 1:case 2:case 3:case 4:case 5:break;default:P=3}var ie=v;v=P;try{return X()}finally{v=ie}},e.unstable_scheduleCallback=function(P,X,ie){var fe=e.unstable_now();switch(typeof ie=="object"&&ie!==null?(ie=ie.delay,ie=typeof ie=="number"&&0<ie?fe+ie:fe):ie=fe,P){case 1:var se=-1;break;case 2:se=250;break;case 5:se=1073741823;break;case 4:se=1e4;break;default:se=5e3}return se=ie+se,P={id:p++,callback:X,priorityLevel:P,startTime:ie,expirationTime:se,sortIndex:-1},ie>fe?(P.sortIndex=ie,t(m,P),s(c)===null&&P===s(m)&&(I?(N(Q),Q=-1):I=!0,_(B,ie-fe))):(P.sortIndex=se,t(c,P),D||A||(D=!0,V(H))),P},e.unstable_shouldYield=E,e.unstable_wrapCallback=function(P){var X=v;return function(){var ie=v;v=X;try{return P.apply(this,arguments)}finally{v=ie}}}})(Zp);Qp.exports=Zp;var lg=Qp.exports;/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var ig=y,yn=lg;function de(e){for(var t="https://reactjs.org/docs/error-decoder.html?invariant="+e,s=1;s<arguments.length;s++)t+="&args[]="+encodeURIComponent(arguments[s]);return"Minified React error #"+e+"; visit "+t+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var ef=new Set,Ya={};function br(e,t){Xr(e,t),Xr(e+"Capture",t)}function Xr(e,t){for(Ya[e]=t,e=0;e<t.length;e++)ef.add(t[e])}var ys=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),Dc=Object.prototype.hasOwnProperty,cg=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,qu={},Xu={};function dg(e){return Dc.call(Xu,e)?!0:Dc.call(qu,e)?!1:cg.test(e)?Xu[e]=!0:(qu[e]=!0,!1)}function ug(e,t,s,r){if(s!==null&&s.type===0)return!1;switch(typeof t){case"function":case"symbol":return!0;case"boolean":return r?!1:s!==null?!s.acceptsBooleans:(e=e.toLowerCase().slice(0,5),e!=="data-"&&e!=="aria-");default:return!1}}function mg(e,t,s,r){if(t===null||typeof t>"u"||ug(e,t,s,r))return!0;if(r)return!1;if(s!==null)switch(s.type){case 3:return!t;case 4:return t===!1;case 5:return isNaN(t);case 6:return isNaN(t)||1>t}return!1}function sn(e,t,s,r,a,o,l){this.acceptsBooleans=t===2||t===3||t===4,this.attributeName=r,this.attributeNamespace=a,this.mustUseProperty=s,this.propertyName=e,this.type=t,this.sanitizeURL=o,this.removeEmptyString=l}var zt={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(e){zt[e]=new sn(e,0,!1,e,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(e){var t=e[0];zt[t]=new sn(t,1,!1,e[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(e){zt[e]=new sn(e,2,!1,e.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(e){zt[e]=new sn(e,2,!1,e,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(e){zt[e]=new sn(e,3,!1,e.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(e){zt[e]=new sn(e,3,!0,e,null,!1,!1)});["capture","download"].forEach(function(e){zt[e]=new sn(e,4,!1,e,null,!1,!1)});["cols","rows","size","span"].forEach(function(e){zt[e]=new sn(e,6,!1,e,null,!1,!1)});["rowSpan","start"].forEach(function(e){zt[e]=new sn(e,5,!1,e.toLowerCase(),null,!1,!1)});var _d=/[\-:]([a-z])/g;function Od(e){return e[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(e){var t=e.replace(_d,Od);zt[t]=new sn(t,1,!1,e,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(e){var t=e.replace(_d,Od);zt[t]=new sn(t,1,!1,e,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(e){var t=e.replace(_d,Od);zt[t]=new sn(t,1,!1,e,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(e){zt[e]=new sn(e,1,!1,e.toLowerCase(),null,!1,!1)});zt.xlinkHref=new sn("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(e){zt[e]=new sn(e,1,!1,e.toLowerCase(),null,!0,!0)});function Md(e,t,s,r){var a=zt.hasOwnProperty(t)?zt[t]:null;(a!==null?a.type!==0:r||!(2<t.length)||t[0]!=="o"&&t[0]!=="O"||t[1]!=="n"&&t[1]!=="N")&&(mg(t,s,a,r)&&(s=null),r||a===null?dg(t)&&(s===null?e.removeAttribute(t):e.setAttribute(t,""+s)):a.mustUseProperty?e[a.propertyName]=s===null?a.type===3?!1:"":s:(t=a.attributeName,r=a.attributeNamespace,s===null?e.removeAttribute(t):(a=a.type,s=a===3||a===4&&s===!0?"":""+s,r?e.setAttributeNS(r,t,s):e.setAttribute(t,s))))}var Ss=ig.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,Ho=Symbol.for("react.element"),Cr=Symbol.for("react.portal"),Dr=Symbol.for("react.fragment"),Pd=Symbol.for("react.strict_mode"),Lc=Symbol.for("react.profiler"),tf=Symbol.for("react.provider"),nf=Symbol.for("react.context"),Fd=Symbol.for("react.forward_ref"),_c=Symbol.for("react.suspense"),Oc=Symbol.for("react.suspense_list"),Bd=Symbol.for("react.memo"),Cs=Symbol.for("react.lazy"),sf=Symbol.for("react.offscreen"),Ju=Symbol.iterator;function va(e){return e===null||typeof e!="object"?null:(e=Ju&&e[Ju]||e["@@iterator"],typeof e=="function"?e:null)}var St=Object.assign,Ki;function Da(e){if(Ki===void 0)try{throw Error()}catch(s){var t=s.stack.trim().match(/\n( *(at )?)/);Ki=t&&t[1]||""}return`
`+Ki+e}var Yi=!1;function Gi(e,t){if(!e||Yi)return"";Yi=!0;var s=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(t)if(t=function(){throw Error()},Object.defineProperty(t.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(t,[])}catch(m){var r=m}Reflect.construct(e,[],t)}else{try{t.call()}catch(m){r=m}e.call(t.prototype)}else{try{throw Error()}catch(m){r=m}e()}}catch(m){if(m&&r&&typeof m.stack=="string"){for(var a=m.stack.split(`
`),o=r.stack.split(`
`),l=a.length-1,i=o.length-1;1<=l&&0<=i&&a[l]!==o[i];)i--;for(;1<=l&&0<=i;l--,i--)if(a[l]!==o[i]){if(l!==1||i!==1)do if(l--,i--,0>i||a[l]!==o[i]){var c=`
`+a[l].replace(" at new "," at ");return e.displayName&&c.includes("<anonymous>")&&(c=c.replace("<anonymous>",e.displayName)),c}while(1<=l&&0<=i);break}}}finally{Yi=!1,Error.prepareStackTrace=s}return(e=e?e.displayName||e.name:"")?Da(e):""}function pg(e){switch(e.tag){case 5:return Da(e.type);case 16:return Da("Lazy");case 13:return Da("Suspense");case 19:return Da("SuspenseList");case 0:case 2:case 15:return e=Gi(e.type,!1),e;case 11:return e=Gi(e.type.render,!1),e;case 1:return e=Gi(e.type,!0),e;default:return""}}function Mc(e){if(e==null)return null;if(typeof e=="function")return e.displayName||e.name||null;if(typeof e=="string")return e;switch(e){case Dr:return"Fragment";case Cr:return"Portal";case Lc:return"Profiler";case Pd:return"StrictMode";case _c:return"Suspense";case Oc:return"SuspenseList"}if(typeof e=="object")switch(e.$$typeof){case nf:return(e.displayName||"Context")+".Consumer";case tf:return(e._context.displayName||"Context")+".Provider";case Fd:var t=e.render;return e=e.displayName,e||(e=t.displayName||t.name||"",e=e!==""?"ForwardRef("+e+")":"ForwardRef"),e;case Bd:return t=e.displayName||null,t!==null?t:Mc(e.type)||"Memo";case Cs:t=e._payload,e=e._init;try{return Mc(e(t))}catch{}}return null}function fg(e){var t=e.type;switch(e.tag){case 24:return"Cache";case 9:return(t.displayName||"Context")+".Consumer";case 10:return(t._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return e=t.render,e=e.displayName||e.name||"",t.displayName||(e!==""?"ForwardRef("+e+")":"ForwardRef");case 7:return"Fragment";case 5:return t;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return Mc(t);case 8:return t===Pd?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof t=="function")return t.displayName||t.name||null;if(typeof t=="string")return t}return null}function qs(e){switch(typeof e){case"boolean":case"number":case"string":case"undefined":return e;case"object":return e;default:return""}}function rf(e){var t=e.type;return(e=e.nodeName)&&e.toLowerCase()==="input"&&(t==="checkbox"||t==="radio")}function xg(e){var t=rf(e)?"checked":"value",s=Object.getOwnPropertyDescriptor(e.constructor.prototype,t),r=""+e[t];if(!e.hasOwnProperty(t)&&typeof s<"u"&&typeof s.get=="function"&&typeof s.set=="function"){var a=s.get,o=s.set;return Object.defineProperty(e,t,{configurable:!0,get:function(){return a.call(this)},set:function(l){r=""+l,o.call(this,l)}}),Object.defineProperty(e,t,{enumerable:s.enumerable}),{getValue:function(){return r},setValue:function(l){r=""+l},stopTracking:function(){e._valueTracker=null,delete e[t]}}}}function Uo(e){e._valueTracker||(e._valueTracker=xg(e))}function af(e){if(!e)return!1;var t=e._valueTracker;if(!t)return!0;var s=t.getValue(),r="";return e&&(r=rf(e)?e.checked?"true":"false":e.value),e=r,e!==s?(t.setValue(e),!0):!1}function jl(e){if(e=e||(typeof document<"u"?document:void 0),typeof e>"u")return null;try{return e.activeElement||e.body}catch{return e.body}}function Pc(e,t){var s=t.checked;return St({},t,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:s??e._wrapperState.initialChecked})}function Qu(e,t){var s=t.defaultValue==null?"":t.defaultValue,r=t.checked!=null?t.checked:t.defaultChecked;s=qs(t.value!=null?t.value:s),e._wrapperState={initialChecked:r,initialValue:s,controlled:t.type==="checkbox"||t.type==="radio"?t.checked!=null:t.value!=null}}function of(e,t){t=t.checked,t!=null&&Md(e,"checked",t,!1)}function Fc(e,t){of(e,t);var s=qs(t.value),r=t.type;if(s!=null)r==="number"?(s===0&&e.value===""||e.value!=s)&&(e.value=""+s):e.value!==""+s&&(e.value=""+s);else if(r==="submit"||r==="reset"){e.removeAttribute("value");return}t.hasOwnProperty("value")?Bc(e,t.type,s):t.hasOwnProperty("defaultValue")&&Bc(e,t.type,qs(t.defaultValue)),t.checked==null&&t.defaultChecked!=null&&(e.defaultChecked=!!t.defaultChecked)}function Zu(e,t,s){if(t.hasOwnProperty("value")||t.hasOwnProperty("defaultValue")){var r=t.type;if(!(r!=="submit"&&r!=="reset"||t.value!==void 0&&t.value!==null))return;t=""+e._wrapperState.initialValue,s||t===e.value||(e.value=t),e.defaultValue=t}s=e.name,s!==""&&(e.name=""),e.defaultChecked=!!e._wrapperState.initialChecked,s!==""&&(e.name=s)}function Bc(e,t,s){(t!=="number"||jl(e.ownerDocument)!==e)&&(s==null?e.defaultValue=""+e._wrapperState.initialValue:e.defaultValue!==""+s&&(e.defaultValue=""+s))}var La=Array.isArray;function Wr(e,t,s,r){if(e=e.options,t){t={};for(var a=0;a<s.length;a++)t["$"+s[a]]=!0;for(s=0;s<e.length;s++)a=t.hasOwnProperty("$"+e[s].value),e[s].selected!==a&&(e[s].selected=a),a&&r&&(e[s].defaultSelected=!0)}else{for(s=""+qs(s),t=null,a=0;a<e.length;a++){if(e[a].value===s){e[a].selected=!0,r&&(e[a].defaultSelected=!0);return}t!==null||e[a].disabled||(t=e[a])}t!==null&&(t.selected=!0)}}function $c(e,t){if(t.dangerouslySetInnerHTML!=null)throw Error(de(91));return St({},t,{value:void 0,defaultValue:void 0,children:""+e._wrapperState.initialValue})}function em(e,t){var s=t.value;if(s==null){if(s=t.children,t=t.defaultValue,s!=null){if(t!=null)throw Error(de(92));if(La(s)){if(1<s.length)throw Error(de(93));s=s[0]}t=s}t==null&&(t=""),s=t}e._wrapperState={initialValue:qs(s)}}function lf(e,t){var s=qs(t.value),r=qs(t.defaultValue);s!=null&&(s=""+s,s!==e.value&&(e.value=s),t.defaultValue==null&&e.defaultValue!==s&&(e.defaultValue=s)),r!=null&&(e.defaultValue=""+r)}function tm(e){var t=e.textContent;t===e._wrapperState.initialValue&&t!==""&&t!==null&&(e.value=t)}function cf(e){switch(e){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function Hc(e,t){return e==null||e==="http://www.w3.org/1999/xhtml"?cf(t):e==="http://www.w3.org/2000/svg"&&t==="foreignObject"?"http://www.w3.org/1999/xhtml":e}var Wo,df=function(e){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(t,s,r,a){MSApp.execUnsafeLocalFunction(function(){return e(t,s,r,a)})}:e}(function(e,t){if(e.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in e)e.innerHTML=t;else{for(Wo=Wo||document.createElement("div"),Wo.innerHTML="<svg>"+t.valueOf().toString()+"</svg>",t=Wo.firstChild;e.firstChild;)e.removeChild(e.firstChild);for(;t.firstChild;)e.appendChild(t.firstChild)}});function Ga(e,t){if(t){var s=e.firstChild;if(s&&s===e.lastChild&&s.nodeType===3){s.nodeValue=t;return}}e.textContent=t}var Ma={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},hg=["Webkit","ms","Moz","O"];Object.keys(Ma).forEach(function(e){hg.forEach(function(t){t=t+e.charAt(0).toUpperCase()+e.substring(1),Ma[t]=Ma[e]})});function uf(e,t,s){return t==null||typeof t=="boolean"||t===""?"":s||typeof t!="number"||t===0||Ma.hasOwnProperty(e)&&Ma[e]?(""+t).trim():t+"px"}function mf(e,t){e=e.style;for(var s in t)if(t.hasOwnProperty(s)){var r=s.indexOf("--")===0,a=uf(s,t[s],r);s==="float"&&(s="cssFloat"),r?e.setProperty(s,a):e[s]=a}}var gg=St({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function Uc(e,t){if(t){if(gg[e]&&(t.children!=null||t.dangerouslySetInnerHTML!=null))throw Error(de(137,e));if(t.dangerouslySetInnerHTML!=null){if(t.children!=null)throw Error(de(60));if(typeof t.dangerouslySetInnerHTML!="object"||!("__html"in t.dangerouslySetInnerHTML))throw Error(de(61))}if(t.style!=null&&typeof t.style!="object")throw Error(de(62))}}function Wc(e,t){if(e.indexOf("-")===-1)return typeof t.is=="string";switch(e){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var zc=null;function $d(e){return e=e.target||e.srcElement||window,e.correspondingUseElement&&(e=e.correspondingUseElement),e.nodeType===3?e.parentNode:e}var Vc=null,zr=null,Vr=null;function nm(e){if(e=jo(e)){if(typeof Vc!="function")throw Error(de(280));var t=e.stateNode;t&&(t=ui(t),Vc(e.stateNode,e.type,t))}}function pf(e){zr?Vr?Vr.push(e):Vr=[e]:zr=e}function ff(){if(zr){var e=zr,t=Vr;if(Vr=zr=null,nm(e),t)for(e=0;e<t.length;e++)nm(t[e])}}function xf(e,t){return e(t)}function hf(){}var qi=!1;function gf(e,t,s){if(qi)return e(t,s);qi=!0;try{return xf(e,t,s)}finally{qi=!1,(zr!==null||Vr!==null)&&(hf(),ff())}}function qa(e,t){var s=e.stateNode;if(s===null)return null;var r=ui(s);if(r===null)return null;s=r[t];e:switch(t){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(r=!r.disabled)||(e=e.type,r=!(e==="button"||e==="input"||e==="select"||e==="textarea")),e=!r;break e;default:e=!1}if(e)return null;if(s&&typeof s!="function")throw Error(de(231,t,typeof s));return s}var Kc=!1;if(ys)try{var Sa={};Object.defineProperty(Sa,"passive",{get:function(){Kc=!0}}),window.addEventListener("test",Sa,Sa),window.removeEventListener("test",Sa,Sa)}catch{Kc=!1}function yg(e,t,s,r,a,o,l,i,c){var m=Array.prototype.slice.call(arguments,3);try{t.apply(s,m)}catch(p){this.onError(p)}}var Pa=!1,El=null,kl=!1,Yc=null,Ng={onError:function(e){Pa=!0,El=e}};function bg(e,t,s,r,a,o,l,i,c){Pa=!1,El=null,yg.apply(Ng,arguments)}function vg(e,t,s,r,a,o,l,i,c){if(bg.apply(this,arguments),Pa){if(Pa){var m=El;Pa=!1,El=null}else throw Error(de(198));kl||(kl=!0,Yc=m)}}function vr(e){var t=e,s=e;if(e.alternate)for(;t.return;)t=t.return;else{e=t;do t=e,t.flags&4098&&(s=t.return),e=t.return;while(e)}return t.tag===3?s:null}function yf(e){if(e.tag===13){var t=e.memoizedState;if(t===null&&(e=e.alternate,e!==null&&(t=e.memoizedState)),t!==null)return t.dehydrated}return null}function sm(e){if(vr(e)!==e)throw Error(de(188))}function Sg(e){var t=e.alternate;if(!t){if(t=vr(e),t===null)throw Error(de(188));return t!==e?null:e}for(var s=e,r=t;;){var a=s.return;if(a===null)break;var o=a.alternate;if(o===null){if(r=a.return,r!==null){s=r;continue}break}if(a.child===o.child){for(o=a.child;o;){if(o===s)return sm(a),e;if(o===r)return sm(a),t;o=o.sibling}throw Error(de(188))}if(s.return!==r.return)s=a,r=o;else{for(var l=!1,i=a.child;i;){if(i===s){l=!0,s=a,r=o;break}if(i===r){l=!0,r=a,s=o;break}i=i.sibling}if(!l){for(i=o.child;i;){if(i===s){l=!0,s=o,r=a;break}if(i===r){l=!0,r=o,s=a;break}i=i.sibling}if(!l)throw Error(de(189))}}if(s.alternate!==r)throw Error(de(190))}if(s.tag!==3)throw Error(de(188));return s.stateNode.current===s?e:t}function Nf(e){return e=Sg(e),e!==null?bf(e):null}function bf(e){if(e.tag===5||e.tag===6)return e;for(e=e.child;e!==null;){var t=bf(e);if(t!==null)return t;e=e.sibling}return null}var vf=yn.unstable_scheduleCallback,rm=yn.unstable_cancelCallback,wg=yn.unstable_shouldYield,jg=yn.unstable_requestPaint,kt=yn.unstable_now,Eg=yn.unstable_getCurrentPriorityLevel,Hd=yn.unstable_ImmediatePriority,Sf=yn.unstable_UserBlockingPriority,Al=yn.unstable_NormalPriority,kg=yn.unstable_LowPriority,wf=yn.unstable_IdlePriority,li=null,ss=null;function Ag(e){if(ss&&typeof ss.onCommitFiberRoot=="function")try{ss.onCommitFiberRoot(li,e,void 0,(e.current.flags&128)===128)}catch{}}var zn=Math.clz32?Math.clz32:Rg,Ig=Math.log,Tg=Math.LN2;function Rg(e){return e>>>=0,e===0?32:31-(Ig(e)/Tg|0)|0}var zo=64,Vo=4194304;function _a(e){switch(e&-e){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return e&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return e&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return e}}function Il(e,t){var s=e.pendingLanes;if(s===0)return 0;var r=0,a=e.suspendedLanes,o=e.pingedLanes,l=s&268435455;if(l!==0){var i=l&~a;i!==0?r=_a(i):(o&=l,o!==0&&(r=_a(o)))}else l=s&~a,l!==0?r=_a(l):o!==0&&(r=_a(o));if(r===0)return 0;if(t!==0&&t!==r&&!(t&a)&&(a=r&-r,o=t&-t,a>=o||a===16&&(o&4194240)!==0))return t;if(r&4&&(r|=s&16),t=e.entangledLanes,t!==0)for(e=e.entanglements,t&=r;0<t;)s=31-zn(t),a=1<<s,r|=e[s],t&=~a;return r}function Cg(e,t){switch(e){case 1:case 2:case 4:return t+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function Dg(e,t){for(var s=e.suspendedLanes,r=e.pingedLanes,a=e.expirationTimes,o=e.pendingLanes;0<o;){var l=31-zn(o),i=1<<l,c=a[l];c===-1?(!(i&s)||i&r)&&(a[l]=Cg(i,t)):c<=t&&(e.expiredLanes|=i),o&=~i}}function Gc(e){return e=e.pendingLanes&-1073741825,e!==0?e:e&1073741824?1073741824:0}function jf(){var e=zo;return zo<<=1,!(zo&4194240)&&(zo=64),e}function Xi(e){for(var t=[],s=0;31>s;s++)t.push(e);return t}function So(e,t,s){e.pendingLanes|=t,t!==536870912&&(e.suspendedLanes=0,e.pingedLanes=0),e=e.eventTimes,t=31-zn(t),e[t]=s}function Lg(e,t){var s=e.pendingLanes&~t;e.pendingLanes=t,e.suspendedLanes=0,e.pingedLanes=0,e.expiredLanes&=t,e.mutableReadLanes&=t,e.entangledLanes&=t,t=e.entanglements;var r=e.eventTimes;for(e=e.expirationTimes;0<s;){var a=31-zn(s),o=1<<a;t[a]=0,r[a]=-1,e[a]=-1,s&=~o}}function Ud(e,t){var s=e.entangledLanes|=t;for(e=e.entanglements;s;){var r=31-zn(s),a=1<<r;a&t|e[r]&t&&(e[r]|=t),s&=~a}}var at=0;function Ef(e){return e&=-e,1<e?4<e?e&268435455?16:536870912:4:1}var kf,Wd,Af,If,Tf,qc=!1,Ko=[],Hs=null,Us=null,Ws=null,Xa=new Map,Ja=new Map,Os=[],_g="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function am(e,t){switch(e){case"focusin":case"focusout":Hs=null;break;case"dragenter":case"dragleave":Us=null;break;case"mouseover":case"mouseout":Ws=null;break;case"pointerover":case"pointerout":Xa.delete(t.pointerId);break;case"gotpointercapture":case"lostpointercapture":Ja.delete(t.pointerId)}}function wa(e,t,s,r,a,o){return e===null||e.nativeEvent!==o?(e={blockedOn:t,domEventName:s,eventSystemFlags:r,nativeEvent:o,targetContainers:[a]},t!==null&&(t=jo(t),t!==null&&Wd(t)),e):(e.eventSystemFlags|=r,t=e.targetContainers,a!==null&&t.indexOf(a)===-1&&t.push(a),e)}function Og(e,t,s,r,a){switch(t){case"focusin":return Hs=wa(Hs,e,t,s,r,a),!0;case"dragenter":return Us=wa(Us,e,t,s,r,a),!0;case"mouseover":return Ws=wa(Ws,e,t,s,r,a),!0;case"pointerover":var o=a.pointerId;return Xa.set(o,wa(Xa.get(o)||null,e,t,s,r,a)),!0;case"gotpointercapture":return o=a.pointerId,Ja.set(o,wa(Ja.get(o)||null,e,t,s,r,a)),!0}return!1}function Rf(e){var t=ir(e.target);if(t!==null){var s=vr(t);if(s!==null){if(t=s.tag,t===13){if(t=yf(s),t!==null){e.blockedOn=t,Tf(e.priority,function(){Af(s)});return}}else if(t===3&&s.stateNode.current.memoizedState.isDehydrated){e.blockedOn=s.tag===3?s.stateNode.containerInfo:null;return}}}e.blockedOn=null}function pl(e){if(e.blockedOn!==null)return!1;for(var t=e.targetContainers;0<t.length;){var s=Xc(e.domEventName,e.eventSystemFlags,t[0],e.nativeEvent);if(s===null){s=e.nativeEvent;var r=new s.constructor(s.type,s);zc=r,s.target.dispatchEvent(r),zc=null}else return t=jo(s),t!==null&&Wd(t),e.blockedOn=s,!1;t.shift()}return!0}function om(e,t,s){pl(e)&&s.delete(t)}function Mg(){qc=!1,Hs!==null&&pl(Hs)&&(Hs=null),Us!==null&&pl(Us)&&(Us=null),Ws!==null&&pl(Ws)&&(Ws=null),Xa.forEach(om),Ja.forEach(om)}function ja(e,t){e.blockedOn===t&&(e.blockedOn=null,qc||(qc=!0,yn.unstable_scheduleCallback(yn.unstable_NormalPriority,Mg)))}function Qa(e){function t(a){return ja(a,e)}if(0<Ko.length){ja(Ko[0],e);for(var s=1;s<Ko.length;s++){var r=Ko[s];r.blockedOn===e&&(r.blockedOn=null)}}for(Hs!==null&&ja(Hs,e),Us!==null&&ja(Us,e),Ws!==null&&ja(Ws,e),Xa.forEach(t),Ja.forEach(t),s=0;s<Os.length;s++)r=Os[s],r.blockedOn===e&&(r.blockedOn=null);for(;0<Os.length&&(s=Os[0],s.blockedOn===null);)Rf(s),s.blockedOn===null&&Os.shift()}var Kr=Ss.ReactCurrentBatchConfig,Tl=!0;function Pg(e,t,s,r){var a=at,o=Kr.transition;Kr.transition=null;try{at=1,zd(e,t,s,r)}finally{at=a,Kr.transition=o}}function Fg(e,t,s,r){var a=at,o=Kr.transition;Kr.transition=null;try{at=4,zd(e,t,s,r)}finally{at=a,Kr.transition=o}}function zd(e,t,s,r){if(Tl){var a=Xc(e,t,s,r);if(a===null)oc(e,t,r,Rl,s),am(e,r);else if(Og(a,e,t,s,r))r.stopPropagation();else if(am(e,r),t&4&&-1<_g.indexOf(e)){for(;a!==null;){var o=jo(a);if(o!==null&&kf(o),o=Xc(e,t,s,r),o===null&&oc(e,t,r,Rl,s),o===a)break;a=o}a!==null&&r.stopPropagation()}else oc(e,t,r,null,s)}}var Rl=null;function Xc(e,t,s,r){if(Rl=null,e=$d(r),e=ir(e),e!==null)if(t=vr(e),t===null)e=null;else if(s=t.tag,s===13){if(e=yf(t),e!==null)return e;e=null}else if(s===3){if(t.stateNode.current.memoizedState.isDehydrated)return t.tag===3?t.stateNode.containerInfo:null;e=null}else t!==e&&(e=null);return Rl=e,null}function Cf(e){switch(e){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(Eg()){case Hd:return 1;case Sf:return 4;case Al:case kg:return 16;case wf:return 536870912;default:return 16}default:return 16}}var Fs=null,Vd=null,fl=null;function Df(){if(fl)return fl;var e,t=Vd,s=t.length,r,a="value"in Fs?Fs.value:Fs.textContent,o=a.length;for(e=0;e<s&&t[e]===a[e];e++);var l=s-e;for(r=1;r<=l&&t[s-r]===a[o-r];r++);return fl=a.slice(e,1<r?1-r:void 0)}function xl(e){var t=e.keyCode;return"charCode"in e?(e=e.charCode,e===0&&t===13&&(e=13)):e=t,e===10&&(e=13),32<=e||e===13?e:0}function Yo(){return!0}function lm(){return!1}function bn(e){function t(s,r,a,o,l){this._reactName=s,this._targetInst=a,this.type=r,this.nativeEvent=o,this.target=l,this.currentTarget=null;for(var i in e)e.hasOwnProperty(i)&&(s=e[i],this[i]=s?s(o):o[i]);return this.isDefaultPrevented=(o.defaultPrevented!=null?o.defaultPrevented:o.returnValue===!1)?Yo:lm,this.isPropagationStopped=lm,this}return St(t.prototype,{preventDefault:function(){this.defaultPrevented=!0;var s=this.nativeEvent;s&&(s.preventDefault?s.preventDefault():typeof s.returnValue!="unknown"&&(s.returnValue=!1),this.isDefaultPrevented=Yo)},stopPropagation:function(){var s=this.nativeEvent;s&&(s.stopPropagation?s.stopPropagation():typeof s.cancelBubble!="unknown"&&(s.cancelBubble=!0),this.isPropagationStopped=Yo)},persist:function(){},isPersistent:Yo}),t}var la={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(e){return e.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},Kd=bn(la),wo=St({},la,{view:0,detail:0}),Bg=bn(wo),Ji,Qi,Ea,ii=St({},wo,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Yd,button:0,buttons:0,relatedTarget:function(e){return e.relatedTarget===void 0?e.fromElement===e.srcElement?e.toElement:e.fromElement:e.relatedTarget},movementX:function(e){return"movementX"in e?e.movementX:(e!==Ea&&(Ea&&e.type==="mousemove"?(Ji=e.screenX-Ea.screenX,Qi=e.screenY-Ea.screenY):Qi=Ji=0,Ea=e),Ji)},movementY:function(e){return"movementY"in e?e.movementY:Qi}}),im=bn(ii),$g=St({},ii,{dataTransfer:0}),Hg=bn($g),Ug=St({},wo,{relatedTarget:0}),Zi=bn(Ug),Wg=St({},la,{animationName:0,elapsedTime:0,pseudoElement:0}),zg=bn(Wg),Vg=St({},la,{clipboardData:function(e){return"clipboardData"in e?e.clipboardData:window.clipboardData}}),Kg=bn(Vg),Yg=St({},la,{data:0}),cm=bn(Yg),Gg={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},qg={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},Xg={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function Jg(e){var t=this.nativeEvent;return t.getModifierState?t.getModifierState(e):(e=Xg[e])?!!t[e]:!1}function Yd(){return Jg}var Qg=St({},wo,{key:function(e){if(e.key){var t=Gg[e.key]||e.key;if(t!=="Unidentified")return t}return e.type==="keypress"?(e=xl(e),e===13?"Enter":String.fromCharCode(e)):e.type==="keydown"||e.type==="keyup"?qg[e.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Yd,charCode:function(e){return e.type==="keypress"?xl(e):0},keyCode:function(e){return e.type==="keydown"||e.type==="keyup"?e.keyCode:0},which:function(e){return e.type==="keypress"?xl(e):e.type==="keydown"||e.type==="keyup"?e.keyCode:0}}),Zg=bn(Qg),ey=St({},ii,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),dm=bn(ey),ty=St({},wo,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Yd}),ny=bn(ty),sy=St({},la,{propertyName:0,elapsedTime:0,pseudoElement:0}),ry=bn(sy),ay=St({},ii,{deltaX:function(e){return"deltaX"in e?e.deltaX:"wheelDeltaX"in e?-e.wheelDeltaX:0},deltaY:function(e){return"deltaY"in e?e.deltaY:"wheelDeltaY"in e?-e.wheelDeltaY:"wheelDelta"in e?-e.wheelDelta:0},deltaZ:0,deltaMode:0}),oy=bn(ay),ly=[9,13,27,32],Gd=ys&&"CompositionEvent"in window,Fa=null;ys&&"documentMode"in document&&(Fa=document.documentMode);var iy=ys&&"TextEvent"in window&&!Fa,Lf=ys&&(!Gd||Fa&&8<Fa&&11>=Fa),um=" ",mm=!1;function _f(e,t){switch(e){case"keyup":return ly.indexOf(t.keyCode)!==-1;case"keydown":return t.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function Of(e){return e=e.detail,typeof e=="object"&&"data"in e?e.data:null}var Lr=!1;function cy(e,t){switch(e){case"compositionend":return Of(t);case"keypress":return t.which!==32?null:(mm=!0,um);case"textInput":return e=t.data,e===um&&mm?null:e;default:return null}}function dy(e,t){if(Lr)return e==="compositionend"||!Gd&&_f(e,t)?(e=Df(),fl=Vd=Fs=null,Lr=!1,e):null;switch(e){case"paste":return null;case"keypress":if(!(t.ctrlKey||t.altKey||t.metaKey)||t.ctrlKey&&t.altKey){if(t.char&&1<t.char.length)return t.char;if(t.which)return String.fromCharCode(t.which)}return null;case"compositionend":return Lf&&t.locale!=="ko"?null:t.data;default:return null}}var uy={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function pm(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t==="input"?!!uy[e.type]:t==="textarea"}function Mf(e,t,s,r){pf(r),t=Cl(t,"onChange"),0<t.length&&(s=new Kd("onChange","change",null,s,r),e.push({event:s,listeners:t}))}var Ba=null,Za=null;function my(e){Yf(e,0)}function ci(e){var t=Mr(e);if(af(t))return e}function py(e,t){if(e==="change")return t}var Pf=!1;if(ys){var ec;if(ys){var tc="oninput"in document;if(!tc){var fm=document.createElement("div");fm.setAttribute("oninput","return;"),tc=typeof fm.oninput=="function"}ec=tc}else ec=!1;Pf=ec&&(!document.documentMode||9<document.documentMode)}function xm(){Ba&&(Ba.detachEvent("onpropertychange",Ff),Za=Ba=null)}function Ff(e){if(e.propertyName==="value"&&ci(Za)){var t=[];Mf(t,Za,e,$d(e)),gf(my,t)}}function fy(e,t,s){e==="focusin"?(xm(),Ba=t,Za=s,Ba.attachEvent("onpropertychange",Ff)):e==="focusout"&&xm()}function xy(e){if(e==="selectionchange"||e==="keyup"||e==="keydown")return ci(Za)}function hy(e,t){if(e==="click")return ci(t)}function gy(e,t){if(e==="input"||e==="change")return ci(t)}function yy(e,t){return e===t&&(e!==0||1/e===1/t)||e!==e&&t!==t}var Yn=typeof Object.is=="function"?Object.is:yy;function eo(e,t){if(Yn(e,t))return!0;if(typeof e!="object"||e===null||typeof t!="object"||t===null)return!1;var s=Object.keys(e),r=Object.keys(t);if(s.length!==r.length)return!1;for(r=0;r<s.length;r++){var a=s[r];if(!Dc.call(t,a)||!Yn(e[a],t[a]))return!1}return!0}function hm(e){for(;e&&e.firstChild;)e=e.firstChild;return e}function gm(e,t){var s=hm(e);e=0;for(var r;s;){if(s.nodeType===3){if(r=e+s.textContent.length,e<=t&&r>=t)return{node:s,offset:t-e};e=r}e:{for(;s;){if(s.nextSibling){s=s.nextSibling;break e}s=s.parentNode}s=void 0}s=hm(s)}}function Bf(e,t){return e&&t?e===t?!0:e&&e.nodeType===3?!1:t&&t.nodeType===3?Bf(e,t.parentNode):"contains"in e?e.contains(t):e.compareDocumentPosition?!!(e.compareDocumentPosition(t)&16):!1:!1}function $f(){for(var e=window,t=jl();t instanceof e.HTMLIFrameElement;){try{var s=typeof t.contentWindow.location.href=="string"}catch{s=!1}if(s)e=t.contentWindow;else break;t=jl(e.document)}return t}function qd(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t&&(t==="input"&&(e.type==="text"||e.type==="search"||e.type==="tel"||e.type==="url"||e.type==="password")||t==="textarea"||e.contentEditable==="true")}function Ny(e){var t=$f(),s=e.focusedElem,r=e.selectionRange;if(t!==s&&s&&s.ownerDocument&&Bf(s.ownerDocument.documentElement,s)){if(r!==null&&qd(s)){if(t=r.start,e=r.end,e===void 0&&(e=t),"selectionStart"in s)s.selectionStart=t,s.selectionEnd=Math.min(e,s.value.length);else if(e=(t=s.ownerDocument||document)&&t.defaultView||window,e.getSelection){e=e.getSelection();var a=s.textContent.length,o=Math.min(r.start,a);r=r.end===void 0?o:Math.min(r.end,a),!e.extend&&o>r&&(a=r,r=o,o=a),a=gm(s,o);var l=gm(s,r);a&&l&&(e.rangeCount!==1||e.anchorNode!==a.node||e.anchorOffset!==a.offset||e.focusNode!==l.node||e.focusOffset!==l.offset)&&(t=t.createRange(),t.setStart(a.node,a.offset),e.removeAllRanges(),o>r?(e.addRange(t),e.extend(l.node,l.offset)):(t.setEnd(l.node,l.offset),e.addRange(t)))}}for(t=[],e=s;e=e.parentNode;)e.nodeType===1&&t.push({element:e,left:e.scrollLeft,top:e.scrollTop});for(typeof s.focus=="function"&&s.focus(),s=0;s<t.length;s++)e=t[s],e.element.scrollLeft=e.left,e.element.scrollTop=e.top}}var by=ys&&"documentMode"in document&&11>=document.documentMode,_r=null,Jc=null,$a=null,Qc=!1;function ym(e,t,s){var r=s.window===s?s.document:s.nodeType===9?s:s.ownerDocument;Qc||_r==null||_r!==jl(r)||(r=_r,"selectionStart"in r&&qd(r)?r={start:r.selectionStart,end:r.selectionEnd}:(r=(r.ownerDocument&&r.ownerDocument.defaultView||window).getSelection(),r={anchorNode:r.anchorNode,anchorOffset:r.anchorOffset,focusNode:r.focusNode,focusOffset:r.focusOffset}),$a&&eo($a,r)||($a=r,r=Cl(Jc,"onSelect"),0<r.length&&(t=new Kd("onSelect","select",null,t,s),e.push({event:t,listeners:r}),t.target=_r)))}function Go(e,t){var s={};return s[e.toLowerCase()]=t.toLowerCase(),s["Webkit"+e]="webkit"+t,s["Moz"+e]="moz"+t,s}var Or={animationend:Go("Animation","AnimationEnd"),animationiteration:Go("Animation","AnimationIteration"),animationstart:Go("Animation","AnimationStart"),transitionend:Go("Transition","TransitionEnd")},nc={},Hf={};ys&&(Hf=document.createElement("div").style,"AnimationEvent"in window||(delete Or.animationend.animation,delete Or.animationiteration.animation,delete Or.animationstart.animation),"TransitionEvent"in window||delete Or.transitionend.transition);function di(e){if(nc[e])return nc[e];if(!Or[e])return e;var t=Or[e],s;for(s in t)if(t.hasOwnProperty(s)&&s in Hf)return nc[e]=t[s];return e}var Uf=di("animationend"),Wf=di("animationiteration"),zf=di("animationstart"),Vf=di("transitionend"),Kf=new Map,Nm="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function Js(e,t){Kf.set(e,t),br(t,[e])}for(var sc=0;sc<Nm.length;sc++){var rc=Nm[sc],vy=rc.toLowerCase(),Sy=rc[0].toUpperCase()+rc.slice(1);Js(vy,"on"+Sy)}Js(Uf,"onAnimationEnd");Js(Wf,"onAnimationIteration");Js(zf,"onAnimationStart");Js("dblclick","onDoubleClick");Js("focusin","onFocus");Js("focusout","onBlur");Js(Vf,"onTransitionEnd");Xr("onMouseEnter",["mouseout","mouseover"]);Xr("onMouseLeave",["mouseout","mouseover"]);Xr("onPointerEnter",["pointerout","pointerover"]);Xr("onPointerLeave",["pointerout","pointerover"]);br("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));br("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));br("onBeforeInput",["compositionend","keypress","textInput","paste"]);br("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));br("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));br("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Oa="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),wy=new Set("cancel close invalid load scroll toggle".split(" ").concat(Oa));function bm(e,t,s){var r=e.type||"unknown-event";e.currentTarget=s,vg(r,t,void 0,e),e.currentTarget=null}function Yf(e,t){t=(t&4)!==0;for(var s=0;s<e.length;s++){var r=e[s],a=r.event;r=r.listeners;e:{var o=void 0;if(t)for(var l=r.length-1;0<=l;l--){var i=r[l],c=i.instance,m=i.currentTarget;if(i=i.listener,c!==o&&a.isPropagationStopped())break e;bm(a,i,m),o=c}else for(l=0;l<r.length;l++){if(i=r[l],c=i.instance,m=i.currentTarget,i=i.listener,c!==o&&a.isPropagationStopped())break e;bm(a,i,m),o=c}}}if(kl)throw e=Yc,kl=!1,Yc=null,e}function mt(e,t){var s=t[sd];s===void 0&&(s=t[sd]=new Set);var r=e+"__bubble";s.has(r)||(Gf(t,e,2,!1),s.add(r))}function ac(e,t,s){var r=0;t&&(r|=4),Gf(s,e,r,t)}var qo="_reactListening"+Math.random().toString(36).slice(2);function to(e){if(!e[qo]){e[qo]=!0,ef.forEach(function(s){s!=="selectionchange"&&(wy.has(s)||ac(s,!1,e),ac(s,!0,e))});var t=e.nodeType===9?e:e.ownerDocument;t===null||t[qo]||(t[qo]=!0,ac("selectionchange",!1,t))}}function Gf(e,t,s,r){switch(Cf(t)){case 1:var a=Pg;break;case 4:a=Fg;break;default:a=zd}s=a.bind(null,t,s,e),a=void 0,!Kc||t!=="touchstart"&&t!=="touchmove"&&t!=="wheel"||(a=!0),r?a!==void 0?e.addEventListener(t,s,{capture:!0,passive:a}):e.addEventListener(t,s,!0):a!==void 0?e.addEventListener(t,s,{passive:a}):e.addEventListener(t,s,!1)}function oc(e,t,s,r,a){var o=r;if(!(t&1)&&!(t&2)&&r!==null)e:for(;;){if(r===null)return;var l=r.tag;if(l===3||l===4){var i=r.stateNode.containerInfo;if(i===a||i.nodeType===8&&i.parentNode===a)break;if(l===4)for(l=r.return;l!==null;){var c=l.tag;if((c===3||c===4)&&(c=l.stateNode.containerInfo,c===a||c.nodeType===8&&c.parentNode===a))return;l=l.return}for(;i!==null;){if(l=ir(i),l===null)return;if(c=l.tag,c===5||c===6){r=o=l;continue e}i=i.parentNode}}r=r.return}gf(function(){var m=o,p=$d(s),h=[];e:{var v=Kf.get(e);if(v!==void 0){var A=Kd,D=e;switch(e){case"keypress":if(xl(s)===0)break e;case"keydown":case"keyup":A=Zg;break;case"focusin":D="focus",A=Zi;break;case"focusout":D="blur",A=Zi;break;case"beforeblur":case"afterblur":A=Zi;break;case"click":if(s.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":A=im;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":A=Hg;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":A=ny;break;case Uf:case Wf:case zf:A=zg;break;case Vf:A=ry;break;case"scroll":A=Bg;break;case"wheel":A=oy;break;case"copy":case"cut":case"paste":A=Kg;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":A=dm}var I=(t&4)!==0,W=!I&&e==="scroll",N=I?v!==null?v+"Capture":null:v;I=[];for(var x=m,b;x!==null;){b=x;var B=b.stateNode;if(b.tag===5&&B!==null&&(b=B,N!==null&&(B=qa(x,N),B!=null&&I.push(no(x,B,b)))),W)break;x=x.return}0<I.length&&(v=new A(v,D,null,s,p),h.push({event:v,listeners:I}))}}if(!(t&7)){e:{if(v=e==="mouseover"||e==="pointerover",A=e==="mouseout"||e==="pointerout",v&&s!==zc&&(D=s.relatedTarget||s.fromElement)&&(ir(D)||D[Ns]))break e;if((A||v)&&(v=p.window===p?p:(v=p.ownerDocument)?v.defaultView||v.parentWindow:window,A?(D=s.relatedTarget||s.toElement,A=m,D=D?ir(D):null,D!==null&&(W=vr(D),D!==W||D.tag!==5&&D.tag!==6)&&(D=null)):(A=null,D=m),A!==D)){if(I=im,B="onMouseLeave",N="onMouseEnter",x="mouse",(e==="pointerout"||e==="pointerover")&&(I=dm,B="onPointerLeave",N="onPointerEnter",x="pointer"),W=A==null?v:Mr(A),b=D==null?v:Mr(D),v=new I(B,x+"leave",A,s,p),v.target=W,v.relatedTarget=b,B=null,ir(p)===m&&(I=new I(N,x+"enter",D,s,p),I.target=b,I.relatedTarget=W,B=I),W=B,A&&D)t:{for(I=A,N=D,x=0,b=I;b;b=Ir(b))x++;for(b=0,B=N;B;B=Ir(B))b++;for(;0<x-b;)I=Ir(I),x--;for(;0<b-x;)N=Ir(N),b--;for(;x--;){if(I===N||N!==null&&I===N.alternate)break t;I=Ir(I),N=Ir(N)}I=null}else I=null;A!==null&&vm(h,v,A,I,!1),D!==null&&W!==null&&vm(h,W,D,I,!0)}}e:{if(v=m?Mr(m):window,A=v.nodeName&&v.nodeName.toLowerCase(),A==="select"||A==="input"&&v.type==="file")var H=py;else if(pm(v))if(Pf)H=gy;else{H=xy;var z=fy}else(A=v.nodeName)&&A.toLowerCase()==="input"&&(v.type==="checkbox"||v.type==="radio")&&(H=hy);if(H&&(H=H(e,m))){Mf(h,H,s,p);break e}z&&z(e,v,m),e==="focusout"&&(z=v._wrapperState)&&z.controlled&&v.type==="number"&&Bc(v,"number",v.value)}switch(z=m?Mr(m):window,e){case"focusin":(pm(z)||z.contentEditable==="true")&&(_r=z,Jc=m,$a=null);break;case"focusout":$a=Jc=_r=null;break;case"mousedown":Qc=!0;break;case"contextmenu":case"mouseup":case"dragend":Qc=!1,ym(h,s,p);break;case"selectionchange":if(by)break;case"keydown":case"keyup":ym(h,s,p)}var Y;if(Gd)e:{switch(e){case"compositionstart":var Q="onCompositionStart";break e;case"compositionend":Q="onCompositionEnd";break e;case"compositionupdate":Q="onCompositionUpdate";break e}Q=void 0}else Lr?_f(e,s)&&(Q="onCompositionEnd"):e==="keydown"&&s.keyCode===229&&(Q="onCompositionStart");Q&&(Lf&&s.locale!=="ko"&&(Lr||Q!=="onCompositionStart"?Q==="onCompositionEnd"&&Lr&&(Y=Df()):(Fs=p,Vd="value"in Fs?Fs.value:Fs.textContent,Lr=!0)),z=Cl(m,Q),0<z.length&&(Q=new cm(Q,e,null,s,p),h.push({event:Q,listeners:z}),Y?Q.data=Y:(Y=Of(s),Y!==null&&(Q.data=Y)))),(Y=iy?cy(e,s):dy(e,s))&&(m=Cl(m,"onBeforeInput"),0<m.length&&(p=new cm("onBeforeInput","beforeinput",null,s,p),h.push({event:p,listeners:m}),p.data=Y))}Yf(h,t)})}function no(e,t,s){return{instance:e,listener:t,currentTarget:s}}function Cl(e,t){for(var s=t+"Capture",r=[];e!==null;){var a=e,o=a.stateNode;a.tag===5&&o!==null&&(a=o,o=qa(e,s),o!=null&&r.unshift(no(e,o,a)),o=qa(e,t),o!=null&&r.push(no(e,o,a))),e=e.return}return r}function Ir(e){if(e===null)return null;do e=e.return;while(e&&e.tag!==5);return e||null}function vm(e,t,s,r,a){for(var o=t._reactName,l=[];s!==null&&s!==r;){var i=s,c=i.alternate,m=i.stateNode;if(c!==null&&c===r)break;i.tag===5&&m!==null&&(i=m,a?(c=qa(s,o),c!=null&&l.unshift(no(s,c,i))):a||(c=qa(s,o),c!=null&&l.push(no(s,c,i)))),s=s.return}l.length!==0&&e.push({event:t,listeners:l})}var jy=/\r\n?/g,Ey=/\u0000|\uFFFD/g;function Sm(e){return(typeof e=="string"?e:""+e).replace(jy,`
`).replace(Ey,"")}function Xo(e,t,s){if(t=Sm(t),Sm(e)!==t&&s)throw Error(de(425))}function Dl(){}var Zc=null,ed=null;function td(e,t){return e==="textarea"||e==="noscript"||typeof t.children=="string"||typeof t.children=="number"||typeof t.dangerouslySetInnerHTML=="object"&&t.dangerouslySetInnerHTML!==null&&t.dangerouslySetInnerHTML.__html!=null}var nd=typeof setTimeout=="function"?setTimeout:void 0,ky=typeof clearTimeout=="function"?clearTimeout:void 0,wm=typeof Promise=="function"?Promise:void 0,Ay=typeof queueMicrotask=="function"?queueMicrotask:typeof wm<"u"?function(e){return wm.resolve(null).then(e).catch(Iy)}:nd;function Iy(e){setTimeout(function(){throw e})}function lc(e,t){var s=t,r=0;do{var a=s.nextSibling;if(e.removeChild(s),a&&a.nodeType===8)if(s=a.data,s==="/$"){if(r===0){e.removeChild(a),Qa(t);return}r--}else s!=="$"&&s!=="$?"&&s!=="$!"||r++;s=a}while(s);Qa(t)}function zs(e){for(;e!=null;e=e.nextSibling){var t=e.nodeType;if(t===1||t===3)break;if(t===8){if(t=e.data,t==="$"||t==="$!"||t==="$?")break;if(t==="/$")return null}}return e}function jm(e){e=e.previousSibling;for(var t=0;e;){if(e.nodeType===8){var s=e.data;if(s==="$"||s==="$!"||s==="$?"){if(t===0)return e;t--}else s==="/$"&&t++}e=e.previousSibling}return null}var ia=Math.random().toString(36).slice(2),Zn="__reactFiber$"+ia,so="__reactProps$"+ia,Ns="__reactContainer$"+ia,sd="__reactEvents$"+ia,Ty="__reactListeners$"+ia,Ry="__reactHandles$"+ia;function ir(e){var t=e[Zn];if(t)return t;for(var s=e.parentNode;s;){if(t=s[Ns]||s[Zn]){if(s=t.alternate,t.child!==null||s!==null&&s.child!==null)for(e=jm(e);e!==null;){if(s=e[Zn])return s;e=jm(e)}return t}e=s,s=e.parentNode}return null}function jo(e){return e=e[Zn]||e[Ns],!e||e.tag!==5&&e.tag!==6&&e.tag!==13&&e.tag!==3?null:e}function Mr(e){if(e.tag===5||e.tag===6)return e.stateNode;throw Error(de(33))}function ui(e){return e[so]||null}var rd=[],Pr=-1;function Qs(e){return{current:e}}function xt(e){0>Pr||(e.current=rd[Pr],rd[Pr]=null,Pr--)}function dt(e,t){Pr++,rd[Pr]=e.current,e.current=t}var Xs={},Qt=Qs(Xs),on=Qs(!1),fr=Xs;function Jr(e,t){var s=e.type.contextTypes;if(!s)return Xs;var r=e.stateNode;if(r&&r.__reactInternalMemoizedUnmaskedChildContext===t)return r.__reactInternalMemoizedMaskedChildContext;var a={},o;for(o in s)a[o]=t[o];return r&&(e=e.stateNode,e.__reactInternalMemoizedUnmaskedChildContext=t,e.__reactInternalMemoizedMaskedChildContext=a),a}function ln(e){return e=e.childContextTypes,e!=null}function Ll(){xt(on),xt(Qt)}function Em(e,t,s){if(Qt.current!==Xs)throw Error(de(168));dt(Qt,t),dt(on,s)}function qf(e,t,s){var r=e.stateNode;if(t=t.childContextTypes,typeof r.getChildContext!="function")return s;r=r.getChildContext();for(var a in r)if(!(a in t))throw Error(de(108,fg(e)||"Unknown",a));return St({},s,r)}function _l(e){return e=(e=e.stateNode)&&e.__reactInternalMemoizedMergedChildContext||Xs,fr=Qt.current,dt(Qt,e),dt(on,on.current),!0}function km(e,t,s){var r=e.stateNode;if(!r)throw Error(de(169));s?(e=qf(e,t,fr),r.__reactInternalMemoizedMergedChildContext=e,xt(on),xt(Qt),dt(Qt,e)):xt(on),dt(on,s)}var ds=null,mi=!1,ic=!1;function Xf(e){ds===null?ds=[e]:ds.push(e)}function Cy(e){mi=!0,Xf(e)}function Zs(){if(!ic&&ds!==null){ic=!0;var e=0,t=at;try{var s=ds;for(at=1;e<s.length;e++){var r=s[e];do r=r(!0);while(r!==null)}ds=null,mi=!1}catch(a){throw ds!==null&&(ds=ds.slice(e+1)),vf(Hd,Zs),a}finally{at=t,ic=!1}}return null}var Fr=[],Br=0,Ol=null,Ml=0,Rn=[],Cn=0,xr=null,ps=1,fs="";function rr(e,t){Fr[Br++]=Ml,Fr[Br++]=Ol,Ol=e,Ml=t}function Jf(e,t,s){Rn[Cn++]=ps,Rn[Cn++]=fs,Rn[Cn++]=xr,xr=e;var r=ps;e=fs;var a=32-zn(r)-1;r&=~(1<<a),s+=1;var o=32-zn(t)+a;if(30<o){var l=a-a%5;o=(r&(1<<l)-1).toString(32),r>>=l,a-=l,ps=1<<32-zn(t)+a|s<<a|r,fs=o+e}else ps=1<<o|s<<a|r,fs=e}function Xd(e){e.return!==null&&(rr(e,1),Jf(e,1,0))}function Jd(e){for(;e===Ol;)Ol=Fr[--Br],Fr[Br]=null,Ml=Fr[--Br],Fr[Br]=null;for(;e===xr;)xr=Rn[--Cn],Rn[Cn]=null,fs=Rn[--Cn],Rn[Cn]=null,ps=Rn[--Cn],Rn[Cn]=null}var gn=null,hn=null,yt=!1,Wn=null;function Qf(e,t){var s=Dn(5,null,null,0);s.elementType="DELETED",s.stateNode=t,s.return=e,t=e.deletions,t===null?(e.deletions=[s],e.flags|=16):t.push(s)}function Am(e,t){switch(e.tag){case 5:var s=e.type;return t=t.nodeType!==1||s.toLowerCase()!==t.nodeName.toLowerCase()?null:t,t!==null?(e.stateNode=t,gn=e,hn=zs(t.firstChild),!0):!1;case 6:return t=e.pendingProps===""||t.nodeType!==3?null:t,t!==null?(e.stateNode=t,gn=e,hn=null,!0):!1;case 13:return t=t.nodeType!==8?null:t,t!==null?(s=xr!==null?{id:ps,overflow:fs}:null,e.memoizedState={dehydrated:t,treeContext:s,retryLane:1073741824},s=Dn(18,null,null,0),s.stateNode=t,s.return=e,e.child=s,gn=e,hn=null,!0):!1;default:return!1}}function ad(e){return(e.mode&1)!==0&&(e.flags&128)===0}function od(e){if(yt){var t=hn;if(t){var s=t;if(!Am(e,t)){if(ad(e))throw Error(de(418));t=zs(s.nextSibling);var r=gn;t&&Am(e,t)?Qf(r,s):(e.flags=e.flags&-4097|2,yt=!1,gn=e)}}else{if(ad(e))throw Error(de(418));e.flags=e.flags&-4097|2,yt=!1,gn=e}}}function Im(e){for(e=e.return;e!==null&&e.tag!==5&&e.tag!==3&&e.tag!==13;)e=e.return;gn=e}function Jo(e){if(e!==gn)return!1;if(!yt)return Im(e),yt=!0,!1;var t;if((t=e.tag!==3)&&!(t=e.tag!==5)&&(t=e.type,t=t!=="head"&&t!=="body"&&!td(e.type,e.memoizedProps)),t&&(t=hn)){if(ad(e))throw Zf(),Error(de(418));for(;t;)Qf(e,t),t=zs(t.nextSibling)}if(Im(e),e.tag===13){if(e=e.memoizedState,e=e!==null?e.dehydrated:null,!e)throw Error(de(317));e:{for(e=e.nextSibling,t=0;e;){if(e.nodeType===8){var s=e.data;if(s==="/$"){if(t===0){hn=zs(e.nextSibling);break e}t--}else s!=="$"&&s!=="$!"&&s!=="$?"||t++}e=e.nextSibling}hn=null}}else hn=gn?zs(e.stateNode.nextSibling):null;return!0}function Zf(){for(var e=hn;e;)e=zs(e.nextSibling)}function Qr(){hn=gn=null,yt=!1}function Qd(e){Wn===null?Wn=[e]:Wn.push(e)}var Dy=Ss.ReactCurrentBatchConfig;function ka(e,t,s){if(e=s.ref,e!==null&&typeof e!="function"&&typeof e!="object"){if(s._owner){if(s=s._owner,s){if(s.tag!==1)throw Error(de(309));var r=s.stateNode}if(!r)throw Error(de(147,e));var a=r,o=""+e;return t!==null&&t.ref!==null&&typeof t.ref=="function"&&t.ref._stringRef===o?t.ref:(t=function(l){var i=a.refs;l===null?delete i[o]:i[o]=l},t._stringRef=o,t)}if(typeof e!="string")throw Error(de(284));if(!s._owner)throw Error(de(290,e))}return e}function Qo(e,t){throw e=Object.prototype.toString.call(t),Error(de(31,e==="[object Object]"?"object with keys {"+Object.keys(t).join(", ")+"}":e))}function Tm(e){var t=e._init;return t(e._payload)}function ex(e){function t(N,x){if(e){var b=N.deletions;b===null?(N.deletions=[x],N.flags|=16):b.push(x)}}function s(N,x){if(!e)return null;for(;x!==null;)t(N,x),x=x.sibling;return null}function r(N,x){for(N=new Map;x!==null;)x.key!==null?N.set(x.key,x):N.set(x.index,x),x=x.sibling;return N}function a(N,x){return N=Gs(N,x),N.index=0,N.sibling=null,N}function o(N,x,b){return N.index=b,e?(b=N.alternate,b!==null?(b=b.index,b<x?(N.flags|=2,x):b):(N.flags|=2,x)):(N.flags|=1048576,x)}function l(N){return e&&N.alternate===null&&(N.flags|=2),N}function i(N,x,b,B){return x===null||x.tag!==6?(x=xc(b,N.mode,B),x.return=N,x):(x=a(x,b),x.return=N,x)}function c(N,x,b,B){var H=b.type;return H===Dr?p(N,x,b.props.children,B,b.key):x!==null&&(x.elementType===H||typeof H=="object"&&H!==null&&H.$$typeof===Cs&&Tm(H)===x.type)?(B=a(x,b.props),B.ref=ka(N,x,b),B.return=N,B):(B=Sl(b.type,b.key,b.props,null,N.mode,B),B.ref=ka(N,x,b),B.return=N,B)}function m(N,x,b,B){return x===null||x.tag!==4||x.stateNode.containerInfo!==b.containerInfo||x.stateNode.implementation!==b.implementation?(x=hc(b,N.mode,B),x.return=N,x):(x=a(x,b.children||[]),x.return=N,x)}function p(N,x,b,B,H){return x===null||x.tag!==7?(x=mr(b,N.mode,B,H),x.return=N,x):(x=a(x,b),x.return=N,x)}function h(N,x,b){if(typeof x=="string"&&x!==""||typeof x=="number")return x=xc(""+x,N.mode,b),x.return=N,x;if(typeof x=="object"&&x!==null){switch(x.$$typeof){case Ho:return b=Sl(x.type,x.key,x.props,null,N.mode,b),b.ref=ka(N,null,x),b.return=N,b;case Cr:return x=hc(x,N.mode,b),x.return=N,x;case Cs:var B=x._init;return h(N,B(x._payload),b)}if(La(x)||va(x))return x=mr(x,N.mode,b,null),x.return=N,x;Qo(N,x)}return null}function v(N,x,b,B){var H=x!==null?x.key:null;if(typeof b=="string"&&b!==""||typeof b=="number")return H!==null?null:i(N,x,""+b,B);if(typeof b=="object"&&b!==null){switch(b.$$typeof){case Ho:return b.key===H?c(N,x,b,B):null;case Cr:return b.key===H?m(N,x,b,B):null;case Cs:return H=b._init,v(N,x,H(b._payload),B)}if(La(b)||va(b))return H!==null?null:p(N,x,b,B,null);Qo(N,b)}return null}function A(N,x,b,B,H){if(typeof B=="string"&&B!==""||typeof B=="number")return N=N.get(b)||null,i(x,N,""+B,H);if(typeof B=="object"&&B!==null){switch(B.$$typeof){case Ho:return N=N.get(B.key===null?b:B.key)||null,c(x,N,B,H);case Cr:return N=N.get(B.key===null?b:B.key)||null,m(x,N,B,H);case Cs:var z=B._init;return A(N,x,b,z(B._payload),H)}if(La(B)||va(B))return N=N.get(b)||null,p(x,N,B,H,null);Qo(x,B)}return null}function D(N,x,b,B){for(var H=null,z=null,Y=x,Q=x=0,G=null;Y!==null&&Q<b.length;Q++){Y.index>Q?(G=Y,Y=null):G=Y.sibling;var ae=v(N,Y,b[Q],B);if(ae===null){Y===null&&(Y=G);break}e&&Y&&ae.alternate===null&&t(N,Y),x=o(ae,x,Q),z===null?H=ae:z.sibling=ae,z=ae,Y=G}if(Q===b.length)return s(N,Y),yt&&rr(N,Q),H;if(Y===null){for(;Q<b.length;Q++)Y=h(N,b[Q],B),Y!==null&&(x=o(Y,x,Q),z===null?H=Y:z.sibling=Y,z=Y);return yt&&rr(N,Q),H}for(Y=r(N,Y);Q<b.length;Q++)G=A(Y,N,Q,b[Q],B),G!==null&&(e&&G.alternate!==null&&Y.delete(G.key===null?Q:G.key),x=o(G,x,Q),z===null?H=G:z.sibling=G,z=G);return e&&Y.forEach(function(E){return t(N,E)}),yt&&rr(N,Q),H}function I(N,x,b,B){var H=va(b);if(typeof H!="function")throw Error(de(150));if(b=H.call(b),b==null)throw Error(de(151));for(var z=H=null,Y=x,Q=x=0,G=null,ae=b.next();Y!==null&&!ae.done;Q++,ae=b.next()){Y.index>Q?(G=Y,Y=null):G=Y.sibling;var E=v(N,Y,ae.value,B);if(E===null){Y===null&&(Y=G);break}e&&Y&&E.alternate===null&&t(N,Y),x=o(E,x,Q),z===null?H=E:z.sibling=E,z=E,Y=G}if(ae.done)return s(N,Y),yt&&rr(N,Q),H;if(Y===null){for(;!ae.done;Q++,ae=b.next())ae=h(N,ae.value,B),ae!==null&&(x=o(ae,x,Q),z===null?H=ae:z.sibling=ae,z=ae);return yt&&rr(N,Q),H}for(Y=r(N,Y);!ae.done;Q++,ae=b.next())ae=A(Y,N,Q,ae.value,B),ae!==null&&(e&&ae.alternate!==null&&Y.delete(ae.key===null?Q:ae.key),x=o(ae,x,Q),z===null?H=ae:z.sibling=ae,z=ae);return e&&Y.forEach(function(R){return t(N,R)}),yt&&rr(N,Q),H}function W(N,x,b,B){if(typeof b=="object"&&b!==null&&b.type===Dr&&b.key===null&&(b=b.props.children),typeof b=="object"&&b!==null){switch(b.$$typeof){case Ho:e:{for(var H=b.key,z=x;z!==null;){if(z.key===H){if(H=b.type,H===Dr){if(z.tag===7){s(N,z.sibling),x=a(z,b.props.children),x.return=N,N=x;break e}}else if(z.elementType===H||typeof H=="object"&&H!==null&&H.$$typeof===Cs&&Tm(H)===z.type){s(N,z.sibling),x=a(z,b.props),x.ref=ka(N,z,b),x.return=N,N=x;break e}s(N,z);break}else t(N,z);z=z.sibling}b.type===Dr?(x=mr(b.props.children,N.mode,B,b.key),x.return=N,N=x):(B=Sl(b.type,b.key,b.props,null,N.mode,B),B.ref=ka(N,x,b),B.return=N,N=B)}return l(N);case Cr:e:{for(z=b.key;x!==null;){if(x.key===z)if(x.tag===4&&x.stateNode.containerInfo===b.containerInfo&&x.stateNode.implementation===b.implementation){s(N,x.sibling),x=a(x,b.children||[]),x.return=N,N=x;break e}else{s(N,x);break}else t(N,x);x=x.sibling}x=hc(b,N.mode,B),x.return=N,N=x}return l(N);case Cs:return z=b._init,W(N,x,z(b._payload),B)}if(La(b))return D(N,x,b,B);if(va(b))return I(N,x,b,B);Qo(N,b)}return typeof b=="string"&&b!==""||typeof b=="number"?(b=""+b,x!==null&&x.tag===6?(s(N,x.sibling),x=a(x,b),x.return=N,N=x):(s(N,x),x=xc(b,N.mode,B),x.return=N,N=x),l(N)):s(N,x)}return W}var Zr=ex(!0),tx=ex(!1),Pl=Qs(null),Fl=null,$r=null,Zd=null;function eu(){Zd=$r=Fl=null}function tu(e){var t=Pl.current;xt(Pl),e._currentValue=t}function ld(e,t,s){for(;e!==null;){var r=e.alternate;if((e.childLanes&t)!==t?(e.childLanes|=t,r!==null&&(r.childLanes|=t)):r!==null&&(r.childLanes&t)!==t&&(r.childLanes|=t),e===s)break;e=e.return}}function Yr(e,t){Fl=e,Zd=$r=null,e=e.dependencies,e!==null&&e.firstContext!==null&&(e.lanes&t&&(an=!0),e.firstContext=null)}function On(e){var t=e._currentValue;if(Zd!==e)if(e={context:e,memoizedValue:t,next:null},$r===null){if(Fl===null)throw Error(de(308));$r=e,Fl.dependencies={lanes:0,firstContext:e}}else $r=$r.next=e;return t}var cr=null;function nu(e){cr===null?cr=[e]:cr.push(e)}function nx(e,t,s,r){var a=t.interleaved;return a===null?(s.next=s,nu(t)):(s.next=a.next,a.next=s),t.interleaved=s,bs(e,r)}function bs(e,t){e.lanes|=t;var s=e.alternate;for(s!==null&&(s.lanes|=t),s=e,e=e.return;e!==null;)e.childLanes|=t,s=e.alternate,s!==null&&(s.childLanes|=t),s=e,e=e.return;return s.tag===3?s.stateNode:null}var Ds=!1;function su(e){e.updateQueue={baseState:e.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function sx(e,t){e=e.updateQueue,t.updateQueue===e&&(t.updateQueue={baseState:e.baseState,firstBaseUpdate:e.firstBaseUpdate,lastBaseUpdate:e.lastBaseUpdate,shared:e.shared,effects:e.effects})}function xs(e,t){return{eventTime:e,lane:t,tag:0,payload:null,callback:null,next:null}}function Vs(e,t,s){var r=e.updateQueue;if(r===null)return null;if(r=r.shared,st&2){var a=r.pending;return a===null?t.next=t:(t.next=a.next,a.next=t),r.pending=t,bs(e,s)}return a=r.interleaved,a===null?(t.next=t,nu(r)):(t.next=a.next,a.next=t),r.interleaved=t,bs(e,s)}function hl(e,t,s){if(t=t.updateQueue,t!==null&&(t=t.shared,(s&4194240)!==0)){var r=t.lanes;r&=e.pendingLanes,s|=r,t.lanes=s,Ud(e,s)}}function Rm(e,t){var s=e.updateQueue,r=e.alternate;if(r!==null&&(r=r.updateQueue,s===r)){var a=null,o=null;if(s=s.firstBaseUpdate,s!==null){do{var l={eventTime:s.eventTime,lane:s.lane,tag:s.tag,payload:s.payload,callback:s.callback,next:null};o===null?a=o=l:o=o.next=l,s=s.next}while(s!==null);o===null?a=o=t:o=o.next=t}else a=o=t;s={baseState:r.baseState,firstBaseUpdate:a,lastBaseUpdate:o,shared:r.shared,effects:r.effects},e.updateQueue=s;return}e=s.lastBaseUpdate,e===null?s.firstBaseUpdate=t:e.next=t,s.lastBaseUpdate=t}function Bl(e,t,s,r){var a=e.updateQueue;Ds=!1;var o=a.firstBaseUpdate,l=a.lastBaseUpdate,i=a.shared.pending;if(i!==null){a.shared.pending=null;var c=i,m=c.next;c.next=null,l===null?o=m:l.next=m,l=c;var p=e.alternate;p!==null&&(p=p.updateQueue,i=p.lastBaseUpdate,i!==l&&(i===null?p.firstBaseUpdate=m:i.next=m,p.lastBaseUpdate=c))}if(o!==null){var h=a.baseState;l=0,p=m=c=null,i=o;do{var v=i.lane,A=i.eventTime;if((r&v)===v){p!==null&&(p=p.next={eventTime:A,lane:0,tag:i.tag,payload:i.payload,callback:i.callback,next:null});e:{var D=e,I=i;switch(v=t,A=s,I.tag){case 1:if(D=I.payload,typeof D=="function"){h=D.call(A,h,v);break e}h=D;break e;case 3:D.flags=D.flags&-65537|128;case 0:if(D=I.payload,v=typeof D=="function"?D.call(A,h,v):D,v==null)break e;h=St({},h,v);break e;case 2:Ds=!0}}i.callback!==null&&i.lane!==0&&(e.flags|=64,v=a.effects,v===null?a.effects=[i]:v.push(i))}else A={eventTime:A,lane:v,tag:i.tag,payload:i.payload,callback:i.callback,next:null},p===null?(m=p=A,c=h):p=p.next=A,l|=v;if(i=i.next,i===null){if(i=a.shared.pending,i===null)break;v=i,i=v.next,v.next=null,a.lastBaseUpdate=v,a.shared.pending=null}}while(!0);if(p===null&&(c=h),a.baseState=c,a.firstBaseUpdate=m,a.lastBaseUpdate=p,t=a.shared.interleaved,t!==null){a=t;do l|=a.lane,a=a.next;while(a!==t)}else o===null&&(a.shared.lanes=0);gr|=l,e.lanes=l,e.memoizedState=h}}function Cm(e,t,s){if(e=t.effects,t.effects=null,e!==null)for(t=0;t<e.length;t++){var r=e[t],a=r.callback;if(a!==null){if(r.callback=null,r=s,typeof a!="function")throw Error(de(191,a));a.call(r)}}}var Eo={},rs=Qs(Eo),ro=Qs(Eo),ao=Qs(Eo);function dr(e){if(e===Eo)throw Error(de(174));return e}function ru(e,t){switch(dt(ao,t),dt(ro,e),dt(rs,Eo),e=t.nodeType,e){case 9:case 11:t=(t=t.documentElement)?t.namespaceURI:Hc(null,"");break;default:e=e===8?t.parentNode:t,t=e.namespaceURI||null,e=e.tagName,t=Hc(t,e)}xt(rs),dt(rs,t)}function ea(){xt(rs),xt(ro),xt(ao)}function rx(e){dr(ao.current);var t=dr(rs.current),s=Hc(t,e.type);t!==s&&(dt(ro,e),dt(rs,s))}function au(e){ro.current===e&&(xt(rs),xt(ro))}var bt=Qs(0);function $l(e){for(var t=e;t!==null;){if(t.tag===13){var s=t.memoizedState;if(s!==null&&(s=s.dehydrated,s===null||s.data==="$?"||s.data==="$!"))return t}else if(t.tag===19&&t.memoizedProps.revealOrder!==void 0){if(t.flags&128)return t}else if(t.child!==null){t.child.return=t,t=t.child;continue}if(t===e)break;for(;t.sibling===null;){if(t.return===null||t.return===e)return null;t=t.return}t.sibling.return=t.return,t=t.sibling}return null}var cc=[];function ou(){for(var e=0;e<cc.length;e++)cc[e]._workInProgressVersionPrimary=null;cc.length=0}var gl=Ss.ReactCurrentDispatcher,dc=Ss.ReactCurrentBatchConfig,hr=0,vt=null,Lt=null,Ft=null,Hl=!1,Ha=!1,oo=0,Ly=0;function Gt(){throw Error(de(321))}function lu(e,t){if(t===null)return!1;for(var s=0;s<t.length&&s<e.length;s++)if(!Yn(e[s],t[s]))return!1;return!0}function iu(e,t,s,r,a,o){if(hr=o,vt=t,t.memoizedState=null,t.updateQueue=null,t.lanes=0,gl.current=e===null||e.memoizedState===null?Py:Fy,e=s(r,a),Ha){o=0;do{if(Ha=!1,oo=0,25<=o)throw Error(de(301));o+=1,Ft=Lt=null,t.updateQueue=null,gl.current=By,e=s(r,a)}while(Ha)}if(gl.current=Ul,t=Lt!==null&&Lt.next!==null,hr=0,Ft=Lt=vt=null,Hl=!1,t)throw Error(de(300));return e}function cu(){var e=oo!==0;return oo=0,e}function Xn(){var e={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Ft===null?vt.memoizedState=Ft=e:Ft=Ft.next=e,Ft}function Mn(){if(Lt===null){var e=vt.alternate;e=e!==null?e.memoizedState:null}else e=Lt.next;var t=Ft===null?vt.memoizedState:Ft.next;if(t!==null)Ft=t,Lt=e;else{if(e===null)throw Error(de(310));Lt=e,e={memoizedState:Lt.memoizedState,baseState:Lt.baseState,baseQueue:Lt.baseQueue,queue:Lt.queue,next:null},Ft===null?vt.memoizedState=Ft=e:Ft=Ft.next=e}return Ft}function lo(e,t){return typeof t=="function"?t(e):t}function uc(e){var t=Mn(),s=t.queue;if(s===null)throw Error(de(311));s.lastRenderedReducer=e;var r=Lt,a=r.baseQueue,o=s.pending;if(o!==null){if(a!==null){var l=a.next;a.next=o.next,o.next=l}r.baseQueue=a=o,s.pending=null}if(a!==null){o=a.next,r=r.baseState;var i=l=null,c=null,m=o;do{var p=m.lane;if((hr&p)===p)c!==null&&(c=c.next={lane:0,action:m.action,hasEagerState:m.hasEagerState,eagerState:m.eagerState,next:null}),r=m.hasEagerState?m.eagerState:e(r,m.action);else{var h={lane:p,action:m.action,hasEagerState:m.hasEagerState,eagerState:m.eagerState,next:null};c===null?(i=c=h,l=r):c=c.next=h,vt.lanes|=p,gr|=p}m=m.next}while(m!==null&&m!==o);c===null?l=r:c.next=i,Yn(r,t.memoizedState)||(an=!0),t.memoizedState=r,t.baseState=l,t.baseQueue=c,s.lastRenderedState=r}if(e=s.interleaved,e!==null){a=e;do o=a.lane,vt.lanes|=o,gr|=o,a=a.next;while(a!==e)}else a===null&&(s.lanes=0);return[t.memoizedState,s.dispatch]}function mc(e){var t=Mn(),s=t.queue;if(s===null)throw Error(de(311));s.lastRenderedReducer=e;var r=s.dispatch,a=s.pending,o=t.memoizedState;if(a!==null){s.pending=null;var l=a=a.next;do o=e(o,l.action),l=l.next;while(l!==a);Yn(o,t.memoizedState)||(an=!0),t.memoizedState=o,t.baseQueue===null&&(t.baseState=o),s.lastRenderedState=o}return[o,r]}function ax(){}function ox(e,t){var s=vt,r=Mn(),a=t(),o=!Yn(r.memoizedState,a);if(o&&(r.memoizedState=a,an=!0),r=r.queue,du(cx.bind(null,s,r,e),[e]),r.getSnapshot!==t||o||Ft!==null&&Ft.memoizedState.tag&1){if(s.flags|=2048,io(9,ix.bind(null,s,r,a,t),void 0,null),Bt===null)throw Error(de(349));hr&30||lx(s,t,a)}return a}function lx(e,t,s){e.flags|=16384,e={getSnapshot:t,value:s},t=vt.updateQueue,t===null?(t={lastEffect:null,stores:null},vt.updateQueue=t,t.stores=[e]):(s=t.stores,s===null?t.stores=[e]:s.push(e))}function ix(e,t,s,r){t.value=s,t.getSnapshot=r,dx(t)&&ux(e)}function cx(e,t,s){return s(function(){dx(t)&&ux(e)})}function dx(e){var t=e.getSnapshot;e=e.value;try{var s=t();return!Yn(e,s)}catch{return!0}}function ux(e){var t=bs(e,1);t!==null&&Vn(t,e,1,-1)}function Dm(e){var t=Xn();return typeof e=="function"&&(e=e()),t.memoizedState=t.baseState=e,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:lo,lastRenderedState:e},t.queue=e,e=e.dispatch=My.bind(null,vt,e),[t.memoizedState,e]}function io(e,t,s,r){return e={tag:e,create:t,destroy:s,deps:r,next:null},t=vt.updateQueue,t===null?(t={lastEffect:null,stores:null},vt.updateQueue=t,t.lastEffect=e.next=e):(s=t.lastEffect,s===null?t.lastEffect=e.next=e:(r=s.next,s.next=e,e.next=r,t.lastEffect=e)),e}function mx(){return Mn().memoizedState}function yl(e,t,s,r){var a=Xn();vt.flags|=e,a.memoizedState=io(1|t,s,void 0,r===void 0?null:r)}function pi(e,t,s,r){var a=Mn();r=r===void 0?null:r;var o=void 0;if(Lt!==null){var l=Lt.memoizedState;if(o=l.destroy,r!==null&&lu(r,l.deps)){a.memoizedState=io(t,s,o,r);return}}vt.flags|=e,a.memoizedState=io(1|t,s,o,r)}function Lm(e,t){return yl(8390656,8,e,t)}function du(e,t){return pi(2048,8,e,t)}function px(e,t){return pi(4,2,e,t)}function fx(e,t){return pi(4,4,e,t)}function xx(e,t){if(typeof t=="function")return e=e(),t(e),function(){t(null)};if(t!=null)return e=e(),t.current=e,function(){t.current=null}}function hx(e,t,s){return s=s!=null?s.concat([e]):null,pi(4,4,xx.bind(null,t,e),s)}function uu(){}function gx(e,t){var s=Mn();t=t===void 0?null:t;var r=s.memoizedState;return r!==null&&t!==null&&lu(t,r[1])?r[0]:(s.memoizedState=[e,t],e)}function yx(e,t){var s=Mn();t=t===void 0?null:t;var r=s.memoizedState;return r!==null&&t!==null&&lu(t,r[1])?r[0]:(e=e(),s.memoizedState=[e,t],e)}function Nx(e,t,s){return hr&21?(Yn(s,t)||(s=jf(),vt.lanes|=s,gr|=s,e.baseState=!0),t):(e.baseState&&(e.baseState=!1,an=!0),e.memoizedState=s)}function _y(e,t){var s=at;at=s!==0&&4>s?s:4,e(!0);var r=dc.transition;dc.transition={};try{e(!1),t()}finally{at=s,dc.transition=r}}function bx(){return Mn().memoizedState}function Oy(e,t,s){var r=Ys(e);if(s={lane:r,action:s,hasEagerState:!1,eagerState:null,next:null},vx(e))Sx(t,s);else if(s=nx(e,t,s,r),s!==null){var a=tn();Vn(s,e,r,a),wx(s,t,r)}}function My(e,t,s){var r=Ys(e),a={lane:r,action:s,hasEagerState:!1,eagerState:null,next:null};if(vx(e))Sx(t,a);else{var o=e.alternate;if(e.lanes===0&&(o===null||o.lanes===0)&&(o=t.lastRenderedReducer,o!==null))try{var l=t.lastRenderedState,i=o(l,s);if(a.hasEagerState=!0,a.eagerState=i,Yn(i,l)){var c=t.interleaved;c===null?(a.next=a,nu(t)):(a.next=c.next,c.next=a),t.interleaved=a;return}}catch{}finally{}s=nx(e,t,a,r),s!==null&&(a=tn(),Vn(s,e,r,a),wx(s,t,r))}}function vx(e){var t=e.alternate;return e===vt||t!==null&&t===vt}function Sx(e,t){Ha=Hl=!0;var s=e.pending;s===null?t.next=t:(t.next=s.next,s.next=t),e.pending=t}function wx(e,t,s){if(s&4194240){var r=t.lanes;r&=e.pendingLanes,s|=r,t.lanes=s,Ud(e,s)}}var Ul={readContext:On,useCallback:Gt,useContext:Gt,useEffect:Gt,useImperativeHandle:Gt,useInsertionEffect:Gt,useLayoutEffect:Gt,useMemo:Gt,useReducer:Gt,useRef:Gt,useState:Gt,useDebugValue:Gt,useDeferredValue:Gt,useTransition:Gt,useMutableSource:Gt,useSyncExternalStore:Gt,useId:Gt,unstable_isNewReconciler:!1},Py={readContext:On,useCallback:function(e,t){return Xn().memoizedState=[e,t===void 0?null:t],e},useContext:On,useEffect:Lm,useImperativeHandle:function(e,t,s){return s=s!=null?s.concat([e]):null,yl(4194308,4,xx.bind(null,t,e),s)},useLayoutEffect:function(e,t){return yl(4194308,4,e,t)},useInsertionEffect:function(e,t){return yl(4,2,e,t)},useMemo:function(e,t){var s=Xn();return t=t===void 0?null:t,e=e(),s.memoizedState=[e,t],e},useReducer:function(e,t,s){var r=Xn();return t=s!==void 0?s(t):t,r.memoizedState=r.baseState=t,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:e,lastRenderedState:t},r.queue=e,e=e.dispatch=Oy.bind(null,vt,e),[r.memoizedState,e]},useRef:function(e){var t=Xn();return e={current:e},t.memoizedState=e},useState:Dm,useDebugValue:uu,useDeferredValue:function(e){return Xn().memoizedState=e},useTransition:function(){var e=Dm(!1),t=e[0];return e=_y.bind(null,e[1]),Xn().memoizedState=e,[t,e]},useMutableSource:function(){},useSyncExternalStore:function(e,t,s){var r=vt,a=Xn();if(yt){if(s===void 0)throw Error(de(407));s=s()}else{if(s=t(),Bt===null)throw Error(de(349));hr&30||lx(r,t,s)}a.memoizedState=s;var o={value:s,getSnapshot:t};return a.queue=o,Lm(cx.bind(null,r,o,e),[e]),r.flags|=2048,io(9,ix.bind(null,r,o,s,t),void 0,null),s},useId:function(){var e=Xn(),t=Bt.identifierPrefix;if(yt){var s=fs,r=ps;s=(r&~(1<<32-zn(r)-1)).toString(32)+s,t=":"+t+"R"+s,s=oo++,0<s&&(t+="H"+s.toString(32)),t+=":"}else s=Ly++,t=":"+t+"r"+s.toString(32)+":";return e.memoizedState=t},unstable_isNewReconciler:!1},Fy={readContext:On,useCallback:gx,useContext:On,useEffect:du,useImperativeHandle:hx,useInsertionEffect:px,useLayoutEffect:fx,useMemo:yx,useReducer:uc,useRef:mx,useState:function(){return uc(lo)},useDebugValue:uu,useDeferredValue:function(e){var t=Mn();return Nx(t,Lt.memoizedState,e)},useTransition:function(){var e=uc(lo)[0],t=Mn().memoizedState;return[e,t]},useMutableSource:ax,useSyncExternalStore:ox,useId:bx,unstable_isNewReconciler:!1},By={readContext:On,useCallback:gx,useContext:On,useEffect:du,useImperativeHandle:hx,useInsertionEffect:px,useLayoutEffect:fx,useMemo:yx,useReducer:mc,useRef:mx,useState:function(){return mc(lo)},useDebugValue:uu,useDeferredValue:function(e){var t=Mn();return Lt===null?t.memoizedState=e:Nx(t,Lt.memoizedState,e)},useTransition:function(){var e=mc(lo)[0],t=Mn().memoizedState;return[e,t]},useMutableSource:ax,useSyncExternalStore:ox,useId:bx,unstable_isNewReconciler:!1};function Hn(e,t){if(e&&e.defaultProps){t=St({},t),e=e.defaultProps;for(var s in e)t[s]===void 0&&(t[s]=e[s]);return t}return t}function id(e,t,s,r){t=e.memoizedState,s=s(r,t),s=s==null?t:St({},t,s),e.memoizedState=s,e.lanes===0&&(e.updateQueue.baseState=s)}var fi={isMounted:function(e){return(e=e._reactInternals)?vr(e)===e:!1},enqueueSetState:function(e,t,s){e=e._reactInternals;var r=tn(),a=Ys(e),o=xs(r,a);o.payload=t,s!=null&&(o.callback=s),t=Vs(e,o,a),t!==null&&(Vn(t,e,a,r),hl(t,e,a))},enqueueReplaceState:function(e,t,s){e=e._reactInternals;var r=tn(),a=Ys(e),o=xs(r,a);o.tag=1,o.payload=t,s!=null&&(o.callback=s),t=Vs(e,o,a),t!==null&&(Vn(t,e,a,r),hl(t,e,a))},enqueueForceUpdate:function(e,t){e=e._reactInternals;var s=tn(),r=Ys(e),a=xs(s,r);a.tag=2,t!=null&&(a.callback=t),t=Vs(e,a,r),t!==null&&(Vn(t,e,r,s),hl(t,e,r))}};function _m(e,t,s,r,a,o,l){return e=e.stateNode,typeof e.shouldComponentUpdate=="function"?e.shouldComponentUpdate(r,o,l):t.prototype&&t.prototype.isPureReactComponent?!eo(s,r)||!eo(a,o):!0}function jx(e,t,s){var r=!1,a=Xs,o=t.contextType;return typeof o=="object"&&o!==null?o=On(o):(a=ln(t)?fr:Qt.current,r=t.contextTypes,o=(r=r!=null)?Jr(e,a):Xs),t=new t(s,o),e.memoizedState=t.state!==null&&t.state!==void 0?t.state:null,t.updater=fi,e.stateNode=t,t._reactInternals=e,r&&(e=e.stateNode,e.__reactInternalMemoizedUnmaskedChildContext=a,e.__reactInternalMemoizedMaskedChildContext=o),t}function Om(e,t,s,r){e=t.state,typeof t.componentWillReceiveProps=="function"&&t.componentWillReceiveProps(s,r),typeof t.UNSAFE_componentWillReceiveProps=="function"&&t.UNSAFE_componentWillReceiveProps(s,r),t.state!==e&&fi.enqueueReplaceState(t,t.state,null)}function cd(e,t,s,r){var a=e.stateNode;a.props=s,a.state=e.memoizedState,a.refs={},su(e);var o=t.contextType;typeof o=="object"&&o!==null?a.context=On(o):(o=ln(t)?fr:Qt.current,a.context=Jr(e,o)),a.state=e.memoizedState,o=t.getDerivedStateFromProps,typeof o=="function"&&(id(e,t,o,s),a.state=e.memoizedState),typeof t.getDerivedStateFromProps=="function"||typeof a.getSnapshotBeforeUpdate=="function"||typeof a.UNSAFE_componentWillMount!="function"&&typeof a.componentWillMount!="function"||(t=a.state,typeof a.componentWillMount=="function"&&a.componentWillMount(),typeof a.UNSAFE_componentWillMount=="function"&&a.UNSAFE_componentWillMount(),t!==a.state&&fi.enqueueReplaceState(a,a.state,null),Bl(e,s,a,r),a.state=e.memoizedState),typeof a.componentDidMount=="function"&&(e.flags|=4194308)}function ta(e,t){try{var s="",r=t;do s+=pg(r),r=r.return;while(r);var a=s}catch(o){a=`
Error generating stack: `+o.message+`
`+o.stack}return{value:e,source:t,stack:a,digest:null}}function pc(e,t,s){return{value:e,source:null,stack:s??null,digest:t??null}}function dd(e,t){try{console.error(t.value)}catch(s){setTimeout(function(){throw s})}}var $y=typeof WeakMap=="function"?WeakMap:Map;function Ex(e,t,s){s=xs(-1,s),s.tag=3,s.payload={element:null};var r=t.value;return s.callback=function(){zl||(zl=!0,bd=r),dd(e,t)},s}function kx(e,t,s){s=xs(-1,s),s.tag=3;var r=e.type.getDerivedStateFromError;if(typeof r=="function"){var a=t.value;s.payload=function(){return r(a)},s.callback=function(){dd(e,t)}}var o=e.stateNode;return o!==null&&typeof o.componentDidCatch=="function"&&(s.callback=function(){dd(e,t),typeof r!="function"&&(Ks===null?Ks=new Set([this]):Ks.add(this));var l=t.stack;this.componentDidCatch(t.value,{componentStack:l!==null?l:""})}),s}function Mm(e,t,s){var r=e.pingCache;if(r===null){r=e.pingCache=new $y;var a=new Set;r.set(t,a)}else a=r.get(t),a===void 0&&(a=new Set,r.set(t,a));a.has(s)||(a.add(s),e=e0.bind(null,e,t,s),t.then(e,e))}function Pm(e){do{var t;if((t=e.tag===13)&&(t=e.memoizedState,t=t!==null?t.dehydrated!==null:!0),t)return e;e=e.return}while(e!==null);return null}function Fm(e,t,s,r,a){return e.mode&1?(e.flags|=65536,e.lanes=a,e):(e===t?e.flags|=65536:(e.flags|=128,s.flags|=131072,s.flags&=-52805,s.tag===1&&(s.alternate===null?s.tag=17:(t=xs(-1,1),t.tag=2,Vs(s,t,1))),s.lanes|=1),e)}var Hy=Ss.ReactCurrentOwner,an=!1;function en(e,t,s,r){t.child=e===null?tx(t,null,s,r):Zr(t,e.child,s,r)}function Bm(e,t,s,r,a){s=s.render;var o=t.ref;return Yr(t,a),r=iu(e,t,s,r,o,a),s=cu(),e!==null&&!an?(t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~a,vs(e,t,a)):(yt&&s&&Xd(t),t.flags|=1,en(e,t,r,a),t.child)}function $m(e,t,s,r,a){if(e===null){var o=s.type;return typeof o=="function"&&!Nu(o)&&o.defaultProps===void 0&&s.compare===null&&s.defaultProps===void 0?(t.tag=15,t.type=o,Ax(e,t,o,r,a)):(e=Sl(s.type,null,r,t,t.mode,a),e.ref=t.ref,e.return=t,t.child=e)}if(o=e.child,!(e.lanes&a)){var l=o.memoizedProps;if(s=s.compare,s=s!==null?s:eo,s(l,r)&&e.ref===t.ref)return vs(e,t,a)}return t.flags|=1,e=Gs(o,r),e.ref=t.ref,e.return=t,t.child=e}function Ax(e,t,s,r,a){if(e!==null){var o=e.memoizedProps;if(eo(o,r)&&e.ref===t.ref)if(an=!1,t.pendingProps=r=o,(e.lanes&a)!==0)e.flags&131072&&(an=!0);else return t.lanes=e.lanes,vs(e,t,a)}return ud(e,t,s,r,a)}function Ix(e,t,s){var r=t.pendingProps,a=r.children,o=e!==null?e.memoizedState:null;if(r.mode==="hidden")if(!(t.mode&1))t.memoizedState={baseLanes:0,cachePool:null,transitions:null},dt(Ur,fn),fn|=s;else{if(!(s&1073741824))return e=o!==null?o.baseLanes|s:s,t.lanes=t.childLanes=1073741824,t.memoizedState={baseLanes:e,cachePool:null,transitions:null},t.updateQueue=null,dt(Ur,fn),fn|=e,null;t.memoizedState={baseLanes:0,cachePool:null,transitions:null},r=o!==null?o.baseLanes:s,dt(Ur,fn),fn|=r}else o!==null?(r=o.baseLanes|s,t.memoizedState=null):r=s,dt(Ur,fn),fn|=r;return en(e,t,a,s),t.child}function Tx(e,t){var s=t.ref;(e===null&&s!==null||e!==null&&e.ref!==s)&&(t.flags|=512,t.flags|=2097152)}function ud(e,t,s,r,a){var o=ln(s)?fr:Qt.current;return o=Jr(t,o),Yr(t,a),s=iu(e,t,s,r,o,a),r=cu(),e!==null&&!an?(t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~a,vs(e,t,a)):(yt&&r&&Xd(t),t.flags|=1,en(e,t,s,a),t.child)}function Hm(e,t,s,r,a){if(ln(s)){var o=!0;_l(t)}else o=!1;if(Yr(t,a),t.stateNode===null)Nl(e,t),jx(t,s,r),cd(t,s,r,a),r=!0;else if(e===null){var l=t.stateNode,i=t.memoizedProps;l.props=i;var c=l.context,m=s.contextType;typeof m=="object"&&m!==null?m=On(m):(m=ln(s)?fr:Qt.current,m=Jr(t,m));var p=s.getDerivedStateFromProps,h=typeof p=="function"||typeof l.getSnapshotBeforeUpdate=="function";h||typeof l.UNSAFE_componentWillReceiveProps!="function"&&typeof l.componentWillReceiveProps!="function"||(i!==r||c!==m)&&Om(t,l,r,m),Ds=!1;var v=t.memoizedState;l.state=v,Bl(t,r,l,a),c=t.memoizedState,i!==r||v!==c||on.current||Ds?(typeof p=="function"&&(id(t,s,p,r),c=t.memoizedState),(i=Ds||_m(t,s,i,r,v,c,m))?(h||typeof l.UNSAFE_componentWillMount!="function"&&typeof l.componentWillMount!="function"||(typeof l.componentWillMount=="function"&&l.componentWillMount(),typeof l.UNSAFE_componentWillMount=="function"&&l.UNSAFE_componentWillMount()),typeof l.componentDidMount=="function"&&(t.flags|=4194308)):(typeof l.componentDidMount=="function"&&(t.flags|=4194308),t.memoizedProps=r,t.memoizedState=c),l.props=r,l.state=c,l.context=m,r=i):(typeof l.componentDidMount=="function"&&(t.flags|=4194308),r=!1)}else{l=t.stateNode,sx(e,t),i=t.memoizedProps,m=t.type===t.elementType?i:Hn(t.type,i),l.props=m,h=t.pendingProps,v=l.context,c=s.contextType,typeof c=="object"&&c!==null?c=On(c):(c=ln(s)?fr:Qt.current,c=Jr(t,c));var A=s.getDerivedStateFromProps;(p=typeof A=="function"||typeof l.getSnapshotBeforeUpdate=="function")||typeof l.UNSAFE_componentWillReceiveProps!="function"&&typeof l.componentWillReceiveProps!="function"||(i!==h||v!==c)&&Om(t,l,r,c),Ds=!1,v=t.memoizedState,l.state=v,Bl(t,r,l,a);var D=t.memoizedState;i!==h||v!==D||on.current||Ds?(typeof A=="function"&&(id(t,s,A,r),D=t.memoizedState),(m=Ds||_m(t,s,m,r,v,D,c)||!1)?(p||typeof l.UNSAFE_componentWillUpdate!="function"&&typeof l.componentWillUpdate!="function"||(typeof l.componentWillUpdate=="function"&&l.componentWillUpdate(r,D,c),typeof l.UNSAFE_componentWillUpdate=="function"&&l.UNSAFE_componentWillUpdate(r,D,c)),typeof l.componentDidUpdate=="function"&&(t.flags|=4),typeof l.getSnapshotBeforeUpdate=="function"&&(t.flags|=1024)):(typeof l.componentDidUpdate!="function"||i===e.memoizedProps&&v===e.memoizedState||(t.flags|=4),typeof l.getSnapshotBeforeUpdate!="function"||i===e.memoizedProps&&v===e.memoizedState||(t.flags|=1024),t.memoizedProps=r,t.memoizedState=D),l.props=r,l.state=D,l.context=c,r=m):(typeof l.componentDidUpdate!="function"||i===e.memoizedProps&&v===e.memoizedState||(t.flags|=4),typeof l.getSnapshotBeforeUpdate!="function"||i===e.memoizedProps&&v===e.memoizedState||(t.flags|=1024),r=!1)}return md(e,t,s,r,o,a)}function md(e,t,s,r,a,o){Tx(e,t);var l=(t.flags&128)!==0;if(!r&&!l)return a&&km(t,s,!1),vs(e,t,o);r=t.stateNode,Hy.current=t;var i=l&&typeof s.getDerivedStateFromError!="function"?null:r.render();return t.flags|=1,e!==null&&l?(t.child=Zr(t,e.child,null,o),t.child=Zr(t,null,i,o)):en(e,t,i,o),t.memoizedState=r.state,a&&km(t,s,!0),t.child}function Rx(e){var t=e.stateNode;t.pendingContext?Em(e,t.pendingContext,t.pendingContext!==t.context):t.context&&Em(e,t.context,!1),ru(e,t.containerInfo)}function Um(e,t,s,r,a){return Qr(),Qd(a),t.flags|=256,en(e,t,s,r),t.child}var pd={dehydrated:null,treeContext:null,retryLane:0};function fd(e){return{baseLanes:e,cachePool:null,transitions:null}}function Cx(e,t,s){var r=t.pendingProps,a=bt.current,o=!1,l=(t.flags&128)!==0,i;if((i=l)||(i=e!==null&&e.memoizedState===null?!1:(a&2)!==0),i?(o=!0,t.flags&=-129):(e===null||e.memoizedState!==null)&&(a|=1),dt(bt,a&1),e===null)return od(t),e=t.memoizedState,e!==null&&(e=e.dehydrated,e!==null)?(t.mode&1?e.data==="$!"?t.lanes=8:t.lanes=1073741824:t.lanes=1,null):(l=r.children,e=r.fallback,o?(r=t.mode,o=t.child,l={mode:"hidden",children:l},!(r&1)&&o!==null?(o.childLanes=0,o.pendingProps=l):o=gi(l,r,0,null),e=mr(e,r,s,null),o.return=t,e.return=t,o.sibling=e,t.child=o,t.child.memoizedState=fd(s),t.memoizedState=pd,e):mu(t,l));if(a=e.memoizedState,a!==null&&(i=a.dehydrated,i!==null))return Uy(e,t,l,r,i,a,s);if(o){o=r.fallback,l=t.mode,a=e.child,i=a.sibling;var c={mode:"hidden",children:r.children};return!(l&1)&&t.child!==a?(r=t.child,r.childLanes=0,r.pendingProps=c,t.deletions=null):(r=Gs(a,c),r.subtreeFlags=a.subtreeFlags&14680064),i!==null?o=Gs(i,o):(o=mr(o,l,s,null),o.flags|=2),o.return=t,r.return=t,r.sibling=o,t.child=r,r=o,o=t.child,l=e.child.memoizedState,l=l===null?fd(s):{baseLanes:l.baseLanes|s,cachePool:null,transitions:l.transitions},o.memoizedState=l,o.childLanes=e.childLanes&~s,t.memoizedState=pd,r}return o=e.child,e=o.sibling,r=Gs(o,{mode:"visible",children:r.children}),!(t.mode&1)&&(r.lanes=s),r.return=t,r.sibling=null,e!==null&&(s=t.deletions,s===null?(t.deletions=[e],t.flags|=16):s.push(e)),t.child=r,t.memoizedState=null,r}function mu(e,t){return t=gi({mode:"visible",children:t},e.mode,0,null),t.return=e,e.child=t}function Zo(e,t,s,r){return r!==null&&Qd(r),Zr(t,e.child,null,s),e=mu(t,t.pendingProps.children),e.flags|=2,t.memoizedState=null,e}function Uy(e,t,s,r,a,o,l){if(s)return t.flags&256?(t.flags&=-257,r=pc(Error(de(422))),Zo(e,t,l,r)):t.memoizedState!==null?(t.child=e.child,t.flags|=128,null):(o=r.fallback,a=t.mode,r=gi({mode:"visible",children:r.children},a,0,null),o=mr(o,a,l,null),o.flags|=2,r.return=t,o.return=t,r.sibling=o,t.child=r,t.mode&1&&Zr(t,e.child,null,l),t.child.memoizedState=fd(l),t.memoizedState=pd,o);if(!(t.mode&1))return Zo(e,t,l,null);if(a.data==="$!"){if(r=a.nextSibling&&a.nextSibling.dataset,r)var i=r.dgst;return r=i,o=Error(de(419)),r=pc(o,r,void 0),Zo(e,t,l,r)}if(i=(l&e.childLanes)!==0,an||i){if(r=Bt,r!==null){switch(l&-l){case 4:a=2;break;case 16:a=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:a=32;break;case 536870912:a=268435456;break;default:a=0}a=a&(r.suspendedLanes|l)?0:a,a!==0&&a!==o.retryLane&&(o.retryLane=a,bs(e,a),Vn(r,e,a,-1))}return yu(),r=pc(Error(de(421))),Zo(e,t,l,r)}return a.data==="$?"?(t.flags|=128,t.child=e.child,t=t0.bind(null,e),a._reactRetry=t,null):(e=o.treeContext,hn=zs(a.nextSibling),gn=t,yt=!0,Wn=null,e!==null&&(Rn[Cn++]=ps,Rn[Cn++]=fs,Rn[Cn++]=xr,ps=e.id,fs=e.overflow,xr=t),t=mu(t,r.children),t.flags|=4096,t)}function Wm(e,t,s){e.lanes|=t;var r=e.alternate;r!==null&&(r.lanes|=t),ld(e.return,t,s)}function fc(e,t,s,r,a){var o=e.memoizedState;o===null?e.memoizedState={isBackwards:t,rendering:null,renderingStartTime:0,last:r,tail:s,tailMode:a}:(o.isBackwards=t,o.rendering=null,o.renderingStartTime=0,o.last=r,o.tail=s,o.tailMode=a)}function Dx(e,t,s){var r=t.pendingProps,a=r.revealOrder,o=r.tail;if(en(e,t,r.children,s),r=bt.current,r&2)r=r&1|2,t.flags|=128;else{if(e!==null&&e.flags&128)e:for(e=t.child;e!==null;){if(e.tag===13)e.memoizedState!==null&&Wm(e,s,t);else if(e.tag===19)Wm(e,s,t);else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===t)break e;for(;e.sibling===null;){if(e.return===null||e.return===t)break e;e=e.return}e.sibling.return=e.return,e=e.sibling}r&=1}if(dt(bt,r),!(t.mode&1))t.memoizedState=null;else switch(a){case"forwards":for(s=t.child,a=null;s!==null;)e=s.alternate,e!==null&&$l(e)===null&&(a=s),s=s.sibling;s=a,s===null?(a=t.child,t.child=null):(a=s.sibling,s.sibling=null),fc(t,!1,a,s,o);break;case"backwards":for(s=null,a=t.child,t.child=null;a!==null;){if(e=a.alternate,e!==null&&$l(e)===null){t.child=a;break}e=a.sibling,a.sibling=s,s=a,a=e}fc(t,!0,s,null,o);break;case"together":fc(t,!1,null,null,void 0);break;default:t.memoizedState=null}return t.child}function Nl(e,t){!(t.mode&1)&&e!==null&&(e.alternate=null,t.alternate=null,t.flags|=2)}function vs(e,t,s){if(e!==null&&(t.dependencies=e.dependencies),gr|=t.lanes,!(s&t.childLanes))return null;if(e!==null&&t.child!==e.child)throw Error(de(153));if(t.child!==null){for(e=t.child,s=Gs(e,e.pendingProps),t.child=s,s.return=t;e.sibling!==null;)e=e.sibling,s=s.sibling=Gs(e,e.pendingProps),s.return=t;s.sibling=null}return t.child}function Wy(e,t,s){switch(t.tag){case 3:Rx(t),Qr();break;case 5:rx(t);break;case 1:ln(t.type)&&_l(t);break;case 4:ru(t,t.stateNode.containerInfo);break;case 10:var r=t.type._context,a=t.memoizedProps.value;dt(Pl,r._currentValue),r._currentValue=a;break;case 13:if(r=t.memoizedState,r!==null)return r.dehydrated!==null?(dt(bt,bt.current&1),t.flags|=128,null):s&t.child.childLanes?Cx(e,t,s):(dt(bt,bt.current&1),e=vs(e,t,s),e!==null?e.sibling:null);dt(bt,bt.current&1);break;case 19:if(r=(s&t.childLanes)!==0,e.flags&128){if(r)return Dx(e,t,s);t.flags|=128}if(a=t.memoizedState,a!==null&&(a.rendering=null,a.tail=null,a.lastEffect=null),dt(bt,bt.current),r)break;return null;case 22:case 23:return t.lanes=0,Ix(e,t,s)}return vs(e,t,s)}var Lx,xd,_x,Ox;Lx=function(e,t){for(var s=t.child;s!==null;){if(s.tag===5||s.tag===6)e.appendChild(s.stateNode);else if(s.tag!==4&&s.child!==null){s.child.return=s,s=s.child;continue}if(s===t)break;for(;s.sibling===null;){if(s.return===null||s.return===t)return;s=s.return}s.sibling.return=s.return,s=s.sibling}};xd=function(){};_x=function(e,t,s,r){var a=e.memoizedProps;if(a!==r){e=t.stateNode,dr(rs.current);var o=null;switch(s){case"input":a=Pc(e,a),r=Pc(e,r),o=[];break;case"select":a=St({},a,{value:void 0}),r=St({},r,{value:void 0}),o=[];break;case"textarea":a=$c(e,a),r=$c(e,r),o=[];break;default:typeof a.onClick!="function"&&typeof r.onClick=="function"&&(e.onclick=Dl)}Uc(s,r);var l;s=null;for(m in a)if(!r.hasOwnProperty(m)&&a.hasOwnProperty(m)&&a[m]!=null)if(m==="style"){var i=a[m];for(l in i)i.hasOwnProperty(l)&&(s||(s={}),s[l]="")}else m!=="dangerouslySetInnerHTML"&&m!=="children"&&m!=="suppressContentEditableWarning"&&m!=="suppressHydrationWarning"&&m!=="autoFocus"&&(Ya.hasOwnProperty(m)?o||(o=[]):(o=o||[]).push(m,null));for(m in r){var c=r[m];if(i=a!=null?a[m]:void 0,r.hasOwnProperty(m)&&c!==i&&(c!=null||i!=null))if(m==="style")if(i){for(l in i)!i.hasOwnProperty(l)||c&&c.hasOwnProperty(l)||(s||(s={}),s[l]="");for(l in c)c.hasOwnProperty(l)&&i[l]!==c[l]&&(s||(s={}),s[l]=c[l])}else s||(o||(o=[]),o.push(m,s)),s=c;else m==="dangerouslySetInnerHTML"?(c=c?c.__html:void 0,i=i?i.__html:void 0,c!=null&&i!==c&&(o=o||[]).push(m,c)):m==="children"?typeof c!="string"&&typeof c!="number"||(o=o||[]).push(m,""+c):m!=="suppressContentEditableWarning"&&m!=="suppressHydrationWarning"&&(Ya.hasOwnProperty(m)?(c!=null&&m==="onScroll"&&mt("scroll",e),o||i===c||(o=[])):(o=o||[]).push(m,c))}s&&(o=o||[]).push("style",s);var m=o;(t.updateQueue=m)&&(t.flags|=4)}};Ox=function(e,t,s,r){s!==r&&(t.flags|=4)};function Aa(e,t){if(!yt)switch(e.tailMode){case"hidden":t=e.tail;for(var s=null;t!==null;)t.alternate!==null&&(s=t),t=t.sibling;s===null?e.tail=null:s.sibling=null;break;case"collapsed":s=e.tail;for(var r=null;s!==null;)s.alternate!==null&&(r=s),s=s.sibling;r===null?t||e.tail===null?e.tail=null:e.tail.sibling=null:r.sibling=null}}function qt(e){var t=e.alternate!==null&&e.alternate.child===e.child,s=0,r=0;if(t)for(var a=e.child;a!==null;)s|=a.lanes|a.childLanes,r|=a.subtreeFlags&14680064,r|=a.flags&14680064,a.return=e,a=a.sibling;else for(a=e.child;a!==null;)s|=a.lanes|a.childLanes,r|=a.subtreeFlags,r|=a.flags,a.return=e,a=a.sibling;return e.subtreeFlags|=r,e.childLanes=s,t}function zy(e,t,s){var r=t.pendingProps;switch(Jd(t),t.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return qt(t),null;case 1:return ln(t.type)&&Ll(),qt(t),null;case 3:return r=t.stateNode,ea(),xt(on),xt(Qt),ou(),r.pendingContext&&(r.context=r.pendingContext,r.pendingContext=null),(e===null||e.child===null)&&(Jo(t)?t.flags|=4:e===null||e.memoizedState.isDehydrated&&!(t.flags&256)||(t.flags|=1024,Wn!==null&&(wd(Wn),Wn=null))),xd(e,t),qt(t),null;case 5:au(t);var a=dr(ao.current);if(s=t.type,e!==null&&t.stateNode!=null)_x(e,t,s,r,a),e.ref!==t.ref&&(t.flags|=512,t.flags|=2097152);else{if(!r){if(t.stateNode===null)throw Error(de(166));return qt(t),null}if(e=dr(rs.current),Jo(t)){r=t.stateNode,s=t.type;var o=t.memoizedProps;switch(r[Zn]=t,r[so]=o,e=(t.mode&1)!==0,s){case"dialog":mt("cancel",r),mt("close",r);break;case"iframe":case"object":case"embed":mt("load",r);break;case"video":case"audio":for(a=0;a<Oa.length;a++)mt(Oa[a],r);break;case"source":mt("error",r);break;case"img":case"image":case"link":mt("error",r),mt("load",r);break;case"details":mt("toggle",r);break;case"input":Qu(r,o),mt("invalid",r);break;case"select":r._wrapperState={wasMultiple:!!o.multiple},mt("invalid",r);break;case"textarea":em(r,o),mt("invalid",r)}Uc(s,o),a=null;for(var l in o)if(o.hasOwnProperty(l)){var i=o[l];l==="children"?typeof i=="string"?r.textContent!==i&&(o.suppressHydrationWarning!==!0&&Xo(r.textContent,i,e),a=["children",i]):typeof i=="number"&&r.textContent!==""+i&&(o.suppressHydrationWarning!==!0&&Xo(r.textContent,i,e),a=["children",""+i]):Ya.hasOwnProperty(l)&&i!=null&&l==="onScroll"&&mt("scroll",r)}switch(s){case"input":Uo(r),Zu(r,o,!0);break;case"textarea":Uo(r),tm(r);break;case"select":case"option":break;default:typeof o.onClick=="function"&&(r.onclick=Dl)}r=a,t.updateQueue=r,r!==null&&(t.flags|=4)}else{l=a.nodeType===9?a:a.ownerDocument,e==="http://www.w3.org/1999/xhtml"&&(e=cf(s)),e==="http://www.w3.org/1999/xhtml"?s==="script"?(e=l.createElement("div"),e.innerHTML="<script><\/script>",e=e.removeChild(e.firstChild)):typeof r.is=="string"?e=l.createElement(s,{is:r.is}):(e=l.createElement(s),s==="select"&&(l=e,r.multiple?l.multiple=!0:r.size&&(l.size=r.size))):e=l.createElementNS(e,s),e[Zn]=t,e[so]=r,Lx(e,t,!1,!1),t.stateNode=e;e:{switch(l=Wc(s,r),s){case"dialog":mt("cancel",e),mt("close",e),a=r;break;case"iframe":case"object":case"embed":mt("load",e),a=r;break;case"video":case"audio":for(a=0;a<Oa.length;a++)mt(Oa[a],e);a=r;break;case"source":mt("error",e),a=r;break;case"img":case"image":case"link":mt("error",e),mt("load",e),a=r;break;case"details":mt("toggle",e),a=r;break;case"input":Qu(e,r),a=Pc(e,r),mt("invalid",e);break;case"option":a=r;break;case"select":e._wrapperState={wasMultiple:!!r.multiple},a=St({},r,{value:void 0}),mt("invalid",e);break;case"textarea":em(e,r),a=$c(e,r),mt("invalid",e);break;default:a=r}Uc(s,a),i=a;for(o in i)if(i.hasOwnProperty(o)){var c=i[o];o==="style"?mf(e,c):o==="dangerouslySetInnerHTML"?(c=c?c.__html:void 0,c!=null&&df(e,c)):o==="children"?typeof c=="string"?(s!=="textarea"||c!=="")&&Ga(e,c):typeof c=="number"&&Ga(e,""+c):o!=="suppressContentEditableWarning"&&o!=="suppressHydrationWarning"&&o!=="autoFocus"&&(Ya.hasOwnProperty(o)?c!=null&&o==="onScroll"&&mt("scroll",e):c!=null&&Md(e,o,c,l))}switch(s){case"input":Uo(e),Zu(e,r,!1);break;case"textarea":Uo(e),tm(e);break;case"option":r.value!=null&&e.setAttribute("value",""+qs(r.value));break;case"select":e.multiple=!!r.multiple,o=r.value,o!=null?Wr(e,!!r.multiple,o,!1):r.defaultValue!=null&&Wr(e,!!r.multiple,r.defaultValue,!0);break;default:typeof a.onClick=="function"&&(e.onclick=Dl)}switch(s){case"button":case"input":case"select":case"textarea":r=!!r.autoFocus;break e;case"img":r=!0;break e;default:r=!1}}r&&(t.flags|=4)}t.ref!==null&&(t.flags|=512,t.flags|=2097152)}return qt(t),null;case 6:if(e&&t.stateNode!=null)Ox(e,t,e.memoizedProps,r);else{if(typeof r!="string"&&t.stateNode===null)throw Error(de(166));if(s=dr(ao.current),dr(rs.current),Jo(t)){if(r=t.stateNode,s=t.memoizedProps,r[Zn]=t,(o=r.nodeValue!==s)&&(e=gn,e!==null))switch(e.tag){case 3:Xo(r.nodeValue,s,(e.mode&1)!==0);break;case 5:e.memoizedProps.suppressHydrationWarning!==!0&&Xo(r.nodeValue,s,(e.mode&1)!==0)}o&&(t.flags|=4)}else r=(s.nodeType===9?s:s.ownerDocument).createTextNode(r),r[Zn]=t,t.stateNode=r}return qt(t),null;case 13:if(xt(bt),r=t.memoizedState,e===null||e.memoizedState!==null&&e.memoizedState.dehydrated!==null){if(yt&&hn!==null&&t.mode&1&&!(t.flags&128))Zf(),Qr(),t.flags|=98560,o=!1;else if(o=Jo(t),r!==null&&r.dehydrated!==null){if(e===null){if(!o)throw Error(de(318));if(o=t.memoizedState,o=o!==null?o.dehydrated:null,!o)throw Error(de(317));o[Zn]=t}else Qr(),!(t.flags&128)&&(t.memoizedState=null),t.flags|=4;qt(t),o=!1}else Wn!==null&&(wd(Wn),Wn=null),o=!0;if(!o)return t.flags&65536?t:null}return t.flags&128?(t.lanes=s,t):(r=r!==null,r!==(e!==null&&e.memoizedState!==null)&&r&&(t.child.flags|=8192,t.mode&1&&(e===null||bt.current&1?Ot===0&&(Ot=3):yu())),t.updateQueue!==null&&(t.flags|=4),qt(t),null);case 4:return ea(),xd(e,t),e===null&&to(t.stateNode.containerInfo),qt(t),null;case 10:return tu(t.type._context),qt(t),null;case 17:return ln(t.type)&&Ll(),qt(t),null;case 19:if(xt(bt),o=t.memoizedState,o===null)return qt(t),null;if(r=(t.flags&128)!==0,l=o.rendering,l===null)if(r)Aa(o,!1);else{if(Ot!==0||e!==null&&e.flags&128)for(e=t.child;e!==null;){if(l=$l(e),l!==null){for(t.flags|=128,Aa(o,!1),r=l.updateQueue,r!==null&&(t.updateQueue=r,t.flags|=4),t.subtreeFlags=0,r=s,s=t.child;s!==null;)o=s,e=r,o.flags&=14680066,l=o.alternate,l===null?(o.childLanes=0,o.lanes=e,o.child=null,o.subtreeFlags=0,o.memoizedProps=null,o.memoizedState=null,o.updateQueue=null,o.dependencies=null,o.stateNode=null):(o.childLanes=l.childLanes,o.lanes=l.lanes,o.child=l.child,o.subtreeFlags=0,o.deletions=null,o.memoizedProps=l.memoizedProps,o.memoizedState=l.memoizedState,o.updateQueue=l.updateQueue,o.type=l.type,e=l.dependencies,o.dependencies=e===null?null:{lanes:e.lanes,firstContext:e.firstContext}),s=s.sibling;return dt(bt,bt.current&1|2),t.child}e=e.sibling}o.tail!==null&&kt()>na&&(t.flags|=128,r=!0,Aa(o,!1),t.lanes=4194304)}else{if(!r)if(e=$l(l),e!==null){if(t.flags|=128,r=!0,s=e.updateQueue,s!==null&&(t.updateQueue=s,t.flags|=4),Aa(o,!0),o.tail===null&&o.tailMode==="hidden"&&!l.alternate&&!yt)return qt(t),null}else 2*kt()-o.renderingStartTime>na&&s!==1073741824&&(t.flags|=128,r=!0,Aa(o,!1),t.lanes=4194304);o.isBackwards?(l.sibling=t.child,t.child=l):(s=o.last,s!==null?s.sibling=l:t.child=l,o.last=l)}return o.tail!==null?(t=o.tail,o.rendering=t,o.tail=t.sibling,o.renderingStartTime=kt(),t.sibling=null,s=bt.current,dt(bt,r?s&1|2:s&1),t):(qt(t),null);case 22:case 23:return gu(),r=t.memoizedState!==null,e!==null&&e.memoizedState!==null!==r&&(t.flags|=8192),r&&t.mode&1?fn&1073741824&&(qt(t),t.subtreeFlags&6&&(t.flags|=8192)):qt(t),null;case 24:return null;case 25:return null}throw Error(de(156,t.tag))}function Vy(e,t){switch(Jd(t),t.tag){case 1:return ln(t.type)&&Ll(),e=t.flags,e&65536?(t.flags=e&-65537|128,t):null;case 3:return ea(),xt(on),xt(Qt),ou(),e=t.flags,e&65536&&!(e&128)?(t.flags=e&-65537|128,t):null;case 5:return au(t),null;case 13:if(xt(bt),e=t.memoizedState,e!==null&&e.dehydrated!==null){if(t.alternate===null)throw Error(de(340));Qr()}return e=t.flags,e&65536?(t.flags=e&-65537|128,t):null;case 19:return xt(bt),null;case 4:return ea(),null;case 10:return tu(t.type._context),null;case 22:case 23:return gu(),null;case 24:return null;default:return null}}var el=!1,Xt=!1,Ky=typeof WeakSet=="function"?WeakSet:Set,ke=null;function Hr(e,t){var s=e.ref;if(s!==null)if(typeof s=="function")try{s(null)}catch(r){jt(e,t,r)}else s.current=null}function hd(e,t,s){try{s()}catch(r){jt(e,t,r)}}var zm=!1;function Yy(e,t){if(Zc=Tl,e=$f(),qd(e)){if("selectionStart"in e)var s={start:e.selectionStart,end:e.selectionEnd};else e:{s=(s=e.ownerDocument)&&s.defaultView||window;var r=s.getSelection&&s.getSelection();if(r&&r.rangeCount!==0){s=r.anchorNode;var a=r.anchorOffset,o=r.focusNode;r=r.focusOffset;try{s.nodeType,o.nodeType}catch{s=null;break e}var l=0,i=-1,c=-1,m=0,p=0,h=e,v=null;t:for(;;){for(var A;h!==s||a!==0&&h.nodeType!==3||(i=l+a),h!==o||r!==0&&h.nodeType!==3||(c=l+r),h.nodeType===3&&(l+=h.nodeValue.length),(A=h.firstChild)!==null;)v=h,h=A;for(;;){if(h===e)break t;if(v===s&&++m===a&&(i=l),v===o&&++p===r&&(c=l),(A=h.nextSibling)!==null)break;h=v,v=h.parentNode}h=A}s=i===-1||c===-1?null:{start:i,end:c}}else s=null}s=s||{start:0,end:0}}else s=null;for(ed={focusedElem:e,selectionRange:s},Tl=!1,ke=t;ke!==null;)if(t=ke,e=t.child,(t.subtreeFlags&1028)!==0&&e!==null)e.return=t,ke=e;else for(;ke!==null;){t=ke;try{var D=t.alternate;if(t.flags&1024)switch(t.tag){case 0:case 11:case 15:break;case 1:if(D!==null){var I=D.memoizedProps,W=D.memoizedState,N=t.stateNode,x=N.getSnapshotBeforeUpdate(t.elementType===t.type?I:Hn(t.type,I),W);N.__reactInternalSnapshotBeforeUpdate=x}break;case 3:var b=t.stateNode.containerInfo;b.nodeType===1?b.textContent="":b.nodeType===9&&b.documentElement&&b.removeChild(b.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(de(163))}}catch(B){jt(t,t.return,B)}if(e=t.sibling,e!==null){e.return=t.return,ke=e;break}ke=t.return}return D=zm,zm=!1,D}function Ua(e,t,s){var r=t.updateQueue;if(r=r!==null?r.lastEffect:null,r!==null){var a=r=r.next;do{if((a.tag&e)===e){var o=a.destroy;a.destroy=void 0,o!==void 0&&hd(t,s,o)}a=a.next}while(a!==r)}}function xi(e,t){if(t=t.updateQueue,t=t!==null?t.lastEffect:null,t!==null){var s=t=t.next;do{if((s.tag&e)===e){var r=s.create;s.destroy=r()}s=s.next}while(s!==t)}}function gd(e){var t=e.ref;if(t!==null){var s=e.stateNode;switch(e.tag){case 5:e=s;break;default:e=s}typeof t=="function"?t(e):t.current=e}}function Mx(e){var t=e.alternate;t!==null&&(e.alternate=null,Mx(t)),e.child=null,e.deletions=null,e.sibling=null,e.tag===5&&(t=e.stateNode,t!==null&&(delete t[Zn],delete t[so],delete t[sd],delete t[Ty],delete t[Ry])),e.stateNode=null,e.return=null,e.dependencies=null,e.memoizedProps=null,e.memoizedState=null,e.pendingProps=null,e.stateNode=null,e.updateQueue=null}function Px(e){return e.tag===5||e.tag===3||e.tag===4}function Vm(e){e:for(;;){for(;e.sibling===null;){if(e.return===null||Px(e.return))return null;e=e.return}for(e.sibling.return=e.return,e=e.sibling;e.tag!==5&&e.tag!==6&&e.tag!==18;){if(e.flags&2||e.child===null||e.tag===4)continue e;e.child.return=e,e=e.child}if(!(e.flags&2))return e.stateNode}}function yd(e,t,s){var r=e.tag;if(r===5||r===6)e=e.stateNode,t?s.nodeType===8?s.parentNode.insertBefore(e,t):s.insertBefore(e,t):(s.nodeType===8?(t=s.parentNode,t.insertBefore(e,s)):(t=s,t.appendChild(e)),s=s._reactRootContainer,s!=null||t.onclick!==null||(t.onclick=Dl));else if(r!==4&&(e=e.child,e!==null))for(yd(e,t,s),e=e.sibling;e!==null;)yd(e,t,s),e=e.sibling}function Nd(e,t,s){var r=e.tag;if(r===5||r===6)e=e.stateNode,t?s.insertBefore(e,t):s.appendChild(e);else if(r!==4&&(e=e.child,e!==null))for(Nd(e,t,s),e=e.sibling;e!==null;)Nd(e,t,s),e=e.sibling}var Ht=null,Un=!1;function Rs(e,t,s){for(s=s.child;s!==null;)Fx(e,t,s),s=s.sibling}function Fx(e,t,s){if(ss&&typeof ss.onCommitFiberUnmount=="function")try{ss.onCommitFiberUnmount(li,s)}catch{}switch(s.tag){case 5:Xt||Hr(s,t);case 6:var r=Ht,a=Un;Ht=null,Rs(e,t,s),Ht=r,Un=a,Ht!==null&&(Un?(e=Ht,s=s.stateNode,e.nodeType===8?e.parentNode.removeChild(s):e.removeChild(s)):Ht.removeChild(s.stateNode));break;case 18:Ht!==null&&(Un?(e=Ht,s=s.stateNode,e.nodeType===8?lc(e.parentNode,s):e.nodeType===1&&lc(e,s),Qa(e)):lc(Ht,s.stateNode));break;case 4:r=Ht,a=Un,Ht=s.stateNode.containerInfo,Un=!0,Rs(e,t,s),Ht=r,Un=a;break;case 0:case 11:case 14:case 15:if(!Xt&&(r=s.updateQueue,r!==null&&(r=r.lastEffect,r!==null))){a=r=r.next;do{var o=a,l=o.destroy;o=o.tag,l!==void 0&&(o&2||o&4)&&hd(s,t,l),a=a.next}while(a!==r)}Rs(e,t,s);break;case 1:if(!Xt&&(Hr(s,t),r=s.stateNode,typeof r.componentWillUnmount=="function"))try{r.props=s.memoizedProps,r.state=s.memoizedState,r.componentWillUnmount()}catch(i){jt(s,t,i)}Rs(e,t,s);break;case 21:Rs(e,t,s);break;case 22:s.mode&1?(Xt=(r=Xt)||s.memoizedState!==null,Rs(e,t,s),Xt=r):Rs(e,t,s);break;default:Rs(e,t,s)}}function Km(e){var t=e.updateQueue;if(t!==null){e.updateQueue=null;var s=e.stateNode;s===null&&(s=e.stateNode=new Ky),t.forEach(function(r){var a=n0.bind(null,e,r);s.has(r)||(s.add(r),r.then(a,a))})}}function $n(e,t){var s=t.deletions;if(s!==null)for(var r=0;r<s.length;r++){var a=s[r];try{var o=e,l=t,i=l;e:for(;i!==null;){switch(i.tag){case 5:Ht=i.stateNode,Un=!1;break e;case 3:Ht=i.stateNode.containerInfo,Un=!0;break e;case 4:Ht=i.stateNode.containerInfo,Un=!0;break e}i=i.return}if(Ht===null)throw Error(de(160));Fx(o,l,a),Ht=null,Un=!1;var c=a.alternate;c!==null&&(c.return=null),a.return=null}catch(m){jt(a,t,m)}}if(t.subtreeFlags&12854)for(t=t.child;t!==null;)Bx(t,e),t=t.sibling}function Bx(e,t){var s=e.alternate,r=e.flags;switch(e.tag){case 0:case 11:case 14:case 15:if($n(t,e),qn(e),r&4){try{Ua(3,e,e.return),xi(3,e)}catch(I){jt(e,e.return,I)}try{Ua(5,e,e.return)}catch(I){jt(e,e.return,I)}}break;case 1:$n(t,e),qn(e),r&512&&s!==null&&Hr(s,s.return);break;case 5:if($n(t,e),qn(e),r&512&&s!==null&&Hr(s,s.return),e.flags&32){var a=e.stateNode;try{Ga(a,"")}catch(I){jt(e,e.return,I)}}if(r&4&&(a=e.stateNode,a!=null)){var o=e.memoizedProps,l=s!==null?s.memoizedProps:o,i=e.type,c=e.updateQueue;if(e.updateQueue=null,c!==null)try{i==="input"&&o.type==="radio"&&o.name!=null&&of(a,o),Wc(i,l);var m=Wc(i,o);for(l=0;l<c.length;l+=2){var p=c[l],h=c[l+1];p==="style"?mf(a,h):p==="dangerouslySetInnerHTML"?df(a,h):p==="children"?Ga(a,h):Md(a,p,h,m)}switch(i){case"input":Fc(a,o);break;case"textarea":lf(a,o);break;case"select":var v=a._wrapperState.wasMultiple;a._wrapperState.wasMultiple=!!o.multiple;var A=o.value;A!=null?Wr(a,!!o.multiple,A,!1):v!==!!o.multiple&&(o.defaultValue!=null?Wr(a,!!o.multiple,o.defaultValue,!0):Wr(a,!!o.multiple,o.multiple?[]:"",!1))}a[so]=o}catch(I){jt(e,e.return,I)}}break;case 6:if($n(t,e),qn(e),r&4){if(e.stateNode===null)throw Error(de(162));a=e.stateNode,o=e.memoizedProps;try{a.nodeValue=o}catch(I){jt(e,e.return,I)}}break;case 3:if($n(t,e),qn(e),r&4&&s!==null&&s.memoizedState.isDehydrated)try{Qa(t.containerInfo)}catch(I){jt(e,e.return,I)}break;case 4:$n(t,e),qn(e);break;case 13:$n(t,e),qn(e),a=e.child,a.flags&8192&&(o=a.memoizedState!==null,a.stateNode.isHidden=o,!o||a.alternate!==null&&a.alternate.memoizedState!==null||(xu=kt())),r&4&&Km(e);break;case 22:if(p=s!==null&&s.memoizedState!==null,e.mode&1?(Xt=(m=Xt)||p,$n(t,e),Xt=m):$n(t,e),qn(e),r&8192){if(m=e.memoizedState!==null,(e.stateNode.isHidden=m)&&!p&&e.mode&1)for(ke=e,p=e.child;p!==null;){for(h=ke=p;ke!==null;){switch(v=ke,A=v.child,v.tag){case 0:case 11:case 14:case 15:Ua(4,v,v.return);break;case 1:Hr(v,v.return);var D=v.stateNode;if(typeof D.componentWillUnmount=="function"){r=v,s=v.return;try{t=r,D.props=t.memoizedProps,D.state=t.memoizedState,D.componentWillUnmount()}catch(I){jt(r,s,I)}}break;case 5:Hr(v,v.return);break;case 22:if(v.memoizedState!==null){Gm(h);continue}}A!==null?(A.return=v,ke=A):Gm(h)}p=p.sibling}e:for(p=null,h=e;;){if(h.tag===5){if(p===null){p=h;try{a=h.stateNode,m?(o=a.style,typeof o.setProperty=="function"?o.setProperty("display","none","important"):o.display="none"):(i=h.stateNode,c=h.memoizedProps.style,l=c!=null&&c.hasOwnProperty("display")?c.display:null,i.style.display=uf("display",l))}catch(I){jt(e,e.return,I)}}}else if(h.tag===6){if(p===null)try{h.stateNode.nodeValue=m?"":h.memoizedProps}catch(I){jt(e,e.return,I)}}else if((h.tag!==22&&h.tag!==23||h.memoizedState===null||h===e)&&h.child!==null){h.child.return=h,h=h.child;continue}if(h===e)break e;for(;h.sibling===null;){if(h.return===null||h.return===e)break e;p===h&&(p=null),h=h.return}p===h&&(p=null),h.sibling.return=h.return,h=h.sibling}}break;case 19:$n(t,e),qn(e),r&4&&Km(e);break;case 21:break;default:$n(t,e),qn(e)}}function qn(e){var t=e.flags;if(t&2){try{e:{for(var s=e.return;s!==null;){if(Px(s)){var r=s;break e}s=s.return}throw Error(de(160))}switch(r.tag){case 5:var a=r.stateNode;r.flags&32&&(Ga(a,""),r.flags&=-33);var o=Vm(e);Nd(e,o,a);break;case 3:case 4:var l=r.stateNode.containerInfo,i=Vm(e);yd(e,i,l);break;default:throw Error(de(161))}}catch(c){jt(e,e.return,c)}e.flags&=-3}t&4096&&(e.flags&=-4097)}function Gy(e,t,s){ke=e,$x(e)}function $x(e,t,s){for(var r=(e.mode&1)!==0;ke!==null;){var a=ke,o=a.child;if(a.tag===22&&r){var l=a.memoizedState!==null||el;if(!l){var i=a.alternate,c=i!==null&&i.memoizedState!==null||Xt;i=el;var m=Xt;if(el=l,(Xt=c)&&!m)for(ke=a;ke!==null;)l=ke,c=l.child,l.tag===22&&l.memoizedState!==null?qm(a):c!==null?(c.return=l,ke=c):qm(a);for(;o!==null;)ke=o,$x(o),o=o.sibling;ke=a,el=i,Xt=m}Ym(e)}else a.subtreeFlags&8772&&o!==null?(o.return=a,ke=o):Ym(e)}}function Ym(e){for(;ke!==null;){var t=ke;if(t.flags&8772){var s=t.alternate;try{if(t.flags&8772)switch(t.tag){case 0:case 11:case 15:Xt||xi(5,t);break;case 1:var r=t.stateNode;if(t.flags&4&&!Xt)if(s===null)r.componentDidMount();else{var a=t.elementType===t.type?s.memoizedProps:Hn(t.type,s.memoizedProps);r.componentDidUpdate(a,s.memoizedState,r.__reactInternalSnapshotBeforeUpdate)}var o=t.updateQueue;o!==null&&Cm(t,o,r);break;case 3:var l=t.updateQueue;if(l!==null){if(s=null,t.child!==null)switch(t.child.tag){case 5:s=t.child.stateNode;break;case 1:s=t.child.stateNode}Cm(t,l,s)}break;case 5:var i=t.stateNode;if(s===null&&t.flags&4){s=i;var c=t.memoizedProps;switch(t.type){case"button":case"input":case"select":case"textarea":c.autoFocus&&s.focus();break;case"img":c.src&&(s.src=c.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(t.memoizedState===null){var m=t.alternate;if(m!==null){var p=m.memoizedState;if(p!==null){var h=p.dehydrated;h!==null&&Qa(h)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(de(163))}Xt||t.flags&512&&gd(t)}catch(v){jt(t,t.return,v)}}if(t===e){ke=null;break}if(s=t.sibling,s!==null){s.return=t.return,ke=s;break}ke=t.return}}function Gm(e){for(;ke!==null;){var t=ke;if(t===e){ke=null;break}var s=t.sibling;if(s!==null){s.return=t.return,ke=s;break}ke=t.return}}function qm(e){for(;ke!==null;){var t=ke;try{switch(t.tag){case 0:case 11:case 15:var s=t.return;try{xi(4,t)}catch(c){jt(t,s,c)}break;case 1:var r=t.stateNode;if(typeof r.componentDidMount=="function"){var a=t.return;try{r.componentDidMount()}catch(c){jt(t,a,c)}}var o=t.return;try{gd(t)}catch(c){jt(t,o,c)}break;case 5:var l=t.return;try{gd(t)}catch(c){jt(t,l,c)}}}catch(c){jt(t,t.return,c)}if(t===e){ke=null;break}var i=t.sibling;if(i!==null){i.return=t.return,ke=i;break}ke=t.return}}var qy=Math.ceil,Wl=Ss.ReactCurrentDispatcher,pu=Ss.ReactCurrentOwner,Ln=Ss.ReactCurrentBatchConfig,st=0,Bt=null,Tt=null,Wt=0,fn=0,Ur=Qs(0),Ot=0,co=null,gr=0,hi=0,fu=0,Wa=null,rn=null,xu=0,na=1/0,cs=null,zl=!1,bd=null,Ks=null,tl=!1,Bs=null,Vl=0,za=0,vd=null,bl=-1,vl=0;function tn(){return st&6?kt():bl!==-1?bl:bl=kt()}function Ys(e){return e.mode&1?st&2&&Wt!==0?Wt&-Wt:Dy.transition!==null?(vl===0&&(vl=jf()),vl):(e=at,e!==0||(e=window.event,e=e===void 0?16:Cf(e.type)),e):1}function Vn(e,t,s,r){if(50<za)throw za=0,vd=null,Error(de(185));So(e,s,r),(!(st&2)||e!==Bt)&&(e===Bt&&(!(st&2)&&(hi|=s),Ot===4&&Ms(e,Wt)),cn(e,r),s===1&&st===0&&!(t.mode&1)&&(na=kt()+500,mi&&Zs()))}function cn(e,t){var s=e.callbackNode;Dg(e,t);var r=Il(e,e===Bt?Wt:0);if(r===0)s!==null&&rm(s),e.callbackNode=null,e.callbackPriority=0;else if(t=r&-r,e.callbackPriority!==t){if(s!=null&&rm(s),t===1)e.tag===0?Cy(Xm.bind(null,e)):Xf(Xm.bind(null,e)),Ay(function(){!(st&6)&&Zs()}),s=null;else{switch(Ef(r)){case 1:s=Hd;break;case 4:s=Sf;break;case 16:s=Al;break;case 536870912:s=wf;break;default:s=Al}s=Gx(s,Hx.bind(null,e))}e.callbackPriority=t,e.callbackNode=s}}function Hx(e,t){if(bl=-1,vl=0,st&6)throw Error(de(327));var s=e.callbackNode;if(Gr()&&e.callbackNode!==s)return null;var r=Il(e,e===Bt?Wt:0);if(r===0)return null;if(r&30||r&e.expiredLanes||t)t=Kl(e,r);else{t=r;var a=st;st|=2;var o=Wx();(Bt!==e||Wt!==t)&&(cs=null,na=kt()+500,ur(e,t));do try{Qy();break}catch(i){Ux(e,i)}while(!0);eu(),Wl.current=o,st=a,Tt!==null?t=0:(Bt=null,Wt=0,t=Ot)}if(t!==0){if(t===2&&(a=Gc(e),a!==0&&(r=a,t=Sd(e,a))),t===1)throw s=co,ur(e,0),Ms(e,r),cn(e,kt()),s;if(t===6)Ms(e,r);else{if(a=e.current.alternate,!(r&30)&&!Xy(a)&&(t=Kl(e,r),t===2&&(o=Gc(e),o!==0&&(r=o,t=Sd(e,o))),t===1))throw s=co,ur(e,0),Ms(e,r),cn(e,kt()),s;switch(e.finishedWork=a,e.finishedLanes=r,t){case 0:case 1:throw Error(de(345));case 2:ar(e,rn,cs);break;case 3:if(Ms(e,r),(r&130023424)===r&&(t=xu+500-kt(),10<t)){if(Il(e,0)!==0)break;if(a=e.suspendedLanes,(a&r)!==r){tn(),e.pingedLanes|=e.suspendedLanes&a;break}e.timeoutHandle=nd(ar.bind(null,e,rn,cs),t);break}ar(e,rn,cs);break;case 4:if(Ms(e,r),(r&4194240)===r)break;for(t=e.eventTimes,a=-1;0<r;){var l=31-zn(r);o=1<<l,l=t[l],l>a&&(a=l),r&=~o}if(r=a,r=kt()-r,r=(120>r?120:480>r?480:1080>r?1080:1920>r?1920:3e3>r?3e3:4320>r?4320:1960*qy(r/1960))-r,10<r){e.timeoutHandle=nd(ar.bind(null,e,rn,cs),r);break}ar(e,rn,cs);break;case 5:ar(e,rn,cs);break;default:throw Error(de(329))}}}return cn(e,kt()),e.callbackNode===s?Hx.bind(null,e):null}function Sd(e,t){var s=Wa;return e.current.memoizedState.isDehydrated&&(ur(e,t).flags|=256),e=Kl(e,t),e!==2&&(t=rn,rn=s,t!==null&&wd(t)),e}function wd(e){rn===null?rn=e:rn.push.apply(rn,e)}function Xy(e){for(var t=e;;){if(t.flags&16384){var s=t.updateQueue;if(s!==null&&(s=s.stores,s!==null))for(var r=0;r<s.length;r++){var a=s[r],o=a.getSnapshot;a=a.value;try{if(!Yn(o(),a))return!1}catch{return!1}}}if(s=t.child,t.subtreeFlags&16384&&s!==null)s.return=t,t=s;else{if(t===e)break;for(;t.sibling===null;){if(t.return===null||t.return===e)return!0;t=t.return}t.sibling.return=t.return,t=t.sibling}}return!0}function Ms(e,t){for(t&=~fu,t&=~hi,e.suspendedLanes|=t,e.pingedLanes&=~t,e=e.expirationTimes;0<t;){var s=31-zn(t),r=1<<s;e[s]=-1,t&=~r}}function Xm(e){if(st&6)throw Error(de(327));Gr();var t=Il(e,0);if(!(t&1))return cn(e,kt()),null;var s=Kl(e,t);if(e.tag!==0&&s===2){var r=Gc(e);r!==0&&(t=r,s=Sd(e,r))}if(s===1)throw s=co,ur(e,0),Ms(e,t),cn(e,kt()),s;if(s===6)throw Error(de(345));return e.finishedWork=e.current.alternate,e.finishedLanes=t,ar(e,rn,cs),cn(e,kt()),null}function hu(e,t){var s=st;st|=1;try{return e(t)}finally{st=s,st===0&&(na=kt()+500,mi&&Zs())}}function yr(e){Bs!==null&&Bs.tag===0&&!(st&6)&&Gr();var t=st;st|=1;var s=Ln.transition,r=at;try{if(Ln.transition=null,at=1,e)return e()}finally{at=r,Ln.transition=s,st=t,!(st&6)&&Zs()}}function gu(){fn=Ur.current,xt(Ur)}function ur(e,t){e.finishedWork=null,e.finishedLanes=0;var s=e.timeoutHandle;if(s!==-1&&(e.timeoutHandle=-1,ky(s)),Tt!==null)for(s=Tt.return;s!==null;){var r=s;switch(Jd(r),r.tag){case 1:r=r.type.childContextTypes,r!=null&&Ll();break;case 3:ea(),xt(on),xt(Qt),ou();break;case 5:au(r);break;case 4:ea();break;case 13:xt(bt);break;case 19:xt(bt);break;case 10:tu(r.type._context);break;case 22:case 23:gu()}s=s.return}if(Bt=e,Tt=e=Gs(e.current,null),Wt=fn=t,Ot=0,co=null,fu=hi=gr=0,rn=Wa=null,cr!==null){for(t=0;t<cr.length;t++)if(s=cr[t],r=s.interleaved,r!==null){s.interleaved=null;var a=r.next,o=s.pending;if(o!==null){var l=o.next;o.next=a,r.next=l}s.pending=r}cr=null}return e}function Ux(e,t){do{var s=Tt;try{if(eu(),gl.current=Ul,Hl){for(var r=vt.memoizedState;r!==null;){var a=r.queue;a!==null&&(a.pending=null),r=r.next}Hl=!1}if(hr=0,Ft=Lt=vt=null,Ha=!1,oo=0,pu.current=null,s===null||s.return===null){Ot=1,co=t,Tt=null;break}e:{var o=e,l=s.return,i=s,c=t;if(t=Wt,i.flags|=32768,c!==null&&typeof c=="object"&&typeof c.then=="function"){var m=c,p=i,h=p.tag;if(!(p.mode&1)&&(h===0||h===11||h===15)){var v=p.alternate;v?(p.updateQueue=v.updateQueue,p.memoizedState=v.memoizedState,p.lanes=v.lanes):(p.updateQueue=null,p.memoizedState=null)}var A=Pm(l);if(A!==null){A.flags&=-257,Fm(A,l,i,o,t),A.mode&1&&Mm(o,m,t),t=A,c=m;var D=t.updateQueue;if(D===null){var I=new Set;I.add(c),t.updateQueue=I}else D.add(c);break e}else{if(!(t&1)){Mm(o,m,t),yu();break e}c=Error(de(426))}}else if(yt&&i.mode&1){var W=Pm(l);if(W!==null){!(W.flags&65536)&&(W.flags|=256),Fm(W,l,i,o,t),Qd(ta(c,i));break e}}o=c=ta(c,i),Ot!==4&&(Ot=2),Wa===null?Wa=[o]:Wa.push(o),o=l;do{switch(o.tag){case 3:o.flags|=65536,t&=-t,o.lanes|=t;var N=Ex(o,c,t);Rm(o,N);break e;case 1:i=c;var x=o.type,b=o.stateNode;if(!(o.flags&128)&&(typeof x.getDerivedStateFromError=="function"||b!==null&&typeof b.componentDidCatch=="function"&&(Ks===null||!Ks.has(b)))){o.flags|=65536,t&=-t,o.lanes|=t;var B=kx(o,i,t);Rm(o,B);break e}}o=o.return}while(o!==null)}Vx(s)}catch(H){t=H,Tt===s&&s!==null&&(Tt=s=s.return);continue}break}while(!0)}function Wx(){var e=Wl.current;return Wl.current=Ul,e===null?Ul:e}function yu(){(Ot===0||Ot===3||Ot===2)&&(Ot=4),Bt===null||!(gr&268435455)&&!(hi&268435455)||Ms(Bt,Wt)}function Kl(e,t){var s=st;st|=2;var r=Wx();(Bt!==e||Wt!==t)&&(cs=null,ur(e,t));do try{Jy();break}catch(a){Ux(e,a)}while(!0);if(eu(),st=s,Wl.current=r,Tt!==null)throw Error(de(261));return Bt=null,Wt=0,Ot}function Jy(){for(;Tt!==null;)zx(Tt)}function Qy(){for(;Tt!==null&&!wg();)zx(Tt)}function zx(e){var t=Yx(e.alternate,e,fn);e.memoizedProps=e.pendingProps,t===null?Vx(e):Tt=t,pu.current=null}function Vx(e){var t=e;do{var s=t.alternate;if(e=t.return,t.flags&32768){if(s=Vy(s,t),s!==null){s.flags&=32767,Tt=s;return}if(e!==null)e.flags|=32768,e.subtreeFlags=0,e.deletions=null;else{Ot=6,Tt=null;return}}else if(s=zy(s,t,fn),s!==null){Tt=s;return}if(t=t.sibling,t!==null){Tt=t;return}Tt=t=e}while(t!==null);Ot===0&&(Ot=5)}function ar(e,t,s){var r=at,a=Ln.transition;try{Ln.transition=null,at=1,Zy(e,t,s,r)}finally{Ln.transition=a,at=r}return null}function Zy(e,t,s,r){do Gr();while(Bs!==null);if(st&6)throw Error(de(327));s=e.finishedWork;var a=e.finishedLanes;if(s===null)return null;if(e.finishedWork=null,e.finishedLanes=0,s===e.current)throw Error(de(177));e.callbackNode=null,e.callbackPriority=0;var o=s.lanes|s.childLanes;if(Lg(e,o),e===Bt&&(Tt=Bt=null,Wt=0),!(s.subtreeFlags&2064)&&!(s.flags&2064)||tl||(tl=!0,Gx(Al,function(){return Gr(),null})),o=(s.flags&15990)!==0,s.subtreeFlags&15990||o){o=Ln.transition,Ln.transition=null;var l=at;at=1;var i=st;st|=4,pu.current=null,Yy(e,s),Bx(s,e),Ny(ed),Tl=!!Zc,ed=Zc=null,e.current=s,Gy(s),jg(),st=i,at=l,Ln.transition=o}else e.current=s;if(tl&&(tl=!1,Bs=e,Vl=a),o=e.pendingLanes,o===0&&(Ks=null),Ag(s.stateNode),cn(e,kt()),t!==null)for(r=e.onRecoverableError,s=0;s<t.length;s++)a=t[s],r(a.value,{componentStack:a.stack,digest:a.digest});if(zl)throw zl=!1,e=bd,bd=null,e;return Vl&1&&e.tag!==0&&Gr(),o=e.pendingLanes,o&1?e===vd?za++:(za=0,vd=e):za=0,Zs(),null}function Gr(){if(Bs!==null){var e=Ef(Vl),t=Ln.transition,s=at;try{if(Ln.transition=null,at=16>e?16:e,Bs===null)var r=!1;else{if(e=Bs,Bs=null,Vl=0,st&6)throw Error(de(331));var a=st;for(st|=4,ke=e.current;ke!==null;){var o=ke,l=o.child;if(ke.flags&16){var i=o.deletions;if(i!==null){for(var c=0;c<i.length;c++){var m=i[c];for(ke=m;ke!==null;){var p=ke;switch(p.tag){case 0:case 11:case 15:Ua(8,p,o)}var h=p.child;if(h!==null)h.return=p,ke=h;else for(;ke!==null;){p=ke;var v=p.sibling,A=p.return;if(Mx(p),p===m){ke=null;break}if(v!==null){v.return=A,ke=v;break}ke=A}}}var D=o.alternate;if(D!==null){var I=D.child;if(I!==null){D.child=null;do{var W=I.sibling;I.sibling=null,I=W}while(I!==null)}}ke=o}}if(o.subtreeFlags&2064&&l!==null)l.return=o,ke=l;else e:for(;ke!==null;){if(o=ke,o.flags&2048)switch(o.tag){case 0:case 11:case 15:Ua(9,o,o.return)}var N=o.sibling;if(N!==null){N.return=o.return,ke=N;break e}ke=o.return}}var x=e.current;for(ke=x;ke!==null;){l=ke;var b=l.child;if(l.subtreeFlags&2064&&b!==null)b.return=l,ke=b;else e:for(l=x;ke!==null;){if(i=ke,i.flags&2048)try{switch(i.tag){case 0:case 11:case 15:xi(9,i)}}catch(H){jt(i,i.return,H)}if(i===l){ke=null;break e}var B=i.sibling;if(B!==null){B.return=i.return,ke=B;break e}ke=i.return}}if(st=a,Zs(),ss&&typeof ss.onPostCommitFiberRoot=="function")try{ss.onPostCommitFiberRoot(li,e)}catch{}r=!0}return r}finally{at=s,Ln.transition=t}}return!1}function Jm(e,t,s){t=ta(s,t),t=Ex(e,t,1),e=Vs(e,t,1),t=tn(),e!==null&&(So(e,1,t),cn(e,t))}function jt(e,t,s){if(e.tag===3)Jm(e,e,s);else for(;t!==null;){if(t.tag===3){Jm(t,e,s);break}else if(t.tag===1){var r=t.stateNode;if(typeof t.type.getDerivedStateFromError=="function"||typeof r.componentDidCatch=="function"&&(Ks===null||!Ks.has(r))){e=ta(s,e),e=kx(t,e,1),t=Vs(t,e,1),e=tn(),t!==null&&(So(t,1,e),cn(t,e));break}}t=t.return}}function e0(e,t,s){var r=e.pingCache;r!==null&&r.delete(t),t=tn(),e.pingedLanes|=e.suspendedLanes&s,Bt===e&&(Wt&s)===s&&(Ot===4||Ot===3&&(Wt&130023424)===Wt&&500>kt()-xu?ur(e,0):fu|=s),cn(e,t)}function Kx(e,t){t===0&&(e.mode&1?(t=Vo,Vo<<=1,!(Vo&130023424)&&(Vo=4194304)):t=1);var s=tn();e=bs(e,t),e!==null&&(So(e,t,s),cn(e,s))}function t0(e){var t=e.memoizedState,s=0;t!==null&&(s=t.retryLane),Kx(e,s)}function n0(e,t){var s=0;switch(e.tag){case 13:var r=e.stateNode,a=e.memoizedState;a!==null&&(s=a.retryLane);break;case 19:r=e.stateNode;break;default:throw Error(de(314))}r!==null&&r.delete(t),Kx(e,s)}var Yx;Yx=function(e,t,s){if(e!==null)if(e.memoizedProps!==t.pendingProps||on.current)an=!0;else{if(!(e.lanes&s)&&!(t.flags&128))return an=!1,Wy(e,t,s);an=!!(e.flags&131072)}else an=!1,yt&&t.flags&1048576&&Jf(t,Ml,t.index);switch(t.lanes=0,t.tag){case 2:var r=t.type;Nl(e,t),e=t.pendingProps;var a=Jr(t,Qt.current);Yr(t,s),a=iu(null,t,r,e,a,s);var o=cu();return t.flags|=1,typeof a=="object"&&a!==null&&typeof a.render=="function"&&a.$$typeof===void 0?(t.tag=1,t.memoizedState=null,t.updateQueue=null,ln(r)?(o=!0,_l(t)):o=!1,t.memoizedState=a.state!==null&&a.state!==void 0?a.state:null,su(t),a.updater=fi,t.stateNode=a,a._reactInternals=t,cd(t,r,e,s),t=md(null,t,r,!0,o,s)):(t.tag=0,yt&&o&&Xd(t),en(null,t,a,s),t=t.child),t;case 16:r=t.elementType;e:{switch(Nl(e,t),e=t.pendingProps,a=r._init,r=a(r._payload),t.type=r,a=t.tag=r0(r),e=Hn(r,e),a){case 0:t=ud(null,t,r,e,s);break e;case 1:t=Hm(null,t,r,e,s);break e;case 11:t=Bm(null,t,r,e,s);break e;case 14:t=$m(null,t,r,Hn(r.type,e),s);break e}throw Error(de(306,r,""))}return t;case 0:return r=t.type,a=t.pendingProps,a=t.elementType===r?a:Hn(r,a),ud(e,t,r,a,s);case 1:return r=t.type,a=t.pendingProps,a=t.elementType===r?a:Hn(r,a),Hm(e,t,r,a,s);case 3:e:{if(Rx(t),e===null)throw Error(de(387));r=t.pendingProps,o=t.memoizedState,a=o.element,sx(e,t),Bl(t,r,null,s);var l=t.memoizedState;if(r=l.element,o.isDehydrated)if(o={element:r,isDehydrated:!1,cache:l.cache,pendingSuspenseBoundaries:l.pendingSuspenseBoundaries,transitions:l.transitions},t.updateQueue.baseState=o,t.memoizedState=o,t.flags&256){a=ta(Error(de(423)),t),t=Um(e,t,r,s,a);break e}else if(r!==a){a=ta(Error(de(424)),t),t=Um(e,t,r,s,a);break e}else for(hn=zs(t.stateNode.containerInfo.firstChild),gn=t,yt=!0,Wn=null,s=tx(t,null,r,s),t.child=s;s;)s.flags=s.flags&-3|4096,s=s.sibling;else{if(Qr(),r===a){t=vs(e,t,s);break e}en(e,t,r,s)}t=t.child}return t;case 5:return rx(t),e===null&&od(t),r=t.type,a=t.pendingProps,o=e!==null?e.memoizedProps:null,l=a.children,td(r,a)?l=null:o!==null&&td(r,o)&&(t.flags|=32),Tx(e,t),en(e,t,l,s),t.child;case 6:return e===null&&od(t),null;case 13:return Cx(e,t,s);case 4:return ru(t,t.stateNode.containerInfo),r=t.pendingProps,e===null?t.child=Zr(t,null,r,s):en(e,t,r,s),t.child;case 11:return r=t.type,a=t.pendingProps,a=t.elementType===r?a:Hn(r,a),Bm(e,t,r,a,s);case 7:return en(e,t,t.pendingProps,s),t.child;case 8:return en(e,t,t.pendingProps.children,s),t.child;case 12:return en(e,t,t.pendingProps.children,s),t.child;case 10:e:{if(r=t.type._context,a=t.pendingProps,o=t.memoizedProps,l=a.value,dt(Pl,r._currentValue),r._currentValue=l,o!==null)if(Yn(o.value,l)){if(o.children===a.children&&!on.current){t=vs(e,t,s);break e}}else for(o=t.child,o!==null&&(o.return=t);o!==null;){var i=o.dependencies;if(i!==null){l=o.child;for(var c=i.firstContext;c!==null;){if(c.context===r){if(o.tag===1){c=xs(-1,s&-s),c.tag=2;var m=o.updateQueue;if(m!==null){m=m.shared;var p=m.pending;p===null?c.next=c:(c.next=p.next,p.next=c),m.pending=c}}o.lanes|=s,c=o.alternate,c!==null&&(c.lanes|=s),ld(o.return,s,t),i.lanes|=s;break}c=c.next}}else if(o.tag===10)l=o.type===t.type?null:o.child;else if(o.tag===18){if(l=o.return,l===null)throw Error(de(341));l.lanes|=s,i=l.alternate,i!==null&&(i.lanes|=s),ld(l,s,t),l=o.sibling}else l=o.child;if(l!==null)l.return=o;else for(l=o;l!==null;){if(l===t){l=null;break}if(o=l.sibling,o!==null){o.return=l.return,l=o;break}l=l.return}o=l}en(e,t,a.children,s),t=t.child}return t;case 9:return a=t.type,r=t.pendingProps.children,Yr(t,s),a=On(a),r=r(a),t.flags|=1,en(e,t,r,s),t.child;case 14:return r=t.type,a=Hn(r,t.pendingProps),a=Hn(r.type,a),$m(e,t,r,a,s);case 15:return Ax(e,t,t.type,t.pendingProps,s);case 17:return r=t.type,a=t.pendingProps,a=t.elementType===r?a:Hn(r,a),Nl(e,t),t.tag=1,ln(r)?(e=!0,_l(t)):e=!1,Yr(t,s),jx(t,r,a),cd(t,r,a,s),md(null,t,r,!0,e,s);case 19:return Dx(e,t,s);case 22:return Ix(e,t,s)}throw Error(de(156,t.tag))};function Gx(e,t){return vf(e,t)}function s0(e,t,s,r){this.tag=e,this.key=s,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=t,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=r,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Dn(e,t,s,r){return new s0(e,t,s,r)}function Nu(e){return e=e.prototype,!(!e||!e.isReactComponent)}function r0(e){if(typeof e=="function")return Nu(e)?1:0;if(e!=null){if(e=e.$$typeof,e===Fd)return 11;if(e===Bd)return 14}return 2}function Gs(e,t){var s=e.alternate;return s===null?(s=Dn(e.tag,t,e.key,e.mode),s.elementType=e.elementType,s.type=e.type,s.stateNode=e.stateNode,s.alternate=e,e.alternate=s):(s.pendingProps=t,s.type=e.type,s.flags=0,s.subtreeFlags=0,s.deletions=null),s.flags=e.flags&14680064,s.childLanes=e.childLanes,s.lanes=e.lanes,s.child=e.child,s.memoizedProps=e.memoizedProps,s.memoizedState=e.memoizedState,s.updateQueue=e.updateQueue,t=e.dependencies,s.dependencies=t===null?null:{lanes:t.lanes,firstContext:t.firstContext},s.sibling=e.sibling,s.index=e.index,s.ref=e.ref,s}function Sl(e,t,s,r,a,o){var l=2;if(r=e,typeof e=="function")Nu(e)&&(l=1);else if(typeof e=="string")l=5;else e:switch(e){case Dr:return mr(s.children,a,o,t);case Pd:l=8,a|=8;break;case Lc:return e=Dn(12,s,t,a|2),e.elementType=Lc,e.lanes=o,e;case _c:return e=Dn(13,s,t,a),e.elementType=_c,e.lanes=o,e;case Oc:return e=Dn(19,s,t,a),e.elementType=Oc,e.lanes=o,e;case sf:return gi(s,a,o,t);default:if(typeof e=="object"&&e!==null)switch(e.$$typeof){case tf:l=10;break e;case nf:l=9;break e;case Fd:l=11;break e;case Bd:l=14;break e;case Cs:l=16,r=null;break e}throw Error(de(130,e==null?e:typeof e,""))}return t=Dn(l,s,t,a),t.elementType=e,t.type=r,t.lanes=o,t}function mr(e,t,s,r){return e=Dn(7,e,r,t),e.lanes=s,e}function gi(e,t,s,r){return e=Dn(22,e,r,t),e.elementType=sf,e.lanes=s,e.stateNode={isHidden:!1},e}function xc(e,t,s){return e=Dn(6,e,null,t),e.lanes=s,e}function hc(e,t,s){return t=Dn(4,e.children!==null?e.children:[],e.key,t),t.lanes=s,t.stateNode={containerInfo:e.containerInfo,pendingChildren:null,implementation:e.implementation},t}function a0(e,t,s,r,a){this.tag=t,this.containerInfo=e,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=Xi(0),this.expirationTimes=Xi(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=Xi(0),this.identifierPrefix=r,this.onRecoverableError=a,this.mutableSourceEagerHydrationData=null}function bu(e,t,s,r,a,o,l,i,c){return e=new a0(e,t,s,i,c),t===1?(t=1,o===!0&&(t|=8)):t=0,o=Dn(3,null,null,t),e.current=o,o.stateNode=e,o.memoizedState={element:r,isDehydrated:s,cache:null,transitions:null,pendingSuspenseBoundaries:null},su(o),e}function o0(e,t,s){var r=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:Cr,key:r==null?null:""+r,children:e,containerInfo:t,implementation:s}}function qx(e){if(!e)return Xs;e=e._reactInternals;e:{if(vr(e)!==e||e.tag!==1)throw Error(de(170));var t=e;do{switch(t.tag){case 3:t=t.stateNode.context;break e;case 1:if(ln(t.type)){t=t.stateNode.__reactInternalMemoizedMergedChildContext;break e}}t=t.return}while(t!==null);throw Error(de(171))}if(e.tag===1){var s=e.type;if(ln(s))return qf(e,s,t)}return t}function Xx(e,t,s,r,a,o,l,i,c){return e=bu(s,r,!0,e,a,o,l,i,c),e.context=qx(null),s=e.current,r=tn(),a=Ys(s),o=xs(r,a),o.callback=t??null,Vs(s,o,a),e.current.lanes=a,So(e,a,r),cn(e,r),e}function yi(e,t,s,r){var a=t.current,o=tn(),l=Ys(a);return s=qx(s),t.context===null?t.context=s:t.pendingContext=s,t=xs(o,l),t.payload={element:e},r=r===void 0?null:r,r!==null&&(t.callback=r),e=Vs(a,t,l),e!==null&&(Vn(e,a,l,o),hl(e,a,l)),l}function Yl(e){if(e=e.current,!e.child)return null;switch(e.child.tag){case 5:return e.child.stateNode;default:return e.child.stateNode}}function Qm(e,t){if(e=e.memoizedState,e!==null&&e.dehydrated!==null){var s=e.retryLane;e.retryLane=s!==0&&s<t?s:t}}function vu(e,t){Qm(e,t),(e=e.alternate)&&Qm(e,t)}function l0(){return null}var Jx=typeof reportError=="function"?reportError:function(e){console.error(e)};function Su(e){this._internalRoot=e}Ni.prototype.render=Su.prototype.render=function(e){var t=this._internalRoot;if(t===null)throw Error(de(409));yi(e,t,null,null)};Ni.prototype.unmount=Su.prototype.unmount=function(){var e=this._internalRoot;if(e!==null){this._internalRoot=null;var t=e.containerInfo;yr(function(){yi(null,e,null,null)}),t[Ns]=null}};function Ni(e){this._internalRoot=e}Ni.prototype.unstable_scheduleHydration=function(e){if(e){var t=If();e={blockedOn:null,target:e,priority:t};for(var s=0;s<Os.length&&t!==0&&t<Os[s].priority;s++);Os.splice(s,0,e),s===0&&Rf(e)}};function wu(e){return!(!e||e.nodeType!==1&&e.nodeType!==9&&e.nodeType!==11)}function bi(e){return!(!e||e.nodeType!==1&&e.nodeType!==9&&e.nodeType!==11&&(e.nodeType!==8||e.nodeValue!==" react-mount-point-unstable "))}function Zm(){}function i0(e,t,s,r,a){if(a){if(typeof r=="function"){var o=r;r=function(){var m=Yl(l);o.call(m)}}var l=Xx(t,r,e,0,null,!1,!1,"",Zm);return e._reactRootContainer=l,e[Ns]=l.current,to(e.nodeType===8?e.parentNode:e),yr(),l}for(;a=e.lastChild;)e.removeChild(a);if(typeof r=="function"){var i=r;r=function(){var m=Yl(c);i.call(m)}}var c=bu(e,0,!1,null,null,!1,!1,"",Zm);return e._reactRootContainer=c,e[Ns]=c.current,to(e.nodeType===8?e.parentNode:e),yr(function(){yi(t,c,s,r)}),c}function vi(e,t,s,r,a){var o=s._reactRootContainer;if(o){var l=o;if(typeof a=="function"){var i=a;a=function(){var c=Yl(l);i.call(c)}}yi(t,l,e,a)}else l=i0(s,t,e,a,r);return Yl(l)}kf=function(e){switch(e.tag){case 3:var t=e.stateNode;if(t.current.memoizedState.isDehydrated){var s=_a(t.pendingLanes);s!==0&&(Ud(t,s|1),cn(t,kt()),!(st&6)&&(na=kt()+500,Zs()))}break;case 13:yr(function(){var r=bs(e,1);if(r!==null){var a=tn();Vn(r,e,1,a)}}),vu(e,1)}};Wd=function(e){if(e.tag===13){var t=bs(e,134217728);if(t!==null){var s=tn();Vn(t,e,134217728,s)}vu(e,134217728)}};Af=function(e){if(e.tag===13){var t=Ys(e),s=bs(e,t);if(s!==null){var r=tn();Vn(s,e,t,r)}vu(e,t)}};If=function(){return at};Tf=function(e,t){var s=at;try{return at=e,t()}finally{at=s}};Vc=function(e,t,s){switch(t){case"input":if(Fc(e,s),t=s.name,s.type==="radio"&&t!=null){for(s=e;s.parentNode;)s=s.parentNode;for(s=s.querySelectorAll("input[name="+JSON.stringify(""+t)+'][type="radio"]'),t=0;t<s.length;t++){var r=s[t];if(r!==e&&r.form===e.form){var a=ui(r);if(!a)throw Error(de(90));af(r),Fc(r,a)}}}break;case"textarea":lf(e,s);break;case"select":t=s.value,t!=null&&Wr(e,!!s.multiple,t,!1)}};xf=hu;hf=yr;var c0={usingClientEntryPoint:!1,Events:[jo,Mr,ui,pf,ff,hu]},Ia={findFiberByHostInstance:ir,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},d0={bundleType:Ia.bundleType,version:Ia.version,rendererPackageName:Ia.rendererPackageName,rendererConfig:Ia.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:Ss.ReactCurrentDispatcher,findHostInstanceByFiber:function(e){return e=Nf(e),e===null?null:e.stateNode},findFiberByHostInstance:Ia.findFiberByHostInstance||l0,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var nl=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!nl.isDisabled&&nl.supportsFiber)try{li=nl.inject(d0),ss=nl}catch{}}Nn.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=c0;Nn.createPortal=function(e,t){var s=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!wu(t))throw Error(de(200));return o0(e,t,null,s)};Nn.createRoot=function(e,t){if(!wu(e))throw Error(de(299));var s=!1,r="",a=Jx;return t!=null&&(t.unstable_strictMode===!0&&(s=!0),t.identifierPrefix!==void 0&&(r=t.identifierPrefix),t.onRecoverableError!==void 0&&(a=t.onRecoverableError)),t=bu(e,1,!1,null,null,s,!1,r,a),e[Ns]=t.current,to(e.nodeType===8?e.parentNode:e),new Su(t)};Nn.findDOMNode=function(e){if(e==null)return null;if(e.nodeType===1)return e;var t=e._reactInternals;if(t===void 0)throw typeof e.render=="function"?Error(de(188)):(e=Object.keys(e).join(","),Error(de(268,e)));return e=Nf(t),e=e===null?null:e.stateNode,e};Nn.flushSync=function(e){return yr(e)};Nn.hydrate=function(e,t,s){if(!bi(t))throw Error(de(200));return vi(null,e,t,!0,s)};Nn.hydrateRoot=function(e,t,s){if(!wu(e))throw Error(de(405));var r=s!=null&&s.hydratedSources||null,a=!1,o="",l=Jx;if(s!=null&&(s.unstable_strictMode===!0&&(a=!0),s.identifierPrefix!==void 0&&(o=s.identifierPrefix),s.onRecoverableError!==void 0&&(l=s.onRecoverableError)),t=Xx(t,null,e,1,s??null,a,!1,o,l),e[Ns]=t.current,to(e),r)for(e=0;e<r.length;e++)s=r[e],a=s._getVersion,a=a(s._source),t.mutableSourceEagerHydrationData==null?t.mutableSourceEagerHydrationData=[s,a]:t.mutableSourceEagerHydrationData.push(s,a);return new Ni(t)};Nn.render=function(e,t,s){if(!bi(t))throw Error(de(200));return vi(null,e,t,!1,s)};Nn.unmountComponentAtNode=function(e){if(!bi(e))throw Error(de(40));return e._reactRootContainer?(yr(function(){vi(null,null,e,!1,function(){e._reactRootContainer=null,e[Ns]=null})}),!0):!1};Nn.unstable_batchedUpdates=hu;Nn.unstable_renderSubtreeIntoContainer=function(e,t,s,r){if(!bi(s))throw Error(de(200));if(e==null||e._reactInternals===void 0)throw Error(de(38));return vi(e,t,s,!1,r)};Nn.version="18.3.1-next-f1338f8080-20240426";function Qx(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(Qx)}catch(e){console.error(e)}}Qx(),Jp.exports=Nn;var u0=Jp.exports,ep=u0;Cc.createRoot=ep.createRoot,Cc.hydrateRoot=ep.hydrateRoot;/**
 * @license
 * (c) Copyright 2023 Grammarly, Inc.
 * 
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 * 
 *     http://www.apache.org/licenses/LICENSE-2.0
 * 
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function sl(e,t,s){return t in e?Object.defineProperty(e,t,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[t]=s,e}var tp=new Map;class uo extends Error{constructor(t,s){super(),sl(this,"args",void 0),sl(this,"code",void 0),sl(this,"url",void 0),sl(this,"_c",void 0);var r=new URL("https://developer.grammarly.com/docs/error-explainer");r.searchParams.set("code",t.toString()),s.forEach(a=>r.searchParams.append("args",function(o){if(o instanceof Error)return o.message+`
`+String(o.stack);if(o==null)return"null";if(typeof o=="object")try{return Object.prototype.toString.call(o)}catch{}return String(o)}(a))),this.stack!=null&&r.searchParams.set("trace",this.stack),this.message="Minified error #".concat(t,": See ").concat(r.toString()," for details."),this.args=s,this.code=t,this.url=r.toString()}toUserMessage(){var t=tp.get("".concat(this.code));if(t==null)return[this];var s=new Map(this.args.map((a,o)=>["${".concat(o,"}"),a])),r=t.split(/(\${\d+})/).filter(a=>a!=="");return r.map(a=>{var o;return(o=s.get(a))!==null&&o!==void 0?o:a})}toJSON(){return{name:"InvariantError",message:this.message,description:this._m,code:this.code,args:this.args,stack:this.stack}}static setMessages(t){tp=t}static create(t,s,r,a){a!=null&&s.push(a);var o=new uo(t,s,r);return o.stack=a==null?void 0:a.stack,o._m=r,o}}const np=new WeakMap;async function m0(e,t){const s=np.get(e);if(s!=null)return await s;(function(a){a.Grammarly==null&&(a.Grammarly={})})(e);const r=new Promise((a,o)=>{try{let i=function(c,m){return c.document.querySelectorAll(`script[src^="${m.replace(/\?.*$/,"")}"]`)[0]}(e,t);i!=null?l():(i=function(c,m){const p=c.document.createElement("script");return p.src=m,c.document.head.appendChild(p),p}(e,t),i.addEventListener("load",l),i.addEventListener("error",function(){try{throw new uo(23,[])}catch(c){o(c)}}))}catch(i){return o(i)}function l(){try{if(e.Grammarly==null||typeof e.Grammarly.EditorSDK!="function")throw new uo(22,[]);a(e.Grammarly)}catch(i){o(i)}}});return np.set(e,r),await r}async function sp(e,t,s,r){if(typeof window>"u"&&r===void 0)throw new uo(21,[]);const a=function(i){return i.location.origin!=="null"?i.location.origin:i.origin!=="null"?i.origin:"null"}(r??window);a==="null"&&(r??window).top!==(r??window)&&console.warn("Grammarly is not supported in IFrames with `null` origin. Consider adding `sandbox='allow-same-origin allow-scripts'` to <iframe> element.");const o=new URL("https://js.grammarly.com/grammarly-editor-sdk@2.5",a);t!=null&&o.searchParams.set("clientId",t),o.searchParams.set("packageName",e);const l=await m0(r??window,o.toString());if(t!=null)return new l.EditorSDK(t,s)}const gc={onBeforeSuggestionCardOpen:"before-suggestion-card-open",onSuggestionCardOpen:"suggestion-card-open",onSuggestionCardClose:"suggestion-card-close",onSuggestionCardAction:"suggestion-card-action",onPluginTurnedOff:"plugin-turned-off",onPluginError:"plugin-error",onDocumentStats:"document-stats",onSessionStats:"session-stats"};/**
 * @license
 * (c) Copyright 2023 Grammarly, Inc.
 * 
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 * 
 *     http://www.apache.org/licenses/LICENSE-2.0
 * 
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const p0=oi.createContext({});function f0(e,t,s){const r=y.useCallback(a=>e==null?void 0:e(new CustomEvent("plugin-error",{detail:a})),[e]);y.useEffect(()=>{var a;typeof navigator<"u"&&(t!=null&&((a=s==null?void 0:s.current)===null||a===void 0?void 0:a.ownerDocument.defaultView)!=null&&window!==s.current.ownerDocument.defaultView?sp("@grammarly/editor-sdk-react",t,void 0,s.current.ownerDocument.defaultView).catch(r):sp("@grammarly/editor-sdk-react").catch(r))},s!=null&&t!=null?[s,t]:[])}function rp(e){return typeof e=="function"}const mo=e=>{const[t,{clientId:s,config:r,children:a,className:o,...l}]=function(I){const W={},N={...I};return Object.keys(gc).forEach(x=>{W[x]=I[x],x in N&&delete N[x]}),[W,N]}(e),i=y.useContext(p0),c=y.useRef(),m=y.useRef(),p=y.useRef(),h=y.useCallback(I=>{c.current=I,A()},[]),v=function(I){const[W,N]=y.useState({}),x=y.useCallback(()=>{customElements.whenDefined(I).then(()=>N(b=>({...b,[I]:!0}))).catch(()=>{})},[I]);return y.useEffect(x,[x]),!!W[I]}("grammarly-editor-plugin"),A=y.useCallback(()=>{var I;c.current!=null&&m.current!=null&&v&&c.current.connect(m.current,(I=p.current)!==null&&I!==void 0?I:void 0)},[v]),D=y.useMemo(()=>({...i.config,...r}),[i.config,r]);return y.useEffect(()=>{c.current&&(c.current.config=D)},[c,D]),y.useEffect(()=>{if(c.current==null)return;const{current:I}=c,W=[];return Object.keys(gc).forEach(N=>{const x=t[N],b=gc[N];x!=null&&(I.addEventListener(b,x),W.push(()=>I.removeEventListener(b,x)))}),()=>W.forEach(N=>N())},[...Object.values(t),v,c.current]),f0(e.onPluginError,s??i.clientId,c),oi.createElement("grammarly-editor-plugin",{...l,ref:h,clientId:s??i.clientId,autodetect:rp(a)?"off":"on",class:o},rp(a)?a({setEditor:I=>{m.current=I,A()},setViewport:I=>{p.current=I,A()}}):a)};/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */var x0={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const h0=e=>e.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase().trim(),Ge=(e,t)=>{const s=y.forwardRef(({color:r="currentColor",size:a=24,strokeWidth:o=2,absoluteStrokeWidth:l,className:i="",children:c,...m},p)=>y.createElement("svg",{ref:p,...x0,width:a,height:a,stroke:r,strokeWidth:l?Number(o)*24/Number(a):o,className:["lucide",`lucide-${h0(e)}`,i].join(" "),...m},[...t.map(([h,v])=>y.createElement(h,v)),...Array.isArray(c)?c:[c]]));return s.displayName=`${e}`,s};/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Va=Ge("AlertTriangle",[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3Z",key:"c3ski4"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Zx=Ge("ArrowRight",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"m12 5 7 7-7 7",key:"xquz4c"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Gl=Ge("Bell",[["path",{d:"M6 8a6 6 0 0 1 12 0c0 7 3 9 3 9H3s3-2 3-9",key:"1qo2s2"}],["path",{d:"M10.3 21a1.94 1.94 0 0 0 3.4 0",key:"qgo35s"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const g0=Ge("Calculator",[["rect",{width:"16",height:"20",x:"4",y:"2",rx:"2",key:"1nb95v"}],["line",{x1:"8",x2:"16",y1:"6",y2:"6",key:"x4nwl0"}],["line",{x1:"16",x2:"16",y1:"14",y2:"18",key:"wjye3r"}],["path",{d:"M16 10h.01",key:"1m94wz"}],["path",{d:"M12 10h.01",key:"1nrarc"}],["path",{d:"M8 10h.01",key:"19clt8"}],["path",{d:"M12 14h.01",key:"1etili"}],["path",{d:"M8 14h.01",key:"6423bh"}],["path",{d:"M12 18h.01",key:"mhygvu"}],["path",{d:"M8 18h.01",key:"lrp35t"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const y0=Ge("Calendar",[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const eh=Ge("Check",[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const N0=Ge("ChevronDown",[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ql=Ge("ChevronLeft",[["path",{d:"m15 18-6-6 6-6",key:"1wnfg3"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const es=Ge("ChevronRight",[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const b0=Ge("ChevronUp",[["path",{d:"m18 15-6-6-6 6",key:"153udz"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const v0=Ge("Clock",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polyline",{points:"12 6 12 12 16 14",key:"68esgv"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const S0=Ge("FilePlus2",[["path",{d:"M4 22h14a2 2 0 0 0 2-2V7l-5-5H6a2 2 0 0 0-2 2v4",key:"1pf5j1"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M3 15h6",key:"4e2qda"}],["path",{d:"M6 12v6",key:"1u72j0"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const w0=Ge("FileSpreadsheet",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M8 13h2",key:"yr2amv"}],["path",{d:"M14 13h2",key:"un5t4a"}],["path",{d:"M8 17h2",key:"2yhykz"}],["path",{d:"M14 17h2",key:"10kma7"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const po=Ge("FileText",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M10 9H8",key:"b1mrlr"}],["path",{d:"M16 13H8",key:"t4e002"}],["path",{d:"M16 17H8",key:"z1uh3a"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const th=Ge("FolderOpen",[["path",{d:"m6 14 1.5-2.9A2 2 0 0 1 9.24 10H20a2 2 0 0 1 1.94 2.5l-1.54 6a2 2 0 0 1-1.95 1.5H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h3.9a2 2 0 0 1 1.69.9l.81 1.2a2 2 0 0 0 1.67.9H18a2 2 0 0 1 2 2v2",key:"usdka0"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const j0=Ge("Globe",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 2a14.5 14.5 0 0 0 0 20 14.5 14.5 0 0 0 0-20",key:"13o1zl"}],["path",{d:"M2 12h20",key:"9i4pu4"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ju=Ge("HelpCircle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3",key:"1u773s"}],["path",{d:"M12 17h.01",key:"p32p05"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const nh=Ge("History",[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}],["path",{d:"M12 7v5l4 2",key:"1fdv2h"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Eu=Ge("Home",[["path",{d:"m3 9 9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z",key:"y5dka4"}],["polyline",{points:"9 22 9 12 15 12 15 22",key:"e2us08"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const E0=Ge("KeyRound",[["path",{d:"M2 18v3c0 .6.4 1 1 1h4v-3h3v-3h2l1.4-1.4a6.5 6.5 0 1 0-4-4Z",key:"167ctg"}],["circle",{cx:"16.5",cy:"7.5",r:".5",fill:"currentColor",key:"w0ekpg"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const sa=Ge("Lightbulb",[["path",{d:"M15 14c.2-1 .7-1.7 1.5-2.5 1-.9 1.5-2.2 1.5-3.5A6 6 0 0 0 6 8c0 1 .2 2.2 1.5 3.5.7.7 1.3 1.5 1.5 2.5",key:"1gvzjb"}],["path",{d:"M9 18h6",key:"x1upvd"}],["path",{d:"M10 22h4",key:"ceow96"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const k0=Ge("ListPlus",[["path",{d:"M11 12H3",key:"51ecnj"}],["path",{d:"M16 6H3",key:"1wxfjs"}],["path",{d:"M16 18H3",key:"12xzn7"}],["path",{d:"M18 9v6",key:"1twb98"}],["path",{d:"M21 12h-6",key:"bt1uis"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Mt=Ge("Loader2",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const sh=Ge("LogOut",[["path",{d:"M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4",key:"1uf3rs"}],["polyline",{points:"16 17 21 12 16 7",key:"1gabdz"}],["line",{x1:"21",x2:"9",y1:"12",y2:"12",key:"1uyos4"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ku=Ge("NotebookPen",[["path",{d:"M13.4 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2v-7.4",key:"re6nr2"}],["path",{d:"M2 6h4",key:"aawbzj"}],["path",{d:"M2 10h4",key:"l0bgd4"}],["path",{d:"M2 14h4",key:"1gsvsf"}],["path",{d:"M2 18h4",key:"1bu2t1"}],["path",{d:"M18.4 2.6a2.17 2.17 0 0 1 3 3L16 11l-4 1 1-4Z",key:"1dba1m"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const A0=Ge("Paperclip",[["path",{d:"m21.44 11.05-9.19 9.19a6 6 0 0 1-8.49-8.49l8.57-8.57A4 4 0 1 1 18 8.84l-8.59 8.57a2 2 0 0 1-2.83-2.83l8.49-8.48",key:"1u3ebp"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Au=Ge("Plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const rh=Ge("Receipt",[["path",{d:"M4 2v20l2-1 2 1 2-1 2 1 2-1 2 1 2-1 2 1V2l-2 1-2-1-2 1-2-1-2 1-2-1-2 1Z",key:"q3az6g"}],["path",{d:"M16 8h-6a2 2 0 1 0 0 4h4a2 2 0 1 1 0 4H8",key:"1h4pet"}],["path",{d:"M12 17.5v-11",key:"1jc1ny"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const I0=Ge("Search",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["path",{d:"m21 21-4.3-4.3",key:"1qie3q"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Xl=Ge("Send",[["path",{d:"m22 2-7 20-4-9-9-4Z",key:"1q3vgg"}],["path",{d:"M22 2 11 13",key:"nzbqef"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const T0=Ge("ShieldAlert",[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}],["path",{d:"M12 8v4",key:"1got3b"}],["path",{d:"M12 16h.01",key:"1drbdi"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const R0=Ge("Sparkles",[["path",{d:"m12 3-1.912 5.813a2 2 0 0 1-1.275 1.275L3 12l5.813 1.912a2 2 0 0 1 1.275 1.275L12 21l1.912-5.813a2 2 0 0 1 1.275-1.275L21 12l-5.813-1.912a2 2 0 0 1-1.275-1.275L12 3Z",key:"17u4zn"}],["path",{d:"M5 3v4",key:"bklmnn"}],["path",{d:"M19 17v4",key:"iiml17"}],["path",{d:"M3 5h4",key:"nem4j1"}],["path",{d:"M17 19h4",key:"lbex7p"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const C0=Ge("Star",[["polygon",{points:"12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2",key:"8f66p6"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ah=Ge("Table",[["path",{d:"M12 3v18",key:"108xh3"}],["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}],["path",{d:"M3 9h18",key:"1pudct"}],["path",{d:"M3 15h18",key:"5xshup"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ps=Ge("Trash2",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const fo=Ge("Upload",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"17 8 12 3 7 8",key:"t8dd8p"}],["line",{x1:"12",x2:"12",y1:"3",y2:"15",key:"widbto"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const D0=Ge("UserCheck",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["polyline",{points:"16 11 18 13 22 9",key:"1pwet4"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const L0=Ge("User",[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const _0=Ge("Wand2",[["path",{d:"m21.64 3.64-1.28-1.28a1.21 1.21 0 0 0-1.72 0L2.36 18.64a1.21 1.21 0 0 0 0 1.72l1.28 1.28a1.2 1.2 0 0 0 1.72 0L21.64 5.36a1.2 1.2 0 0 0 0-1.72Z",key:"1bcowg"}],["path",{d:"m14 7 3 3",key:"1r5n42"}],["path",{d:"M5 6v4",key:"ilb8ba"}],["path",{d:"M19 14v4",key:"blhpug"}],["path",{d:"M10 2v2",key:"7u0qdc"}],["path",{d:"M7 8H3",key:"zfb6yr"}],["path",{d:"M21 16h-4",key:"1cnmox"}],["path",{d:"M11 3H9",key:"1obp7u"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const _t=Ge("X",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]]),oh=["The facts outlined in the statement of claim","Statement of Claim  Factual Summary"],$s="Factual background  Statement of Claim",lh=["Factual Summary from the Letter of Demand"],ko="Factual background  Letter of Demand",Iu="The plaintiff's expert opinion",Tu="The claimant's expert opinion",hs=[{id:"u1",username:"lior",password:"lior123",name:"Lior Perry",email:"lior@lp-law.co.il",role:"ADMIN"},{id:"u2",username:"lidor",password:"lidor123",name:"Lidor Kabilo",email:"Lidor@lp-law.co.il",role:"SUB_ADMIN"},{id:"u3",username:"iris",password:"iris123",name:"Iris Alfman",email:"Iris@lp-law.co.il",role:"FINANCE"},{id:"u4",username:"hava",password:"hava123",name:"Hava Kabilo",email:"Hava@lp-law.co.il",role:"LAWYER"},{id:"u5",username:"may",password:"may123",name:"May Harari",email:"May@lp-law.co.il",role:"LAWYER"},{id:"u6",username:"vlada",password:"vlada123",name:"Vlada Boltach",email:"Vlada@lp-law.co.il",role:"LAWYER"},{id:"u7",username:"orly",password:"orly123",name:"Orly Day",email:"Orly@lp-law.co.il",role:"LAWYER"}],ap=["W/R/B Underwriting","QBE Insurance Group","Market Form Underwriting","Dale Underwriting Partners","MedPro & CNA Syndicate","Hardy (Underwriting Agencies) Limited"],Rr=[$s,ko,Iu,Tu,"The insured's expert opinion","Insurance Coverage","Risk Assessment","MPL","Strategy","Expenses breakdown","Expenses & Compensation breakdown","Recommendations","Strategy & Recommendations","Request for Approval of a Settlement Agreement"],ih=["New lawsuit","Letter of demand","New third-party notice","Caution Notice"],xo="/api/templates",ho=async e=>{if(!e.ok){const s=await e.text().catch(()=>"");throw new Error(s||`Request failed with status ${e.status}`)}const t=await e.json();return Array.isArray(t)?t:[]},op=async()=>{const e=await fetch(xo);return ho(e)},lp=async(e,t)=>{const s={"Content-Type":"application/json","x-user-role":t};if(!e.id){const a=await fetch(xo,{method:"POST",headers:s,body:JSON.stringify(e)});return ho(a)}const r=await fetch(`${xo}/${encodeURIComponent(e.id)}`,{method:"PUT",headers:s,body:JSON.stringify(e)});return ho(r)},O0=async(e,t)=>{const s=await fetch(`${xo}/${encodeURIComponent(e)}`,{method:"DELETE",headers:{"x-user-role":t}});return ho(s)},M0=async(e,t,s)=>{const r=await fetch(`${xo}/${encodeURIComponent(e)}/reorder`,{method:"POST",headers:{"Content-Type":"application/json","x-user-role":s},body:JSON.stringify({direction:t})});return ho(r)},P0=async e=>{if(!e||!e.trim())return"";try{const t=await fetch("/api/translate",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({text:e})});if(!t.ok)throw new Error(`Server error: ${t.statusText}`);return(await t.json()).translation||""}catch(t){return console.error("Translation error:",t),"Error translation."}},F0=async(e,t)=>{try{const s=await fetch("/api/extract-policy",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({image:e,mimeType:t})});if(!s.ok)throw new Error("Server error");return await s.json()}catch(s){return console.error(s),{}}},B0=async(e,t="SAFE_POLISH")=>{try{const s=await fetch("/api/refine-text",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({text:e,mode:t})}),r=await s.json().catch(()=>({}));if(s.status===422&&r&&r.error&&r.error.code==="FACT_PROTECTION_FAILED")return{text:typeof r.refined=="string"?r.refined:e,factProtectionBlocked:!0};if(!s.ok)throw new Error("Refinement failed");return{text:typeof r.refined=="string"&&r.refined.trim()?r.refined:e,factProtectionBlocked:!1}}catch(s){throw console.error("Hebrew refinement error:",s),s}},ch=async e=>{if(!e||!e.trim())return e;try{const t=await fetch("/api/improve-english",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({text:e})});if(!t.ok)throw new Error("English improvement failed");const s=await t.json(),r=typeof s.improved=="string"?s.improved:"";return r.trim()?r:e}catch(t){throw console.error("English improvement error:",t),t}},$0=async e=>{if(!e||!e.trim())return"";try{const t=await fetch("/api/hebrew-report-summary",{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({text:e})}),s=await t.json().catch(()=>({}));if(!t.ok){const a=s&&typeof s.error=="string"&&s.error||"Hebrew report summary failed";throw new Error(a)}return typeof s.summary=="string"&&s.summary.trim()?s.summary.trim():""}catch(t){throw console.error("Hebrew report summary error:",t),t instanceof Error?t:new Error("Hebrew report summary error")}},H0=async(e,t,s="CLAIM",r)=>{try{const a=await fetch("/api/analyze-medical-complaint",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({fileBase64:e,mimeType:t,analysisType:s,expertCountMode:r==null?void 0:r.expertCountMode,partyRole:r==null?void 0:r.partyRole,sectionKey:r==null?void 0:r.sectionKey,plaintiffName:r==null?void 0:r.plaintiffName,insuredName:r==null?void 0:r.insuredName,insurerName:r==null?void 0:r.insurerName,reportSubject:r==null?void 0:r.reportSubject})});if(!a.ok)throw new Error("Medical analysis failed");return await a.json()}catch(a){throw console.error("Medical complaint analysis error:",a),a}},U0=async(e,t)=>{try{const s=await fetch("/api/analyze-dental-opinion",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({fileBase64:e,mimeType:t})});if(!s.ok)throw new Error("Dental analysis failed");const r=await s.json();return typeof r.result=="string"?r.result:""}catch(s){throw console.error("Dental opinion analysis error:",s),s}},W0=async(e,t)=>{try{const s=await fetch("/api/extract-expenses",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({fileBase64:e,mimeType:t})});if(!s.ok)throw new Error("Expenses extraction failed");return await s.json()}catch(s){return console.error(s),{items:[]}}},z0=async e=>{try{const t=await fetch("/api/help-chat",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({question:e})});if(!t.ok)throw new Error("Chat failed");return(await t.json()).answer||"Sorry, I could not answer that."}catch(t){return console.error(t),"System error. Please try again."}},V0=async e=>{try{const t=await fetch("/api/assistant/help",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)}),s=await t.json().catch(()=>({}));t.ok||console.error("Assistant help HTTP error:",t.status,s);const r=typeof s.title=="string"&&s.title.trim()?s.title.trim():"    ",a=Array.isArray(s.bullets)?s.bullets.filter(i=>typeof i=="string"&&i.trim().length>0):["        -AI.","       (, ,  PDF).","  ,      ."],o=typeof s.warning=="string"&&s.warning.trim()?s.warning.trim():void 0,l=typeof s.nextSuggestion=="string"&&s.nextSuggestion.trim()?s.nextSuggestion.trim():void 0;return{title:r,bullets:a,warning:o,nextSuggestion:l}}catch(t){throw console.error("Assistant help error:",t),t}},ip=async e=>{try{if(!(await fetch("/api/send-email",{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify(e)})).ok)throw new Error("Email failed");return!0}catch(t){return console.error(t),!1}},yc=async e=>{try{const t=await fetch("/api/render-report-pdf",{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({report:e})});if(!t.ok)throw new Error("PDF rendering failed");return await t.blob()}catch(t){throw console.error("PDF render error:",t),t}};async function K0(e,t){try{const s=await fetch("/api/analyze-tone-risk",{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({content:e})});let r=null;try{r=await s.json()}catch{r=null}if(!s.ok){const p=r&&r.error&&typeof r.error.message=="string"?r.error.message:"Tone & Risk analysis failed";throw new Error(p)}const a=!!(r&&r.ok),o=r&&typeof r.runAt=="string"?r.runAt:new Date().toISOString(),l=Array.isArray(r==null?void 0:r.issues)?r.issues:[],i=r&&typeof r.promptVersion=="string"?r.promptVersion:"unknown",c=r&&typeof r.meta=="object"?{sectionsSent:Number(r.meta.sectionsSent)||0,charsBefore:Number(r.meta.charsBefore)||0,charsAfter:Number(r.meta.charsAfter)||0,truncatedSections:Number(r.meta.truncatedSections)||0}:{sectionsSent:0,charsBefore:0,charsAfter:0,truncatedSections:0},m=r&&typeof r.error=="object"?{code:r.error.code,message:r.error.message}:void 0;if(!a){const p=m&&typeof m.message=="string"&&m.message||"Tone & Risk analysis failed",h=new Error(p);throw h.code=(m==null?void 0:m.code)||"LLM_FAILED",h}return{ok:!0,runAt:o,promptVersion:i,issues:l,meta:c,error:void 0}}catch(s){throw console.error("Tone & Risk analysis error:",s),s instanceof Error?s:new Error("Tone & Risk analysis error")}}async function Y0(e,t){try{const s=await fetch("/api/review-hebrew-style",{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({content:e})});if(!s.ok)throw new Error("Hebrew style review failed");const r=await s.json(),a=Array.isArray(r.issues)?r.issues:[];return{runAt:typeof r.runAt=="string"?r.runAt:new Date().toISOString(),issues:a}}catch(s){throw console.error("Hebrew style review error:",s),s instanceof Error?s:new Error("Hebrew style review error")}}const ra="/api/best-practices",aa=async e=>{if(!e.ok){const s=await e.text().catch(()=>"");throw new Error(s||`Request failed with status ${e.status}`)}const t=await e.json();return Array.isArray(t)?t:[]},G0=async()=>{const e=await fetch(ra);return aa(e)},cp=async(e,t)=>{const s={"Content-Type":"application/json","x-user-role":t};if(!e.id){const a=await fetch(ra,{method:"POST",headers:s,body:JSON.stringify(e)});return aa(a)}const r=await fetch(`${ra}/${encodeURIComponent(e.id)}`,{method:"PUT",headers:s,body:JSON.stringify(e)});return aa(r)},q0=async(e,t)=>{const s=await fetch(`${ra}/${encodeURIComponent(e)}`,{method:"DELETE",headers:{"x-user-role":t}});return aa(s)},X0=async(e,t,s)=>{const r=await fetch(`${ra}/${encodeURIComponent(e)}`,{method:"PUT",headers:{"Content-Type":"application/json","x-user-role":s},body:JSON.stringify({isEnabled:t})});return aa(r)},dp=async(e,t,s)=>{const r=await fetch(`${ra}/${encodeURIComponent(e)}/usage`,{method:"POST",headers:{"Content-Type":"application/json","x-user-role":s},body:JSON.stringify({mode:t})});return aa(r)},Ru=e=>e===Iu,Cu=e=>e===Tu,up=e=>Ru(e)||Cu(e),J0=e=>Ru(e)||e===$s?"PLAINTIFF":Cu(e)||e===ko?"CLAIMANT":null,mp=(e,t="SINGLE")=>`${t==="MULTIPLE"?"Expert opinions":"Expert opinion"}  ${e==="PLAINTIFF"?"Statement of Claim":"Letter of Demand"}`,jd=(e,t)=>Ru(e)?mp("PLAINTIFF",t):Cu(e)?mp("CLAIMANT",t):e,Q0=({data:e})=>{const[t,s]=y.useState(""),[r,a]=y.useState(!1),[o,l]=y.useState(null);if(y.useEffect(()=>{let c=!1;return(async()=>{a(!0),l(null);try{const p=await fetch("/api/render-report-html",{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({report:e})});if(!p.ok)throw new Error("Failed to load report HTML");const h=await p.text();c||s(h)}catch(p){console.error(p),c||l("   ")}finally{c||a(!1)}})(),()=>{c=!0}},[e]),o)return n.jsx("div",{className:"w-[210mm] min-h-[297mm] bg-panel border border-borderDark shadow-2xl mx-auto flex items-center justify-center text-sm text-red-300",children:o});if(r&&!t)return n.jsx("div",{className:"w-[210mm] min-h-[297mm] bg-panel shadow-2xl mx-auto flex flex-col items-center justify-center text-sm text-textMuted",children:n.jsx("span",{children:"  ..."})});const i=!!e.policyFile&&(e.attachPolicyAsAppendix??!0);return n.jsxs("div",{className:"space-y-2",children:[n.jsx("iframe",{title:"Report Preview",className:"w-[210mm] min-h-[297mm] bg-panel shadow-2xl mx-auto border-none print:shadow-none print:w-full",srcDoc:t}),i&&n.jsx("p",{className:"w-[210mm] mx-auto text-[11px] text-textMuted text-right",children:"The policy file will be attached as Appendix A in the final PDF (not shown in this preview)."})]})},Z0=e=>{switch(e){case"HEBREW_SUBMITTED":return" ";case"HEBREW_CHANGES_REQUESTED":return" ";case"HEBREW_APPROVED":return" ";case"HEBREW_REOPENED_EXTERNAL":return"  ()";case"HEBREW_DRAFT":default:return" "}},eN=e=>{switch(e){case"SUBMITTED":return"  ";case"CHANGES_REQUESTED":return"  ";case"APPROVED":return"  ";case"DRAFT":default:return"  (  )"}},wl="report-review-panel",Ed="external-feedback-panel",tN=({report:e,currentUser:t,onSubmitToAdmin:s,onApproveHebrew:r,onRequestChanges:a,onMarkIssueDone:o,onAddExternalFeedbackIssues:l,onReopenHebrewDueToExternalFeedback:i})=>{const[c,m]=y.useState(!1),[p,h]=y.useState(""),[v,A]=y.useState(""),[D,I]=y.useState("NORMAL"),[W,N]=y.useState(""),[x,b]=y.useState("INTERNAL"),[B,H]=y.useState("ENGLISH_ONLY"),z=y.useMemo(()=>{const V=e.reportReview;return V||{status:"DRAFT",issues:[]}},[e.reportReview]),Y=y.useMemo(()=>{const V={};return z.issues.filter(_=>(_.origin??"INTERNAL")==="INTERNAL").forEach(_=>{const P=_.sectionKey||"GENERAL";V[P]||(V[P]=[]),V[P]=[...V[P],_]}),V},[z.issues]),Q=y.useMemo(()=>{const V={};return z.issues.filter(_=>_.origin==="EXTERNAL").forEach(_=>{const P=_.sectionKey||"GENERAL";V[P]||(V[P]=[]),V[P]=[...V[P],_]}),V},[z.issues]),G=(t==null?void 0:t.role)==="LAWYER",ae=(t==null?void 0:t.role)==="ADMIN",E=z.issues.some(V=>(V.origin??"INTERNAL")==="EXTERNAL"&&V.status!=="DONE"&&V.externalAction==="REQUIRES_HEBREW"),R=V=>{b(V),h(""),A(""),I("NORMAL"),N(""),H("ENGLISH_ONLY"),m(!0)},k=()=>{const V=p.trim(),_=v.trim();if(!V||!_)return;const P={title:V,instruction:_,severity:D,type:"OTHER",sectionKey:void 0,externalAction:x==="EXTERNAL"?B:void 0};x==="EXTERNAL"&&l?l([P],W.trim()||void 0):a([P]),m(!1)},C=eN(z.status),ee=Z0(e.hebrewWorkflowStatus);return n.jsxs("section",{id:wl,className:"mt-4 rounded-xl border border-borderDark bg-navySecondary px-4 py-3",dir:"rtl",lang:"he",children:[n.jsxs("div",{className:"mb-2 flex items-center justify-between gap-3",children:[n.jsxs("div",{children:[n.jsx("div",{className:"text-xs font-semibold text-textMuted500",children:" "}),n.jsx("div",{className:"text-sm font-medium text-textLight",children:C})]}),n.jsx("span",{className:"inline-flex items-center rounded-full bg-navySecondary px-3 py-1 text-xs font-medium text-textMuted700",children:ee})]}),G&&n.jsx("div",{className:"mb-3 text-xs text-amber-700",children:e.hebrewWorkflowStatus==="HEBREW_REOPENED_EXTERNAL"?"            .":z.status==="SUBMITTED"?"   .       .":z.status==="CHANGES_REQUESTED"?"   .      .":null}),ae&&E&&n.jsx("div",{className:"mb-3 text-xs font-semibold text-red-700",children:"      .    ."}),z.issues.length>0&&n.jsxs("div",{className:"mb-3 space-y-3",children:[Object.keys(Y).length>0&&n.jsxs("div",{children:[n.jsx("div",{className:"mb-1 text-xs font-semibold text-textMuted",children:"  ()"}),Object.entries(Y).map(([V,_])=>n.jsxs("div",{className:"rounded-lg bg-panel p-2 mb-1",children:[V!=="GENERAL"&&n.jsxs("div",{className:"mb-1 text-[11px] font-semibold text-textMuted500",children:[": ",V]}),n.jsx("ul",{className:"space-y-1",children:_.map(P=>n.jsxs("li",{className:"flex items-start justify-between gap-2 rounded-md border border-borderDark bg-navySecondary px-2 py-1.5",children:[n.jsxs("div",{children:[n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsx("span",{className:`inline-flex items-center rounded-full px-2 py-0.5 text-[10px] font-semibold ${P.severity==="CRITICAL"?"bg-red-100 text-red-700":P.severity==="NORMAL"?"bg-amber-50 text-amber-700":"bg-navySecondary text-textMuted"}`,children:P.severity==="CRITICAL"?"":P.severity==="NORMAL"?"":""}),n.jsx("span",{className:"text-xs font-medium text-textLight",children:P.title})]}),n.jsx("div",{className:"mt-1 text-[11px] text-textMuted700",children:P.instruction})]}),(G||ae)&&n.jsx("button",{type:"button",className:"mt-1 inline-flex items-center rounded-full border border-emerald-200 bg-emerald-50 px-2 py-0.5 text-[10px] font-medium text-emerald-700 hover:bg-emerald-100 disabled:opacity-50",disabled:P.status==="DONE",onClick:()=>o(P.id),children:P.status==="DONE"?"":" "})]},P.id))})]},V))]}),Object.keys(Q).length>0&&n.jsxs("div",{id:Ed,children:[n.jsx("div",{className:"mb-1 text-xs font-semibold text-textMuted",children:"  "}),Object.entries(Q).map(([V,_])=>n.jsxs("div",{className:"rounded-lg bg-panel p-2 mb-1",children:[V!=="GENERAL"&&n.jsxs("div",{className:"mb-1 text-[11px] font-semibold text-textMuted500",children:[": ",V]}),n.jsx("ul",{className:"space-y-1",children:_.map(P=>n.jsxs("li",{className:"flex items-start justify-between gap-2 rounded-md border border-borderDark bg-navySecondary px-2 py-1.5",children:[n.jsxs("div",{children:[n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsx("span",{className:`inline-flex items-center rounded-full px-2 py-0.5 text-[10px] font-semibold ${P.severity==="CRITICAL"?"bg-red-100 text-red-700":P.severity==="NORMAL"?"bg-amber-50 text-amber-700":"bg-navySecondary text-textMuted"}`,children:P.severity==="CRITICAL"?"":P.severity==="NORMAL"?"":""}),n.jsx("span",{className:"text-xs font-medium text-textLight",children:P.title})]}),n.jsx("div",{className:"mt-1 text-[11px] text-textMuted700",children:P.instruction})]}),(G||ae)&&n.jsx("button",{type:"button",className:"mt-1 inline-flex items-center rounded-full border border-emerald-200 bg-emerald-50 px-2 py-0.5 text-[10px] font-medium text-emerald-700 hover:bg-emerald-100 disabled:opacity-50",disabled:P.status==="DONE",onClick:()=>o(P.id),children:P.status==="DONE"?"":" "})]},P.id))})]},V))]})]}),n.jsxs("div",{className:"mt-3 flex flex-wrap items-center gap-2",children:[G&&n.jsx("button",{type:"button",className:"rounded-md bg-sky-700 px-3 py-1.5 text-xs font-semibold text-white hover:bg-sky-800 disabled:opacity-50",onClick:s,disabled:z.status==="SUBMITTED"||z.status==="APPROVED",children:"  "}),ae&&n.jsxs(n.Fragment,{children:[n.jsx("button",{type:"button",className:"rounded-md bg-emerald-700 px-3 py-1.5 text-xs font-semibold text-white hover:bg-emerald-800 disabled:opacity-50",onClick:r,children:"  "}),n.jsx("button",{type:"button",className:"rounded-md bg-amber-700 px-3 py-1.5 text-xs font-semibold text-white hover:bg-amber-800",onClick:()=>R("INTERNAL"),children:" "}),l&&n.jsx("button",{type:"button",className:"rounded-md bg-slate-700 px-3 py-1.5 text-xs font-semibold text-white hover:bg-slate-800",onClick:()=>R("EXTERNAL"),children:"   "}),i&&e.status==="SENT"&&n.jsx("button",{type:"button",className:"rounded-md bg-red-700 px-3 py-1.5 text-xs font-semibold text-white hover:bg-red-800",onClick:i,children:"   ( )"}),i&&e.status!=="SENT"&&n.jsx("span",{className:"text-[11px] text-textMuted500",children:"       (SENT)."})]})]}),c&&n.jsx("div",{className:"fixed inset-0 z-[180] flex items-center justify-center bg-black/40",children:n.jsxs("div",{className:"w-full max-w-md rounded-xl bg-panel p-4 shadow-2xl",dir:"rtl",lang:"he",children:[n.jsx("h3",{className:"mb-3 text-sm font-bold text-textLight",children:"   "}),n.jsxs("div",{className:"mb-3 space-y-2",children:[n.jsxs("div",{children:[n.jsx("label",{className:"mb-1 block text-xs font-semibold text-textMuted700",children:"  ()"}),n.jsx("input",{type:"text",className:"w-full rounded-md border border-borderDark px-2 py-1.5 text-sm",value:p,onChange:V=>h(V.target.value)})]}),n.jsxs("div",{children:[n.jsx("label",{className:"mb-1 block text-xs font-semibold text-textMuted700",children:"  ()"}),n.jsx("textarea",{className:"w-full rounded-md border border-borderDark px-2 py-1.5 text-sm",rows:3,value:v,onChange:V=>A(V.target.value)})]}),n.jsxs("div",{children:[n.jsx("label",{className:"mb-1 block text-xs font-semibold text-textMuted700",children:" "}),n.jsxs("select",{className:"w-full rounded-md border border-borderDark px-2 py-1.5 text-xs",value:D,onChange:V=>I(V.target.value),children:[n.jsx("option",{value:"NORMAL",children:""}),n.jsx("option",{value:"CRITICAL",children:""}),n.jsx("option",{value:"STYLE",children:""})]})]}),x==="EXTERNAL"&&n.jsxs("div",{children:[n.jsx("label",{className:"mb-1 block text-xs font-semibold text-textMuted700",children:"    ()"}),n.jsx("input",{type:"text",className:"w-full rounded-md border border-borderDark px-2 py-1.5 text-sm",value:W,onChange:V=>N(V.target.value)}),n.jsx("label",{className:"mb-1 mt-3 block text-xs font-semibold text-textMuted700",children:" "}),n.jsxs("select",{className:"w-full rounded-md border border-borderDark px-2 py-1.5 text-xs",value:B,onChange:V=>H(V.target.value),children:[n.jsx("option",{value:"ENGLISH_ONLY",children:"  "}),n.jsx("option",{value:"REQUIRES_HEBREW",children:"  "})]})]})]}),n.jsxs("div",{className:"mt-4 flex justify-end gap-2",children:[n.jsx("button",{type:"button",className:"rounded-md border border-borderDark px-3 py-1.5 text-xs font-medium text-textMuted700 hover:bg-navySecondary",onClick:()=>m(!1),children:""}),n.jsx("button",{type:"button",className:"rounded-md bg-amber-700 px-3 py-1.5 text-xs font-semibold text-white hover:bg-amber-800 disabled:opacity-50",onClick:k,disabled:!p.trim()||!v.trim(),children:" "})]})]})})]})},go="REPLACE_WITH_GRAMMARLY_CLIENT_ID",Du={[$s]:"Statement of Claim",[ko]:"Letter of Demand",[Iu]:"Statement of Claim Expert Opinion",[Tu]:"Letter of Demand Expert Opinion","The plaintiff's expert opinion":"Plaintiff Expert Opinion","The claimant's expert opinion":"Claimant Expert Opinion","The insured's expert opinion":"Insured Expert Opinion","Insurance Coverage":"Insurance Coverage","Risk Assessment":"Risk Assessment",MPL:"MPL",Strategy:"Strategy","Expenses breakdown":"Expenses Breakdown","Expenses & Compensation breakdown":"Expenses & Compensation",Recommendations:"Recommendations","Strategy & Recommendations":"Strategy & Recommendations","Request for Approval of a Settlement Agreement":"Settlement Approval",Update:"Update"};oh.forEach(e=>{Du[e]="Statement of Claim"});lh.forEach(e=>{Du[e]="Letter of Demand"});const nN=e=>(Du[e]||e||"").trim(),dh=e=>e.map(nN).filter(Boolean),kd=e=>{const t=new Set;return e.map(s=>s.trim()).filter(s=>{if(!s)return!1;const r=s.toLowerCase();return t.has(r)?!1:(t.add(r),!0)})},Lu=/[\\/:*?"<>|]/g,Nc=e=>(e||"").trim(),sN=e=>{const t=(e.filenameTag||"").toLowerCase(),s=(e.plaintiffTitle||"").toLowerCase();return t.includes("demand")||s==="claimant"},rN=e=>{var t;return(((t=e.reportHistory)==null?void 0:t.length)||0)+1},aN=120,oN=e=>{if(!e.length)return"";if(e.length===1)return e[0];if(e.length===2)return`${e[0]} & ${e[1]}`;const t=e.slice(0,-1),s=e[e.length-1];return`${t.join(", ")} & ${s}`},lr=e=>{const t=Nc(e.insurerName),s=Nc(e.insuredName),r=Nc(e.plaintiffName),a=rN(e);let o=[];const l=Array.isArray(e.fileNameTitles)?Jt(e.fileNameTitles.map(D=>Ut(D))):[];l.length>0?o=kd(l):a===1?o=[sN(e)?"New Letter of demand":"New Lawsuit"]:(o=kd(dh(e.selectedSections||[])),o.length||(o=["Update"]));const i=oN(o),c=`Report ${a}`;let p=[t||void 0,s||void 0,r||void 0,i||void 0].filter(Boolean).join(" - ");if(p=p.replace(Lu," ").replace(/\s+/g," ").replace(/-+/g,"-").trim(),!p){const D=c;return D.toLowerCase().endsWith(".pdf")?D:`${D}.pdf`}const h=` - ${c}`,v=Math.max(0,aN-h.length);if(p.length>v){const D=p.slice(0,v),I=D.lastIndexOf(" ");p=(I>0?D.slice(0,I):D).trim()}let A=`${p}${h}`;return A=A.replace(/\s+/g," ").replace(/-+/g,"-").trim(),A||(A=`Report-${Date.now()}`),A.toLowerCase().endsWith(".pdf")?A:`${A}.pdf`},Jl=e=>lr(e).replace(/\.pdf$/i,""),uh=e=>`fileNameTopics:${e||"default"}`,lN=["Update","Expenses","New Lawsuit","New Third Party Notice","New Letter of Demand","Risk Assessment","Strategy","Recommendation","Request for Settlement Approval","Judgment","Request to Reopen a Claim","Dismissal for Inaction"],Ut=e=>{const t=(e||"").trim();return t?t.replace(Lu," ").replace(/\s+/g," ").trim():""},Ql=e=>Ut(e).trim().toLowerCase(),Jt=e=>{const t=new Set,s=[];for(const r of e){const a=Ut(r),o=Ql(a);o&&(t.has(o)||(t.add(o),s.push(a)))}return s},iN=e=>{if(typeof window>"u")return[];try{const t=window.localStorage.getItem(uh(e));if(!t)return[];const s=JSON.parse(t);return Array.isArray(s)?Jt(s.map(r=>typeof r=="string"?r:"").map(Ut)):[]}catch{return[]}},cN=(e,t)=>{if(!(typeof window>"u"))try{const s=Jt(t.map(Ut)).filter(Boolean);window.localStorage.setItem(uh(e),JSON.stringify(s))}catch{}},dN=(e,t,s=15)=>{const r=Ut(t),a=Ql(r);if(!a)return Jt(e).slice(0,s);const o=(e||[]).filter(i=>Ql(i)!==a),l=[r,...o];return Jt(l).slice(0,s)},mh=e=>`topicCombos:${e||"default"}`,ph=e=>`insurerDefaultTopics:${e||"default"}`,fh=e=>{if(!e)return null;try{return JSON.parse(e)}catch{return null}},Ad=e=>{if(typeof window>"u")return[];const t=window.localStorage.getItem(mh(e)),s=fh(t);return Array.isArray(s)?s.filter(a=>Array.isArray(a)).map(a=>a.map(o=>Ut(o)).filter(Boolean)).filter(a=>a.length>0):[]},pp=(e,t)=>{if(typeof window>"u")return;const s=t.map(r=>Jt(r.map(a=>Ut(a))).filter(Boolean)).filter(r=>r.length>0);try{window.localStorage.setItem(mh(e),JSON.stringify(s))}catch{}},fp=e=>e.map(s=>Ql(s)).filter(Boolean).sort().join("|"),xp=(e,t,s=6)=>{const r=Jt(t.map(i=>Ut(i))).filter(Boolean);if(!r.length)return e;const a=fp(r),o=[],l=new Set;o.push(r),l.add(a);for(const i of e){const c=fp(i);if(!l.has(c)&&(o.push(Jt(i.map(m=>Ut(m))).filter(Boolean)),l.add(c),o.length>=s))break}return o.slice(0,s)},_u=e=>(e||"").trim().toLowerCase(),Ou=e=>{if(typeof window>"u")return{};const t=window.localStorage.getItem(ph(e)),s=fh(t);if(!s||typeof s!="object")return{};const r={};for(const[a,o]of Object.entries(s)){if(!Array.isArray(o))continue;const l=Jt(o.map(i=>Ut(i))).filter(Boolean).slice(0,8);l.length&&(r[a]=l)}return r},xh=(e,t)=>{if(typeof window>"u")return;const s={};for(const[r,a]of Object.entries(t)){const o=Jt((a||[]).map(l=>Ut(l))).filter(Boolean).slice(0,8);o.length&&(s[r]=o)}try{window.localStorage.setItem(ph(e),JSON.stringify(s))}catch{}},uN=(e,t)=>{const s=Ou(e),r=_u(t);return s[r]||[]},mN=(e,t,s)=>{if(!t)return;const r=_u(t),a=Ou(e),o=Jt(s.map(l=>Ut(l))).filter(Boolean).slice(0,8);o.length?a[r]=o:delete a[r],xh(e,a)},pN=(e,t)=>{if(!t)return;const s=_u(t),r=Ou(e);r[s]&&(delete r[s],xh(e,r))},hp=[{id:"general_update",label:"General Update",body:`Dear Sir/Madam,

Please find below our general update regarding the above-captioned matter.

Best regards,
Lior Perry, Adv.`},{id:"risk_assessment",label:"Risk Assessment",body:`Dear Sir/Madam,

Kindly review the following risk assessment prepared for the insurer.

Best regards,
Lior Perry, Adv.`},{id:"expert_opinion",label:"Expert Opinion",body:`Dear Sir/Madam,

Please find our expert opinion summary for your review and records.

Best regards,
Lior Perry, Adv.`},{id:"full_report",label:"Full Report Delivery",body:`Dear Sir/Madam,

Attached is the full report for the current update, including all relevant sections.

Best regards,
Lior Perry, Adv.`},{id:"zeev_new_demand",label:"Zeev  New demand letter",body:`Dear Zeev,

I've attached a report regarding a new demand letter.

Sincerely,
Lior`},{id:"zeev_claim_update",label:"Zeev  Claim update",body:`Dear Zeev,

I've attached a report on the claim in question.

Sincerely,
Lior`},{id:"zeev_new_lawsuit",label:"Zeev  New lawsuit",body:`Dear Zeev,

I've attached a report regarding a new lawsuit.

Sincerely,
Lior`},{id:"zeev_lawsuit_update",label:"Zeev  Lawsuit update",body:`Dear Zeev,

I've attached a report on the lawsuit in question.

Sincerely,
Lior`}],gp=e=>`emailTemplates:${e||"default"}`,fN=({isOpen:e,report:t,userId:s,isSending:r=!1,recipientsPreview:a,defaultSubject:o,subjectDraft:l,onSubjectDraftChange:i,selectedTopics:c,onSelectedTopicsChange:m,isResendMode:p,onClose:h,onSend:v})=>{const A=hp[0],[D,I]=y.useState(A.id),[W,N]=y.useState(A.body),[x,b]=y.useState([]),[B,H]=y.useState([]),[z,Y]=y.useState(l),[Q,G]=y.useState(""),[ae,E]=y.useState(""),[R,k]=y.useState([]),[C,ee]=y.useState([]),V=$=>{if(typeof window>"u")return[];try{const J=localStorage.getItem(gp($));if(!J)return[];const pe=JSON.parse(J);return Array.isArray(pe)?pe.filter(me=>typeof(me==null?void 0:me.id)=="string"&&typeof(me==null?void 0:me.label)=="string"&&typeof(me==null?void 0:me.body)=="string"):[]}catch{return[]}},_=$=>{typeof window>"u"||localStorage.setItem(gp(s),JSON.stringify($))},P=y.useMemo(()=>[...hp,...x],[x]),X=y.useMemo(()=>P.reduce(($,J)=>($[J.id]=J,$),{}),[P]);y.useEffect(()=>{if(!e)return;const $=V(s);b($);const J=iN(s);H(J),k(Ad(s)),ee(uN(s,t.insurerName)),Y(l),E(""),G("")},[e,s,l,t.insurerName]),y.useEffect(()=>{if(!e)return;const $=t.selectedEmailTemplate&&X[t.selectedEmailTemplate]?t.selectedEmailTemplate:A.id;I($),N(t.emailBodyDraft||X[$].body)},[e,A.id,t.emailBodyDraft,t.selectedEmailTemplate,X]);const ie=$=>{I($);const J=X[$];J&&N(J.body)},fe=()=>{const $=window.prompt("  ?");if(!$)return;const J=$.trim();if(!J)return;const pe={id:`custom_${Date.now()}`,label:J,body:W},me=[...x,pe];b(me),_(me),I(pe.id)},se=y.useMemo(()=>Jt([...B,...lN]),[B]),ue=y.useMemo(()=>{const $=ae.trim().toLowerCase();return $?se.filter(J=>J.toLowerCase().includes($)):se},[se,ae]),we=y.useMemo(()=>{if(!p)return null;const $=typeof t.reportNumber=="number"&&t.reportNumber>0?`#${t.reportNumber}`:"",J=t.sentAt?new Date(t.sentAt).toLocaleDateString("en-GB",{day:"2-digit",month:"short",year:"numeric"}):"";return n.jsxs("div",{className:"mb-3 flex items-start gap-2 rounded-md border border-amber-300 bg-amber-50 px-3 py-2 text-[11px] text-amber-900",children:[n.jsx(Va,{className:"w-3 h-3 mt-[2px]"}),n.jsxs("div",{children:[n.jsxs("p",{className:"font-semibold",children:["    ",$||"",J?`   ${J}`:"","."]}),n.jsx("p",{className:"mt-1",children:"   (resend)   ,    .       ."})]})]})},[p,t.reportNumber,t.sentAt]),He=$=>{const J=Ut($);if(!J)return;const pe=J.toLowerCase(),me=c.some(he=>he.trim().toLowerCase()===pe)?c.filter(he=>he.trim().toLowerCase()!==pe):[...c,J];m(Jt(me))},Ue=()=>{const $=Ut(Q);if(!$)return;const J=dN(B,$,15);H(J),cN(s,J);const pe=Jt([...c,$]);m(pe),G("")},Ze=y.useMemo(()=>lr({...t,fileNameTitles:c}),[t,c]),rt=!a.cc.some($=>$.toLowerCase()!=="reports@lp-law.co.il"),qe=a.to[0]||"",j=a.to.length===1&&qe.toLowerCase()==="lidor@lp-law.co.il";return e?n.jsx("div",{className:"fixed inset-0 bg-black/50 z-[999] flex items-center justify-center p-4",children:n.jsxs("div",{className:"bg-panel rounded-2xl shadow-2xl w-full max-w-3xl max-h-[90vh] overflow-hidden flex flex-col",children:[n.jsxs("div",{className:"flex items-center justify-between border-b px-6 py-4",children:[n.jsxs("div",{className:"flex items-center gap-3",children:[n.jsx("h2",{className:"text-lg font-semibold text-gray-800",children:"Compose Email"}),j&&n.jsx("span",{className:"inline-flex items-center rounded-full bg-blue-50 px-2.5 py-0.5 text-[11px] font-semibold text-blue-800 border border-blue-200",children:"SANDBOX"})]}),n.jsx("button",{onClick:h,className:"text-gray-500 hover:text-gray-700",children:n.jsx(_t,{className:"w-5 h-5"})})]}),n.jsxs("div",{className:"flex-1 overflow-y-auto px-6 py-4 space-y-4",children:[we,rt&&n.jsxs("div",{className:"flex items-start gap-2 text-xs text-amber-800 bg-amber-50 border border-amber-200 rounded-md px-3 py-2",children:[n.jsx(Va,{className:"w-3.5 h-3.5 mt-[1px]"}),n.jsx("p",{children:"         .       (To)   CC."})]}),j&&n.jsxs("div",{className:"flex items-start gap-2 text-xs text-blue-800 bg-blue-50 border border-blue-200 rounded-md px-3 py-2",children:[n.jsx(Va,{className:"w-3.5 h-3.5 mt-[1px]"}),n.jsx("p",{children:" :         ,    ."})]}),n.jsxs("div",{className:"text-xs text-gray-600 space-y-1 border rounded-md border-gray-200 bg-gray-50 px-3 py-2",children:[n.jsxs("div",{className:"flex items-center justify-between",children:[n.jsx("span",{className:"font-semibold",children:"To:"})," ",n.jsx("span",{children:a.to.join("; ")||""})]}),a.cc.length>0&&n.jsxs("div",{className:"flex items-center justify-between",children:[n.jsx("span",{className:"font-semibold",children:"CC:"})," ",n.jsx("span",{children:a.cc.join("; ")})]}),n.jsxs("p",{className:"text-[11px] text-gray-500 mt-1",children:["To: ",qe||""," (primary), CC: Office + report owner ( )."]}),n.jsxs("div",{children:[n.jsx("span",{className:"font-semibold",children:"Subject:"})," ",z||"(will be generated from case data)"]}),n.jsxs("div",{children:[n.jsx("span",{className:"font-semibold",children:"Attachment:"})," ",Ze]}),n.jsx("p",{className:"text-[11px] text-amber-700 mt-1",children:" :       ,        -PDF ."})]}),n.jsxs("div",{children:[n.jsxs("div",{className:"flex items-center justify-between mb-1",children:[n.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Subject"}),n.jsx("button",{type:"button",onClick:()=>{Y(o),i(void 0)},className:"text-[11px] text-blue-700 hover:underline disabled:opacity-50",disabled:r,children:"Reset"})]}),n.jsx("input",{type:"text",value:z,onChange:$=>{const J=$.target.value;Y(J),i(J)},className:"w-full border rounded-md p-2 text-sm",disabled:r})]}),n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Template"}),n.jsxs("div",{className:"flex gap-3",children:[n.jsx("select",{value:D,onChange:$=>ie($.target.value),className:"flex-1 border rounded-md p-2",children:P.map($=>n.jsx("option",{value:$.id,children:$.label},$.id))}),n.jsx("button",{type:"button",onClick:fe,className:"px-3 py-2 bg-panel border rounded-md text-sm font-medium text-gray-700 hover:bg-gray-100",disabled:r,children:"Save Template"})]})]}),n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"PDF Filename Topics"}),R.length>0&&n.jsxs("div",{className:"mb-2",children:[n.jsx("p",{className:"text-[11px] font-semibold text-gray-700 mb-1",children:"Recent combinations"}),n.jsx("div",{className:"flex flex-wrap gap-2",children:R.map(($,J)=>n.jsx("button",{type:"button",onClick:()=>m($),className:"inline-flex items-center gap-1 rounded-full bg-gray-100 px-3 py-1 text-[11px] text-gray-800 border border-gray-300 hover:bg-gray-200",children:$.join(" + ")},J))})]}),n.jsx("div",{className:"flex flex-wrap gap-2 mb-2",children:c.length===0?n.jsx("span",{className:"text-xs text-gray-400",children:"No topics selected yet. You can choose from the list below or add your own."}):c.map($=>n.jsxs("button",{type:"button",onClick:()=>He($),className:"inline-flex items-center gap-1 rounded-full bg-blue-50 px-3 py-1 text-xs text-blue-800 border border-blue-200 hover:bg-blue-100",children:[n.jsx("span",{children:$}),n.jsx("span",{className:"text-[10px]",children:""})]},$))}),n.jsx("button",{type:"button",onClick:()=>{m([]),E("")},className:"mb-2 text-[11px] text-blue-700 hover:underline",disabled:r,children:"  "}),n.jsx("div",{className:"flex items-center gap-2 mb-2",children:n.jsx("input",{type:"text",value:ae,onChange:$=>E($.target.value),placeholder:"  ...",className:"flex-1 border rounded-md p-1.5 text-[11px]",disabled:r})}),n.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-1 mb-2 max-h-32 overflow-y-auto border rounded-md p-2 bg-panel",children:ue.map($=>{const J=`topic-${$}`,pe=$.toLowerCase(),me=c.some(he=>he.trim().toLowerCase()===pe);return n.jsxs("label",{htmlFor:J,className:"flex items-center gap-1 text-xs text-gray-700 cursor-pointer",children:[n.jsx("input",{id:J,type:"checkbox",className:"h-3 w-3",checked:me,onChange:()=>He($),disabled:r}),n.jsx("span",{className:"whitespace-normal break-words",children:$})]},$)})}),n.jsxs("div",{className:"flex gap-2 mt-1",children:[n.jsx("input",{type:"text",value:Q,onChange:$=>G($.target.value),placeholder:"Add custom topic",className:"flex-1 border rounded-md p-2 text-xs",disabled:r}),n.jsx("button",{type:"button",onClick:Ue,className:"px-3 py-1.5 bg-panel border rounded-md text-xs font-medium text-gray-700 hover:bg-gray-100 disabled:opacity-50",disabled:r,children:"Add"})]}),n.jsxs("div",{className:"mt-3 space-y-1 text-[11px] text-gray-700",children:[n.jsxs("div",{className:"flex gap-2 flex-wrap items-center",children:[n.jsx("button",{type:"button",onClick:()=>{const $=Jt(c.map(J=>Ut(J)));$.length&&(mN(s,t.insurerName,$),ee($))},className:"px-2 py-1 rounded-full border border-gray-300 bg-panel hover:bg-gray-100",disabled:r||c.length===0,children:"     "}),C.length>0&&n.jsxs(n.Fragment,{children:[n.jsx("button",{type:"button",onClick:()=>m(C),className:"px-2 py-1 rounded-full border border-blue-300 bg-blue-50 text-blue-800 hover:bg-blue-100 disabled:opacity-50",disabled:r,children:"     "}),n.jsx("button",{type:"button",onClick:()=>{pN(s,t.insurerName),ee([])},className:"text-[11px] text-red-600 hover:underline",disabled:r,children:"    "})]})]}),C.length>0&&c.length===0&&n.jsx("p",{className:"text-[11px] text-gray-500",children:"     .       ."})]})]}),n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Email Body"}),n.jsx(mo,{clientId:go,children:n.jsx("textarea",{value:W,onChange:$=>N($.target.value),rows:12,dir:"ltr",className:"w-full border rounded-md p-3 text-sm",style:{direction:"ltr",textAlign:"left",unicodeBidi:"plaintext"}})})]}),n.jsxs("div",{className:"border-t pt-4 text-right",children:[n.jsx("p",{className:"text-sm font-semibold text-gray-600 mb-2",children:"Signature"}),n.jsxs("div",{className:"inline-flex flex-col items-end",children:[n.jsx("img",{src:"/assets/branding/signature.png",alt:"Signature placeholder",className:"h-16 object-contain mb-2 opacity-80",onError:$=>{$.currentTarget.style.display="none"}}),n.jsx("span",{className:"text-sm text-gray-700 font-semibold",children:"Adv. Lior Perry"})]})]})]}),n.jsxs("div",{className:"flex justify-end gap-3 border-t px-6 py-4 bg-gray-50",children:[n.jsx("button",{onClick:h,className:"px-4 py-2 rounded-md text-gray-600 hover:bg-gray-200",disabled:r,children:"Cancel"}),n.jsx("button",{onClick:()=>v({body:W,templateId:D,subjectBase:z.trim(),topics:Jt(c.map($=>Ut($)))}),className:"px-5 py-2 rounded-md bg-lpBlue text-white font-semibold hover:bg-blue-900 disabled:opacity-60 disabled:cursor-not-allowed",disabled:r,children:r?"Sending":"Send Email"})]})]})}):null},xN=({isOpen:e,availableTitles:t,selectedTitles:s,onClose:r,onSave:a})=>{const o=y.useMemo(()=>v=>{const A=new Set,D=[];return v.forEach(I=>{const W=t.find(N=>N.label===I&&!A.has(N.id));W&&(D.push(W.id),A.add(W.id))}),D},[t]),l=y.useCallback(()=>{const v=o(s);return v.length?v:t.map(A=>A.id)},[o,s,t]),[i,c]=y.useState(l);if(y.useEffect(()=>{e&&c(l())},[e,l]),!e)return null;const m=v=>{c(A=>A.includes(v)?A.filter(D=>D!==v):[...A,v])},p=()=>{c(t.map(v=>v.id))},h=()=>{const v=i.map(A=>{var D;return(D=t.find(I=>I.id===A))==null?void 0:D.label}).filter(Boolean);a(v)};return n.jsx("div",{className:"fixed inset-0 bg-black/40 z-[900] flex items-center justify-center p-4",children:n.jsxs("div",{className:"bg-panel rounded-2xl shadow-2xl w-full max-w-md max-h-[90vh] overflow-hidden flex flex-col",children:[n.jsxs("div",{className:"flex items-center justify-between px-5 py-3 border-b bg-navySecondary50",children:[n.jsx("h3",{className:"text-lg font-semibold text-gray-800",children:"Select File Name Titles"}),n.jsx("button",{onClick:r,className:"text-gray-500 hover:text-gray-800",children:n.jsx(_t,{className:"w-5 h-5"})})]}),n.jsxs("div",{className:"flex-1 overflow-y-auto p-5 space-y-3",children:[t.length===0&&n.jsx("p",{className:"text-sm text-gray-500",children:"No sections available to include."}),t.map(v=>n.jsxs("label",{className:"flex items-center gap-3 border rounded-lg px-3 py-2 text-sm",children:[n.jsx("input",{type:"checkbox",className:"h-4 w-4 text-lpBlue",checked:i.includes(v.id),onChange:()=>m(v.id)}),n.jsx("span",{className:"text-gray-800",children:v.label||"[Untitled Section]"})]},v.id)),t.length>0&&n.jsx("button",{type:"button",className:"text-xs text-lpBlue hover:underline",onClick:p,children:"Select All"})]}),n.jsxs("div",{className:"flex justify-end gap-3 border-t px-5 py-4 bg-navySecondary50",children:[n.jsx("button",{onClick:r,className:"px-4 py-2 text-gray-600 hover:bg-navySecondary200 rounded-md",children:"Cancel"}),n.jsx("button",{onClick:h,className:"px-5 py-2 bg-lpBlue text-white rounded-md font-semibold hover:bg-blue-900",children:"Save"})]})]})})},Se=e=>(e||"").replace(/\u00A0/g," ").replace(/\s+/g,"").trim();var ca=1e9,hN={precision:20,rounding:4,toExpNeg:-7,toExpPos:21,LN10:"2.302585092994045684017991454684364207601101488628772976033327900967572609677352480235997205089598298341967784042286"},Pu,Nt=!0,Pn="[DecimalError] ",pr=Pn+"Invalid argument: ",Mu=Pn+"Exponent out of range: ",da=Math.floor,or=Math.pow,gN=/^(\d+(\.\d*)?|\.\d+)(e[+-]?\d+)?$/i,xn,Pt=1e7,ft=7,hh=9007199254740991,Zl=da(hh/ft),Ae={};Ae.absoluteValue=Ae.abs=function(){var e=new this.constructor(this);return e.s&&(e.s=1),e};Ae.comparedTo=Ae.cmp=function(e){var t,s,r,a,o=this;if(e=new o.constructor(e),o.s!==e.s)return o.s||-e.s;if(o.e!==e.e)return o.e>e.e^o.s<0?1:-1;for(r=o.d.length,a=e.d.length,t=0,s=r<a?r:a;t<s;++t)if(o.d[t]!==e.d[t])return o.d[t]>e.d[t]^o.s<0?1:-1;return r===a?0:r>a^o.s<0?1:-1};Ae.decimalPlaces=Ae.dp=function(){var e=this,t=e.d.length-1,s=(t-e.e)*ft;if(t=e.d[t],t)for(;t%10==0;t/=10)s--;return s<0?0:s};Ae.dividedBy=Ae.div=function(e){return gs(this,new this.constructor(e))};Ae.dividedToIntegerBy=Ae.idiv=function(e){var t=this,s=t.constructor;return it(gs(t,new s(e),0,1),s.precision)};Ae.equals=Ae.eq=function(e){return!this.cmp(e)};Ae.exponent=function(){return Rt(this)};Ae.greaterThan=Ae.gt=function(e){return this.cmp(e)>0};Ae.greaterThanOrEqualTo=Ae.gte=function(e){return this.cmp(e)>=0};Ae.isInteger=Ae.isint=function(){return this.e>this.d.length-2};Ae.isNegative=Ae.isneg=function(){return this.s<0};Ae.isPositive=Ae.ispos=function(){return this.s>0};Ae.isZero=function(){return this.s===0};Ae.lessThan=Ae.lt=function(e){return this.cmp(e)<0};Ae.lessThanOrEqualTo=Ae.lte=function(e){return this.cmp(e)<1};Ae.logarithm=Ae.log=function(e){var t,s=this,r=s.constructor,a=r.precision,o=a+5;if(e===void 0)e=new r(10);else if(e=new r(e),e.s<1||e.eq(xn))throw Error(Pn+"NaN");if(s.s<1)throw Error(Pn+(s.s?"NaN":"-Infinity"));return s.eq(xn)?new r(0):(Nt=!1,t=gs(yo(s,o),yo(e,o),o),Nt=!0,it(t,a))};Ae.minus=Ae.sub=function(e){var t=this;return e=new t.constructor(e),t.s==e.s?Nh(t,e):gh(t,(e.s=-e.s,e))};Ae.modulo=Ae.mod=function(e){var t,s=this,r=s.constructor,a=r.precision;if(e=new r(e),!e.s)throw Error(Pn+"NaN");return s.s?(Nt=!1,t=gs(s,e,0,1).times(e),Nt=!0,s.minus(t)):it(new r(s),a)};Ae.naturalExponential=Ae.exp=function(){return yh(this)};Ae.naturalLogarithm=Ae.ln=function(){return yo(this)};Ae.negated=Ae.neg=function(){var e=new this.constructor(this);return e.s=-e.s||0,e};Ae.plus=Ae.add=function(e){var t=this;return e=new t.constructor(e),t.s==e.s?gh(t,e):Nh(t,(e.s=-e.s,e))};Ae.precision=Ae.sd=function(e){var t,s,r,a=this;if(e!==void 0&&e!==!!e&&e!==1&&e!==0)throw Error(pr+e);if(t=Rt(a)+1,r=a.d.length-1,s=r*ft+1,r=a.d[r],r){for(;r%10==0;r/=10)s--;for(r=a.d[0];r>=10;r/=10)s++}return e&&t>s?t:s};Ae.squareRoot=Ae.sqrt=function(){var e,t,s,r,a,o,l,i=this,c=i.constructor;if(i.s<1){if(!i.s)return new c(0);throw Error(Pn+"NaN")}for(e=Rt(i),Nt=!1,a=Math.sqrt(+i),a==0||a==1/0?(t=ts(i.d),(t.length+e)%2==0&&(t+="0"),a=Math.sqrt(t),e=da((e+1)/2)-(e<0||e%2),a==1/0?t="5e"+e:(t=a.toExponential(),t=t.slice(0,t.indexOf("e")+1)+e),r=new c(t)):r=new c(a.toString()),s=c.precision,a=l=s+3;;)if(o=r,r=o.plus(gs(i,o,l+2)).times(.5),ts(o.d).slice(0,l)===(t=ts(r.d)).slice(0,l)){if(t=t.slice(l-3,l+1),a==l&&t=="4999"){if(it(o,s+1,0),o.times(o).eq(i)){r=o;break}}else if(t!="9999")break;l+=4}return Nt=!0,it(r,s)};Ae.times=Ae.mul=function(e){var t,s,r,a,o,l,i,c,m,p=this,h=p.constructor,v=p.d,A=(e=new h(e)).d;if(!p.s||!e.s)return new h(0);for(e.s*=p.s,s=p.e+e.e,c=v.length,m=A.length,c<m&&(o=v,v=A,A=o,l=c,c=m,m=l),o=[],l=c+m,r=l;r--;)o.push(0);for(r=m;--r>=0;){for(t=0,a=c+r;a>r;)i=o[a]+A[r]*v[a-r-1]+t,o[a--]=i%Pt|0,t=i/Pt|0;o[a]=(o[a]+t)%Pt|0}for(;!o[--l];)o.pop();return t?++s:o.shift(),e.d=o,e.e=s,Nt?it(e,h.precision):e};Ae.toDecimalPlaces=Ae.todp=function(e,t){var s=this,r=s.constructor;return s=new r(s),e===void 0?s:(as(e,0,ca),t===void 0?t=r.rounding:as(t,0,8),it(s,e+Rt(s)+1,t))};Ae.toExponential=function(e,t){var s,r=this,a=r.constructor;return e===void 0?s=Nr(r,!0):(as(e,0,ca),t===void 0?t=a.rounding:as(t,0,8),r=it(new a(r),e+1,t),s=Nr(r,!0,e+1)),s};Ae.toFixed=function(e,t){var s,r,a=this,o=a.constructor;return e===void 0?Nr(a):(as(e,0,ca),t===void 0?t=o.rounding:as(t,0,8),r=it(new o(a),e+Rt(a)+1,t),s=Nr(r.abs(),!1,e+Rt(r)+1),a.isneg()&&!a.isZero()?"-"+s:s)};Ae.toInteger=Ae.toint=function(){var e=this,t=e.constructor;return it(new t(e),Rt(e)+1,t.rounding)};Ae.toNumber=function(){return+this};Ae.toPower=Ae.pow=function(e){var t,s,r,a,o,l,i=this,c=i.constructor,m=12,p=+(e=new c(e));if(!e.s)return new c(xn);if(i=new c(i),!i.s){if(e.s<1)throw Error(Pn+"Infinity");return i}if(i.eq(xn))return i;if(r=c.precision,e.eq(xn))return it(i,r);if(t=e.e,s=e.d.length-1,l=t>=s,o=i.s,l){if((s=p<0?-p:p)<=hh){for(a=new c(xn),t=Math.ceil(r/ft+4),Nt=!1;s%2&&(a=a.times(i),Np(a.d,t)),s=da(s/2),s!==0;)i=i.times(i),Np(i.d,t);return Nt=!0,e.s<0?new c(xn).div(a):it(a,r)}}else if(o<0)throw Error(Pn+"NaN");return o=o<0&&e.d[Math.max(t,s)]&1?-1:1,i.s=1,Nt=!1,a=e.times(yo(i,r+m)),Nt=!0,a=yh(a),a.s=o,a};Ae.toPrecision=function(e,t){var s,r,a=this,o=a.constructor;return e===void 0?(s=Rt(a),r=Nr(a,s<=o.toExpNeg||s>=o.toExpPos)):(as(e,1,ca),t===void 0?t=o.rounding:as(t,0,8),a=it(new o(a),e,t),s=Rt(a),r=Nr(a,e<=s||s<=o.toExpNeg,e)),r};Ae.toSignificantDigits=Ae.tosd=function(e,t){var s=this,r=s.constructor;return e===void 0?(e=r.precision,t=r.rounding):(as(e,1,ca),t===void 0?t=r.rounding:as(t,0,8)),it(new r(s),e,t)};Ae.toString=Ae.valueOf=Ae.val=Ae.toJSON=Ae[Symbol.for("nodejs.util.inspect.custom")]=function(){var e=this,t=Rt(e),s=e.constructor;return Nr(e,t<=s.toExpNeg||t>=s.toExpPos)};function gh(e,t){var s,r,a,o,l,i,c,m,p=e.constructor,h=p.precision;if(!e.s||!t.s)return t.s||(t=new p(e)),Nt?it(t,h):t;if(c=e.d,m=t.d,l=e.e,a=t.e,c=c.slice(),o=l-a,o){for(o<0?(r=c,o=-o,i=m.length):(r=m,a=l,i=c.length),l=Math.ceil(h/ft),i=l>i?l+1:i+1,o>i&&(o=i,r.length=1),r.reverse();o--;)r.push(0);r.reverse()}for(i=c.length,o=m.length,i-o<0&&(o=i,r=m,m=c,c=r),s=0;o;)s=(c[--o]=c[o]+m[o]+s)/Pt|0,c[o]%=Pt;for(s&&(c.unshift(s),++a),i=c.length;c[--i]==0;)c.pop();return t.d=c,t.e=a,Nt?it(t,h):t}function as(e,t,s){if(e!==~~e||e<t||e>s)throw Error(pr+e)}function ts(e){var t,s,r,a=e.length-1,o="",l=e[0];if(a>0){for(o+=l,t=1;t<a;t++)r=e[t]+"",s=ft-r.length,s&&(o+=Ls(s)),o+=r;l=e[t],r=l+"",s=ft-r.length,s&&(o+=Ls(s))}else if(l===0)return"0";for(;l%10===0;)l/=10;return o+l}var gs=function(){function e(r,a){var o,l=0,i=r.length;for(r=r.slice();i--;)o=r[i]*a+l,r[i]=o%Pt|0,l=o/Pt|0;return l&&r.unshift(l),r}function t(r,a,o,l){var i,c;if(o!=l)c=o>l?1:-1;else for(i=c=0;i<o;i++)if(r[i]!=a[i]){c=r[i]>a[i]?1:-1;break}return c}function s(r,a,o){for(var l=0;o--;)r[o]-=l,l=r[o]<a[o]?1:0,r[o]=l*Pt+r[o]-a[o];for(;!r[0]&&r.length>1;)r.shift()}return function(r,a,o,l){var i,c,m,p,h,v,A,D,I,W,N,x,b,B,H,z,Y,Q,G=r.constructor,ae=r.s==a.s?1:-1,E=r.d,R=a.d;if(!r.s)return new G(r);if(!a.s)throw Error(Pn+"Division by zero");for(c=r.e-a.e,Y=R.length,H=E.length,A=new G(ae),D=A.d=[],m=0;R[m]==(E[m]||0);)++m;if(R[m]>(E[m]||0)&&--c,o==null?x=o=G.precision:l?x=o+(Rt(r)-Rt(a))+1:x=o,x<0)return new G(0);if(x=x/ft+2|0,m=0,Y==1)for(p=0,R=R[0],x++;(m<H||p)&&x--;m++)b=p*Pt+(E[m]||0),D[m]=b/R|0,p=b%R|0;else{for(p=Pt/(R[0]+1)|0,p>1&&(R=e(R,p),E=e(E,p),Y=R.length,H=E.length),B=Y,I=E.slice(0,Y),W=I.length;W<Y;)I[W++]=0;Q=R.slice(),Q.unshift(0),z=R[0],R[1]>=Pt/2&&++z;do p=0,i=t(R,I,Y,W),i<0?(N=I[0],Y!=W&&(N=N*Pt+(I[1]||0)),p=N/z|0,p>1?(p>=Pt&&(p=Pt-1),h=e(R,p),v=h.length,W=I.length,i=t(h,I,v,W),i==1&&(p--,s(h,Y<v?Q:R,v))):(p==0&&(i=p=1),h=R.slice()),v=h.length,v<W&&h.unshift(0),s(I,h,W),i==-1&&(W=I.length,i=t(R,I,Y,W),i<1&&(p++,s(I,Y<W?Q:R,W))),W=I.length):i===0&&(p++,I=[0]),D[m++]=p,i&&I[0]?I[W++]=E[B]||0:(I=[E[B]],W=1);while((B++<H||I[0]!==void 0)&&x--)}return D[0]||D.shift(),A.e=c,it(A,l?o+Rt(A)+1:o)}}();function yh(e,t){var s,r,a,o,l,i,c=0,m=0,p=e.constructor,h=p.precision;if(Rt(e)>16)throw Error(Mu+Rt(e));if(!e.s)return new p(xn);for(Nt=!1,i=h,l=new p(.03125);e.abs().gte(.1);)e=e.times(l),m+=5;for(r=Math.log(or(2,m))/Math.LN10*2+5|0,i+=r,s=a=o=new p(xn),p.precision=i;;){if(a=it(a.times(e),i),s=s.times(++c),l=o.plus(gs(a,s,i)),ts(l.d).slice(0,i)===ts(o.d).slice(0,i)){for(;m--;)o=it(o.times(o),i);return p.precision=h,t==null?(Nt=!0,it(o,h)):o}o=l}}function Rt(e){for(var t=e.e*ft,s=e.d[0];s>=10;s/=10)t++;return t}function bc(e,t,s){if(t>e.LN10.sd())throw Nt=!0,s&&(e.precision=s),Error(Pn+"LN10 precision limit exceeded");return it(new e(e.LN10),t)}function Ls(e){for(var t="";e--;)t+="0";return t}function yo(e,t){var s,r,a,o,l,i,c,m,p,h=1,v=10,A=e,D=A.d,I=A.constructor,W=I.precision;if(A.s<1)throw Error(Pn+(A.s?"NaN":"-Infinity"));if(A.eq(xn))return new I(0);if(t==null?(Nt=!1,m=W):m=t,A.eq(10))return t==null&&(Nt=!0),bc(I,m);if(m+=v,I.precision=m,s=ts(D),r=s.charAt(0),o=Rt(A),Math.abs(o)<15e14){for(;r<7&&r!=1||r==1&&s.charAt(1)>3;)A=A.times(e),s=ts(A.d),r=s.charAt(0),h++;o=Rt(A),r>1?(A=new I("0."+s),o++):A=new I(r+"."+s.slice(1))}else return c=bc(I,m+2,W).times(o+""),A=yo(new I(r+"."+s.slice(1)),m-v).plus(c),I.precision=W,t==null?(Nt=!0,it(A,W)):A;for(i=l=A=gs(A.minus(xn),A.plus(xn),m),p=it(A.times(A),m),a=3;;){if(l=it(l.times(p),m),c=i.plus(gs(l,new I(a),m)),ts(c.d).slice(0,m)===ts(i.d).slice(0,m))return i=i.times(2),o!==0&&(i=i.plus(bc(I,m+2,W).times(o+""))),i=gs(i,new I(h),m),I.precision=W,t==null?(Nt=!0,it(i,W)):i;i=c,a+=2}}function yp(e,t){var s,r,a;for((s=t.indexOf("."))>-1&&(t=t.replace(".","")),(r=t.search(/e/i))>0?(s<0&&(s=r),s+=+t.slice(r+1),t=t.substring(0,r)):s<0&&(s=t.length),r=0;t.charCodeAt(r)===48;)++r;for(a=t.length;t.charCodeAt(a-1)===48;)--a;if(t=t.slice(r,a),t){if(a-=r,s=s-r-1,e.e=da(s/ft),e.d=[],r=(s+1)%ft,s<0&&(r+=ft),r<a){for(r&&e.d.push(+t.slice(0,r)),a-=ft;r<a;)e.d.push(+t.slice(r,r+=ft));t=t.slice(r),r=ft-t.length}else r-=a;for(;r--;)t+="0";if(e.d.push(+t),Nt&&(e.e>Zl||e.e<-Zl))throw Error(Mu+s)}else e.s=0,e.e=0,e.d=[0];return e}function it(e,t,s){var r,a,o,l,i,c,m,p,h=e.d;for(l=1,o=h[0];o>=10;o/=10)l++;if(r=t-l,r<0)r+=ft,a=t,m=h[p=0];else{if(p=Math.ceil((r+1)/ft),o=h.length,p>=o)return e;for(m=o=h[p],l=1;o>=10;o/=10)l++;r%=ft,a=r-ft+l}if(s!==void 0&&(o=or(10,l-a-1),i=m/o%10|0,c=t<0||h[p+1]!==void 0||m%o,c=s<4?(i||c)&&(s==0||s==(e.s<0?3:2)):i>5||i==5&&(s==4||c||s==6&&(r>0?a>0?m/or(10,l-a):0:h[p-1])%10&1||s==(e.s<0?8:7))),t<1||!h[0])return c?(o=Rt(e),h.length=1,t=t-o-1,h[0]=or(10,(ft-t%ft)%ft),e.e=da(-t/ft)||0):(h.length=1,h[0]=e.e=e.s=0),e;if(r==0?(h.length=p,o=1,p--):(h.length=p+1,o=or(10,ft-r),h[p]=a>0?(m/or(10,l-a)%or(10,a)|0)*o:0),c)for(;;)if(p==0){(h[0]+=o)==Pt&&(h[0]=1,++e.e);break}else{if(h[p]+=o,h[p]!=Pt)break;h[p--]=0,o=1}for(r=h.length;h[--r]===0;)h.pop();if(Nt&&(e.e>Zl||e.e<-Zl))throw Error(Mu+Rt(e));return e}function Nh(e,t){var s,r,a,o,l,i,c,m,p,h,v=e.constructor,A=v.precision;if(!e.s||!t.s)return t.s?t.s=-t.s:t=new v(e),Nt?it(t,A):t;if(c=e.d,h=t.d,r=t.e,m=e.e,c=c.slice(),l=m-r,l){for(p=l<0,p?(s=c,l=-l,i=h.length):(s=h,r=m,i=c.length),a=Math.max(Math.ceil(A/ft),i)+2,l>a&&(l=a,s.length=1),s.reverse(),a=l;a--;)s.push(0);s.reverse()}else{for(a=c.length,i=h.length,p=a<i,p&&(i=a),a=0;a<i;a++)if(c[a]!=h[a]){p=c[a]<h[a];break}l=0}for(p&&(s=c,c=h,h=s,t.s=-t.s),i=c.length,a=h.length-i;a>0;--a)c[i++]=0;for(a=h.length;a>l;){if(c[--a]<h[a]){for(o=a;o&&c[--o]===0;)c[o]=Pt-1;--c[o],c[a]+=Pt}c[a]-=h[a]}for(;c[--i]===0;)c.pop();for(;c[0]===0;c.shift())--r;return c[0]?(t.d=c,t.e=r,Nt?it(t,A):t):new v(0)}function Nr(e,t,s){var r,a=Rt(e),o=ts(e.d),l=o.length;return t?(s&&(r=s-l)>0?o=o.charAt(0)+"."+o.slice(1)+Ls(r):l>1&&(o=o.charAt(0)+"."+o.slice(1)),o=o+(a<0?"e":"e+")+a):a<0?(o="0."+Ls(-a-1)+o,s&&(r=s-l)>0&&(o+=Ls(r))):a>=l?(o+=Ls(a+1-l),s&&(r=s-a-1)>0&&(o=o+"."+Ls(r))):((r=a+1)<l&&(o=o.slice(0,r)+"."+o.slice(r)),s&&(r=s-l)>0&&(a+1===l&&(o+="."),o+=Ls(r))),e.s<0?"-"+o:o}function Np(e,t){if(e.length>t)return e.length=t,!0}function bh(e){var t,s,r;function a(o){var l=this;if(!(l instanceof a))return new a(o);if(l.constructor=a,o instanceof a){l.s=o.s,l.e=o.e,l.d=(o=o.d)?o.slice():o;return}if(typeof o=="number"){if(o*0!==0)throw Error(pr+o);if(o>0)l.s=1;else if(o<0)o=-o,l.s=-1;else{l.s=0,l.e=0,l.d=[0];return}if(o===~~o&&o<1e7){l.e=0,l.d=[o];return}return yp(l,o.toString())}else if(typeof o!="string")throw Error(pr+o);if(o.charCodeAt(0)===45?(o=o.slice(1),l.s=-1):l.s=1,gN.test(o))yp(l,o);else throw Error(pr+o)}if(a.prototype=Ae,a.ROUND_UP=0,a.ROUND_DOWN=1,a.ROUND_CEIL=2,a.ROUND_FLOOR=3,a.ROUND_HALF_UP=4,a.ROUND_HALF_DOWN=5,a.ROUND_HALF_EVEN=6,a.ROUND_HALF_CEIL=7,a.ROUND_HALF_FLOOR=8,a.clone=bh,a.config=a.set=yN,e===void 0&&(e={}),e)for(r=["precision","rounding","toExpNeg","toExpPos","LN10"],t=0;t<r.length;)e.hasOwnProperty(s=r[t++])||(e[s]=this[s]);return a.config(e),a}function yN(e){if(!e||typeof e!="object")throw Error(Pn+"Object expected");var t,s,r,a=["precision",1,ca,"rounding",0,8,"toExpNeg",-1/0,0,"toExpPos",0,1/0];for(t=0;t<a.length;t+=3)if((r=e[s=a[t]])!==void 0)if(da(r)===r&&r>=a[t+1]&&r<=a[t+2])this[s]=r;else throw Error(pr+s+": "+r);if((r=e[s="LN10"])!==void 0)if(r==Math.LN10)this[s]=new this(r);else throw Error(pr+s+": "+r);return this}var Pu=bh(hN);xn=new Pu(1);const us=Pu;us.set({precision:20,rounding:us.ROUND_HALF_UP});const Kn=e=>new us(e??0),ms=e=>e.toDecimalPlaces(2).toNumber(),vh=(e,t)=>{const s=Kn(e),r=Kn(t);return ms(s.mul(r))},Sh=(e,t)=>{const s=Kn(e),r=Kn(t).div(100);return ms(s.mul(r))},wh=(e,t)=>{const s=Kn(e),r=Kn(t);return ms(s.add(r))},vc=e=>{if(e.lineTotalAmount!=null)return Kn(e.lineTotalAmount);const t=e.lineNetAmount!=null?e.lineNetAmount:vh(e.quantity??0,e.unitPrice??0),s=e.lineVatAmount!=null?e.lineVatAmount:Sh(t,e.vatRate??0);return Kn(wh(t,s))},_n=(e,t)=>{const s=t.reduce((A,D)=>A.add(vc(D)),new us(0)),r=t.reduce((A,D)=>D.isIncludedInRequestedAmount===!1?A:A.add(vc(D)),new us(0)),a=t.reduce((A,D)=>D.lineVatAmount==null?A:A.add(Kn(D.lineVatAmount)),new us(0)),l=t.filter(A=>(A.kind==="ADJUSTMENT"||A.kind==="COMPENSATION")&&A.isIncludedInRequestedAmount===!1).reduce((A,D)=>A.add(vc(D)),new us(0)),i=Kn(e.deductibleAmount??0),c=Kn(e.alreadyPaidAmount??0),m=i.add(c).add(l),p=r.sub(m),h=!!e.infoOnly,v=h?new us(0):p.greaterThan(0)?p:new us(0);return{grossExpensesTotal:ms(s),includedExpensesTotal:ms(r),vatTotal:ms(a),adjustmentsTotal:ms(m),amountBeforeInfoOnly:ms(p),amountToRequest:ms(v),infoOnlyApplied:h}},jh="financial_expenses_store_v1",rl=()=>({sheets:{},lineItems:{},attachments:{},auditEvents:{},insurerRulesets:{},exceptionAnnotations:{},payments:{}}),wt=()=>{if(typeof window>"u")return rl();try{const e=window.localStorage.getItem(jh);if(!e)return rl();const t=JSON.parse(e);return!t||typeof t!="object"?rl():{sheets:t.sheets||{},lineItems:t.lineItems||{},attachments:t.attachments||{},auditEvents:t.auditEvents||{},insurerRulesets:t.insurerRulesets||{},exceptionAnnotations:t.exceptionAnnotations||{},payments:t.payments||{}}}catch(e){return console.error("Failed to load financial expenses store",e),rl()}},vn=e=>{if(!(typeof window>"u"))try{window.localStorage.setItem(jh,JSON.stringify(e))}catch(t){console.error("Failed to persist financial expenses store",t)}},NN=e=>{let t=0;for(let s=0;s<e.length;s++)t=(t<<5)-t+e.charCodeAt(s),t|=0;return Math.abs(t).toString(16)},bN=(e,t,s)=>{const r={sheet:e,lineItems:t.map(a=>({id:a.id,sheetId:a.sheetId,kind:a.kind,expenseType:a.expenseType,providerName:a.providerName,description:a.description,date:a.date,quantity:a.quantity,unitPrice:a.unitPrice,vatRate:a.vatRate,isIncludedInRequestedAmount:a.isIncludedInRequestedAmount,lineNetAmount:a.lineNetAmount,lineVatAmount:a.lineVatAmount,lineTotalAmount:a.lineTotalAmount,attachmentId:a.attachmentId})),attachments:s.map(a=>({id:a.id,sheetId:a.sheetId,fileKey:a.fileKey,originalFileName:a.originalFileName,mimeType:a.mimeType,sizeBytes:a.sizeBytes,linkedLineItemId:a.linkedLineItemId}))};return NN(JSON.stringify(r))},dn=()=>new Date().toISOString(),ua=e=>`${e}_${Math.random().toString(36).slice(2,10)}_${Date.now().toString(36)}`,No=(e,t)=>{const s=Object.values(e.lineItems).filter(a=>a.sheetId===t),r=Object.values(e.attachments).filter(a=>a.sheetId===t);return{lineItems:s,attachments:r}},vN=e=>{const t=wt(),s=Se(e);return Object.values(t.payments).filter(r=>!r.isDeleted&&Se(r.caseId)===s).sort((r,a)=>{const o=new Date(r.paidAt).getTime(),l=new Date(a.paidAt).getTime();return o-l})},SN=e=>{let t=wt();const s=ua("fpay"),r=dn(),a={id:s,caseId:Se(e.caseId),sheetId:e.sheetId??null,amount:e.amount,paidAt:e.paidAt,reference:e.reference??null,note:e.note??null,isDeleted:!1,createdAt:r,updatedAt:r};return t={...t,payments:{...t.payments,[s]:a}},vn(t),a},wN=e=>{let t=wt();const s=t.payments[e];if(!s)return null;const r={...s,isDeleted:!0,updatedAt:dn()};return t={...t,payments:{...t.payments,[e]:r}},vn(t),r},bp=(e,t,s)=>{const r=wt(),a=Se(e);if(!a)return s??0;const o=t?new Date(t).getTime():Date.now();if(Number.isNaN(o))return s??0;let l=0,i=!1;return Object.values(r.payments).forEach(c=>{if(c.isDeleted||Se(c.caseId)!==a)return;i=!0;const m=new Date(c.paidAt).getTime();if(Number.isNaN(m)||m>o)return;const p=Number(c.amount)||0;p<=0||(l+=p)}),i?l:s??0},jN=e=>wt().insurerRulesets[e]||null,al=()=>{const e=wt();return Object.values(e.sheets).sort((t,s)=>{const r=new Date(t.updatedAt||t.createdAt).getTime();return new Date(s.updatedAt||s.createdAt).getTime()-r})},ol=e=>{const t=wt(),s=t.sheets[e];if(!s)return null;const{lineItems:r,attachments:a}=No(t,e);return{sheet:s,lineItems:r,attachments:a}},ws=(e,t)=>{const s=e.sheets[t];if(!s)return e;const{lineItems:r,attachments:a}=No(e,t),o={...s,sheetVersionNumber:s.sheetVersionNumber+1,sheetVersionHash:bN(s,r,a),updatedAt:dn()};return{...e,sheets:{...e.sheets,[t]:o}}},js=(e,t,s,r,a,o,l,i)=>{const c=e.sheets[t];if(!c)return e;const m=ua("fae"),p={id:m,sheetId:t,actorUserId:s,actorRole:r,eventType:a,eventAt:dn(),entityType:o,entityId:l??null,diffJson:i,sheetVersionNumberAtEvent:c.sheetVersionNumber,sheetVersionHashAtEvent:c.sheetVersionHash};return{...e,auditEvents:{...e.auditEvents,[m]:p}}},EN=e=>{const t=wt(),s=ua("fes"),r=dn(),a={id:s,caseId:e.caseId,insurerId:e.insurerId??null,insurerName:e.insurerName??null,periodStart:e.periodStart??null,periodEnd:e.periodEnd??null,periodLabel:e.periodLabel??null,versionIndex:e.versionIndex,status:"DRAFT",archivedReason:null,currency:e.currency||"ILS",deductibleAmount:e.deductibleAmount??null,alreadyPaidAmount:e.alreadyPaidAmount??null,infoOnly:!!e.infoOnly,attachedToReportId:null,attachedAt:null,createdByUserId:e.createdByUserId,createdAt:r,updatedAt:r,readyAt:null,sheetVersionNumber:1,sheetVersionHash:"",insurerRulesetId:e.insurerRulesetId??null,insurerRulesetVersion:e.insurerRulesetVersion??null};let o={...t,sheets:{...t.sheets,[s]:a}};return o=ws(o,s),o=js(o,s,e.createdByUserId,"FINANCE","SHEET_CREATED","SHEET",s,{caseId:e.caseId,insurerId:e.insurerId??null,insurerName:e.insurerName??null}),vn(o),o.sheets[s]},kN=e=>{let t=wt();if(!t.sheets[e])return console.warn("deleteFinancialExpenseSheet: sheet not found",e),t;const r={...t.sheets};delete r[e];const a={};Object.values(t.lineItems).forEach(l=>{l.sheetId!==e&&(a[l.id]=l)});const o={};return Object.values(t.attachments).forEach(l=>{l.sheetId!==e&&(o[l.id]=l)}),t={...t,sheets:r,lineItems:a,attachments:o},vn(t),t},AN=e=>{let t=wt();const s=t.sheets[e.sheetId];if(!s)return console.warn("updateFinancialExpenseSheetMeta: sheet not found",e.sheetId),null;const r={...s,...e.patch,updatedAt:dn()};t={...t,sheets:{...t.sheets,[e.sheetId]:r}};const a={};return Object.keys(e.patch).forEach(o=>{const l=s[o],i=r[o];l!==i&&(a[o]={before:l,after:i})}),t=ws(t,e.sheetId),t=js(t,e.sheetId,e.actorUserId,e.actorRole,"SHEET_META_UPDATED","SHEET",e.sheetId,Object.keys(a).length?a:void 0),vn(t),t.sheets[e.sheetId]},IN=e=>{let t=wt();if(!t.sheets[e.sheetId])return console.warn("addFinancialExpenseLineItem: sheet not found",e.sheetId),null;const s=ua("fli"),r=dn(),a={id:s,sheetId:e.sheetId,kind:e.kind,expenseType:e.expenseType??null,providerName:e.providerName??null,providerId:e.providerId??null,description:e.description,date:e.date??null,quantity:e.quantity??null,unitPrice:e.unitPrice??null,vatRate:e.vatRate??null,isIncludedInRequestedAmount:e.isIncludedInRequestedAmount??!0,lineNetAmount:e.lineNetAmount??null,lineVatAmount:e.lineVatAmount??null,lineTotalAmount:e.lineTotalAmount??null,attachmentId:e.attachmentId??null,createdAt:r,updatedAt:r};return t={...t,lineItems:{...t.lineItems,[s]:a}},t=ws(t,e.sheetId),t=js(t,e.sheetId,e.actorUserId,e.actorRole,"LINE_ITEM_CREATED","LINE_ITEM",s,{kind:e.kind,description:e.description,amount:e.lineTotalAmount??null}),vn(t),a},TN=e=>{let t=wt();const s=t.lineItems[e.lineItemId];if(!s||s.sheetId!==e.sheetId)return console.warn("updateFinancialExpenseLineItem: line item not found",e.lineItemId),null;const r={...s,...e.patch,updatedAt:dn()};t={...t,lineItems:{...t.lineItems,[e.lineItemId]:r}};const a={};return Object.keys(e.patch).forEach(o=>{const l=s[o],i=r[o];l!==i&&(a[o]={before:l,after:i})}),t=ws(t,e.sheetId),t=js(t,e.sheetId,e.actorUserId,e.actorRole,"LINE_ITEM_UPDATED","LINE_ITEM",e.lineItemId,Object.keys(a).length?a:void 0),vn(t),t.lineItems[e.lineItemId]},RN=e=>{let t=wt();const s=t.lineItems[e.lineItemId];if(!s||s.sheetId!==e.sheetId)return console.warn("deleteFinancialExpenseLineItem: line item not found",e.lineItemId),!1;const{[e.lineItemId]:r,...a}=t.lineItems;return t={...t,lineItems:a},t=ws(t,e.sheetId),t=js(t,e.sheetId,e.actorUserId,e.actorRole,"LINE_ITEM_DELETED","LINE_ITEM",e.lineItemId,{deleted:r}),vn(t),!0},CN=e=>{let t=wt();if(!t.sheets[e.sheetId])return console.warn("addFinancialExpenseAttachment: sheet not found",e.sheetId),null;const s=ua("fat"),r=dn(),a={id:s,sheetId:e.sheetId,fileKey:e.fileKey,originalFileName:e.originalFileName,mimeType:e.mimeType??null,sizeBytes:e.sizeBytes??null,uploadedByUserId:e.uploadedByUserId,uploadedAt:r,linkedLineItemId:e.linkedLineItemId??null};return t={...t,attachments:{...t.attachments,[s]:a}},t=ws(t,e.sheetId),t=js(t,e.sheetId,e.uploadedByUserId,"FINANCE","ATTACHMENT_ADDED","ATTACHMENT",s,{fileKey:e.fileKey,originalFileName:e.originalFileName}),vn(t),a},DN=e=>{let t=wt();const s=t.attachments[e.attachmentId];if(!s||s.sheetId!==e.sheetId)return console.warn("linkAttachmentToLineItem: attachment not found",e.attachmentId),null;const r=s.linkedLineItemId??null,a={...s,linkedLineItemId:e.lineItemId};if(t={...t,attachments:{...t.attachments,[e.attachmentId]:a}},e.lineItemId){const o=t.lineItems[e.lineItemId];o&&(t={...t,lineItems:{...t.lineItems,[e.lineItemId]:{...o,attachmentId:e.attachmentId,updatedAt:dn()}}})}else if(r){const o=t.lineItems[r];o&&o.attachmentId===e.attachmentId&&(t={...t,lineItems:{...t.lineItems,[r]:{...o,attachmentId:null,updatedAt:dn()}}})}return t=ws(t,e.sheetId),t=js(t,e.sheetId,e.actorUserId,e.actorRole,"ATTACHMENT_LINKED","ATTACHMENT",e.attachmentId,{before:r,after:e.lineItemId}),vn(t),t.attachments[e.attachmentId]},LN=e=>{let t=wt();const s=t.sheets[e.sheetId];if(!s)return console.warn("recordSheetReadyAttempt: sheet not found",e.sheetId),null;let r=s;if(e.success){const a=dn();r={...s,status:"READY_FOR_REPORT",readyAt:a,updatedAt:a,insurerRulesetId:e.decisionLog.rulesetId??s.insurerRulesetId??null,insurerRulesetVersion:e.decisionLog.rulesetVersion??s.insurerRulesetVersion??null},t={...t,sheets:{...t.sheets,[e.sheetId]:r}},t=ws(t,e.sheetId)}return t=js(t,e.sheetId,e.actorUserId,e.actorRole,"SHEET_READY_ATTEMPT","SHEET",e.sheetId,{success:e.success,decisionLog:e.decisionLog}),vn(t),t.sheets[e.sheetId]},_N=e=>{let t=wt();const s=t.sheets[e.sheetId];if(!s||s.status!=="READY_FOR_REPORT")return s||null;const r=dn(),a={...s,status:"DRAFT",readyAt:null,updatedAt:r};return t={...t,sheets:{...t.sheets,[e.sheetId]:a}},t=ws(t,e.sheetId),t=js(t,e.sheetId,e.actorUserId,e.actorRole,"SHEET_REVERTED_TO_DRAFT","SHEET",e.sheetId,{from:"READY_FOR_REPORT",to:"DRAFT"}),vn(t),t.sheets[e.sheetId]},ON=(e,t)=>{const s=wt(),r=Object.values(s.sheets),a=new Map;t.forEach(i=>{a.set(i.id,i)});const o=r.map(i=>{var I,W;const{lineItems:c}=No(s,i.id),m=_n(i,c),p=i.attachedToReportId?a.get(i.attachedToReportId):void 0,h=Object.values(s.auditEvents).filter(N=>N.sheetId===i.id&&N.diffJson&&N.diffJson.decisionLog);h.sort((N,x)=>new Date(x.eventAt).getTime()-new Date(N.eventAt).getTime());const v=((W=(I=h[0])==null?void 0:I.diffJson)==null?void 0:W.decisionLog)||null,A=v!=null&&v.blockingIssueCodes&&Array.isArray(v.blockingIssueCodes)?v.blockingIssueCodes:void 0,D=(p==null?void 0:p.expensesSheetId)===i.id?!!p.expensesOutOfSync:!1;return{sheetId:i.id,caseId:i.caseId,insurerName:i.insurerName??null,status:i.status,versionIndex:i.versionIndex,updatedAt:i.updatedAt,readyAt:i.readyAt??null,attachedAt:i.attachedAt??null,sentAt:(p==null?void 0:p.sentAt)||null,amountToRequest:m.amountToRequest,infoOnly:i.infoOnly,expensesOutOfSync:D,blockingIssueCodesLatest:A}}),l=i=>{if(!i)return!1;const c=new Date(i).getTime();return!(Number.isNaN(c)||e.dateFrom&&c<new Date(e.dateFrom).getTime()||e.dateTo&&c>new Date(e.dateTo).getTime())};return o.filter(i=>{var c,m;if(e.status&&i.status!==e.status||e.insurerId&&((c=s.sheets[i.sheetId])==null?void 0:c.insurerId)!==e.insurerId||e.insurerName&&!(i.insurerName||"").toLowerCase().includes(e.insurerName.toLowerCase()))return!1;if(e.caseIdOrSearch){const p=e.caseIdOrSearch.toLowerCase();if(!`${i.caseId} ${i.insurerName||""}`.toLowerCase().includes(p))return!1}return!(e.isInfoOnly!=null&&i.infoOnly!==e.isInfoOnly||e.minAmountToRequest!=null&&i.amountToRequest<e.minAmountToRequest||e.maxAmountToRequest!=null&&i.amountToRequest>e.maxAmountToRequest||(e.dateFrom||e.dateTo)&&!l(i.updatedAt)||e.hasMissingAttachments&&!((m=i.blockingIssueCodesLatest)!=null&&m.includes("MISSING_ATTACHMENT_REQUIRED")))}).sort((i,c)=>new Date(c.updatedAt).getTime()-new Date(i.updatedAt).getTime())},MN=e=>{const t=wt(),s=Object.values(t.sheets),r=new Map;e.forEach(c=>{r.set(c.id,c)});let a=0,o=0,l=0,i=0;return s.forEach(c=>{c.status==="READY_FOR_REPORT"&&(a+=1),c.status==="ATTACHED_TO_REPORT"&&(o+=1);const m=c.attachedToReportId?r.get(c.attachedToReportId):void 0;(m==null?void 0:m.status)==="SENT"&&(l+=1);const p=(m==null?void 0:m.expensesSheetId)===c.id&&m.expensesOutOfSync===!0,h=Object.values(t.auditEvents).some(v=>{var A;return v.sheetId===c.id&&v.eventType==="SHEET_READY_ATTEMPT"&&((A=v.diffJson)==null?void 0:A.success)===!1});(p||h)&&(i+=1)}),{readyCount:a,attachedCount:o,sentCount:l,exceptionsCount:i}},Sc=(e,t)=>{if(!e||!t)return null;const s=new Date(e).getTime(),r=new Date(t).getTime();return Number.isNaN(s)||Number.isNaN(r)?null:(r-s)/(1e3*60*60)},wc=e=>e.length?e.reduce((s,r)=>s+r,0)/e.length:null,jc=e=>{if(!e.length)return null;const t=[...e].sort((r,a)=>r-a),s=Math.floor(t.length/2);return t.length%2===0?(t[s-1]+t[s])/2:t[s]},ll=(e,t=5)=>({count:e.length,samples:e.slice(0,t)}),PN=e=>{let t=wt();const s=ua("fexa"),r=dn(),a={id:s,sheetId:e.sheetId,noteType:"EXCEPTION_STATUS",value:e.value,actorUserId:e.actorUserId,createdAt:r};return t={...t,exceptionAnnotations:{...t.exceptionAnnotations,[s]:a}},vn(t),a},FN=e=>{const t=wt(),s=Object.values(t.exceptionAnnotations).filter(r=>r.sheetId===e&&r.noteType==="EXCEPTION_STATUS");return s.length?(s.sort((r,a)=>new Date(a.createdAt).getTime()-new Date(r.createdAt).getTime()),s[0].value):null},BN=e=>{const t=wt(),s=Object.values(t.sheets),r=new Map;e.forEach(G=>{r.set(G.id,G)});const a=[],o=[],l=[];let i=0,c=0;const m=[],p=[],h=[],v=[],A=3,D=3,I=Date.now(),W=new Map;Object.values(t.auditEvents).forEach(G=>{const ae=W.get(G.sheetId)||[];ae.push(G),W.set(G.sheetId,ae)});const N=[];s.forEach(G=>{const{lineItems:ae}=No(t,G.id),E=_n(G,ae);if(i+=E.amountToRequest,G.infoOnly&&(c+=1),G.createdAt&&G.readyAt){const k=Sc(G.createdAt,G.readyAt);k!=null&&a.push(k)}if(G.readyAt&&G.attachedAt){const k=Sc(G.readyAt,G.attachedAt);k!=null&&o.push(k)}const R=G.attachedToReportId?r.get(G.attachedToReportId):void 0;if(G.attachedAt&&(R!=null&&R.sentAt)){const k=Sc(G.attachedAt,R.sentAt);k!=null&&l.push(k)}E.amountToRequest>0&&N.push(E.amountToRequest)});let x=0;if(N.length>=5){const G=[...N].sort((E,R)=>E-R),ae=Math.floor(G.length*.95)-1;x=G[Math.max(0,ae)]}else N.length>0&&(x=Math.max(...N));s.forEach(G=>{var ie,fe;const{lineItems:ae}=No(t,G.id),E=_n(G,ae),R=G.attachedToReportId?r.get(G.attachedToReportId):void 0,k=W.get(G.id)||[],C=k.filter(se=>se.diffJson&&se.diffJson.decisionLog);C.sort((se,ue)=>new Date(ue.eventAt).getTime()-new Date(se.eventAt).getTime());const ee=((fe=(ie=C[0])==null?void 0:ie.diffJson)==null?void 0:fe.decisionLog)||null,V=ee!=null&&ee.blockingIssueCodes&&Array.isArray(ee.blockingIssueCodes)?ee.blockingIssueCodes:[];if((R==null?void 0:R.expensesSheetId)===G.id&&R.expensesOutOfSync===!0){const se=new Date(G.updatedAt||G.createdAt).getTime();Number.isNaN(se)||(I-se)/864e5>=A&&m.push({sheetId:G.id,caseId:G.caseId,reason:"DIVERGENCE_OLD",updatedAt:G.updatedAt})}(G.status==="READY_FOR_REPORT"||G.status==="ATTACHED_TO_REPORT")&&V.includes("MISSING_ATTACHMENT_REQUIRED")&&E.amountToRequest>0&&p.push({sheetId:G.id,caseId:G.caseId,reason:"MISSING_ATTACHMENTS",updatedAt:G.updatedAt}),x>0&&E.amountToRequest>=x&&h.push({sheetId:G.id,caseId:G.caseId,reason:"HIGH_AMOUNT",updatedAt:G.updatedAt,amountToRequest:E.amountToRequest});const X=k.filter(se=>{var ue;return se.eventType==="SHEET_READY_ATTEMPT"&&((ue=se.diffJson)==null?void 0:ue.success)===!1}).length;X>=D&&v.push({sheetId:G.id,caseId:G.caseId,reason:"REPEATED_BLOCKS",failedAttempts:X,updatedAt:G.updatedAt})});const b=s.length,B=s.filter(G=>{const ae=G.attachedToReportId?r.get(G.attachedToReportId):void 0;return(ae==null?void 0:ae.status)==="SENT"}).length,H=b>0?Number((c/b).toFixed(3)):null,z={draftToReadyAvgHours:wc(a),draftToReadyMedianHours:jc(a),readyToAttachedAvgHours:wc(o),readyToAttachedMedianHours:jc(o),attachedToSentAvgHours:wc(l),attachedToSentMedianHours:jc(l)},Y={totalSheets:b,totalSentReports:B,totalAmountRequested:i,infoOnlyRatio:H},Q={divergenceOld:ll(m),missingAttachments:ll(p),highAmounts:{threshold:x,...ll(h)},repeatedBlocks:{threshold:D,...ll(v)}};return{sla:z,volumes:Y,exceptions:Q}},$N=(e,t=10)=>{const s=wt();return Object.values(s.auditEvents).filter(r=>r.sheetId===e).sort((r,a)=>new Date(a.eventAt).getTime()-new Date(r.eventAt).getTime()).slice(0,t)},HN=5e3,Ec=new Map,Ta=e=>({actorUserId:e.id,actorRole:e.role}),Je={async listSheets(){return al()},async listPaymentsForCase(e){return vN(e)},getPaidToDateForSheet(e){const t=e.updatedAt||e.createdAt||new Date().toISOString();return bp(e.caseId,t,e.alreadyPaidAmount??0)},async getLatestSheetForCase(e){const t=al(),s=Se(e),a=t.filter(o=>Se(o.caseId)===s).sort((o,l)=>{const i=new Date(o.updatedAt||o.createdAt).getTime();return new Date(l.updatedAt||l.createdAt).getTime()-i})[0];return a?ol(a.id):null},async isNewFinancialModel(e){if(!e)return!1;const t=await al(),s=Se(e);return t.some(r=>Se(r.caseId)===s)},logIfMixedModel(e){if(!!!e.expensesSheetId)return;(e.expensesItems&&e.expensesItems.length>0||!!e.expenseWorksheet||!!e.expensesSum)&&console.error("[FinancialExpenses] Mixed model detected for report",e.id," expensesSheetId is set but legacy expenses fields are also populated.")},async getSheet(e){return ol(e)},async getRulesetForSheet(e){const t=e.insurerRulesetId||e.insurerId||"default",s=jN(t);if(s)return s;const r=new Date().toISOString();return{insurerId:t,policyFamily:"FLEXIBLE",requiredAttachmentTypes:[],requireAttachmentPerLine:!1,requireAttachmentForExpenseTypes:[],amountThresholdRequiringAttachment:null,infoOnlyTextVariant:null,notesInternal:null,rulesetVersion:"default",updatedAt:r}},async createSheet(e,t){const s={...t,createdByUserId:e.id};return EN(s)},async createPaymentEvent(e,t){return SN(t)},async updateSheetMeta(e,t,s){const r={sheetId:t,...Ta(e),patch:s};return AN(r)},async addLineItem(e,t,s){const r={...s,sheetId:t,...Ta(e)};return IN(r)},async updateLineItem(e,t,s,r){const a={sheetId:t,lineItemId:s,...Ta(e),patch:r};return TN(a)},async deleteLineItem(e,t,s){const r={sheetId:t,lineItemId:s,...Ta(e)};return RN(r)},async softDeletePaymentEvent(e){return wN(e)},buildCumulativeExpensesSnapshot(e,t){const s=`${e}::${t||"now"}`,r=Ec.get(s),a=Date.now();if(r&&a-r.ts<HN)return r.value;const o=ol(e);if(!o)return Ec.set(s,{ts:a,value:null}),null;const l=o.sheet,i=t||l.updatedAt||l.createdAt||new Date().toISOString(),c=bp(l.caseId,i,l.alreadyPaidAmount??0),m={...l,alreadyPaidAmount:c},p=al(),h=Se(l.caseId),v=new Date(i).getTime(),A=p.filter(B=>{if(B.id===l.id||Se(B.caseId)!==h)return!1;const H=new Date(B.updatedAt||B.createdAt).getTime();return Number.isNaN(H)||Number.isNaN(v)?!0:H<=v}),D=[];A.forEach(B=>{const H=ol(B.id);H&&H.lineItems.forEach(z=>{z.kind==="EXPENSE"&&D.push(z)})});const I=o.lineItems,N=[...[...D,...I]].sort((B,H)=>{const z=E=>{const R=E.date?new Date(E.date).getTime():NaN;if(!Number.isNaN(R))return R;const k=E.createdAt?new Date(E.createdAt).getTime():NaN;return Number.isNaN(k)?0:k},Y=z(B),Q=z(H);if(Y!==Q)return Y-Q;const G=`${B.sheetId||""}-${B.id}`,ae=`${H.sheetId||""}-${H.id}`;return G.localeCompare(ae)}),b={effectiveSheet:m,currentLines:I,historicalLines:D,allLines:N,opts:{isNewLine:B=>B.kind==="EXPENSE"&&B.sheetId===l.id,isHistoricalLine:B=>B.kind==="EXPENSE"&&B.sheetId!==l.id}};return Ec.set(s,{ts:a,value:b}),b},async deleteSheet(e){kN(e)},async addAttachment(e,t,s){const r={...s,sheetId:t,uploadedByUserId:e.id};return CN(r)},async linkAttachmentToLineItem(e,t,s,r){const a={sheetId:t,attachmentId:s,lineItemId:r,...Ta(e)};return DN(a)},async recordReadyAttempt(e,t){const s={...t,actorUserId:e.id,actorRole:e.role};return LN(s)},async revertSheetToDraft(e,t){return _N({sheetId:t,actorUserId:e.id,actorRole:e.role})},async listSheetsForLidor(e,t,s){if(e.role!=="ADMIN"&&e.role!=="SUB_ADMIN")throw new Error("Access denied: only ADMIN or SUB_ADMIN can view financial control data.");return ON(t,s)},async getLidorCounts(e,t){if(e.role!=="ADMIN"&&e.role!=="SUB_ADMIN")throw new Error("Access denied: only ADMIN or SUB_ADMIN can view financial control data.");return MN(t)},async getLidorKpis(e,t){if(e.role!=="ADMIN"&&e.role!=="SUB_ADMIN")throw new Error("Access denied: only ADMIN or SUB_ADMIN can view financial control data.");return BN(t)},async getExceptionStatusForSheet(e,t){if(e.role!=="ADMIN"&&e.role!=="SUB_ADMIN")throw new Error("Access denied: only ADMIN or SUB_ADMIN can view financial control data.");return FN(t)},async setExceptionStatusForSheet(e,t,s){if(e.role!=="ADMIN"&&e.role!=="SUB_ADMIN")throw new Error("Access denied: only ADMIN or SUB_ADMIN can view financial control data.");return PN({sheetId:t,value:s,actorUserId:e.id})},async getSheetAuditForLidor(e,t,s=10){if(e.role!=="ADMIN"&&e.role!=="SUB_ADMIN")throw new Error("Access denied: only ADMIN or SUB_ADMIN can view financial control data.");return $N(t,s)}},UN={dashboardTitle:" ",brandName:"Lior Perry",brandSubtitle:"  ",welcomeBack:" ",roleLawyer:"",gettingStartedTitle:" ",gettingStartedBodyLine1:"  .",gettingStartedBodyLine2:"   .          .",gettingStartedStep1:"  ",gettingStartedStep2:" ",gettingStartedStep3:"  ",gettingStartedCta:"  ",searchSectionLabel:" ",searchLabel:" ",searchPlaceholder:"  , ,     ...",statusLabel:"",sortByLabel:" ",sortByUpdated:" ",sortByReportDate:" ",sortByInsured:"",onlyMyCases:"  ",clearFilters:" ",searchByOdakanit:"    ",searchOdakanitPlaceholder:"    ...",noCaseFolderFound:"       .",statsSectionLabel:"  ",statsActiveCases:" ",statsActionRequired:"  ",statsWaitingOnOthers:" ",statsFinanceTasks:"  ",statsDraftsReady:" /  ",caseListTitle:"   ",caseListHeaderTitle:" ",caseListHeaderReportNo:"REPORT NO",caseListHeaderPlaintiff:"PLAINTIFF / CLAIMANT",caseListHeaderInsured:"INSURED",caseListHeaderInsurer:"INSURER",caseListHeaderOdakanit:"  ",caseListStatusAttention:"  ",caseListStatusOpen:"  ",caseListStatusNone:"  ",caseListEmpty:"   .",caseListHintActiveOnly:"(     )",financeBannerTitle:"    ",financeBannerBody:"      .         .",bucketActionRequiredTitle:"  ",bucketActionRequiredDescription:"    .",bucketWaitingTitle:" ",bucketWaitingDescription:"   ,     .",bucketInProgressTitle:"",bucketInProgressDescription:"   .",bucketSentTitle:" / ",bucketSentDescription:"     .",emptyActionRequiredTitle:"    ",emptyActionRequiredDesc:"    ,   .",emptyWaitingTitle:"   ",emptyWaitingDesc:"      .",emptyInProgressTitle:"  ",emptyInProgressDesc:"    .",emptySentTitle:"   ",emptySentDesc:"  ,     .",emptyInProgressCta:"  ",defaultEmptyTitle:"  ",defaultEmptyDescription:"     .",untitledCase:"  ",labelInsured:"",labelPlaintiff:"",labelInsurer:" ",labelFile:" ",labelUpdated:":",labelNextStep:" :",nextStepReview:"  ",nextStepWaitingInvoices:" ",nextStepReadyToSend:" ",nextStepDraft:"  ",nextStepSent:"",nextStepContinue:" ",openContinue:" / ",preview:" ",viewSections:"  ",deleteDraftConfirm:"   ?     .",deleteDraftAria:" ",deleteTitle:"",pin:" ",unpin:" ",alertTimeBreach:" ",alertResponseDelay:" ",openNotificationsAria:" ",openNotificationsTitle:"",openNewCaseFolderAria:"  ",openNewCaseFolderTitle:"  ",openHelpCenterAria:"  ",openHelpCenterTitle:" ",logoutAria:"",logoutTitle:"",workQueuesAria:"  ",expand:"",collapse:"",statusDraft:"",statusActionRequired:" ",statusWaitingInvoices:" ",statusPendingReview:" ",statusApproved:"",statusReadyToSend:" ",statusSent:"",densityLabel:" :",densityComfortable:"",densityCompact:"",resumeLastCase:"   ",resumeLabel:"",internalFile:" ",workloadTitle:"  ",workloadActionLabel:"  ",workloadWaitingLabel:"   ",workloadDraftLabel:" ",financeReportsTitle:" /    ",financeReportsHint:"           .",financeReportsHeaderOdakanit:" ",financeReportsHeaderInsured:"",financeReportsHeaderPlaintiff:"",financeReportsHeaderStatus:" ",financeReportsHeaderUpdated:" ",financeReportsEmpty:"     .",focusModeLabel:"    ",tagNewCase:" ",tagOngoingCase:" ",notificationTitle:" ",dailySummary:" ",noNotifications:"  .",clearAll:" ",footerArchiveNote:"      "},Re=e=>UN[e],kc=({label:e,value:t,icon:s,accentClass:r,selected:a,onClick:o})=>{const l=n.jsxs("div",{className:["flex items-center justify-between rounded-2xl border px-4 py-3 shadow-sm transition","focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-gold focus-visible:ring-offset-2",a?"border-gold bg-gold/10":"border-borderDark bg-panel hover:bg-navySecondary"].join(" "),children:[n.jsxs("div",{children:[n.jsx("p",{className:["text-[11px] uppercase tracking-wide",a?"font-bold text-textLight":"font-semibold text-textMuted"].join(" "),children:e}),n.jsx("p",{className:"mt-1 text-xl font-bold text-gray-900",children:t})]}),n.jsx("div",{className:["inline-flex h-9 w-9 items-center justify-center rounded-full",r].join(" "),"aria-hidden":"true",children:s})]});return o?n.jsx("button",{type:"button",onClick:o,className:"w-full text-left",children:l}):l},WN=({activeCases:e,actionRequired:t,waitingOnOthers:s,draftsAndReady:r,financeTasks:a,selectedFilter:o,onChangeFilter:l})=>{const i=c=>{l&&l(o===c?null:c)};return n.jsxs("section",{"aria-label":Re("statsSectionLabel"),className:"mb-6 grid gap-4 sm:grid-cols-3 lg:grid-cols-3",children:[n.jsx(kc,{label:Re("statsFinanceTasks"),value:a,icon:n.jsx(w0,{className:"h-4 w-4 text-goldLight"}),accentClass:"bg-gold/20",selected:o==="FINANCE",onClick:()=>i("FINANCE")}),n.jsx(kc,{label:Re("statsWaitingOnOthers"),value:s,icon:n.jsx(v0,{className:"h-4 w-4 text-goldLight"}),accentClass:"bg-gold/20",selected:o==="WAITING",onClick:()=>i("WAITING")}),n.jsx(kc,{label:Re("statsDraftsReady"),value:r,icon:n.jsx(Xl,{className:"h-4 w-4 text-goldLight"}),accentClass:"bg-gold/20",selected:o==="DRAFTS",onClick:()=>i("DRAFTS")})]})};Re("statusDraft"),Re("statusActionRequired"),Re("statusWaitingInvoices"),Re("statusPendingReview"),Re("statusApproved"),Re("statusReadyToSend"),Re("statusSent");const Ra=e=>(e||"").trim().toLowerCase(),Ac=e=>{const t=(e.odakanitNo||"").trim();if(t)return`odakanit:${t}`;const s=[`umr:${Ra(e.marketRef)}`,`line:${Ra(e.lineSlipNo)}`,`cert:${Ra(e.certificateRef)}`,`insured:${Ra(e.insuredName)}`,`plaintiff:${Ra(e.plaintiffName)}`].filter(r=>!r.endsWith(":"));return s.length?s.join("|"):`id:${e.id}`},zN=24*60*60*1e3,VN=e=>{const t=e.updatedAt||e.reportDate;if(!t)return null;const s=new Date(t).getTime();return Number.isFinite(s)?s:null},KN=e=>{const t=VN(e);return!t||(Date.now()-t)/zN<=3?null:e.status==="DRAFT"?Re("alertResponseDelay"):e.status==="WAITING_FOR_INVOICES"||e.status==="READY_TO_SEND"?Re("alertTimeBreach"):null},YN=e=>e.status==="TASK_ASSIGNED"||e.status==="PENDING_REVIEW"||e.status==="READY_TO_SEND",GN=({report:e})=>e.expensesSheetId?e.supersededByReportId?n.jsx("span",{className:"inline-flex items-center rounded-full bg-slate-100 px-1.5 py-0.5 text-[9px] font-semibold text-slate-700 border border-slate-200",title:"        ",children:""}):n.jsx("span",{className:"inline-flex items-center rounded-full bg-emerald-50 px-1.5 py-0.5 text-[9px] font-semibold text-emerald-800 border border-emerald-200",title:"      ",children:" ()"}):null,qN=Re("brandName"),XN=Re("brandSubtitle"),JN={DRAFT:Re("statusDraft"),TASK_ASSIGNED:Re("statusActionRequired"),WAITING_FOR_INVOICES:Re("statusWaitingInvoices"),PENDING_REVIEW:Re("statusPendingReview"),APPROVED:Re("statusApproved"),READY_TO_SEND:Re("statusReadyToSend"),SENT:Re("statusSent")},vp=e=>e==="TASK_ASSIGNED"||e==="PENDING_REVIEW"?"ACTION_REQUIRED":e==="WAITING_FOR_INVOICES"?"WAITING_ON_OTHERS":e==="READY_TO_SEND"?"IN_PROGRESS":e==="SENT"?"SENT_COMPLETED":"IN_PROGRESS",Ic=e=>`lp_pins:${e}`,QN=e=>`lp_dashboard_density:${e}`,ZN="lp_current_report",Sp=e=>`lp_pins_migrated:${e}`,eb=({user:e,reports:t,caseFolders:s,notifications:r,showNotifications:a,setShowNotifications:o,onClearNotifications:l,dailySummaryOptIn:i,setDailySummaryOptIn:c,archiveAfterMs:m,onSelectReport:p,onNewReport:h,onOpenCaseFolder:v,onLogout:A,deleteReportById:D})=>{const[I,W]=y.useState(""),[N,x]=y.useState("ALL"),[b,B]=y.useState(!0),[H,z]=y.useState(null),[Y,Q]=y.useState("UPDATED"),[G,ae]=y.useState(()=>{if(typeof window>"u")return[];try{const Z=window.localStorage.getItem(Ic(e.id)),be=Z?JSON.parse(Z):[];return Array.isArray(be)?be.filter(M=>typeof M=="string"):[]}catch{return[]}}),[E,R]=y.useState(()=>{if(typeof window>"u")return"COMFORTABLE";try{return window.localStorage.getItem(QN(e.id))==="COMPACT"?"COMPACT":"COMFORTABLE"}catch{return"COMFORTABLE"}}),k=Date.now(),C=m??Number.MAX_SAFE_INTEGER,[ee,V]=y.useState(!1),[_,P]=y.useState({}),X=y.useMemo(()=>r.filter(be=>!be.targetUserId||be.targetUserId===e.id).filter(be=>{if(!be.reportId)return!0;const M=t.find(K=>K.id===be.reportId);return M?M.status!=="SENT":!0}),[r,e.id,t]),ie=y.useMemo(()=>X.filter(Z=>{if(!Z.reportId)return!1;const be=t.find(M=>M.id===Z.reportId);return!(!be||!be.expensesSheetId||be.status==="SENT")}).length,[X,t]),{mine:fe,buckets:se,filteredReports:ue}=y.useMemo(()=>{const Z=t.filter(Ie=>{if(Ie.deletedAt)return!1;const Ee=(Ie.odakanitNo||"").trim();if(!Ee)return!0;const Me=s[Ee];return!(Me&&Me.closedAt)}),be=Z.filter(Ie=>Ie.createdBy===e.id),M=b?be:Z,K=N==="ALL"?M:M.filter(Ie=>Ie.status===N),oe=H==="FINANCE"?K.filter(Ie=>!!Ie.expensesSheetId):K,le=(()=>{const Ie=I.trim().toLowerCase();return Ie?oe.filter(Ee=>[Ee.odakanitNo,Ee.insuredName,Ee.plaintiffName,Ee.insurerName,Ee.marketRef].filter(Boolean).join(" ").toLowerCase().includes(Ie)):oe})(),ne=ee?le.filter(Ie=>YN(Ie)||!!KN(Ie)):le,xe={ACTION_REQUIRED:[],WAITING_ON_OTHERS:[],IN_PROGRESS:[],SENT_COMPLETED:[]};return ne.forEach(Ie=>{const Ee=vp(Ie.status);xe[Ee].push(Ie)}),{mine:be,buckets:xe,filteredReports:ne}},[t,s,e.id,I,N,b,ee,k,C,H]),we=y.useMemo(()=>{const Z=new Set;let be=0,M=0,K=0,oe=0;return fe.forEach(le=>{le.status!=="SENT"&&(M+=1,Z.add(Ac(le))),vp(le.status)==="ACTION_REQUIRED"&&(be+=1),le.status==="READY_TO_SEND"&&(K+=1),le.expensesSheetId&&le.status!=="SENT"&&(oe+=1)}),{activeCasesCount:Z.size,actionRequiredCount:be,draftsInWorkCount:M,readyToSendCount:K,financeTasksCount:oe}},[fe]),{activeCasesCount:He,actionRequiredCount:Ue,draftsInWorkCount:Ze,readyToSendCount:ze,financeTasksCount:rt}=we,qe=y.useMemo(()=>fe.filter(Z=>Z.status==="WAITING_FOR_INVOICES").length,[fe]),j=fe.filter(Z=>!!Z.expensesSheetId&&Z.status!=="SENT");y.useEffect(()=>{const be=Array.from(new Set(j.map(M=>M.expensesSheetId).filter(M=>!!M))).filter(M=>!_[M]);be.length&&be.forEach(M=>{(async()=>{try{const K=await Je.getSheet(M);if(!K)return;const oe=_n(K.sheet,K.lineItems);P(le=>({...le,[M]:oe}))}catch{}})()})},[j,_]);const $=y.useMemo(()=>{const Z=new Map,be=K=>{const oe=Jl(K);if(!oe)return"";const le=oe.split(" - ");return le.length<=2?oe:le[le.length-2]||oe};return fe.forEach(K=>{if(!K.odakanitNo)return;const oe=K.odakanitNo.trim();if(!oe)return;const le=Z.get(oe)||{odakanitNo:oe,insuredName:K.insuredName||void 0,plaintiffName:K.plaintiffName||void 0,insurerName:K.insurerName||void 0,latestUpdatedAt:null,latestReportTitle:void 0,latestReportNumber:void 0,nextReportNumber:void 0,hasOpenWork:!1,hasUrgentWork:!1},ne=K.updatedAt||K.reportDate,xe=ne&&new Date(ne).getTime()||0,Ie=le.latestUpdatedAt&&new Date(le.latestUpdatedAt).getTime()||0;xe>=Ie&&(le.latestUpdatedAt=ne||le.latestUpdatedAt||null,le.insuredName=K.insuredName||le.insuredName,le.plaintiffName=K.plaintiffName||le.plaintiffName,le.insurerName=K.insurerName||le.insurerName,le.latestReportTitle=be(K)),K.status!=="SENT"&&!K.deletedAt&&(le.hasOpenWork=!0),(K.status==="TASK_ASSIGNED"||K.status==="WAITING_FOR_INVOICES"||K.status==="PENDING_REVIEW"||K.status==="READY_TO_SEND")&&(le.hasUrgentWork=!0),Z.set(oe,le)}),Array.from(Z.values()).map(K=>{var Ie;const oe=K.odakanitNo.trim(),le=[],ne=s[oe];(Ie=ne==null?void 0:ne.sentReports)!=null&&Ie.length&&ne.sentReports.forEach(Ee=>{typeof Ee.reportNo=="number"&&Ee.reportNo>0&&le.push(Ee.reportNo)}),t.forEach(Ee=>{var Me;if((Ee.odakanitNo||"").trim()===oe&&Ee.status==="SENT")if(typeof Ee.reportNumber=="number"&&Ee.reportNumber>0)le.push(Ee.reportNumber);else{const Ye=(((Me=Ee.reportHistory)==null?void 0:Me.length)||0)+1;le.push(Ye)}});const xe=le.length?Math.max(...le):0;return{...K,latestReportNumber:xe||void 0,nextReportNumber:(xe||0)+1}}).sort((K,oe)=>{const le=K.latestUpdatedAt&&new Date(K.latestUpdatedAt).getTime()||0;return(oe.latestUpdatedAt&&new Date(oe.latestUpdatedAt).getTime()||0)-le})},[fe]);y.useMemo(()=>new Set(G),[G]);const J=Z=>{p(Z.id)},pe=Z=>{const be=H===Z?null:Z;switch(z(be),be){case"ACTION":x("TASK_ASSIGNED");break;case"WAITING":x("WAITING_FOR_INVOICES");break;case"DRAFTS":x("READY_TO_SEND");break;case"FINANCE":x("ALL");break;case"ACTIVE":x("ALL");break;default:x("ALL");break}};N!=="ALL"||I.trim(),y.useEffect(()=>{if(!a)return;const Z=be=>{be.key==="Escape"&&o(!1)};return window.addEventListener("keydown",Z),()=>window.removeEventListener("keydown",Z)},[a,o]),y.useEffect(()=>{if(typeof window>"u"||!t.length)return;const Z=Sp(e.id);if(window.localStorage.getItem(Z)!=="1")try{const M=window.localStorage.getItem(Ic(e.id));if(!M){window.localStorage.setItem(Z,"1");return}const K=JSON.parse(M);if(!Array.isArray(K)){window.localStorage.setItem(Z,"1");return}const oe=[],le=ne=>{ne&&(oe.includes(ne)||oe.push(ne))};K.forEach(ne=>{if(typeof ne!="string")return;const xe=ne.trim();if(!xe)return;const Ie=xe.toLowerCase();if(Ie.startsWith("odakanit:")||Ie.startsWith("umr:")||Ie.startsWith("line:")||Ie.startsWith("cert:")||Ie.startsWith("insured:")||Ie.startsWith("plaintiff:")||Ie.startsWith("id:")){le(xe);return}const Me=t.find(Ye=>Ac(Ye)===xe?!0:Ye.id===xe||Ye.odakanitNo&&Ye.odakanitNo===xe||Ye.marketRef&&Ye.marketRef===xe);le(Me?Ac(Me):`odakanit:${xe}`)}),ae(oe),window.localStorage.setItem(Ic(e.id),JSON.stringify(oe)),window.localStorage.setItem(Z,"1")}catch{window.localStorage.setItem(Sp(e.id),"1")}},[t,e.id]),y.useMemo(()=>{if(!fe.length)return null;if(typeof window<"u")try{const be=window.localStorage.getItem(ZN),M=be?fe.find(K=>K.id===be&&!K.deletedAt):null;if(M)return M}catch{}return[...fe].sort((be,M)=>{const K=ne=>{const xe=ne.updatedAt||ne.reportDate;return xe&&new Date(xe).getTime()||0},oe=K(be);return K(M)-oe})[0]||null},[fe]);const me=()=>n.jsxs("div",{className:"relative",children:[n.jsxs("button",{type:"button",onClick:()=>o(!a),className:"relative inline-flex h-9 w-9 items-center justify-center rounded-full bg-gold/10 text-xs font-medium text-blue-700 hover:bg-blue-100 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-lpBlue focus-visible:ring-offset-2","aria-label":Re("openNotificationsAria"),title:Re("openNotificationsTitle"),children:[n.jsx(Gl,{className:"h-4 w-4","aria-hidden":"true"}),ie>0&&n.jsx("span",{className:"absolute -top-1.5 -right-1.5 inline-flex h-4 min-w-[16px] items-center justify-center rounded-full bg-red-500 px-1 text-[10px] font-bold text-white",children:ie})]}),a&&n.jsxs("div",{className:"absolute right-0 mt-2 w-80 rounded-lg border border-borderDark bg-panel text-xs shadow-xl z-50",children:[n.jsxs("div",{className:"flex items-center justify-between border-b px-3 py-2",children:[n.jsx("span",{className:"font-semibold text-textLight",children:Re("notificationTitle")}),n.jsxs("label",{className:"flex items-center gap-1 text-[11px] text-textMuted",children:[n.jsx("input",{type:"checkbox",checked:i,onChange:Z=>c(Z.target.checked),className:"h-3 w-3 rounded border-borderDark text-gold focus:ring-gold"}),Re("dailySummary")]})]}),n.jsxs("div",{className:"max-h-64 overflow-auto divide-y",children:[X.length===0&&n.jsx("div",{className:"p-4 text-center text-textMuted",children:Re("noNotifications")}),X.map(Z=>n.jsxs("div",{className:"p-3 space-y-1",children:[n.jsx("p",{className:"font-medium text-textLight",children:Z.message}),n.jsx("p",{className:"text-[10px] text-textMuted",children:new Date(Z.createdAt).toLocaleString()}),Z.reportId&&n.jsx("button",{type:"button",className:"mt-1 text-[11px] text-blue-700 hover:underline",onClick:()=>{p(Z.reportId),o(!1)},children:' " '})]},Z.id))]}),n.jsx("div",{className:"px-3 py-2 text-right",children:n.jsx("button",{type:"button",onClick:l,className:"text-[11px] font-medium text-red-500 hover:underline",children:Re("clearAll")})})]})]}),[he,je]=y.useState(""),[Be,Ve]=y.useState(!1),[tt,Ke]=y.useState(-1),ot=y.useMemo(()=>{const Z=he.trim();if(!Z)return[];const be=Z.toLowerCase(),M=Object.values(s),K=M.filter(ne=>ne.odakanitNo.toLowerCase().startsWith(be)),oe=M.filter(ne=>!ne.odakanitNo.toLowerCase().startsWith(be)&&ne.odakanitNo.toLowerCase().includes(be));return[...K,...oe].slice(0,8).map(ne=>({odakanitNo:ne.odakanitNo,insuredName:ne.insuredName,plaintiffName:ne.plaintiffName}))},[he,s]);return y.useEffect(()=>{if(!he.trim()){Ve(!1),Ke(-1);return}ot.length>0?(Ve(!0),Ke(0)):(Ve(!1),Ke(-1))},[he,ot.length]),n.jsx("div",{className:"min-h-screen bg-navySecondary px-0 pb-6 text-[15px]",dir:"rtl",lang:"he",children:n.jsxs("div",{className:"mx-auto max-w-6xl px-4",children:[n.jsxs("header",{className:"sticky top-0 z-20 mb-4 flex flex-col gap-3 border-b border-borderDark bg-panel/80 pb-3 pt-2 backdrop-blur-sm md:flex-row md:items-center md:justify-between",children:[n.jsxs("div",{children:[n.jsx("h1",{className:"text-2xl font-bold text-gold font-heebo",children:Re("dashboardTitle")}),n.jsxs("p",{className:"text-base text-textMuted text-right",children:[n.jsx("span",{className:"font-semibold",children:qN})," ",n.jsx("span",{className:"text-textMuted",children:XN}),n.jsx("span",{className:"text-textMuted",children:"  "}),Re("welcomeBack"),","," ",n.jsx("span",{className:"font-semibold",children:e.name})," ",n.jsxs("span",{className:"text-textMuted",children:["(",Re("roleLawyer"),")"]})]})]}),n.jsxs("div",{className:"flex flex-wrap items-center justify-start gap-2 md:justify-end",children:[n.jsx("button",{type:"button",onClick:h,className:"inline-flex h-9 w-9 items-center justify-center rounded-full bg-lpBlue text-sm font-semibold text-white shadow-sm hover:bg-blue-900 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-lpBlue focus-visible:ring-offset-2","aria-label":Re("openNewCaseFolderAria"),title:Re("openNewCaseFolderTitle"),children:n.jsx(Au,{className:"h-4 w-4","aria-hidden":"true"})}),me(),n.jsx("button",{type:"button",className:"inline-flex h-9 w-9 items-center justify-center rounded-full bg-gold/10 text-sm font-medium text-blue-700 hover:bg-blue-100 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-lpBlue focus-visible:ring-offset-2",onClick:()=>{const Z=new CustomEvent("openUserGuide");window.dispatchEvent(Z)},"aria-label":Re("openHelpCenterAria"),title:Re("openHelpCenterTitle"),children:n.jsx(ju,{className:"h-4 w-4","aria-hidden":"true"})}),n.jsx("button",{type:"button",onClick:A,className:"inline-flex h-9 w-9 items-center justify-center rounded-full text-sm font-semibold text-red-600 hover:bg-red-50 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-red-500 focus-visible:ring-offset-2","aria-label":Re("logoutAria"),title:Re("logoutTitle"),children:n.jsx(sh,{className:"h-4 w-4","aria-hidden":"true"})})]})]}),!1,n.jsxs("section",{className:"mb-3 rounded-2xl border border-borderDark bg-panel px-4 py-3 text-xs text-textLight shadow-sm",children:[n.jsx("h2",{className:"mb-1 text-sm font-semibold text-textLight",children:Re("workloadTitle")}),n.jsxs("div",{className:"flex flex-wrap gap-3 text-[11px] text-textLight mb-2",children:[n.jsxs("span",{children:[rt," ",Re("statsFinanceTasks")]}),n.jsxs("span",{children:[qe," ",Re("statsWaitingOnOthers")]}),n.jsxs("span",{children:[ze," ",Re("statsDraftsReady")]})]}),n.jsx("div",{className:"max-h-40 overflow-y-auto rounded-xl border border-dashed border-borderDark bg-navySecondary px-3 py-2",children:fe.filter(Z=>Z.status!=="SENT").length===0?n.jsx("p",{className:"text-[11px] text-textMuted",children:Re("emptyInProgressTitle")}):n.jsx("ul",{className:"space-y-1 text-[11px]",children:fe.filter(Z=>Z.status!=="SENT").sort((Z,be)=>{const M=K=>{const oe=K.updatedAt||K.reportDate;return oe&&new Date(oe).getTime()||0};return M(be)-M(Z)}).map(Z=>n.jsxs("li",{className:"flex items-center justify-between gap-2 border-b border-borderDark/70 pb-1 last:border-b-0",children:[n.jsxs("button",{type:"button",onClick:()=>J(Z),className:"flex-1 text-right hover:text-gold",children:[n.jsx("span",{className:"font-semibold",children:Z.insuredName||Z.plaintiffName||Re("untitledCase")}),Z.odakanitNo&&n.jsxs("span",{className:"text-textMuted",children:["  ",Z.odakanitNo]})]}),n.jsxs("span",{className:"whitespace-nowrap text-[10px] text-textMuted flex items-center gap-1",children:[n.jsx("span",{children:JN[Z.status]}),n.jsx(GN,{report:Z})]})]},Z.id))})})]}),!1,n.jsxs("section",{className:"mb-3 rounded-2xl border border-borderDark bg-panel px-4 py-3 text-xs text-textLight shadow-sm",children:[n.jsxs("div",{className:"flex items-center justify-between mb-2",children:[n.jsx("h2",{className:"text-sm font-semibold text-textLight",children:Re("caseListTitle")}),n.jsxs("span",{className:"text-[11px] text-textMuted",children:[$.length," ",Re("statsActiveCases")]})]}),n.jsx("p",{className:"mb-2 text-[11px] text-textMuted",children:Re("caseListHintActiveOnly")}),$.length===0?n.jsx("p",{className:"text-[11px] text-textMuted",children:Re("caseListEmpty")}):n.jsx("div",{className:"overflow-x-auto",children:n.jsxs("table",{className:"min-w-full table-fixed text-[11px]",children:[n.jsx("thead",{children:n.jsxs("tr",{className:"border-b border-borderDark bg-navySecondary",children:[n.jsx("th",{className:"px-2 py-1 text-right font-semibold w-32",children:Re("caseListHeaderOdakanit")}),n.jsx("th",{className:"px-2 py-1 text-right font-semibold w-40",children:Re("caseListHeaderInsurer")}),n.jsx("th",{className:"px-2 py-1 text-right font-semibold w-40",children:Re("caseListHeaderInsured")}),n.jsx("th",{className:"px-2 py-1 text-right font-semibold w-40",children:Re("caseListHeaderPlaintiff")}),n.jsx("th",{className:"px-2 py-1 text-right font-semibold w-20",children:Re("caseListHeaderReportNo")}),n.jsx("th",{className:"px-2 py-1 text-right font-semibold w-20",children:Re("caseListHeaderNextReportNo")??"Next report"})]})}),n.jsx("tbody",{children:$.map((Z,be)=>{const M=Z.hasUrgentWork,K=Z.hasOpenWork,oe=be%2===0?"bg-panel":"bg-navySecondary",le=M?"border-l-4 border-red-400 bg-red-50/80":K?"border-l-4 border-amber-300 bg-amber-50/70":"border-l border-transparent";return n.jsxs("tr",{className:`cursor-pointer border-b border-borderDark ${oe} ${le}`,onClick:()=>v(Z.odakanitNo),children:[n.jsx("td",{className:"px-2 py-1 text-right font-mono text-[11px]",children:n.jsx("button",{type:"button",className:"text-gold hover:underline",onClick:()=>v(Z.odakanitNo),children:Z.odakanitNo})}),n.jsx("td",{className:"px-2 py-1 text-right",children:Z.insurerName||""}),n.jsx("td",{className:"px-2 py-1 text-right",children:Z.insuredName||""}),n.jsx("td",{className:"px-2 py-1 text-right",children:Z.plaintiffName||""}),n.jsx("td",{className:"px-2 py-1 text-right font-mono text-[11px]",children:Z.latestReportNumber??""}),n.jsx("td",{className:"px-2 py-1 text-right font-mono text-[11px]",children:Z.nextReportNumber??(Z.latestReportNumber||0)+1})]},Z.odakanitNo)})})]})})]}),!1,!1,n.jsx(WN,{activeCases:He,actionRequired:Ue,waitingOnOthers:qe,draftsAndReady:ze,financeTasks:rt,selectedFilter:H,onChangeFilter:pe}),n.jsxs("section",{className:"mb-3 rounded-2xl border border-emerald-100 bg-panel px-4 py-3 text-xs text-textLight shadow-sm",children:[n.jsxs("div",{className:"flex items-center justify-between mb-2",children:[n.jsx("h2",{className:"text-sm font-semibold text-textLight",children:Re("financeReportsTitle")}),n.jsx("span",{className:"text-[11px] text-textMuted",children:rt})]}),n.jsx("p",{className:"mb-2 text-[11px] text-textMuted",children:Re("financeReportsHint")}),j.length===0?n.jsx("p",{className:"text-[11px] text-textMuted",children:Re("financeReportsEmpty")}):n.jsx("div",{className:"overflow-x-auto",children:n.jsxs("table",{className:"min-w-full table-fixed text-[11px]",children:[n.jsx("thead",{children:n.jsxs("tr",{className:"border-b border-borderDark bg-navySecondary",children:[n.jsx("th",{className:"px-2 py-1 text-right font-semibold w-48",children:Re("caseListHeaderTitle")}),n.jsx("th",{className:"px-2 py-1 text-right font-semibold w-20",children:Re("caseListHeaderReportNo")}),n.jsx("th",{className:"px-2 py-1 text-right font-semibold w-40",children:Re("caseListHeaderPlaintiff")}),n.jsx("th",{className:"px-2 py-1 text-right font-semibold w-40",children:Re("caseListHeaderInsured")}),n.jsx("th",{className:"px-2 py-1 text-right font-semibold w-40",children:Re("caseListHeaderInsurer")}),n.jsx("th",{className:"px-2 py-1 text-right font-semibold w-32",children:Re("caseListHeaderOdakanit")})]})}),n.jsx("tbody",{children:j.slice().sort((Z,be)=>{const M=K=>{const oe=K.updatedAt||K.reportDate;return oe&&new Date(oe).getTime()||0};return M(be)-M(Z)}).map(Z=>{var le;const be=Jl(Z),M=be.split(" - "),K=M.length>2&&M[M.length-2]||be,oe=(((le=Z.reportHistory)==null?void 0:le.length)||0)+1;return n.jsxs("tr",{className:"cursor-pointer border-b border-borderDark hover:bg-emerald-50/60",onClick:()=>{Z.odakanitNo?v(Z.odakanitNo):J(Z)},children:[n.jsxs("td",{className:"px-2 py-1 text-right",children:[n.jsx("div",{className:"font-semibold text-textLight",children:K||""}),Z.updatedAt&&n.jsx("div",{className:"text-[10px] text-textMuted",children:new Date(Z.updatedAt).toLocaleString("he-IL")})]}),n.jsx("td",{className:"px-2 py-1 text-right font-mono text-[11px]",children:oe}),n.jsx("td",{className:"px-2 py-1 text-right",children:Z.plaintiffName||""}),n.jsx("td",{className:"px-2 py-1 text-right",children:Z.insuredName||""}),n.jsx("td",{className:"px-2 py-1 text-right",children:Z.insurerName||""}),n.jsx("td",{className:"px-2 py-1 text-right font-mono text-[11px]",children:Z.odakanitNo||""})]},Z.id)})})]})})]}),!1]})})},tb="modulepreload",nb=function(e){return"/"+e},wp={},sb=function(t,s,r){let a=Promise.resolve();if(s&&s.length>0){document.getElementsByTagName("link");const l=document.querySelector("meta[property=csp-nonce]"),i=(l==null?void 0:l.nonce)||(l==null?void 0:l.getAttribute("nonce"));a=Promise.allSettled(s.map(c=>{if(c=nb(c),c in wp)return;wp[c]=!0;const m=c.endsWith(".css"),p=m?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${c}"]${p}`))return;const h=document.createElement("link");if(h.rel=m?"stylesheet":tb,m||(h.as="script"),h.crossOrigin="",h.href=c,i&&h.setAttribute("nonce",i),document.head.appendChild(h),m)return new Promise((v,A)=>{h.addEventListener("load",v),h.addEventListener("error",()=>A(new Error(`Unable to preload CSS for ${c}`)))})}))}function o(l){const i=new Event("vite:preloadError",{cancelable:!0});if(i.payload=l,window.dispatchEvent(i),!i.defaultPrevented)throw l}return a.then(l=>{for(const i of l||[])i.status==="rejected"&&o(i.reason);return t().catch(o)})},rb={:"January",:"February",:"March",:"April",:"May",:"June",:"July",:"August",:"September",:"October",:"November",:"December"},ab=e=>{let t=e.trim();return t=t.replace(/Reporl/gi,"Report"),t=t.replace(/Rep0rt/gi,"Report"),t=t.replace(/Repcrt/gi,"Report"),t=t.replace(/\s+/g," "),t},ob=e=>{try{let t=e;Object.entries(rb).forEach(([r,a])=>{const o=new RegExp(r,"gi");t=t.replace(o,a)});const s=new Date(t);return Number.isNaN(s.getTime())?void 0:s.toISOString().slice(0,10)}catch{return}};async function lb(e){var t,s,r;try{const o=await(await sb(()=>import("./index-rLArz-xw.js").then(I=>I.i),[])).recognize(e,"eng+heb",{logger:()=>{}}),l=((t=o==null?void 0:o.data)==null?void 0:t.lines)||((r=(s=o==null?void 0:o.data)==null?void 0:s.text)==null?void 0:r.split(/\r?\n/).filter(I=>I.trim().length>0).map(I=>({text:I})))||[],i=[],c={},m="(January|February|March|April|May|June|July|August|September|October|November|December||||||||||||)",p=new RegExp(`Report\\s*(\\d+)\\s*-\\s*(.*?),\\s*(${m}\\s+\\d{1,2},\\s*\\d{4})\\.?$`,"i"),h=/^\s*(Line\s*Slip\s*No\.?|LineSlip\s*No\.?)\s*[:\-]?\s*(.+)\s*$/i,v=/^\s*Unique\s+Market\s+Ref\.?\s*[:\-]?\s*(.+)\s*$/i,A=/^\s*Insured\s*[:\-]?\s*(.+)\s*$/i,D=/^\s*(Plaintiff|Claimant)\s*[:\-]?\s*(.+)\s*$/i;return l.forEach(I=>{const W=I.text||"";if(!W.trim())return;const N=ab(W),x=N.match(p);if(x){const Y=Number.parseInt(x[1],10),Q=(x[2]||"").trim().replace(/[.,]\s*$/,""),G=x[3]||"",ae=ob(G);if(!Y||!ae||!Q||Q.length<2)return;i.push({reportNo:Y,title:Q,sentAt:ae,rawLine:W,confidence:typeof I.confidence=="number"?Math.round(I.confidence):void 0});return}const b=N.match(h);b&&!c.lineSlipNo&&(c.lineSlipNo=b[2].trim());const B=N.match(v);B&&!c.marketRef&&(c.marketRef=B[1].trim());const H=N.match(A);H&&!c.insuredName&&(c.insuredName=H[1].trim());const z=N.match(D);z&&!c.plaintiffOrClaimant&&(c.plaintiffOrClaimant=z[2].trim())}),i.sort((I,W)=>(I.reportNo||0)-(W.reportNo||0)),{previousReports:i,identifiers:c}}catch(a){return console.error("OCR failed",a),{previousReports:[],identifiers:{}}}}const jp="seedShortcutsStickerCollapsed_v1",ib=()=>{const[e,t]=y.useState(()=>{if(typeof window>"u")return!1;try{return window.localStorage.getItem(jp)==="1"}catch{return!1}});return y.useEffect(()=>{if(!(typeof window>"u"))try{window.localStorage.setItem(jp,e?"1":"0")}catch{}},[e]),n.jsx("div",{className:"fixed bottom-4 right-4 z-[260] max-w-xs text-[11px] text-slate-800",style:{pointerEvents:"none"},children:n.jsxs("div",{className:"rounded-xl shadow-lg border border-amber-200 bg-amber-50/95 px-3 py-2",style:{pointerEvents:"auto"},children:[n.jsxs("div",{className:"flex items-center justify-between gap-2 mb-1",children:[n.jsxs("div",{className:"font-semibold flex items-center gap-1",children:[n.jsx("span",{children:""}),n.jsx("span",{children:"Shortcuts"})]}),n.jsx("button",{type:"button",className:"text-[10px] text-slate-600 hover:text-slate-900",onClick:()=>t(s=>!s),children:e?"+":""})]}),!e&&n.jsxs("div",{className:"space-y-1",children:[n.jsx("div",{className:"font-semibold text-[10px] text-slate-700",children:"Screenshot"}),n.jsxs("ul",{className:"space-y-0.5",children:[n.jsx("li",{children:"Ctrl /  + V  Paste screenshot"}),n.jsx("li",{children:"Ctrl /  + Shift + O  Run OCR"})]}),n.jsx("div",{className:"font-semibold text-[10px] text-slate-700 mt-1",children:"Reports table"}),n.jsxs("ul",{className:"space-y-0.5",children:[n.jsx("li",{children:"Enter  Next field"}),n.jsx("li",{children:"Shift + Enter  New report row (below)"}),n.jsx("li",{children:"Ctrl /  + Enter  New report row"})]}),n.jsx("div",{className:"font-semibold text-[10px] text-slate-700 mt-1",children:"Apply"}),n.jsx("ul",{className:"space-y-0.5",children:n.jsx("li",{children:"Ctrl /  + S  Approve & Apply"})}),n.jsx("div",{className:"font-semibold text-[10px] text-slate-700 mt-1",children:"Navigation"}),n.jsx("ul",{className:"space-y-0.5",children:n.jsx("li",{children:"Ctrl + Alt +  /   Previous / Next case"})}),n.jsx("div",{className:"text-[9px] text-slate-500 mt-1",children:"Shortcuts work only in this screen."})]})]})})},Fu="seedDraftCases_v1",Eh="seedDraftFinalized_v1",cb=7,db=e=>e.replace(/^\uFEFF/,"").trim().toLowerCase().replace(/[\s_]+/g,"").replace(/[^a-z0-9]/g,""),Ep=(e,t)=>{const s=[];let r="",a=!1;for(let o=0;o<e.length;o+=1){const l=e[o];if(l==='"'){a&&e[o+1]==='"'?(r+='"',o+=1):a=!a;continue}if(l===t&&!a){s.push(r),r="";continue}r+=l}return s.push(r),s.map(o=>o.trim())},ub=e=>{const s=e.split(/\r?\n/).map(D=>D.trim()).filter(D=>D.length>0);if(!s.length)return{drafts:[],error:" CSV .         ."};const r=s[0].replace(/^\uFEFF/,""),a=(r.match(/,/g)||[]).length,o=(r.match(/;/g)||[]).length,l=r.includes("	"),i=o>a?";":a>0?",":l?"	":",",c=Ep(r,i);if(!c.length)return{drafts:[],error:"  CSV  .    : odakanitNo,assignedLawyer"};const m=c.map(D=>db(D)),p=m.findIndex(D=>D==="odakanitno"),h=m.findIndex(D=>D==="assignedlawyer");if(p<0||h<0)return{drafts:[],error:`   .       : odakanitNo,assignedLawyer ( ). :
odakanitNo,assignedLawyer`};const v=[],A=new Set;for(let D=1;D<s.length;D+=1){const I=s[D];if(!I)continue;const W=Ep(I,i),N=W[p]||"",x=Se(N);if(!x||A.has(x))continue;A.add(x);const b=(W[h]||"").trim();if(!b)return{drafts:[],error:` ${D+1}  AssignedLawyer   ${x}.    /  .`,delimiter:i};const B=b.toLowerCase();if(!hs.find(z=>z.id.toLowerCase()===B||z.username.toLowerCase()===B)){const z=hs.map(Y=>`${Y.username} (id: ${Y.id})`).join(", ");return{drafts:[],error:` ${D+1}  AssignedLawyer="${b}"   ${x}     .
       (id)    .
  : ${z}`,delimiter:i}}v.push({odakanitNo:x,assignedLawyer:b,reports:[],status:"MISSING_HISTORY"})}return v.length?{drafts:v,delimiter:i}:{drafts:[],error:"    CSV.       odakanitNo assignedLawyer  .",delimiter:i}},kh=e=>{try{return JSON.stringify(e)}catch{return"[]"}},mb=()=>{if(typeof window>"u")return[];try{const e=window.localStorage.getItem(Fu);if(!e)return[];const t=JSON.parse(e);return Array.isArray(t)?t:[]}catch{return[]}},pb=e=>{if(!(typeof window>"u"))try{window.localStorage.setItem(Fu,kh(e))}catch{}},fb=()=>{if(typeof window>"u")return!1;try{return window.localStorage.getItem(Eh)==="1"}catch{return!1}},xb=()=>{if(!(typeof window>"u"))try{window.localStorage.setItem(Eh,"1")}catch{}},hb=(e,t,s=cb)=>{if(!e)return!1;const{odakanitNo:r,seededAt:a,seedSourceLastReportNo:o,seedSourceLastReportDate:l}=e,i=Se(r);if(!i||!!!(a||o||l))return!1;const m=t.filter(p=>!p.deletedAt&&Se(p.odakanitNo)===i);if(m.length>0){const p=typeof o=="number"?o:0,h=l?new Date(l).getTime():0;let v=0,A=0;if(m.forEach(D=>{typeof D.reportNumber=="number"&&D.reportNumber>v&&(v=D.reportNumber);const I=new Date(D.sentAt||D.reportDate).getTime();!Number.isNaN(I)&&I>A&&(A=I)}),v>p&&p>0||A>h&&h>0)return!0}if(a){const p=new Date(a).getTime();if(!Number.isNaN(p)&&(Date.now()-p)/(1e3*60*60*24)>s)return!0}return!!(a&&(o==null||Number.isNaN(o)))},gb=({caseFolders:e,onUpdateCaseFolders:t,reports:s})=>{const[r,a]=y.useState(()=>mb()),[o,l]=y.useState(""),[i,c]=y.useState(null),[m,p]=y.useState(!1),[h,v]=y.useState(null),[A,D]=y.useState(null);y.useEffect(()=>{pb(r)},[r]);const I=fb(),W=y.useMemo(()=>r.find(E=>E.odakanitNo===i)||null,[r,i]),N=()=>{const E=`odakanitNo,assignedLawyer
`,R=new Blob([E],{type:"text/csv;charset=utf-8;"}),k=URL.createObjectURL(R),C=document.createElement("a");C.href=k,C.download="seed-cases-template.csv",document.body.appendChild(C),C.click(),document.body.removeChild(C),URL.revokeObjectURL(k)},x=()=>{const{drafts:E,error:R,delimiter:k}=ub(o);if(R){v(R),D(null);return}v(null),E.length?D(`Loaded ${E.length} cases. Detected delimiter: "${k||","}".`):D(null),a(E)},b=()=>{const E=kh(r),R=new Blob([E],{type:"application/json;charset=utf-8;"}),k=URL.createObjectURL(R),C=document.createElement("a");C.href=k,C.download="seedDraftCases_v1.json",document.body.appendChild(C),C.click(),document.body.removeChild(C),URL.revokeObjectURL(k)},B=()=>{window.confirm("   -Seed (   CaseFolders)?")&&(a([]),typeof window<"u"&&window.localStorage.removeItem(Fu))},H=()=>{window.confirm(" Finalize    . ?")&&xb()},z=E=>E.status==="APPLIED"?"APPLIED":E.reports&&E.reports.length>0?"READY":"MISSING_HISTORY",Y=E=>{E.reports.length&&(t(R=>{var Ze,ze,rt,qe;const k=Se(E.odakanitNo);if(!k)return R;const C=R[k],ee=new Date().toISOString(),V=C||{odakanitNo:k,reTemplate:(C==null?void 0:C.reTemplate)||"",insuredName:(C==null?void 0:C.insuredName)||"",insurerName:(C==null?void 0:C.insurerName)||"",plaintiffName:(C==null?void 0:C.plaintiffName)||"",marketRef:(C==null?void 0:C.marketRef)||"",lineSlipNo:(C==null?void 0:C.lineSlipNo)||"",certificateRef:(C==null?void 0:C.certificateRef)||"",createdAt:(C==null?void 0:C.createdAt)||ee,updatedAt:(C==null?void 0:C.updatedAt)||ee,reportIds:(C==null?void 0:C.reportIds)||[],sentReports:(C==null?void 0:C.sentReports)||[]},_=[...V.sentReports];let P=0,X=null;E.reports.forEach(j=>{if(!j.reportNo||!j.title||!j.sentAt)return;const $=_.findIndex(pe=>pe.reportNo===j.reportNo),J={odakanitNo:k,reportNumber:j.reportNo,insurerName:V.insurerName,insuredName:E.insuredName||V.insuredName,plaintiffName:E.plaintiffName||V.plaintiffName,reportSubject:j.title,reportDate:j.sentAt};$>=0?_[$]={..._[$],reportNo:j.reportNo,sentAt:j.sentAt,snapshot:{..._[$].snapshot||{},...J}}:_.push({reportId:`seed-${k.replace(/[^\w-]+/g,"_")}-${j.reportNo}`,reportNo:j.reportNo,sentAt:j.sentAt,fileName:void 0,snapshot:J}),j.reportNo>P&&(P=j.reportNo),j.sentAt&&(!X||j.sentAt>X)&&(X=j.sentAt)}),_.sort((j,$)=>(j.reportNo||0)-($.reportNo||0));const ie=((Ze=E.insuredName)==null?void 0:Ze.trim())||V.insuredName||void 0,fe=((ze=E.plaintiffName)==null?void 0:ze.trim())||V.plaintiffName||void 0,se=((rt=E.lineSlipNo)==null?void 0:rt.trim())||V.lineSlipNo||void 0,ue=((qe=E.marketRef)==null?void 0:qe.trim())||V.marketRef||void 0,we=[];(ie||fe)&&we.push(`Re: ${ie||""}${ie&&fe?" / ":""}${fe||""}`.trim()),se&&we.push(`LineSlip No. ${se}`),ue&&we.push(`Unique Market Ref: ${ue}`);const He=we.join(`
`),Ue={...V,insuredName:ie||V.insuredName,plaintiffName:fe||V.plaintiffName,lineSlipNo:se||V.lineSlipNo,marketRef:ue||V.marketRef,assignedLawyer:E.assignedLawyer||(C==null?void 0:C.assignedLawyer),reTemplate:He||V.reTemplate,seededAt:ee,seedSourceLastReportNo:P||V.seedSourceLastReportNo,seedSourceLastReportDate:X||V.seedSourceLastReportDate,updatedAt:ee,sentReports:_};return{...R,[k]:Ue}}),a(R=>R.map(k=>k.odakanitNo===E.odakanitNo?{...k,status:"APPLIED"}:k)))},Q=r.map(E=>{const R=z(E),k=E.reports.length,C=k>0?E.reports.map(X=>X.sentAt).filter(Boolean).sort().slice(-1)[0]:"",ee=e[Se(E.odakanitNo)],V=hb(ee,s),_=(ee==null?void 0:ee.seededAt)||null,P=ee!=null&&ee.seedSourceLastReportNo&&ee.seedSourceLastReportDate?`#${ee.seedSourceLastReportNo} (${ee.seedSourceLastReportDate})`:"";return{draft:E,status:R,reportsCount:k,lastDate:C,stale:V,lastSeedInfo:_,seedSummary:P}}).filter(E=>m?E.stale:!0),G=r.length,ae=r.filter(E=>z(E)==="APPLIED").length;return n.jsxs("div",{className:"mt-6 border border-slate-200 rounded-xl p-4 bg-white",children:[n.jsxs("div",{className:"flex items-center justify-between mb-3",children:[n.jsxs("div",{className:"space-y-0.5",children:[n.jsx("h2",{className:"text-sm font-semibold text-slate-900",children:"Seed Existing Cases (Admin only)"}),n.jsxs("div",{className:"text-[11px] text-slate-600",children:[n.jsxs("span",{className:"font-semibold",children:[ae," / ",G||0]})," ","cases completed",G>0&&ae===G&&n.jsx("span",{className:"ml-2 text-emerald-600 font-medium",children:" All cases completed"})]})]}),I&&n.jsx("span",{className:"text-[11px] px-2 py-0.5 rounded-full bg-emerald-50 text-emerald-700 border border-emerald-200",children:"Finalized  read only"})]}),n.jsxs("div",{className:"grid md:grid-cols-2 gap-4 text-xs",children:[n.jsxs("div",{className:"space-y-2",children:[n.jsx("h3",{className:"font-semibold text-slate-800",children:"1) Download Template CSV"}),n.jsx("p",{className:"text-slate-600",children:"       CSV   .  : odakanitNo, assignedLawyer."}),n.jsx("button",{type:"button",className:"px-3 py-1.5 rounded bg-slate-800 text-white hover:bg-slate-900",onClick:N,children:"Download Seed Template (CSV)"})]}),n.jsxs("div",{className:"space-y-2",children:[n.jsx("h3",{className:"font-semibold text-slate-800",children:"2) Import Cases CSV"}),n.jsx("p",{className:"text-slate-600",children:"     CSV (  )  Parse.      (localStorage)."}),n.jsx("textarea",{className:"w-full border border-slate-300 rounded p-2 h-24 font-mono",value:o,onChange:E=>l(E.target.value),disabled:I}),h&&n.jsx("div",{className:"mt-1 text-[11px] text-rose-700 bg-rose-50 border border-rose-200 rounded px-2 py-1 whitespace-pre-line",children:h}),A&&!h&&n.jsx("div",{className:"mt-1 text-[11px] text-slate-600",children:A}),n.jsx("button",{type:"button",className:"px-3 py-1.5 rounded bg-blue-600 text-white hover:bg-blue-700 disabled:opacity-50",onClick:x,disabled:I,children:"Parse CSV"})]})]}),n.jsxs("div",{className:"mt-4",children:[n.jsxs("div",{className:"flex items-center justify-between mb-1",children:[n.jsx("h3",{className:"text-xs font-semibold text-slate-800",children:"Imported Cases"}),n.jsxs("label",{className:"flex items-center gap-1 text-[11px] text-slate-600",children:[n.jsx("input",{type:"checkbox",className:"rounded border-slate-300",checked:m,onChange:E=>p(E.target.checked)}),"Show only stale cases"]})]}),Q.length===0?n.jsx("p",{className:"text-xs text-slate-500",children:"   ."}):n.jsx("div",{className:"border border-slate-200 rounded overflow-hidden",children:n.jsxs("table",{className:"min-w-full text-[11px]",children:[n.jsx("thead",{className:"bg-slate-50",children:n.jsxs("tr",{children:[n.jsx("th",{className:"px-2 py-1 text-right",children:"odakanitNo"}),n.jsx("th",{className:"px-2 py-1 text-right",children:"Lawyer"}),n.jsx("th",{className:"px-2 py-1 text-right",children:"Status"}),n.jsx("th",{className:"px-2 py-1 text-right",children:"Fresh / Stale"}),n.jsx("th",{className:"px-2 py-1 text-right",children:"#Reports"}),n.jsx("th",{className:"px-2 py-1 text-right",children:"Last date"}),n.jsx("th",{className:"px-2 py-1 text-right",children:"Actions"})]})}),n.jsx("tbody",{children:Q.map(({draft:E,status:R,reportsCount:k,lastDate:C,stale:ee,lastSeedInfo:V,seedSummary:_})=>{var P;return n.jsxs("tr",{className:`border-t border-slate-200 ${ee?"bg-amber-50":""}`,children:[n.jsx("td",{className:"px-2 py-1 font-mono",children:E.odakanitNo}),n.jsx("td",{className:"px-2 py-1",children:E.assignedLawyer||((P=hs.find(X=>X.id===E.assignedLawyer||X.username===E.assignedLawyer))==null?void 0:P.name)||""}),n.jsx("td",{className:"px-2 py-1",children:R==="APPLIED"?"APPLIED":R==="READY"?"READY":"MISSING_HISTORY"}),n.jsx("td",{className:"px-2 py-1",children:R==="APPLIED"?n.jsxs("div",{className:"space-y-0.5",children:[n.jsx("div",{className:ee?"text-amber-700 font-semibold":"text-emerald-700 font-semibold",children:ee?"STALE":"FRESH"}),V&&n.jsxs("div",{className:"text-[9px] text-slate-500",children:["Last seeded: ",new Date(V).toLocaleDateString()]}),_&&n.jsxs("div",{className:"text-[9px] text-slate-500",children:["Seed based on ",_]})]}):n.jsx("span",{className:"text-[10px] text-slate-400",children:""})}),n.jsx("td",{className:"px-2 py-1 text-center",children:k}),n.jsx("td",{className:"px-2 py-1",children:C||""}),n.jsxs("td",{className:"px-2 py-1 text-left",children:[n.jsx("button",{type:"button",className:"px-2 py-0.5 rounded border border-slate-300 text-slate-700 hover:bg-slate-50 mr-2",onClick:()=>c(E.odakanitNo),disabled:I,children:ee?"Re-seed":"Edit"}),n.jsx("button",{type:"button",className:"px-2 py-0.5 rounded border border-emerald-400 text-emerald-700 hover:bg-emerald-50 disabled:opacity-50",onClick:()=>Y(E),disabled:R==="MISSING_HISTORY"||I,children:"Apply"})]})]},E.odakanitNo)})})]})})]}),W&&n.jsx("div",{className:"mt-6 border-t border-slate-200 pt-4",children:n.jsx(yb,{draft:W,index:r.findIndex(E=>E.odakanitNo===W.odakanitNo),total:r.length,finalized:I,onChangeDraft:E=>{a(R=>R.map(k=>k.odakanitNo===E.odakanitNo?E:k))},onApply:Y,onNavigateRelative:E=>{const R=r.findIndex(C=>C.odakanitNo===W.odakanitNo);if(R<0)return;const k=R+E;k<0||k>=r.length||c(r[k].odakanitNo)},onResetSeedMeta:()=>{const E=Se(W.odakanitNo);E&&(t(R=>{const k=R[E];if(!k)return R;const{seededAt:C,seedSourceLastReportNo:ee,seedSourceLastReportDate:V,..._}=k;return{...R,[E]:_}}),a(R=>R.map(k=>k.odakanitNo===W.odakanitNo?{...k,reports:[],status:"MISSING_HISTORY"}:k)))}})}),n.jsxs("div",{className:"mt-4 flex flex-wrap gap-2 text-xs",children:[n.jsx("button",{type:"button",className:"px-3 py-1.5 rounded border border-slate-300 text-slate-700 hover:bg-slate-50",onClick:b,children:"Export Draft JSON"}),n.jsx("button",{type:"button",className:"px-3 py-1.5 rounded border border-rose-300 text-rose-700 hover:bg-rose-50",onClick:B,disabled:I,children:"Clear Draft Only"}),n.jsx("button",{type:"button",className:"px-3 py-1.5 rounded border border-emerald-400 text-emerald-700 hover:bg-emerald-50 ml-auto disabled:opacity-50",onClick:H,disabled:I,children:"Finalize (readonly)"})]})]})};function yb({draft:e,index:t,total:s,finalized:r,onChangeDraft:a,onApply:o,onNavigateRelative:l,onResetSeedMeta:i}){const[c,m]=y.useState(null),[p,h]=y.useState([]),[v,A]=y.useState([]),[D,I]=y.useState(!1),W=y.useRef([]),N=y.useRef(null);y.useEffect(()=>{m(null),h([]),A([])},[e.odakanitNo]),y.useEffect(()=>{const R=k=>{var P;if(!e||r)return;const C=(P=k.clipboardData)==null?void 0:P.items;if(!C||C.length===0)return;const ee=Array.from(C).find(X=>X.type&&X.type.startsWith("image/"));if(!ee){m("Clipboard does not contain an image.");return}const V=ee.getAsFile();if(!V)return;const _=new FileReader;_.onload=()=>{const X=_.result;a({...e,screenshotDataUrl:X}),m(null)},_.readAsDataURL(V)};return window.addEventListener("paste",R),()=>{window.removeEventListener("paste",R)}},[e,r,a]),y.useEffect(()=>{const R=k=>{const C=k.target,ee=C&&(C.tagName==="INPUT"||C.tagName==="TEXTAREA"||C.isContentEditable),_=navigator.platform.toUpperCase().includes("MAC")?k.metaKey:k.ctrlKey;if(!(ee&&!_)){if(_&&!k.shiftKey&&!k.altKey&&k.key.toLowerCase()==="s"){if(k.preventDefault(),!r){if(x())return;o(e)}return}if(_&&k.shiftKey&&!k.altKey&&k.key.toLowerCase()==="o"){k.preventDefault(),!r&&e.screenshotDataUrl&&!D&&Q();return}if(_&&!k.shiftKey&&!k.altKey&&k.key==="Enter"){k.preventDefault(),r||b();return}if(_&&k.altKey&&(k.key==="ArrowDown"||k.key==="ArrowUp")){k.preventDefault();const P=k.key==="ArrowDown"?1:-1;if(x(!0)&&!window.confirm("This case has invalid rows. Navigate to another case anyway?"))return;l(P)}if(!_&&!k.altKey&&!k.shiftKey&&k.key==="/"){const P=document.getElementById("seed-cases-search-input");P&&(k.preventDefault(),P.focus())}}};return window.addEventListener("keydown",R),()=>{window.removeEventListener("keydown",R)}},[e,r,o,l,D]);const x=(R=!1)=>{var V;const k=[];let C=!1;if(!e.reports||e.reports.length===0)return m("   ."),!0;const ee=new Set;if(e.reports.forEach((_,P)=>{const X={};!Number.isInteger(_.reportNo)||_.reportNo<=0?X.reportNo="     .":ee.has(_.reportNo)?X.reportNo="  .":ee.add(_.reportNo),_.sentAt?Number.isNaN(new Date(_.sentAt).getTime())&&(X.sentAt="  ."):X.sentAt=" .",(!_.title||_.title.trim().length<2)&&(X.title="  ( 2 )."),(X.reportNo||X.sentAt||X.title)&&(C=!0),k[P]=X}),h(k),m(C?"    .":null),C&&!R){const _=k.findIndex(P=>P.reportNo||P.sentAt||P.title);_>=0&&W.current[_]&&((V=W.current[_])==null||V.focus())}return C},b=()=>{const R=e.reports.length>0?Math.max(...e.reports.map(C=>C.reportNo||0)):0,k={...e,reports:[...e.reports,{reportNo:R+1,sentAt:"",title:""}]};a(k)},B=R=>{const k=e.reports[R],C=e.reports.length>0?Math.max(...e.reports.map(P=>P.reportNo||0)):0,V={reportNo:(k&&Number.isInteger(k.reportNo)&&k.reportNo>0?k.reportNo:C)+1,sentAt:"",title:""},_=[...e.reports];_.splice(R+1,0,V),a({...e,reports:_}),setTimeout(()=>{const P=W.current[R+1];P&&P.focus()},0)},H=(R,k)=>{R.key==="Enter"&&R.shiftKey&&!R.ctrlKey&&!R.metaKey&&!R.altKey&&(R.preventDefault(),r||B(k))},z=(R,k,C)=>{const ee=e.reports.map((V,_)=>_===R?{...V,[k]:k==="reportNo"?Number(C.replace(/[^\d]/g,""))||0:C}:V);a({...e,reports:ee})},Y=R=>{const k=e.reports.filter((C,ee)=>ee!==R);a({...e,reports:k})},Q=async()=>{if(e.screenshotDataUrl){I(!0);try{const{previousReports:R,identifiers:k}=await lb(e.screenshotDataUrl);A(R);const C={...e,insuredName:k.insuredName||e.insuredName,plaintiffName:k.plaintiffOrClaimant||e.plaintiffName,lineSlipNo:k.lineSlipNo||e.lineSlipNo,marketRef:k.marketRef||e.marketRef};a(C),R.length?m(null):m("   .   .")}catch{m("OCR .   .")}finally{I(!1)}}},G=()=>{if(!v.length)return;const R=v.filter(k=>k.reportNo&&k.sentAt&&k.title).map(k=>({reportNo:k.reportNo,sentAt:k.sentAt,title:k.title}));R.length&&(a({...e,reports:R}),m(null),h([]))},ae=R=>{var ee;const k=(ee=R.target.files)==null?void 0:ee[0];if(!k)return;const C=new FileReader;C.onload=()=>{const V=C.result;a({...e,screenshotDataUrl:V}),m(null)},C.readAsDataURL(k)},E=e.screenshotDataUrl;return n.jsxs("div",{className:"mt-2 rounded-lg border border-slate-200 bg-slate-50 p-3 text-[11px] relative",children:[n.jsxs("div",{className:"flex items-center justify-between mb-2",children:[n.jsxs("div",{className:"font-semibold text-slate-800",children:["Case editor  ",e.odakanitNo," ",n.jsxs("span",{className:"text-slate-500",children:["(",t+1,"/",s,")"]})]}),n.jsxs("div",{className:"flex items-center gap-3",children:[n.jsx("button",{type:"button",className:"text-[10px] px-2 py-1 rounded border border-amber-300 text-amber-700 hover:bg-amber-50",onClick:i,disabled:r,children:"Re-seed this case"}),n.jsx("div",{className:"text-[10px] text-slate-500 hidden md:block",children:" : Ctrl+S / S  Apply, Ctrl+Enter   , Ctrl+Shift+O  OCR, Ctrl+Alt+/   "})]})]}),c&&n.jsx("div",{className:"mb-2 rounded bg-amber-50 border border-amber-200 px-2 py-1 text-[11px] text-amber-900",children:c}),n.jsxs("div",{className:"grid md:grid-cols-2 gap-3",children:[n.jsxs("div",{className:"space-y-2",children:[n.jsx("div",{className:"font-semibold text-slate-800",children:"Screenshot / OCR"}),n.jsxs("div",{ref:N,tabIndex:0,className:"border border-dashed border-slate-300 rounded-lg p-2 text-center text-slate-600 bg-white cursor-pointer hover:border-slate-400 focus:outline-none focus:ring-1 focus:ring-slate-400",onClick:()=>{var R;return(R=N.current)==null?void 0:R.focus()},children:[n.jsx("div",{className:"mb-1 font-medium text-slate-800",children:"Click here and press Ctrl+V / V to paste screenshot"}),n.jsx("div",{className:"text-[10px] text-slate-500 mb-2",children:"or choose file from disk"}),n.jsx("input",{type:"file",accept:"image/*",onChange:ae,disabled:r,className:"mx-auto block text-[10px]"})]}),E&&n.jsxs("div",{className:"mt-2",children:[n.jsx("div",{className:"text-[10px] text-slate-600 mb-1",children:"Preview:"}),n.jsx("div",{className:"border border-slate-200 rounded overflow-hidden bg-white max-h-64 flex items-center justify-center",children:n.jsx("img",{src:E,alt:"Seed screenshot",className:"max-h-64"})})]}),n.jsx("div",{className:"flex items-center gap-2 mt-2",children:n.jsx("button",{type:"button",onClick:Q,disabled:!E||r||D,className:"px-3 py-1.5 rounded bg-indigo-600 text-white disabled:opacity-50 text-[11px]",children:D?"Running OCR":"Extract Previous Reports from Screenshot"})}),v.length>0&&n.jsxs("div",{className:"mt-2 border border-slate-200 rounded bg-white p-2",children:[n.jsxs("div",{className:"flex items-center justify-between mb-1",children:[n.jsxs("div",{className:"font-semibold text-slate-800 text-[11px]",children:["Proposed extraction (",v.length,")"]}),n.jsx("button",{type:"button",className:"px-2 py-0.5 rounded bg-slate-800 text-white text-[10px]",onClick:G,disabled:r,children:"Apply to table"})]}),n.jsx("div",{className:"max-h-40 overflow-auto text-[10px]",children:n.jsxs("table",{className:"min-w-full border-collapse",children:[n.jsx("thead",{children:n.jsxs("tr",{className:"bg-slate-50",children:[n.jsx("th",{className:"px-1 py-0.5 text-right",children:"#"}),n.jsx("th",{className:"px-1 py-0.5 text-right",children:"Title"}),n.jsx("th",{className:"px-1 py-0.5 text-right",children:"Date"}),n.jsx("th",{className:"px-1 py-0.5 text-right",children:"Conf."})]})}),n.jsx("tbody",{children:v.map((R,k)=>n.jsxs("tr",{className:"border-t border-slate-100",children:[n.jsx("td",{className:"px-1 py-0.5 text-right",children:R.reportNo??""}),n.jsx("td",{className:"px-1 py-0.5 text-right",children:R.title||""}),n.jsx("td",{className:"px-1 py-0.5 text-right",children:R.sentAt||""}),n.jsx("td",{className:"px-1 py-0.5 text-right",children:typeof R.confidence=="number"?`${Math.round(R.confidence)}%`:""})]},k))})]})})]})]}),n.jsxs("div",{className:"space-y-3",children:[n.jsxs("div",{className:"flex items-center justify-between",children:[n.jsx("div",{className:"font-semibold text-slate-800",children:"Previous reports table"}),n.jsx("button",{type:"button",onClick:b,disabled:r,className:"px-2 py-1 rounded border border-slate-300 text-[10px] hover:bg-slate-100",children:"+ Add row (Ctrl+Enter)"})]}),n.jsx("div",{className:"border border-slate-200 rounded bg-white max-h-72 overflow-auto",children:n.jsxs("table",{className:"min-w-full text-[11px]",children:[n.jsx("thead",{className:"bg-slate-50",children:n.jsxs("tr",{children:[n.jsx("th",{className:"px-1 py-1 text-right w-16",children:"Report #"}),n.jsx("th",{className:"px-1 py-1 text-right w-32",children:"Date"}),n.jsx("th",{className:"px-1 py-1 text-right",children:"Title"}),n.jsx("th",{className:"px-1 py-1 text-left w-16"})]})}),n.jsx("tbody",{children:e.reports.length===0?n.jsx("tr",{children:n.jsx("td",{colSpan:4,className:"px-2 py-2 text-center text-slate-400 text-[10px]",children:"  .      OCR ."})}):e.reports.map((R,k)=>{var C,ee,V,_,P,X,ie,fe,se;return n.jsxs("tr",{className:"border-t border-slate-100",children:[n.jsxs("td",{className:"px-1 py-1 align-top",children:[n.jsx("input",{ref:ue=>{W.current[k]=ue},type:"number",className:`w-full border rounded px-1 py-0.5 text-[11px] ${(C=p[k])!=null&&C.reportNo?"border-rose-400":"border-slate-300"}`,value:R.reportNo??"",onChange:ue=>z(k,"reportNo",ue.target.value),onKeyDown:ue=>H(ue,k),disabled:r}),((ee=p[k])==null?void 0:ee.reportNo)&&n.jsx("div",{className:"mt-0.5 text-[9px] text-rose-600",children:(V=p[k])==null?void 0:V.reportNo})]}),n.jsxs("td",{className:"px-1 py-1 align-top",children:[n.jsx("input",{type:"date",className:`w-full border rounded px-1 py-0.5 text-[11px] ${(_=p[k])!=null&&_.sentAt?"border-rose-400":"border-slate-300"}`,value:R.sentAt||"",onChange:ue=>z(k,"sentAt",ue.target.value),onKeyDown:ue=>H(ue,k),disabled:r}),((P=p[k])==null?void 0:P.sentAt)&&n.jsx("div",{className:"mt-0.5 text-[9px] text-rose-600",children:(X=p[k])==null?void 0:X.sentAt})]}),n.jsxs("td",{className:"px-1 py-1 align-top",children:[n.jsx("input",{type:"text",className:`w-full border rounded px-1 py-0.5 text-[11px] ${(ie=p[k])!=null&&ie.title?"border-rose-400":"border-slate-300"}`,value:R.title,onChange:ue=>z(k,"title",ue.target.value),onKeyDown:ue=>H(ue,k),disabled:r}),((fe=p[k])==null?void 0:fe.title)&&n.jsx("div",{className:"mt-0.5 text-[9px] text-rose-600",children:(se=p[k])==null?void 0:se.title})]}),n.jsx("td",{className:"px-1 py-1 align-top text-left",children:n.jsx("button",{type:"button",onClick:()=>Y(k),disabled:r,className:"px-1.5 py-0.5 rounded border border-slate-300 text-[10px] text-slate-700 hover:bg-slate-100",children:""})})]},k)})})]})}),n.jsxs("div",{className:"border border-slate-200 rounded bg-white p-2 space-y-2",children:[n.jsx("div",{className:"font-semibold text-slate-800 text-[11px]",children:"Extracted identifiers"}),n.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-2 text-[11px]",children:[n.jsxs("div",{className:"space-y-1",children:[n.jsx("label",{className:"block text-[10px] text-slate-600",children:"Insured"}),n.jsx("input",{type:"text",className:"w-full border rounded px-2 py-0.5 text-[11px] border-slate-300",value:e.insuredName||"",onChange:R=>a({...e,insuredName:R.target.value}),disabled:r})]}),n.jsxs("div",{className:"space-y-1",children:[n.jsx("label",{className:"block text-[10px] text-slate-600",children:"Plaintiff / Claimant"}),n.jsx("input",{type:"text",className:"w-full border rounded px-2 py-0.5 text-[11px] border-slate-300",value:e.plaintiffName||"",onChange:R=>a({...e,plaintiffName:R.target.value}),disabled:r})]}),n.jsxs("div",{className:"space-y-1",children:[n.jsx("label",{className:"block text-[10px] text-slate-600",children:"LineSlip No."}),n.jsx("input",{type:"text",className:"w-full border rounded px-2 py-0.5 text-[11px] border-slate-300",value:e.lineSlipNo||"",onChange:R=>a({...e,lineSlipNo:R.target.value}),disabled:r})]}),n.jsxs("div",{className:"space-y-1",children:[n.jsx("label",{className:"block text-[10px] text-slate-600",children:"Unique Market Ref"}),n.jsx("input",{type:"text",className:"w-full border rounded px-2 py-0.5 text-[11px] border-slate-300",value:e.marketRef||"",onChange:R=>a({...e,marketRef:R.target.value}),disabled:r})]})]})]})]})]}),n.jsx(ib,{})]})}const il={title:"    ",subtitle:"     ,    ",actions:{openNewReport:"  "},queueItem:{noDate:" "}},Bu=(e,t)=>{console.error(`[LP-CRM] ${e}`,t)},Nb=e=>{if(!e)return!1;const t=new Date(e);return Number.isNaN(t.getTime())?!1:t.getTime()>Date.now()},Qn=e=>{const{messageHe:t,...s}=e;return t?{...s,messageHe:t}:{...s,messageHe:{MISSING_PROVIDER:"    .",MISSING_DESCRIPTION:"  .",INVALID_DATE_FUTURE:"     .",INVALID_QUANTITY:"     -0.",INVALID_UNIT_PRICE:"     .",INVALID_VAT_RATE:"     .",NEGATIVE_AMOUNT:"     .",MISSING_ATTACHMENT_REQUIRED:"      .",SHEET_STATUS_INVALID_FOR_READY:"     -READY_FOR_REPORT.",SHEET_STATUS_INVALID_FOR_ATTACH:"     .",SHEET_STATUS_INVALID_FOR_SEND:"    .",SUMS_INCONSISTENT:"     .",INFO_ONLY_INCONSISTENT:'  " "     0.',SNAPSHOT_HASH_MISMATCH:"-Hash        ."}[s.code]||"  ."}},bb=(e,t,s)=>{const r=s.filter(m=>m.severity==="ERROR").map(m=>m.code),a=s.filter(m=>m.severity==="WARNING").map(m=>m.code),o=!s.some(m=>m.code==="SUMS_INCONSISTENT"),l=!s.some(m=>m.code==="MISSING_ATTACHMENT_REQUIRED"&&m.severity==="ERROR"),i=!s.some(m=>["MISSING_PROVIDER","MISSING_DESCRIPTION"].includes(m.code)),c=!s.some(m=>m.code==="INFO_ONLY_INCONSISTENT");return{evaluatedAt:new Date().toISOString(),insurerId:e.insurerId||void 0,rulesetId:t==null?void 0:t.insurerId,rulesetVersion:t==null?void 0:t.rulesetVersion,checks:{sumsValid:o,attachmentsOk:l,requiredFieldsOk:i,infoOnlyConsistent:c},blockingIssueCodes:r,warningIssueCodes:a}},vb=e=>{const t=[];return e.kind==="EXPENSE"&&!e.providerName&&t.push(Qn({code:"MISSING_PROVIDER",severity:"ERROR",scope:"LINE_ITEM",entityId:e.id})),e.description||t.push(Qn({code:"MISSING_DESCRIPTION",severity:"ERROR",scope:"LINE_ITEM",entityId:e.id})),Nb(e.date)&&t.push(Qn({code:"INVALID_DATE_FUTURE",severity:"WARNING",scope:"LINE_ITEM",entityId:e.id})),e.quantity!=null&&e.quantity<=0&&t.push(Qn({code:"INVALID_QUANTITY",severity:"ERROR",scope:"LINE_ITEM",entityId:e.id})),e.unitPrice!=null&&e.unitPrice<0&&t.push(Qn({code:"INVALID_UNIT_PRICE",severity:"ERROR",scope:"LINE_ITEM",entityId:e.id})),e.vatRate!=null&&e.vatRate<0&&t.push(Qn({code:"INVALID_VAT_RATE",severity:"ERROR",scope:"LINE_ITEM",entityId:e.id})),[e.lineNetAmount,e.lineVatAmount,e.lineTotalAmount].filter(r=>r!=null).some(r=>r<0)&&t.push(Qn({code:"NEGATIVE_AMOUNT",severity:"ERROR",scope:"LINE_ITEM",entityId:e.id})),t},Sb=(e,t,s,r)=>{if(!r)return[];const a=[],o={};s.forEach(i=>{o[i.id]=i});const l=r.amountThresholdRequiringAttachment??null;return t.forEach(i=>{const c=i.isIncludedInRequestedAmount!==!1,m=!!(i.attachmentId&&o[i.attachmentId]),p=i.lineTotalAmount??0;let h=!1;if(r.policyFamily==="STRICT")c&&i.kind==="EXPENSE"&&(!l||p>=l)&&(h=!0);else if(r.policyFamily==="PARTIAL"){const v=!!i.expenseType&&r.requireAttachmentForExpenseTypes.includes(i.expenseType),A=!!l&&p>=l;c&&(v||A)&&(h=!0)}else r.policyFamily==="FLEXIBLE"&&c&&i.kind==="EXPENSE"&&(!l||p>=l)&&(h=!0);if(h&&!m){const v=r.policyFamily==="FLEXIBLE"?"WARNING":"ERROR";a.push(Qn({code:"MISSING_ATTACHMENT_REQUIRED",severity:v,scope:"LINE_ITEM",entityId:i.id,messageHe:v==="ERROR"?"      .":"       ."}))}}),r.requiredAttachmentTypes.length>0&&a.push(Qn({code:"ATTACHMENT_TYPES_NOT_ENFORCED",severity:"INFO",scope:"SHEET",messageHe:"     ,      ."})),e.infoOnly&&a.length&&r.policyFamily,a},wb=e=>{const{sheet:t,lineItems:s,attachments:r,ruleset:a}=e,o=[];s.forEach(c=>{o.push(...vb(c))});const l=_n(t,s);t.infoOnly&&l.amountToRequest!==0&&o.push(Qn({code:"INFO_ONLY_INCONSISTENT",severity:"ERROR",scope:"SHEET"})),o.push(...Sb(t,s,r,a));const i=bb(t,a,o);return{issues:o,decisionLog:i}},kp=e=>wb(e),jb=e=>{if(!e)return"";const t=new Date(e);if(Number.isNaN(t.getTime()))return"";const s=String(t.getDate()).padStart(2,"0"),r=String(t.getMonth()+1).padStart(2,"0"),a=t.getFullYear();return`${s}/${r}/${a}`},Jn=e=>(e??0).toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2}),ei=e=>{if(e.lineTotalAmount!=null)return e.lineTotalAmount;const t=e.lineNetAmount!=null?e.lineNetAmount:vh(e.quantity??0,e.unitPrice??0),s=e.lineVatAmount!=null?e.lineVatAmount:Sh(t,e.vatRate??0);return wh(t,s)},Ah=(e,t,s)=>{const r=_n(e,t),a=[`Expenses Table  Case ${e.caseId}`,"",`Deductible: ${Jn(e.deductibleAmount??0)}`,`Payments already made: ${Jn(e.alreadyPaidAmount??0)}`,`Amount to request: ${Jn(r.amountToRequest)}`,"","Expenses:"],o=[],l=[];let i=0;t.forEach(p=>{var z,Y;const h=jb(p.date||null),v=p.providerName||"",A=p.description||"",D=p.kind==="EXPENSE"?"Expense":p.kind==="COMPENSATION"?p.compensationSource==="COURT"?"Compensation pursuant to a judgment":"Compensation pursuant to a settlement":"Adjustment",I=((z=s==null?void 0:s.isNewLine)==null?void 0:z.call(s,p))??!1,W=((Y=s==null?void 0:s.isHistoricalLine)==null?void 0:Y.call(s,p))??!1,N=Jn(ei(p)),x=p.vatRate!=null?`, VAT ${p.vatRate}%`:"",b=p.isIncludedInRequestedAmount===!1?" (not included in request)":"",H=` ${h||"-"}  ${I?"[] ":W?"[] ":""}${A}${v?` (${v})`:""}  ${N} (${D}${x})${b}`;if(p.kind==="EXPENSE"){const Q=ei(p);I&&(i+=Q),o.push(H)}else l.push(H)}),o.length||o.push(" No expense items.");const c=s&&typeof s.newExpensesTotal=="number"?s.newExpensesTotal:i;return{text:[...a,...o,"","Adjustments and compensations:",...l.length?l:[" No adjustments or compensations."],"",...c>0?[`Current report expenses only: ${Jn(c)}`]:[],`Total gross expenses: ${Jn(r.grossExpensesTotal)}`,`Total deductions (Deductible + Payments already made + adjustments): ${Jn(r.adjustmentsTotal)}`,`Amount to request: ${Jn(r.amountToRequest)}`].join(`
`),totals:r}},ti=(e,t,s)=>{const r=_n(e,t),a=r.amountToRequest<=0,o=[],l=(b,B,H)=>{const z=H!=null&&H.isTotal?"total-balance-row":H!=null&&H.isSummary?"summary-row":"",Y=(H==null?void 0:H.rowClass)??"",Q=`${z} ${Y}`.trim();o.push(`<tr class="${Q}"><td>${Eb(b)}</td><td class="amount-cell">${Jn(B??0)}</td></tr>`)},i=t.filter(b=>b.kind==="EXPENSE");let c=0;const m=i.reduce((b,B)=>{var k,C;const H=ei(B),z=((k=s==null?void 0:s.isNewLine)==null?void 0:k.call(s,B))??!1,Y=((C=s==null?void 0:s.isHistoricalLine)==null?void 0:C.call(s,B))??!1;z&&(c+=H);const Q=B.providerName?` (${B.providerName})`:"",G=B.description?`${B.description}${Q}`:Q||"Expense",E=`${z?"  ":Y?"  ":""}${G}`;return l(E,H,{rowClass:z?"expense-row-new":Y?"expense-row-history":""}),b+H},0),p=e.deductibleAmount??0;t.filter(b=>b.kind==="COMPENSATION").forEach(b=>{const B=b.compensationSource==="COURT"?"Court-awarded compensation":"Settlement compensation";l(B,ei(b))}),l("Total expenses so far",m,{isSummary:!0});const v=s&&typeof s.newExpensesTotal=="number"?s.newExpensesTotal:c;v>0&&l("Current report expenses only",v,{isSummary:!0}),l("Deductible",p,{isSummary:!0}),l("Payments already made",e.alreadyPaidAmount??0,{isSummary:!0}),l(a?"Total Balance Due (no payment requested)":"Total Balance Due",r.amountToRequest,{isTotal:!0});const A=['<div class="expenses-table-wrapper">','<table class="expenses-table">',"<thead>",'<tr><th>Expenses</th><th class="amount-cell">Amount ()</th></tr>',"</thead>","<tbody>",...o,"</tbody>","</table>","</div>"].join(""),D=t.some(b=>b.kind==="COMPENSATION"&&b.compensationSource!=="COURT"),I=t.some(b=>b.kind==="COMPENSATION"&&b.compensationSource==="COURT"),W=`${Jn(r.amountToRequest)}`;let N;return I?N='<p class="expenses-payment-note">Pursuant to the judgment rendered in this matter, we kindly request that the Insurer arrange payment of the total amount set out in the attached Expenses Table, in order to bring this claim to a conclusion.<br/><br/><strong>Payment is required within 30 days of receipt of this report.</strong></p>':D?a?N='<p class="expenses-payment-note">Although a settlement has been agreed in principle, the total expenses and compensation fall within the applicable deductible. Accordingly, no payment is required from the Insurer in respect of this claim.</p>':N=`<p class="expenses-payment-note">Should the Insurer approve the settlement, we would be obliged if the Insurer could arrange payment of ${W} to the Brokers bank account in order to bring this claim to a conclusion. This amount represents an all-inclusive settlement, covering both the agreed compensation and the associated expenses. In the event that the settlement is not approved, no payment is required at this stage.</p>`:N=a?'<p class="expenses-payment-note">Given that the deductible exceeds the total expenses incurred in this matter, the Insurer is not required to make any payment in respect of this claim.</p>':`<p class="expenses-payment-note">Accordingly, we would appreciate it if the Insurer could transfer the amount of ${W} to the Brokers bank account.</p>`,{html:A+N+'<p class="expenses-payment-note">All amounts are stated in New Israeli Shekels ().</p>',totals:r}},Eb=e=>e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;"),kb=({open:e,title:t,message:s,confirmText:r,cancelText:a,destructive:o=!1,onConfirm:l,onCancel:i})=>{const c=y.useRef(null);if(y.useEffect(()=>{if(!e)return;const h=v=>{v.key==="Escape"&&(v.stopPropagation(),i())};if(typeof window<"u"&&window.addEventListener("keydown",h),c.current)try{c.current.focus()}catch{}return()=>{typeof window<"u"&&window.removeEventListener("keydown",h)}},[e,i]),!e)return null;const m=h=>{h.target===h.currentTarget&&i()},p=o?"bg-danger text-white hover:bg-red-800":"bg-navy text-gold hover:bg-navySecondary";return n.jsx("div",{className:"fixed inset-0 z-[300] flex items-center justify-center bg-black/50",onClick:m,children:n.jsxs("div",{className:"bg-panel border border-borderDark rounded-xl shadow-xl max-w-md w-full mx-4 p-5 space-y-3",dir:"rtl",children:[n.jsx("h2",{className:"text-sm font-bold text-gold text-right",children:t}),s&&n.jsx("p",{className:"text-xs text-textMuted text-right whitespace-pre-line",children:s}),n.jsxs("div",{className:"flex justify-end gap-2 mt-4",children:[n.jsx("button",{type:"button",onClick:i,className:"px-3 py-1.5 rounded-md border border-borderDark text-xs text-textLight bg-navySecondary hover:bg-borderDark",children:a}),n.jsx("button",{type:"button",ref:c,onClick:l,className:`px-3 py-1.5 rounded-md text-xs font-semibold ${p}`,children:r})]})]})})},Ab=({user:e,sheet:t,paymentEvents:s,onChangeEvents:r})=>{const[a,o]=y.useState(""),[l,i]=y.useState(()=>new Date().toISOString().slice(0,10)),[c,m]=y.useState(""),[p,h]=y.useState(""),[v,A]=y.useState(!1),[D,I]=y.useState(null),W=async()=>{const b=Number(a);if(!Number.isFinite(b)||b<=0){I("     .");return}if(!l){I("    .");return}const H=new Date(l).getTime();if(Number.isNaN(H)){I("   .");return}const z=Date.now();if(H>z){I("     .");return}I(null),A(!0);try{const Y=new Date(l).toISOString(),Q=await Je.createPaymentEvent(e,{caseId:t.caseId,sheetId:t.id,amount:b,paidAt:Y,reference:c||null,note:p||null});r([...s,Q]),o(""),m(""),h(""),I(null)}finally{A(!1)}},N=async b=>{await Je.softDeletePaymentEvent(b),r(s.filter(B=>B.id!==b))},x=s.filter(b=>!b.isDeleted).sort((b,B)=>{const H=new Date(b.paidAt).getTime();return new Date(B.paidAt).getTime()-H});return n.jsxs("div",{className:"space-y-3",children:[n.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-2 items-end",children:[n.jsxs("div",{children:[n.jsx("label",{className:"block text-[11px] font-medium text-slate-700 mb-1",children:"  ()"}),n.jsx("input",{type:"number",className:"w-full border rounded px-2 py-1 text-xs",value:a,onChange:b=>o(b.target.value),min:0})]}),n.jsxs("div",{children:[n.jsx("label",{className:"block text-[11px] font-medium text-slate-700 mb-1",children:" "}),n.jsx("input",{type:"date",className:"w-full border rounded px-2 py-1 text-xs",value:l,onChange:b=>i(b.target.value)})]}),n.jsxs("div",{children:[n.jsx("label",{className:"block text-[11px] font-medium text-slate-700 mb-1",children:" (  / )"}),n.jsx("input",{type:"text",className:"w-full border rounded px-2 py-1 text-xs",value:c,onChange:b=>m(b.target.value)})]}),n.jsxs("div",{children:[n.jsx("label",{className:"block text-[11px] font-medium text-slate-700 mb-1",children:"  ()"}),n.jsxs("div",{className:"flex gap-2",children:[n.jsx("input",{type:"text",className:"flex-1 border rounded px-2 py-1 text-xs",value:p,onChange:b=>h(b.target.value)}),n.jsx("button",{type:"button",className:"px-3 py-1 text-xs rounded bg-emerald-600 text-white hover:bg-emerald-700 disabled:opacity-50",onClick:W,disabled:v,children:" "})]})]})]}),D&&n.jsx("div",{className:"text-[11px] text-red-600 px-1",children:D}),n.jsx("div",{className:"border-t border-slate-200 pt-2",children:x.length===0?n.jsx("p",{className:"text-[11px] text-slate-500",children:"    .       ."}):n.jsx("div",{className:"space-y-1",children:x.map(b=>n.jsxs("div",{className:"flex flex-wrap items-baseline gap-x-4 gap-y-1 rounded border border-slate-200 bg-white px-2 py-1",children:[n.jsxs("span",{className:"font-medium text-slate-800",children:["",b.amount.toLocaleString("he-IL")]}),n.jsxs("span",{className:"text-slate-600",children:[""," ",new Date(b.paidAt).toLocaleDateString("he-IL",{year:"numeric",month:"2-digit",day:"2-digit"})]}),b.reference&&n.jsxs("span",{className:"text-slate-600",children:[": ",b.reference]}),b.note&&n.jsxs("span",{className:"text-slate-600",children:[": ",b.note]}),n.jsx("button",{type:"button",className:"ml-auto text-xs text-red-600 hover:underline",onClick:()=>N(b.id),children:""})]},b.id))})})]})},Ap={DRAFT:"",READY_FOR_REPORT:" ",ATTACHED_TO_REPORT:" ",ARCHIVED:""},Ih=({user:e,sheetWithRelations:t,onSheetUpdated:s,onBack:r,onNotifyLawyer:a,linkedReportForLawyer:o})=>{const[l,i]=y.useState(t.sheet),[c,m]=y.useState(t.lineItems),[p,h]=y.useState(!1),[v,A]=y.useState(null),[D,I]=y.useState(null),[W,N]=y.useState([]),[x,b]=y.useState(t.attachments),[B,H]=y.useState(!1),[z,Y]=y.useState(""),[Q,G]=y.useState([]),[ae,E]=y.useState([]),[R,k]=y.useState("AUTO"),[C,ee]=y.useState([]),[V,_]=y.useState([]),[P,X]=y.useState([]),[ie,fe]=y.useState(null),se=y.useMemo(()=>Je.getPaidToDateForSheet(l),[l,V]),ue=y.useMemo(()=>({...l,alreadyPaidAmount:se}),[l,se]);y.useEffect(()=>{i(t.sheet),m(t.lineItems),b(t.attachments),(async()=>{try{const K=t.sheet.caseId,oe=Se(K);if(!oe){ee([]),_([]);return}const le=await Je.listPaymentsForCase(K);_(le);const xe=(await Je.listSheets()).filter(ht=>ht.id!==t.sheet.id).filter(ht=>Se(ht.caseId)===oe);if(!xe.length){ee([]),X([]);return}xe.sort((ht,lt)=>{const Ne=new Date(ht.updatedAt||ht.createdAt).getTime();return new Date(lt.updatedAt||lt.createdAt).getTime()-Ne});const Ie=xe.slice(0,3),Ee=[],Me=[];for(const ht of Ie){const lt=await Je.getSheet(ht.id);if(!lt)continue;const Ne=Je.getPaidToDateForSheet(lt.sheet),Ct=_n({...lt.sheet,alreadyPaidAmount:Ne},lt.lineItems),Es=lt.lineItems.filter(os=>os.kind==="EXPENSE");Me.push(...Es),Ee.push({id:lt.sheet.id,versionIndex:lt.sheet.versionIndex,status:lt.sheet.status,createdAt:lt.sheet.createdAt,updatedAt:lt.sheet.updatedAt,deductibleAmount:lt.sheet.deductibleAmount??0,alreadyPaidAmount:Ne,amountToRequest:Ct.amountToRequest})}Ee.sort((ht,lt)=>{const Ne=new Date(ht.updatedAt||ht.createdAt).getTime();return new Date(lt.updatedAt||lt.createdAt).getTime()-Ne}),ee(Ee),X(Me);const Ye=Je.buildCumulativeExpensesSnapshot(t.sheet.id,new Date().toISOString());if(Ye){const ht=_n(Ye.effectiveSheet,Ye.allLines);fe(ht)}else fe(null)}catch{ee([]),_([]),X([]),fe(null)}})()},[t]);const we=y.useMemo(()=>_n(ue,c),[ue,c]),He=y.useMemo(()=>{const M=new Set;return W.forEach(K=>{K.scope==="LINE_ITEM"&&K.entityId&&M.add(K.entityId)}),M},[W]),Ue=()=>{const M=kp({sheet:l,lineItems:c,attachments:x,ruleset:void 0});N(M.issues)};y.useEffect(()=>{Ue()},[l,c]),y.useEffect(()=>{if(!(typeof window>"u"))try{const M=window.localStorage.getItem("financeProviderSuggestions"),K=window.localStorage.getItem("financeDescriptionSuggestions");if(M){const oe=JSON.parse(M);Array.isArray(oe)&&G(oe.filter(le=>typeof le=="string"))}if(K){const oe=JSON.parse(K);Array.isArray(oe)&&E(oe.filter(le=>typeof le=="string"))}}catch{}},[]),y.useEffect(()=>{if(typeof window>"u")return;const M=new Set(Q);let K=!1;if(c.forEach(ne=>{const xe=(ne.providerName||"").trim();xe&&!M.has(xe)&&(M.add(xe),K=!0)}),K){const ne=Array.from(M).sort((xe,Ie)=>xe.localeCompare(Ie,"he-IL"));G(ne);try{window.localStorage.setItem("financeProviderSuggestions",JSON.stringify(ne))}catch{}}const oe=new Set(ae);let le=!1;if(c.forEach(ne=>{const xe=(ne.description||"").trim();xe&&!oe.has(xe)&&(oe.add(xe),le=!0)}),le){const ne=Array.from(oe).sort((xe,Ie)=>xe.localeCompare(Ie,"he-IL"));E(ne);try{window.localStorage.setItem("financeDescriptionSuggestions",JSON.stringify(ne))}catch{}}},[c]);const Ze=M=>{i(K=>({...K,...M}))},ze=(M,K)=>{m(oe=>{const le=[...oe];return le[M]={...le[M],...K,sheetId:l.id},le})},rt=()=>{const M={id:`tmp-${Date.now()}`,sheetId:l.id,kind:"EXPENSE",expenseType:null,providerName:"",providerId:null,description:"",date:new Date().toISOString().slice(0,10),quantity:1,unitPrice:0,vatRate:18,isIncludedInRequestedAmount:!0,lineNetAmount:null,lineVatAmount:null,lineTotalAmount:null,attachmentId:null,createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()};m(K=>[...K,M])},qe=M=>{const K=c[M];K&&(m(oe=>oe.filter((le,ne)=>ne!==M)),K.id.startsWith("tmp-")||Je.deleteLineItem(e,l.id,K.id))},j=async M=>{const K=Array.from(M);if(K.length)for(let oe=0;oe<K.length;oe++){const le=K[oe],ne=new FileReader,xe=await new Promise((Ee,Me)=>{ne.onload=()=>Ee(String(ne.result)),ne.onerror=()=>Me(ne.error),ne.readAsDataURL(le)}),Ie=await Je.addAttachment(e,l.id,{fileKey:xe,originalFileName:le.name,mimeType:le.type||"application/octet-stream",sizeBytes:le.size});Ie&&b(Ee=>[...Ee,Ie])}},$=async M=>{const{files:K}=M.target;!K||!K.length||(await j(K),M.target.value="")},J=async M=>{M.preventDefault(),M.stopPropagation();const{files:K}=M.dataTransfer;!K||!K.length||await j(K)},pe=async(M,K)=>{const oe=K||"";try{const le=await Je.linkAttachmentToLineItem(e,l.id,oe,K?M.id:null);b(ne=>ne.map(xe=>le&&xe.id===le.id?le:!le&&xe.id===oe?{...xe,linkedLineItemId:K?M.id:null}:xe)),m(ne=>ne.map(xe=>xe.id===M.id?{...xe,attachmentId:K||null}:xe.id===M.attachmentId&&!K?{...xe,attachmentId:null}:xe)),A(K?" /     .":"    .")}catch(le){console.error("Failed to link attachment to line item",le)}},me=async()=>{if(!((e.role==="SUB_ADMIN"||e.role==="ADMIN")&&(l.status==="READY_FOR_REPORT"||l.status==="ATTACHED_TO_REPORT"||l.status==="ARCHIVED")&&!window.confirm(`     (  /   / ).
         .

  ?`))){h(!0);try{const K=await Je.updateSheetMeta(e,l.id,{insurerName:l.insurerName,periodLabel:l.periodLabel,deductibleAmount:l.deductibleAmount??0,alreadyPaidAmount:l.alreadyPaidAmount??0,infoOnly:l.infoOnly}),oe=[];for(const ne of c)if(ne.id.startsWith("tmp-")){const xe=await Je.addLineItem(e,l.id,{kind:ne.kind,expenseType:ne.expenseType,providerName:ne.providerName,providerId:ne.providerId,description:ne.description,date:ne.date,quantity:ne.quantity,unitPrice:ne.unitPrice,vatRate:ne.vatRate,isIncludedInRequestedAmount:ne.isIncludedInRequestedAmount,lineNetAmount:ne.lineNetAmount,lineVatAmount:ne.lineVatAmount,lineTotalAmount:ne.lineTotalAmount,attachmentId:ne.attachmentId});xe&&oe.push(xe)}else{const xe=await Je.updateLineItem(e,l.id,ne.id,{kind:ne.kind,expenseType:ne.expenseType,providerName:ne.providerName,providerId:ne.providerId,description:ne.description,date:ne.date,quantity:ne.quantity,unitPrice:ne.unitPrice,vatRate:ne.vatRate,isIncludedInRequestedAmount:ne.isIncludedInRequestedAmount,lineNetAmount:ne.lineNetAmount,lineVatAmount:ne.lineVatAmount,lineTotalAmount:ne.lineTotalAmount,attachmentId:ne.attachmentId});xe&&oe.push(xe)}const le=await Je.getSheet(l.id)||{sheet:K||l,lineItems:oe,attachments:[]};s(le),A("  .")}finally{h(!1)}}},he=async()=>{h(!0);try{const M=await Je.getRulesetForSheet(l),K=kp({sheet:l,lineItems:c,attachments:x,ruleset:M}),oe=K.issues.map(xe=>xe.code==="MISSING_ATTACHMENT_REQUIRED"&&xe.severity==="ERROR"?{...xe,severity:"WARNING"}:xe);N(oe);const le=oe.filter(xe=>xe.severity==="ERROR"&&xe.code!=="MISSING_ATTACHMENT_REQUIRED");if(le.length){const xe=le.map(Ie=>` ${Ie.messageHe}`).join(`
`);Y(xe),H(!0),A("          .");return}const ne=await Je.recordReadyAttempt(e,{sheetId:l.id,success:!0,decisionLog:K.decisionLog});if(ne){i(ne);const xe=await Je.getSheet(ne.id)||{sheet:ne,lineItems:c,attachments:x};s(xe),a&&a({caseId:ne.caseId,sheetId:ne.id,lawyerId:R==="AUTO"?void 0:R});const Ie=R==="AUTO"?(o==null?void 0:o.ownerName)||"  ":(o==null?void 0:o.ownerName)||" ";A(`       ${Ie}   ${ne.caseId}.`)}}finally{h(!1)}},je=()=>{const M=Je.buildCumulativeExpensesSnapshot(l.id,new Date().toISOString());if(!M)return;const{effectiveSheet:K,allLines:oe,opts:le}=M,{html:ne}=ti(K,oe,le);I(ne)},Be=M=>He.has(M),Ve=y.useMemo(()=>{const M=new Set(Q);return c.forEach(K=>{K.providerName&&M.add(K.providerName)}),Array.from(M).sort((K,oe)=>K.localeCompare(oe,"he-IL"))},[c,Q]),tt=y.useMemo(()=>{const M=new Set(ae);return c.forEach(K=>{K.description&&M.add(K.description)}),Array.from(M).sort((K,oe)=>K.localeCompare(oe,"he-IL"))},[c,ae]),Ke=()=>{const M={sheet:l,lineItems:c,attachments:x,totals:we},K=new Blob([JSON.stringify(M,null,2)],{type:"application/json"}),oe=URL.createObjectURL(K),le=document.createElement("a");le.href=oe,le.download=`expenses-${l.caseId||l.id}.json`,le.click(),URL.revokeObjectURL(oe)},ot=()=>{const M=["LineId","Date","Provider","Description","Quantity","UnitPrice","VatRate","IncludedInRequest","LineTotal"],K=c.map(Ie=>[Ie.id,Ie.date||"",(Ie.providerName||"").replace(/"/g,'""'),(Ie.description||"").replace(/"/g,'""'),Ie.quantity??"",Ie.unitPrice??"",Ie.vatRate??"",Ie.isIncludedInRequestedAmount!==!1?"YES":"NO",Ie.lineTotalAmount??""]),oe=[M.join(","),...K.map(Ie=>Ie.map(Ee=>{const Me=String(Ee??"");return/[",\n]/.test(Me)?`"${Me}"`:Me}).join(","))].join(`
`),le=new Blob(["\uFEFF"+oe],{type:"text/csv;charset=utf-8;"}),ne=URL.createObjectURL(le),xe=document.createElement("a");xe.href=ne,xe.download=`expenses-${l.caseId||l.id}.csv`,xe.click(),URL.revokeObjectURL(ne)},Z=y.useMemo(()=>{if(!o)return l.status==="READY_FOR_REPORT"?"   (  ).":l.status==="ATTACHED_TO_REPORT"||l.status==="ARCHIVED"?"     .":"  .";switch(o.status){case"TASK_ASSIGNED":return"      .";case"WAITING_FOR_INVOICES":return"   /  .";case"PENDING_REVIEW":return'"   / .';case"READY_TO_SEND":return'"    .';case"SENT":return'"   .';default:return"    ."}},[o,l.status]),be=y.useMemo(()=>o?[{id:o.createdBy,name:o.ownerName||'" '}]:[],[o]);return n.jsxs("div",{className:"flex flex-col gap-4",children:[n.jsxs("div",{className:"flex items-center justify-between",children:[n.jsxs("div",{children:[n.jsxs("h2",{className:"text-xl font-semibold text-gray-900",children:["  : ",n.jsx("span",{className:"font-mono",children:l.caseId})]}),n.jsxs("p",{className:"text-sm text-gray-600",children:[": ",n.jsx("span",{children:Ap[l.status]})]}),n.jsxs("p",{className:"mt-1 text-xs text-gray-600",children:['  ":'," ",n.jsx("span",{className:"font-medium text-gray-800",children:Z})]})]}),n.jsxs("div",{className:"flex gap-3 flex-wrap justify-end items-center",children:[be.length>0&&n.jsxs("div",{className:"text-xs text-gray-700",children:[n.jsx("label",{className:"block mb-1 font-medium",children:"     "}),n.jsxs("select",{className:"border rounded px-2 py-1 text-xs bg-white",value:R,onChange:M=>k(M.target.value||"AUTO"),children:[n.jsx("option",{value:"AUTO",children:'   "  '}),be.map(M=>n.jsx("option",{value:M.id,children:M.name},M.id))]})]}),n.jsx("button",{type:"button",className:"px-3 py-1 text-sm rounded border border-gray-300 text-gray-700 hover:bg-gray-50",onClick:r,children:" "}),n.jsx("button",{type:"button",className:"px-3 py-1.5 text-sm rounded border border-blue-300 text-blue-700 hover:bg-blue-50",onClick:je,children:" "}),n.jsx("button",{type:"button",className:"px-4 py-1.5 text-sm rounded bg-emerald-600 text-white hover:bg-emerald-700 disabled:opacity-50",onClick:he,disabled:p,children:"   "}),n.jsx("button",{type:"button",className:"px-4 py-1.5 text-sm rounded bg-blue-600 text-white hover:bg-blue-700 disabled:opacity-50",onClick:me,disabled:p,children:p?"":" "}),n.jsx("button",{type:"button",className:"px-3 py-1.5 text-xs rounded border border-gray-300 text-gray-700 hover:bg-gray-50",onClick:Ke,children:" JSON"}),n.jsx("button",{type:"button",className:"px-3 py-1.5 text-xs rounded border border-gray-300 text-gray-700 hover:bg-gray-50",onClick:ot,children:" Excel (CSV)"})]})]}),v&&n.jsx("div",{className:"mt-2 rounded border border-green-200 bg-green-50 px-3 py-2 text-sm text-green-800",children:v}),D&&n.jsxs("div",{className:"mt-2 rounded border border-gray-300 bg-white px-3 py-3 text-sm text-left",children:[n.jsxs("div",{className:"flex justify-between items-center mb-2",children:[n.jsx("span",{className:"font-semibold text-gray-800",children:"Expenses Table  Preview"}),n.jsx("button",{type:"button",className:"text-sm text-blue-600 hover:underline",onClick:()=>I(null),children:""})]}),n.jsx("div",{className:"overflow-x-auto text-base",dangerouslySetInnerHTML:{__html:D}})]}),n.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 bg-white border rounded-lg p-4 shadow-sm",children:[n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:""}),n.jsx("input",{className:"w-full border rounded px-2 py-1 text-sm",value:l.insurerName||"",onChange:M=>Ze({insurerName:M.target.value})})]}),n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:" / "}),n.jsx("input",{className:"w-full border rounded px-2 py-1 text-sm",value:l.periodLabel||"",onChange:M=>Ze({periodLabel:M.target.value})})]}),n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:" "}),n.jsx("input",{type:"number",className:"w-full border rounded px-2 py-1 text-sm",value:l.deductibleAmount??0,onChange:M=>{const K=Number(M.target.value),oe=Number.isFinite(K)?Math.max(0,K):0;Ze({deductibleAmount:oe})}})]}),n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"  "}),n.jsx("input",{type:"number",className:"w-full border rounded px-2 py-1 text-sm bg-gray-50",value:se,readOnly:!0})]}),n.jsxs("div",{className:"flex items-center gap-2 mt-2",children:[n.jsx("input",{id:"infoOnly",type:"checkbox",checked:l.infoOnly,onChange:M=>Ze({infoOnly:M.target.checked})}),n.jsx("label",{htmlFor:"infoOnly",className:"text-sm text-gray-800",children:"   (  )"})]})]}),n.jsxs("div",{className:"flex flex-col gap-2",children:[n.jsxs("div",{className:"flex items-center justify-between text-xs text-gray-700 px-1",children:[n.jsx("span",{className:"font-semibold",children:"    (  )"}),n.jsx("span",{className:"text-gray-500",children:"   / PDF     ."})]}),n.jsxs("div",{className:"flex flex-wrap gap-4 items-center bg-blue-50 border border-blue-100 rounded-lg p-4 text-sm",children:[n.jsxs("div",{children:[n.jsx("div",{className:"text-gray-600",children:"   "}),n.jsxs("div",{className:"font-semibold",children:[we.grossExpensesTotal.toLocaleString("he-IL")," "]})]}),n.jsxs("div",{children:[n.jsx("div",{className:"text-gray-600",children:"   (  +  + )"}),n.jsxs("div",{className:"font-semibold",children:[we.adjustmentsTotal.toLocaleString("he-IL")," "]})]}),n.jsxs("div",{children:[n.jsx("div",{className:"text-gray-600",children:"     INFO_ONLY"}),n.jsxs("div",{className:"font-semibold",children:[we.amountBeforeInfoOnly.toLocaleString("he-IL")," "]})]}),n.jsxs("div",{children:[n.jsx("div",{className:"text-gray-600",children:"   "}),n.jsxs("div",{className:"font-semibold text-blue-700",children:[we.amountToRequest.toLocaleString("he-IL")," "]})]}),we.infoOnlyApplied&&n.jsx("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-yellow-100 text-yellow-800",children:"INFO_ONLY    (  )"})]}),n.jsx("div",{className:"px-1 text-[11px] text-gray-500",children:" :         .   (Expenses Table)   -PDF        ."})]}),ie&&n.jsxs("div",{className:"mt-3 flex flex-col gap-2",children:[n.jsx("div",{className:"flex items-center justify-between text-xs text-slate-700 px-1",children:n.jsx("span",{className:"font-semibold",children:"   ( +  )"})}),n.jsxs("div",{className:"flex flex-wrap gap-4 items-center bg-indigo-50 border border-indigo-100 rounded-lg p-4 text-sm",children:[n.jsxs("div",{children:[n.jsx("div",{className:"text-slate-600",children:"   "}),n.jsxs("div",{className:"font-semibold",children:[ie.grossExpensesTotal.toLocaleString("he-IL")," "]})]}),n.jsxs("div",{children:[n.jsx("div",{className:"text-slate-600",children:"  (  +  + )"}),n.jsxs("div",{className:"font-semibold",children:[ie.adjustmentsTotal.toLocaleString("he-IL")," "]})]}),n.jsxs("div",{children:[n.jsx("div",{className:"text-slate-600",children:"   "}),n.jsxs("div",{className:"font-semibold",children:[se.toLocaleString("he-IL")," "]})]}),n.jsxs("div",{children:[n.jsx("div",{className:"text-slate-600",children:"  /  ()"}),n.jsxs("div",{className:"font-semibold text-indigo-700",children:[ie.amountToRequest.toLocaleString("he-IL")," "]})]})]})]}),n.jsxs("div",{className:"mt-2 text-xs text-gray-500 bg-white border border-dashed border-gray-300 rounded-md p-2",children:[n.jsx("span",{className:"font-semibold mr-1",children:" :"}),"    (, , , ,  ).       ,            ."]}),n.jsxs("div",{className:"bg-white border rounded-lg p-4 shadow-sm flex flex-col gap-2 text-sm",onDragOver:M=>{M.preventDefault(),M.stopPropagation()},onDrop:J,children:[n.jsxs("div",{className:"flex items-center justify-between",children:[n.jsx("div",{className:"font-medium text-gray-900",children:""}),n.jsxs("label",{className:"inline-flex items-center gap-2 cursor-pointer text-xs text-blue-700 hover:text-blue-800",children:[n.jsx("span",{className:"px-2 py-1 border border-blue-400 rounded bg-blue-50",children:" "}),n.jsx("input",{type:"file",className:"hidden",multiple:!0,onChange:$})]})]}),n.jsx("p",{className:"text-xs text-gray-500",children:"         ."}),x.length===0?n.jsx("div",{className:"text-gray-500 text-xs",children:"    ."}):n.jsx("ul",{className:"divide-y divide-gray-100",children:x.map(M=>n.jsxs("li",{className:"py-1 flex items-center justify-between gap-4",children:[n.jsxs("div",{className:"flex flex-col",children:[n.jsx("span",{className:"text-gray-900 text-xs",children:M.originalFileName}),n.jsxs("span",{className:"text-gray-500 text-[11px]",children:[": ",M.sizeBytes!=null?`${(M.sizeBytes/1024).toFixed(1)} KB`:" ","  "," ",M.uploadedAt?new Date(M.uploadedAt).toLocaleString("he-IL",{dateStyle:"short",timeStyle:"short"}):""]})]}),n.jsx("button",{type:"button",className:"text-xs text-blue-700 hover:underline",onClick:()=>{M.fileKey.startsWith("data:")&&window.open(M.fileKey,"_blank")},children:" / "})]},M.id))})]}),W.length>0&&n.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-lg p-3 text-sm",children:[n.jsx("div",{className:"font-semibold text-red-800 mb-1",children:"  :"}),n.jsx("ul",{className:"list-disc pr-5 space-y-0.5",children:W.map(M=>n.jsxs("li",{children:[n.jsxs("span",{className:"font-mono text-xs text-gray-500 ml-1",children:["[",M.severity,"]"]}),n.jsxs("span",{className:"text-red-900",children:[" ",M.messageHe]})]},`${M.code}-${M.scope}-${M.entityId||"sheet"}`))})]}),n.jsxs("div",{className:"bg-white border rounded-lg shadow-sm overflow-x-auto",children:[n.jsxs("table",{className:"min-w-full text-sm",children:[n.jsx("thead",{className:"bg-gray-50",children:n.jsxs("tr",{children:[n.jsx("th",{className:"px-2 py-1 border-b text-right",children:""}),n.jsx("th",{className:"px-2 py-1 border-b text-right",children:""}),n.jsx("th",{className:"px-2 py-1 border-b text-right",children:""}),n.jsx("th",{className:"px-2 py-1 border-b text-right",children:""}),n.jsx("th",{className:"px-2 py-1 border-b text-right",children:""}),n.jsx("th",{className:"px-2 py-1 border-b text-right",children:" "}),n.jsx("th",{className:"px-2 py-1 border-b text-right",children:" %"}),n.jsx("th",{className:"px-2 py-1 border-b text-right",children:" "}),n.jsx("th",{className:"px-2 py-1 border-b text-right",children:" "}),n.jsx("th",{className:"px-2 py-1 border-b text-right",children:""}),n.jsx("th",{className:"px-2 py-1 border-b"})]})}),n.jsxs("tbody",{children:[P.length>0&&n.jsx("tr",{children:n.jsx("td",{className:"px-2 py-1 border-b text-xs text-slate-600 bg-slate-50",colSpan:9,children:"  ( )      ."})}),P.map((M,K)=>{if(M.kind!=="EXPENSE")return null;const oe=M.lineTotalAmount??(M.quantity??0)*(M.unitPrice??0)*(1+(M.vatRate??0)/100);return n.jsxs("tr",{className:"bg-slate-50 text-slate-700",children:[n.jsx("td",{className:"px-2 py-1 border-b text-[11px] text-slate-500",children:""}),n.jsx("td",{className:"px-2 py-1 border-b text-xs",children:M.providerName||""}),n.jsx("td",{className:"px-2 py-1 border-b text-xs",children:M.description||""}),n.jsx("td",{className:"px-2 py-1 border-b text-xs whitespace-nowrap",children:M.date||""}),n.jsx("td",{className:"px-2 py-1 border-b text-xs",children:M.quantity??""}),n.jsx("td",{className:"px-2 py-1 border-b text-xs",children:M.unitPrice??""}),n.jsx("td",{className:"px-2 py-1 border-b text-xs",children:M.vatRate??""}),n.jsx("td",{className:"px-2 py-1 border-b text-xs",children:Number.isFinite(oe)?oe.toLocaleString("he-IL"):""}),n.jsx("td",{className:"px-2 py-1 border-b text-[11px] text-slate-400",children:" "})]},`hist-${M.id}-${K}`)}),c.map((M,K)=>{const oe=Be(M.id),le=x.find(Ee=>Ee.id===M.attachmentId),ne=M.kind==="COMPENSATION",xe=M.kind==="EXPENSE",Ie=M.kind==="COMPENSATION"?M.compensationSource==="COURT"?"COMPENSATION_COURT":"COMPENSATION_SETTLEMENT":M.kind;return n.jsxs("tr",{className:`${oe?"bg-red-50":K%2===0?"bg-white":"bg-gray-50"} ${xe?"border-l-4 border-emerald-300 bg-emerald-50/60":""}`,children:[n.jsx("td",{className:"px-2 py-1 border-b",children:n.jsxs("select",{className:"border rounded px-1 py-0.5 text-xs",value:Ie,onChange:Ee=>{const Me=Ee.target.value;Me==="EXPENSE"?ze(K,{kind:"EXPENSE",compensationSource:null}):Me==="ADJUSTMENT"?ze(K,{kind:"ADJUSTMENT",compensationSource:null}):Me==="COMPENSATION_SETTLEMENT"?ze(K,{kind:"COMPENSATION",compensationSource:"SETTLEMENT",providerName:"",expenseType:null,vatRate:0,quantity:1}):Me==="COMPENSATION_COURT"&&ze(K,{kind:"COMPENSATION",compensationSource:"COURT",providerName:"",expenseType:null,vatRate:0,quantity:1})},children:[n.jsx("option",{value:"EXPENSE",children:"Expense"}),n.jsx("option",{value:"COMPENSATION_SETTLEMENT",children:"Compensation pursuant to a settlement"}),n.jsx("option",{value:"COMPENSATION_COURT",children:"Compensation pursuant to a judgment"}),n.jsx("option",{value:"ADJUSTMENT",children:"Adjustment"})]})}),n.jsx("td",{className:"px-2 py-1 border-b",children:ne?n.jsx("span",{className:"text-[11px] text-gray-400 whitespace-nowrap",children:"  "}):n.jsxs("div",{className:"flex items-center gap-1",children:[xe&&n.jsx("span",{className:"inline-flex items-center rounded-full bg-emerald-100 text-emerald-700 text-[10px] px-2 py-[1px]",children:""}),n.jsx("input",{list:"provider-suggestions",className:"border rounded px-1 py-0.5 w-32 text-xs",placeholder:" ",value:M.providerName||"",onChange:Ee=>ze(K,{providerName:Ee.target.value})})]})}),n.jsx("td",{className:"px-2 py-1 border-b",children:n.jsx("input",{className:"border rounded px-1 py-0.5 w-64 text-xs",list:"description-suggestions",value:M.description,onChange:Ee=>ze(K,{description:Ee.target.value})})}),n.jsx("td",{className:"px-2 py-1 border-b",children:n.jsx("input",{type:"date",className:"border rounded px-1 py-0.5 text-xs",value:M.date||"",onChange:Ee=>ze(K,{date:Ee.target.value||null})})}),n.jsx("td",{className:"px-2 py-1 border-b",children:n.jsx("input",{type:"number",className:"border rounded px-1 py-0.5 w-20 text-xs disabled:bg-gray-100 disabled:text-gray-400",value:M.quantity??1,disabled:ne,onChange:Ee=>{if(ne)return;const Me=Number(Ee.target.value),Ye=Number.isFinite(Me)?Math.max(0,Me):0;ze(K,{quantity:Ye})}})}),n.jsx("td",{className:"px-2 py-1 border-b",children:n.jsx("input",{type:"number",className:"border rounded px-1 py-0.5 w-24 text-xs",value:M.unitPrice??0,onChange:Ee=>{const Me=Number(Ee.target.value),Ye=Number.isFinite(Me)?Math.max(0,Me):0;ze(K,{unitPrice:Ye})}})}),n.jsx("td",{className:"px-2 py-1 border-b",children:n.jsx("input",{type:"number",className:"border rounded px-1 py-0.5 w-16 text-xs disabled:bg-gray-100 disabled:text-gray-400",value:M.vatRate??0,disabled:ne,onChange:Ee=>{if(ne)return;const Me=Number(Ee.target.value),Ye=Number.isFinite(Me)?Math.max(0,Me):0;ze(K,{vatRate:Ye})}})}),n.jsx("td",{className:"px-2 py-1 border-b text-center",children:n.jsx("input",{type:"checkbox",checked:M.isIncludedInRequestedAmount!==!1,onChange:Ee=>ze(K,{isIncludedInRequestedAmount:Ee.target.checked})})}),n.jsx("td",{className:"px-2 py-1 border-b text-left font-mono text-xs",children:M.lineTotalAmount!=null?M.lineTotalAmount.toLocaleString("he-IL"):""}),n.jsxs("td",{className:"px-2 py-1 border-b text-right",children:[n.jsxs("div",{className:"flex items-center justify-end gap-2",children:[n.jsxs("select",{className:"border rounded px-1 py-0.5 text-xs max-w-[190px]",value:M.attachmentId||"",title:le?` : ${le.originalFileName}`:"   ",onChange:Ee=>void pe(M,Ee.target.value?Ee.target.value:null),children:[n.jsx("option",{value:"",children:x.length?"   ":"  "}),x.map(Ee=>n.jsx("option",{value:Ee.id,children:Ee.originalFileName},Ee.id))]}),M.attachmentId?n.jsxs("span",{className:"inline-flex items-center gap-1 text-[11px] text-emerald-700 font-semibold whitespace-nowrap",children:[n.jsx("span",{className:"text-emerald-600",children:""}),n.jsx("span",{children:" "})]}):n.jsx("span",{className:"inline-flex items-center gap-1 text-[11px] text-gray-500 whitespace-nowrap",children:" "})]}),le&&n.jsxs("div",{className:"mt-0.5 text-[11px] text-gray-700 text-left",children:[n.jsx("span",{className:"text-gray-500",children:":"})," ",n.jsx("span",{className:"font-mono break-all",children:le.originalFileName})]})]}),n.jsx("td",{className:"px-2 py-1 border-b text-center",children:n.jsx("button",{type:"button",className:"text-xs text-red-600 hover:underline",onClick:()=>qe(K),children:""})})]},M.id)})]})]}),n.jsx("datalist",{id:"provider-suggestions",children:Ve.map(M=>n.jsx("option",{value:M},M))}),n.jsx("datalist",{id:"description-suggestions",children:tt.map(M=>n.jsx("option",{value:M},M))}),n.jsx("div",{className:"p-2",children:n.jsx("button",{type:"button",className:"px-3 py-1 text-xs rounded border border-dashed border-gray-400 text-gray-700 hover:bg-gray-50",onClick:rt,children:" "})})]}),n.jsxs("div",{className:"mt-4 rounded-lg border border-slate-200 bg-slate-50 p-3 text-xs",children:[n.jsxs("div",{className:"flex justify-between items-center mb-2",children:[n.jsx("span",{className:"font-semibold text-slate-800",children:" "}),n.jsxs("span",{className:"text-slate-700",children:["    : ",se.toLocaleString("he-IL")]})]}),n.jsx(Ab,{user:e,sheet:l,paymentEvents:V,onChangeEvents:_})]}),C.length>0&&n.jsxs("div",{className:"mt-4 rounded-lg border border-slate-200 bg-slate-50 p-3 text-xs",children:[n.jsxs("div",{className:"flex justify-between items-center mb-2",children:[n.jsx("span",{className:"font-semibold text-slate-800",children:"  "}),n.jsxs("span",{className:"text-slate-500",children:["  ",C.length,"    "]})]}),n.jsx("div",{className:"space-y-2",children:C.map(M=>n.jsxs("div",{className:"rounded border border-slate-200 bg-white px-2 py-1 flex flex-wrap gap-x-4 gap-y-1 items-baseline",children:[n.jsxs("span",{className:"font-semibold text-slate-800",children:[" #",M.versionIndex||1]}),n.jsxs("span",{className:"text-slate-600",children:[": ",Ap[M.status]||M.status]}),n.jsxs("span",{className:"text-slate-500",children:[":"," ",new Date(M.updatedAt||M.createdAt).toLocaleString("he-IL",{dateStyle:"short",timeStyle:"short"})]}),n.jsxs("span",{className:"text-slate-700",children:[" : ",M.deductibleAmount.toLocaleString("he-IL")]}),n.jsxs("span",{className:"text-slate-700",children:["  : ",M.alreadyPaidAmount.toLocaleString("he-IL")]}),n.jsxs("span",{className:"text-slate-700",children:[" : ",M.amountToRequest.toLocaleString("he-IL")]})]},M.id))})]}),n.jsx(kb,{open:B,title:"    ",message:z?`      :

${z}`:"      .",confirmText:"",cancelText:"",onConfirm:()=>H(!1),onCancel:()=>H(!1)})]})},Ib=[{id:"READY",label:" "},{id:"ATTACHED",label:" "},{id:"SENT",label:""},{id:"EXCEPTIONS",label:""}],Ip={DRAFT:"",READY_FOR_REPORT:" ",ATTACHED_TO_REPORT:" ",ARCHIVED:""},Tb=({user:e,reports:t,onOpenReport:s})=>{var qe;const[r,a]=y.useState("READY"),[o,l]=y.useState(""),[i,c]=y.useState(""),[m,p]=y.useState(""),[h,v]=y.useState(""),[A,D]=y.useState(""),[I,W]=y.useState([]),[N,x]=y.useState(null),[b,B]=y.useState(null),[H,z]=y.useState(!1),[Y,Q]=y.useState(null),[G,ae]=y.useState(null),[E,R]=y.useState(null),[k,C]=y.useState(!1),[ee,V]=y.useState(null),[_,P]=y.useState(null),[X,ie]=y.useState(!1),[fe,se]=y.useState(!1),[ue,we]=y.useState(0);y.useMemo(()=>{if(!N)return 0;switch(r){case"READY":return N.readyCount;case"ATTACHED":return N.attachedCount;case"SENT":return N.sentCount;case"EXCEPTIONS":return N.exceptionsCount;default:return 0}},[N,r]);const He=j=>{if(j==null)return"";if(j<24)return`${j.toFixed(1)} `;const $=Math.floor(j/24),J=j%24;return J<1?`${$} `:`${$}  ${J.toFixed(1)} `};y.useEffect(()=>{let j=!1;return(async()=>{z(!0),Q(null);try{const[J,pe]=await Promise.all([Je.getLidorCounts(e,t),Je.getLidorKpis(e,t)]);j||(x(J),B(pe));const me={};r==="READY"?me.status="READY_FOR_REPORT":r==="ATTACHED"&&(me.status="ATTACHED_TO_REPORT"),o.trim()&&(me.insurerName=o.trim()),m&&(me.dateFrom=m),h&&(me.dateTo=h),A.trim()&&(me.caseIdOrSearch=A.trim()),i&&(me.status=i);const he=await Je.listSheetsForLidor(e,me,t);let je=he;r==="SENT"?je=he.filter(Be=>Be.sentAt):r==="EXCEPTIONS"&&(je=he.filter(Be=>Be.expensesOutOfSync||Be.blockingIssueCodesLatest&&Be.blockingIssueCodesLatest.length>0)),j||(W(je),ae(null),P(null))}catch(J){console.error(J),j||Q("    . /   .")}finally{j||z(!1)}})(),()=>{j=!0}},[e,t,r,o,i,m,h,A,ue]);const Ue=async j=>{ae(j),P(null),V(null),C(!0);try{const $=await Je.getSheet(j.sheetId),J=await Je.getSheetAuditForLidor(e,j.sheetId,200),pe=await Je.getExceptionStatusForSheet(e,j.sheetId);P($?{sheet:$.sheet,lineItems:$.lineItems,attachments:$.attachments,audit:J,exceptionStatus:pe}:{sheet:null,lineItems:[],attachments:[],audit:J,exceptionStatus:pe})}catch($){console.error($),V("     .")}finally{C(!1)}},Ze=()=>{if(!_||!_.sheet)return;const j={sheet:_.sheet,lineItems:_.lineItems,attachments:_.attachments};R(j)},ze=()=>{R(null),we(j=>j+1)};if(E)return n.jsxs("div",{className:"bg-white rounded-xl border border-slate-200 shadow-sm p-4 mt-4",dir:"rtl",children:[n.jsxs("header",{className:"flex items-center justify-between mb-4",children:[n.jsxs("div",{children:[n.jsx("h2",{className:"text-xl font-bold text-slate-900",children:"   ()"}),n.jsx("p",{className:"text-sm text-slate-600 mt-1",children:"           ."})]}),n.jsx("button",{type:"button",className:"px-3 py-1.5 rounded border border-slate-300 text-sm text-slate-700 hover:bg-slate-100",onClick:ze,children:"  "})]}),n.jsx(Ih,{user:e,sheetWithRelations:E,onSheetUpdated:j=>{R(j)},onBack:ze})]});const rt=async j=>{if(!(!G||!_))try{await Je.setExceptionStatusForSheet(e,G.sheetId,j),P({..._,exceptionStatus:j})}catch($){Bu("Failed to update financial exception status",$),V("     .")}};return n.jsxs("div",{className:"bg-white rounded-xl border border-slate-200 shadow-sm p-4 mt-4",dir:"rtl",children:[n.jsx("header",{className:"flex flex-col md:flex-row md:items-center md:justify-between gap-4 mb-4",children:n.jsxs("div",{children:[n.jsx("h2",{className:"text-xl font-bold text-slate-900",children:" "}),n.jsx("p",{className:"text-sm text-slate-600 mt-1",children:"-    ,      ."}),b&&n.jsxs("p",{className:"mt-1 text-xs text-slate-500",children:["  :"," ",b.exceptions.divergenceOld.count+b.exceptions.missingAttachments.count+b.exceptions.repeatedBlocks.count]})]})}),b&&n.jsxs("section",{className:"mb-4 grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-3 text-xs",children:[n.jsxs("div",{className:"rounded-xl border border-slate-200 bg-slate-50 px-3 py-2.5",children:[n.jsx("p",{className:"text-slate-500 mb-1",children:"   "}),n.jsx("p",{className:"text-sm font-semibold text-slate-900",children:He(b.sla.draftToReadyAvgHours)})]}),n.jsxs("div",{className:"rounded-xl border border-slate-200 bg-slate-50 px-3 py-2.5",children:[n.jsx("p",{className:"text-slate-500 mb-1",children:"   "}),n.jsx("p",{className:"text-sm font-semibold text-slate-900",children:He(b.sla.readyToAttachedAvgHours)})]}),n.jsxs("div",{className:"rounded-xl border border-slate-200 bg-slate-50 px-3 py-2.5",children:[n.jsx("p",{className:"text-slate-500 mb-1",children:"   "}),n.jsx("p",{className:"text-sm font-semibold text-slate-900",children:He(b.sla.attachedToSentAvgHours)})]}),n.jsxs("div",{className:"rounded-xl border border-blue-100 bg-blue-50 px-3 py-2.5",children:[n.jsx("p",{className:"text-slate-600 mb-1",children:"  "}),n.jsxs("p",{className:"text-sm font-semibold text-blue-800",children:[b.volumes.totalAmountRequested.toLocaleString("he-IL")," "]}),n.jsxs("p",{className:"text-[11px] text-slate-500 mt-0.5",children:[b.volumes.totalSheets||0,"  "," ",b.volumes.totalSentReports||0,"  "]})]})]}),b&&n.jsxs("section",{className:"mb-4",children:[n.jsx("h3",{className:"text-sm font-semibold text-slate-700 mb-1",children:"  "}),n.jsxs("div",{className:"flex flex-wrap gap-2 text-xs",children:[n.jsxs("button",{type:"button",className:"inline-flex items-center gap-1 px-3 py-1.5 rounded-full border border-amber-200 bg-amber-50 text-amber-800 hover:bg-amber-100 transition disabled:opacity-40 disabled:hover:bg-amber-50",disabled:b.exceptions.divergenceOld.count===0,onClick:()=>a("EXCEPTIONS"),children:[n.jsx("span",{children:"    "}),n.jsxs("span",{className:"font-semibold",children:["(",b.exceptions.divergenceOld.count,")"]})]}),n.jsxs("button",{type:"button",className:"inline-flex items-center gap-1 px-3 py-1.5 rounded-full border border-rose-200 bg-rose-50 text-rose-800 hover:bg-rose-100 transition disabled:opacity-40 disabled:hover:bg-rose-50",disabled:b.exceptions.missingAttachments.count===0,onClick:()=>a("EXCEPTIONS"),children:[n.jsx("span",{children:"  "}),n.jsxs("span",{className:"font-semibold",children:["(",b.exceptions.missingAttachments.count,")"]})]}),n.jsxs("button",{type:"button",className:"inline-flex items-center gap-1 px-3 py-1.5 rounded-full border border-purple-200 bg-purple-50 text-purple-800 hover:bg-purple-100 transition disabled:opacity-40 disabled:hover:bg-purple-50",disabled:b.exceptions.repeatedBlocks.count===0,onClick:()=>a("EXCEPTIONS"),children:[n.jsx("span",{children:"   "}),n.jsxs("span",{className:"font-semibold",children:["(",b.exceptions.repeatedBlocks.count,")"]})]})]})]}),n.jsx("div",{className:"flex flex-wrap gap-2 mb-4",children:Ib.map(j=>n.jsxs("button",{type:"button",onClick:()=>a(j.id),className:`px-3 py-1.5 text-xs font-semibold rounded-full border transition ${r===j.id?"bg-lpBlue text-white border-lpBlue":"bg-slate-50 text-slate-700 border-slate-200 hover:bg-slate-100"}`,children:[n.jsx("span",{children:j.label}),N&&n.jsxs("span",{className:"ml-2 inline-flex items-center justify-center px-2 py-0.5 rounded-full bg-white/20 text-[10px]",children:[j.id==="READY"&&N.readyCount,j.id==="ATTACHED"&&N.attachedCount,j.id==="SENT"&&N.sentCount,j.id==="EXCEPTIONS"&&N.exceptionsCount]})]},j.id))}),n.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-3 mb-4 text-sm",children:[n.jsxs("div",{children:[n.jsx("label",{className:"block text-xs font-medium text-slate-600 mb-1",children:""}),n.jsx("input",{className:"w-full border border-slate-200 rounded-lg px-2 py-1.5",placeholder:"   ",value:o,onChange:j=>l(j.target.value)})]}),n.jsxs("div",{children:[n.jsx("label",{className:"block text-xs font-medium text-slate-600 mb-1",children:""}),n.jsxs("select",{className:"w-full border border-slate-200 rounded-lg px-2 py-1.5",value:i,onChange:j=>c(j.target.value),children:[n.jsx("option",{value:"",children:""}),n.jsx("option",{value:"DRAFT",children:""}),n.jsx("option",{value:"READY_FOR_REPORT",children:" "}),n.jsx("option",{value:"ATTACHED_TO_REPORT",children:" "}),n.jsx("option",{value:"ARCHIVED",children:""})]})]}),n.jsxs("div",{children:[n.jsx("label",{className:"block text-xs font-medium text-slate-600 mb-1",children:" "}),n.jsxs("div",{className:"flex gap-2",children:[n.jsx("input",{type:"date",className:"w-1/2 border border-slate-200 rounded-lg px-2 py-1.5",value:m,onChange:j=>p(j.target.value)}),n.jsx("input",{type:"date",className:"w-1/2 border border-slate-200 rounded-lg px-2 py-1.5",value:h,onChange:j=>v(j.target.value)})]})]}),n.jsxs("div",{children:[n.jsx("label",{className:"block text-xs font-medium text-slate-600 mb-1",children:"   / ID"}),n.jsx("input",{className:"w-full border border-slate-200 rounded-lg px-2 py-1.5",placeholder:'/  ,    "',value:A,onChange:j=>D(j.target.value)})]})]}),H&&n.jsx("div",{className:"mt-6 text-sm text-slate-500 text-center",children:" "}),Y&&!H&&n.jsx("div",{className:"mt-6 text-sm text-red-600 text-center",children:Y}),!H&&!Y&&I.length===0&&n.jsxs("div",{className:"mt-6 border border-dashed border-slate-300 rounded-xl py-10 flex flex-col items-center justify-center text-center text-sm text-slate-500",children:[n.jsx("p",{className:"mb-1",children:"  "}),n.jsx("p",{className:"text-xs text-slate-400",children:"/       ."})]}),!H&&!Y&&I.length>0&&n.jsx("div",{className:"mt-4 overflow-x-auto border border-slate-200 rounded-xl",children:n.jsxs("table",{className:"w-full text-sm",children:[n.jsx("thead",{className:"bg-slate-50 text-slate-700",children:n.jsxs("tr",{children:[n.jsx("th",{className:"px-3 py-2 text-right",children:""}),n.jsx("th",{className:"px-3 py-2 text-right",children:""}),n.jsx("th",{className:"px-3 py-2 text-right",children:""}),n.jsx("th",{className:"px-3 py-2 text-right",children:" #"}),n.jsx("th",{className:"px-3 py-2 text-right",children:" "}),n.jsx("th",{className:"px-3 py-2 text-right",children:" "}),n.jsx("th",{className:"px-3 py-2 text-right",title:"         ",children:"INFO_ONLY"}),n.jsx("th",{className:"px-3 py-2 text-right",title:"       ",children:""}),n.jsx("th",{className:"px-3 py-2 text-left",children:""})]})}),n.jsx("tbody",{children:I.map(j=>{var he;const $=(he=j.blockingIssueCodesLatest)==null?void 0:he.includes("MISSING_ATTACHMENT_REQUIRED"),J=j.expensesOutOfSync,pe=(j.blockingIssueCodesLatest||[]).some(je=>je!=="MISSING_ATTACHMENT_REQUIRED");let me="";return J?me=" ":$?me=" ":pe&&(me=""),n.jsxs("tr",{className:"border-t border-slate-100 hover:bg-slate-50",children:[n.jsx("td",{className:"px-3 py-2 text-right font-mono text-xs text-slate-800",children:j.caseId}),n.jsx("td",{className:"px-3 py-2 text-right text-slate-800",children:j.insurerName||""}),n.jsx("td",{className:"px-3 py-2 text-right text-slate-800 text-xs",children:Ip[j.status]||j.status}),n.jsxs("td",{className:"px-3 py-2 text-right text-slate-800 text-xs",children:[" #",j.versionIndex]}),n.jsx("td",{className:"px-3 py-2 text-right text-slate-700 text-xs",children:new Date(j.updatedAt).toLocaleString("he-IL",{dateStyle:"short",timeStyle:"short"})}),n.jsxs("td",{className:"px-3 py-2 text-right text-blue-700 font-semibold text-xs",children:[j.amountToRequest.toLocaleString("he-IL")," "]}),n.jsx("td",{className:"px-3 py-2 text-right text-xs text-slate-700",children:j.infoOnly?"":""}),n.jsx("td",{className:"px-3 py-2 text-right text-xs",children:me?n.jsx("span",{className:"inline-flex px-2 py-0.5 rounded-full bg-amber-100 text-amber-800 border border-amber-200",children:me}):n.jsx("span",{className:"text-slate-400",children:""})}),n.jsxs("td",{className:"px-3 py-2 text-left text-xs space-x-2 space-x-reverse",children:[n.jsx("button",{type:"button",className:"px-2 py-1 rounded border border-slate-300 text-slate-700 hover:bg-slate-100",onClick:()=>Ue(j),children:""}),n.jsx("button",{type:"button",className:"px-2 py-1 rounded border border-slate-300 text-slate-600 hover:bg-slate-100",onClick:()=>{var je;(je=navigator.clipboard)!=null&&je.writeText?navigator.clipboard.writeText(j.sheetId).catch(()=>{}):window.prompt(" :",j.sheetId)},children:" "})]})]},j.sheetId)})})]})}),G&&n.jsxs("div",{className:"mt-6 bg-slate-50 border border-slate-200 rounded-xl p-4",children:[n.jsxs("div",{className:"flex flex-col md:flex-row md:items-center md:justify-between gap-2 mb-2",children:[n.jsxs("h3",{className:"text-sm font-bold text-slate-900",children:["   ",G.caseId," (",G.sheetId,")"]}),n.jsxs("div",{className:"flex flex-wrap gap-2 text-[11px]",children:[n.jsx("button",{type:"button",className:"px-2 py-1 rounded border border-slate-300 text-slate-700 hover:bg-slate-100",onClick:()=>{var j;(j=navigator.clipboard)!=null&&j.writeText?navigator.clipboard.writeText(G.sheetId).catch(()=>{}):window.prompt(" :",G.sheetId)},children:"  "}),((qe=_==null?void 0:_.sheet)==null?void 0:qe.attachedToReportId)&&n.jsx("button",{type:"button",className:"px-2 py-1 rounded border border-slate-300 text-slate-700 hover:bg-slate-100",onClick:()=>{var $;const j=_.sheet.attachedToReportId;($=navigator.clipboard)!=null&&$.writeText?navigator.clipboard.writeText(j).catch(()=>{}):window.prompt(" :",j)},children:"  "}),n.jsx("button",{type:"button",className:"px-2 py-1 rounded border border-slate-300 text-slate-700 hover:bg-slate-100",onClick:()=>{var $;const j=`${window.location.origin}${window.location.pathname}?financialSheetId=${encodeURIComponent(G.sheetId)}`;($=navigator.clipboard)!=null&&$.writeText?navigator.clipboard.writeText(j).catch(()=>{}):window.prompt("  :",j)},children:"  "})]})]}),k&&n.jsx("p",{className:"text-xs text-slate-500",children:" "}),ee&&n.jsx("p",{className:"text-xs text-red-600",children:ee}),!k&&_&&_.sheet&&n.jsxs("div",{className:"space-y-3 text-xs text-slate-800",children:[n.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-2",children:[n.jsxs("div",{children:[n.jsx("span",{className:"font-semibold",children:":"})," ",n.jsx("span",{className:"font-mono",children:_.sheet.caseId})]}),n.jsxs("div",{children:[n.jsx("span",{className:"font-semibold",children:":"})," ",n.jsx("span",{children:_.sheet.insurerName||""})]}),n.jsxs("div",{children:[n.jsx("span",{className:"font-semibold",children:":"})," ",n.jsx("span",{children:Ip[_.sheet.status]||_.sheet.status})]}),n.jsxs("div",{children:[n.jsx("span",{className:"font-semibold",children:" #:"})," ",n.jsx("span",{children:_.sheet.versionIndex})]}),n.jsxs("div",{children:[n.jsx("span",{className:"font-semibold",children:":"})," ",n.jsx("span",{children:new Date(_.sheet.updatedAt).toLocaleString("he-IL",{dateStyle:"short",timeStyle:"short"})})]}),n.jsxs("div",{children:[n.jsx("span",{className:"font-semibold",children:" :"})," ",n.jsx("span",{children:_.sheet.readyAt||""})]}),n.jsxs("div",{children:[n.jsx("span",{className:"font-semibold",children:" :"})," ",n.jsx("span",{children:_.sheet.attachedAt||""})]})]}),n.jsxs("div",{className:"mt-3",children:[n.jsx("h4",{className:"font-semibold text-slate-900 mb-1 text-xs",children:"  (  )"}),n.jsx("p",{className:"text-[11px] text-slate-500 mb-1",children:"       ,      ."}),n.jsxs("div",{className:"inline-flex rounded-full bg-slate-100 p-1 text-[11px] font-semibold text-slate-700",children:[n.jsx("button",{type:"button",className:`px-3 py-1 rounded-full transition ${_.exceptionStatus?"text-slate-600 hover:text-slate-900":"bg-white shadow-sm text-slate-900"}`,onClick:()=>rt("IN_PROGRESS"),children:""}),n.jsx("button",{type:"button",className:`px-3 py-1 rounded-full transition ${_.exceptionStatus==="RESOLVED"?"bg-emerald-500 text-white shadow-sm":"text-slate-600 hover:text-slate-900"}`,onClick:()=>rt("RESOLVED"),children:""})]})]}),_.audit&&_.audit.length>0&&n.jsxs("div",{className:"mt-2",children:[n.jsxs("div",{className:"flex items-center justify-between mb-1",children:[n.jsx("h4",{className:"font-semibold text-slate-900",children:"Decision Logs"}),n.jsxs("label",{className:"flex items-center gap-1 text-[11px] text-slate-600",children:[n.jsx("input",{type:"checkbox",className:"rounded border-slate-300",checked:fe,onChange:j=>se(j.target.checked)}),n.jsx("span",{children:" Decision Logs "})]})]}),(()=>{const j=_.audit.filter(J=>J.diffJson&&J.diffJson.decisionLog).sort((J,pe)=>new Date(pe.eventAt).getTime()-new Date(J.eventAt).getTime());if(!j.length)return n.jsx("p",{className:"text-slate-500 text-[11px]",children:"   ."});const $=fe?j:[j[0]];return n.jsx("div",{className:"space-y-2 text-[11px]",children:$.map((J,pe)=>{const me=J.diffJson.decisionLog;return n.jsxs("div",{className:"border border-slate-200 rounded-lg px-2 py-1.5 bg-white/60",children:[fe&&n.jsxs("div",{className:"flex items-center justify-between mb-0.5 text-[10px] text-slate-500",children:[n.jsx("span",{children:new Date(J.eventAt).toLocaleString("he-IL",{dateStyle:"short",timeStyle:"short"})}),n.jsxs("span",{children:["#",pe+1]})]}),n.jsxs("div",{className:"space-y-1",children:[n.jsxs("div",{children:[n.jsx("span",{className:"font-semibold",title:"      ",children:"Ruleset:"})," ",n.jsxs("span",{children:[me.rulesetId||""," ("," ",me.rulesetVersion||"-",")"]})]}),n.jsxs("div",{className:"space-y-0.5",children:[n.jsxs("div",{children:[n.jsx("span",{className:me.checks.requiredFieldsOk?"text-green-600":"text-red-600",children:me.checks.requiredFieldsOk?"":""})," ",n.jsx("span",{children:"   "})]}),n.jsxs("div",{children:[n.jsx("span",{className:me.checks.sumsValid?"text-green-600":"text-red-600",children:me.checks.sumsValid?"":""})," ",n.jsx("span",{children:" "})]}),n.jsxs("div",{children:[n.jsx("span",{className:me.checks.attachmentsOk?"text-green-600":"text-red-600",children:me.checks.attachmentsOk?"":""})," ",n.jsx("span",{children:"    "})]}),n.jsxs("div",{children:[n.jsx("span",{className:me.checks.infoOnlyConsistent?"text-green-600":"text-red-600",children:me.checks.infoOnlyConsistent?"":""})," ",n.jsx("span",{children:" INFO_ONLY"})]})]}),n.jsxs("div",{children:[n.jsx("span",{className:"font-semibold",children:" :"})," ",n.jsx("span",{children:(me.blockingIssueCodes||me.blockingIssueCodesLatest||[]).join(", ")||""})]})]})]},J.id)})})})()]}),_.audit&&_.audit.length>0&&n.jsxs("div",{className:"mt-3",children:[n.jsxs("div",{className:"flex items-center justify-between mb-1",children:[n.jsx("h4",{className:"font-semibold text-slate-900",children:"Audit Log"}),n.jsxs("label",{className:"flex items-center gap-1 text-[11px] text-slate-600",children:[n.jsx("input",{type:"checkbox",className:"rounded border-slate-300",checked:X,onChange:j=>ie(j.target.checked)}),n.jsx("span",{children:" Audit Log "})]})]}),n.jsx("ul",{className:"space-y-0.5 text-[11px] text-slate-700",children:(X?_.audit:_.audit.slice(0,10)).map(j=>n.jsxs("li",{children:[n.jsx("span",{className:"font-mono text-slate-500 mr-1",children:new Date(j.eventAt).toLocaleString("he-IL",{dateStyle:"short",timeStyle:"short"})})," ",n.jsx("span",{className:"font-semibold",children:j.eventType})," "," ",n.jsx("span",{className:"text-slate-500",children:j.actorRole})]},j.id))})]}),_.sheet.attachedToReportId&&n.jsxs("div",{className:"mt-3",children:[n.jsx("button",{type:"button",className:"px-3 py-1.5 rounded border border-slate-300 text-xs text-slate-700 hover:bg-slate-100",onClick:()=>s(_.sheet.attachedToReportId),children:"  "}),n.jsx("button",{type:"button",className:"ml-2 px-3 py-1.5 rounded border border-blue-500 text-xs text-blue-700 hover:bg-blue-50",onClick:Ze,children:"  "})]}),!_.sheet.attachedToReportId&&n.jsx("div",{className:"mt-3",children:n.jsx("button",{type:"button",className:"px-3 py-1.5 rounded border border-blue-500 text-xs text-blue-700 hover:bg-blue-50",onClick:Ze,children:"  "})})]})]})]})},ni=e=>{const t=e.updatedAt||e.sentAt||e.reportDate;return t?new Date(t).getTime():0},Rb=e=>{var s;return(((s=e.reportReview)==null?void 0:s.issues)??[]).some(r=>(r.origin??"INTERNAL")==="EXTERNAL"&&r.status!=="DONE")},Cb=e=>{var s;return(((s=e.reportReview)==null?void 0:s.issues)??[]).some(r=>(r.origin??"INTERNAL")==="EXTERNAL"&&r.status!=="DONE"&&r.externalAction==="REQUIRES_HEBREW")},Db=e=>e.filter(t=>t.deletedAt?!1:t.hebrewWorkflowStatus==="HEBREW_REOPENED_EXTERNAL"?!0:Rb(t)).sort((t,s)=>ni(s)-ni(t)),Lb=(e,t)=>e.filter(s=>!(s.deletedAt||s.status!=="SENT"||!t(s)||Cb(s))).sort((s,r)=>ni(r)-ni(s)),_b="adminDashboardUiState:v1",Ob=["u6","u5","u7","u4"],cl=Ob.map(e=>hs.find(t=>t.id===e&&t.role==="LAWYER")).filter(e=>!!e);function Mb(e){var a;if(e.status==="SENT")return"GREEN";const t=(a=e.reportReview)==null?void 0:a.status,s=e.hebrewWorkflowStatus;return(t==="SUBMITTED"||t==="APPROVED"||t==="CHANGES_REQUESTED"||s==="HEBREW_SUBMITTED"||s==="HEBREW_APPROVED"||s==="HEBREW_CHANGES_REQUESTED"||s==="HEBREW_REOPENED_EXTERNAL")&&e.status!=="SENT"?"RED":"YELLOW"}const Pb=({user:e,reports:t,onSelectReport:s,onSelectReportWithFocus:r,onMarkExternalIssuesDone:a,onReopenHebrewDueToExternalFeedback:o,onNewReport:l,caseFolders:i,onUpdateCaseFolders:c,canTranslate:m,onLogout:p,onOpenAssistant:h,onOpenCaseFolder:v})=>{var V;const A=y.useMemo(()=>t.filter(_=>!_.deletedAt),[t]),D=y.useMemo(()=>Db(A),[A]),I=y.useMemo(()=>Lb(A,m),[A,m]),W=y.useMemo(()=>{const _=new Map;return A.forEach(P=>{if(!P.createdBy)return;const X=_.get(P.createdBy)||[];X.push(P),_.set(P.createdBy,X)}),_},[A]),N=y.useMemo(()=>cl.map(_=>{const X=(W.get(_.id)||[]).filter(ue=>ue.status!=="SENT"),ie=X.filter(ue=>ue.status==="READY_TO_SEND").length,fe=D.filter(ue=>ue.createdBy===_.id).length,se=I.filter(ue=>ue.createdBy===_.id).length;return{lawyer:_,totalOpen:X.length,readyToSendCount:ie,feedbackCount:fe,resendCount:se}}),[D,I,W]),x=_=>{var P;return _.hebrewWorkflowStatus?_.hebrewWorkflowStatus:((P=_.reportReview)==null?void 0:P.status)??"-"},b=_=>{if(!_)return il.queueItem.noDate;try{const P=new Date(_);return`${P.toLocaleDateString("he-IL")} ${P.toLocaleTimeString("he-IL",{hour:"2-digit",minute:"2-digit"}).replace(":00","")}`}catch{return _}},[B,H]=y.useState("ADMIN"),[z,Y]=y.useState(((V=cl[0])==null?void 0:V.id)||""),[Q,G]=y.useState("SUMMARY"),[ae,E]=y.useState(null),R=y.useMemo(()=>i?Object.values(i).filter(_=>_.closedAt):[],[i]),k=y.useMemo(()=>cl.find(_=>_.id===z)||cl[0],[z]),C=y.useMemo(()=>{if(!k)return[];const _=W.get(k.id)||[],P=new Map;_.filter(se=>!se.deletedAt).forEach(se=>{const ue=se.odakanitNo&&se.odakanitNo.trim().length>0?se.odakanitNo.trim():"NO_ODAKANIT",we=P.get(ue)||[];we.push(se),P.set(ue,we)});const X=Array.from(P.entries()).map(([se,ue])=>{let we=ue[0];ue.forEach(ze=>{const rt=new Date(ze.updatedAt||ze.reportDate).getTime(),qe=new Date(we.updatedAt||we.reportDate).getTime();rt>qe&&(we=ze)});const He=se==="NO_ODAKANIT"?"":se,Ue=He||"  ",Ze=we.updatedAt||we.reportDate;return{odakanitNo:He,displayOdakanit:Ue,representative:we,lastUpdatedIso:Ze,reportsCount:ue.length}}),ie=[];return i&&Object.values(i).forEach(se=>{var He;if(!se.odakanitNo||se.assignedLawyer!==k.id)return;const ue=se.odakanitNo.trim();if(!ue||P.has(ue))return;const we={id:`seed-folder-${ue}`,createdBy:k.id,ownerName:k.name,ownerEmail:k.email,reportDate:se.updatedAt||se.createdAt,status:"DRAFT",reportSubject:se.reTemplate||"",recipientId:"1",insurerName:se.insurerName||"",lineSlipNo:se.lineSlipNo||"",marketRef:se.marketRef||"",certificateRef:se.certificateRef||"",insuredName:se.insuredName||"",plaintiffName:se.plaintiffName||"",plaintiffTitle:"Plaintiff",sentAt:void 0,reportHistory:[],selectedTimeline:"standard",filenameTag:"New lawsuit",selectedSections:["Update","Recommendations"],content:{},translatedContent:{},invoiceFiles:[],isWaitingForInvoices:!1,requiresExpenses:!1,isTranslated:!1,expensesItems:[],expenseWorksheet:void 0,reportNotes:[],complaintAnalysis:void 0};ie.push({odakanitNo:se.odakanitNo,displayOdakanit:se.odakanitNo||"  ",representative:we,lastUpdatedIso:se.updatedAt||se.createdAt,reportsCount:((He=se.sentReports)==null?void 0:He.length)||0})}),[...X,...ie].sort((se,ue)=>{const we=se.lastUpdatedIso?new Date(se.lastUpdatedIso).getTime():0;return(ue.lastUpdatedIso?new Date(ue.lastUpdatedIso).getTime():0)-we})},[W,k,i]),ee=y.useMemo(()=>{if(!k||!ae)return[];const _=W.get(k.id)||[],P=ae.trim();return _.filter(X=>!X.deletedAt).filter(X=>(X.odakanitNo||"").trim()===P)},[W,k,ae]);return n.jsx("div",{className:"min-h-screen bg-navySecondary",dir:"rtl",children:n.jsxs("div",{className:"max-w-7xl mx-auto px-4 py-6",children:[n.jsxs("header",{className:"flex flex-col md:flex-row items-start md:items-center justify-between gap-4 mb-6",children:[n.jsxs("div",{children:[n.jsx("h1",{className:"text-2xl font-bold text-textLight",children:il.title}),n.jsx("p",{className:"text-sm text-textMuted mt-1",children:il.subtitle}),n.jsxs("p",{className:"text-xs text-textMuted mt-1",children:["/ ",n.jsx("span",{className:"font-semibold",children:e.name})," ",n.jsxs("span",{className:"ml-1 text-textMuted",children:["(",e.role==="SUB_ADMIN"?"SUB_ADMIN":"ADMIN",")"]})]})]}),n.jsxs("div",{className:"flex flex-col items-stretch md:flex-row md:items-center gap-3",children:[n.jsxs("div",{className:"inline-flex rounded-full bg-slate-100 p-1 text-xs font-semibold text-textMuted",children:[n.jsx("button",{type:"button",onClick:()=>H("ADMIN"),className:`px-3 py-1 rounded-full transition ${B==="ADMIN"?"bg-panel text-textLight shadow-sm":"text-textMuted hover:text-textLight"}`,children:" "}),n.jsx("button",{type:"button",onClick:()=>H("FINANCIAL_CONTROL"),className:`px-3 py-1 rounded-full transition ${B==="FINANCIAL_CONTROL"?"bg-panel text-textLight shadow-sm":"text-textMuted hover:text-textLight"}`,children:" "})]}),h&&n.jsx("button",{type:"button",onClick:()=>h(),className:"inline-flex items-center justify-center px-3 py-2 rounded-lg border border-indigo-200 bg-panel text-xs font-semibold text-indigo-800 hover:bg-indigo-50 transition",children:" "}),n.jsx("button",{type:"button",onClick:p,className:"inline-flex items-center justify-center px-3 py-2 rounded-lg border border-red-200 bg-panel text-sm font-semibold text-red-700 hover:bg-red-50 transition",children:""}),n.jsx("button",{onClick:l,className:"inline-flex items-center justify-center px-4 py-2 rounded-lg bg-lpBlue text-white text-sm font-semibold shadow-sm hover:bg-blue-800 transition",children:il.actions.openNewReport})]})]}),B==="FINANCIAL_CONTROL"?n.jsx(Tb,{user:e,reports:t,onOpenReport:s}):n.jsxs(n.Fragment,{children:[n.jsxs("section",{className:"mb-6",children:[n.jsx("h2",{className:"text-sm font-semibold text-textLight mb-2",children:"   "}),n.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-3 text-xs",children:N.map(_=>{const P=(k==null?void 0:k.id)===_.lawyer.id;return n.jsxs("button",{type:"button",onClick:()=>{Y(_.lawyer.id),E(null),G("LAWYER_CASES")},className:`flex flex-col items-stretch rounded-2xl border px-3 py-3 text-right shadow-sm transition ${P?"border-gold bg-blue-50/80":"border-borderDark bg-panel hover:bg-navySecondary"}`,children:[n.jsxs("div",{className:"flex items-center justify-between mb-1",children:[n.jsx("span",{className:"text-[11px] font-semibold text-slate-700",children:_.lawyer.name}),n.jsxs("span",{className:"inline-flex items-center rounded-full bg-slate-100 px-2 py-0.5 text-[10px] text-textMuted",children:[_.totalOpen," "]})]}),n.jsxs("div",{className:"flex flex-col gap-0.5 text-[11px] text-textMuted",children:[n.jsxs("span",{children:[" :",n.jsx("span",{className:"font-semibold text-emerald-700",children:_.readyToSendCount})]}),n.jsxs("span",{children:["  :",n.jsx("span",{className:"font-semibold text-purple-700",children:_.feedbackCount})]})]})]},_.lawyer.id)})})]}),e.role==="ADMIN"&&i&&c&&n.jsx(gb,{caseFolders:i,onUpdateCaseFolders:c,reports:t}),e.role==="ADMIN"&&R.length>0&&n.jsxs("section",{className:"mb-6 bg-panel rounded-2xl border border-borderDark shadow-sm p-4",children:[n.jsx("div",{className:"flex items-center justify-between mb-3",children:n.jsxs("div",{children:[n.jsx("h2",{className:"text-sm font-semibold text-textLight",children:" "}),n.jsx("p",{className:"text-[11px] text-textMuted",children:"      .   ,   (  )   ."})]})}),n.jsx("div",{className:"overflow-x-auto",children:n.jsxs("table",{className:"min-w-full text-[11px]",children:[n.jsx("thead",{children:n.jsxs("tr",{className:"border-b border-borderDark bg-navySecondary",children:[n.jsx("th",{className:"px-2 py-1 text-right font-semibold",children:"  "}),n.jsx("th",{className:"px-2 py-1 text-right font-semibold",children:""}),n.jsx("th",{className:"px-2 py-1 text-right font-semibold",children:""}),n.jsx("th",{className:"px-2 py-1 text-right font-semibold",children:" "}),n.jsx("th",{className:"px-2 py-1 text-right font-semibold",children:""})]})}),n.jsx("tbody",{children:R.map(_=>{const P=_.closedAt?new Date(_.closedAt).toLocaleDateString("he-IL"):"";return n.jsxs("tr",{className:"border-b border-borderDark",children:[n.jsx("td",{className:"px-2 py-1 text-right font-semibold text-textLight",children:_.odakanitNo}),n.jsx("td",{className:"px-2 py-1 text-right text-slate-700",children:_.insuredName||""}),n.jsx("td",{className:"px-2 py-1 text-right text-slate-700",children:_.plaintiffName||""}),n.jsx("td",{className:"px-2 py-1 text-right text-textMuted",children:P}),n.jsx("td",{className:"px-2 py-1 text-left",children:v&&n.jsx("button",{type:"button",onClick:()=>v(_.odakanitNo),className:"inline-flex items-center rounded-full bg-panel px-3 py-1 text-[11px] font-semibold text-gold border border-gold hover:bg-navySecondary",children:" "})})]},_.odakanitNo)})})]})})]}),Q==="LAWYER_CASES"&&k&&n.jsxs("section",{className:"mb-6 bg-panel rounded-2xl border border-borderDark shadow-sm p-4",children:[n.jsxs("div",{className:"flex items-center justify-between mb-3",children:[n.jsxs("div",{children:[n.jsxs("h2",{className:"text-sm font-semibold text-textLight",children:["     ",k.name]}),n.jsx("p",{className:"text-[11px] text-textMuted",children:"        ."})]}),n.jsx("button",{type:"button",onClick:()=>{G("SUMMARY"),E(null)},className:"text-[11px] px-3 py-1.5 rounded-full border border-borderDark text-slate-700 hover:bg-navySecondary",children:" "})]}),C.length===0?n.jsx("p",{className:"text-xs text-textMuted",children:"       ."}):n.jsx("div",{className:"overflow-x-auto",children:n.jsxs("table",{className:"min-w-full text-[11px]",children:[n.jsx("thead",{children:n.jsxs("tr",{className:"border-b border-borderDark bg-navySecondary",children:[n.jsx("th",{className:"px-2 py-1 text-right font-semibold",children:" "}),n.jsx("th",{className:"px-2 py-1 text-right font-semibold w-20",children:"REPORT NO."}),n.jsx("th",{className:"px-2 py-1 text-right font-semibold w-40",children:"PLAINTIFF/CLAIMANT"}),n.jsx("th",{className:"px-2 py-1 text-right font-semibold w-40",children:"INSURED"}),n.jsx("th",{className:"px-2 py-1 text-right font-semibold w-40",children:"INSURER"}),n.jsx("th",{className:"px-2 py-1 text-right font-semibold w-28",children:"'  "})]})}),n.jsx("tbody",{children:C.map(_=>{var Ze;const{representative:P}=_,X=!!_.odakanitNo,ie=Jl(P),fe=ie?ie.split(" - "):[],se=fe.length<=2?ie:fe[fe.length-2]||ie,ue=typeof P.reportNumber=="number"&&P.reportNumber>0?P.reportNumber:(((Ze=P.reportHistory)==null?void 0:Ze.length)||0)+1,we=P.plaintiffName||"",He=P.insuredName||"",Ue=P.insurerName||"";return n.jsxs("tr",{className:`border-b border-borderDark ${X?"hover:bg-navySecondary cursor-pointer":"bg-navySecondary/40 text-textMuted"}`,onClick:()=>{X&&(E(_.odakanitNo),G("CASE_REPORTS"))},children:[n.jsxs("td",{className:"px-2 py-1 text-right",children:[n.jsx("div",{className:"text-textLight",children:se||""}),n.jsx("div",{className:"text-[10px] text-textMuted",children:b(_.lastUpdatedIso)})]}),n.jsx("td",{className:"px-2 py-1 text-right text-slate-700 font-mono text-[11px]",children:ue}),n.jsx("td",{className:"px-2 py-1 text-right text-slate-700",children:we}),n.jsx("td",{className:"px-2 py-1 text-right text-slate-700",children:He}),n.jsx("td",{className:"px-2 py-1 text-right text-slate-700",children:Ue}),n.jsx("td",{className:"px-2 py-1 text-right font-mono text-[11px]",children:_.displayOdakanit})]},_.displayOdakanit)})})]})})]}),Q==="CASE_REPORTS"&&k&&ae&&n.jsxs("section",{className:"mb-6 bg-panel rounded-2xl border border-borderDark shadow-sm p-4",children:[n.jsxs("div",{className:"flex items-center justify-between mb-3",children:[n.jsxs("div",{children:[n.jsxs("h2",{className:"text-sm font-semibold text-textLight",children:["  ",ae,"  ",k.name]}),n.jsx("p",{className:"text-[11px] text-textMuted",children:"  ,     ."})]}),n.jsx("button",{type:"button",onClick:()=>G("LAWYER_CASES"),className:"text-[11px] px-3 py-1.5 rounded-full border border-borderDark text-slate-700 hover:bg-navySecondary",children:" "})]}),ee.length===0?n.jsx("p",{className:"text-xs text-textMuted",children:"     ."}):n.jsx("div",{className:"overflow-x-auto",children:n.jsxs("table",{className:"min-w-full text-[11px]",children:[n.jsx("thead",{children:n.jsxs("tr",{className:"border-b border-borderDark bg-navySecondary",children:[n.jsx("th",{className:"px-2 py-1 text-right font-semibold w-64",children:" /  / "}),n.jsx("th",{className:"px-2 py-1 text-right font-semibold w-24",children:' \\"'}),n.jsx("th",{className:"px-2 py-1 text-right font-semibold w-32",children:""}),n.jsx("th",{className:"px-2 py-1 text-right font-semibold w-32",children:" "}),n.jsx("th",{className:"px-2 py-1 text-right font-semibold w-28"})]})}),n.jsx("tbody",{children:ee.map(_=>{var ue;const P=Mb(_),X=P==="GREEN"?"bg-emerald-50":P==="RED"?"bg-red-50":"bg-yellow-50",ie=!!_.expensesSheetId,fe=_.reportSubject||_.insuredName||_.plaintiffName||"",se=typeof _.reportNumber=="number"&&_.reportNumber>0?_.reportNumber:(((ue=_.reportHistory)==null?void 0:ue.length)||0)+1;return n.jsxs("tr",{className:`border-b border-borderDark hover:bg-slate-100 cursor-pointer ${X}`,onClick:()=>s(_.id),children:[n.jsxs("td",{className:"px-2 py-1 text-right",children:[n.jsxs("div",{className:"text-textLight flex flex-wrap items-center gap-1 justify-end",children:[n.jsx("span",{children:fe}),ie&&n.jsx("span",{className:"inline-flex items-center rounded-full bg-purple-100 px-2 py-0.5 text-[10px] font-medium text-purple-700",children:" /  "})]}),(_.insuredName||_.plaintiffName)&&n.jsx("div",{className:"text-[10px] text-textMuted",children:[_.insuredName,_.plaintiffName].filter(Boolean).join(" / ")})]}),n.jsx("td",{className:"px-2 py-1 text-right text-slate-700",children:se}),n.jsxs("td",{className:"px-2 py-1 text-right text-slate-700",children:[x(_)," (",_.status,")"]}),n.jsx("td",{className:"px-2 py-1 text-right text-textMuted whitespace-nowrap",children:b(_.updatedAt||_.reportDate)}),n.jsx("td",{className:"px-2 py-1 text-left",children:n.jsx("button",{type:"button",onClick:we=>{we.stopPropagation(),s(_.id)},className:"inline-flex items-center rounded-full bg-lpBlue px-3 py-1 text-[11px] font-semibold text-white shadow-sm hover:bg-blue-900",children:' \\"'})})]},_.id)})})]})})]})]})]})})},Fb={DRAFT:"",READY_FOR_REPORT:" ",ATTACHED_TO_REPORT:" ",ARCHIVED:""},Bb=({user:e,reports:t,onLogout:s,onNotifyLawyer:r,onMarkReportPaid:a,onOpenAssistant:o,caseFolders:l})=>{const[i,c]=y.useState([]),[m,p]=y.useState(!1),[h,v]=y.useState("ALL"),[A,D]=y.useState(""),[I,W]=y.useState(null),[N,x]=y.useState(null),[b,B]=y.useState({}),H=async()=>{p(!0);try{const R=await Je.listSheets();c(R)}finally{p(!1)}};y.useEffect(()=>{H()},[]);const z=y.useMemo(()=>{const R=new Map;return t.forEach(k=>{if(!k.expensesSheetId)return;const C=R.get(k.expensesSheetId);if(!C){R.set(k.expensesSheetId,k);return}const ee=C.updatedAt&&new Date(C.updatedAt).getTime()||0;(k.updatedAt&&new Date(k.updatedAt).getTime()||0)>ee&&R.set(k.expensesSheetId,k)}),R},[t]),Y=y.useMemo(()=>i.filter(R=>{if(h!=="ALL"&&R.status!==h)return!1;const k=A.trim().toLowerCase();return!(k&&!(R.insurerName||"").toLowerCase().includes(k))}),[i,h,A]);y.useEffect(()=>{const R=Y.map(k=>k.id).filter(k=>!b[k]);R.length&&R.forEach(k=>{(async()=>{try{const C=await Je.getSheet(k);if(!C)return;const ee=_n(C.sheet,C.lineItems);B(V=>({...V,[k]:ee}))}catch{}})()})},[Y,b]);const Q=async R=>{const k=await Je.getSheet(R);k&&(W(R),x(k))},G=async()=>{const k=(window.prompt("  / :")||"").trim();if(!k)return;const C=Se(k),ee=t.filter(fe=>Se(fe.odakanitNo||"")===C);let V=null;ee.length>0&&(V=ee.reduce((se,ue)=>{const we=se.updatedAt?new Date(se.updatedAt).getTime()||0:new Date(se.reportDate||"").getTime()||0;return(ue.updatedAt?new Date(ue.updatedAt).getTime()||0:new Date(ue.reportDate||"").getTime()||0)>we?ue:se}).insurerName||null);let _=1,P=0,X=0;try{const se=(await Je.listSheets()).filter(ue=>Se(ue.caseId)===C);if(se.length>0){se.sort((He,Ue)=>{const Ze=new Date(He.updatedAt||He.createdAt).getTime();return new Date(Ue.updatedAt||Ue.createdAt).getTime()-Ze});const ue=se[0];P=ue.deductibleAmount??0,X=ue.alreadyPaidAmount??0,_=se.reduce((He,Ue)=>Ue.versionIndex&&Ue.versionIndex>He?Ue.versionIndex:He,1)+1}}catch{}const ie=await Je.createSheet(e,{caseId:k,insurerId:null,insurerName:V,periodLabel:"",versionIndex:_,currency:"ILS",deductibleAmount:P,alreadyPaidAmount:X,infoOnly:!1});await H(),await Q(ie.id)},ae=R=>{x(R),c(k=>k.map(C=>C.id===R.sheet.id?R.sheet:C));try{const k=_n(R.sheet,R.lineItems);B(C=>({...C,[R.sheet.id]:k}))}catch{}},E=()=>{W(null),x(null)};if(I&&N){const R=z.get(N.sheet.id)||null;return n.jsx("div",{className:"max-w-6xl mx-auto px-4 py-6",children:n.jsx(Ih,{user:e,sheetWithRelations:N,onSheetUpdated:ae,onBack:E,onNotifyLawyer:r,linkedReportForLawyer:R})})}return n.jsxs("div",{className:"max-w-6xl mx-auto px-4 py-6",children:[n.jsxs("div",{className:"flex items-center justify-between mb-5",children:[n.jsxs("div",{children:[n.jsx("h1",{className:"text-3xl font-semibold text-gray-900",children:" "}),n.jsx("p",{className:"text-base text-gray-600 mt-1",children:"        ()."})]}),n.jsxs("div",{className:"flex gap-2 items-center",children:[o&&n.jsx("button",{type:"button",className:"px-3 py-1.5 text-base rounded border border-indigo-200 text-indigo-800 bg-indigo-50 hover:bg-indigo-100",onClick:o,children:" "}),n.jsx("button",{type:"button",className:"px-3 py-1.5 text-base rounded border border-gray-300 text-gray-700 hover:bg-gray-50",onClick:s,children:""}),n.jsx("button",{type:"button",className:"px-4 py-1.5 text-base rounded bg-blue-600 text-white hover:bg-blue-700",onClick:G,children:"   "})]})]}),n.jsxs("div",{className:"flex flex-wrap gap-4 mb-4 items-end",children:[n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"  "}),n.jsxs("select",{className:"border rounded px-2 py-1 text-base",value:h,onChange:R=>v(R.target.value==="ALL"?"ALL":R.target.value),children:[n.jsx("option",{value:"ALL",children:""}),n.jsx("option",{value:"DRAFT",children:""}),n.jsx("option",{value:"READY_FOR_REPORT",children:" "}),n.jsx("option",{value:"ATTACHED_TO_REPORT",children:" "}),n.jsx("option",{value:"ARCHIVED",children:""})]})]}),n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:""}),n.jsx("input",{className:"border rounded px-2 py-1 text-base",placeholder:"   ",value:A,onChange:R=>D(R.target.value)})]})]}),n.jsx("div",{className:"bg-white border rounded-lg shadow-sm overflow-x-auto text-base",children:n.jsxs("table",{className:"min-w-full",children:[n.jsx("thead",{className:"bg-gray-50",children:n.jsxs("tr",{children:[n.jsx("th",{className:"px-3 py-2 border-b text-right",children:""}),n.jsx("th",{className:"px-3 py-2 border-b text-right",children:""}),n.jsx("th",{className:"px-3 py-2 border-b text-right",children:""}),n.jsx("th",{className:"px-3 py-2 border-b text-right",children:""}),n.jsx("th",{className:"px-3 py-2 border-b text-right",children:" "}),n.jsx("th",{className:"px-3 py-2 border-b text-right",children:" "}),n.jsx("th",{className:"px-3 py-2 border-b text-right",children:""})]})}),n.jsxs("tbody",{children:[m&&n.jsx("tr",{children:n.jsx("td",{colSpan:7,className:"px-3 py-4 text-center text-gray-500",children:" "})}),!m&&Y.length===0&&n.jsx("tr",{children:n.jsx("td",{colSpan:7,className:"px-3 py-4 text-center text-gray-500",children:"    ."})}),!m&&Y.map(R=>{const k=z.get(R.id),C=b[R.id],ee=k?k.status==="TASK_ASSIGNED"?" ":k.status==="WAITING_FOR_INVOICES"?" ":k.status==="READY_TO_SEND"?"   ":k.status==="SENT"?"  ":"  ":"",V=k?k.status==="SENT"?k.isPaid?"":"  ":ee:Fb[R.status],_=(()=>{const P=Se(R.caseId),X=l==null?void 0:l[P];return X&&X.closedAt?"":!X&&!t.some(fe=>Se(fe.odakanitNo)===P)?"  ":""})();return n.jsxs("tr",{className:"hover:bg-gray-50",children:[n.jsx("td",{className:"px-3 py-2 border-b font-mono text-sm text-gray-800",children:n.jsxs("div",{className:"flex flex-col items-start gap-0.5",children:[n.jsx("span",{children:R.caseId}),n.jsx("span",{className:"inline-flex px-2 py-0.5 rounded-full text-[11px] bg-gray-100 text-gray-700 border border-gray-200",children:_===""?" ":_==="  "?"  ":" "})]})}),n.jsx("td",{className:"px-3 py-2 border-b text-gray-800",children:R.insurerName||""}),n.jsxs("td",{className:"px-3 py-2 border-b text-gray-800",children:["  #",R.versionIndex]}),n.jsx("td",{className:"px-3 py-2 border-b",children:n.jsx("span",{className:"inline-flex px-2 py-0.5 rounded-full text-sm bg-gray-100 text-gray-700 border border-gray-200",children:V})}),n.jsx("td",{className:"px-3 py-2 border-b text-gray-700",children:R.updatedAt?new Date(R.updatedAt).toLocaleString("he-IL",{dateStyle:"short",timeStyle:"short"}):""}),n.jsx("td",{className:"px-3 py-2 border-b text-blue-700 font-semibold",children:C?`${C.amountToRequest.toLocaleString("he-IL")} `:""}),n.jsx("td",{className:"px-3 py-2 border-b text-left",children:n.jsxs("div",{className:"flex items-center gap-2 justify-start",children:[n.jsx("button",{type:"button",className:"px-3 py-1 text-sm rounded border border-blue-500 text-blue-700 hover:bg-blue-50",onClick:()=>void Q(R.id),children:""}),k&&k.status==="SENT"&&!k.isPaid&&a&&n.jsx("button",{type:"button",className:"px-3 py-1 text-sm rounded border border-green-500 text-green-700 hover:bg-green-50",onClick:()=>a(k.id),children:""}),n.jsx("button",{type:"button",className:"px-2 py-1 text-sm rounded border border-red-400 text-red-600 hover:bg-red-50",onClick:async()=>{window.confirm("    ?   .")&&(await Je.deleteSheet(R.id),await H())},children:""})]})})]},R.id)})]})]})})]})},$b=y.createContext(void 0);let Hb=0;const Ub=({children:e})=>{const[t,s]=y.useState([]),r=y.useCallback(l=>{s(i=>i.filter(c=>c.id!==l))},[]),a=y.useCallback(({message:l,type:i="info"})=>{const c=++Hb;s(m=>[...m,{id:c,message:l,type:i}]),window.setTimeout(()=>{r(c)},3e3)},[r]),o=l=>l==="success"?"border-l-gold text-goldLight":l==="error"?"border-l-danger text-red-300":"border-l-gold text-textLight";return n.jsxs($b.Provider,{value:{showToast:a},children:[e,n.jsx("div",{className:"fixed top-4 right-4 z-[260] flex flex-col gap-2 items-end pointer-events-none",dir:"rtl",children:t.map(l=>n.jsxs("div",{className:`pointer-events-auto max-w-xs bg-panel border border-borderDark rounded-lg shadow-lg px-3 py-2 border-l-4 text-xs flex items-center gap-2 text-textLight ${o(l.type)}`,children:[n.jsx("span",{className:"whitespace-pre-line",children:l.message}),n.jsx("button",{type:"button",onClick:()=>r(l.id),className:"ml-1 p-1 rounded hover:bg-navySecondary text-textMuted",children:n.jsx(_t,{className:"w-3 h-3"})})]},l.id))})]})},Wb=({folder:e,reports:t,onBack:s,onUpdateReTemplate:r,onCreateReportInCase:a,onOpenReport:o,currentUserRole:l,onCloseCase:i,onReopenCase:c,onDeleteCase:m})=>{const[p,h]=y.useState(e.reTemplate||""),v=()=>{const x=p.trim();x!==e.reTemplate&&r(x)},I=t.filter(x=>x.odakanitNo&&x.odakanitNo.trim()===e.odakanitNo).filter(x=>x.status!=="SENT"&&!x.deletedAt)[0]||null,W=!!e.closedAt,N=y.useMemo(()=>{const x=new Map;return e.sentReports.forEach(b=>{if(!b||!b.reportId)return;const B=x.get(b.reportId);if(!B){x.set(b.reportId,b);return}const H=new Date(B.sentAt).getTime()||0;(new Date(b.sentAt).getTime()||0)>=H&&x.set(b.reportId,b)}),Array.from(x.values()).sort((b,B)=>{const H=new Date(b.sentAt).getTime()||0,z=new Date(B.sentAt).getTime()||0;return H-z})},[e.sentReports]);return n.jsx("div",{className:"min-h-screen bg-bgDark px-0 pb-8",children:n.jsxs("div",{className:"mx-auto max-w-4xl px-4 pt-4",children:[n.jsx("button",{type:"button",onClick:s,className:"mb-4 inline-flex items-center rounded-full bg-panel border border-borderDark px-3 py-1.5 text-xs font-medium text-textLight shadow-sm hover:bg-navySecondary focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-gold focus-visible:ring-offset-2",children:"  "}),n.jsxs("header",{className:"mb-4 rounded-2xl bg-panel px-5 py-4 shadow-sm border border-borderDark flex flex-col gap-2 md:flex-row md:items-center md:justify-between",children:[n.jsxs("div",{children:[n.jsxs("h1",{className:"text-xl font-serif font-bold text-navy",children:["   ",e.odakanitNo]}),n.jsx("p",{className:"mt-1 text-xs text-textMuted",children:"       ."}),W&&n.jsx("p",{className:"mt-1 text-[11px] font-semibold text-amber-700",children:" :    .        ."})]}),n.jsxs("div",{className:"flex flex-wrap items-center gap-2 text-xs",children:[l==="ADMIN"&&!W&&i&&n.jsx("button",{type:"button",onClick:i,className:"inline-flex items-center rounded-full bg-red-50 px-3 py-1.5 font-semibold text-red-700 border border-red-200 hover:bg-red-100",children:" "}),l==="ADMIN"&&W&&n.jsxs(n.Fragment,{children:[c&&n.jsx("button",{type:"button",onClick:c,className:"inline-flex items-center rounded-full bg-green-50 px-3 py-1.5 font-semibold text-green-700 border border-green-200 hover:bg-green-100",children:"  "}),m&&n.jsx("button",{type:"button",onClick:m,className:"inline-flex items-center rounded-full bg-panel px-3 py-1.5 font-semibold text-textLight border border-borderDark hover:bg-navySecondary",children:" "})]})]})]}),n.jsxs("section",{className:"mb-4 grid gap-4 md:grid-cols-2",children:[n.jsxs("div",{className:"rounded-2xl bg-panel p-4 shadow-sm border border-borderDark",children:[n.jsx("h2",{className:"mb-2 text-xs font-semibold uppercase tracking-wide text-textMuted",children:" "}),n.jsxs("dl",{className:"space-y-1 text-xs text-textLight",children:[n.jsxs("div",{children:[n.jsx("dt",{className:"font-semibold text-textMuted",children:""}),n.jsx("dd",{children:e.insuredName||""})]}),n.jsxs("div",{children:[n.jsx("dt",{className:"font-semibold text-textMuted",children:""}),n.jsx("dd",{children:e.plaintiffName||""})]}),n.jsxs("div",{children:[n.jsx("dt",{className:"font-semibold text-textMuted",children:""}),n.jsx("dd",{children:e.insurerName||""})]}),n.jsxs("div",{children:[n.jsx("dt",{className:"font-semibold text-textMuted",children:"UMR /  "}),n.jsx("dd",{children:e.marketRef||""})]}),n.jsxs("div",{children:[n.jsx("dt",{className:"font-semibold text-textMuted",children:"Line Slip"}),n.jsx("dd",{children:e.lineSlipNo||""})]}),n.jsxs("div",{children:[n.jsx("dt",{className:"font-semibold text-textMuted",children:" "}),n.jsx("dd",{children:e.certificateRef||""})]}),n.jsxs("div",{children:[n.jsx("dt",{className:"font-semibold text-textMuted",children:"  "}),n.jsx("dd",{children:e.reportIds.length})]}),W&&n.jsxs("div",{children:[n.jsx("dt",{className:"font-semibold text-textMuted",children:" "}),n.jsx("dd",{className:"text-amber-700",children:""})]})]})]}),n.jsxs("div",{className:"rounded-2xl bg-panel p-4 shadow-sm border border-borderDark",children:[n.jsx("h2",{className:"mb-2 text-xs font-semibold uppercase tracking-wide text-textMuted",children:"  (RE)"}),n.jsx("textarea",{className:"w-full rounded-lg border border-borderDark p-2 text-xs text-textLight placeholder:text-textMuted focus:border-navy focus:outline-none focus:ring-1 focus:ring-navy",rows:4,value:p,onChange:x=>h(x.target.value),onBlur:v,placeholder:"Example: John Doe v. XYZ Medical Center - Claim Update"}),n.jsx("div",{className:"mt-3 flex justify-end",children:n.jsx("button",{type:"button",onClick:a,className:"inline-flex items-center rounded-full bg-navy px-4 py-1.5 text-[11px] font-semibold text-white shadow-sm hover:bg-blue-900 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-navy focus-visible:ring-offset-2",children:"    "})})]})]}),n.jsxs("section",{className:"mb-4 rounded-2xl bg-panel p-4 shadow-sm border border-borderDark",children:[n.jsxs("div",{className:"mb-3 flex items-center justify-between gap-3",children:[n.jsxs("div",{children:[n.jsx("h2",{className:"text-sm font-semibold text-textLight",children:"   "}),n.jsx("p",{className:"text-xs text-textMuted",children:"     SENT   ( )."})]}),n.jsxs("div",{className:"flex items-center gap-2",children:[I&&n.jsx("button",{type:"button",onClick:()=>o(I.id),className:"rounded-full bg-amber-50 px-3 py-1 text-[11px] font-semibold text-amber-800 border border-amber-200 hover:bg-amber-100",children:"     "}),!W&&n.jsx(n.Fragment,{children:l==="LAWYER"?!I&&n.jsx("button",{type:"button",onClick:a,className:"inline-flex items-center rounded-full bg-navy px-4 py-1.5 text-xs font-semibold text-white shadow-sm hover:bg-blue-900 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-navy focus-visible:ring-offset-2",children:"    "}):n.jsx("button",{type:"button",onClick:a,className:"inline-flex items-center rounded-full bg-navy px-4 py-1.5 text-xs font-semibold text-white shadow-sm hover:bg-blue-900 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-navy focus-visible:ring-offset-2",children:I?"   ()":"    "})})]})]}),n.jsx("div",{className:"overflow-x-auto",children:n.jsxs("table",{className:"min-w-full text-xs text-left text-textLight",children:[n.jsx("thead",{className:"bg-navySecondary text-[11px] uppercase tracking-wide text-textMuted",children:n.jsxs("tr",{children:[n.jsx("th",{className:"px-3 py-2",children:"' "}),n.jsx("th",{className:"px-3 py-2",children:""}),n.jsx("th",{className:"px-3 py-2",children:" "}),n.jsx("th",{className:"px-3 py-2",children:"  / "}),n.jsx("th",{className:"px-3 py-2",children:""})]})}),n.jsxs("tbody",{className:"divide-y divide-gray-100",children:[N.length===0&&n.jsx("tr",{children:n.jsx("td",{colSpan:4,className:"px-3 py-4 text-center text-textMuted",children:"No sent reports recorded for this case yet."})}),N.map(x=>{const b=x.sentAt?new Date(x.sentAt).toLocaleDateString("en-GB",{day:"2-digit",month:"short",year:"numeric"}):"",B=x.snapshot&&x.snapshot.reportSubject||"",H=x.fileName||B||"";return n.jsxs("tr",{children:[n.jsx("td",{className:"px-3 py-2",children:x.reportNo?`#${x.reportNo}`:""}),n.jsx("td",{className:"px-3 py-2",children:x.isResend?n.jsx("span",{className:"inline-flex items-center rounded-full bg-amber-50 px-2 py-0.5 text-[10px] font-semibold text-amber-800 border border-amber-200",children:" "}):n.jsx("span",{className:"inline-flex items-center rounded-full bg-navySecondary px-2 py-0.5 text-[10px] font-semibold text-textMuted border border-borderDark",children:" "})}),n.jsx("td",{className:"px-3 py-2",children:b}),n.jsx("td",{className:"px-3 py-2",children:H}),n.jsx("td",{className:"px-3 py-2",children:n.jsx("button",{type:"button",onClick:()=>o(x.reportId),className:"inline-flex items-center rounded-full bg-panel px-3 py-1 text-[11px] font-semibold text-navy ring-1 ring-navy hover:bg-blue-50 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-navy focus-visible:ring-offset-2","aria-label":` " ${x.reportId}`,children:""})})]},`${x.reportId}-${x.sentAt}`)})]})]})})]})]})})},Th="lp_case_folders",Rh="lp_case_folders_migrated",zb=()=>{if(typeof window>"u")return{};try{const e=window.localStorage.getItem(Th),t=e?JSON.parse(e):{};return!t||typeof t!="object"?{}:t}catch(e){return console.error("Failed to load case folders",e),{}}},In=e=>{if(!(typeof window>"u"))try{window.localStorage.setItem(Th,JSON.stringify(e))}catch(t){console.error("Failed to persist case folders",t)}},Vb=e=>{if(!e||typeof e!="object")return{};const t={};let s=!1;return Object.entries(e).forEach(([r,a])=>{const o=a.odakanitNo||r,l=Se(o);if(!l){s=!0;return}const i=t[l];if(!i){t[l]={...a,odakanitNo:l},l!==r&&(s=!0);return}s=!0;const c=(v,A)=>{if(!v)return A;if(!A)return v;const D=new Date(v.updatedAt||v.createdAt||"").getTime()||0;return(new Date(A.updatedAt||A.createdAt||"").getTime()||0)>D?A:v};let m=i,p=a;(!i.closedAt&&a.closedAt||c(i,a)===a)&&(m=a,p=i);const h={...m,odakanitNo:l,reTemplate:m.reTemplate||p.reTemplate||"",insuredName:m.insuredName||p.insuredName||"",insurerName:m.insurerName||p.insurerName||"",plaintiffName:m.plaintiffName||p.plaintiffName||"",marketRef:m.marketRef||p.marketRef||"",lineSlipNo:m.lineSlipNo||p.lineSlipNo||"",certificateRef:m.certificateRef||p.certificateRef||"",createdAt:m.createdAt||p.createdAt,updatedAt:m.updatedAt||p.updatedAt,closedAt:m.closedAt||p.closedAt||null,closedByUserId:m.closedByUserId||p.closedByUserId||null,reportIds:Array.from(new Set([...m.reportIds||[],...p.reportIds||[]])),sentReports:[...m.sentReports||[],...p.sentReports||[]]};t[l]=h}),s?t:e},Id=(e,t,s)=>{if(!t.odakanitNo)return e;const r=Se(t.odakanitNo);if(!r)return e;const a=s||new Date().toISOString(),o=e[r],l=o||{odakanitNo:r,reTemplate:"",insuredName:"",insurerName:"",plaintiffName:"",marketRef:"",lineSlipNo:"",certificateRef:"",createdAt:(o==null?void 0:o.createdAt)||a,updatedAt:(o==null?void 0:o.updatedAt)||a,reportIds:[],sentReports:(o==null?void 0:o.sentReports)||[]},i={...l,insuredName:t.insuredName||l.insuredName,insurerName:t.insurerName||l.insurerName,plaintiffName:t.plaintiffName||l.plaintiffName,marketRef:t.marketRef||l.marketRef,lineSlipNo:t.lineSlipNo||l.lineSlipNo,certificateRef:t.certificateRef||l.certificateRef,updatedAt:a,reportIds:l.reportIds.includes(t.id)?l.reportIds:[...l.reportIds,t.id],sentReports:l.sentReports},c=(t.reportSubject||"").trim();return c&&(!l.reTemplate||c!==l.reTemplate)&&(i.reTemplate=c),{...e,[r]:i}},Ch=(e,t,s,r,a)=>{var v;if(!t.odakanitNo)return e;const o=Se(t.odakanitNo);if(!o)return e;const l=s||new Date().toISOString(),i=e[o];if(!i)return e;const c=typeof t.reportNumber=="number"&&t.reportNumber>0?t.reportNumber:(((v=t.reportHistory)==null?void 0:v.length)||0)+1,m={id:t.id,odakanitNo:t.odakanitNo,insuredName:t.insuredName,plaintiffName:t.plaintiffName,insurerName:t.insurerName,marketRef:t.marketRef,lineSlipNo:t.lineSlipNo,certificateRef:t.certificateRef,reportDate:t.reportDate,status:"SENT",reportSubject:t.reportSubject},p={reportId:t.id,sentAt:l,reportNo:c,fileName:r,snapshot:m,isResend:!!a,resendIndex:c},h={...i,updatedAt:l,sentReports:[...i.sentReports,p]};return{...e,[o]:h}},Tc=(e,t)=>{let s={...e};return t.forEach(r=>{if(r.odakanitNo&&(s=Id(s,r,r.updatedAt||r.reportDate),r.status==="SENT")){const a=r.sentAt||r.reportDate||new Date().toISOString();s=Ch(s,r,a)}}),s},Kb=()=>{if(!(typeof window>"u"))try{window.localStorage.setItem(Rh,"1")}catch{}},Yb=()=>{if(typeof window>"u")return!0;try{return window.localStorage.getItem(Rh)==="1"}catch{return!0}},Gb=(e,t)=>{const s=e.split(/\s+/).filter(Boolean),r=t.split(/\s+/).filter(Boolean),a=s.length,o=r.length;if(!a&&!o)return[];const l=Array.from({length:a+1},()=>Array(o+1).fill(0));for(let p=a-1;p>=0;p-=1)for(let h=o-1;h>=0;h-=1)s[p]===r[h]?l[p][h]=l[p+1][h+1]+1:l[p][h]=Math.max(l[p+1][h],l[p][h+1]);const i=[];let c=0,m=0;for(;c<a&&m<o;)s[c]===r[m]?(i.push({type:"same",text:s[c]}),c+=1,m+=1):l[c+1][m]>=l[c][m+1]?(i.push({type:"remove",text:s[c]}),c+=1):(i.push({type:"add",text:r[m]}),m+=1);for(;c<a;)i.push({type:"remove",text:s[c]}),c+=1;for(;m<o;)i.push({type:"add",text:r[m]}),m+=1;return i},qb=e=>e==="STEP2"?2:e==="PREVIEW"?3:1,Xb=e=>{switch(e){case"STEP1":return"Setup";case"STEP2":return"Draft";case"PREVIEW":return"Preview";case"CASE_FOLDER":return"Case Folder";default:return"Dashboard"}},Jb=e=>e?e.role:"Guest",Qb=e=>e===1?[{intent:"explain_current_screen",label:"   ?"},{intent:"explain_buttons_in_step",label:"    "},{intent:"common_mistakes_here",label:"   1"}]:e===2?[{intent:"explain_current_screen",label:"    2"},{intent:"when_to_use_ai_tools",label:"   -AI "},{intent:"explain_hebrew_rewrite",label:"    "},{intent:"explain_tone_risk",label:"  Tone & Risk"},{intent:"common_mistakes_here",label:"   2"}]:[{intent:"pre_send_checks",label:"    "},{intent:"explain_tone_risk",label:"   Tone & Risk?"},{intent:"common_mistakes_here",label:"   "}],Zb=({isOpen:e,onClose:t,view:s,currentUser:r,currentReport:a,loading:o,error:l,response:i,onRunIntent:c})=>{if(!e)return null;const m=qb(s),p=Xb(s),h=Jb(r),v=Qb(m),A=!!a;return n.jsxs(n.Fragment,{children:[n.jsx("div",{className:"fixed inset-0 bg-black/10 z-[180]",onClick:t}),n.jsxs("div",{className:"fixed inset-y-0 right-0 z-[190] w-full max-w-md bg-panel border-l border-borderDark200 shadow-2xl flex flex-col",children:[n.jsxs("div",{className:"px-4 py-3 border-b border-borderDark200 flex items-center justify-between bg-navySecondary",children:[n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsx("div",{className:"h-8 w-8 rounded-full bg-indigo-600 flex items-center justify-center text-white",children:n.jsx(sa,{className:"w-4 h-4"})}),n.jsxs("div",{className:"flex flex-col",children:[n.jsx("span",{className:"text-sm font-semibold text-textLight",children:" "}),n.jsxs("span",{className:"text-[11px] text-textMuted",children:["Step ",m,"  ",p,"  ",h]})]})]}),n.jsx("button",{type:"button",onClick:t,className:"p-1 rounded hover:bg-navySecondary text-textMuted",children:n.jsx(_t,{className:"w-4 h-4"})})]}),n.jsxs("div",{className:"px-4 py-3 border-b border-borderDark bg-panel",children:[n.jsxs("div",{className:"flex items-center justify-between mb-2",children:[n.jsx("span",{className:"text-[11px] font-semibold text-textMuted600",children:"   "}),!A&&n.jsx("span",{className:"text-[10px] text-textMuted",children:'     ".'})]}),n.jsx("div",{className:"flex flex-wrap gap-2",children:v.map(D=>n.jsx("button",{type:"button",disabled:o||!A,onClick:()=>c(D.intent),className:`text-[11px] px-3 py-1.5 rounded-full border transition ${o||!A?"border-borderDark200 text-textMuted bg-navySecondary cursor-not-allowed":"border-indigo-200 text-indigo-800 bg-indigo-50 hover:bg-indigo-100"}`,children:D.label},D.intent))})]}),n.jsxs("div",{className:"flex-1 overflow-auto px-4 py-3 space-y-3",dir:"rtl",children:[o&&n.jsxs("div",{className:"flex items-center gap-2 text-[12px] text-textMuted600",children:[n.jsx(Mt,{className:"w-4 h-4 animate-spin"}),n.jsx("span",{children:"      "})]}),!o&&l&&n.jsxs("div",{className:"rounded-md border border-red-200 bg-red-50 px-3 py-2 text-[12px] text-red-800",children:[n.jsx("div",{className:"font-semibold mb-1",children:"    "}),n.jsx("div",{children:"      .   ,   ."})]}),!o&&!l&&i&&n.jsxs("div",{className:"space-y-2",children:[n.jsx("div",{className:"text-sm font-semibold text-textLight",children:i.title}),n.jsx("ul",{className:"list-disc pr-4 space-y-1 text-[12px] text-textLight",children:i.bullets.map((D,I)=>n.jsx("li",{children:D},I))}),i.warning&&n.jsxs("div",{className:"mt-2 rounded-md border border-amber-200 bg-amber-50 px-3 py-2 text-[11px] text-amber-900",children:[n.jsx("span",{className:"font-semibold",children:" : "}),i.warning]}),i.nextSuggestion&&n.jsxs("div",{className:"mt-1 text-[11px] text-textMuted600",children:[n.jsx("span",{className:"font-semibold",children:" : "}),i.nextSuggestion]})]}),!o&&!l&&!i&&n.jsxs("div",{className:"text-[12px] text-textMuted space-y-1",children:[n.jsx("div",{children:'         ,    " .'}),n.jsx("div",{children:"         ."})]})]}),n.jsxs("div",{className:"px-4 py-3 border-t border-borderDark bg-navySecondary",children:[n.jsx("div",{className:"text-[10px] text-textMuted mb-1",children:"   '        ."}),n.jsx("input",{type:"text",disabled:!0,className:"w-full text-[11px] px-2 py-1.5 rounded border border-dashed border-borderDark200 bg-navySecondary text-textMuted",placeholder:"          ."})]})]})]})},Tp=24*60*60*1e3;function ut(e,t,s=new Date){const r={isLocked:!1,lockType:"NONE",lockAt:null,autoLockAt:null,remainingDays:null,reasonSummary:null},a=s.getTime();if(t!=null&&t.closedAt){const o=t.closedAt;return{...r,isLocked:!0,lockType:"MANUAL",lockAt:o,autoLockAt:null,remainingDays:null,reasonSummary:"      ."}}if(e.manualLockedAt)return{...r,isLocked:!0,lockType:"MANUAL",lockAt:e.manualLockedAt,autoLockAt:null,remainingDays:null,reasonSummary:e.manualLockReason?` : ${e.manualLockReason}`:"   ."};if(e.firstSentAt){const l=new Date(e.firstSentAt).getTime();if(!Number.isFinite(l))return r;const c=35+((e.lockExtensions||[]).reduce((I,W)=>{const N=typeof W.days=="number"&&!Number.isNaN(W.days)?W.days:0;return I+N},0)||0),m=l+c*Tp,p=new Date(m),h=p.toISOString();if(a>=m)return{...r,isLocked:!0,lockType:"AUTO",lockAt:h,autoLockAt:h,remainingDays:null,reasonSummary:"    35    ."};const A=(m-a)/Tp,D=A>0?Math.ceil(A):0;return{...r,isLocked:!1,lockType:"NONE",lockAt:null,autoLockAt:h,remainingDays:D,reasonSummary:`    -${D}  (-${p.toLocaleDateString("he-IL")}).`}}return r}const Rp=new Map,ev=60*1e3;function dl(e){const t=`${e.reason}::${e.reportId??"unknown"}`,s=Date.now(),r=Rp.get(t)??0;s-r<ev||(Rp.set(t,s),console.info("[blocked-edit]",e))}const tv="personal_snippets",Dh=e=>`${tv}:${e}`,nv=(e,t)=>{if(!e)return[];try{const s=JSON.parse(e);if(!Array.isArray(s))return[];const r=new Date().toISOString();return s.map((a,o)=>{const l=a||{},i=typeof l.id=="string"&&l.id?l.id:`ps-${Date.now()}-${o}-${Math.random().toString(36).slice(2,6)}`,c=typeof l.title=="string"&&l.title.trim()?l.title:"Untitled snippet",m=typeof l.body=="string"?l.body:"",p=typeof l.createdAt=="string"&&l.createdAt?l.createdAt:r,h=typeof l.updatedAt=="string"&&l.updatedAt?l.updatedAt:p,v=typeof l.createdByUserId=="string"&&l.createdByUserId?l.createdByUserId:t,A=typeof l.usageCount=="number"&&Number.isFinite(l.usageCount)&&l.usageCount>=0?l.usageCount:0,D=typeof l.lastUsedAt=="string"&&l.lastUsedAt.trim()?l.lastUsedAt:null,I=typeof l.sectionKey=="string"&&l.sectionKey?l.sectionKey:void 0,W=Array.isArray(l.tags)?l.tags.filter(x=>typeof x=="string"&&x.trim()).map(x=>x.trim()):void 0;return{id:i,title:c,body:m,sectionKey:I,tags:W,createdByUserId:v,createdAt:p,updatedAt:h,usageCount:A,lastUsedAt:D}})}catch{return[]}},bo=e=>{if(typeof window>"u")return[];if(!e)return[];const t=window.localStorage.getItem(Dh(e));return nv(t,e)},$u=(e,t)=>{if(!(typeof window>"u")&&e)try{window.localStorage.setItem(Dh(e),JSON.stringify(t))}catch{}},sv=(e,t)=>{const s=new Date().toISOString(),r=bo(e);let a;if(t.id)a=r.map(o=>o.id===t.id?{...o,title:t.title,body:t.body,sectionKey:t.sectionKey,tags:t.tags,updatedAt:s}:o);else{const l={id:`ps-${Date.now()}-${Math.random().toString(36).slice(2,8)}`,title:t.title,body:t.body,sectionKey:t.sectionKey,tags:t.tags,createdByUserId:e,createdAt:s,updatedAt:s,usageCount:0,lastUsedAt:null};a=[...r,l]}return $u(e,a),a},Cp=(e,t)=>{const r=bo(e).filter(a=>a.id!==t);return $u(e,r),r},rv=(e,t)=>{const s=bo(e),r=new Date().toISOString(),a=s.map(o=>o.id===t?{...o,usageCount:(o.usageCount||0)+1,lastUsedAt:r}:o);return $u(e,a),a},av={title:"Final Preview",toggleHide:"Hide Preview",toggleShow:"Show Preview",downloadPdf:"Download PDF",editFileNames:"Edit file name titles",finalize:"Finalize & Close",backToEditing:"Back to Editing",backToStep2:"Back to Step 2",backToDashboard:"Back to dashboard",helperScroll:"Scroll to review entire document",collapsedHint:'Click "Show Preview" to review the document before sending.'},ov={title:" ",toggleHide:" ",toggleShow:" ",downloadPdf:" PDF",editFileNames:"  ",finalize:" ",backToEditing:" ",backToStep2:"  2",backToDashboard:"  ",helperScroll:"    ",collapsedHint:'  " "     .'},lv=e=>e==="LAWYER"?ov:av,Dp={SOC:["   ___________     ____________ ____________   ,   ____________________.","","        ____________________.","","      ,       ________________________."].join(`
`),LOD:["   ___________      .","","        ____________________.","",",    Claimant    ,      ______________________."].join(`
`)},iv=({message:e,type:t,onClose:s})=>{const r="fixed top-4 right-4 z-[100] p-4 rounded-lg shadow-xl border-l-4 flex items-center gap-3 animate-slide-in bg-panel border-borderDark text-textLight",a=t==="success"?"border-l-gold text-goldLight":t==="error"?"border-l-danger text-red-300":t==="warning"?"border-l-gold text-goldLight":"border-l-gold text-textLight";return n.jsxs("div",{className:`${r} ${a}`,children:[n.jsx("span",{children:e}),n.jsx("button",{onClick:s,className:"hover:bg-navySecondary p-1 rounded text-textMuted",children:n.jsx(_t,{className:"w-4 h-4"})})]})},cv=({onSubmit:e,onCancel:t,initialTitle:s})=>{const[r,a]=y.useState(s||""),[o,l]=y.useState("BEST_PRACTICE"),[i,c]=y.useState(""),[m,p]=y.useState("INSERTABLE"),h=v=>{v.preventDefault();const A=r.trim();if(!A)return;const D=i.split(",").map(I=>I.trim()).filter(Boolean);e({title:A,label:o,tags:D,behavior:m})};return n.jsxs("form",{onSubmit:h,className:"px-4 py-3 space-y-3 text-xs",children:[n.jsxs("div",{className:"space-y-1",children:[n.jsx("label",{className:"block font-semibold text-textLight",children:"Title"}),n.jsx("input",{type:"text",className:"w-full border border-borderDark rounded px-2 py-1 text-xs",value:r,onChange:v=>a(v.target.value),required:!0})]}),n.jsxs("div",{className:"space-y-1",children:[n.jsx("label",{className:"block font-semibold text-textLight",children:"Label / Type"}),n.jsxs("select",{className:"w-full border border-borderDark rounded px-2 py-1 text-xs",value:o,onChange:v=>l(v.target.value==="LLOYDS_RECOMMENDED"?"LLOYDS_RECOMMENDED":"BEST_PRACTICE"),children:[n.jsx("option",{value:"BEST_PRACTICE",children:"Best practice"}),n.jsx("option",{value:"LLOYDS_RECOMMENDED",children:"Lloyds recommended"})]})]}),n.jsxs("div",{className:"space-y-1",children:[n.jsx("label",{className:"block font-semibold text-textLight",children:"Tags (optional)"}),n.jsx("input",{type:"text",className:"w-full border border-borderDark rounded px-2 py-1 text-xs",placeholder:"e.g. lloyds, settlement, high exposure",value:i,onChange:v=>c(v.target.value)})]}),n.jsxs("div",{className:"space-y-1",children:[n.jsx("label",{className:"block font-semibold text-textLight",children:"Behavior"}),n.jsxs("div",{className:"flex items-center gap-3",children:[n.jsxs("label",{className:"flex items-center gap-1",children:[n.jsx("input",{type:"radio",name:"bp-behavior",checked:m==="INSERTABLE",onChange:()=>p("INSERTABLE")}),n.jsx("span",{children:"Insertable (insert into body)"})]}),n.jsxs("label",{className:"flex items-center gap-1",children:[n.jsx("input",{type:"radio",name:"bp-behavior",checked:m==="COPY_ONLY",onChange:()=>p("COPY_ONLY")}),n.jsx("span",{children:"Copy only"})]})]})]}),n.jsxs("div",{className:"flex items-center justify-end gap-2 pt-2 border-t border-borderDark mt-2",children:[n.jsx("button",{type:"button",onClick:t,className:"px-3 py-1.5 rounded border border-borderDark text-[11px] text-textLight hover:bg-slate-100",children:""}),n.jsx("button",{type:"submit",className:"px-3 py-1.5 rounded bg-emerald-600 text-white text-[11px] hover:bg-emerald-700",children:" Best Practice"})]})]})},Lp=({value:e,onChange:t,placeholder:s,disabled:r,readOnly:a,dir:o="ltr",className:l,style:i={},textareaRef:c})=>{const m=y.useRef(null),p=c||m;return y.useEffect(()=>{const h=p&&"current"in p?p.current:m.current;h&&(h.style.height="auto",h.style.height=h.scrollHeight+"px")},[e,p]),n.jsx(mo,{clientId:go,children:n.jsx("textarea",{ref:p,className:l,dir:o,value:e,onChange:a?void 0:t,placeholder:s,disabled:r||a,rows:3,style:{...i,overflow:"hidden",resize:"none"}})})},dv=({onClose:e})=>{const[t,s]=y.useState("MANUAL"),[r,a]=y.useState(""),[o,l]=y.useState([]),[i,c]=y.useState(!1),m=async()=>{if(!r.trim())return;c(!0);const p=await z0(r);l(h=>[...h,{q:r,a:p}]),a(""),c(!1)};return n.jsx("div",{className:"fixed inset-0 bg-black/50 z-[200] flex items-center justify-center p-4",children:n.jsxs("div",{className:"bg-panel w-full max-w-3xl h-[600px] rounded-xl shadow-2xl flex flex-col overflow-hidden animate-scale-in",children:[n.jsxs("div",{className:"bg-navy p-4 text-gold flex justify-between items-center",children:[n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsx(ju,{className:"w-6 h-6"}),n.jsx("h2",{className:"font-bold text-lg",children:"  "})]}),n.jsx("button",{onClick:e,className:"hover:bg-panel/20 rounded p-1",children:n.jsx(_t,{className:"w-5 h-5"})})]}),n.jsxs("div",{className:"flex border-b",children:[n.jsx("button",{onClick:()=>s("MANUAL"),className:`flex-1 p-3 font-bold ${t==="MANUAL"?"text-lpBlue border-b-2 border-lpBlue":"text-textMuted"}`,children:" "}),n.jsx("button",{onClick:()=>s("CHAT"),className:`flex-1 p-3 font-bold ${t==="CHAT"?"text-lpBlue border-b-2 border-lpBlue":"text-textMuted"}`,children:"   "})]}),n.jsx("div",{className:"flex-1 overflow-auto p-6 bg-navySecondary",dir:"rtl",children:t==="MANUAL"?n.jsxs("div",{className:"space-y-4",children:[n.jsxs("details",{className:"bg-panel p-4 rounded shadow-sm group",children:[n.jsxs("summary",{className:"font-bold text-textLight cursor-pointer list-none flex justify-between",children:["   ",n.jsx(es,{className:"group-open:rotate-90 transition"})]}),n.jsxs("div",{className:"mt-2 text-textMuted text-sm space-y-1",children:[n.jsx("p",{children:"1.       (CRM / Finance /    )."}),n.jsx("p",{children:"2.       +  Notifications   ."}),n.jsx("p",{children:`3.  ""     ' .`})]})]}),n.jsxs("details",{className:"bg-panel p-4 rounded shadow-sm group",children:[n.jsxs("summary",{className:"font-bold text-textLight cursor-pointer list-none flex justify-between",children:['    " ',n.jsx(es,{className:"group-open:rotate-90 transition"})]}),n.jsxs("div",{className:"mt-2 text-textMuted text-sm space-y-1",children:[n.jsxs("p",{children:["1.   ",n.jsx("strong",{children:"Open New Case Folder"}),",      ."]}),n.jsx("p",{children:"2.  ,   4  (Word/PDF)    ."}),n.jsx("p",{children:"3.   FINANCE FINALIZE     ."})]})]}),n.jsxs("details",{className:"bg-panel p-4 rounded shadow-sm group",children:[n.jsxs("summary",{className:"font-bold text-textLight cursor-pointer list-none flex justify-between",children:["   ",n.jsx(es,{className:"group-open:rotate-90 transition"})]}),n.jsxs("div",{className:"mt-2 text-textMuted text-sm space-y-1",children:[n.jsx("p",{children:'   View Worksheet  , ,   " .'}),n.jsx("p",{children:" /     ( ADD),    ."}),n.jsx("p",{children:'  ,      "     Expenses.'})]})]}),n.jsxs("details",{className:"bg-panel p-4 rounded shadow-sm group",children:[n.jsxs("summary",{className:"font-bold text-textLight cursor-pointer list-none flex justify-between",children:["    ",n.jsx(es,{className:"group-open:rotate-90 transition"})]}),n.jsxs("div",{className:"mt-2 text-textMuted text-sm space-y-1",children:[n.jsx("p",{children:"  Manage Favorite Providers     ."}),n.jsx("p",{children:"        ."}),n.jsx("p",{children:'    4   (PDF/Word)  "    .'})]})]}),n.jsxs("details",{className:"bg-panel p-4 rounded shadow-sm group",children:[n.jsxs("summary",{className:"font-bold text-textLight cursor-pointer list-none flex justify-between",children:[' "     ',n.jsx(es,{className:"group-open:rotate-90 transition"})]}),n.jsxs("div",{className:"mt-2 text-textMuted text-sm space-y-1",children:[n.jsx("p",{children:"       -FINANCE   FINALIZE."}),n.jsx("p",{children:' FINALIZE  "     (READY TO SEND)   .'}),n.jsx("p",{children:"     (48   , 30   )     ."})]})]})]}):n.jsxs("div",{className:"flex flex-col h-full",children:[n.jsxs("div",{className:"flex-1 space-y-4 mb-4 overflow-auto",children:[o.length===0&&n.jsx("div",{className:"text-center text-gray-400 mt-10",children:"     !"}),o.map((p,h)=>n.jsxs("div",{className:"space-y-1",children:[n.jsx("div",{className:"bg-blue-100 text-blue-900 p-2 rounded-lg rounded-tr-none self-end w-fit ml-auto max-w-[80%]",children:p.q}),n.jsx("div",{className:"bg-panel border text-textLight p-2 rounded-lg rounded-tl-none self-start w-fit mr-auto max-w-[80%]",children:p.a})]},h))]}),n.jsxs("div",{className:"flex gap-2",dir:"ltr",children:[n.jsx("input",{className:"flex-1 border p-2 rounded",placeholder:"/   ...",value:r,onChange:p=>a(p.target.value),onKeyDown:p=>p.key==="Enter"&&m()}),n.jsx("button",{onClick:m,disabled:i,className:"bg-navy text-gold px-4 rounded hover:bg-navySecondary",children:i?n.jsx(Mt,{className:"w-5 h-5 animate-spin"}):n.jsx(Xl,{className:"w-5 h-5"})})]})]})})]})})},uv=({reports:e,currentUser:t,onMarkPaid:s})=>{const r=e.filter(l=>l.expensesSum&&!l.isPaid),a=r.reduce((l,i)=>{var m;const c=parseFloat(((m=i.expensesSum)==null?void 0:m.replace(/,/g,""))||"0");return l+(isNaN(c)?0:c)},0),o=t.role==="SUB_ADMIN";return r.length?n.jsxs("div",{className:"mb-8 bg-panel rounded-xl shadow-sm border border-indigo-100 overflow-hidden",children:[n.jsxs("div",{className:"bg-gradient-to-r from-indigo-600 to-indigo-800 p-4 text-white flex justify-between items-center",children:[n.jsxs("h3",{className:"font-bold text-lg flex items-center",children:[n.jsx(g0,{className:"w-6 h-6 mr-2"})," Financial Control - Outstanding Expenses"]}),n.jsxs("div",{className:"text-xl font-bold bg-panel/20 px-4 py-1 rounded",children:["Total: ",a.toLocaleString()]})]}),n.jsx("div",{className:"overflow-x-auto",children:n.jsxs("table",{className:"w-full text-left text-sm",children:[n.jsx("thead",{className:"bg-indigo-50 text-indigo-800",children:n.jsxs("tr",{children:[n.jsx("th",{className:"p-3",children:"Report Date"}),n.jsx("th",{className:"p-3",children:"Insured / File"}),n.jsx("th",{className:"p-3",children:"Amount Requested"}),n.jsx("th",{className:"p-3",children:"Action"})]})}),n.jsx("tbody",{className:"divide-y divide-gray-100",children:r.map(l=>n.jsxs("tr",{className:"hover:bg-navySecondary",children:[n.jsx("td",{className:"p-3",children:new Date(l.reportDate).toLocaleDateString()}),n.jsxs("td",{className:"p-3 font-medium",children:[l.insuredName," (",l.marketRef,")"]}),n.jsxs("td",{className:"p-3 font-bold text-indigo-700",children:["",l.expensesSum]}),n.jsx("td",{className:"p-3",children:o?n.jsx("button",{onClick:()=>s(l.id),className:"text-red-400 hover:text-red-600 hover:bg-red-50 p-1.5 rounded transition",title:"Mark as Paid",children:n.jsx(Ps,{className:"w-4 h-4"})}):n.jsx("span",{className:"text-gray-400 cursor-not-allowed",children:n.jsx(Ps,{className:"w-4 h-4"})})})]},l.id))})]})})]}):null};new URL("/assets/statement%20of%20claim-BbEIHM0L.jpg",import.meta.url).href,new URL("/assets/statement%20of%20defence-BIigMwUC.jpg",import.meta.url).href,new URL("/assets/preliminary%20proceedings-BoY9iCcP.jpg",import.meta.url).href,new URL("/assets/evidence%20submission-CZIKo1E1.jpg",import.meta.url).href,new URL("/assets/evidentiary%20hearing-BibkA_Ru.jpg",import.meta.url).href,new URL("/assets/summaries-BEUvavav.jpg",import.meta.url).href,new URL("/assets/judgment-cIMuyU1R.jpg",import.meta.url).href;const mv=[{value:"LETTER_OF_DEMAND",label:"Letter of Demand"},{value:"FIRST_INSTANCE",label:"First Instance Proceedings"},{value:"APPEAL",label:"Appeal Proceedings"}],Ca={LETTER_OF_DEMAND:[{id:"LOD_ISSUED",label:"Letter of Demand Issued"},{id:"LOD_INTERNAL_REVIEW",label:"Internal Review & Coverage Assessment"},{id:"LOD_RESPONSE",label:"Response to Letter of Demand"},{id:"LOD_PRE_LITIGATION",label:"Pre-Litigation Negotiations"},{id:"LOD_OUTCOME_ESCALATION",label:"Outcome / Escalation Decision"},{id:"LOD_CLAIM_SETTLED",label:"Claim Settled"},{id:"LOD_DEMAND_REJECTED",label:"Demand Rejected"}],FIRST_INSTANCE:[{id:"FI_STATEMENT_OF_CLAIM",label:"Statement of Claim Filed"},{id:"FI_STATEMENT_OF_DEFENCE",label:"Statement of Defence Filed"},{id:"FI_DISCOVERY_DISCLOSURE",label:"Discovery & Disclosure"},{id:"FI_COURT_APPOINTED_EXPERT",label:"Court-Appointed Expert",isDynamic:!0},{id:"FI_RD_DOCS_DAMAGE_SUBMISSIONS",label:"R & D Docs  Damage Assessment Submissions",isDynamic:!0},{id:"FI_EVIDENTIARY_HEARINGS",label:"Evidentiary Hearings"},{id:"FI_SUMMATIONS",label:"Summations"},{id:"FI_JUDGMENT",label:"Judgment"}],APPEAL:[{id:"AP_DECISION_TO_APPEAL",label:"Decision to Appeal"},{id:"AP_NOTICE_OF_APPEAL",label:"Notice of Appeal Filed"},{id:"AP_RESPONSE_TO_APPEAL",label:"Response to Appeal"},{id:"AP_APPEAL_HEARINGS",label:"Appeal Hearings"},{id:"AP_APPEAL_JUDGMENT",label:"Appeal Judgment"}]},ns=[{value:"EXPERT_OUR",label:"Expert fees on our behalf",type:"EXPENSE"},{value:"EXPERT_COURT",label:"Expert fees on behalf of the court",type:"EXPENSE"},{value:"INVESTIGATION",label:"Private Investigation fees",type:"EXPENSE"},{value:"SECONDARY_FEE",label:"Payment of secondary procedure fee",type:"EXPENSE"},{value:"COURT_FEES",label:"Court fees",type:"EXPENSE"},{value:"PHOTOCOPY",label:"Photocopying and binding of documents",type:"EXPENSE"},{value:"MEDICAL_RECORDS",label:"Medical Records Collection",type:"EXPENSE"},{value:"ATTORNEY_PHASE_1",label:"Attorney fees for phase 1",type:"EXPENSE"},{value:"ATTORNEY_PHASE_2",label:"Attorney fees for phase 2",type:"EXPENSE"},{value:"ATTORNEY_PHASE_3",label:"Attorney fees for phase 3",type:"EXPENSE"},{value:"ATTORNEY_PHASE_4",label:"Attorney fees for phase 4",type:"EXPENSE"},{value:"ATTORNEY_PHASE_5",label:"Attorney fees for phase 5",type:"EXPENSE"},{value:"ATTORNEY_EXTRA_HEARING",label:"Attorney fees for extra court hearing",type:"EXPENSE"},{value:"ATTORNEY_THIRD_PARTY",label:"Attorney fees for third party notice",type:"EXPENSE"},{value:"OTHER",label:"Other",type:"EXPENSE"},{value:"COMPENSATION_JUDGMENT",label:"Compensation by Judgment",type:"ADJUSTMENT"},{value:"COMPENSATION_SETTLEMENT",label:"Compensation under Settlement",type:"ADJUSTMENT"},{value:"DEDUCTIBLE",label:"Deductible paid by the insured",type:"ADJUSTMENT"},{value:"PAID_BY_INSURER",label:"Expenses already paid by the insurer",type:"ADJUSTMENT"}],_s=()=>({status:"DRAFT",rows:[],history:[],notes:[],favorites:[],totals:{totalExpenses:0,totalAdjustments:0,totalBalance:0}}),pv=1e3*60*60*48,Lh=1e3*60*60*24*30,_h=7*24*60*60*1e3,_p={lineSlip:"UNIQUE MARKET REF",certificate:"CERTIFICATE REF"},pt={REPORTS:"lp_reports",USER:"lp_current_user",VIEW:"lp_view",CURRENT_REPORT:"lp_current_report",CASE_FOLDERS:"lp_case_folders",NOTIFICATIONS:"lp_notifications"},Ka="Expenses breakdown",qr=e=>e?e===Ka?!0:/\bexpenses\b/i.test(e):!1,fv=()=>{},Op=(e,t,s)=>{if(!e)return e;let r=!1;const a={...e};if(a.content&&t.forEach(o=>{var i;const l=(i=a.content)==null?void 0:i[o];l!==void 0&&(a.content={...a.content},!a.content[s]&&l&&(a.content[s]=l),delete a.content[o],r=!0)}),a.translatedContent&&t.forEach(o=>{var i;const l=(i=a.translatedContent)==null?void 0:i[o];l!==void 0&&(a.translatedContent={...a.translatedContent},!a.translatedContent[s]&&l&&(a.translatedContent[s]=l),delete a.translatedContent[o],r=!0)}),Array.isArray(a.selectedSections)&&a.selectedSections.some(l=>t.includes(l))){const l=a.selectedSections.map(i=>t.includes(i)?s:i);a.selectedSections=Array.from(new Set(l)),r=!0}return a.expertSummaryMode&&t.forEach(o=>{var i;const l=(i=a.expertSummaryMode)==null?void 0:i[o];l&&(a.expertSummaryMode={...a.expertSummaryMode,[s]:l},delete a.expertSummaryMode[o],r=!0)}),r?a:e},xv=e=>{let t=Op(e,oh,$s);return t=Op(t,lh,ko),t},hv=e=>{const t={...e};return t.reportReview||(t.reportReview={status:"DRAFT",issues:[]}),t.hebrewWorkflowStatus||(t.hebrewWorkflowStatus="HEBREW_DRAFT"),Array.isArray(t.reportReview.issues)&&t.reportReview.issues.length>0&&(t.reportReview={...t.reportReview,issues:t.reportReview.issues.map(s=>{const r=s.origin??"INTERNAL";let a=s.externalAction;return r==="EXTERNAL"&&!a&&(a="ENGLISH_ONLY"),{...s,origin:r,externalAction:a}})}),t},gv=()=>{if(typeof window>"u")return[];try{fv();const e=localStorage.getItem(pt.REPORTS);return(e?JSON.parse(e):[]).map(xv).map(hv)}catch(e){return console.error("Failed to load stored reports",e),[]}},yv=()=>{if(typeof window>"u")return"DASHBOARD";const e=localStorage.getItem(pt.VIEW);return e&&(e==="STEP1"||e==="STEP2"||e==="PREVIEW"||e==="DASHBOARD"||e==="CASE_FOLDER")?e:"DASHBOARD"},si=e=>{const t=e.filter(r=>r.type==="EXPENSE").reduce((r,a)=>r+(a.amount||0),0),s=e.filter(r=>r.type==="ADJUSTMENT").reduce((r,a)=>r+(a.amount||0),0);return{totalExpenses:t,totalAdjustments:s,totalBalance:t-s}},Mp=e=>{var t,s;if((t=e.expenseWorksheet)!=null&&t.totals)return e.expenseWorksheet.totals.totalBalance;if(e.expensesSum){const r=parseFloat(e.expensesSum.replace(/,/g,""));if(!isNaN(r))return r}return(s=e.expensesItems)!=null&&s.length?e.expensesItems.reduce((r,a)=>r+(a.amount||0),0):0},Pp=e=>{var t,s,r;return(((s=(t=e.expenseWorksheet)==null?void 0:t.rows)==null?void 0:s.length)??0)>0||(((r=e.expensesItems)==null?void 0:r.length)??0)>0||!!(e.expensesSum&&e.expensesSum!=="0")},Tn=()=>Math.random().toString(36).slice(2,10),Tr=e=>e==null?e:JSON.parse(JSON.stringify(e)),Fp=e=>new Promise((t,s)=>{const r=new FileReader;r.onloadend=()=>{const a=r.result,o=a.includes(",")?a.split(",")[1]:a;t(o)},r.onerror=()=>s(new Error("Failed to convert blob")),r.readAsDataURL(e)}),ri=e=>e?e.replace(/\r\n/g,`
`).replace(/\t/g," ").split(`
`).map(r=>r.replace(/\s+$/g,"").replace(/ {2,}/g," ")).join(`
`).trim().replace(/\n{3,}/g,`

`):"",Oh=e=>{if(!e)return e;let t=e;const s=[{pattern:/\bprosecutor\b/gi,replacement:"plaintiff"},{pattern:/\ba specialist\b/gi,replacement:"an expert"},{pattern:/\bthe specialist\b/gi,replacement:"the expert"},{pattern:/\bProf\.(?=\s|$)/gi,replacement:"prof"},{pattern:/\bNational Insurance Institute\b/gi,replacement:"NII"},{pattern:/\boperation\b/gi,replacement:"surgery"},{pattern:/\bdamage calculations\b/gi,replacement:"R & D Docs"},{pattern:/\bdemander\b/gi,replacement:"claimant"},{pattern:/\bapplicant\b/gi,replacement:"claimant"},{pattern:/\bbranch\b/gi,replacement:"clinic"},{pattern:/\bverdict\b/gi,replacement:"judgment"},{pattern:/\binterrogation\b/gi,replacement:"cross-examination"},{pattern:/\bDr\.(?=\s|$)/gi,replacement:"Dr"},{pattern:/\bversion\b/gi,replacement:"position"},{pattern:/\bpolicyholder\b/gi,replacement:"insured"}];for(const{pattern:r,replacement:a}of s)t=t.replace(r,a);return t=t.replace(/\bopinion\b/gi,(r,a,o)=>{const l=Math.max(0,a-20),i=o.slice(l,a).toLowerCase();return/\bexpert\s*$/.test(i)?r:"expert opinion"}),t},Rc=e=>{const t=e||{};return Object.keys(t).reduce((s,r)=>(s[r]=ri(t[r]),s),{})},Nv=e=>e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),Mh=e=>{if(!e)return{protectedText:e,map:{}};let t=e;const s={};let r=0;const a=(l,i)=>{t=t.replace(l,c=>{const m=`${i}_${++r}`;return s[m]||(s[m]=c),m})};a(/(?:|\$||)\s*\d[\d,]*(?:\.\d+)?/g,"MONEY"),a(/\b(?:USD|NIS|ILS|EUR|GBP)\s*\d[\d,]*(?:\.\d+)?\b/gi,"MONEY"),a(/\d[\d,]*(?:\.\d+)?\s*(?:NIS|ILS|USD|EUR|GBP)\b/gi,"MONEY"),a(/\d[\d,]*(?:\.\d+)?%/g,"PCT"),a(/\b\d{1,2}[\/\.]\d{1,2}[\/\.]\d{4}\b/g,"DATE");const o="(January|February|March|April|May|June|July|August|September|October|November|December|Jan|Feb|Mar|Apr|Jun|Jul|Aug|Sep|Oct|Nov|Dec)";return a(new RegExp(`\\b\\d{1,2}\\s+${o}\\s+\\d{4}\\b`,"g"),"DATE"),a(new RegExp(`\\b${o}\\s+\\d{1,2},\\s+\\d{4}\\b`,"g"),"DATE"),a(/\b(?:Policy\s+No\.?|Claim\s+#?|File|Case)\s+[A-Za-z0-9\/\-]+\b/gi,"ID"),a(/\b[A-Za-z0-9]{3,}[A-Za-z0-9\-\/]{3,}\b/g,"ID"),a(/\b\d{1,3}(?:,\d{3})*(?:\.\d+)?\b/g,"NUM"),{protectedText:t,map:s}},Ph=(e,t)=>{if(!e||!t||!Object.keys(t).length)return e;let s=e;for(const[r,a]of Object.entries(t)){const o=new RegExp(Nv(r),"g");s=s.replace(o,a)}return s},bv=`
               . ,   ,          .

          , ,  ,            .

      -  ,     .

   ,     ,                .

      .
`.trim(),vv=["The policy period is from [policyStartDate] to [policyEndDate].","","The retroactive date is [retroactiveDate].","","    _______________, ,   .","","      ,     ____________  ____________.","",",         ."].join(`
`),Fh=(e,t,s,r,a)=>{const o=vv,l=B=>`${B}`,i=t||"",c=s||"",m=r||a||"",p=l(`The policy period is from ${i} to ${c}.`),h=l(`The retroactive date is ${m}.`),v=["    _______________, ,   .","","      ,     ____________  ____________.","",",         ."].join(`
`),A=B=>B.replace(/\[policyStartDate\]/gi,i).replace(/\[policyEndDate\]/gi,c).replace(/\[retroactiveDate\]/gi,m),D=`${p}

${h}

${v}`,I=o?A(o):"";if(!I&&!e)return D;let N=e&&e.trim().length?e:I||D;(/\[policyStartDate\]/i.test(N)||/\[policyEndDate\]/i.test(N)||/\[retroactiveDate\]/i.test(N))&&(N=A(N));const x=/The policy period is[^\n]*/i;x.test(N)?N=N.replace(x,p):(!e||!e.trim())&&(N=`${p}

${N}`);const b=/The retroactive date is[^\n]*/i;return b.test(N)?N=N.replace(b,h):(!e||!e.trim())&&(N=N.includes(p)?N.replace(p,`${p}

${h}`):`${h}

${N}`),N.includes("   ")||(N=`${N.trim()}

${v}`),N},Td=(e,t)=>e.map(s=>{var l;const r=ns.find(i=>i.value===s.category),a=(r==null?void 0:r.type)||"EXPENSE",o=s.category==="OTHER"?((l=s.customLabel)==null?void 0:l.trim())||"Other expense":(r==null?void 0:r.label)||"Expense";return{id:s.id||Tn(),type:a,category:s.category,label:o,serviceProvider:a==="EXPENSE"?s.serviceProvider:void 0,amount:Number(s.amount)||0,locked:!1,createdBy:t==null?void 0:t.id,createdAt:new Date().toISOString(),updatedBy:t==null?void 0:t.id,updatedAt:new Date().toISOString()}}),Sv=e=>e.filter(t=>t.type==="EXPENSE").map(t=>({id:t.id,date:new Date().toISOString().split("T")[0],description:`${t.label}${t.serviceProvider?` (${t.serviceProvider})`:""}`,amount:t.amount,currency:"NIS"})),wv=({data:e,updateData:t,onNext:s,currentUser:r,timelineGallery:a,onAddTimelineImages:o,onRemoveTimelineImage:l,onSaveAndExit:i,readOnly:c})=>{var Ze,ze,rt,qe;const[m,p]=y.useState(""),[h,v]=y.useState(!1),A=e.insurerName===""||ap.includes(e.insurerName),[D,I]=y.useState(!A),[W,N]=y.useState(!1),[x,b]=y.useState(!1);y.useRef(null);const[B,H]=y.useState(()=>({})),z=j=>j?new Date(j).toISOString().split("T")[0]:new Date().toISOString().split("T")[0],Y=j=>j.trim().replace(/\s+/g," "),Q=j=>{const $=e,J="plaintiffName"in j?j.plaintiffName??$.plaintiffName:$.plaintiffName,pe="insuredName"in j?j.insuredName??$.insuredName:$.insuredName;if(!(!!J&&!!pe))return j;const he=Y(J),je=Y(pe),Be=`${he} v. ${je}`,Ve="reportSubject"in j?j.reportSubject??$.reportSubject:$.reportSubject,tt="isSubjectAuto"in j?j.isSubjectAuto??$.isSubjectAuto:$.isSubjectAuto;return!Ve||!Ve.trim()||tt?{...j,reportSubject:Be,isSubjectAuto:!0}:j},G=j=>{c||(j==="OTHER"?(I(!0),t(Q({insurerName:""}))):(I(!1),t(Q({insurerName:j}))))},ae=()=>{if(!e.odakanitNo||!Se(e.odakanitNo)){alert("     (Odakanit)    .");return}s()},E=j=>{c||((e.expensesSheetId||e.expensesHtml)&&qr(j)&&(j=Ka),e.selectedSections.includes(j)||t({selectedSections:[...e.selectedSections,j]}),v(!1))},R=j=>{if(c||j==="Update")return;if(!!(e.expensesSheetId||e.expensesHtml)&&qr(j)){window.alert("           .");return}t({selectedSections:e.selectedSections.filter(J=>J!==j)})},k=()=>{c||m.trim()&&!e.selectedSections.includes(m)&&(t({selectedSections:[...e.selectedSections,m]}),p(""))},C=(j,$)=>{const J=$==="UP"?j-1:j+1;if(J<0||J>=e.selectedSections.length)return;const pe=[...e.selectedSections];[pe[j],pe[J]]=[pe[J],pe[j]],t({selectedSections:pe})},ee=()=>{const j=e.proceduralTimeline;return j&&j.procedureType?j:{procedureType:"FIRST_INSTANCE",currentStageId:"FI_STATEMENT_OF_CLAIM",stages:[]}},V=typeof e.selectedTimeline=="string"?e.selectedTimeline.trim().length>0:!!e.selectedTimelineImage;y.useEffect(()=>{if(e.proceduralTimeline||V)return;const j=ee();t({proceduralTimeline:j})},[e.proceduralTimeline,V]),y.useEffect(()=>{const j=e.proceduralTimeline;if(!j)return;const $=Ca[j.procedureType];if(!$||!$.length)return;const J=[];if($.forEach(me=>{var Be;const he=((Be=j.stages)==null?void 0:Be.find(Ve=>Ve.id===me.id))||void 0;(me.isDynamic?!!(he!=null&&he.include):(he==null?void 0:he.include)!==!1)&&J.push(me.id)}),!J.length||J.includes(j.currentStageId))return;const pe=J[0];pe&&pe!==j.currentStageId&&t({proceduralTimeline:{...j,currentStageId:pe}})},[e.proceduralTimeline,t]);const _=j=>{var he;const $=ee(),pe=(he=Ca[j][0])==null?void 0:he.id,me={...$,procedureType:j,currentStageId:pe||$.currentStageId,stages:$.stages.filter(je=>Ca[$.procedureType].some(Be=>Be.id===je.id)).map(je=>({...je}))};t({proceduralTimeline:me}),H({})},P=j=>{const J={...ee(),currentStageId:j};t({proceduralTimeline:J})},X=(j,$)=>{const J=ee(),pe=Array.isArray(J.stages)?[...J.stages]:[],me=pe.findIndex(Be=>Be.id===j);me>=0?pe[me]={...pe[me],include:$}:pe.push({id:j,label:"",include:$,isDynamic:!0,monthYear:null});let he=J.currentStageId;if(!$&&j===J.currentStageId){const Be=Ca[J.procedureType];if(Be&&Be.length){const Ve=[];if(Be.forEach(tt=>{const Ke=pe.find(Z=>Z.id===tt.id)||void 0;(tt.isDynamic?!!(Ke!=null&&Ke.include):(Ke==null?void 0:Ke.include)!==!1)&&Ve.push(tt.id)}),Ve.length){const tt=Be.findIndex(ot=>ot.id===j);let Ke=null;if(tt>0)for(let ot=tt-1;ot>=0;ot-=1){const Z=Be[ot].id;if(Ve.includes(Z)){Ke=Z;break}}Ke||(Ke=Ve[0]),he=Ke}}}const je={...J,currentStageId:he,stages:pe};t({proceduralTimeline:je})},ie=(j,$,J)=>{H(Ve=>{const tt={...Ve};return!!!$&&!!!J?delete tt[j]:tt[j]={month:$,year:J},tt});const pe=ee(),me=Array.isArray(pe.stages)?[...pe.stages]:[],he=me.findIndex(Ve=>Ve.id===j);let je=null;if($&&J){const Ve=$.padStart(2,"0");je=`${J}-${Ve}`}he>=0?me[he]={...me[he],monthYear:je}:me.push({id:j,label:"",include:!0,isDynamic:!1,monthYear:je});const Be={...pe,stages:me};t({proceduralTimeline:Be})},fe=async j=>{var J;if(c){j.preventDefault();return}const $=(J=j.target.files)==null?void 0:J[0];if($){N(!0);try{const pe=new FileReader;pe.onload=async()=>{var Ve;const me=pe.result.split(",")[1],he=await F0(me,$.type);let je={};if(he.insuredName){const tt={...je,insuredName:he.insuredName},Ke=e.isSubjectAuto!==!1;je=Q(Ke?{...tt,isSubjectAuto:!0}:tt),Ke&&(!e.reportSubject||!e.reportSubject.trim())&&(je.reportSubject=he.insuredName,je.isSubjectAuto=!0)}he.marketRef?(je.marketRef=he.marketRef,je.lineSlipNo=he.marketRef):he.lineSlipNo&&!je.lineSlipNo&&(je.lineSlipNo=he.lineSlipNo),he.certificateRef&&(je.certificateRef=he.certificateRef),typeof he.policyPeriodStart=="string"&&(je.policyPeriodStart=he.policyPeriodStart),typeof he.policyPeriodEnd=="string"&&(je.policyPeriodEnd=he.policyPeriodEnd),typeof he.retroStart=="string"&&(je.retroStart=he.retroStart),typeof he.retroEnd=="string"&&(je.retroEnd=he.retroEnd),je.policyFile={id:"policy-doc",name:$.name,data:me,type:$.type};const Be=Fh((Ve=e.content)==null?void 0:Ve["Insurance Coverage"],je.policyPeriodStart||e.policyPeriodStart,je.policyPeriodEnd||e.policyPeriodEnd,je.retroStart||e.retroStart,je.retroEnd||e.retroEnd);Be&&(je.content={...e.content,"Insurance Coverage":Be}),t(je),N(!1)},pe.readAsDataURL($)}catch(pe){console.error("Error reading file",pe),N(!1)}}},se=10,ue=10,we=async j=>{if(c){j.preventDefault(),j.target.value="";return}const $=j.target.files;if(!$||!$.length)return;const J=e.lawyerAppendixFiles??[];if(J.length>=se){alert(`You can attach up to ${se} appendices.`),j.target.value="";return}const pe=se-J.length,me=Array.from($).slice(0,pe),he=[];for(const je of me){if(je.size/1048576>ue){alert(`${je.name} is larger than ${ue}MB and will not be attached.`);continue}let Ve=je.type;Ve||(/\.(tif|tiff)$/i.test(je.name)?Ve="image/tiff":Ve="application/octet-stream");const tt=new FileReader,Ke=await new Promise((ot,Z)=>{tt.onload=()=>{const M=String(tt.result||"").split(",");ot(M[1]||"")},tt.onerror=()=>Z(tt.error),tt.readAsDataURL(je)});he.push({id:`lawyer-appx-${Date.now()}-${Math.random().toString(36).slice(2,8)}`,name:je.name,data:Ke,type:Ve})}he.length&&t({lawyerAppendixFiles:[...J,...he]}),j.target.value=""},He=j=>{if(c)return;const J=(e.lawyerAppendixFiles??[]).filter(pe=>pe.id!==j);t({lawyerAppendixFiles:J})},Ue=(j,$,J)=>n.jsxs("div",{className:"relative group",children:[n.jsx("input",{className:"w-full border border-borderDark p-2 rounded focus:ring-2 focus:ring-lpBlue outline-none pr-8",placeholder:J,value:j,onChange:c?void 0:pe=>$(pe.target.value),disabled:c}),j&&n.jsx("button",{type:"button",onClick:c?void 0:()=>$(""),className:`absolute right-2 top-1/2 -translate-y-1/2 text-gray-300 transition-colors ${c?"cursor-not-allowed opacity-50":"hover:text-red-500"}`,disabled:c,children:n.jsx(Ps,{className:"w-4 h-4"})})]});return n.jsxs("div",{className:"space-y-8",children:[n.jsx("div",{className:"flex justify-end",children:n.jsxs("button",{type:"button",onClick:c?void 0:i,disabled:c,className:`flex items-center text-sm bg-blue-50 px-3 py-1.5 rounded-full ${c?"text-gray-400 cursor-not-allowed":"text-lpBlue hover:text-blue-900"}`,title:c?"  .":void 0,children:[n.jsx(Eu,{className:"w-4 h-4 mr-1"}),"  "]})}),n.jsx("h2",{className:"text-3xl font-bold text-lpBlue font-serif border-b pb-2",children:"1. Case Setup & Structure"}),e.odakanitNo&&n.jsx("div",{className:"bg-indigo-50 border-l-4 border-indigo-600 p-4 mb-6",children:n.jsx("div",{className:"flex justify-between items-center",children:n.jsxs("div",{children:[n.jsxs("h3",{className:"font-bold text-indigo-900 flex items-center",children:[n.jsx(th,{className:"w-5 h-5 mr-2"})," Odakanit Case #",e.odakanitNo]}),n.jsx("p",{className:"text-sm text-indigo-700",children:"This report folder was initiated by Finance."})]})})}),n.jsxs("div",{className:"bg-panel p-6 rounded-lg shadow-sm border border-borderDark relative overflow-hidden",children:[n.jsx("div",{className:"absolute top-0 left-0 w-1 h-full bg-lpGold"}),n.jsxs("h3",{className:"font-bold text-lg mb-4 text-textLight flex items-center",children:[n.jsx(po,{className:"w-5 h-5 mr-2 text-lpGold"}),"Re: Case Details (Mandatory Fields - English)"]}),n.jsx("div",{className:"mb-6 bg-blue-50 border-2 border-dashed border-blue-200 rounded-lg p-4 text-center relative group",children:W?n.jsxs("div",{className:"flex flex-col items-center justify-center py-2",children:[n.jsx(Mt,{className:"w-8 h-8 text-lpBlue animate-spin mb-2"}),n.jsx("span",{className:"text-sm font-bold text-lpBlue",children:"Analyzing Policy Document..."})]}):n.jsx(n.Fragment,{children:e.policyFile?n.jsxs("div",{className:"flex flex-col items-center justify-center gap-3",children:[n.jsxs("div",{className:"flex items-center justify-center gap-3",children:[n.jsxs("div",{className:"flex flex-col items-center text-green-700 font-bold text-center",children:[n.jsxs("div",{className:"flex items-center",children:[n.jsx(eh,{className:"w-6 h-6 mr-2"}),"Policy Document Attached"]}),n.jsxs("span",{className:"text-xs font-normal text-green-800",children:["Original file: ",e.policyFile.name]})]}),n.jsx("button",{className:"text-xs text-red-500 hover:underline disabled:text-gray-400 disabled:cursor-not-allowed",onClick:c?void 0:()=>t({policyFile:void 0}),disabled:c,children:"Remove"})]}),n.jsxs("div",{className:"flex items-center justify-center gap-2 text-xs text-textLight bg-panel/70 px-3 py-1 rounded-full border border-borderDark",children:[n.jsx("input",{id:"attach-policy-appendix",type:"checkbox",className:"h-3 w-3 accent-lpBlue",checked:e.attachPolicyAsAppendix??!0,onChange:c?void 0:j=>t({attachPolicyAsAppendix:j.target.checked}),disabled:c}),n.jsx("label",{htmlFor:"attach-policy-appendix",className:"cursor-pointer",children:"Attach policy as Appendix A to final PDF"})]})]}):n.jsxs(n.Fragment,{children:[n.jsxs("div",{className:`flex flex-col items-center justify-center text-center px-4 ${c?"cursor-not-allowed opacity-60":"cursor-pointer"}`,children:[n.jsx(fo,{className:"w-8 h-8 text-lpBlue mb-2 group-hover:scale-110 transition-transform"}),n.jsx("span",{className:"text-sm font-bold text-textLight",children:"Upload Policy Document"}),n.jsx("span",{className:"text-xs text-textMuted mt-1",children:"Any file uploaded here (PDF/DOCX/scan) is treated as the official policy for this case."})]}),n.jsx("input",{type:"file",className:"absolute inset-0 opacity-0 cursor-pointer",accept:"application/pdf,application/vnd.openxmlformats-officedocument.wordprocessingml.document,text/plain,image/*",onChange:fe,disabled:c})]})})}),n.jsxs("div",{className:"mb-6 mt-4 bg-slate-50 border border-dashed border-borderDark rounded-lg p-4",children:[n.jsxs("h4",{className:"text-sm font-semibold text-textLight mb-2 flex items-center justify-between",children:[n.jsx("span",{children:"Additional Appendices (Lawyer)"}),n.jsxs("span",{className:"text-[11px] text-textMuted",children:[((Ze=e.lawyerAppendixFiles)==null?void 0:Ze.length)||0,"/",se]})]}),n.jsx("div",{className:"flex flex-col md:flex-row gap-3 md:items-center",children:n.jsx("div",{className:"flex-1",children:n.jsxs("label",{htmlFor:"lawyer-appendix-input",className:`flex flex-col items-center justify-center px-3 py-3 border-2 border-dashed border-borderDark rounded-lg text-xs text-textMuted bg-panel transition-colors ${c?"cursor-not-allowed opacity-60":"cursor-pointer hover:border-lpBlue hover:text-lpBlue"}`,children:[n.jsx(fo,{className:"w-5 h-5 mb-1"}),n.jsx("span",{className:"font-semibold",children:"Upload / drag legal appendices"}),n.jsxs("span",{className:"mt-1 text-[11px] text-textMuted",children:["Supported: PDF, PNG, JPG, TIFF (up to ",ue,"MB per file)"]}),n.jsx("input",{id:"lawyer-appendix-input",type:"file",multiple:!0,className:"hidden",accept:"application/pdf,image/png,image/jpeg,image/jpg,image/tiff,image/x-tiff",onChange:we,disabled:c})]})})}),(((ze=e.lawyerAppendixFiles)==null?void 0:ze.length)||0)>0&&n.jsx("div",{className:"mt-3 border-t border-borderDark pt-2 space-y-1 max-h-40 overflow-y-auto text-xs text-textLight text-left",children:(rt=e.lawyerAppendixFiles)==null?void 0:rt.map(j=>n.jsxs("div",{className:"flex items-center justify-between gap-2 rounded bg-panel px-2 py-1 border border-borderDark",children:[n.jsxs("div",{className:"flex-1 min-w-0",children:[n.jsx("div",{className:"truncate font-medium",children:j.name}),n.jsx("div",{className:"text-[11px] text-textMuted truncate",children:j.type||"Unknown type"})]}),n.jsx("button",{type:"button",onClick:c?void 0:()=>He(j.id),className:"text-[11px] text-red-500 hover:text-red-700 disabled:text-gray-400 disabled:cursor-not-allowed",disabled:c,children:"Remove"})]},j.id))})]}),n.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-5",children:[n.jsxs("div",{className:"space-y-1",children:[n.jsxs("label",{className:"text-xs font-bold text-textMuted uppercase flex items-center",children:[n.jsx(y0,{className:"w-3 h-3 mr-1"})," Report Date"]}),n.jsx("input",{type:"date",className:"w-full border border-borderDark p-2 rounded disabled:bg-navySecondary disabled:text-textMuted",value:z(e.reportDate),onChange:c?void 0:j=>t({reportDate:new Date(j.target.value).toISOString()}),disabled:c})]}),n.jsxs("div",{className:"space-y-1",children:[n.jsx("label",{className:"text-xs font-bold text-textMuted uppercase",children:"RE (Subject)"}),n.jsx("input",{type:"text",className:"w-full border border-borderDark p-2 rounded text-sm disabled:bg-navySecondary disabled:text-textMuted",placeholder:"e.g. John Doe v. XYZ Medical Center  Claim Update",value:e.reportSubject||"",onChange:c?void 0:j=>t({reportSubject:j.target.value,isSubjectAuto:!1}),disabled:c})]}),n.jsxs("div",{className:"space-y-1",children:[n.jsx("label",{className:"text-xs font-bold text-textMuted uppercase",children:"Odakanit Case Number (Internal File)"}),Ue(e.odakanitNo||"",j=>t({odakanitNo:j}),"e.g., 1/123")]}),n.jsxs("div",{className:"space-y-1",children:[n.jsx("label",{className:"text-xs font-bold text-textMuted uppercase",children:"Insurer Name"}),n.jsxs("select",{className:"w-full border border-borderDark p-2 rounded disabled:bg-navySecondary disabled:text-textMuted",value:D?"OTHER":e.insurerName,onChange:c?void 0:j=>G(j.target.value),disabled:c,children:[n.jsx("option",{value:"",disabled:!0,children:"-- Select Insurer --"}),ap.map(j=>n.jsx("option",{value:j,children:j},j)),n.jsx("option",{value:"OTHER",children:"Other (Enter Manually)"})]}),D&&n.jsx("div",{className:"mt-2 animate-fade-in",children:Ue(e.insurerName,j=>t({insurerName:j}),"Type custom insurer name...")})]}),n.jsxs("div",{className:"space-y-1",children:[n.jsx("label",{className:"text-xs font-bold text-textMuted uppercase",children:_p.lineSlip}),Ue(e.lineSlipNo,j=>t({lineSlipNo:j,marketRef:j}),"e.g., B0180PD2391439")]}),n.jsxs("div",{className:"space-y-1",children:[n.jsx("label",{className:"text-xs font-bold text-textMuted uppercase",children:_p.certificate}),Ue(e.certificateRef||"",j=>t({certificateRef:j}),"e.g., 516902624")]}),n.jsxs("div",{className:"space-y-1",children:[n.jsx("label",{className:"text-xs font-bold text-textMuted uppercase",children:"Insured Name"}),Ue(e.insuredName,j=>t(Q({insuredName:j})),"e.g., Dr. Cohen")]}),n.jsxs("div",{className:"space-y-1 md:col-span-2",children:[n.jsxs("div",{className:"flex justify-between items-end mb-1",children:[n.jsx("label",{className:"text-xs font-bold text-textMuted uppercase",children:"Party Name"}),n.jsxs("div",{className:"flex bg-navySecondary rounded p-0.5 text-xs",children:[n.jsx("button",{className:`px-3 py-1 rounded-sm transition-all ${e.plaintiffTitle==="Plaintiff"?"bg-panel shadow text-lpBlue font-bold":"text-textMuted"}`,onClick:()=>t({plaintiffTitle:"Plaintiff"}),children:"Plaintiff"}),n.jsx("button",{className:`px-3 py-1 rounded-sm transition-all ${e.plaintiffTitle==="Claimant"?"bg-panel shadow text-lpBlue font-bold":"text-textMuted"}`,onClick:()=>t({plaintiffTitle:"Claimant"}),children:"Claimant"})]})]}),Ue(e.plaintiffName,j=>t(Q({plaintiffName:j})),"e.g., Mr. Levi")]})]})]}),n.jsxs("div",{className:"bg-panel p-6 rounded-lg shadow-sm border border-borderDark",children:[n.jsx("div",{className:"flex justify-between items-center mb-4",children:n.jsxs("div",{children:[n.jsxs("h3",{className:"font-bold text-lg text-textLight flex items-center",children:[n.jsx(nh,{className:"w-5 h-5 mr-2 text-lpBlue"}),"Procedural Timeline"]}),n.jsx("p",{className:"text-sm text-textMuted",children:'   ,    Month/Year    ".'})]})}),n.jsxs("div",{className:"mb-4",children:[n.jsx("label",{className:"block text-xs font-semibold text-textMuted mb-1",children:"Procedure Type"}),n.jsx("select",{className:"border border-borderDark rounded px-3 py-1 text-sm",value:((qe=e.proceduralTimeline)==null?void 0:qe.procedureType)||"FIRST_INSTANCE",onChange:j=>_(j.target.value),children:mv.map(j=>n.jsx("option",{value:j.value,children:j.label},j.value))})]}),!e.proceduralTimeline&&V&&n.jsxs("div",{className:"border border-dashed border-borderDark rounded-md p-3 bg-navySecondary text-xs text-textLight",children:[n.jsx("p",{className:"mb-2",children:"This report uses the legacy timeline. You can enable the new Procedural Timeline (recommended for new reports)."}),n.jsx("button",{type:"button",className:"inline-flex items-center px-3 py-1 rounded-full bg-navy text-gold text-[11px] font-semibold hover:bg-navySecondary",onClick:()=>t({proceduralTimeline:ee()}),children:"Enable Procedural Timeline"})]}),e.proceduralTimeline&&n.jsx("div",{className:"space-y-3",children:Ca[e.proceduralTimeline.procedureType].map(j=>{var tt,Ke,ot;const $=((Ke=(tt=e.proceduralTimeline)==null?void 0:tt.stages)==null?void 0:Ke.find(Z=>Z.id===j.id))||void 0,J=B[j.id],pe=!!j.isDynamic,me=pe?!!($!=null&&$.include):!0,he=($==null?void 0:$.monthYear)||"";let je="",Be="";if(J)je=J.month||"",Be=J.year||"";else if(typeof he=="string"&&he.includes("-")){const[Z,be]=he.split("-");Z&&be&&(Be=Z,je=be)}const Ve=((ot=e.proceduralTimeline)==null?void 0:ot.currentStageId)===j.id;return n.jsxs("div",{className:"flex items-start justify-between border border-borderDark rounded-lg px-3 py-2 bg-panel",children:[n.jsxs("div",{className:"flex items-start gap-3",children:[n.jsx("input",{type:"radio",name:"currentStage",className:"mt-1",checked:Ve,disabled:!me,onChange:()=>me&&P(j.id)}),n.jsxs("div",{children:[n.jsxs("div",{className:"font-semibold text-sm text-textLight flex items-center gap-2",children:[n.jsx("span",{children:j.label}),pe&&n.jsx("span",{className:"text-[10px] px-2 py-0.5 rounded-full bg-navySecondary text-textMuted",children:"Dynamic"})]}),n.jsxs("div",{className:"mt-1 flex items-center gap-2 text-xs text-textMuted flex-wrap",children:[n.jsx("span",{children:"Month / Year:"}),n.jsxs("select",{className:"border border-borderDark rounded px-2 py-0.5 text-xs",value:je,disabled:!me,onChange:Z=>ie(j.id,Z.target.value,Be),children:[n.jsx("option",{value:"",children:""}),n.jsx("option",{value:"01",children:"January"}),n.jsx("option",{value:"02",children:"February"}),n.jsx("option",{value:"03",children:"March"}),n.jsx("option",{value:"04",children:"April"}),n.jsx("option",{value:"05",children:"May"}),n.jsx("option",{value:"06",children:"June"}),n.jsx("option",{value:"07",children:"July"}),n.jsx("option",{value:"08",children:"August"}),n.jsx("option",{value:"09",children:"September"}),n.jsx("option",{value:"10",children:"October"}),n.jsx("option",{value:"11",children:"November"}),n.jsx("option",{value:"12",children:"December"})]}),n.jsx("input",{type:"number",className:"w-20 border border-borderDark rounded px-2 py-0.5 text-xs",placeholder:"Year",value:Be,disabled:!me,onChange:Z=>ie(j.id,je,Z.target.value),min:1900,max:2100})]})]})]}),pe&&n.jsxs("div",{className:"flex items-center gap-1 text-xs text-textMuted",children:[n.jsx("span",{children:"Include"}),n.jsx("input",{type:"checkbox",checked:me,onChange:Z=>X(j.id,Z.target.checked)})]})]},j.id)})})]}),n.jsxs("div",{className:"bg-panel p-6 rounded-lg shadow-sm border border-borderDark",children:[n.jsxs("h3",{className:"font-bold text-lg mb-4 text-textLight flex items-center",children:[n.jsx(k0,{className:"w-5 h-5 mr-2 text-green-600"}),"Current Report Sections"]}),n.jsx("div",{className:"space-y-2 mb-6",children:e.selectedSections.map((j,$)=>{const J=$>0,pe=$<e.selectedSections.length-1,he=!!(e.expensesSheetId||e.expensesHtml)&&qr(j),je=j==="Update"||he;return n.jsxs("div",{className:"flex items-center justify-between p-3 bg-panel border border-borderDark rounded shadow-sm",children:[n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsx("span",{className:"w-6 h-6 rounded-full bg-navySecondary text-textMuted flex items-center justify-center text-xs font-bold",children:$+1}),n.jsx("span",{className:"font-medium text-textLight",children:j}),j==="Update"&&n.jsx("span",{className:"text-xs bg-blue-100 text-blue-800 px-2 py-0.5 rounded",children:"Fixed"}),he&&n.jsx("span",{className:"text-xs bg-amber-100 text-amber-800 px-2 py-0.5 rounded",children:"   "})]}),n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsxs("div",{className:"flex flex-col gap-1",children:[n.jsx("button",{onClick:()=>C($,"UP"),disabled:!J,className:`p-1 rounded border ${J?"text-textMuted hover:bg-navySecondary":"text-gray-300 cursor-not-allowed"}`,title:" ",children:n.jsx(b0,{className:"w-4 h-4"})}),n.jsx("button",{onClick:()=>C($,"DOWN"),disabled:!pe,className:`p-1 rounded border ${pe?"text-textMuted hover:bg-navySecondary":"text-gray-300 cursor-not-allowed"}`,title:" ",children:n.jsx(N0,{className:"w-4 h-4"})})]}),!je&&n.jsx("button",{onClick:()=>R(j),className:"text-gray-400 hover:text-red-500 transition",title:" ",children:n.jsx(_t,{className:"w-4 h-4"})})]})]},`${j}-${$}`)})}),h?n.jsxs("div",{className:"bg-navySecondary p-4 rounded border animate-fade-in",children:[n.jsxs("div",{className:"flex gap-2",children:[n.jsxs("select",{className:"flex-1 border p-2 rounded",onChange:j=>E(j.target.value),defaultValue:"",children:[n.jsx("option",{value:"",disabled:!0,children:"-- Select a Header --"}),Rr.filter(j=>!e.selectedSections.includes(j)).map(j=>n.jsx("option",{value:j,children:j},j))]}),n.jsx("button",{onClick:()=>v(!1),className:"px-4 py-2 bg-borderDark text-textMuted rounded hover:bg-borderDark",children:"Cancel"})]}),n.jsx("div",{className:"mt-4 pt-4 border-t border-borderDark",children:n.jsxs("div",{className:"flex gap-2",children:[n.jsx("input",{className:"flex-1 border p-2 rounded",placeholder:"Type custom header name...",value:m,onChange:j=>p(j.target.value)}),n.jsx("button",{onClick:()=>{k(),v(!1)},className:"px-4 py-2 bg-purple-600 text-white rounded hover:bg-purple-700",children:"Add Custom"})]})})]}):n.jsxs("button",{onClick:()=>v(!0),className:"w-full py-2 border-2 border-dashed border-borderDark text-textMuted rounded hover:border-green-500 hover:text-green-600 transition flex items-center justify-center font-medium",children:[n.jsx(Au,{className:"w-4 h-4 mr-2"})," Add Report Section"]})]}),n.jsxs("div",{className:"flex flex-wrap justify-between gap-2",children:[n.jsxs("button",{onClick:i,className:"flex items-center text-textMuted px-4 py-2 border rounded hover:bg-navySecondary transition",children:[n.jsx(ql,{className:"mr-2 w-4 h-4"})," Back to Dashboard"]}),n.jsxs("button",{onClick:ae,className:"flex items-center bg-navy text-gold px-6 py-2 rounded hover:bg-navySecondary transition shadow-md",children:["Next Step ",n.jsx(es,{className:"ml-2 w-4 h-4"})]})]})]})},Bp=e=>{if(!e)return null;try{const t=JSON.stringify(e);let s=0;for(let r=0;r<t.length;r+=1){const a=t.charCodeAt(r);s=(s<<5)-s+a,s|=0}return String(s)}catch{return null}},jv=({data:e,updateData:t,onBack:s,onNext:r,currentUser:a,onSaveAndExit:o,onSaveDraft:l,onTranslate:i,onImproveEnglish:c,onFormatContent:m,onSubmitHebrewForReview:p,onApproveHebrewForTranslation:h,onAddReviewIssues:v,onMarkReviewIssueDone:A,onAddExternalFeedbackIssues:D,onReopenHebrewDueToExternalFeedback:I,step1Focus:W,onStep1FocusConsumed:N,isTranslating:x,isImprovingEnglish:b,onOpenAssistant:B,onActiveSectionChange:H,readOnly:z})=>{var U;const Y=$s,Q=ko,[G,ae]=y.useState(null),[E,R]=y.useState(!1),[k,C]=y.useState(null),[ee,V]=y.useState([]),[_,P]=y.useState(""),[X,ie]=y.useState(!1),[fe,se]=y.useState(()=>Rr[0]||"Update"),[ue,we]=y.useState([]),[He,Ue]=y.useState(!1),[Ze,ze]=y.useState(null),[rt,qe]=y.useState(null),[j,$]=y.useState(null),[J,pe]=y.useState([]),[me,he]=y.useState(!1),[je,Be]=y.useState(null),[Ve,tt]=y.useState("SAFE_POLISH"),[Ke,ot]=y.useState(null),[Z,be]=y.useState([]),[M,K]=y.useState("TEMPLATES"),[oe,le]=y.useState(""),[ne,xe]=y.useState(!1),[Ie,Ee]=y.useState(()=>Rr[0]||"Update"),[Me,Ye]=y.useState(null),[ht,lt]=y.useState(()=>bo(a.id)),[Ne,Ct]=y.useState(""),[Es,os]=y.useState(!1),[At,It]=y.useState(null),[un,ls]=y.useState("DUAL"),[ct,Fn]=y.useState(null),[er,tr]=y.useState(null),[ks,Sn]=y.useState(null),[Bn,Gn]=y.useState(null),[wn,jn]=y.useState(null),Sr=y.useRef(null),T=y.useRef(null),ve=y.useRef({}),[De,Pe]=y.useState({date:new Date().toISOString().split("T")[0],description:"",amount:0,currency:"NIS"}),$e=a.role==="FINANCE"||a.role==="SUB_ADMIN"&&!0,Fe=e.selectedSections.some(d=>d.toLowerCase().includes("expenses")),En=a.role==="LAWYER"&&e.requiresExpenses===!0&&Fe,mn=a.role==="ADMIN"&&e.isTranslated,As=a.role==="LAWYER"||a.role==="ADMIN",kn=a.role==="FINANCE"||a.role==="SUB_ADMIN"||a.role==="ADMIN",ma=((U=e.reportReview)==null?void 0:U.status)==="APPROVED"||e.hebrewWorkflowStatus==="HEBREW_APPROVED",Ao=e.translatedContent||{},Io=Object.keys(Ao).some(d=>{if(d.toLowerCase().includes("expenses"))return!1;const g=Ao[d];return typeof g=="string"&&g.trim().length>0});y.useEffect(()=>{lt(bo(a.id))},[a.id]);const $t=async d=>{var w,F;if(z||!mn||!e.isTranslated||d.toLowerCase().includes("expenses"))return;const g=((w=e.translatedContent)==null?void 0:w[d])||"";if(g.trim()){jn(d);try{const{protectedText:q,map:re}=Mh(g),ge=await ch(q),Te=Ph(ge||q,re),Ce=Oh(Te),te={...e.translatedContent||{},[d]:ri(Ce)};t({translatedContent:te}),typeof l=="function"&&l()}catch(q){console.error("Improve English (single section) failed",q);const re=jd(d,(F=e.expertSummaryMode)==null?void 0:F[d]);window.alert(`   "${re}" .      .`)}finally{jn(q=>q===d?null:q)}}},Zt=d=>typeof d.reportNumber=="number"&&d.reportNumber===1,Si=d=>up(d)?"EXPERT":d===Q?"DEMAND":"CLAIM";y.useEffect(()=>{if(!W)return;const d=()=>{let g=null;W==="EXTERNAL_FEEDBACK"?g=Ed:W==="REVIEW"&&(g=wl);let w=null;if(g&&(w=document.getElementById(g)),w||(w=document.getElementById(wl)),w)try{w.scrollIntoView({behavior:"smooth",block:"start"})}catch{}N&&N()};typeof window<"u"?window.requestAnimationFrame(()=>{const g=W==="EXTERNAL_FEEDBACK"&&document.getElementById(Ed)||document.getElementById(wl);if(g){try{g.scrollIntoView({behavior:"smooth",block:"start"})}catch{}N&&N()}else setTimeout(d,0)}):d()},[W,N]);const wi=()=>{if(z||!kn||!De.description||!De.amount)return;const d={id:Date.now().toString(),date:De.date||"",description:De.description,amount:Number(De.amount),currency:De.currency||"NIS"},g=[...e.expensesItems,d],w=g.reduce((F,q)=>F+q.amount,0);t({expensesItems:g,expensesSum:w.toLocaleString()}),Pe({date:new Date().toISOString().split("T")[0],description:"",amount:0,currency:"NIS"})},ji=d=>{if(z)return;const g=e.expensesItems.filter(F=>F.id!==d),w=g.reduce((F,q)=>F+q.amount,0);t({expensesItems:g,expensesSum:w.toLocaleString()})},pa=async d=>{if(z)return;const g=d.target.files;if(!g)return;const w=e.invoiceFiles.length;if(w>=4){C({msg:"   4   (PDF  Word).",type:"info"}),d.target.value="";return}const F=Array.from(g).slice(0,4-w),q=[];for(let te=0;te<F.length;te++){const ye=F[te],Le=new FileReader;await new Promise(ce=>{Le.onload=Oe=>{var _e;q.push({id:`inv-${Date.now()}-${te}`,name:ye.name,data:((_e=Oe.target)==null?void 0:_e.result).split(",")[1],type:ye.type}),ce()},Le.readAsDataURL(ye)})}const re=[...e.invoiceFiles,...q],ge=re.length>0,Ce=kn&&e.status==="WAITING_FOR_INVOICES"&&ge?"TASK_ASSIGNED":e.status;t({invoiceFiles:re,isWaitingForInvoices:!ge,status:Ce}),C({msg:"   ( 4 ).",type:"success"})},is=d=>{const g=e.invoiceFiles.filter(re=>re.id!==d),w=g.length>0,q=kn&&!w&&e.status==="TASK_ASSIGNED"?"WAITING_FOR_INVOICES":e.status;t({invoiceFiles:g,isWaitingForInvoices:!w,status:q})},Vt=(d,g)=>{$e||t({content:{...e.content,[d]:g}})},Ei=d=>d.replace(/{plaintiff}/g,e.plaintiffName||"").replace(/{insured}/g,e.insuredName||"").replace(/\[DATE\]/g,new Date().toLocaleDateString("he-IL"));y.useEffect(()=>{let d=!1;return(async()=>{try{const w=await op();d||V(w)}catch(w){console.error("Failed to load templates",w)}try{const w=await G0();d||be(w)}catch(w){console.error("Failed to load best practices",w)}})(),()=>{d=!0}},[]);const To=(d,g)=>{mn&&t({translatedContent:{...e.translatedContent,[d]:g}})},wr=d=>ee.filter(g=>g.sectionKey===d&&g.isEnabled!==!1).sort((g,w)=>(g.orderIndex||0)-(w.orderIndex||0)||g.createdAt.localeCompare(w.createdAt)),Ro=(d,g)=>{if($e)return;let w=g.body.replace(/{plaintiff}/g,e.plaintiffName||"the claimant").replace(/{insured}/g,e.insuredName||"the insured").replace(/\[DATE\]/g,new Date().toLocaleDateString("he-IL"));const F=e.content[d]||"";Vt(d,F?`${F}

${w}`:w),ae(null)},Co=async d=>{try{const g=await op();V(g)}catch(g){console.error("Failed to refresh templates",g)}P(""),le(""),ae(g=>g===d?null:d)},ki=async d=>{if(a.role!=="ADMIN")return;const g=ve.current[d],w=g==null?void 0:g.current;if(!w){C({msg:"     .",type:"error"});return}const F=w.selectionStart??0,q=w.selectionEnd??0;if(F===q){C({msg:"     .",type:"info"});return}let ge=(e.content[d]||"").slice(F,q).trim();if(!ge){C({msg:"    .",type:"info"});return}if(ge.length<15&&!window.confirm("   .    ?"))return;const Te=ge.split(/\s+/).slice(0,6).join(" "),te=(window.prompt(" :",Te)||"").trim();if(!te){C({msg:"   ( ).",type:"info"});return}const ye=new Date().toISOString(),Le={id:"",sectionKey:d,title:te,body:ge,createdByUserId:a.id,createdAt:ye,updatedAt:ye,isEnabled:!0};try{const ce=await lp(Le,a.role);V(ce),C({msg:"  .",type:"success"})}catch(ce){console.error("Failed to save template",ce),C({msg:"  .",type:"error"})}},fa=async(d,g)=>{if(a.role!=="ADMIN")return;const w=ee.find(q=>q.id===d);if(!w)return;const F={...w,...g,updatedAt:new Date().toISOString()};try{const q=await lp(F,a.role);V(q)}catch(q){console.error("Failed to update template",q),C({msg:"  .",type:"error"})}},Ai=async d=>{if(a.role==="ADMIN")try{const g=await O0(d,a.role);V(g)}catch(g){console.error("Failed to delete template",g),C({msg:"  .",type:"error"})}},xa=async(d,g)=>{if(a.role==="ADMIN")try{const w=await M0(d,g,a.role);V(w)}catch(w){console.error("Failed to reorder template",w),C({msg:"   .",type:"error"})}},Ii=(d,g)=>{if(!d||!g||d===g)return"  ";const w=d.split(/\s+/).filter(Boolean),F=g.split(/\s+/).filter(Boolean);if(!w.length||!F.length)return"  ";const q=Math.max(w.length,F.length)||1;let re=0;const ge=Math.min(w.length,F.length);for(let Ce=0;Ce<ge;Ce+=1)w[Ce]!==F[Ce]&&(re+=1);re+=Math.abs(w.length-F.length);const Te=re/q;return Te<.05?"  ":Te<.15?" ":Te<.35?" ":" "},Do=async d=>{if($e)return;const g=e.content[d];if(g){Sn(d),R(!0);try{const w=await B0(g,Ve);if(w.factProtectionBlocked){C({msg:"    ( ).    .",type:"info"});return}const F=w.text,q=Ii(g,F),re=Gb(g,F),ge=re.filter(Te=>Te.type==="add"||Te.type==="remove").length;if(ge>0){const Te=Date.now()+2e4;ot({sectionKey:d,tokens:re,changedWords:ge,expiresAt:Te,open:!1}),setTimeout(()=>{ot(Ce=>Ce&&Ce.sectionKey===d&&Ce.expiresAt===Te?null:Ce)},2e4)}else ot(null);C({msg:`  (${Ve==="SAFE_POLISH"?"SAFE_POLISH":"REWRITE"}): ${q}`,type:"success"}),Vt(d,F)}catch(w){console.error("Refine text failed",w),C({msg:"  .   .",type:"error"})}finally{R(!1),Sn(null)}}},Ti=async(d,g,w)=>{var F;R(!0);try{const q=await W0(g,w);if((F=q.items)!=null&&F.length){const re=[...e.expensesItems,...q.items],ge=re.reduce((Te,Ce)=>Te+(Ce.amount||0),0);t({expensesItems:re,expensesSum:ge.toLocaleString()}),C({msg:`  "${d}"  .`,type:"success"})}else C({msg:"    .",type:"info"})}catch(q){console.error("Expenses extraction failed",q),C({msg:" .   PDF/Word .",type:"error"})}finally{R(!1)}},Ri=d=>new Promise((g,w)=>{const F=new FileReader;F.onload=()=>g(F.result.split(",")[1]),F.onerror=()=>w(new Error("Failed to read file")),F.readAsDataURL(d)}),Lo=d=>{var Ce,te,ye,Le,ce,Oe,_e,Xe;if(!d)return;const g=[...e.selectedSections],w=We=>{g.includes(We)||g.push(We)},F=We=>We&&We.length?We.map(Et=>` ${Et}`).join(`
`):"",q=(Ce=d.timeline)!=null&&Ce.length?d.timeline.map(We=>` ${(We==null?void 0:We.date)||"  "}  ${(We==null?void 0:We.event)||""}`).join(`
`):"",re={...e.content};if(d.briefSummary||q||(te=d.injuries)!=null&&te.length){w("Update");const We=F(d.injuries),Et=F(d.requestedRelief),Kt=[d.briefSummary||"",We?`
 :
${We}`:"",Et?`
 :
${Et}`:"",q?`
 :
${q}`:""].filter(Boolean);re.Update=Kt.join(`
`).trim()}if((ye=d.facts)!=null&&ye.length){const We=$s;w(We),re[We]=F(d.facts)}const ge=[];if((Le=d.allegations)!=null&&Le.length&&ge.push(` :
${F(d.allegations)}`),(ce=d.negligenceTheory)!=null&&ce.length&&ge.push(` :
${F(d.negligenceTheory)}`),(Oe=d.medicalFindings)!=null&&Oe.length&&ge.push(` :
${F(d.medicalFindings)}`),ge.length){const We=e.selectedSections.includes("Strategy & Recommendations")?"Strategy & Recommendations":"Strategy";w(We),re[We]=ge.join(`

`)}d.riskAssessment&&(w("Risk Assessment"),re["Risk Assessment"]=d.riskAssessment);const Te=[];(_e=d.recommendedActions)!=null&&_e.length&&Te.push(F(d.recommendedActions)),(Xe=d.requestedRelief)!=null&&Xe.length&&Te.push(` :
${F(d.requestedRelief)}`),Te.length&&(w("Recommendations"),re.Recommendations=Te.join(`

`)),t({content:re,selectedSections:g,complaintAnalysis:d}),C({msg:"     .",type:"success"})},Ci=(d,g)=>{var Is,ya,Na;if(!d)return"";const w=(g==null?void 0:g.analysisType)==="DEMAND"||(g==null?void 0:g.section)===Q?"DEMAND":"CLAIM",F=w==="DEMAND"?"":"",q=w==="DEMAND"?"   ":"  ",re=(ya=(Is=d.entities)==null?void 0:Is.plaintiff)==null?void 0:ya.trim(),ge=(d.defendants||[]).filter(Boolean).join(", "),Te=[];Te.push(re?`${F}, ${re}`:F),ge&&Te.push(`${q} ${ge}`);const Ce=`${Te.join(" ")}.`.replace(/\s+/g," ").trim(),te=(Qe,nr,An,ba=!1)=>{const Ts=nr.map(Yt=>(Yt||"").trim()).filter(Boolean);if(!Ts.length&&ba)return"";const kr=Ts.length?Ts:An?[An]:[];if(!kr.length)return"";const sr=kr.map((Yt,Ar)=>`${Ar+1}. ${Yt}`.trim()).join(`
`);return`${Qe}
${sr}`.trim()},ye=(d.timeline||[]).map(Qe=>{var Ar,Uu,Bo,Wu,zu,Vu;if(!(Qe!=null&&Qe.event)&&!(Qe!=null&&Qe.date))return"";const nr=((Qe==null?void 0:Qe.date)||"").toString().trim(),An=nr||" ",ba=((Qe==null?void 0:Qe.actor)||"").toString().trim()||(((Ar=d.entities)==null?void 0:Ar.plaintiff)||"").toString().trim()||F,Ts=((Qe==null?void 0:Qe.location)||"").toString().trim()||((Vu=(Wu=(Bo=(Uu=d.entities)==null?void 0:Uu.institution)==null?void 0:Bo.toString)==null?void 0:(zu=Wu.call(Bo)).trim)==null?void 0:Vu.call(zu))||"",kr=((Qe==null?void 0:Qe.event)||"").toString().trim(),sr=((Qe==null?void 0:Qe.result)||"").toString().trim(),Yt=[];return Yt.push(An),Yt.push(` ${ba}`),kr&&Yt.push(` ${kr}`),Ts&&Yt.push(` ${Ts}`),sr&&Yt.push(` ${sr}`),Yt.join(" ").replace(/\s+/g," ").trim()}).filter(Boolean)||[],Le=(d.facts||[]).filter(Boolean),ce=ye.length?ye:Le,_e=te(w==="DEMAND"?"  ,  :":"  ,  :",ce,"    ."),Xe=[];(Na=d.entities)!=null&&Na.plaintiff&&Xe.push(String(d.entities.plaintiff).trim()),Array.isArray(d.defendants)&&Xe.push(...d.defendants.map(String).map(Qe=>Qe.trim())),Array.isArray(d.providers)&&Xe.push(...d.providers.map(String).map(Qe=>Qe.trim()));const We=Array.from(new Set(Xe.filter(Boolean))),Et=We.length?`      : ${We.join(", ")}.`:"",nt=(Array.isArray(d.gaps)&&d.gaps||Array.isArray(d.missingDetails)&&d.missingDetails||[]).filter(Boolean).map(Qe=>String(Qe).trim()).filter(Boolean),gt=nt.length?nt:["   ,        ."],pn=te("  :",gt),Dt=(()=>{const Qe=(d.injuries||[]).find(An=>An&&String(An).trim())||(d.medicalFindings||[]).find(An=>An&&String(An).trim());return Qe?` ${w==="DEMAND"?"":""},         : ${String(Qe).trim()}.`:""})();return[Ce,_e,Et,pn,Dt].filter(Qe=>Qe&&String(Qe).trim()).join(`

`).trim()},Di=()=>{Vt("Strategy",bv),C({msg:' " "  .',type:"success"})},Li=(d,g)=>{var q;const w=(q=d.target.files)==null?void 0:q[0];if(!w)return;if(!g.includes("Expenses")){d.target.value="";return}const F=new FileReader;F.onload=async re=>{var Te;const ge=((Te=re.target)==null?void 0:Te.result).split(",")[1];await Ti(w.name,ge,w.type)},F.readAsDataURL(w),d.target.value=""},jr=d=>{Gn(null),Fn(d),setTimeout(()=>{var g;(g=Sr.current)==null||g.click()},0)},_i=async d=>{var F,q;const g=(F=d.target.files)==null?void 0:F[0];if(!g||!ct){Fn(null),d.target.value="";return}R(!0);const w=ct.section||ct.mode;tr(w);try{const re=await Ri(g),ge=ct.mode==="SECTION"&&ct.section||$s;if(ct.domain==="dental"&&ct.mode==="SECTION"){try{const Oe=(await U0(re,g.type||"application/octet-stream")).trim();if(!Oe)C({msg:"     .     .",type:"error"});else{const _e=Oe,Xe=ct.section||Y,We=e.content[Xe]||"",Et=We?`${We}

${_e}`:_e,Kt={content:{...e.content,[Xe]:Et},selectedSections:e.selectedSections.includes(Xe)?e.selectedSections:[...e.selectedSections,Xe]};if(ct.analysisType==="EXPERT"&&ct.section){const gt=!!We.trim()?"MULTIPLE":"SINGLE";Kt.expertSummaryMode={...e.expertSummaryMode||{},[Xe]:gt}}t(Kt),C({msg:"  ()    .",type:"success"})}}catch(Oe){console.error("Dental opinion analysis failed",Oe),C({msg:"  .    .",type:"error"})}finally{R(!1),tr(null),Fn(null),d.target.value=""}return}const Ce=ge===Y||ge===Q,te=up(ge),ye={expertCountMode:ct.analysisType==="EXPERT"?((q=e.expertSummaryMode)==null?void 0:q[ge])||"SINGLE":void 0,partyRole:J0(ge)||void 0};(Ce||te)&&(ye.sectionKey=ge,ye.plaintiffName=e.plaintiffName||"",ye.insuredName=e.insuredName||"",ye.insurerName=e.insurerName||"",ye.reportSubject=e.reportSubject||"");const Le=await H0(re,g.type||"application/octet-stream",ct.analysisType||"CLAIM",ye),ce=(Le==null?void 0:Le.analysis)||null;if(ct.mode==="SECTION"){const Oe=((Le==null?void 0:Le.claimSummary)||"").trim()||Ci(ce,{analysisType:ct.analysisType,section:ct.section});if(!Oe)C({msg:"      .",type:"error"});else{const _e=ct.section||Y,Xe=e.content[_e]||"",We=Xe?`${Xe}

${Oe}`:Oe,Et={content:{...e.content,[_e]:We},selectedSections:e.selectedSections.includes(_e)?e.selectedSections:[...e.selectedSections,_e]};if(ct.analysisType==="EXPERT"&&ct.section){const nt=!!Xe.trim()?"MULTIPLE":"SINGLE";Et.expertSummaryMode={...e.expertSummaryMode||{},[_e]:nt}}ce&&(Et.complaintAnalysis=ce),t(Et),C({msg:"     .",type:"success"})}}else ce?(Lo(ce),ct.mode==="POLICY"&&t({policyFile:{id:`policy-${Date.now()}`,name:g.name,data:re,type:g.type}})):C({msg:"   .   .",type:"error"})}catch(re){console.error(re),C({msg:" .    .",type:"error"})}finally{R(!1),tr(null),Fn(null),d.target.value=""}},Oi=()=>{const{policyPeriodStart:d,policyPeriodEnd:g,retroStart:w,retroEnd:F}=e;if(!d&&!g&&!w&&!F){C({msg:"    .  POLCY .",type:"info"});return}const q=Fh(e.content["Insurance Coverage"],d,g,w,F);Vt("Insurance Coverage",q),C({msg:"   .",type:"success"})},Mi=!!(e.policyPeriodStart||e.policyPeriodEnd||e.retroStart||e.retroEnd),Pi=async d=>{if(e.odakanitNo)try{const F=await Je.getLatestSheetForCase(e.odakanitNo);if(F&&F.lineItems&&F.lineItems.length>0){const q=Je.buildCumulativeExpensesSnapshot(F.sheet.id,new Date().toISOString());if(!q)return;const{effectiveSheet:re,allLines:ge,opts:Te}=q,{text:Ce}=Ah(re,ge,Te),{html:te}=ti(re,ge,Te);if(Vt(d,Ce),F.attachments&&F.attachments.length){const Le=e.invoiceFiles||[],ce=Math.max(0,4-Le.length);if(ce>0){const Oe=F.attachments.slice(0,ce).map((_e,Xe)=>{const[We,Et]=_e.fileKey.split(",");let Kt=_e.mimeType||"application/octet-stream";if(We&&We.startsWith("data:")){const gt=We.match(/^data:(.*?);base64$/);gt&&gt[1]&&(Kt=gt[1])}const nt=Et||_e.fileKey;return{id:`fes-inv-${_e.id}-${Xe}`,name:_e.originalFileName,data:nt,type:Kt}});if(Oe.length){const _e=[...Le,...Oe],Xe=_e.length>0,Et=kn&&e.status==="WAITING_FOR_INVOICES"&&Xe?"TASK_ASSIGNED":e.status;t({invoiceFiles:_e,isWaitingForInvoices:!Xe,status:Et,expensesSheetId:F.sheet.id,expensesSnapshotAt:F.sheet.updatedAt||new Date().toISOString(),expensesHtml:te||e.expensesHtml})}}}C({msg:"Expenses Table was inserted into the EXPENSES section.",type:"success"});return}}catch(F){Bu("Failed to load Expenses Table for report",F)}const g=e.expenseWorksheet;if(!g||!g.rows||g.rows.length===0){C({msg:"    .",type:"info"});return}if(g.status!=="LOCKED"){C({msg:'       ".',type:"info"});return}const w=O(g);Vt(d,w),C({msg:'   ".',type:"success"})},Fi=()=>{m&&(m(),C({msg:"    .",type:"success"}))},Bi=async()=>{if(!$e){Ue(!0);try{const d=await K0(e.content||{},a.role),g=d.issues||[];we(g);const w=d.runAt||new Date().toISOString();ze(w),t({toneRiskLastRunAt:w}),qe(d.meta||null),g.length?C({msg:"     .",type:"info"}):C({msg:"   Tone & Risk .",type:"success"})}catch(d){console.error("Tone & Risk check failed",d),C({msg:" Tone & Risk        .",type:"error"})}finally{Ue(!1)}}},_o=()=>{we([]),ze(null),qe(null),$(null)},Oo=(d,g)=>{if(!d||!g)return!1;const w=/(\d{1,2}\/\d{1,2}\/\d{2,4}|\d+(?:\.\d+)?%?)/g,F=[];let q;for(;(q=w.exec(d))!==null;)q[0]&&F.push(q[0]);return F.length?F.some(re=>!g.includes(re)):!1},ha=d=>{var q,re;if(!d.suggestion)return;const g=d.sectionKey,w=e.content[g]||"";if(!w||!d.excerpt||!w.includes(d.excerpt)){(q=navigator.clipboard)==null||q.writeText(d.suggestion).catch(()=>{}),C({msg:"    .   .",type:"info"});return}if(Oo(d.excerpt,d.suggestion)){(re=navigator.clipboard)==null||re.writeText(d.suggestion).catch(()=>{}),C({msg:"    /      .",type:"info"});return}$({sectionKey:g,prevText:w});const F=w.replace(d.excerpt,d.suggestion);Vt(g,F)},$i=()=>{if(!j)return;const{sectionKey:d,prevText:g}=j;Vt(d,g),$(null),C({msg:"  .",type:"info"})},Mo=async()=>{if(!$e){he(!0);try{const d=await Y0(e.content||{},a.role),g=d.issues||[];pe(g),Be(d.runAt||new Date().toISOString()),g.length?C({msg:"       .",type:"info"}):C({msg:"     .",type:"success"})}catch(d){console.error("Hebrew style review failed",d),C({msg:"  .    .",type:"error"})}finally{he(!1)}}},Po=(d,g)=>{if($e||z)return;const w=Ei(g.body),F=e.content[d]||"";Vt(d,F?`${F}

${w}`:w),ae(null);const q=rv(a.id,g.id);lt(q)},Hi=async d=>{try{await navigator.clipboard.writeText(d.body),C({msg:"  .",type:"info"})}catch{C({msg:"     ",type:"warning"})}},Ui=d=>{var ge;if(!d.suggestion)return;const g=d.sectionKey,w=e.content[g]||"",F=d.excerpt;if(!(F&&w.includes(F))){(ge=navigator.clipboard)==null||ge.writeText(d.suggestion).catch(()=>{}),C({msg:"    .   .",type:"info"});return}const re=w.replace(F,d.suggestion);Vt(g,re)},Wi=d=>Z.filter(g=>g.sectionKey===d&&g.isEnabled!==!1).sort((g,w)=>{const F=g.label==="LLOYDS_RECOMMENDED"?0:1,q=w.label==="LLOYDS_RECOMMENDED"?0:1;if(F!==q)return F-q;const re=g.usageCount||0;return(w.usageCount||0)-re}),zi=d=>{if(a.role!=="ADMIN")return;const g=ve.current[d],w=g==null?void 0:g.current;if(!w){C({msg:"     .",type:"error"});return}const F=w.selectionStart??0,q=w.selectionEnd??0;if(F===q){C({msg:"     -Best Practice.",type:"info"});return}const ge=(e.content[d]||"").slice(F,q).trim();if(!ge){C({msg:"    .",type:"info"});return}Ye({sectionKey:d,body:ge})},Er=async({title:d,label:g,tags:w,behavior:F})=>{if(!Me)return;const q=new Date().toISOString(),re={id:"",sectionKey:Me.sectionKey,title:d,body:Me.body,label:g,tags:w.length?w:void 0,isEnabled:!0,createdByUserId:a.id,createdAt:q,updatedAt:q,usageCount:0,lastUsedAt:null,behavior:F};try{const ge=await cp(re,a.role);be(ge),C({msg:"Best Practice  .",type:"success"})}catch(ge){console.error("Failed to save best practice",ge),C({msg:" -Best Practice .",type:"error"})}Ye(null)},ga=()=>{Ye(null)},Fo=async(d,g)=>{if($e)return;const w=e.content[d]||"",F=w?`${w}

${g.body}`:g.body;Vt(d,F);try{const q=await dp(g.id,"INSERT",a.role);be(q)}catch(q){console.error("Failed to record best practice usage (insert)",q)}},u=async d=>{var g;(g=navigator.clipboard)==null||g.writeText(d.body).catch(()=>{});try{const w=await dp(d.id,"COPY",a.role);be(w)}catch(w){console.error("Failed to record best practice usage (copy)",w)}C({msg:"  .",type:"info"})},f=async(d,g)=>{const w=Z.find(q=>q.id===d);if(!w)return;const F={...w,...g,updatedAt:new Date().toISOString()};try{const q=await cp(F,a.role);be(q)}catch(q){console.error("Failed to update best practice",q),C({msg:" -Best Practice .",type:"error"})}},S=async d=>{try{const g=await q0(d,a.role);be(g)}catch(g){console.error("Failed to delete best practice",g),C({msg:" -Best Practice .",type:"error"})}},L=async(d,g)=>{try{const w=await X0(d,g,a.role);be(w)}catch(w){console.error("Failed to toggle best practice enabled",w),C({msg:"  -Best Practice .",type:"error"})}},O=d=>{const g=d.rows.filter(re=>re.type==="EXPENSE"),w=d.rows.filter(re=>re.type==="ADJUSTMENT"),F=g.map(re=>` ${re.label}${re.serviceProvider?` (${re.serviceProvider})`:""}  ${re.amount.toLocaleString()}`),q=w.map(re=>` ${re.label}  ${re.amount.toLocaleString()}`);return["     ","",":",F.length?F.join(`
`):"   ",""," / :",q.length?q.join(`
`):"  ","",`" : ${d.totals.totalExpenses.toLocaleString()}`,`" : ${d.totals.totalAdjustments.toLocaleString()}`,` : ${d.totals.totalBalance.toLocaleString()}`].join(`
`)};return n.jsxs(n.Fragment,{children:[n.jsx("input",{type:"file",ref:Sr,className:"hidden",accept:".pdf,.doc,.docx,.txt,.jpg,.jpeg,.png,application/pdf,application/msword,application/vnd.openxmlformats-officedocument.wordprocessingml.document,text/plain,image/*",onChange:_i}),n.jsxs("div",{className:"space-y-6",children:[n.jsxs("div",{className:"flex flex-wrap justify-between items-center gap-2",children:[n.jsxs("button",{onClick:s,className:"flex items-center text-sm text-textMuted bg-navySecondary px-3 py-1.5 rounded-full hover:bg-borderDark",children:[n.jsx(ql,{className:"w-4 h-4 mr-1"}),"   1"]}),n.jsxs("div",{className:"flex items-center gap-3",children:[a.role==="ADMIN"&&(i||c)&&n.jsxs("div",{className:"flex flex-col items-end gap-1",children:[i&&n.jsx("button",{onClick:i,disabled:!ma||x,className:`flex items-center text-sm px-3 py-1.5 rounded-full transition ${ma&&!x?"text-indigo-700 bg-indigo-50 hover:bg-indigo-100":"text-slate-400 bg-slate-100 cursor-not-allowed"}`,children:x?n.jsxs(n.Fragment,{children:[n.jsx(Mt,{className:"w-4 h-4 mr-1 animate-spin"})," ..."]}):n.jsxs(n.Fragment,{children:[n.jsx(j0,{className:"w-4 h-4 mr-1"})," Auto-Translate"]})}),c&&n.jsx("button",{onClick:c,disabled:!e.isTranslated||!Io||!!b,className:`flex items-center text-sm px-3 py-1.5 rounded-full transition ${e.isTranslated&&Io&&!b?"text-emerald-700 bg-emerald-50 hover:bg-emerald-100":"text-slate-400 bg-slate-100 cursor-not-allowed"}`,children:b?n.jsxs(n.Fragment,{children:[n.jsx(Mt,{className:"w-4 h-4 mr-1 animate-spin"})," Improving..."]}):n.jsx(n.Fragment,{children:"Improve English"})}),i&&!ma&&!x&&n.jsx("p",{className:"text-[11px] text-textMuted",children:"      ."}),e.translationStale&&n.jsx("p",{className:"text-[11px] text-amber-700 max-w-xs text-right",children:" :      ,      ."}),x&&n.jsx("p",{className:"text-[11px] text-indigo-600",children:"      ."})]}),a.role==="ADMIN"&&mn&&n.jsxs("div",{className:"flex flex-col items-end gap-1 text-[11px] text-textLight",children:[n.jsx("span",{className:"font-semibold",children:"  "}),n.jsxs("div",{className:"inline-flex rounded-full border border-borderDark overflow-hidden bg-panel",children:[n.jsx("button",{type:"button",onClick:()=>ls("DUAL"),className:`px-3 py-1 ${un==="DUAL"?"bg-slate-800 text-white":"bg-panel text-textLight hover:bg-slate-100"} text-[11px]`,children:" + "}),n.jsx("button",{type:"button",onClick:()=>ls("ENGLISH_ONLY"),className:`px-3 py-1 border-r border-borderDark ${un==="ENGLISH_ONLY"?"bg-slate-800 text-white":"bg-panel text-textLight hover:bg-slate-100"} text-[11px]`,children:" "})]})]}),a.role==="ADMIN"&&m&&n.jsxs("button",{onClick:Fi,className:"flex items-center text-sm text-purple-700 bg-purple-50 px-3 py-1.5 rounded-full hover:bg-purple-100",children:[n.jsx(ku,{className:"w-4 h-4 mr-1"})," Format Text"]}),n.jsxs("button",{onClick:o,className:"flex items-center text-sm text-lpBlue bg-blue-50 px-3 py-1.5 rounded-full hover:bg-blue-100",children:[n.jsx(Eu,{className:"w-4 h-4 mr-1"}),"  "]})]})]}),E&&n.jsxs("div",{className:"flex items-center justify-end gap-2 text-[11px] text-indigo-600",children:[n.jsx(Mt,{className:"w-3 h-3 animate-spin"}),n.jsx("span",{children:"   ,     "})]}),k&&n.jsx(iv,{message:k.msg,type:k.type,onClose:()=>C(null)}),n.jsxs("div",{className:"flex items-center justify-between gap-2",children:[n.jsx("h2",{className:"text-2xl font-bold text-lpBlue font-serif",children:"2. Draft Content"}),!$e&&B&&n.jsxs("button",{type:"button",onClick:()=>B(),className:"flex items-center text-[11px] px-3 py-1.5 rounded-full bg-indigo-50 text-indigo-800 border border-indigo-200 hover:bg-indigo-100",title:"         (  ).",children:[n.jsx(sa,{className:"w-3 h-3 ml-1"})," "]})]}),!$e&&n.jsxs("div",{className:"mb-3 mt-1 space-y-1",children:[n.jsxs("div",{className:"flex items-center justify-between gap-2",children:[n.jsx("div",{className:"flex items-center gap-2",children:n.jsx("span",{className:"text-[11px] font-semibold text-textMuted",children:"  "})}),Ze&&n.jsxs("div",{className:"text-[11px] text-textMuted",children:[" Tone & Risk :"," ",new Date(Ze).toLocaleString("he-IL",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"})]})]}),n.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[n.jsx("button",{type:"button",onClick:Mo,disabled:me,title:"        .        .",className:`flex items-center text-xs px-3 py-1.5 rounded-full border ${me?"bg-slate-100 text-slate-400 border-borderDark cursor-not-allowed":"bg-panel text-blue-800 border-blue-200 hover:bg-blue-50"}`,children:me?n.jsxs(n.Fragment,{children:[n.jsx(Mt,{className:"w-3 h-3 mr-1 animate-spin"}),"   ..."]}):n.jsx(n.Fragment,{children:"  ( )"})}),J.length>0&&n.jsxs("button",{type:"button",onClick:()=>{const d=document.getElementById("hebrew-style-panel");d&&d.scrollIntoView({behavior:"smooth",block:"start"})},className:"inline-flex items-center text-[11px] px-2 py-0.5 rounded-full bg-blue-50 text-blue-800 border border-blue-200 hover:bg-blue-100",children:[" ",J.length>1&&` (${J.length})`]}),n.jsx("button",{type:"button",onClick:Bi,disabled:He,title:"         .        .",className:`flex items-center text-xs px-3 py-1.5 rounded-full border ${He?"bg-slate-100 text-slate-400 border-borderDark cursor-not-allowed":"bg-panel text-amber-800 border-amber-200 hover:bg-amber-50"}`,children:He?n.jsxs(n.Fragment,{children:[n.jsx(Mt,{className:"w-3 h-3 mr-1 animate-spin"}),"  Tone & Risk..."]}):n.jsx(n.Fragment,{children:" Tone & Risk ()"})}),ue.length>0&&n.jsx("button",{type:"button",onClick:_o,className:"text-[11px] text-textMuted hover:text-textLight underline",children:"  Tone & Risk"})]}),n.jsxs("div",{className:"flex flex-wrap items-center gap-4 text-[11px] text-textMuted",children:[je&&!J.length&&!me&&n.jsx("span",{children:"  ."}),Ze&&!ue.length&&!He&&n.jsx("span",{children:"  Tone & Risk."})]})]}),!$e&&ue.length>0&&n.jsxs("div",{id:"tone-risk-panel",className:"mb-4 border border-amber-200 bg-amber-50 rounded-md p-3 text-xs space-y-2",children:[n.jsxs("div",{className:"flex items-center justify-between gap-2 mb-1",children:[n.jsxs("div",{className:"font-semibold text-amber-900",children:[" ",ue.length,"  Tone & Risk"]}),j&&n.jsx("button",{type:"button",onClick:$i,className:"text-[11px] text-textMuted hover:text-textLight underline",children:"  "})]}),rt&&n.jsxs("div",{className:"text-[11px] text-textMuted",children:[" ",rt.sectionsSent,"  |  : ",rt.charsBefore," |  : ",rt.charsAfter,rt.truncatedSections>0&&n.jsxs("span",{className:"ml-2 text-amber-700",children:["      (",rt.truncatedSections,")"]})]}),n.jsx("div",{className:"space-y-2 max-h-60 overflow-y-auto",children:ue.map(d=>n.jsxs("div",{className:"bg-panel border border-amber-200 rounded px-2 py-2 space-y-1",children:[n.jsx("div",{className:"flex items-center justify-between gap-2",children:n.jsxs("div",{className:"flex items-center gap-1",children:[n.jsx("span",{className:"inline-flex items-center rounded-full px-2 py-0.5 text-[10px] font-semibold bg-slate-100 text-textLight",children:d.sectionKey||"Unknown section"}),n.jsx("span",{className:`inline-flex items-center rounded-full px-2 py-0.5 text-[10px] font-semibold ${d.severity==="CRITICAL"?"bg-red-100 text-red-700":d.severity==="WARNING"?"bg-amber-100 text-amber-700":"bg-slate-100 text-textMuted"}`,children:d.severity}),n.jsx("span",{className:"inline-flex items-center rounded-full px-2 py-0.5 text-[10px] bg-indigo-50 text-indigo-700 font-mono",children:d.kind})]})}),n.jsxs("div",{className:"text-[11px] text-textLight",children:[n.jsx("span",{className:"font-semibold",children:":"})," ",n.jsxs("span",{className:"italic",children:['"',d.excerpt,'"']})]}),n.jsxs("div",{className:"text-[11px] text-textLight",children:[n.jsx("span",{className:"font-semibold",children:":"})," ",d.message]}),d.suggestion&&n.jsxs("div",{className:"text-[11px] text-textLight",children:[n.jsx("span",{className:"font-semibold",children:" :"})," ",n.jsx("span",{className:"whitespace-pre-wrap",children:d.suggestion})]}),n.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[d.suggestion&&n.jsxs(n.Fragment,{children:[n.jsx("button",{type:"button",onClick:()=>{var g;return(g=navigator.clipboard)==null?void 0:g.writeText(d.suggestion||"").catch(()=>{})},className:"px-2 py-0.5 rounded border border-borderDark text-[11px] text-textLight hover:bg-slate-100",children:"  "}),n.jsx("button",{type:"button",onClick:()=>ha(d),className:"px-2 py-0.5 rounded border border-emerald-300 text-[11px] text-emerald-700 hover:bg-emerald-50",children:" "})]}),n.jsx("button",{type:"button",onClick:()=>pe(g=>g.filter(w=>w.id!==d.id)),className:"px-2 py-0.5 rounded border border-borderDark text-[11px] text-textMuted hover:bg-slate-100 ml-auto",children:""})]})]},d.id))})]}),!$e&&J.length>0&&n.jsxs("div",{id:"hebrew-style-panel",className:"mb-4 border border-blue-200 bg-blue-50 rounded-md p-3 text-xs space-y-2",children:[n.jsxs("div",{className:"flex items-center justify-between gap-2 mb-1",children:[n.jsxs("div",{className:"font-semibold text-blue-900",children:[" ",J.length,"   "]}),je&&n.jsxs("div",{className:"text-[11px] text-textMuted",children:[" :"," ",new Date(je).toLocaleString("he-IL",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"})]})]}),n.jsx("div",{className:"space-y-2 max-h-60 overflow-y-auto",children:J.map(d=>{const g=e.content[d.sectionKey]||"",w=!!d.suggestion&&!!d.excerpt&&g.includes(d.excerpt);return n.jsxs("div",{className:"bg-panel border border-blue-200 rounded px-2 py-2 space-y-1",children:[n.jsx("div",{className:"flex items-center justify-between gap-2",children:n.jsxs("div",{className:"flex items-center gap-1",children:[n.jsx("span",{className:"inline-flex items-center rounded-full px-2 py-0.5 text-[10px] font-semibold bg-slate-100 text-textLight",children:d.sectionKey||"Unknown section"}),n.jsx("span",{className:`inline-flex items-center rounded-full px-2 py-0.5 text-[10px] font-semibold ${d.severity==="CRITICAL"?"bg-red-100 text-red-700":d.severity==="WARNING"?"bg-amber-100 text-amber-700":"bg-slate-100 text-textMuted"}`,children:d.severity}),n.jsx("span",{className:"inline-flex items-center rounded-full px-2 py-0.5 text-[10px] bg-blue-50 text-blue-700 font-mono",children:d.category})]})}),n.jsxs("div",{className:"text-[11px] text-textLight",children:[n.jsx("span",{className:"font-semibold",children:":"})," ",n.jsxs("span",{className:"italic",children:['"',d.excerpt,'"']})]}),n.jsxs("div",{className:"text-[11px] text-textLight",children:[n.jsx("span",{className:"font-semibold",children:":"})," ",d.message]}),d.suggestion&&n.jsxs("div",{className:"text-[11px] text-textLight",children:[n.jsx("span",{className:"font-semibold",children:" :"})," ",n.jsx("span",{className:"whitespace-pre-wrap",children:d.suggestion})]}),d.suggestion&&n.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[n.jsx("button",{type:"button",onClick:()=>{var F;return(F=navigator.clipboard)==null?void 0:F.writeText(d.suggestion||"").catch(()=>{})},className:"px-2 py-0.5 rounded border border-borderDark text-[11px] text-textLight hover:bg-slate-100",children:" "}),w&&n.jsx("button",{type:"button",onClick:()=>Ui(d),className:"px-2 py-0.5 rounded border border-emerald-300 text-[11px] text-emerald-700 hover:bg-emerald-50",children:" "})]})]},d.id)})})]}),$e&&n.jsxs("div",{className:"bg-orange-100 border-l-4 border-orange-500 p-4 text-orange-800",children:[n.jsxs("p",{className:"font-bold flex items-center",children:[n.jsx(T0,{className:"w-5 h-5 mr-2"})," Restricted Access Mode"]}),n.jsxs("p",{className:"text-sm",children:["You are logged in as ",a.role,". You can only modify the Invoice Attachments in the Expenses section."]})]}),e.financeInstructions&&n.jsx("div",{className:"bg-red-50 border-l-4 border-red-600 p-4 shadow-md rounded-r-lg animate-pulse-slow",children:n.jsxs("div",{className:"flex items-start",children:[n.jsx("div",{className:"flex-shrink-0",children:n.jsx(Va,{className:"h-5 w-5 text-red-600"})}),n.jsxs("div",{className:"ml-3 w-full",children:[n.jsx("h3",{className:"text-sm font-bold text-red-800",children:"Instruction from Finance"}),n.jsx("div",{className:"mt-2 text-sm text-red-700 whitespace-pre-wrap",children:e.financeInstructions}),e.expensesSourceFile&&n.jsxs("div",{className:"mt-4 pt-2 border-t border-red-200",children:[n.jsx("p",{className:"text-xs font-bold text-red-800 mb-1",children:"Attached Expenses Source File (Word/Excel):"}),n.jsxs("div",{className:"flex items-center bg-panel p-2 rounded border border-red-200 max-w-md",children:[n.jsx(po,{className:"w-4 h-4 text-blue-600 mr-2"}),n.jsx("span",{className:"text-sm text-textLight flex-1",children:e.expensesSourceFile.name}),n.jsx("a",{href:`data:${e.expensesSourceFile.type};base64,${e.expensesSourceFile.data}`,download:e.expensesSourceFile.name,className:"text-xs bg-blue-100 text-blue-700 px-2 py-1 rounded hover:bg-blue-200 font-bold",children:"Download"})]})]})]})]})}),En&&n.jsxs("div",{className:"bg-amber-50 border-l-4 border-amber-500 p-4 shadow rounded-r-lg flex gap-3 items-start",children:[n.jsx(Va,{className:"w-5 h-5 text-amber-600 mt-1"}),n.jsxs("div",{children:[n.jsx("p",{className:"font-bold text-amber-900",children:"    "}),n.jsx("p",{className:"text-sm text-amber-800",children:"  /   .              ."})]})]}),n.jsx(tN,{report:e,currentUser:a,onSubmitToAdmin:()=>p&&p(),onApproveHebrew:()=>h&&h(),onRequestChanges:d=>v&&v(d),onMarkIssueDone:d=>A&&A(d),onAddExternalFeedbackIssues:(d,g)=>D&&D(d,g),onReopenHebrewDueToExternalFeedback:()=>I&&I()}),n.jsx("div",{className:"space-y-8",children:e.selectedSections.map(d=>{var re,ge,Te,Ce;const g=jd(d,(re=e.expertSummaryMode)==null?void 0:re[d]),w=/expert/i.test(g),F=ue.filter(te=>te.sectionKey===d).length,q=J.filter(te=>te.sectionKey===d).length;return n.jsxs("div",{className:`bg-panel p-6 rounded-lg shadow-sm border transition-all ${$e&&!d.includes("Expenses")?"opacity-60 pointer-events-none border-gray-100":"border-borderDark"}`,onClick:te=>{if(!H||typeof d!="string"||!d.trim())return;const ye=te.target;!ye||ye.closest('button, a, input, textarea, select, svg, [role="button"]')||H(d)},children:[n.jsxs("div",{className:"flex justify-between items-center mb-3 pb-2 border-b border-gray-100",children:[n.jsxs("div",{className:"flex flex-col gap-1",children:[n.jsx("h3",{className:"font-bold text-lg text-lpBlue uppercase tracking-wide",children:g}),d.includes("Expenses")&&e.expensesSnapshotAt&&n.jsxs("p",{className:"text-[11px] text-textMuted",children:["Based on the latest Expenses Table as of"," ",new Date(e.expensesSnapshotAt).toLocaleString("en-GB",{day:"2-digit",month:"short",year:"numeric",hour:"2-digit",minute:"2-digit"}),"."]}),!d.includes("Expenses")&&(q>0||F>0)&&n.jsxs("div",{className:"flex flex-wrap gap-1 text-[10px]",children:[q>0&&n.jsxs("button",{type:"button",onClick:()=>{const te=document.getElementById("hebrew-style-panel");te&&te.scrollIntoView({behavior:"smooth",block:"start"})},className:"inline-flex items-center rounded-full px-2 py-0.5 bg-blue-50 text-blue-800 border border-blue-200 hover:bg-blue-100",children:[" ",q>1&&` (${q})`]}),F>0&&n.jsxs("button",{type:"button",onClick:()=>{const te=document.getElementById("tone-risk-panel");te&&te.scrollIntoView({behavior:"smooth",block:"start"})},className:"inline-flex items-center rounded-full px-2 py-0.5 bg-amber-50 text-amber-800 border border-amber-200 hover:bg-amber-100",children:[" Tone & Risk",F>1&&` (${F})`]})]})]}),!$e&&n.jsxs("div",{className:"flex items-center gap-2",children:[!d.includes("Expenses")&&n.jsx("button",{className:"p-1.5 hover:bg-navySecondary rounded text-textMuted",disabled:E,onClick:()=>{jr({mode:"SECTION",section:d,analysisType:Si(d)})},title:"   ",children:er===d?n.jsx(Mt,{className:"w-4 h-4 animate-spin"}):n.jsx(A0,{className:"w-4 h-4"})}),w&&n.jsx("button",{className:"p-1.5 hover:bg-navySecondary rounded text-textMuted",disabled:E,onClick:()=>{jr({mode:"SECTION",section:d,analysisType:"EXPERT",domain:"dental"})},title:"     ",children:er===d&&(ct==null?void 0:ct.domain)==="dental"?n.jsx(Mt,{className:"w-4 h-4 animate-spin"}):n.jsx("span",{className:"text-lg leading-none",children:""})}),d.includes("Expenses")&&As&&n.jsx("button",{onClick:()=>Pi(d),className:"p-1.5 hover:bg-green-50 rounded text-textMuted hover:text-green-600",title:"   ",children:n.jsx(ah,{className:"w-4 h-4"})}),!d.includes("Expenses")&&n.jsxs(n.Fragment,{children:[d==="Strategy"&&!$e&&n.jsx("button",{onClick:Di,className:"px-3 py-1 text-xs font-semibold text-blue-700 bg-blue-50 border border-blue-200 rounded-full hover:bg-blue-100",children:" "}),n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsxs("button",{onClick:()=>Do(d),className:"inline-flex items-center px-3 py-1.5 rounded-full text-xs font-semibold text-white bg-purple-600 hover:bg-purple-700 transition",title:"      ,     .     .",children:[ks===d?n.jsx(Mt,{className:"w-4 h-4 mr-1 animate-spin"}):n.jsx(R0,{className:"w-4 h-4 mr-1"}),"  "]}),n.jsxs("div",{className:"flex rounded-full border border-purple-200 overflow-hidden text-[10px] bg-panel",title:"    ",children:[n.jsx("button",{type:"button",onClick:()=>tt("SAFE_POLISH"),className:`px-2 py-0.5 ${Ve==="SAFE_POLISH"?"bg-purple-100 text-purple-800":"text-purple-500 hover:bg-purple-50"}`,children:" "}),n.jsx("button",{type:"button",onClick:()=>tt("REWRITE"),className:`px-2 py-0.5 border-l border-purple-100 ${Ve==="REWRITE"?"bg-purple-100 text-purple-800":"text-purple-500 hover:bg-purple-50"}`,children:" "})]})]}),d==="Insurance Coverage"&&Mi&&n.jsx("button",{onClick:Oi,className:"p-1.5 hover:bg-blue-50 rounded text-textMuted hover:text-blue-600",title:"Auto-fill policy data",children:n.jsx(_0,{className:"w-4 h-4"})})]}),Ke&&Ke.sectionKey===d&&Ke.changedWords>0&&Ke.expiresAt>Date.now()&&n.jsxs("div",{className:"mt-1 text-[11px] text-textMuted bg-purple-50/40 border border-purple-100 rounded px-2 py-1",children:[n.jsxs("div",{className:"flex items-center justify-between gap-2",children:[n.jsxs("span",{children:["  ",Ke.changedWords,"   ."]}),n.jsx("button",{type:"button",className:"underline text-purple-700 hover:text-purple-900",onClick:()=>ot(te=>te&&te.sectionKey===d?{...te,open:!te.open}:te),children:Ke.open?" ":" "})]}),Ke.open&&n.jsx("div",{className:"mt-1 text-[11px] text-textLight whitespace-pre-wrap leading-relaxed",children:Ke.tokens.map((te,ye)=>te.type==="same"?` ${te.text}`:te.type==="add"?` [+${te.text}+]`:` [-${te.text}-]`)})]}),wr(d).length>0&&n.jsxs("button",{onClick:()=>Co(d),className:"flex items-center gap-1 px-2 py-1 rounded text-xs font-bold bg-navySecondary text-textMuted border hover:bg-yellow-50",children:[n.jsx(sa,{className:"w-3 h-3"})," Ideas"]}),a.role==="ADMIN"&&n.jsxs("div",{className:"flex items-center gap-1",children:[n.jsx("button",{type:"button",onClick:()=>ki(d),className:"px-2 py-1 rounded text-[11px] border border-dashed border-borderDark text-textMuted hover:bg-slate-50",children:"Save selection as template"}),n.jsx("button",{type:"button",onClick:()=>zi(d),className:"px-2 py-1 rounded text-[11px] border border-dashed border-emerald-300 text-emerald-700 hover:bg-emerald-50",children:"Save selection as Best Practice"})]})]})]}),d==="Update"&&Zt(e)&&n.jsxs("div",{className:"mb-3 text-xs text-textLight",children:[n.jsx("span",{className:"block mb-1 font-semibold",children:"    ()"}),n.jsxs("div",{className:"flex flex-wrap gap-2",children:[n.jsx("button",{type:"button",className:"px-3 py-1 rounded-full border border-borderDark bg-navySecondary hover:bg-navySecondary text-[11px] font-semibold text-textLight",onClick:()=>{const te=Dp.SOC,ye=e.content.Update||"",Le=te.split(`
`)[0];if(ye.trimStart().startsWith(Le))return;const Oe=ye.trim().length>0?`${te}

${ye.trimStart()}`:te;Vt("Update",Oe)},children:"  (Statement of Claim)"}),n.jsx("button",{type:"button",className:"px-3 py-1 rounded-full border border-borderDark bg-navySecondary hover:bg-navySecondary text-[11px] font-semibold text-textLight",onClick:()=>{const te=Dp.LOD,ye=e.content.Update||"",Le=te.split(`
`)[0];if(ye.trimStart().startsWith(Le))return;const Oe=ye.trim().length>0?`${te}

${ye.trimStart()}`:te;Vt("Update",Oe)},children:"  (Letter of Demand)"})]})]}),G===d&&!$e&&n.jsxs("div",{className:"mb-4 p-3 bg-yellow-50 rounded border border-yellow-200",children:[n.jsxs("div",{className:"flex items-center justify-between gap-2 mb-2",children:[n.jsxs("div",{className:"flex items-center gap-2 text-[11px]",children:[n.jsx("button",{type:"button",className:`px-2 py-1 rounded-full border ${M==="TEMPLATES"?"bg-panel border-yellow-400 text-yellow-800 font-semibold":"bg-yellow-100/60 border-yellow-200 text-yellow-700"}`,onClick:()=>K("TEMPLATES"),children:"Templates"}),n.jsx("button",{type:"button",className:`px-2 py-1 rounded-full border ${M==="BEST_PRACTICES"?"bg-panel border-emerald-400 text-emerald-800 font-semibold":"bg-emerald-50/70 border-emerald-200 text-emerald-700"}`,onClick:()=>K("BEST_PRACTICES"),children:"Best Practices"}),n.jsx("button",{type:"button",className:`px-2 py-1 rounded-full border ${M==="MY_SNIPPETS"?"bg-panel border-sky-400 text-sky-800 font-semibold":"bg-sky-50/70 border-sky-200 text-sky-700"}`,onClick:()=>K("MY_SNIPPETS"),children:" "})]}),M==="TEMPLATES"&&n.jsx("input",{type:"text",className:"flex-1 border border-yellow-300 rounded px-2 py-1 text-xs",placeholder:"Search templates",value:_,onChange:te=>P(te.target.value)}),M==="BEST_PRACTICES"&&n.jsx("input",{type:"text",className:"flex-1 border border-emerald-300 rounded px-2 py-1 text-xs",placeholder:"Search best practices",value:oe,onChange:te=>le(te.target.value)}),M==="MY_SNIPPETS"&&n.jsx("input",{type:"text",className:"flex-1 border border-sky-300 rounded px-2 py-1 text-xs",placeholder:"  ",value:Ne,onChange:te=>Ct(te.target.value)}),a.role==="ADMIN"&&M==="TEMPLATES"&&n.jsx("button",{type:"button",onClick:()=>{se(d),ie(!0)},className:"text-[11px] px-2 py-1 rounded bg-panel text-textLight border border-borderDark hover:bg-slate-50",children:"Manage templates"}),a.role==="ADMIN"&&M==="BEST_PRACTICES"&&n.jsx("button",{type:"button",onClick:()=>{Ee(d),xe(!0)},className:"text-[11px] px-2 py-1 rounded bg-panel text-textLight border border-borderDark hover:bg-slate-50",children:"Manage best practices"}),M==="MY_SNIPPETS"&&n.jsx("button",{type:"button",onClick:()=>{os(!0),It(null)},className:"text-[11px] px-2 py-1 rounded bg-panel text-textLight border border-borderDark hover:bg-slate-50",children:" "})]}),n.jsx("div",{className:"grid grid-cols-1 gap-2 max-h-60 overflow-y-auto text-xs",children:M==="TEMPLATES"?(()=>{const te=wr(d),ye=_.trim().toLowerCase(),Le=ye?te.filter(ce=>ce.title.toLowerCase().includes(ye)||ce.body.toLowerCase().includes(ye)):te;return Le.length?Le.map(ce=>{const Oe=ce.body.length>160?`${ce.body.slice(0,160)}`:ce.body;return n.jsxs("div",{className:"flex items-center gap-2 bg-panel border border-yellow-100 rounded px-2 py-2 hover:bg-yellow-100 cursor-pointer",onClick:()=>Ro(d,ce),children:[n.jsxs("div",{className:"flex-1 min-w-0 text-right",children:[n.jsx("div",{className:"font-semibold text-textLight truncate",children:ce.title}),n.jsx("div",{className:"text-[11px] text-textMuted max-h-10 overflow-hidden whitespace-pre-wrap",children:Oe})]}),n.jsx("button",{type:"button",className:"text-[11px] px-2 py-1 rounded bg-yellow-50 text-yellow-800 border border-yellow-200 hover:bg-yellow-100",children:"Insert"})]},ce.id)}):n.jsx("p",{className:"text-[11px] text-textMuted",children:"No templates found for this section."})})():M==="BEST_PRACTICES"?(()=>{const te=Wi(d),ye=oe.trim().toLowerCase(),Le=ye?te.filter(ce=>{const Oe=(ce.tags||[]).join(" ").toLowerCase();return ce.title.toLowerCase().includes(ye)||ce.body.toLowerCase().includes(ye)||Oe.includes(ye)}):te;return Le.length?Le.map(ce=>{const Oe=ce.body.length>160?`${ce.body.slice(0,160)}`:ce.body,_e=ce.behavior!=="COPY_ONLY";return n.jsxs("div",{className:"flex items-center gap-2 bg-panel border border-emerald-100 rounded px-2 py-2 hover:bg-emerald-50 cursor-default",children:[n.jsxs("div",{className:"flex-1 min-w-0 text-right",children:[n.jsxs("div",{className:"flex flex-wrap items-center justify-end gap-1 mb-0.5",children:[n.jsx("span",{className:"font-semibold text-textLight truncate",children:ce.title}),n.jsx("span",{className:`inline-flex items-center rounded-full px-2 py-0.5 text-[9px] font-semibold ${ce.label==="LLOYDS_RECOMMENDED"?"bg-purple-100 text-purple-700":"bg-emerald-100 text-emerald-700"}`,children:ce.label==="LLOYDS_RECOMMENDED"?"Lloyds recommended":"Best practice"}),ce.tags&&ce.tags.length>0&&n.jsx("span",{className:"inline-flex items-center rounded-full px-2 py-0.5 text-[9px] bg-slate-100 text-textLight",children:ce.tags.join(", ")})]}),n.jsx("div",{className:"text-[11px] text-textMuted max-h-10 overflow-hidden whitespace-pre-wrap",children:Oe})]}),n.jsxs("div",{className:"flex flex-col items-stretch gap-1",children:[_e&&n.jsx("button",{type:"button",onClick:()=>Fo(d,ce),className:"text-[11px] px-2 py-0.5 rounded bg-emerald-50 text-emerald-800 border border-emerald-200 hover:bg-emerald-100",children:"Insert"}),n.jsx("button",{type:"button",onClick:()=>u(ce),className:"text-[11px] px-2 py-0.5 rounded bg-slate-50 text-textLight border border-borderDark hover:bg-slate-100",children:"Copy"})]})]},ce.id)}):n.jsx("p",{className:"text-[11px] text-textMuted",children:"No best practices found for this section."})})():(()=>{const te=Ne.trim().toLowerCase(),Le=ht.filter(ce=>!ce.sectionKey||ce.sectionKey===d).filter(ce=>{if(!te)return!0;const Oe=(ce.tags||[]).join(" ").toLowerCase();return ce.title.toLowerCase().includes(te)||ce.body.toLowerCase().includes(te)||Oe.includes(te)}).slice().sort((ce,Oe)=>{const _e=ce.lastUsedAt||"",Xe=Oe.lastUsedAt||"";if(_e&&Xe&&_e!==Xe)return Xe.localeCompare(_e);if(_e&&!Xe)return-1;if(!_e&&Xe)return 1;const We=ce.updatedAt||ce.createdAt;return(Oe.updatedAt||Oe.createdAt).localeCompare(We)});return Le.length?Le.map(ce=>{const Oe=ce.body.length>160?`${ce.body.slice(0,160)}`:ce.body;return n.jsxs("div",{className:"flex items-center gap-2 bg-panel border border-sky-100 rounded px-2 py-2 hover:bg-sky-50 cursor-default",children:[n.jsxs("div",{className:"flex-1 min-w-0 text-right",children:[n.jsxs("div",{className:"flex flex-wrap items-center justify-end gap-1 mb-0.5",children:[n.jsx("span",{className:"font-semibold text-textLight truncate",children:ce.title}),ce.tags&&ce.tags.length>0&&n.jsx("span",{className:"inline-flex items-center rounded-full px-2 py-0.5 text-[9px] bg-slate-100 text-textLight",children:ce.tags.join(", ")})]}),n.jsx("div",{className:"text-[11px] text-textMuted max-h-10 overflow-hidden whitespace-pre-wrap",children:Oe})]}),n.jsxs("div",{className:"flex flex-col items-stretch gap-1",children:[n.jsx("button",{type:"button",onClick:()=>Po(d,ce),className:"text-[11px] px-2 py-0.5 rounded bg-sky-50 text-sky-800 border border-sky-200 hover:bg-sky-100 disabled:opacity-50 disabled:cursor-not-allowed",disabled:z,title:z?"       .":void 0,children:""}),n.jsx("button",{type:"button",onClick:()=>Hi(ce),className:"text-[11px] px-2 py-0.5 rounded bg-slate-50 text-textLight border border-borderDark hover:bg-slate-100",children:""}),n.jsx("button",{type:"button",onClick:()=>{os(!0),It({id:ce.id,title:ce.title,sectionKey:ce.sectionKey||"",tagsInput:(ce.tags||[]).join(", "),body:ce.body})},className:"text-[11px] px-2 py-0.5 rounded bg-slate-50 text-textLight border border-borderDark hover:bg-slate-100",children:""}),n.jsx("button",{type:"button",onClick:()=>{if(window.confirm("    ?")){const _e=Cp(a.id,ce.id);lt(_e)}},className:"text-[11px] px-2 py-0.5 rounded bg-red-50 text-red-700 border border-red-200 hover:bg-red-100",children:""})]})]},ce.id)}):n.jsx("p",{className:"text-[11px] text-textMuted",children:"   ."})})()})]}),d.includes("Expenses")?n.jsxs("div",{className:"space-y-4",children:[kn&&n.jsxs("div",{className:"bg-blue-50 p-4 rounded border border-blue-100 mb-4",children:[n.jsx("h4",{className:"text-sm font-bold text-blue-800 mb-2",children:"Add Expense Item"}),n.jsxs("div",{className:"flex gap-2 flex-wrap",children:[n.jsx("input",{type:"date",className:"border p-2 rounded text-sm",value:De.date,onChange:te=>Pe({...De,date:te.target.value})}),n.jsx("input",{type:"text",className:"border p-2 rounded text-sm flex-1",placeholder:"Description (e.g. Court Fee)",value:De.description,onChange:te=>Pe({...De,description:te.target.value})}),n.jsx("input",{type:"number",className:"border p-2 rounded text-sm w-24",placeholder:"Amount",value:De.amount,onChange:te=>Pe({...De,amount:Number(te.target.value)})}),n.jsx("button",{onClick:wi,className:"bg-blue-600 text-white px-4 py-2 rounded text-sm font-bold hover:bg-blue-700",children:"Add"})]})]}),kn&&n.jsxs("div",{className:"flex items-center justify-between mb-2",children:[n.jsxs("div",{className:"relative text-xs",children:[n.jsxs("button",{className:"flex items-center text-indigo-600 bg-panel px-2 py-1 rounded hover:bg-indigo-50",onClick:()=>Gn(Bn===d?null:d),children:[n.jsx(fo,{className:"w-3 h-3 mr-1"})," Auto-extract"]}),Bn===d&&n.jsxs("div",{className:"absolute right-0 mt-2 w-44 bg-panel border border-borderDark rounded-lg shadow-lg z-20",children:[n.jsxs("label",{className:"w-full block px-3 py-2 hover:bg-navySecondary cursor-pointer text-right",children:["  ",n.jsx("input",{type:"file",className:"hidden",onChange:te=>{Gn(null),Li(te,d)},accept:".pdf,.jpg,.png"})]}),n.jsx("button",{className:"w-full text-right px-3 py-2 hover:bg-navySecondary",onClick:()=>jr({mode:"EXPENSES",section:d}),children:"  OCR"})]})]}),E&&n.jsxs("span",{className:"text-xs text-indigo-500 flex items-center",children:[n.jsx(Mt,{className:"w-3 h-3 animate-spin mr-1"}),"   ,     "]})]}),n.jsxs("div",{className:"space-y-2",children:[n.jsxs("div",{className:"flex justify-between items-center bg-indigo-50 p-2 rounded border border-indigo-200",children:[n.jsxs("span",{className:"text-sm font-bold text-indigo-900",children:["Total Extracted: ",e.expensesSum||"0"]}),kn&&n.jsx("button",{onClick:()=>t({expensesItems:[],expensesSum:"0"}),className:"text-xs text-red-500 hover:underline",children:"Clear All"})]}),n.jsx("div",{className:"overflow-x-auto border rounded",children:n.jsxs("table",{className:"w-full text-sm border-collapse border-borderDark",children:[n.jsx("thead",{className:"bg-navySecondary",children:n.jsxs("tr",{children:[n.jsx("th",{className:"p-2 text-left text-textMuted",children:"Date"}),n.jsx("th",{className:"p-2 text-left text-textMuted",children:"Description"}),n.jsx("th",{className:"p-2 text-right text-textMuted",children:"Amount"}),!$e&&n.jsx("th",{className:"p-2 w-8"})]})}),n.jsxs("tbody",{children:[e.expensesItems.length===0&&n.jsx("tr",{children:n.jsx("td",{colSpan:4,className:"p-4 text-center text-gray-400 italic",children:"No expenses added."})}),e.expensesItems.map((te,ye)=>n.jsxs("tr",{className:"border-t",children:[n.jsx("td",{className:"p-2",children:te.date}),n.jsx("td",{className:"p-2",children:te.description}),n.jsxs("td",{className:"p-2 text-right",children:[te.amount," ",te.currency]}),kn&&n.jsx("td",{className:"p-2 text-center",children:n.jsx("button",{onClick:()=>ji(te.id),className:"text-red-400 hover:text-red-600",children:n.jsx(_t,{className:"w-3 h-3"})})})]},ye))]})]})}),kn&&n.jsx("div",{className:"bg-indigo-50 p-3 rounded border",children:n.jsxs("select",{className:"w-full text-sm border p-2 rounded",value:e.paymentRecommendation||"",onChange:te=>t({paymentRecommendation:te.target.value}),children:[n.jsx("option",{value:"",children:"-- Select Recommendation --"}),n.jsx("option",{value:"The expenses are lower than the Deductible...",children:"Option A: Lower than Deductible"}),n.jsxs("option",{value:`It would be appreciated... transfer ${e.expensesSum||"..."}`,children:["Option B: Transfer Funds (",e.expensesSum," )"]})]})})]}),n.jsxs("div",{className:`border-t-2 pt-4 mt-6 ${$e?"bg-green-50 p-4 rounded border-green-200":""}`,children:[n.jsxs("h4",{className:"font-bold text-sm text-textLight mb-2 flex items-center",children:[n.jsx(rh,{className:"w-4 h-4 mr-2"})," Tax Invoices (Appendices)"]}),(kn||!e.isWaitingForInvoices)&&n.jsxs("div",{className:"flex flex-wrap items-center gap-2 mb-2",children:[n.jsxs("button",{onClick:()=>{var te;return(te=T.current)==null?void 0:te.click()},className:"px-3 py-1.5 text-xs bg-navySecondary text-textLight rounded hover:bg-borderDark flex items-center gap-1",children:[n.jsx(fo,{className:"w-3 h-3"})," "]}),n.jsx("button",{onClick:()=>jr({mode:"INVOICE"}),className:"px-3 py-1.5 text-xs bg-red-100 text-red-700 rounded hover:bg-red-200 flex items-center gap-1",children:er==="INVOICE"?n.jsx(Mt,{className:"w-3 h-3 animate-spin"}):" "}),n.jsx("input",{ref:T,type:"file",className:"hidden",multiple:!0,accept:".pdf,.doc,.docx,application/msword,application/vnd.openxmlformats-officedocument.wordprocessingml.document,application/pdf",onChange:pa})]}),n.jsx("div",{className:"mt-2 space-y-2",children:e.invoiceFiles.map(te=>n.jsxs("div",{className:"flex items-center justify-between bg-panel p-2 rounded border shadow-sm text-xs",children:[n.jsxs("span",{className:"flex items-center",children:[n.jsx(po,{className:"w-3 h-3 mr-2 text-blue-500"})," ",te.name]}),n.jsx("button",{onClick:()=>is(te.id),className:"text-red-400 hover:text-red-600",children:n.jsx(_t,{className:"w-3 h-3"})})]},te.id))})]})]}):n.jsxs("div",{className:"relative",children:[!(mn&&un==="ENGLISH_ONLY")&&n.jsx(Lp,{className:"w-full border border-borderDark rounded-md p-4 min-h-[100px] text-right font-sans focus:ring-1 focus:ring-lpBlue outline-none transition-all",dir:"rtl",value:e.content[d]||"",onChange:te=>Vt(d,te.target.value),disabled:$e,readOnly:z,placeholder:"Type Hebrew content here...",style:{lineHeight:"1.6",textAlign:"justify"},textareaRef:(ve.current[d]||(ve.current[d]=oi.createRef()),ve.current[d])}),mn&&n.jsxs("div",{className:un==="ENGLISH_ONLY"?"":"mt-4 border-t pt-4",children:[n.jsxs("div",{className:"flex items-center justify-between mb-2",children:[n.jsx("label",{className:"text-xs font-bold text-textMuted uppercase block",children:"English Output (Editable)"}),a.role==="ADMIN"&&e.isTranslated&&!d.toLowerCase().includes("expenses")&&n.jsx("button",{type:"button",onClick:()=>$t(d),disabled:!!wn&&wn===d||!(((ge=e.translatedContent)==null?void 0:ge[d])||"").trim(),className:`text-[11px] px-2 py-1 rounded-full border transition ${wn===d?"border-emerald-400 text-emerald-600 bg-emerald-50 cursor-wait":(((Te=e.translatedContent)==null?void 0:Te[d])||"").trim()?"border-emerald-500 text-emerald-700 hover:bg-emerald-50":"border-borderDark text-slate-400 cursor-not-allowed"}`,children:wn===d?n.jsxs("span",{className:"inline-flex items-center gap-1",children:[n.jsx(Mt,{className:"w-3 h-3 animate-spin"}),"Improving..."]}):"Improve this section"})]}),n.jsx(Lp,{className:"w-full border border-indigo-200 rounded-md p-4 min-h-[100px] font-serif focus:ring-1 focus:ring-indigo-300 outline-none transition-all",dir:"ltr",value:((Ce=e.translatedContent)==null?void 0:Ce[d])||"",onChange:te=>To(d,te.target.value),placeholder:"Translated text will appear here after Auto-Translate...",readOnly:z,style:{lineHeight:"1.6",textAlign:"justify"}})]})]})]},d)})}),a.role==="ADMIN"&&X&&n.jsx("div",{className:"fixed inset-0 z-[120] flex items-center justify-center bg-black/40",children:n.jsxs("div",{className:"bg-panel rounded-lg shadow-xl w-full max-w-3xl max-h-[80vh] overflow-hidden flex flex-col",children:[n.jsxs("div",{className:"px-4 py-2 border-b flex items-center justify-between",children:[n.jsx("h3",{className:"text-sm font-semibold text-textLight",children:"Manage Templates"}),n.jsx("button",{type:"button",onClick:()=>ie(!1),className:"text-textMuted hover:text-textLight",children:n.jsx(_t,{className:"w-4 h-4"})})]}),n.jsx("div",{className:"px-4 py-3 border-b flex items-center gap-3 text-xs",children:n.jsxs("label",{className:"font-semibold text-textLight",children:["Section:",n.jsx("select",{className:"ml-2 border border-borderDark rounded px-2 py-1 text-xs",value:fe,onChange:d=>se(d.target.value),children:Rr.map(d=>n.jsx("option",{value:d,children:d},d))})]})}),n.jsx("div",{className:"flex-1 overflow-y-auto px-4 py-3 space-y-3 text-xs",children:(()=>{const d=ee.filter(g=>g.sectionKey===fe).sort((g,w)=>(g.orderIndex||0)-(w.orderIndex||0)||g.createdAt.localeCompare(w.createdAt));return d.length?d.map((g,w)=>n.jsxs("div",{className:"border border-borderDark rounded-md p-2 bg-slate-50 space-y-1",children:[n.jsxs("div",{className:"flex items-center justify-between gap-2",children:[n.jsx("input",{type:"text",className:"flex-1 border border-borderDark rounded px-2 py-1 text-xs",value:g.title,onChange:F=>fa(g.id,{title:F.target.value})}),n.jsxs("label",{className:"flex items-center gap-1 text-[11px] text-textLight",children:[n.jsx("input",{type:"checkbox",checked:g.isEnabled!==!1,onChange:F=>fa(g.id,{isEnabled:F.target.checked})}),"Enabled"]})]}),n.jsx("textarea",{className:"w-full border border-borderDark rounded px-2 py-1 text-xs mt-1",rows:3,value:g.body,onChange:F=>fa(g.id,{body:F.target.value})}),n.jsxs("div",{className:"flex items-center justify-between mt-1",children:[n.jsxs("div",{className:"flex items-center gap-1",children:[n.jsx("button",{type:"button",className:"px-2 py-0.5 rounded border border-borderDark text-[11px] text-textLight hover:bg-slate-100",onClick:()=>xa(g.id,"UP"),disabled:w===0,children:""}),n.jsx("button",{type:"button",className:"px-2 py-0.5 rounded border border-borderDark text-[11px] text-textLight hover:bg-slate-100",onClick:()=>xa(g.id,"DOWN"),disabled:w===d.length-1,children:""})]}),n.jsx("button",{type:"button",className:"px-2 py-0.5 rounded border border-red-200 text-[11px] text-red-700 hover:bg-red-50",onClick:()=>{window.confirm("Delete this template?")&&Ai(g.id)},children:"Delete"})]})]},g.id)):n.jsx("p",{className:"text-[11px] text-textMuted",children:"No templates defined yet for this section."})})()})]})}),a.role==="ADMIN"&&ne&&n.jsx("div",{className:"fixed inset-0 z-[120] flex items-center justify-center bg-black/40",children:n.jsxs("div",{className:"bg-panel rounded-lg shadow-xl w-full max-w-3xl max-h-[80vh] overflow-hidden flex flex-col",children:[n.jsxs("div",{className:"px-4 py-2 border-b flex items-center justify-between",children:[n.jsx("h3",{className:"text-sm font-semibold text-textLight",children:"Manage Best Practices"}),n.jsx("button",{type:"button",onClick:()=>xe(!1),className:"text-textMuted hover:text-textLight",children:n.jsx(_t,{className:"w-4 h-4"})})]}),n.jsx("div",{className:"px-4 py-3 border-b flex items-center gap-3 text-xs",children:n.jsxs("label",{className:"font-semibold text-textLight",children:["Section:",n.jsx("select",{className:"ml-2 border border-borderDark rounded px-2 py-1 text-xs",value:Ie,onChange:d=>Ee(d.target.value),children:Rr.map(d=>n.jsx("option",{value:d,children:d},d))})]})}),n.jsx("div",{className:"flex-1 overflow-y-auto px-4 py-3 space-y-3 text-xs",children:(()=>{const d=Z.filter(g=>g.sectionKey===Ie).sort((g,w)=>{const F=g.label==="LLOYDS_RECOMMENDED"?0:1,q=w.label==="LLOYDS_RECOMMENDED"?0:1;if(F!==q)return F-q;const re=g.usageCount||0;return(w.usageCount||0)-re});return d.length?d.map(g=>n.jsxs("div",{className:"border border-borderDark rounded-md p-2 bg-slate-50 space-y-1",children:[n.jsxs("div",{className:"flex items-center justify-between gap-2",children:[n.jsx("input",{type:"text",className:"flex-1 border border-borderDark rounded px-2 py-1 text-xs",value:g.title,onChange:w=>f(g.id,{title:w.target.value})}),n.jsxs("select",{className:"border border-borderDark rounded px-2 py-1 text-[11px]",value:g.label,onChange:w=>f(g.id,{label:w.target.value==="LLOYDS_RECOMMENDED"?"LLOYDS_RECOMMENDED":"BEST_PRACTICE"}),children:[n.jsx("option",{value:"BEST_PRACTICE",children:"Best practice"}),n.jsx("option",{value:"LLOYDS_RECOMMENDED",children:"Lloyds recommended"})]}),n.jsxs("label",{className:"flex items-center gap-1 text-[11px] text-textLight",children:[n.jsx("input",{type:"checkbox",checked:g.isEnabled!==!1,onChange:w=>L(g.id,w.target.checked)}),"Enabled"]})]}),n.jsx("textarea",{className:"w-full border border-borderDark rounded px-2 py-1 text-xs mt-1",rows:3,value:g.body,onChange:w=>f(g.id,{body:w.target.value})}),n.jsx("input",{type:"text",className:"w-full border border-borderDark rounded px-2 py-1 text-[11px] mt-1",placeholder:"Tags (comma separated)",value:(g.tags||[]).join(", "),onChange:w=>f(g.id,{tags:w.target.value.split(",").map(F=>F.trim()).filter(Boolean)})}),n.jsxs("div",{className:"flex items-center justify-between mt-1",children:[n.jsxs("div",{className:"flex items-center gap-2 text-[10px] text-textMuted",children:[n.jsxs("span",{children:["Usage: ",g.usageCount||0]}),g.lastUsedAt&&n.jsxs("span",{children:["Last used:"," ",new Date(g.lastUsedAt).toLocaleString("he-IL",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"})]})]}),n.jsx("button",{type:"button",className:"px-2 py-0.5 rounded border border-red-200 text-[11px] text-red-700 hover:bg-red-50",onClick:()=>{window.confirm("Delete this best practice?")&&S(g.id)},children:"Delete"})]})]},g.id)):n.jsx("p",{className:"text-[11px] text-textMuted",children:"No best practices defined yet for this section."})})()})]})}),Es&&n.jsx("div",{className:"fixed inset-0 z-[120] flex items-center justify-center bg-black/40",children:n.jsxs("div",{className:"bg-panel rounded-lg shadow-xl w-full max-w-3xl max-h-[80vh] overflow-hidden flex flex-col",children:[n.jsxs("div",{className:"px-4 py-2 border-b flex items-center justify-between",children:[n.jsx("h3",{className:"text-sm font-semibold text-textLight",children:" "}),n.jsx("button",{type:"button",onClick:()=>{os(!1),It(null)},className:"text-textMuted hover:text-textLight",children:n.jsx(_t,{className:"w-4 h-4"})})]}),n.jsxs("div",{className:"flex-1 overflow-y-auto px-4 py-3 space-y-4 text-xs",children:[n.jsxs("div",{className:"flex items-center justify-between gap-2",children:[n.jsx("p",{className:"text-[11px] text-textMuted",children:"          ."}),n.jsx("button",{type:"button",className:"px-3 py-1.5 rounded bg-sky-600 text-white text-[11px] font-semibold hover:bg-sky-700",onClick:()=>It({id:void 0,title:"",sectionKey:"",tagsInput:"",body:""}),children:" "})]}),ht.length===0&&n.jsx("p",{className:"text-[11px] text-textMuted",children:'    .     " ".'}),ht.length>0&&n.jsxs("div",{className:"space-y-2",children:[n.jsx("h4",{className:"text-[11px] font-semibold text-textLight",children:" "}),n.jsx("div",{className:"space-y-1",children:ht.slice().sort((d,g)=>(g.updatedAt||g.createdAt).localeCompare(d.updatedAt||d.createdAt)).map(d=>n.jsxs("div",{className:"flex items-center justify-between gap-2 border border-borderDark rounded-md px-2 py-1 bg-slate-50",children:[n.jsx("div",{className:"flex-1 min-w-0 text-right",children:n.jsxs("div",{className:"flex flex-wrap items-center justify-end gap-1",children:[n.jsx("span",{className:"font-semibold text-textLight truncate",children:d.title}),d.sectionKey&&n.jsx("span",{className:"inline-flex items-center rounded-full px-2 py-0.5 text-[9px] bg-slate-100 text-textLight",children:d.sectionKey}),d.tags&&d.tags.length>0&&n.jsx("span",{className:"inline-flex items-center rounded-full px-2 py-0.5 text-[9px] bg-slate-100 text-textLight",children:d.tags.join(", ")})]})}),n.jsxs("div",{className:"flex items-center gap-1",children:[n.jsx("button",{type:"button",className:"px-2 py-0.5 rounded border border-borderDark text-[11px] text-textLight hover:bg-slate-100",onClick:()=>It({id:d.id,title:d.title,sectionKey:d.sectionKey||"",tagsInput:(d.tags||[]).join(", "),body:d.body}),children:""}),n.jsx("button",{type:"button",className:"px-2 py-0.5 rounded border border-red-200 text-[11px] text-red-700 hover:bg-red-50",onClick:()=>{if(window.confirm("Delete this personal snippet?")){const g=Cp(a.id,d.id);lt(g),At&&At.id===d.id&&It(null)}},children:""})]})]},d.id))})]}),At&&n.jsxs("form",{className:"border-t border-borderDark pt-3 space-y-3",onSubmit:d=>{d.preventDefault();const g=At.title.trim(),w=At.body.trim();if(!g||!w)return;const F=At.tagsInput.split(",").map(re=>re.trim()).filter(Boolean)||[],q=sv(a.id,{id:At.id,title:g,body:w,sectionKey:At.sectionKey||void 0,tags:F});lt(q),It(null)},children:[n.jsx("h4",{className:"text-[11px] font-semibold text-textLight",children:At.id?" ":" "}),n.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-2",children:[n.jsxs("div",{className:"space-y-1",children:[n.jsx("label",{className:"block font-semibold text-textLight",children:""}),n.jsx("input",{type:"text",className:"w-full border border-borderDark rounded px-2 py-1 text-xs",value:At.title,onChange:d=>It(g=>g&&{...g,title:d.target.value}),required:!0})]}),n.jsxs("div",{className:"space-y-1",children:[n.jsx("label",{className:"block font-semibold text-textLight",children:" ()"}),n.jsxs("select",{className:"w-full border border-borderDark rounded px-2 py-1 text-xs",value:At.sectionKey,onChange:d=>It(g=>g&&{...g,sectionKey:d.target.value}),children:[n.jsx("option",{value:"",children:" "}),Rr.map(d=>n.jsx("option",{value:d,children:d},d))]})]})]}),n.jsxs("div",{className:"space-y-1",children:[n.jsx("label",{className:"block font-semibold text-textLight",children:" (,  )"}),n.jsx("input",{type:"text",className:"w-full border border-borderDark rounded px-2 py-1 text-xs",value:At.tagsInput,onChange:d=>It(g=>g&&{...g,tagsInput:d.target.value})})]}),n.jsxs("div",{className:"space-y-1",children:[n.jsx("label",{className:"block font-semibold text-textLight",children:" "}),n.jsx("textarea",{className:"w-full border border-borderDark rounded px-2 py-1 text-xs",rows:5,value:At.body,onChange:d=>It(g=>g&&{...g,body:d.target.value})})]}),n.jsxs("div",{className:"flex items-center justify-end gap-2 pt-2 border-t border-borderDark",children:[n.jsx("button",{type:"button",className:"px-3 py-1.5 rounded border border-borderDark text-[11px] text-textLight hover:bg-slate-100",onClick:()=>It(null),children:""}),n.jsx("button",{type:"submit",className:"px-3 py-1.5 rounded bg-sky-600 text-white text-[11px] font-semibold hover:bg-sky-700",children:""})]})]})]})]})}),a.role==="ADMIN"&&Me&&n.jsx("div",{className:"fixed inset-0 z-[130] flex items-center justify-center bg-black/40",children:n.jsxs("div",{className:"bg-panel rounded-lg shadow-xl w-full max-w-md max-h-[80vh] overflow-hidden flex flex-col",children:[n.jsxs("div",{className:"px-4 py-2 border-b flex items-center justify-between",children:[n.jsx("h3",{className:"text-sm font-semibold text-textLight",children:"Save Best Practice"}),n.jsx("button",{type:"button",onClick:ga,className:"text-textMuted hover:text-textLight",children:n.jsx(_t,{className:"w-4 h-4"})})]}),n.jsx(cv,{onSubmit:Er,onCancel:ga,initialTitle:Me.body.split(/\s+/).slice(0,6).join(" ")})]})}),n.jsxs("div",{className:"flex justify-between pt-4",children:[n.jsxs("button",{onClick:s,className:"flex items-center text-textMuted px-4 py-2 hover:bg-navySecondary rounded",children:[n.jsx(ql,{className:"mr-2 w-4 h-4"})," Back"]}),n.jsxs("button",{onClick:r,className:"flex items-center bg-navy text-white px-6 py-2 rounded hover:bg-navySecondary transition",children:["Next Step ",n.jsx(es,{className:"ml-2 w-4 h-4"})]})]})]})]})},Ev=({onClose:e,onSubmit:t,currentUser:s,favoriteProviders:r=[],onSaveFavorite:a})=>{const o=s.role==="LAWYER",[l,i]=y.useState(o?s.id:""),[c,m]=y.useState(""),[p,h]=y.useState(""),[v,A]=y.useState(null),[D,I]=y.useState([{id:Tn(),category:"EXPERT_OUR",serviceProvider:"",amount:""}]),[W,N]=y.useState([]),x=4,b=async()=>{if(!l||!p)return;let E=null;const R=k=>t({lawyerId:l,instructions:c,odakanitNo:p,file:k,worksheet:D,invoiceFiles:W});if(v){const k=new FileReader;k.onload=C=>{var ee;E={name:v.name,type:v.type,data:((ee=C.target)==null?void 0:ee.result).split(",")[1]},R(E)},k.readAsDataURL(v)}else R()},B=async E=>{const R=E.target.files;if(!R)return;if(W.length>=x){alert("   4 ."),E.target.value="";return}const k=Array.from(R).slice(0,x-W.length),C=await Promise.all(k.map(ee=>new Promise(V=>{const _=new FileReader;_.onload=P=>{var X;return V({id:`inv-${Date.now()}-${Math.random().toString(36).slice(2,6)}`,name:ee.name,data:((X=P.target)==null?void 0:X.result).split(",")[1],type:ee.type})},_.readAsDataURL(ee)})));N(ee=>[...ee,...C]),E.target.value=""},H=E=>{N(R=>R.filter(k=>k.id!==E))},z=(E,R,k)=>{I(C=>C.map(ee=>ee.id===E?{...ee,[R]:k}:ee))},Y=E=>{const R=ns.find(k=>k.type===E)||ns[0];I(k=>[...k,{id:Tn(),category:R.value,serviceProvider:"",amount:"",customLabel:""}])},Q=E=>{I(R=>R.length===1?R:R.filter(k=>k.id!==E))},G=Td(D,s),ae=si(G);return n.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-[200]",children:n.jsxs("div",{className:"bg-panel p-6 rounded-lg shadow-xl w-96 animate-scale-in",children:[n.jsx("h3",{className:"font-bold text-lg mb-4 text-textLight",children:o?"  ":"Open New Finance Case"}),n.jsxs("div",{className:"space-y-3",children:[n.jsxs("div",{children:[n.jsx("label",{className:"block text-xs font-bold text-textMuted",children:"Internal Case # (Odakanit)"}),n.jsx("input",{className:"w-full border p-2 rounded",value:p,onChange:E=>h(E.target.value),placeholder:"e.g. 55492"})]}),!o&&n.jsxs(n.Fragment,{children:[n.jsxs("div",{children:[n.jsx("label",{className:"block text-xs font-bold text-textMuted",children:"Assign Lawyer"}),n.jsxs("select",{className:"w-full border p-2 rounded",value:l,onChange:E=>i(E.target.value),children:[n.jsx("option",{value:"",children:"-- Select --"}),hs.filter(E=>E.role==="LAWYER").map(E=>n.jsx("option",{value:E.id,children:E.name},E.id))]})]}),n.jsxs("div",{children:[n.jsx("label",{className:"block text-xs font-bold text-textMuted",children:"Instructions"}),n.jsx(mo,{clientId:go,children:n.jsx("textarea",{className:"w-full border p-2 rounded",rows:3,value:c,onChange:E=>m(E.target.value),placeholder:"Notes for lawyer..."})})]}),n.jsxs("div",{children:[n.jsx("label",{className:"block text-xs font-bold text-textMuted",children:"Attach Expenses File"}),n.jsx("input",{type:"file",onChange:E=>{var R;return A(((R=E.target.files)==null?void 0:R[0])||null)},className:"text-xs"})]}),n.jsxs("div",{className:"border rounded-lg p-3 bg-amber-50",children:[n.jsxs("div",{className:"flex justify-between items-center mb-2",children:[n.jsx("label",{className:"block text-xs font-bold text-amber-700",children:"Expense Worksheet"}),n.jsxs("div",{className:"flex gap-2 text-xs text-amber-700 font-semibold",children:[n.jsx("button",{type:"button",onClick:()=>Y("EXPENSE"),className:"hover:underline",children:"+ Expense"}),n.jsx("button",{type:"button",onClick:()=>Y("ADJUSTMENT"),className:"hover:underline",children:"+ Adjustment"})]})]}),n.jsx("div",{className:"space-y-2 max-h-48 overflow-auto pr-1",children:D.map(E=>{const R=ns.find(V=>V.value===E.category),k=(R==null?void 0:R.type)!=="ADJUSTMENT",C=r.filter(V=>V.category===E.category||V.category==="OTHER"),ee=Td([E],s)[0];return n.jsxs("div",{className:"border border-amber-100 bg-panel rounded-lg p-2 space-y-2",children:[n.jsxs("div",{children:[n.jsx("label",{className:"block text-[10px] font-bold text-textMuted",children:"Expense Details"}),n.jsx("select",{value:E.category,onChange:V=>z(E.id,"category",V.target.value),className:"w-full border rounded text-xs p-2",children:ns.map(V=>n.jsx("option",{value:V.value,children:V.label},V.value))})]}),E.category==="OTHER"&&n.jsxs("div",{children:[n.jsx("label",{className:"block text-[10px] font-bold text-textMuted",children:"Custom Label"}),n.jsx("input",{className:"w-full border rounded text-xs p-2",placeholder:"Describe expense",value:E.customLabel||"",onChange:V=>z(E.id,"customLabel",V.target.value)})]}),k&&n.jsxs("div",{children:[n.jsx("label",{className:"block text-[10px] font-bold text-textMuted",children:"Service Provider"}),n.jsx("input",{list:`provider-${E.id}`,className:"w-full border rounded text-xs p-2",placeholder:"Provider name",value:E.serviceProvider,onChange:V=>z(E.id,"serviceProvider",V.target.value)}),n.jsx("datalist",{id:`provider-${E.id}`,children:C.map(V=>n.jsx("option",{value:V.serviceProvider,children:V.label},V.id))}),n.jsx("button",{type:"button",onClick:()=>a&&E.serviceProvider.trim()&&a({id:Tn(),category:E.category,label:(ee==null?void 0:ee.label)||"Expense",serviceProvider:E.serviceProvider.trim()}),className:"text-[10px] text-amber-600 hover:underline mt-1",children:"Save to favorites"})]}),n.jsxs("div",{children:[n.jsx("label",{className:"block text-[10px] font-bold text-textMuted",children:"Cost ()"}),n.jsx("input",{type:"number",min:"0",className:"w-full border rounded text-xs p-2",placeholder:"",value:E.amount,onChange:V=>z(E.id,"amount",V.target.value)})]}),n.jsx("div",{className:"text-right",children:n.jsx("button",{type:"button",onClick:()=>Q(E.id),className:"text-[10px] text-red-500 hover:underline",children:"Remove"})})]},E.id)})}),n.jsxs("div",{className:"text-right text-xs font-bold text-amber-800 mt-2",children:["Total balance preview: ",ae.totalBalance.toLocaleString()]})]}),n.jsxs("div",{className:"border rounded-lg p-3 bg-panel",children:[n.jsxs("div",{className:"flex justify-between items-center mb-2",children:[n.jsx("label",{className:"block text-xs font-bold text-textLight",children:"Tax Invoices (PDF / Word)"}),n.jsxs("span",{className:"text-[11px] text-textMuted",children:[W.length,"/",x]})]}),n.jsxs("label",{className:"flex flex-col items-center justify-center w-full h-24 border-2 border-borderDark border-dashed rounded-lg cursor-pointer bg-panel hover:bg-navySecondary",children:[n.jsxs("div",{className:"flex flex-col items-center justify-center pt-5 pb-6",children:[n.jsx(fo,{className:"w-6 h-6 text-gray-400 mb-2"}),n.jsx("p",{className:"text-xs text-textMuted",children:"   ( 4 )"})]}),n.jsx("input",{type:"file",className:"hidden",multiple:!0,accept:".pdf,.doc,.docx,application/msword,application/vnd.openxmlformats-officedocument.wordprocessingml.document,application/pdf",onChange:B})]}),n.jsxs("div",{className:"mt-2 space-y-2 max-h-32 overflow-auto",children:[W.map(E=>n.jsxs("div",{className:"flex items-center justify-between bg-navySecondary p-2 rounded border text-xs",children:[n.jsxs("span",{className:"flex items-center gap-2 text-textLight",children:[n.jsx(po,{className:"w-3 h-3 text-blue-500"}),E.name]}),n.jsx("button",{type:"button",onClick:()=>H(E.id),className:"text-red-400 hover:text-red-600",children:n.jsx(_t,{className:"w-3 h-3"})})]},E.id)),W.length===0&&n.jsx("p",{className:"text-xs text-gray-400 text-center",children:"   ."})]})]})]}),o&&n.jsx("p",{className:"text-xs text-textMuted",children:"    .    ."}),n.jsx("button",{onClick:b,className:"w-full bg-indigo-600 text-white py-2 rounded font-bold mt-2 hover:bg-indigo-700",children:o?"Create Personal Folder":"Create Folder"}),n.jsx("button",{onClick:e,className:"w-full text-textMuted text-sm hover:underline mt-1",children:"Cancel"})]})]})})},kv=({user:e,reports:t,onSelectReport:s,onNewReport:r,onLogout:a,onUpdateReport:o,onDeleteReport:l,onFinanceTaskCreate:i,onNotifyLawyerFromFinance:c,caseTemplates:m=[],onStartTemplate:p,onStartNextReport:h,archiveAfterMs:v,favoriteProviders:A={},onSaveFavorite:D,onDeleteFavorite:I,onOpenWorksheet:W,onRequestReminder:N,onRequestNote:x,onSoftDeleteReport:b,onRestoreReport:B,notifications:H=[],showNotifications:z,setShowNotifications:Y,onClearNotifications:Q,dailySummaryOptIn:G,setDailySummaryOptIn:ae,caseFolders:E,onOpenCaseFolder:R,onOpenAssistant:k})=>{const C=e.role==="ADMIN"||e.role==="SUB_ADMIN"||e.role==="FINANCE",ee=e.role==="LAWYER"||e.role==="SUB_ADMIN"||e.role==="FINANCE",[V,_]=y.useState(!1),[P,X]=y.useState(!1),[ie,fe]=y.useState(!1),[se,ue]=y.useState(!1),[we,He]=y.useState({category:"EXPERT_OUR",label:"",provider:""}),[Ue,Ze]=y.useState(""),[ze,rt]=y.useState(null),qe=e.role==="ADMIN",j=e.role==="SUB_ADMIN"||e.role==="FINANCE";if(e.role==="FINANCE"){const T=ve=>{o(ve,{isPaid:!0})};return n.jsx(Bb,{user:e,reports:t,onLogout:a,onNotifyLawyer:c,onMarkReportPaid:T,onOpenAssistant:()=>k&&k(),caseFolders:E})}if(!C&&e.role==="LAWYER")return n.jsx(eb,{user:e,reports:t,caseFolders:E||{},notifications:H,showNotifications:z,setShowNotifications:Y,onClearNotifications:Q,dailySummaryOptIn:G,setDailySummaryOptIn:ae,archiveAfterMs:v,onSelectReport:s,onNewReport:r,onOpenCaseFolder:R,onLogout:a,deleteReportById:l});const $=Date.now(),J=v??Number.MAX_SAFE_INTEGER,pe=T=>T.status==="SENT"&&T.sentAt&&$-new Date(T.sentAt).getTime()>=J,me=C?t:t.filter(T=>T.createdBy===e.id),he=me.filter(pe),je=me.filter(T=>!pe(T)&&!T.deletedAt),Be=me.filter(T=>T.deletedAt&&$-new Date(T.deletedAt).getTime()<_h),Ve=me.filter(T=>!T.deletedAt),tt=qe?je:ee?Ve:me,Ke=qe?he:ee?Be:[],ot=C?[]:t.filter(T=>T.status==="READY_TO_SEND"&&T.createdBy===e.id&&!T.deletedAt),Z=C?[]:t.filter(T=>["TASK_ASSIGNED","WAITING_FOR_INVOICES"].includes(T.status)&&T.createdBy===e.id&&!T.deletedAt),be=T=>{var ve;if((ve=T.reportHistory)!=null&&ve.length)return T.reportHistory;if(T.status==="SENT"){const De=T.sentAt||T.reportDate||new Date().toISOString();return[{id:`${T.id}-legacy`,reportNumber:1,subject:`${T.insurerName||"Report"}${T.insuredName?` - ${T.insuredName}`:""}`,date:De,sent:!0}]}return[]},M=C?[]:t.filter(T=>T.createdBy===e.id&&!T.deletedAt).flatMap(T=>{const ve=be(T);return ve.length?ve.map((De,Pe)=>{var $e;return{parent:T,entry:De,reportNumber:De.reportNumber||Pe+1,sentAt:De.date||(($e=De.snapshot)==null?void 0:$e.createdAt)||T.sentAt,isLatest:Pe===ve.length-1}}):[]}).sort((T,ve)=>{const De=T.sentAt?new Date(T.sentAt).getTime():0;return(ve.sentAt?new Date(ve.sentAt).getTime():0)-De}),K=T=>{const ve=be(T),De=ve[ve.length-1],Pe=(De==null?void 0:De.date)||T.sentAt;return Pe?new Date(Pe).getTime():0},oe=C?[]:t.filter(T=>T.createdBy!==e.id||T.deletedAt||T.status!=="SENT"?!1:be(T).length>0).sort((T,ve)=>K(ve)-K(T)),le=C?[]:[{id:"ready",title:"  ",subtitle:"    ",items:ot,empty:"   .",actionLabel:" ",action:T=>s(T.id),tone:"border-red-100"},{id:"finance",title:"   ",subtitle:"  /   ",items:Z,empty:"   .",actionLabel:" ",action:T=>s(T.id),tone:"border-amber-100"},{id:"followup",title:'"  ',subtitle:' "    "   ',items:oe,empty:' "   .',actionLabel:'" ',action:h?T=>h(T.id):void 0,tone:"border-blue-100"},{id:"sent",title:" ",subtitle:'      "   ',items:M,empty:"     .",tone:"border-green-100"}],ne=C?t.filter(T=>T.odakanitNo&&!T.deletedAt):[],xe=(A==null?void 0:A[e.id])||[],Ie=()=>{if(!we.provider.trim())return;const T=ns.find(De=>De.value===we.category),ve=we.label.trim()||(T==null?void 0:T.label)||"Favorite provider";D&&D(e.id,{id:Tn(),category:we.category,label:ve,serviceProvider:we.provider.trim()}),He({category:we.category,label:"",provider:""})},Ee=T=>{I&&I(e.id,T)};m.filter(T=>T.ownerId===e.id);const Me=t.filter(T=>Pp(T)&&!T.deletedAt),Ye=e.role==="FINANCE"||e.role==="SUB_ADMIN",ht=qe||ee,lt=qe?`Items move here ${v/(1e3*60*60)}h after sending and are deleted after ${Lh/(1e3*60*60*24)} days.`:ee?"     7    .":"",Ne=Me.filter(T=>!["READY_TO_SEND","SENT"].includes(T.status)),Ct=Me.filter(T=>T.status==="READY_TO_SEND"),Es=Me.filter(T=>T.status==="SENT"),os=Es.reduce((T,ve)=>T+Mp(ve),0),At=T=>T==="SENT"?"bg-gold/20 text-goldLight border-gold":T==="READY_TO_SEND"?"bg-danger/30 text-red-300 border-danger":"bg-navySecondary text-textMuted border-borderDark",It=T=>T==="READY_TO_SEND"?"READY TO SEND":T.replace(/_/g," "),un=T=>{o(T,{isPaid:!0})},ls=ie?Ke:tt,ct=T=>{const ve=T.createdBy||"unknown",De=T.odakanitNo||T.marketRef||T.id||"unknown",Pe=(T.plaintiffName||"unknown").toLowerCase();return`${ve}::${De}::${Pe}`},Fn=Ye?ls.filter(Pp):ls,er=new Set((Ye?[]:ls).map(T=>ct(T))),tr=!C&&!Ye?m.filter(T=>T.ownerId===e.id&&!er.has(T.caseKey)).map(T=>({id:`template-${T.caseKey}`,createdBy:T.ownerId,ownerName:T.ownerName,reportDate:T.lastUpdated,status:"TASK_ASSIGNED",recipientId:"1",insurerName:T.insurerName||"",lineSlipNo:T.lineSlipNo||"",marketRef:T.marketRef||"",insuredName:T.insuredName||"",plaintiffName:T.plaintiffName||"",plaintiffTitle:T.plaintiffTitle||"Plaintiff",odakanitNo:T.odakanitNo,selectedTimeline:"standard",filenameTag:ih[0],selectedSections:["Update"],content:{},translatedContent:{},expertSummaryMode:{},invoiceFiles:[],isWaitingForInvoices:!1,isTranslated:!1,expensesItems:[],expenseWorksheet:_s(),reportNotes:[],__templateKey:T.caseKey})):[],ks=Ye?Fn:[...Fn,...tr],Sn=Ue.trim().toLowerCase(),Bn=T=>Sn?`${T.odakanitNo||""} ${T.insuredName||""} ${T.plaintiffName||""} ${T.ownerName||""}`.toLowerCase().includes(Sn):!0,Gn=Sn?ks.filter(Bn):ks,wn=Ye?[]:(()=>{const T=new Map;return Gn.forEach(ve=>{if(ve.__templateKey)return;const De=ve.odakanitNo||ve.marketRef||ve.insuredName||ve.id,Pe=ve.reportDate?new Date(ve.reportDate).getTime():0,$e=T.get(De);$e?($e.reports.push(ve),Pe>$e.latestDate&&($e.latestDate=Pe),!$e.caseLabel&&(ve.insuredName||ve.plaintiffName)&&($e.caseLabel=ve.insuredName||ve.plaintiffName||$e.caseLabel),!$e.insuredName&&ve.insuredName&&($e.insuredName=ve.insuredName),!$e.plaintiffName&&ve.plaintiffName&&($e.plaintiffName=ve.plaintiffName)):T.set(De,{key:De,odakanitNo:ve.odakanitNo||"",caseLabel:ve.insuredName||ve.plaintiffName||ve.marketRef||"",insuredName:ve.insuredName||"",plaintiffName:ve.plaintiffName||"",reports:[ve],latestDate:Pe})}),Array.from(T.values()).sort((ve,De)=>De.latestDate-ve.latestDate)})(),jn=T=>!["READY_TO_SEND","SENT"].includes(T.status),Sr=T=>{if(!jn(T)){alert("      -READY TO SEND  .");return}const ve=T.insuredName||T.plaintiffName||T.odakanitNo||T.id;window.confirm(`  " "${ve}"?    .`)&&l&&l(T.id)};return y.useEffect(()=>{ze&&(wn.some(T=>T.key===ze)||rt(null))},[ze,wn]),n.jsxs("div",{className:"min-h-screen bg-bgDark p-6 relative",children:[P&&n.jsx(dv,{onClose:()=>X(!1)}),V&&n.jsx(Ev,{currentUser:e,onClose:()=>_(!1),onSubmit:T=>{i(T),_(!1)},favoriteProviders:A[e.id]||[],onSaveFavorite:T=>D&&D(e.id,T)}),se&&n.jsx("div",{className:"fixed inset-0 bg-black/40 flex items-center justify-center z-[200] p-4",children:n.jsxs("div",{className:"bg-panel rounded-2xl shadow-2xl w-full max-w-2xl p-6 space-y-4",children:[n.jsxs("div",{className:"flex items-center justify-between",children:[n.jsxs("h3",{className:"text-lg font-bold text-textLight flex items-center gap-2",children:[n.jsx(C0,{className:"w-4 h-4 text-amber-500"}),"   "]}),n.jsx("button",{onClick:()=>ue(!1),className:"text-textMuted hover:text-textLight",children:n.jsx(_t,{className:"w-5 h-5"})})]}),n.jsxs("div",{className:"grid md:grid-cols-3 gap-3",children:[n.jsxs("div",{children:[n.jsx("label",{className:"block text-xs font-bold text-textMuted mb-1",children:""}),n.jsx("select",{value:we.category,onChange:T=>He({...we,category:T.target.value}),className:"w-full border rounded text-sm p-2",children:ns.filter(T=>T.type==="EXPENSE").map(T=>n.jsx("option",{value:T.value,children:T.label},T.value))})]}),n.jsxs("div",{children:[n.jsx("label",{className:"block text-xs font-bold text-textMuted mb-1",children:" "}),n.jsx("input",{className:"w-full border rounded text-sm p-2",value:we.label,onChange:T=>He({...we,label:T.target.value}),placeholder:":  "})]}),n.jsxs("div",{children:[n.jsx("label",{className:"block text-xs font-bold text-textMuted mb-1",children:" "}),n.jsx("input",{className:"w-full border rounded text-sm p-2",value:we.provider,onChange:T=>He({...we,provider:T.target.value}),placeholder:'"  '})]})]}),n.jsx("div",{className:"text-right",children:n.jsx("button",{onClick:Ie,className:"bg-amber-500 text-white px-4 py-2 rounded font-bold hover:bg-amber-600",children:" "})}),n.jsxs("div",{className:"max-h-64 overflow-y-auto border rounded-lg divide-y",children:[xe.length===0&&n.jsx("p",{className:"text-sm text-gray-400 text-center py-6",children:"   ."}),xe.map(T=>n.jsxs("div",{className:"p-3 flex items-center justify-between",children:[n.jsxs("div",{children:[n.jsx("p",{className:"text-sm font-bold text-textLight",children:T.label}),n.jsx("p",{className:"text-xs text-textMuted",children:T.serviceProvider})]}),n.jsx("button",{onClick:()=>Ee(T.id),className:"text-xs text-red-500 hover:underline",children:""})]},T.id))]})]})}),n.jsxs("div",{className:"max-w-6xl mx-auto",children:[n.jsxs("div",{className:"flex justify-between items-center mb-8",children:[n.jsxs("div",{children:[n.jsx("h1",{className:"text-3xl font-serif font-bold text-lpBlue",children:"Lior Perry Law Office"}),n.jsxs("p",{className:"text-textMuted",children:["Welcome back, ",n.jsx("span",{className:"font-bold",children:e.name})," (",e.role,")"]})]}),n.jsxs("div",{className:"flex items-center gap-3 flex-wrap justify-end",children:[ht&&n.jsxs("button",{onClick:()=>fe(T=>!T),className:`flex items-center px-4 py-2 rounded shadow text-sm font-bold ${ie?"bg-gray-300 text-textLight":"bg-borderDark text-textLight"} hover:bg-borderDark`,children:[n.jsx(Ps,{className:"w-4 h-4 mr-2"})," ",ie?"Back to Reports":`Recycle Bin (${Ke.length})`]}),n.jsxs("button",{onClick:()=>_(!0),className:"flex items-center bg-indigo-600 text-white px-4 py-2 rounded shadow hover:bg-indigo-700 font-bold",children:[n.jsx(Au,{className:"w-4 h-4 mr-2"})," Open New Case Folder"]}),n.jsxs("button",{type:"button",onClick:()=>k&&k(),className:"flex items-center text-indigo-700 bg-indigo-50 px-3 py-2 rounded hover:bg-indigo-100",children:[n.jsx(sa,{className:"w-4 h-4 mr-2"}),"  "]}),n.jsxs("div",{className:"relative",children:[n.jsxs("button",{onClick:()=>Y(T=>!T),className:"flex items-center text-blue-600 bg-blue-50 px-3 py-2 rounded hover:bg-blue-100 relative",children:[n.jsx(Gl,{className:"w-4 h-4 mr-2"})," Notifications",H.length>0&&n.jsx("span",{className:"absolute -top-2 -right-2 bg-red-500 text-white text-[10px] rounded-full px-1",children:H.length})]}),z&&n.jsxs("div",{className:"absolute right-0 mt-2 w-80 bg-panel border border-borderDark shadow-xl rounded-lg z-50",children:[n.jsxs("div",{className:"flex items-center justify-between px-3 py-2 border-b",children:[n.jsx("span",{className:"text-sm font-bold text-textLight",children:"Smart Notifications"}),n.jsxs("label",{className:"text-xs text-textMuted flex items-center gap-1",children:[n.jsx("input",{type:"checkbox",checked:G,onChange:T=>ae(T.target.checked)}),"Daily summary"]})]}),n.jsxs("div",{className:"max-h-64 overflow-auto divide-y",children:[H.length===0&&n.jsx("div",{className:"p-4 text-xs text-gray-400 text-center",children:"No notifications yet."}),H.map(T=>n.jsxs("div",{className:"p-3 text-sm",children:[n.jsx("p",{className:"font-medium text-textLight",children:T.message}),n.jsx("p",{className:"text-[10px] text-gray-400",children:new Date(T.createdAt).toLocaleString()})]},T.id))]}),n.jsx("div",{className:"px-3 py-2 text-right text-xs",children:n.jsx("button",{onClick:Q,className:"text-red-500 hover:underline",children:"Clear all"})})]})]}),n.jsxs("button",{onClick:()=>X(!0),className:"flex items-center text-blue-600 bg-blue-50 px-3 py-2 rounded hover:bg-blue-100",children:[n.jsx(ju,{className:"w-4 h-4 mr-2"})," "]}),!1,n.jsxs("button",{onClick:a,className:"flex items-center text-red-600 hover:bg-red-50 px-4 py-2 rounded",children:[n.jsx(sh,{className:"w-4 h-4 mr-2"})," Logout"]})]})]}),C&&n.jsx(uv,{reports:t,currentUser:e,onMarkPaid:un}),j&&n.jsxs("div",{className:"mb-8 bg-panel border border-amber-200 rounded-2xl shadow p-6 space-y-4",children:[n.jsxs("div",{className:"flex items-center justify-between flex-wrap gap-3",children:[n.jsxs("div",{children:[n.jsxs("h3",{className:"text-lg font-bold text-amber-700 flex items-center gap-2",children:[n.jsx(rh,{className:"w-5 h-5"})," Expenses Overview"]}),n.jsx("p",{className:"text-sm text-textMuted",children:"Tracking all reports that include expense tables."})]}),n.jsxs("div",{className:"flex items-center gap-4 text-sm",children:[n.jsx("button",{onClick:()=>ue(!0),className:"text-xs text-amber-700 underline hover:text-amber-900",children:"Manage Favorite Providers"}),n.jsxs("div",{className:"text-center",children:[n.jsx("p",{className:"text-xs uppercase text-gray-400",children:"Assigned to Lawyers"}),n.jsx("p",{className:"text-xl font-bold text-amber-700",children:Ne.length})]}),n.jsxs("div",{className:"text-center",children:[n.jsx("p",{className:"text-xs uppercase text-gray-400",children:"Waiting for Lior"}),n.jsx("p",{className:"text-xl font-bold text-blue-600",children:Ct.length})]}),n.jsxs("div",{className:"text-center",children:[n.jsx("p",{className:"text-xs uppercase text-gray-400",children:"Sent to Insurer"}),n.jsx("p",{className:"text-xl font-bold text-green-600",children:Es.length})]}),n.jsxs("div",{className:"text-center",children:[n.jsx("p",{className:"text-xs uppercase text-gray-400",children:"Total Sent Balance"}),n.jsxs("p",{className:"text-xl font-bold text-green-700",children:["",os.toLocaleString()]})]})]})]}),n.jsx("div",{className:"overflow-x-auto",children:n.jsxs("table",{className:"w-full text-sm",children:[n.jsx("thead",{className:"bg-amber-50 text-amber-800",children:n.jsxs("tr",{children:[n.jsx("th",{className:"p-2 text-left",children:"Case / Lawyer"}),n.jsx("th",{className:"p-2 text-left",children:"Status"}),n.jsx("th",{className:"p-2 text-right",children:"Total Balance ()"}),n.jsx("th",{className:"p-2 text-right",children:"Action"})]})}),n.jsxs("tbody",{className:"divide-y",children:[Me.length===0&&n.jsx("tr",{children:n.jsx("td",{colSpan:4,className:"p-4 text-center text-gray-400",children:"No expense reports yet."})}),Me.map(T=>n.jsxs("tr",{className:"hover:bg-amber-50 transition",children:[n.jsxs("td",{className:"p-2",children:[n.jsx("div",{className:"font-semibold text-textLight",children:T.insuredName||"Unnamed Case"}),n.jsxs("div",{className:"text-xs text-textMuted",children:["Lawyer: ",T.ownerName]})]}),n.jsx("td",{className:"p-2",children:n.jsx("span",{className:`px-2 py-1 rounded-full text-[10px] font-bold uppercase tracking-wide shadow-sm border ${At(T.status)}`,children:It(T.status)})}),n.jsxs("td",{className:"p-2 text-right font-bold",children:["",Mp(T).toLocaleString()]}),n.jsx("td",{className:"p-2 text-right",children:n.jsx("button",{onClick:()=>s(T.id),className:"text-lpBlue hover:underline text-xs font-bold",children:"Open"})})]},`expense-${T.id}`))]})]})})]}),!C&&le.length>0&&n.jsx("div",{className:"space-y-6 mb-8",children:le.map(T=>n.jsxs("div",{className:"bg-panel border rounded-2xl shadow-sm",children:[n.jsx("div",{className:"flex flex-wrap justify-between items-center gap-3 px-4 py-3 border-b",children:n.jsxs("div",{children:[n.jsx("h3",{className:"font-bold text-textLight",children:T.title}),n.jsx("p",{className:"text-sm text-textMuted",children:T.subtitle})]})}),T.items.length===0?n.jsx("div",{className:"p-6 text-center text-gray-400 text-sm",children:T.empty}):n.jsx("div",{className:"p-4 space-y-3",children:T.items.map(ve=>{var $e;if(T.id==="sent"){const Fe=ve,En=Fe.sentAt?new Date(Fe.sentAt).toLocaleDateString("he-IL"):"",mn=Fe.isLatest&&Fe.parent.status==="SENT"&&typeof h=="function",As=Fe.isLatest&&Fe.parent.status!=="SENT";return n.jsxs("div",{className:`border ${T.tone} rounded-xl p-4`,children:[n.jsxs("div",{className:"grid md:grid-cols-4 gap-4 text-sm text-textMuted",children:[n.jsxs("div",{children:[n.jsx("p",{className:"text-xs uppercase text-gray-400",children:" "}),n.jsx("p",{className:"font-bold text-textLight",children:Fe.parent.odakanitNo||""})]}),n.jsxs("div",{children:[n.jsx("p",{className:"text-xs uppercase text-gray-400",children:" "}),n.jsx("p",{className:"font-bold text-textLight",children:Fe.parent.insuredName||""})]}),n.jsxs("div",{children:[n.jsx("p",{className:"text-xs uppercase text-gray-400",children:Fe.parent.plaintiffTitle}),n.jsx("p",{className:"font-bold text-textLight",children:Fe.parent.plaintiffName||""})]}),n.jsxs("div",{children:[n.jsxs("p",{className:"text-xs uppercase text-gray-400",children:[" #",Fe.reportNumber]}),n.jsx("p",{className:"font-bold text-textLight",children:En})]})]}),n.jsxs("div",{className:"mt-2 text-sm text-textMuted space-y-1",children:[n.jsxs("p",{children:[n.jsx("span",{className:"font-semibold text-textLight",children:":"})," ",Fe.entry.subject||""]}),Fe.entry.fileName&&n.jsxs("p",{className:"text-xs text-textMuted",children:[" : ",Fe.entry.fileName]})]}),n.jsxs("div",{className:"mt-3 flex flex-wrap gap-2 justify-end",children:[mn&&h&&n.jsx("button",{onClick:()=>h(Fe.parent.id),className:"px-4 py-2 rounded-full bg-navy text-white text-sm font-semibold hover:bg-navySecondary",children:'" '}),As&&n.jsx("span",{className:"text-xs text-textMuted font-semibold px-3 py-1 rounded-full bg-navySecondary",children:'"  '})]})]},`${Fe.parent.id}-${Fe.entry.id}`)}const De=ve,Pe=typeof De.reportNumber=="number"&&De.reportNumber>0?De.reportNumber:((($e=De.reportHistory)==null?void 0:$e.length)||0)+1;return n.jsxs("div",{className:`border ${T.tone} rounded-xl p-4`,children:[n.jsxs("div",{className:"grid md:grid-cols-4 gap-4 text-sm text-textMuted",children:[n.jsxs("div",{children:[n.jsx("p",{className:"text-xs uppercase text-gray-400",children:" "}),n.jsx("p",{className:"font-bold text-textLight",children:De.odakanitNo||""})]}),n.jsxs("div",{children:[n.jsx("p",{className:"text-xs uppercase text-gray-400",children:" "}),n.jsx("p",{className:"font-bold text-textLight",children:De.plaintiffName||""})]}),n.jsxs("div",{children:[n.jsx("p",{className:"text-xs uppercase text-gray-400",children:" "}),n.jsx("p",{className:"font-bold text-textLight",children:De.insuredName||""})]}),n.jsxs("div",{children:[n.jsx("p",{className:"text-xs uppercase text-gray-400",children:" "}),n.jsxs("p",{className:"font-bold text-textLight",children:["#",Pe]})]})]}),T.id==="followup"&&n.jsx("div",{className:"mt-2 text-xs text-textMuted",children:(()=>{var mn;const Fe=(mn=De.reportHistory)==null?void 0:mn[De.reportHistory.length-1],En=Fe!=null&&Fe.date?new Date(Fe.date).toLocaleDateString("he-IL"):De.sentAt?new Date(De.sentAt).toLocaleDateString("he-IL"):"";return`"  : #${(Fe==null?void 0:Fe.reportNumber)||Pe-1}  ${En}`})()}),n.jsxs("div",{className:"mt-3 flex flex-wrap gap-2 justify-end",children:[T.id==="finance"&&jn(De)&&n.jsxs("button",{onClick:()=>Sr(De),className:"px-3 py-2 rounded-full border border-red-200 text-red-600 text-sm font-semibold flex items-center gap-1 hover:bg-red-50",title:"  ",children:[n.jsx(Ps,{className:"w-4 h-4"}),""]}),T.action&&n.jsx("button",{onClick:()=>T.action&&T.action(De),className:"px-4 py-2 rounded-full bg-navy text-white text-sm font-semibold hover:bg-navySecondary",children:T.actionLabel})]})]},De.id)})})]},T.id))}),C&&n.jsxs("div",{className:"mb-8",children:[n.jsx("div",{className:"flex justify-between items-end mb-4",children:n.jsxs("h3",{className:"text-lg font-bold text-textLight flex items-center",children:[n.jsx(th,{className:"w-6 h-6 mr-2 text-indigo-600"})," Active Case Folders"]})}),n.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[ne.length===0&&n.jsx("p",{className:"text-gray-400 italic col-span-3 text-center py-4",children:"No active finance folders."}),ne.map(T=>{var Pe;const ve=(()=>{switch(T.status){case"WAITING_FOR_INVOICES":return{badge:"bg-yellow-50 text-yellow-700",text:"Awaiting Finance Finalize",icon:n.jsx(Mt,{className:"text-yellow-500 w-5 h-5 animate-spin"})};case"TASK_ASSIGNED":return{badge:"bg-blue-50 text-blue-700",text:"Pending Lawyer Action",icon:n.jsx(Zx,{className:"text-blue-500 w-5 h-5"})};case"READY_TO_SEND":return{badge:"bg-orange-50 text-orange-700",text:"Waiting for Lior",icon:n.jsx(Mt,{className:"text-orange-500 w-5 h-5 animate-spin"})};case"SENT":return{badge:"bg-green-50 text-green-700",text:"Completed",icon:n.jsx(eh,{className:"text-green-500 w-6 h-6"})};default:return{badge:"bg-navySecondary text-textMuted",text:T.status,icon:n.jsx(Mt,{className:"text-gray-400 w-5 h-5 animate-spin"})}}})(),De=(Pe=hs.find($e=>$e.id===T.createdBy))==null?void 0:Pe.name;return n.jsxs("div",{className:"bg-panel p-4 rounded-lg shadow border-t-4 relative border-indigo-100",children:[n.jsxs("div",{className:"flex justify-between items-start mb-2",children:[n.jsxs("h4",{className:"font-bold text-lg",children:["Case #",T.odakanitNo]}),ve.icon]}),n.jsxs("div",{className:"text-sm text-textMuted mb-1 flex items-center",children:[n.jsx(D0,{className:"w-4 h-4 mr-1"})," Assigned to: ",De]}),n.jsx("div",{className:"text-xs text-textMuted mb-4",children:new Date(T.reportDate).toLocaleDateString()}),n.jsx("div",{className:"flex justify-end gap-2 mt-2",children:T.status==="SENT"?n.jsxs("button",{onClick:()=>l(T.id),className:"text-red-500 hover:bg-red-50 px-3 py-1 rounded text-sm flex items-center",children:[n.jsx(Ps,{className:"w-4 h-4 mr-1"})," Delete Folder"]}):n.jsx("span",{className:`text-xs font-bold px-2 py-1 rounded ${ve.badge}`,children:ve.text})})]},T.id)})]})]}),(C||Ye)&&n.jsxs("div",{className:"bg-panel rounded-xl shadow-sm border border-borderDark overflow-hidden",children:[n.jsxs("div",{className:"p-4 border-b border-gray-100 bg-navySecondary/50 flex flex-wrap gap-3 items-center justify-between",children:[n.jsxs("h3",{className:"font-bold text-textLight flex items-center",children:[n.jsx(nh,{className:"w-4 h-4 mr-2 text-gray-400"})," ",ie?"Recycle Bin":"All Reports"]}),n.jsxs("div",{className:"flex items-center gap-3 flex-wrap justify-end",children:[ie&&lt&&n.jsx("span",{className:"text-xs text-textMuted",children:lt}),n.jsxs("div",{className:"relative w-full sm:w-72",children:[n.jsx(I0,{className:"w-4 h-4 text-gray-400 absolute left-3 top-1/2 -translate-y-1/2"}),n.jsx("input",{value:Ue,onChange:T=>Ze(T.target.value),placeholder:"     ",className:"w-full border border-borderDark rounded-full pl-9 pr-10 py-1.5 text-sm focus:ring-2 focus:ring-blue-200 outline-none"}),Ue&&n.jsx("button",{onClick:()=>Ze(""),className:"absolute right-3 top-1/2 -translate-y-1/2 text-gray-400 hover:text-red-500",children:n.jsx(_t,{className:"w-4 h-4"})})]})]})]}),Ye?n.jsxs("table",{className:"w-full text-left",children:[n.jsx("thead",{className:"bg-navySecondary text-textMuted text-xs uppercase tracking-wider font-semibold",children:n.jsxs("tr",{children:[n.jsx("th",{className:"p-4",children:"Insurer / Subject"}),C&&n.jsx("th",{className:"p-4",children:"Lawyer"}),n.jsx("th",{className:"p-4",children:"Status"}),n.jsx("th",{className:"p-4 text-right",children:"Action"})]})}),n.jsxs("tbody",{className:"divide-y divide-gray-100",children:[Gn.length===0&&n.jsx("tr",{children:n.jsx("td",{colSpan:C?4:3,className:"p-6 text-center text-gray-400 text-sm",children:Sn?"    .":"  ."})}),Gn.map(T=>{const ve=T.status==="READY_TO_SEND",De=T.status==="SENT",Pe=!!T.__templateKey;return n.jsxs("tr",{className:`transition cursor-default ${ve?"bg-red-50":De?"bg-green-50/50":"hover:bg-blue-50/30"}`,children:[n.jsxs("td",{className:"p-4",children:[n.jsx("div",{className:"font-bold text-textLight",children:T.insurerName||"Untitled"}),n.jsxs("div",{className:"text-xs text-textMuted",children:[T.marketRef," ",T.insuredName?` - ${T.insuredName}`:""]})]}),C&&n.jsx("td",{className:"p-4 text-sm text-textMuted font-medium",children:T.ownerName}),n.jsx("td",{className:"p-4",children:n.jsx("span",{className:`px-2.5 py-1 rounded-full text-[10px] font-bold uppercase tracking-wide shadow-sm border ${At(T.status)}`,children:It(T.status)})}),n.jsx("td",{className:"p-4 text-right",children:n.jsxs("div",{className:"flex justify-end gap-2 flex-wrap",children:[n.jsxs(n.Fragment,{children:[n.jsxs("button",{onClick:()=>W(T.id),className:"text-xs bg-navySecondary hover:bg-borderDark px-3 py-1.5 rounded flex items-center gap-1",children:[n.jsx(ah,{className:"w-3 h-3"})," View Expenses"]}),n.jsxs("button",{onClick:()=>N(T),className:"text-xs bg-blue-50 text-blue-700 hover:bg-blue-100 px-3 py-1.5 rounded flex items-center gap-1",children:[n.jsx(Gl,{className:"w-3 h-3"})," Reminder"]}),n.jsxs("button",{onClick:()=>x(T),className:"text-xs bg-purple-50 text-purple-700 hover:bg-purple-100 px-3 py-1.5 rounded flex items-center gap-1",children:[n.jsx(ku,{className:"w-3 h-3"})," Add Note"]})]}),ee&&!qe&&!ie&&n.jsxs("button",{onClick:()=>!Pe&&b(T.id),disabled:Pe,className:`text-xs px-3 py-1.5 rounded flex items-center gap-1 ${Pe?"bg-navySecondary text-gray-400 cursor-not-allowed":"bg-red-50 text-red-700 hover:bg-red-100"}`,children:[n.jsx(Ps,{className:"w-3 h-3"})," Delete"]}),ie&&n.jsxs(n.Fragment,{children:[qe&&n.jsx("button",{onClick:()=>o(T.id,{sentAt:new Date().toISOString()}),className:"text-green-600 hover:bg-green-50 px-3 py-1.5 rounded text-sm font-bold",children:"Restore"}),!qe&&ee&&n.jsx("button",{onClick:()=>B(T.id),className:"text-green-600 hover:bg-green-50 px-3 py-1.5 rounded text-sm font-bold",children:"Restore"})]})]})})]},T.id)})]})]}):n.jsx("div",{children:wn.length===0?n.jsx("div",{className:"p-6 text-center text-gray-400 text-sm",children:Sn?"    .":"  ."}):n.jsx("div",{className:"divide-y divide-gray-100",children:wn.map(T=>{const ve=T.latestDate?new Date(T.latestDate).toLocaleDateString("he-IL"):"-",De=[...T.reports].sort((Pe,$e)=>{const Fe=Pe.reportDate?new Date(Pe.reportDate).getTime():0;return($e.reportDate?new Date($e.reportDate).getTime():0)-Fe});return n.jsxs("div",{className:"p-4",children:[n.jsxs("div",{className:"flex flex-wrap justify-between gap-3",children:[n.jsxs("div",{children:[n.jsx("p",{className:"text-xs uppercase text-gray-400",children:" "}),n.jsx("p",{className:"text-xl font-bold text-textLight",children:T.odakanitNo||""}),n.jsxs("p",{className:"text-xs text-textMuted",children:[" : ",n.jsx("span",{className:"font-semibold",children:T.plaintiffName||""}),"   : ",n.jsx("span",{className:"font-semibold",children:T.insuredName||""})]}),n.jsxs("p",{className:"text-xs text-gray-400",children:[" : ",ve]})]}),n.jsxs("div",{className:"text-right",children:[n.jsx("p",{className:"text-xs text-textMuted",children:'" '}),n.jsx("p",{className:"text-2xl font-bold text-textLight",children:T.reports.length}),n.jsx("button",{onClick:()=>rt(Pe=>Pe===T.key?null:T.key),className:"mt-2 px-4 py-1.5 text-sm font-semibold rounded-full border border-borderDark text-textLight hover:bg-navySecondary",children:ze===T.key?" ":" "})]})]}),ze===T.key&&n.jsx("div",{className:"mt-4 bg-navySecondary border border-borderDark rounded-xl overflow-hidden",children:n.jsxs("table",{className:"w-full text-sm",children:[n.jsx("thead",{className:"bg-navySecondary text-textMuted text-xs uppercase tracking-wide",children:n.jsxs("tr",{children:[n.jsx("th",{className:"p-3 text-left",children:" "}),n.jsx("th",{className:"p-3 text-left",children:" "}),n.jsx("th",{className:"p-3 text-left",children:" "}),n.jsx("th",{className:"p-3 text-left",children:""}),n.jsx("th",{className:"p-3 text-right",children:""})]})}),n.jsx("tbody",{className:"divide-y divide-gray-200",children:De.map(Pe=>{const $e=Pe.status==="READY_TO_SEND",Fe=Pe.status==="SENT",En=!!Pe.__templateKey;return n.jsxs("tr",{className:`bg-panel ${$e?"bg-red-50":Fe?"bg-green-50/60":""}`,children:[n.jsx("td",{className:"p-3",children:Pe.reportDate?new Date(Pe.reportDate).toLocaleDateString("he-IL"):""}),n.jsx("td",{className:"p-3",children:Pe.plaintiffName||""}),n.jsx("td",{className:"p-3",children:Pe.insuredName||""}),n.jsx("td",{className:"p-3",children:n.jsx("span",{className:`px-2.5 py-1 rounded-full text-[10px] font-bold uppercase tracking-wide shadow-sm border ${At(Pe.status)}`,children:It(Pe.status)})}),n.jsx("td",{className:"p-3 text-right",children:n.jsxs("div",{className:"flex justify-end gap-2 flex-wrap",children:[n.jsxs("button",{onClick:()=>s(Pe.id),className:"text-lpBlue hover:bg-blue-50 px-3 py-1.5 rounded transition font-bold text-xs flex items-center",children:["Open ",n.jsx(es,{className:"w-3 h-3 ml-1"})]}),ee&&!qe&&!ie&&n.jsxs("button",{onClick:()=>!En&&b(Pe.id),disabled:En,className:`text-xs px-3 py-1.5 rounded flex items-center gap-1 ${En?"bg-navySecondary text-gray-400 cursor-not-allowed":"bg-red-50 text-red-700 hover:bg-red-100"}`,children:[n.jsx(Ps,{className:"w-3 h-3"})," Delete"]}),ie&&n.jsxs(n.Fragment,{children:[qe&&n.jsx("button",{onClick:()=>o(Pe.id,{sentAt:new Date().toISOString()}),className:"text-green-600 hover:bg-green-50 px-3 py-1.5 rounded text-xs font-bold",children:"Restore"}),!qe&&ee&&n.jsx("button",{onClick:()=>B(Pe.id),className:"text-green-600 hover:bg-green-50 px-3 py-1.5 rounded text-xs font-bold",children:"Restore"})]})]})})]},Pe.id)})})]})})]},T.key)})})})]}),!C&&n.jsx("div",{className:"fixed bottom-8 right-8",children:n.jsx("button",{onClick:r,className:"bg-navy text-white p-4 rounded-full shadow-xl hover:bg-navySecondary transition transform hover:scale-110",children:n.jsx(S0,{className:"w-6 h-6"})})})]})]})},Av=({onLogin:e})=>{const[t,s]=y.useState(""),[r,a]=y.useState(""),[o,l]=y.useState(!1),i=async()=>{if(!t||!r){alert("    .");return}l(!0);try{const c=await fetch("/api/login",{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({username:t,password:r})});if(!c.ok){const p=await c.json().catch(()=>({})),h=(p==null?void 0:p.error)||"    .";alert(h);return}const m=await c.json();m&&m.user?e(m.user):alert("Login response was invalid.")}catch(c){console.error("Login failed",c),alert("  (  ?).  .")}finally{l(!1)}};return n.jsx("div",{className:"min-h-screen flex items-center justify-center px-4 bg-bgDark",children:n.jsxs("div",{className:"w-full max-w-sm bg-panel border border-borderDark rounded-2xl p-10 text-center shadow-2xl",children:[n.jsx("div",{className:"mx-auto mb-6 h-20 w-20 rounded-full bg-gold/20 border border-gold flex items-center justify-center text-4xl font-bold text-gold shadow-lg",children:"LP"}),n.jsx("div",{className:"text-sm tracking-[0.5em] text-gold uppercase mb-2",children:"Lloyd's"}),n.jsx("div",{className:"text-3xl font-serif text-textLight mb-1",children:"REPORT"}),n.jsx("div",{className:"text-xs text-textMuted uppercase tracking-[0.4em] mb-8",children:"Builder System"}),n.jsxs("div",{className:"space-y-4 text-left",children:[n.jsx("label",{className:"text-xs uppercase text-textMuted tracking-[0.2em]",children:"Username"}),n.jsxs("div",{className:"relative",children:[n.jsx(L0,{className:"w-4 h-4 text-gold absolute left-3 top-1/2 -translate-y-1/2"}),n.jsx("input",{className:"w-full bg-navy border border-borderDark rounded-full py-3 pl-10 pr-4 text-textLight placeholder-textMuted focus:outline-none focus:ring-2 focus:ring-gold/50",placeholder:"Username",value:t,onChange:c=>s(c.target.value)})]}),n.jsx("label",{className:"text-xs uppercase text-textMuted tracking-[0.2em]",children:"Password"}),n.jsxs("div",{className:"relative",children:[n.jsx(E0,{className:"w-4 h-4 text-gold absolute left-3 top-1/2 -translate-y-1/2"}),n.jsx("input",{type:"password",className:"w-full bg-navy border border-borderDark rounded-full py-3 pl-10 pr-4 text-textLight placeholder-textMuted focus:outline-none focus:ring-2 focus:ring-gold/50",placeholder:"Password",value:r,onChange:c=>a(c.target.value)})]})]}),n.jsxs("button",{onClick:i,disabled:o,className:"mt-8 w-full bg-navy text-gold border border-gold py-3 rounded-full font-semibold tracking-wide flex items-center justify-center gap-2 hover:bg-navySecondary transition-colors disabled:opacity-60 disabled:cursor-not-allowed",children:[o?"Signing in":"Sign In"," ",n.jsx(Zx,{className:"w-4 h-4"})]}),n.jsx("div",{className:"mt-6 text-[11px] text-textMuted tracking-[0.3em] uppercase",children:"Lior Perry Law Office & Notary  2024"})]})})},Iv=()=>{var ga,Fo;const[e,t]=y.useState(null),[s,r]=y.useState(()=>yv()),[a,o]=y.useState(()=>gv()),[l,i]=y.useState(null),[c,m]=y.useState(null);console.log("AppInner render",{currentUser:e,view:s,reportsCount:a.length});const p=y.useRef(!1),[h,v]=y.useState(null),[A,D]=y.useState([]),[I,W]=y.useState(!1);e==null||e.role;const[N,x]=y.useState(()=>{if(typeof window>"u")return[];try{const u=window.localStorage.getItem(pt.NOTIFICATIONS),f=u?JSON.parse(u):[];return Array.isArray(f)?f.filter(S=>S&&typeof S.id=="string"&&typeof S.message=="string"&&typeof S.createdAt=="string"):[]}catch{return[]}}),[b,B]=y.useState(!1),[H,z]=y.useState(!1),[Y,Q]=y.useState([]),[G,ae]=y.useState(null),[E,R]=y.useState(()=>{if(typeof window>"u")return{};try{const u=localStorage.getItem("favoriteProviders");return u?JSON.parse(u):{}}catch(u){return console.error("Failed to load favorite providers",u),{}}});y.useEffect(()=>{if(!(typeof window>"u"))try{window.localStorage.setItem(pt.NOTIFICATIONS,JSON.stringify(N))}catch{}},[N]);const[k,C]=y.useState(null),[ee,V]=y.useState(""),[_,P]=y.useState(null),[X,ie]=y.useState(""),[fe,se]=y.useState("LAWYER"),[ue,we]=y.useState(!1),[He,Ue]=y.useState(!1),[Ze,ze]=y.useState(!1),[rt,qe]=y.useState(!1),[j,$]=y.useState(!1),[J,pe]=y.useState(!1),[me,he]=y.useState(!1),[je,Be]=y.useState(!1),[Ve,tt]=y.useState(!1),[Ke,ot]=y.useState(null),[Z,be]=y.useState(null),[M,K]=y.useState(()=>{if(typeof window>"u")return[];try{const u=localStorage.getItem("caseTemplates");return u?JSON.parse(u):[]}catch(u){return console.error("Failed to load case templates",u),[]}}),[oe,le]=y.useState(null),[ne,xe]=y.useState(""),[Ie,Ee]=y.useState(!1),[Me,Ye]=y.useState(null),[ht,lt]=y.useState(void 0);y.useEffect(()=>{if(!l&&c!==null){m(null);return}l&&c&&l.id!==c&&m(null)},[l,c]),y.useEffect(()=>{typeof window>"u"||Yb()||a.length&&Ct(u=>{const f=Tc(u,a);return In(f),Kb(),f})},[a]);const[Ne,Ct]=y.useState(()=>{const u=zb(),f=Vb(u);return f!==u&&In(f),f});y.useEffect(()=>{s!=="PREVIEW"&&W(!1)},[s]);const Es=u=>u?u==="SUB_ADMIN"?"OPS":u==="FINANCE"||u==="LAWYER"||u==="ADMIN"?u:"LAWYER":"LAWYER",os=u=>u.deletedAt?Date.now()-new Date(u.deletedAt).getTime()>=_h:u.status==="SENT"&&u.sentAt?Date.now()-new Date(u.sentAt).getTime()>=Lh:!1;y.useEffect(()=>{const u=()=>{o(S=>S.filter(L=>!os(L)))};u();const f=setInterval(u,60*60*1e3);return()=>clearInterval(f)},[]),y.useEffect(()=>{if(!H)return;const u=setInterval(()=>{if(!a.length)return;const f=a.filter(O=>O.status==="READY_TO_SEND").length,S=a.filter(O=>O.status==="SENT").length,L=`Daily summary: ${f} ready to send, ${S} sent reports.`;x(O=>[{id:`daily-${Date.now()}`,message:L,createdAt:new Date().toISOString(),severity:"info"},...O])},1e3*60*60*12);return()=>clearInterval(u)},[H,a]),y.useEffect(()=>{try{localStorage.setItem("caseTemplates",JSON.stringify(M))}catch(u){console.error("Failed to persist case templates",u)}},[M]),y.useEffect(()=>{try{localStorage.setItem("favoriteProviders",JSON.stringify(E))}catch(u){console.error("Failed to persist favorites",u)}},[E]);const At=async u=>{if(!e||!l){Be(!0),ot(null),be({title:"   ",bullets:["           .","  ,         .","  ,          ."]});return}const f=s==="STEP2"?2:s==="PREVIEW"?3:1,S=s==="STEP1"?"Step1":s==="STEP2"?"Step2Draft":s==="PREVIEW"?"Step3Preview":"Dashboard",L={step:f,role:Es(e.role),screen:S,section:f===2&&ht?ht:void 0},O={hebrewApproved:l.hebrewWorkflowStatus==="HEBREW_APPROVED",hasTranslation:!!l.isTranslated,translationOutdated:!!l.translationStale,toneRiskRun:!!l.toneRiskLastRunAt,expensesLastUpdatedAt:l.expensesSnapshotAt||void 0};Be(!0),tt(!0),ot(null);try{const U=await V0({intent:u,context:L,reportMeta:O});be(U)}catch(U){console.error("Smart assistant request failed",U),ot("REQUEST_FAILED"),be(null)}finally{tt(!1)}},It=(u,f)=>{if(!u||!f)return[];const S=[];u.translationStale&&S.push({id:"translation-outdated",kind:"TRANSLATION_OUTDATED",label:"       (translationStale=true).     .",intent:"pre_send_checks"});const L=f.role;return(L==="LAWYER"||L==="ADMIN")&&!u.toneRiskLastRunAt&&S.push({id:"tone-risk-not-run",kind:"TONE_RISK_NOT_RUN",label:"   Tone & Risk  .       .",intent:"explain_tone_risk"}),S};y.useEffect(()=>{let u=!1;return(async()=>{var U;if(typeof window>"u")return;const S=a.filter(d=>!!d.expensesSheetId&&!d.expensesHtml&&!d.expensesHtmlMissing);if(!S.length)return;let L=!1;const O=[...a];for(const d of S)try{const g=await Je.getSheet(d.expensesSheetId);if(g&&g.sheet&&((U=g.lineItems)!=null&&U.length)){const w=Je.buildCumulativeExpensesSnapshot(g.sheet.id,new Date().toISOString());if(!w)continue;const{effectiveSheet:F,allLines:q,opts:re}=w,{html:ge}=ti(F,q,re);if(ge){const Te=O.findIndex(Ce=>Ce.id===d.id);Te!==-1&&(O[Te]={...O[Te],expensesHtml:ge},L=!0)}}else{const w=O.findIndex(F=>F.id===d.id);w!==-1&&(O[w]={...O[w],expensesHtmlMissing:!0},L=!0)}}catch(g){console.error("Failed to migrate expensesHtml for report",d.id,g);const w=O.findIndex(F=>F.id===d.id);w!==-1&&(O[w]={...O[w],expensesHtmlMissing:!0},L=!0)}!u&&L&&o(O)})(),()=>{u=!0}},[a]),y.useEffect(()=>{if(!(typeof window>"u"))try{localStorage.setItem(pt.REPORTS,JSON.stringify(a))}catch(u){console.error("Failed to persist reports",u)}},[a]),y.useEffect(()=>{typeof window>"u"||(e?localStorage.setItem(pt.USER,e.username):localStorage.removeItem(pt.USER))},[e]),y.useEffect(()=>{typeof window>"u"||localStorage.setItem(pt.VIEW,s)},[s]),y.useEffect(()=>{typeof window>"u"||(l?localStorage.setItem(pt.CURRENT_REPORT,l.id):localStorage.removeItem(pt.CURRENT_REPORT))},[l]),y.useEffect(()=>{if(typeof window>"u"||p.current)return;const u=localStorage.getItem(pt.CURRENT_REPORT);if(!u){p.current=!0;return}const f=a.find(S=>S.id===u);if(f){const S=!!(f.expensesSheetId||f.expensesHtml);let L=f;if(S&&Array.isArray(f.selectedSections)&&!f.selectedSections.some(O=>qr(O))){const O=[...f.selectedSections],U=O.includes("Update"),d=O.includes("Recommendations"),g=U?Math.min(O.indexOf("Update")+1,d?O.indexOf("Recommendations"):O.length):0;O.splice(g,0,Ka),L={...f,selectedSections:Array.from(new Set(O))}}i(L)}p.current=!0},[a,e]),y.useEffect(()=>{s==="DASHBOARD"||s==="CASE_FOLDER"||l||(r("DASHBOARD"),typeof window<"u"&&(localStorage.setItem(pt.VIEW,"DASHBOARD"),localStorage.removeItem(pt.CURRENT_REPORT)))},[l,s]);const un=()=>({id:Date.now().toString(),createdBy:e.id,ownerName:e.name,ownerEmail:e.email,reportNumber:1,reportDate:new Date().toISOString(),updatedAt:new Date().toISOString(),status:"DRAFT",reportSubject:"",recipientId:"1",insurerName:"",lineSlipNo:"",marketRef:"",certificateRef:"",insuredName:"",plaintiffName:"",plaintiffTitle:"Plaintiff",policyPeriodStart:"",policyPeriodEnd:"",retroStart:"",retroEnd:"",sentAt:void 0,reportHistory:[],selectedTimeline:"standard",filenameTag:ih[0],selectedSections:["Update","Recommendations"],content:{},translatedContent:{},invoiceFiles:[],isWaitingForInvoices:!1,requiresExpenses:!1,isTranslated:!1,expensesItems:[],expenseWorksheet:_s(),reportNotes:[],complaintAnalysis:void 0,attachPolicyAsAppendix:!0}),ls=({odakanitNo:u,reports:f,caseFolder:S})=>{var d;const L=Se(u);if(!L)return 1;const O=[];return(d=S==null?void 0:S.sentReports)!=null&&d.length&&S.sentReports.forEach(g=>{typeof g.reportNo=="number"&&g.reportNo>0&&O.push(g.reportNo)}),f.forEach(g=>{var w;if(Se(g.odakanitNo)===L&&g.status==="SENT")if(typeof g.reportNumber=="number"&&g.reportNumber>0)O.push(g.reportNumber);else{const F=(((w=g.reportHistory)==null?void 0:w.length)||0)+1;O.push(F)}}),(O.length?Math.max(...O):0)+1},ct=u=>{const f=u.createdBy||"unknown",S=u.odakanitNo||u.marketRef||u.id,L=(u.plaintiffName||"unknown").toLowerCase();return`${f}::${S}::${L}`},Fn=u=>{const f=ct(u),S={caseKey:f,ownerId:u.createdBy,ownerName:u.ownerName,odakanitNo:u.odakanitNo,plaintiffName:u.plaintiffName,plaintiffTitle:u.plaintiffTitle,insurerName:u.insurerName,lineSlipNo:u.lineSlipNo,marketRef:u.marketRef,certificateRef:u.certificateRef,insuredName:u.insuredName,policyPeriodStart:u.policyPeriodStart,policyPeriodEnd:u.policyPeriodEnd,retroStart:u.retroStart,retroEnd:u.retroEnd,lastUpdated:new Date().toISOString()};K(L=>L.find(U=>U.caseKey===f)?L.map(U=>U.caseKey===f?S:U):[...L,S])},er=u=>{if(!e)return;const f=M.find(L=>L.caseKey===u&&L.ownerId===e.id);if(!f)return;const S={...un(),odakanitNo:f.odakanitNo||"",insurerName:f.insurerName||"",lineSlipNo:f.lineSlipNo||"",marketRef:f.marketRef||"",certificateRef:f.certificateRef||"",insuredName:f.insuredName||"",plaintiffName:f.plaintiffName||"",plaintiffTitle:f.plaintiffTitle||"Plaintiff",policyPeriodStart:f.policyPeriodStart||"",policyPeriodEnd:f.policyPeriodEnd||"",retroStart:f.retroStart||"",retroEnd:f.retroEnd||""};i(S),r("STEP1")},tr=u=>{var F;if(!e)return;const f=ks(u);if(!f||f.createdBy!==e.id||(((F=f.reportHistory)==null?void 0:F.length)||0)===0||f.status!=="SENT")return;const S=f.reportHistory[f.reportHistory.length-1];if(!S)return;const O=S.snapshot||f,U=O.selectedSections&&O.selectedSections.length?[...O.selectedSections]:[...f.selectedSections||[]],d=U.length?U:["Update","Recommendations"],g=new Date().toISOString(),w={...f,reportDate:g,updatedAt:g,status:"DRAFT",sentAt:void 0,reportNotes:[],content:{},translatedContent:{},executiveSummary:void 0,complaintAnalysis:void 0,expensesItems:[],expensesSum:void 0,paymentRecommendation:void 0,expenseWorksheet:_s(),invoiceFiles:[],expensesSourceFile:void 0,requiresExpenses:!1,isWaitingForInvoices:!1,isTranslated:!1,selectedEmailTemplate:void 0,emailBodyDraft:void 0,fileNameTitles:[],deletedAt:void 0,deletedBy:void 0,selectedSections:d,reportHistory:[...f.reportHistory||[]]};w.insurerName=O.insurerName||"",w.lineSlipNo=O.lineSlipNo||"",w.marketRef=O.marketRef||"",w.certificateRef=O.certificateRef||"",w.insuredName=O.insuredName||"",w.plaintiffName=O.plaintiffName||"",w.plaintiffTitle=O.plaintiffTitle||f.plaintiffTitle,w.policyPeriodStart=O.policyPeriodStart||"",w.policyPeriodEnd=O.policyPeriodEnd||"",w.retroStart=O.retroStart||"",w.retroEnd=O.retroEnd||"",w.filenameTag=O.filenameTag||w.filenameTag,w.fileNameTitles=[],w.selectedTimeline=O.selectedTimeline||w.selectedTimeline,w.selectedTimelineImage=O.selectedTimelineImage,w.odakanitNo=O.odakanitNo||f.odakanitNo,w.recipientId=O.recipientId||f.recipientId,o(q=>q.map(re=>re.id===f.id?w:re)),i(w),Fn(w),r("STEP1")},ks=u=>a.find(f=>f.id===u),Sn=(u,f)=>{if(u.status!==f.status||u.hebrewWorkflowStatus!==f.hebrewWorkflowStatus||u.insuredName!==f.insuredName||u.plaintiffName!==f.plaintiffName||u.insurerName!==f.insurerName||u.odakanitNo!==f.odakanitNo||u.marketRef!==f.marketRef||u.lineSlipNo!==f.lineSlipNo||u.certificateRef!==f.certificateRef||u.policyPeriodStart!==f.policyPeriodStart||u.policyPeriodEnd!==f.policyPeriodEnd||u.retroStart!==f.retroStart||u.retroEnd!==f.retroEnd||u.reportSubject!==f.reportSubject||u.executiveSummary!==f.executiveSummary)return!0;const S=(L,O)=>JSON.stringify(L)===JSON.stringify(O);return!S(u.content,f.content)||!S(u.translatedContent,f.translatedContent)||!S(u.expenseWorksheet,f.expenseWorksheet)||!S(u.expensesItems,f.expensesItems)||u.expensesSum!==f.expensesSum||u.paymentRecommendation!==f.paymentRecommendation||!S(u.complaintAnalysis,f.complaintAnalysis)||!S(u.reportReview,f.reportReview)},Bn=(u,f)=>{u.odakanitNo&&Ct(S=>{const L=Id(S,u,f);return In(L),L})},Gn=(u,f,S,L)=>{u.odakanitNo&&Ct(O=>{const U=Ch(O,u,f,S,L);return In(U),U})},wn=u=>{var S;return(S=u==null?void 0:u.sentReports)!=null&&S.length?u.sentReports.map((L,O)=>{var w,F;const U=typeof L.reportNo=="number"&&L.reportNo>0?L.reportNo:O+1,d=L.sentAt||((w=L.snapshot)==null?void 0:w.reportDate)||"",g=((F=L.snapshot)==null?void 0:F.reportSubject)||L.fileName||"";return!g||!d?null:{id:L.reportId,reportNumber:U,subject:g,date:d,sent:!0,fileName:L.fileName,snapshot:L.snapshot}}).filter(L=>!!L).sort((L,O)=>L.reportNumber-O.reportNumber):[]},jn=(u,f)=>{const S=u.reportReview??{status:"DRAFT",issues:[]};return{...u,reportReview:f(S)}},Sr=u=>{Fe(u,f=>{const S=(e==null?void 0:e.id)||"unknown",L=new Date().toISOString();return{...jn(f,U=>({...U,status:"SUBMITTED",submittedAt:L,submittedByUserId:U.submittedByUserId||S})),hebrewWorkflowStatus:"HEBREW_SUBMITTED"}})},T=u=>{(e==null?void 0:e.role)==="ADMIN"&&Fe(u,f=>{const S=(e==null?void 0:e.id)||"unknown",L=new Date().toISOString();return{...jn(f,U=>({...U,status:"APPROVED",reviewedAt:L,reviewedByUserId:S})),hebrewWorkflowStatus:"HEBREW_APPROVED"}})},ve=(u,f)=>{f.length&&Fe(u,S=>{const L=(e==null?void 0:e.id)||"unknown",O=new Date().toISOString();return{...jn(S,d=>({...d,status:"CHANGES_REQUESTED",reviewedAt:O,reviewedByUserId:L,issues:[...d.issues,...f.map(g=>({id:`issue-${Date.now()}-${Math.random().toString(36).slice(2)}`,createdAt:O,createdByUserId:L,sectionKey:g.sectionKey,severity:g.severity,type:g.type,title:g.title,instruction:g.instruction,status:"OPEN"}))]})),hebrewWorkflowStatus:"HEBREW_CHANGES_REQUESTED"}})},De=(u,f)=>{Fe(u,S=>{const L=new Date().toISOString();return jn(S,O=>({...O,issues:O.issues.map(U=>U.id===f&&U.status!=="DONE"?{...U,status:"DONE",doneAt:L}:U)}))})},Pe=u=>{(e==null?void 0:e.role)==="ADMIN"&&Fe(u,f=>{const S=new Date().toISOString();return jn(f,L=>({...L,issues:L.issues.map(O=>(O.origin??"INTERNAL")==="EXTERNAL"&&O.status!=="DONE"?{...O,status:"DONE",doneAt:S}:O)}))})},$e=u=>{var S;return u?((S=u.reportReview)==null?void 0:S.status)==="APPROVED"||u.hebrewWorkflowStatus==="HEBREW_APPROVED":!1},Fe=(u,f)=>{const S=new Date().toISOString();let L=null,O=null;if(o(U=>U.map(d=>{var te;if(d.id!==u)return d;const g=Se(d.odakanitNo),w=g&&Ne?Ne[g]:void 0,F=ut(d,w||void 0),q=!!(w!=null&&w.closedAt),re=(e==null?void 0:e.role)==="ADMIN"&&c===d.id&&!q;if((e==null?void 0:e.role)==="LAWYER"&&d.status==="SENT"&&!re)return dl({reason:"LAWYER_SENT_BLOCK",reportId:d.id,odakanitNo:d.odakanitNo,role:e==null?void 0:e.role,status:d.status,lockType:F.lockType}),d;if(!re&&F.isLocked)return dl({reason:Ne&&((te=Ne[g])!=null&&te.closedAt)?"CASE_CLOSED_BLOCK":"LOCKSTATE_BLOCK",reportId:d.id,odakanitNo:d.odakanitNo,role:e==null?void 0:e.role,status:d.status,lockType:F.lockType}),d;const Te=f(d);return L=d,O=Te,Sn(d,Te)?{...Te,updatedAt:S}:Te})),L&&O&&L.odakanitNo&&O.odakanitNo){const U=L.odakanitNo.trim(),d=O.odakanitNo.trim();U&&d&&U!==d&&Ct(g=>{let w={...g};const F=w[U];if(F){const q=F.reportIds.filter(re=>re!==O.id);w[U]={...F,reportIds:q}}return w=Id(w,O,S),In(w),w})}i(U=>{if(!U||U.id!==u)return U;const d=f(U);return Sn(U,d)?{...d,updatedAt:S}:d})},En=(u,f,S)=>{f.length&&(e==null?void 0:e.role)==="ADMIN"&&Fe(u,L=>{const O=(e==null?void 0:e.id)||"unknown",U=new Date().toISOString();return{...jn(L,g=>({...g,status:"CHANGES_REQUESTED",reviewedAt:U,reviewedByUserId:O,issues:[...g.issues,...f.map(w=>({id:`issue-${Date.now()}-${Math.random().toString(36).slice(2)}`,createdAt:U,createdByUserId:O,sectionKey:w.sectionKey,severity:w.severity,type:w.type,title:w.title,instruction:w.instruction,status:"OPEN",origin:"EXTERNAL",externalRefId:S,externalAction:w.externalAction??"ENGLISH_ONLY"}))]})),postSendFeedbackMeta:{...L.postSendFeedbackMeta||{},lastFeedbackAt:U}}})},mn=u=>{(e==null?void 0:e.role)==="ADMIN"&&Fe(u,f=>{const S=new Date().toISOString(),L=f.reportReview??{status:"DRAFT",issues:[]};return{...f,hebrewWorkflowStatus:"HEBREW_REOPENED_EXTERNAL",reportReview:{...L,status:L.status==="CHANGES_REQUESTED"?L.status:"CHANGES_REQUESTED"},postSendFeedbackMeta:{...f.postSendFeedbackMeta||{},reopenedDueToFeedbackAt:S}}})},As=u=>{x(f=>[u,...f])},kn=u=>{Q(f=>f.some(S=>S.reportId===u)?f:[...f,{reportId:u}]),ae(u)},ma=u=>{Q(f=>f.filter(S=>S.reportId!==u)),ae(f=>f===u?null:f)},Ao=(u,f)=>{R(S=>{const L=S[u]||[];return L.some(O=>O.serviceProvider.toLowerCase()===f.serviceProvider.toLowerCase()&&O.category===f.category)?S:{...S,[u]:[f,...L]}})},Io=(u,f)=>{R(S=>{const L=S[u]||[];return{...S,[u]:L.filter(O=>O.id!==f)}})},$t=u=>{var f;if(l){const S=Se(l.odakanitNo),L=S&&Ne?Ne[S]:void 0,O=ut(l,L||void 0),U=!!(L!=null&&L.closedAt),d=(e==null?void 0:e.role)==="ADMIN"&&c===l.id&&!U;if((e==null?void 0:e.role)==="LAWYER"&&l.status==="SENT"&&!d){dl({reason:"LAWYER_SENT_BLOCK",reportId:l.id,odakanitNo:l.odakanitNo,role:e==null?void 0:e.role,status:l.status,lockType:O.lockType});return}if(!d&&O.isLocked){dl({reason:Ne&&S&&((f=Ne[S])!=null&&f.closedAt)?"CASE_CLOSED_BLOCK":"LOCKSTATE_BLOCK",reportId:l.id,odakanitNo:l.odakanitNo,role:e==null?void 0:e.role,status:l.status,lockType:O.lockType});return}const w=l;let F={...l,...u};if(w.translationBaseHash&&u.content){const re=w.translationBaseHash,ge=Bp(u.content);ge&&ge!==re&&(F={...F,translationStale:!0})}w.updateAutoSummarySourceReportId&&u.content&&u.content.Update!==void 0&&(F={...F,updateAutoSummaryEdited:!0});const q=Sn(w,F);i(q?{...F,updatedAt:new Date().toISOString()}:F)}},Zt=()=>{l&&o(u=>{const S=u.find(L=>L.id===l.id)?u.map(L=>L.id===l.id?l:L):[...u,l];return Bn(l),S})},Si=()=>{if(!l)return;const u=Rc(l.content),f=Rc(l.translatedContent);$t({content:u,translatedContent:f})},wi=async()=>{if(l){if(!$e(l)){window.alert("       .");return}Ue(!0);try{const u=Rc(l.content),f={};for(const L of Object.keys(u)){const O=u[L];if(O){const U=await P0(O);f[L]=ri(U)}}const S=Bp(u);$t({content:u,translatedContent:f,isTranslated:!0,translationBaseHash:S,translationStale:!1}),window.alert("  .")}catch(u){console.error("Translate failed",u),window.alert(" .    .")}finally{Ue(!1)}}},ji=async()=>{if(!l)return;if(!l.isTranslated){window.alert("    (Auto-Translate)   .");return}const u=l.translatedContent||{},f=Object.keys(u).filter(S=>!S.toLowerCase().includes("expenses")&&typeof u[S]=="string"&&u[S].trim().length>0);if(!f.length){window.alert("   .");return}ze(!0);try{const S={...u},L=[];for(const O of f){const U=u[O];if(!(!U||!U.trim()))try{const{protectedText:d,map:g}=Mh(U),w=await ch(d),F=Ph(w||d,g),q=Oh(F);S[O]=ri(q)}catch(d){console.error(`Improve English failed for section "${O}"`,d),L.push(O),S[O]=U}}if($t({translatedContent:S}),Zt(),!L.length)window.alert("   .");else{const O=L.map(U=>{var d;return jd(U,(d=l.expertSummaryMode)==null?void 0:d[U])});window.alert(`   .
  : ${O.join(", ")}.
   .`)}}catch(S){console.error("Improve English failed",S),window.alert("  .    .")}finally{ze(!1)}},pa=u=>{const f=new Set(["lidor@lp-law.co.il"]),S=new Set(["reports@lp-law.co.il"]);if(u.ownerEmail)S.add(u.ownerEmail);else{const L=hs.find(O=>O.id===u.createdBy);L!=null&&L.email&&S.add(L.email)}return{to:Array.from(f),cc:Array.from(S)}},is=u=>Jl(u),Vt=u=>({...u,invoiceFiles:[],policyFile:void 0,expensesSourceFile:void 0}),Ei=(u,f)=>{var O,U,d;const S=u.content?Tr(u.content):{},L=u.translatedContent?Tr(u.translatedContent):{};return{createdAt:f,reportDate:u.reportDate,subject:((O=u.emailSubjectDraft)==null?void 0:O.trim())||is(u),status:"SENT",odakanitNo:u.odakanitNo,recipientId:u.recipientId,insurerName:u.insurerName,lineSlipNo:u.lineSlipNo,marketRef:u.marketRef,insuredName:u.insuredName,plaintiffName:u.plaintiffName,plaintiffTitle:u.plaintiffTitle,policyPeriodStart:u.policyPeriodStart,policyPeriodEnd:u.policyPeriodEnd,retroStart:u.retroStart,retroEnd:u.retroEnd,filenameTag:u.filenameTag,fileNameTitles:u.fileNameTitles?[...u.fileNameTitles]:void 0,selectedSections:[...u.selectedSections||[]],content:S,translatedContent:L,executiveSummary:u.executiveSummary,complaintAnalysis:u.complaintAnalysis?Tr(u.complaintAnalysis):void 0,requiresExpenses:!!u.requiresExpenses,isWaitingForInvoices:!!u.isWaitingForInvoices,isTranslated:!!u.isTranslated,selectedTimeline:u.selectedTimeline,selectedTimelineImage:u.selectedTimelineImage,expensesItems:(U=u.expensesItems)!=null&&U.length?Tr(u.expensesItems):void 0,expenseWorksheet:u.expenseWorksheet?Tr(u.expenseWorksheet):void 0,expensesSum:u.expensesSum,paymentRecommendation:u.paymentRecommendation,reportNotes:(d=u.reportNotes)!=null&&d.length?Tr(u.reportNotes):void 0,ownerName:u.ownerName,ownerEmail:u.ownerEmail}},To=(u,f,S)=>{var d,g;const L=((d=u.emailSubjectDraft)==null?void 0:d.trim())||is(u),O=((g=u.reportHistory)==null?void 0:g.length)||0,U=typeof u.reportNumber=="number"&&u.reportNumber>0?u.reportNumber:O+1;return{id:Tn(),reportNumber:U,subject:L,date:S,sent:!0,fileName:f,snapshot:Ei(u,S)}},wr=u=>{if(!u)return u;const f="",S="";return u.startsWith(f)?u:`${f}${u}${S}`},Ro=(u,f,S)=>{if(typeof window>"u")return;const L=u.to.join(";"),O=g=>encodeURIComponent(g),U=[];u.cc.length&&U.push(`cc=${O(u.cc.join(";"))}`),U.push(`subject=${O(f)}`),U.push(`body=${O(wr(S))}`);const d=`mailto:${L}?${U.join("&")}`;window.location.href=d},Co=async()=>{if(l){we(!0);try{const u=await yc(l),f=lr(l),S=URL.createObjectURL(u),L=document.createElement("a");L.href=S,L.download=f,document.body.appendChild(L),L.click(),L.remove(),URL.revokeObjectURL(S)}catch(u){console.error("PDF download failed",u),alert(" -PDF .  .")}finally{we(!1)}}},ki=async()=>{const u=It(l,e);if(!u.length){await Co();return}Ye({issues:u,onContinue:()=>{Ye(null),Co()}})},fa=()=>{l&&((e==null?void 0:e.role)==="ADMIN"?(pe(!1),qe(!0)):Lo())},Ai=()=>{var S,L;if(!l||(e==null?void 0:e.role)!=="ADMIN")return;if(l.status!=="SENT"){setShowToast({msg:"       (SENT).",type:"error"});return}if(!$e(l)){setShowToast({msg:"   /   .       .",type:"error"});return}if(((L=(S=l.reportReview)==null?void 0:S.issues)==null?void 0:L.some(O=>(O.origin??"INTERNAL")==="EXTERNAL"&&O.status!=="DONE"&&O.externalAction==="REQUIRES_HEBREW"))??!1){setShowToast({msg:"      .    /      .",type:"error"});return}if(!(l.isTranslated&&l.translatedContent&&Object.values(l.translatedContent).some(O=>O&&O.trim().length>0))){setShowToast({msg:"    .      .",type:"error"});return}pe(!0),qe(!0)},xa=async({body:u,templateId:f,subjectBase:S,topics:L},O)=>{const U=O??l;if(!U||U.translationStale&&!window.confirm("     .      .    ?"))return;const d={...U,selectedEmailTemplate:f,emailBodyDraft:u,emailSubjectDraft:S.trim()?S.trim():void 0,fileNameTitles:L};if($t({selectedEmailTemplate:f,emailBodyDraft:u,emailSubjectDraft:d.emailSubjectDraft,fileNameTitles:L}),e){const Ce=Ad(e.id),te=xp(Ce,L,6);pp(e.id,te)}const g=wr(u);$(!0);let w=null,F="";const q=S.trim()||is(d);let re="",ge=null,Te=!1;try{ge=await yc(d);const Ce=await Fp(ge);re=lr(d),w=pa(d),F=q,Te=await ip({to:w.to,cc:w.cc,subject:F,body:g,attachmentBase64:Ce,attachmentName:re}),Te?setShowToast({msg:"  .",type:"success"}):setShowToast({msg:"          ( PDF  ,    ).",type:"error"})}catch(Ce){console.error("Email send failed",Ce),setShowToast({msg:"          ( PDF  ,    ).",type:"error"})}finally{if(w){if(!Te){if(ge){const Ce=re||lr(d),te=URL.createObjectURL(ge),ye=document.createElement("a");ye.href=te,ye.download=Ce,document.body.appendChild(ye),ye.click(),document.body.removeChild(ye),URL.revokeObjectURL(te)}Ro(w,F||q,g)}Lo(re||void 0),qe(!1)}$(!1)}},Ii=async u=>{if(!l)return;let f=l;if(f.odakanitNo){const U=Se(f.odakanitNo);if(U){const g=a.filter(F=>Se(F.odakanitNo)===U).reduce((F,q)=>{const re=typeof q.reportNumber=="number"&&q.reportNumber>0?q.reportNumber:F;return re>F?re:F},0);if((typeof f.reportNumber=="number"&&f.reportNumber>0?f.reportNumber:g)<g){window.alert("       .       .       .");return}}}const S=!!l.expensesSheetId||!!l.expensesHtml,L=Array.isArray(l.selectedSections)&&l.selectedSections.some(U=>qr(U));if(S&&!L){if(!window.confirm(`       ,        .

       ?`))return;const d=[...l.selectedSections||[]],g=d.includes("Update"),w=d.includes("Recommendations"),F=g?Math.min(d.indexOf("Update")+1,w?d.indexOf("Recommendations"):d.length):0;d.splice(F,0,Ka);const q=Array.from(new Set(d)),re={...l,selectedSections:q};$t({selectedSections:q}),f=re}const O=It(f,e);if(!O.length){await xa(u,f);return}Ye({issues:O,onContinue:()=>{Ye(null),xa(u,f)}})},Do=async({body:u,templateId:f,subjectBase:S,topics:L},O)=>{var Te,Ce,te;const U=O??l;if(!U||(e==null?void 0:e.role)!=="ADMIN"||U.translationStale&&!window.confirm("     .      .     ?"))return;const d={...U,selectedEmailTemplate:f,emailBodyDraft:u,emailSubjectDraft:S.trim()?S.trim():void 0,fileNameTitles:L};if($t({selectedEmailTemplate:f,emailBodyDraft:u,emailSubjectDraft:d.emailSubjectDraft,fileNameTitles:L}),e&&L.length){const ye=Ad(e.id),Le=xp(ye,L,6);pp(e.id,Le)}const g=wr(u);$(!0);let w=null,F="",q="";const re=S.trim()||is(d);let ge=!1;try{const ye=await yc(d),Le=await Fp(ye);q=lr(d),w=pa(d),F=`Resend  ${re}`,ge=await ip({to:w.to,cc:w.cc,subject:F,body:g,attachmentBase64:Le,attachmentName:q}),ge?setShowToast({msg:"   ( ).",type:"success"}):setShowToast({msg:"         .",type:"error"});const ce=new Date().toISOString(),Oe=To({...U,status:"SENT",sentAt:ce},q,ce),_e=typeof U.reportNumber=="number"&&U.reportNumber>0?U.reportNumber:(((Te=U.reportHistory)==null?void 0:Te.length)||0)+1,Xe=Se(U.odakanitNo),We=Xe&&Ne?Ne[Xe]:void 0,Kt=!ut(U,We||void 0).isLocked,nt={...Oe,subject:Kt?`Corrected resend #${_e}  ${Oe.subject}`:`Resent #${_e}  ${Oe.subject}`,isCorrection:Kt,revisionIndex:Kt?(((te=(Ce=U.reportHistory)==null?void 0:Ce.filter(pn=>pn.isCorrection))==null?void 0:te.length)||0)+1:void 0},gt={...U,status:"SENT",sentAt:ce,reportHistory:[...U.reportHistory||[],nt],selectedEmailTemplate:void 0,emailBodyDraft:void 0};Fn(gt),Bn(gt,ce),Gn(gt,ce,nt.fileName||q,!0),i(gt),o(pn=>pn.map(Dt=>Dt.id===gt.id?gt:Dt))}catch(ye){console.error("Resend email failed",ye),setShowToast({msg:"         .",type:"error"})}finally{if(w){const ye=re||is(U),Le=F||`UPDATED: ${ye}`;ge||Ro(w,Le,g),qe(!1)}pe(!1),$(!1)}},Ti=async u=>{if(!l)return;let f=l;const S=!!l.expensesSheetId||!!l.expensesHtml,L=Array.isArray(l.selectedSections)&&l.selectedSections.some(U=>qr(U));if(S&&!L){if(!window.confirm(`        ,        .

        ?`))return;const d=[...l.selectedSections||[]],g=d.includes("Update"),w=d.includes("Recommendations"),F=g?Math.min(d.indexOf("Update")+1,w?d.indexOf("Recommendations"):d.length):0;d.splice(F,0,Ka);const q=Array.from(new Set(d)),re={...l,selectedSections:q};$t({selectedSections:q}),f=re}const O=It(f,e);if(!O.length){await Do(u,f);return}Ye({issues:O,onContinue:()=>{Ye(null),Do(u,f)}})},Ri=u=>{if(!u)return;let f=u.trim();if(!(!f||(f=f.replace(Lu," ").replace(/\s+/g," ").trim(),!f)||(f.toLowerCase().endsWith(".pdf.pdf")&&(f=f.slice(0,-4)),f.toLowerCase().endsWith(".pdf")||(f=`${f}.pdf`),f.length>255)))return f},Lo=u=>{var U;if(!l)return;let f="READY_TO_SEND",S=l.sentAt,L=l;if((e==null?void 0:e.role)==="ADMIN"){f="SENT";const d=new Date().toISOString();S=d;const w=Ri(u)||lr(Vt(l)),F=To({...l},w,S);L={...l,reportHistory:[...l.reportHistory||[],F],selectedEmailTemplate:void 0,emailBodyDraft:void 0,firstSentAt:l.firstSentAt||d}}else((e==null?void 0:e.role)==="FINANCE"||(e==null?void 0:e.role)==="SUB_ADMIN")&&(f="TASK_ASSIGNED");const O={...L,status:f,sentAt:S};if(Fn(O),Bn(O,S||new Date().toISOString()),f==="SENT"&&S){const d=(U=O.reportHistory)==null?void 0:U[O.reportHistory.length-1];Gn(O,S,d==null?void 0:d.fileName,!1)}i(O),o(d=>d.find(w=>w.id===O.id)?d.map(w=>w.id===O.id?O:w):[...d,O]),r("DASHBOARD")},Ci=(u,f)=>{e&&(Fe(u,S=>{const L=[{id:Tn(),authorId:e.id,authorName:e.name,message:f,createdAt:new Date().toISOString()},...S.reportNotes||[]];return{...S,reportNotes:L}}),As({id:`note-${Date.now()}`,message:`${e.name} added a note: "${f}"`,createdAt:new Date().toISOString()}))},Di=(u,f)=>{Fe(u,S=>{const L=S.expenseWorksheet||_s(),O={id:Tn(),timestamp:new Date().toISOString(),userId:(e==null?void 0:e.id)||"system",userName:(e==null?void 0:e.name)||"System",action:f.action||"UPDATE",details:f.details};return{...S,expenseWorksheet:{...L,history:[O,...L.history||[]]}}})},Li=(u,f,S)=>{e&&(Fe(u,L=>{const O=L.expenseWorksheet||_s(),U={id:Tn(),rowId:f,authorId:e.id,authorName:e.name,message:S,createdAt:new Date().toISOString()};return{...L,expenseWorksheet:{...O,notes:[U,...O.notes||[]]}}}),Di(u,{action:"NOTE_ADDED",details:S}))},jr=u=>{const f=new Date().toISOString();Fe(u,S=>({...S,deletedAt:f,deletedBy:e==null?void 0:e.id}))},_i=u=>{Fe(u,f=>{const S={...f};return delete S.deletedAt,delete S.deletedBy,S})},Oi=(u,f)=>{Fe(u,S=>{const L=S.expenseWorksheet||_s();return{...S,expenseWorksheet:{...L,notes:L.notes.map(O=>O.id===f?{...O,resolved:!0,resolvedAt:new Date().toISOString()}:O)}}})},Mi=(u,f)=>{!f.amount||f.amount<=0||Fe(u,S=>{var ge,Te;const L=S.expenseWorksheet||_s(),O=ns.find(Ce=>Ce.value===f.category),U=(O==null?void 0:O.type)||"EXPENSE",d=f.category==="OTHER"?((ge=f.customLabel)==null?void 0:ge.trim())||"Other expense":(O==null?void 0:O.label)||"Expense",g={id:Tn(),type:U,category:f.category,label:d,serviceProvider:U==="EXPENSE"?(Te=f.serviceProvider)==null?void 0:Te.trim():void 0,amount:f.amount,createdBy:e==null?void 0:e.id,createdAt:new Date().toISOString()},w=[...L.rows||[],g],F=si(w),q=Sv(w),re={id:Tn(),timestamp:new Date().toISOString(),userId:(e==null?void 0:e.id)||"system",userName:(e==null?void 0:e.name)||"System",action:"ROW_ADDED",details:`${d} ${g.amount.toLocaleString()}`};return{...S,expenseWorksheet:{...L,rows:w,totals:F,history:[re,...L.history||[]]},expensesItems:q,expensesSum:F.totalExpenses.toLocaleString()}})},Pi=u=>{const f=hs.find(w=>w.id===u.lawyerId);if(!f)return;const S=Td(u.worksheet||[],e||void 0),L=si(S),O=u.invoiceFiles||[],U=O.length===0,d={...un(),createdBy:f.id,ownerName:f.name,ownerEmail:f.email,status:U?"WAITING_FOR_INVOICES":"TASK_ASSIGNED",odakanitNo:u.odakanitNo,financeInstructions:u.instructions,expensesSourceFile:u.file,selectedSections:["Update","Expenses breakdown"],isWaitingForInvoices:U,requiresExpenses:!0},g={...d,expensesItems:S.filter(w=>w.type==="EXPENSE").map(w=>({id:w.id,date:new Date().toISOString().split("T")[0],description:`${w.label}${w.serviceProvider?` (${w.serviceProvider})`:""}`,amount:w.amount,currency:"NIS"})),expensesSum:S.length?L.totalExpenses.toLocaleString():d.expensesSum,invoiceFiles:O,expenseWorksheet:{status:"DRAFT",rows:S,history:[{id:Tn(),timestamp:new Date().toISOString(),userId:(e==null?void 0:e.id)||"system",userName:(e==null?void 0:e.name)||"System",action:"WORKSHEET_CREATED",details:`${S.length} rows added via finance request`}],notes:[],favorites:E[u.lawyerId]||[],totals:L}};o(w=>[...w,g]),As({id:`worksheet-${Date.now()}`,message:`New expense worksheet created for case ${u.odakanitNo||g.id}`,createdAt:new Date().toISOString(),reportId:g.id,severity:"info"})},Fi=async({caseId:u,sheetId:f,lawyerId:S})=>{var _e,Xe,We,Et,Kt;const L=Se(u),O=Ne==null?void 0:Ne[L],U=a.filter(nt=>Se(nt.odakanitNo)===L);if(O&&O.closedAt){window.alert("        .   ,     .");return}if(!U.length&&!O){window.alert("     ( ).       .");return}if(!U.length)return;const d=(nt,gt)=>{const pn=nt.updatedAt?new Date(nt.updatedAt).getTime():0;return(gt.updatedAt?new Date(gt.updatedAt).getTime():0)-pn};let g=U.filter(nt=>!S||nt.createdBy===S).sort(d)[0];if(g||(g=U.sort(d)[0]),!g)return;const w=S||g.createdBy;if(!w)return;const F=g.odakanitNo||u,q=g.insuredName||g.plaintiffName||"case",re=`New financial update (Expenses breakdown) is available for Odakanit case ${F} (${q}).`;let ge=null,Te,Ce=null,te=[];try{const nt=await Je.getSheet(f);if(nt&&nt.sheet&&((_e=nt.lineItems)!=null&&_e.length)){const gt=Je.buildCumulativeExpensesSnapshot(nt.sheet.id,new Date().toISOString());if(!gt)return;const{effectiveSheet:pn,allLines:Dt,opts:Is}=gt,{text:ya,totals:Na}=Ah(pn,Dt,Is),Qe=((Xe=nt.attachments)==null?void 0:Xe.length)??0,nr=Na.amountToRequest.toLocaleString("he-IL",{minimumFractionDigits:2,maximumFractionDigits:2}),An="This expenses breakdown was prepared by the finance department and is attached for your review.",ba=`Summary: total amount to request ${nr}${Qe>0?` (invoices attached: ${Qe})`:""}.`;ge=`${An}

${ba}`;const{html:Ts}=ti(pn,Dt,Is);if(Ce=Ts,Te=nt.sheet.updatedAt||new Date().toISOString(),nt.attachments&&nt.attachments.length){const sr=nt.attachments.slice(0,4).map((Yt,Ar)=>({id:`fes-inv-${Yt.id}-${Ar}`,name:Yt.originalFileName,data:Yt.fileKey.split(",").pop()||Yt.fileKey,type:Yt.mimeType||"application/pdf"}));sr.length&&(te=sr)}}}catch(nt){Bu("Failed to build Expenses Breakdown text for finance notification",nt)}const ye=new Date().toISOString(),Le=ge||"An expenses table has been prepared by the finance department for this case. Please review the attached sheet or coordinate with Finance as needed.",ce=typeof g.reportNumber=="number"&&g.reportNumber>0?g.reportNumber+1:(((We=g.reportHistory)==null?void 0:We.length)||0)+1;let Oe={...g,id:`${Date.now()}-finance`,createdBy:w,status:"TASK_ASSIGNED",reportDate:ye,updatedAt:ye,expensesSheetId:f,expensesSnapshotAt:Te||ye,invoiceFiles:te,reportNumber:ce,reportHistory:g.reportHistory||[],attachPolicyAsAppendix:!1,expensesHtml:Ce||void 0,content:{...g.content,Update:((Et=g.content)==null?void 0:Et.Update)||"","Expenses breakdown":Le,Recommendations:((Kt=g.content)==null?void 0:Kt.Recommendations)||""},selectedSections:["Update","Expenses breakdown","Recommendations"],supersededByReportId:null,supersedesReportId:null};o(nt=>{const gt=[...nt].filter(Dt=>Dt.expensesSheetId===f&&!Dt.deletedAt&&Dt.id!==Oe.id).sort((Dt,Is)=>{const ya=new Date(Dt.updatedAt||Dt.reportDate||"").getTime()||0;return(new Date(Is.updatedAt||Is.reportDate||"").getTime()||0)-ya})[0];let pn=nt;return gt&&(pn=nt.map(Dt=>Dt.id===gt.id?{...Dt,supersededByReportId:Oe.id}:Dt),Oe={...Oe,supersedesReportId:gt.id}),[...pn,Oe]}),As({id:`${Date.now()}`,message:re,createdAt:new Date().toISOString(),reportId:Oe.id,severity:"info",targetUserId:w})},Bi=u=>{t(u),r("DASHBOARD"),i(null),m(null),p.current=!1,typeof window<"u"&&(localStorage.setItem(pt.USER,u.username),localStorage.setItem(pt.VIEW,"DASHBOARD"),localStorage.removeItem(pt.CURRENT_REPORT))},_o=()=>{if(t(null),i(null),m(null),p.current=!1,r("DASHBOARD"),v(null),W(!1),qe(!1),$(!1),pe(!1),he(!1),C(null),V(""),P(null),ie(""),se("LAWYER"),Q([]),ae(null),B(!1),le(null),D([]),typeof window<"u")try{localStorage.removeItem(pt.USER),localStorage.removeItem(pt.CURRENT_REPORT),localStorage.setItem(pt.VIEW,"DASHBOARD"),localStorage.removeItem(_b)}catch(u){console.error("Failed to clear session storage on logout",u)}};if(!e)return n.jsx(Av,{onLogin:Bi});if(s==="CASE_FOLDER"&&oe){const u=Ne[oe]||null,f=()=>{r("DASHBOARD")};return u?n.jsx(Wb,{folder:u,reports:a,currentUserRole:e.role,onBack:f,onUpdateReTemplate:S=>{Ct(L=>{const O=L[oe];if(!O)return L;const U={...O,reTemplate:S,updatedAt:new Date().toISOString()},d={...L,[oe]:U};return In(d),d})},onCloseCase:e.role==="ADMIN"?()=>{const S=oe;if(!S)return;const L=Se(S);if(a.some(d=>Se(d.odakanitNo)===L&&d.status!=="SENT"&&!d.deletedAt)){window.alert("         .        .");return}if(!window.confirm("        .   ?"))return;const U=new Date().toISOString();Ct(d=>{const g=d[S];if(!g)return d;const w={...g,closedAt:U,closedByUserId:e.id,updatedAt:U},F={...d,[S]:w};return In(F),F})}:void 0,onReopenCase:e.role==="ADMIN"?()=>{const S=oe;S&&window.confirm("         .   ?")&&Ct(L=>{const O=L[S];if(!O)return L;const U={...O,closedAt:null,closedByUserId:null,updatedAt:new Date().toISOString()},d={...L,[S]:U};return In(d),d})}:void 0,onDeleteCase:e.role==="ADMIN"?()=>{const S=oe;if(!S)return;const L=Se(S);if(a.some(U=>Se(U.odakanitNo)===L&&U.status!=="SENT"&&!U.deletedAt)){window.alert("       .        .");return}window.confirm("           (  ).   ?")&&window.confirm(" :      ?     .")&&(Ct(U=>{const d={...U};return delete d[S],In(d),d}),o(U=>U.filter(d=>Se(d.odakanitNo)!==L)),le(null),r("DASHBOARD"))}:void 0,onCreateReportInCase:()=>{const S=Ne[oe];if(!S||!e)return;if(S.closedAt){window.alert("  .      .");return}const L=a.find(Ce=>Ce.odakanitNo&&Se(Ce.odakanitNo)===Se(S.odakanitNo)&&Ce.status!=="SENT"&&!Ce.deletedAt);if(L&&e.role==="LAWYER"){window.alert("     .     .      .");return}if(L&&e.role==="ADMIN"&&!window.confirm("     .       ( ,    )?"))return;const O=new Date().toISOString(),U=un(),d=wn(S),g=ls({odakanitNo:S.odakanitNo,reports:a,caseFolder:S}),w=Array.isArray(S.sentReports)?S.sentReports:[];let F=null,q="";if(w.length>0){F=[...w].sort((Oe,_e)=>{const Xe=new Date(Oe.sentAt||"").getTime()||0;return(new Date(_e.sentAt||"").getTime()||0)-Xe})[0];const Ce=(F==null?void 0:F.snapshot)||{},te=Ce.content||{},ye=Array.isArray(Ce.selectedSections)?Ce.selectedSections:[],Le=ye.length>0?ye:Object.keys(te),ce=[];Le.forEach(Oe=>{const _e=te[Oe];typeof _e=="string"&&_e.trim()&&ce.push(_e.trim())}),q=ce.join(`

`).trim()}const re=!!(F&&q),ge="    ",Te={...U,odakanitNo:S.odakanitNo,reportSubject:S.reTemplate||"",insuredName:S.insuredName||"",plaintiffName:S.plaintiffName||"",insurerName:S.insurerName||"",marketRef:S.marketRef||"",lineSlipNo:S.lineSlipNo||"",certificateRef:S.certificateRef||"",reportDate:O,updatedAt:O,reportHistory:d,reportNumber:g,content:re?{...U.content||{},Update:ge}:U.content,updateAutoSummarySourceReportId:re?F.reportId:null,updateAutoSummaryGeneratedAt:re?O:null,updateAutoSummaryEdited:!1};if(i(Te),m(null),r("STEP1"),typeof window<"u")try{localStorage.setItem(pt.CURRENT_REPORT,Te.id)}catch{}if(Bn(Te,O),re){const Ce=q,te=F.reportId;(async()=>{try{let ye=await $0(Ce);ye=(ye||"").trim(),ye||(ye=`,     ${Ce.trim().slice(0,600)}`),ye.startsWith(",  ")||(ye=`,     ${ye}`),Fe(Te.id,Le=>{var ce;return Le.updateAutoSummaryEdited||((ce=Le.content)==null?void 0:ce.Update)!==ge?Le:{...Le,content:{...Le.content||{},Update:ye},updateAutoSummarySourceReportId:te,updateAutoSummaryGeneratedAt:new Date().toISOString()}})}catch(ye){console.error("Auto summary generation failed, falling back to snippet.",ye);const Le=Ce.trim();if(!Le)return;const Oe=`,     ${Le.slice(0,600)}`;Fe(Te.id,_e=>{var Xe;return _e.updateAutoSummaryEdited||((Xe=_e.content)==null?void 0:Xe.Update)!==ge?_e:{..._e,content:{..._e.content||{},Update:Oe},updateAutoSummarySourceReportId:te,updateAutoSummaryGeneratedAt:new Date().toISOString()}})}})()}},onOpenReport:S=>{const L=a.find(O=>O.id===S);if(L&&(i(L),m(null),r("STEP1"),typeof window<"u"))try{localStorage.setItem(pt.CURRENT_REPORT,L.id)}catch{}}}):n.jsx("div",{className:"min-h-screen flex items-center justify-center bg-bgDark px-4",children:n.jsxs("div",{className:"max-w-md rounded-2xl bg-panel p-6 text-center text-sm text-textLight shadow-sm border border-borderDark",children:[n.jsx("p",{className:"mb-3 font-semibold text-gold",children:"Case folder not found"}),n.jsx("p",{className:"mb-4 text-xs text-textMuted",children:"The requested case folder is no longer available. You can return to the dashboard and select another case."}),n.jsx("button",{type:"button",onClick:f,className:"inline-flex items-center rounded-full bg-navy px-4 py-1.5 text-xs font-semibold text-gold shadow-sm hover:bg-navySecondary focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-gold focus-visible:ring-offset-2",children:"Back to dashboard"})]})})}const Oo=()=>{if((e==null?void 0:e.role)==="LAWYER"){xe(""),Ee(!0);return}const u=un();if(i(u),m(null),r("STEP1"),typeof window<"u")try{localStorage.setItem(pt.CURRENT_REPORT,u.id)}catch{}},ha=(u,f)=>{const S=a.find(L=>L.id===u);if(S&&(i(S),m(null),r("STEP1"),v(f||null),typeof window<"u"))try{localStorage.setItem(pt.CURRENT_REPORT,S.id)}catch{}};if(s==="DASHBOARD")return(e==null?void 0:e.role)==="ADMIN"||(e==null?void 0:e.role)==="SUB_ADMIN"?n.jsx(Pb,{user:e,reports:a,caseFolders:Ne,onUpdateCaseFolders:u=>{Ct(f=>{const S=u(f);return In(S),S})},onNewReport:Oo,onSelectReport:ha,onSelectReportWithFocus:(u,f)=>ha(u,f),onMarkExternalIssuesDone:Pe,onReopenHebrewDueToExternalFeedback:u=>mn(u),canTranslate:$e,onLogout:_o,onOpenAssistant:()=>Be(!0),onOpenCaseFolder:u=>{const f=Se(u);f&&(Ct(S=>{const L=Tc(S,a);return In(L),L}),le(f),r("CASE_FOLDER"))}}):n.jsxs(n.Fragment,{children:[n.jsx(kv,{user:e,reports:a,onNewReport:Oo,onSelectReport:ha,onLogout:_o,onUpdateReport:(u,f)=>{Fe(u,S=>({...S,...f}))},onDeleteReport:u=>o(f=>f.filter(S=>S.id!==u)),onFinanceTaskCreate:Pi,onNotifyLawyerFromFinance:Fi,caseTemplates:M,onStartTemplate:er,onStartNextReport:tr,archiveAfterMs:pv,favoriteProviders:E,onSaveFavorite:Ao,onDeleteFavorite:Io,onOpenWorksheet:kn,onRequestReminder:u=>{P(u),ie(`Reminder for ${u.insuredName||"case"}`)},onRequestNote:u=>{C(u),V("")},onSoftDeleteReport:jr,onRestoreReport:_i,notifications:N.filter(u=>!u.targetUserId||u.targetUserId===(e==null?void 0:e.id)),showNotifications:b,setShowNotifications:B,onClearNotifications:()=>x([]),dailySummaryOptIn:H,setDailySummaryOptIn:z,caseFolders:Ne,onOpenCaseFolder:u=>{const f=Se(u);f&&(Ct(S=>{const L=Tc(S,a);return In(L),L}),le(f),r("CASE_FOLDER"))},onOpenAssistant:()=>Be(!0)}),(e==null?void 0:e.role)==="LAWYER"&&Ie&&n.jsx("div",{className:"fixed inset-0 z-[250] flex items-center justify-center bg-black/40",children:n.jsxs("div",{className:"bg-panel rounded-2xl shadow-xl max-w-sm w-full mx-4 p-5 space-y-3",dir:"rtl",children:[n.jsx("h2",{className:"text-sm font-bold text-textLight text-right",children:"    "}),n.jsx("p",{className:"text-xs text-textMuted text-right",children:'/   .         / " .          .'}),n.jsx("input",{type:"text",className:"w-full border border-borderDark rounded px-3 py-1.5 text-sm text-textLight",placeholder:": 1/123",value:ne,onChange:u=>xe(u.target.value)}),n.jsxs("div",{className:"flex justify-end gap-2 mt-2",children:[n.jsx("button",{type:"button",className:"px-3 py-1.5 rounded-md border border-borderDark text-xs text-textLight bg-panel hover:bg-slate-50",onClick:()=>{Ee(!1),xe("")},children:""}),n.jsx("button",{type:"button",className:"px-3 py-1.5 rounded-md bg-navy text-xs font-semibold text-gold hover:bg-navySecondary",onClick:()=>{const u=ne.trim();if(!u){alert("    .");return}const f=u,S=Ne[f],L=new Date().toISOString();if(S){const O=un(),U=wn(S),d=ls({odakanitNo:S.odakanitNo,reports:a,caseFolder:S}),g={...O,odakanitNo:S.odakanitNo,reportSubject:S.reTemplate||"",insuredName:S.insuredName||"",plaintiffName:S.plaintiffName||"",insurerName:S.insurerName||"",marketRef:S.marketRef||"",lineSlipNo:S.lineSlipNo||"",certificateRef:S.certificateRef||"",reportDate:L,updatedAt:L,reportHistory:U,reportNumber:d};if(i(g),r("STEP1"),typeof window<"u")try{localStorage.setItem(pt.CURRENT_REPORT,g.id)}catch{}Bn(g,L)}else{const U={...un(),odakanitNo:f};if(i(U),r("STEP1"),typeof window<"u")try{localStorage.setItem(pt.CURRENT_REPORT,U.id)}catch{}Bn(U,L)}Ee(!1),xe("")},children:""})]})]})})]});if(!l)return null;const $i=typeof l.reportNumber=="number"&&l.reportNumber>0?l.reportNumber:(((ga=l.reportHistory)==null?void 0:ga.length)||0)+1,Mo=dh(l.selectedSections||[]),Po=Mo.map((u,f)=>({id:`${f}-${u.replace(/\s+/g,"-")||"title"}`,label:u})).filter(u=>!!u.label),Hi=kd(Mo),Ui=l.fileNameTitles&&l.fileNameTitles.length?l.fileNameTitles:Hi,Wi=$i!==1&&Po.length>0,zi=Y.map(u=>{const f=ks(u.reportId);return f?{...u,report:f,title:`${f.insuredName||"Case"} (${f.ownerName})`}:null}).filter(Boolean),Er=G?ks(G):null;return n.jsxs(n.Fragment,{children:[n.jsx("div",{className:"min-h-screen bg-navySecondary pb-12",children:n.jsxs("div",{className:"max-w-5xl mx-auto pt-6 px-4",children:[n.jsxs("div",{className:"flex justify-between items-center mb-8",children:[n.jsxs("div",{className:"flex items-center bg-panel p-2 rounded-full shadow-sm",children:[n.jsx("div",{className:`px-4 py-1 rounded-full ${s==="STEP1"?"bg-navy text-white font-bold":"text-textMuted"}`,children:"1. Setup"}),n.jsx(es,{className:"w-4 h-4 text-gray-300 mx-2"}),n.jsx("div",{className:`px-4 py-1 rounded-full ${s==="STEP2"?"bg-navy text-white font-bold":"text-textMuted"}`,children:"2. Draft"}),n.jsx(es,{className:"w-4 h-4 text-gray-300 mx-2"}),n.jsx("div",{className:`px-4 py-1 rounded-full ${s==="PREVIEW"?"bg-navy text-white font-bold":"text-textMuted"}`,children:"3. Preview"})]}),n.jsxs("button",{type:"button",onClick:()=>Be(!0),className:"flex items-center text-[11px] px-3 py-1.5 rounded-full bg-indigo-50 text-indigo-800 border border-indigo-200 hover:bg-indigo-100",title:"     ,     .",children:[n.jsx(sa,{className:"w-3 h-3 ml-1"})," "]})]}),l&&(()=>{const u=Se(l.odakanitNo),f=u&&Ne?Ne[u]:void 0,S=ut(l,f||void 0),L=!!(f!=null&&f.closedAt),O=(e==null?void 0:e.role)==="ADMIN"&&c===l.id;return(S.isLocked||L)&&!(O&&!L)})()&&n.jsxs("div",{className:"mb-4 rounded-2xl border border-amber-300 bg-amber-50 px-4 py-3 text-xs text-amber-900 flex items-start justify-between gap-3",children:[n.jsxs("div",{children:[n.jsx("p",{className:"font-semibold text-[13px]",children:(()=>{const u=Se(l.odakanitNo),f=u&&Ne?Ne[u]:void 0,S=ut(l,f||void 0);return f!=null&&f.closedAt?"      .":S.lockType==="MANUAL"?"   .":S.lockType==="AUTO"&&S.lockAt?`    ${new Date(S.lockAt).toLocaleDateString("he-IL")}.`:"  ."})()}),n.jsx("p",{className:"mt-1 text-[11px]",children:'  ,    PDF,      "     .'})]}),(e==null?void 0:e.role)==="ADMIN"&&n.jsxs("div",{className:"flex flex-col items-end gap-2",children:[(()=>{const u=Se(l.odakanitNo),f=u&&Ne?Ne[u]:void 0,S=ut(l,f||void 0);return l.status==="SENT"&&!S.isLocked})()&&n.jsx("button",{type:"button",className:"shrink-0 inline-flex items-center rounded-full bg-panel px-3 py-1.5 text-[11px] font-semibold text-amber-900 border border-amber-300 hover:bg-amber-100",onClick:()=>{const u=window.prompt(`      .
 /     (  ):`);if(!u||!u.trim())return;m(l.id);const f=new Date().toISOString(),S=e.id,L=e.name;$t({lastAdminOverrideAt:f,lastAdminOverrideById:S,lastAdminOverrideByName:L,lastAdminOverrideReason:u.trim()})},children:"  ()"}),(()=>{const u=Se(l.odakanitNo),f=u&&Ne?Ne[u]:void 0,S=ut(l,f||void 0),L=!S.isLocked&&!!l.firstSentAt&&!(f!=null&&f.closedAt),O=!(f!=null&&f.closedAt)&&!l.manualLockedAt&&!S.isLocked;return n.jsxs("div",{className:"flex flex-wrap gap-2 justify-end",children:[L&&n.jsx("button",{type:"button",className:"inline-flex items-center rounded-full bg-amber-100 px-3 py-1.5 text-[10px] font-semibold text-amber-900 border border-amber-300 hover:bg-amber-200",onClick:()=>{const U=window.prompt(`   -35  .
 /   (  ):`);if(!U||!U.trim())return;const d=new Date().toISOString(),g=l.lockExtensions||[];$t({lockExtensions:[...g,{extendedAt:d,extendedById:e.id,extendedByName:e.name,days:35,reason:U.trim()}]})},children:"   (+35 )"}),O&&n.jsx("button",{type:"button",className:"inline-flex items-center rounded-full bg-amber-100 px-3 py-1.5 text-[10px] font-semibold text-amber-900 border border-amber-300 hover:bg-amber-200",onClick:()=>{const U=window.prompt(`     .
 /     (  ):`);if(!U||!U.trim())return;const d=new Date().toISOString();$t({manualLockedAt:d,manualLockedById:e.id,manualLockedByName:e.name,manualLockReason:U.trim()})},children:"  "})]})})()]})]}),s==="STEP1"&&n.jsx(wv,{data:l,updateData:$t,onNext:()=>{if(l){const u=Se(l.odakanitNo),f=u&&Ne?Ne[u]:void 0;ut(l,f||void 0).isLocked||Zt()}r("STEP2")},onBack:()=>{if(l){const u=Se(l.odakanitNo),f=u&&Ne?Ne[u]:void 0;ut(l,f||void 0).isLocked||Zt()}r("DASHBOARD")},currentUser:e,timelineGallery:A,onAddTimelineImages:u=>D(f=>[...f,...u.map(S=>({...S,id:Date.now().toString()}))]),onRemoveTimelineImage:u=>D(f=>f.filter(S=>S.id!==u)),onSaveAndExit:()=>{if(l){const u=Se(l.odakanitNo),f=u&&Ne?Ne[u]:void 0;ut(l,f||void 0).isLocked||Zt()}r("DASHBOARD")},readOnly:!!l&&(()=>{const u=Se(l.odakanitNo),f=u&&Ne?Ne[u]:void 0,S=ut(l,f||void 0),L=!!(f!=null&&f.closedAt),O=(e==null?void 0:e.role)==="ADMIN"&&c===l.id&&!L,U=(e==null?void 0:e.role)==="LAWYER"&&l.status==="SENT";return O?!1:U||L?!0:S.isLocked})()}),s==="STEP2"&&n.jsx(jv,{data:l,updateData:$t,onNext:()=>{if(l){const u=Se(l.odakanitNo),f=u&&Ne?Ne[u]:void 0;ut(l,f||void 0).isLocked||Zt()}r("PREVIEW")},onBack:()=>{if(l){const u=Se(l.odakanitNo),f=u&&Ne?Ne[u]:void 0;ut(l,f||void 0).isLocked||Zt()}r("STEP1")},currentUser:e,timelineGallery:A,onAddTimelineImages:u=>{},onSaveAndExit:()=>{if(l){const u=Se(l.odakanitNo),f=u&&Ne?Ne[u]:void 0;ut(l,f||void 0).isLocked||Zt()}r("DASHBOARD")},onSaveDraft:l&&(()=>{const u=Se(l.odakanitNo),f=u&&Ne?Ne[u]:void 0,S=ut(l,f||void 0);if(!((e==null?void 0:e.role)==="LAWYER"&&l.status==="SENT"||S.isLocked))return Zt})(),onTranslate:l&&(()=>{const u=Se(l.odakanitNo),f=u&&Ne?Ne[u]:void 0,S=ut(l,f||void 0);if(!((e==null?void 0:e.role)==="LAWYER"&&l.status==="SENT"||S.isLocked))return wi})(),onFormatContent:l&&(()=>{const u=Se(l.odakanitNo),f=u&&Ne?Ne[u]:void 0,S=ut(l,f||void 0);if(!((e==null?void 0:e.role)==="LAWYER"&&l.status==="SENT"||S.isLocked))return Si})(),onSubmitHebrewForReview:l&&(()=>{const u=Se(l.odakanitNo),f=u&&Ne?Ne[u]:void 0,S=ut(l,f||void 0);if(!((e==null?void 0:e.role)==="LAWYER"&&l.status==="SENT"||S.isLocked))return()=>Sr(l.id)})(),onApproveHebrewForTranslation:l&&(()=>{const u=Se(l.odakanitNo),f=u&&Ne?Ne[u]:void 0,S=ut(l,f||void 0);if(!((e==null?void 0:e.role)==="LAWYER"&&l.status==="SENT"||S.isLocked))return()=>T(l.id)})(),onAddReviewIssues:l&&(()=>{const u=Se(l.odakanitNo),f=u&&Ne?Ne[u]:void 0,S=ut(l,f||void 0);if(!((e==null?void 0:e.role)==="LAWYER"&&l.status==="SENT"||S.isLocked))return O=>ve(l.id,O)})(),onMarkReviewIssueDone:l&&(()=>{const u=Se(l.odakanitNo),f=u&&Ne?Ne[u]:void 0,S=ut(l,f||void 0);if(!((e==null?void 0:e.role)==="LAWYER"&&l.status==="SENT"||S.isLocked))return O=>De(l.id,O)})(),onAddExternalFeedbackIssues:l&&(()=>{const u=Se(l.odakanitNo),f=u&&Ne?Ne[u]:void 0,S=ut(l,f||void 0);if(!((e==null?void 0:e.role)==="LAWYER"&&l.status==="SENT"||S.isLocked))return(O,U)=>En(l.id,O,U)})(),onReopenHebrewDueToExternalFeedback:l&&(()=>{const u=Se(l.odakanitNo),f=u&&Ne?Ne[u]:void 0,S=ut(l,f||void 0);if(!((e==null?void 0:e.role)==="LAWYER"&&l.status==="SENT"||S.isLocked))return()=>mn(l.id)})(),step1Focus:h,onStep1FocusConsumed:()=>v(null),isTranslating:He,isImprovingEnglish:Ze,onImproveEnglish:l&&(()=>{const u=Se(l.odakanitNo),f=u&&Ne?Ne[u]:void 0,S=ut(l,f||void 0);if(!((e==null?void 0:e.role)==="LAWYER"&&l.status==="SENT"||S.isLocked))return ji})(),onOpenAssistant:()=>Be(!0),onActiveSectionChange:u=>lt(u),readOnly:!!l&&(()=>{const u=(e==null?void 0:e.role)==="ADMIN"&&c===l.id;if(!l)return!1;const f=Se(l.odakanitNo),S=f&&Ne?Ne[f]:void 0,L=ut(l,S||void 0);return!u&&L.isLocked})()}),s==="PREVIEW"&&(()=>{const u=lv(e==null?void 0:e.role),f=(e==null?void 0:e.role)==="LAWYER";return n.jsxs("div",{className:"space-y-6 animate-fade-in",dir:f?"rtl":void 0,lang:f?"he":void 0,children:[n.jsxs("div",{className:"flex justify-between items-center flex-wrap gap-2",children:[n.jsxs("button",{onClick:()=>{Zt(),r("STEP2")},className:"flex items-center text-sm text-textMuted bg-navySecondary px-3 py-1.5 rounded-full hover:bg-borderDark",children:[n.jsx(ql,{className:"w-4 h-4 mr-1"}),u.backToStep2]}),n.jsxs("button",{onClick:()=>{Zt(),r("DASHBOARD")},className:"flex items-center text-sm text-lpBlue bg-blue-50 px-3 py-1.5 rounded-full hover:bg-blue-100",children:[n.jsx(Eu,{className:"w-4 h-4 mr-1"}),u.backToDashboard]})]}),n.jsxs("div",{className:"flex justify-between items-center bg-panel p-4 rounded shadow mb-4",children:[n.jsxs("div",{children:[n.jsx("h2",{className:"text-xl font-bold text-lpBlue",children:u.title}),n.jsx("p",{className:"mt-1 text-xs text-textMuted",children:"Export options let you back up the current report data (JSON/CSV) in addition to the PDF."})]}),n.jsxs("div",{className:"flex gap-2 flex-wrap justify-end items-center",children:[n.jsxs("button",{type:"button",onClick:()=>Be(!0),className:"flex items-center text-[11px] px-3 py-1.5 rounded-full bg-indigo-50 text-indigo-800 border border-indigo-200 hover:bg-indigo-100",title:"         PDF.",children:[n.jsx(sa,{className:"w-3 h-3 mr-1"})," "]}),n.jsx("button",{onClick:()=>W(S=>!S),className:"flex items-center bg-borderDark text-textLight px-4 py-2 rounded hover:bg-borderDark",children:I?u.toggleHide:u.toggleShow}),n.jsxs("button",{onClick:ki,disabled:ue,className:"flex items-center bg-panel text-textLight border border-borderDark px-4 py-2 rounded hover:bg-navySecondary disabled:opacity-50",children:[ue?n.jsx(Mt,{className:"w-4 h-4 mr-2 animate-spin"}):n.jsx(po,{className:"w-4 h-4 mr-2"}),u.downloadPdf]}),n.jsx("button",{onClick:()=>he(!0),disabled:!Wi,className:"flex items-center bg-panel text-textLight border border-borderDark px-4 py-2 rounded hover:bg-navySecondary disabled:opacity-40",children:u.editFileNames}),n.jsx("button",{onClick:()=>{const S={report:l},L=new Blob([JSON.stringify(S,null,2)],{type:"application/json"}),O=URL.createObjectURL(L),U=document.createElement("a");U.href=O,U.download=`report-${l.odakanitNo||l.id}.json`,U.click(),URL.revokeObjectURL(O)},className:"flex items-center bg-panel text-textLight border border-borderDark px-3 py-2 rounded hover:bg-navySecondary text-xs",children:"JSON Export"}),n.jsx("button",{onClick:()=>{const S=["OdakanitNo","InsuredName","PlaintiffName","InsurerName","MarketRef","LineSlipNo","CertificateRef","ReportDate","Status"],L=[l.odakanitNo||"",l.insuredName||"",l.plaintiffName||"",l.insurerName||"",l.marketRef||"",l.lineSlipNo||"",l.certificateRef||"",l.reportDate||"",l.status||""],O=F=>{const q=String(F??"");return/[",\n]/.test(q)?`"${q.replace(/"/g,'""')}"`:q},U=[S.join(","),L.map(O).join(",")].join(`
`),d=new Blob(["\uFEFF"+U],{type:"text/csv;charset=utf-8;"}),g=URL.createObjectURL(d),w=document.createElement("a");w.href=g,w.download=`report-${l.odakanitNo||l.id}.csv`,w.click(),URL.revokeObjectURL(g)},className:"flex items-center bg-panel text-textLight border border-borderDark px-3 py-2 rounded hover:bg-navySecondary text-xs",children:"CSV Export"}),n.jsxs("button",{onClick:fa,className:"flex items-center bg-green-600 text-white px-4 py-2 rounded hover:bg-green-700",children:[n.jsx(Xl,{className:"w-4 h-4 mr-2"}),u.finalize]}),e.role==="ADMIN"&&n.jsxs("button",{onClick:Ai,className:"flex items-center bg-orange-600 text-white px-4 py-2 rounded hover:bg-orange-700",children:[n.jsx(Xl,{className:"w-4 h-4 mr-2"}),"   "]})]})]}),I?n.jsxs("div",{className:"bg-panel rounded-2xl shadow p-4 space-y-4",children:[n.jsx("div",{className:"flex items-center justify-end flex-wrap gap-3",children:n.jsx("span",{className:"text-xs text-textMuted",children:u.helperScroll})}),n.jsx("div",{className:"border rounded-2xl bg-navySecondary p-4 pr-6 max-h-[900px] overflow-auto shadow-inner",children:n.jsx("div",{className:"scale-[0.85] origin-top flex justify-center overflow-visible",children:n.jsx(Q0,{data:l})})})]}):n.jsx("div",{className:"text-center text-textMuted border border-dashed border-borderDark rounded-2xl p-6 bg-navySecondary",children:u.collapsedHint}),n.jsx("div",{className:"flex justify-start mt-4",children:n.jsx("button",{onClick:()=>r("STEP2"),className:"px-6 py-2 bg-borderDark text-textLight rounded hover:bg-borderDark",children:u.backToEditing})})]})})()]})}),l&&n.jsx(fN,{isOpen:rt,isSending:j,report:l,userId:e==null?void 0:e.id,recipientsPreview:pa(l),defaultSubject:is(l),subjectDraft:((Fo=l.emailSubjectDraft)==null?void 0:Fo.trim())||is(l),onSubjectDraftChange:u=>$t({emailSubjectDraft:u&&u.trim()?u.trim():void 0}),selectedTopics:l.fileNameTitles||[],onSelectedTopicsChange:u=>$t({fileNameTitles:u}),isResendMode:J,onClose:()=>{j||(pe(!1),qe(!1))},onSend:J?Ti:Ii}),l&&n.jsx(xN,{isOpen:me,availableTitles:Po,selectedTitles:Ui,onClose:()=>he(!1),onSave:u=>{const f=u.map(S=>S.trim()).filter(Boolean);$t({fileNameTitles:f}),he(!1)}}),n.jsx(Zb,{isOpen:je,onClose:()=>{Be(!1)},view:s,currentUser:e,currentReport:l,loading:Ve,error:Ke,response:Z,onRunIntent:At}),k&&n.jsx("div",{className:"fixed inset-0 bg-black/40 z-[200] flex items-center justify-center p-4",children:n.jsxs("div",{className:"bg-panel rounded-xl shadow-xl w-full max-w-md p-6 space-y-4",children:[n.jsxs("h3",{className:"text-lg font-bold text-textLight flex items-center gap-2",children:[n.jsx(ku,{className:"w-4 h-4"})," Add Note"]}),n.jsxs("p",{className:"text-sm text-textMuted",children:["Case: ",k.insuredName||k.odakanitNo||k.id]}),n.jsx(mo,{clientId:go,children:n.jsx("textarea",{className:"w-full border rounded p-3 text-sm",rows:4,value:ee,onChange:u=>V(u.target.value),placeholder:"Write your note..."})}),n.jsxs("div",{className:"flex justify-end gap-2",children:[n.jsx("button",{onClick:()=>{C(null),V("")},className:"px-4 py-2 text-textMuted hover:bg-navySecondary rounded",children:"Cancel"}),n.jsx("button",{onClick:()=>{k&&ee.trim()&&(Ci(k.id,ee.trim()),C(null),V(""))},className:"px-4 py-2 bg-navy text-white rounded hover:bg-navySecondary",children:"Save"})]})]})}),_&&n.jsx("div",{className:"fixed inset-0 bg-black/40 z-[200] flex items-center justify-center p-4",children:n.jsxs("div",{className:"bg-panel rounded-xl shadow-xl w-full max-w-md p-6 space-y-4",children:[n.jsxs("h3",{className:"text-lg font-bold text-textLight flex items-center gap-2",children:[n.jsx(Gl,{className:"w-4 h-4"})," Send Reminder"]}),n.jsxs("p",{className:"text-sm text-textMuted",children:["Case: ",_.insuredName||_.odakanitNo||_.id]}),n.jsx("label",{className:"text-xs font-bold text-textMuted",children:"Recipients"}),n.jsxs("select",{className:"w-full border rounded p-2 text-sm",value:fe,onChange:u=>se(u.target.value),children:[n.jsx("option",{value:"LAWYER",children:"Lawyer"}),n.jsx("option",{value:"SUB_ADMIN",children:"Sub-Admin"}),n.jsx("option",{value:"BOTH",children:"Both"})]}),n.jsx("label",{className:"text-xs font-bold text-textMuted",children:"Message"}),n.jsx(mo,{clientId:go,children:n.jsx("textarea",{className:"w-full border rounded p-3 text-sm",rows:4,value:X,onChange:u=>ie(u.target.value),placeholder:"Reminder details..."})}),n.jsxs("div",{className:"flex justify-end gap-2",children:[n.jsx("button",{onClick:()=>{P(null),ie("")},className:"px-4 py-2 text-textMuted hover:bg-navySecondary rounded",children:"Cancel"}),n.jsx("button",{onClick:()=>{if(_&&X.trim()){const u=[];(fe==="LAWYER"||fe==="BOTH")&&u.push(_.ownerName),(fe==="SUB_ADMIN"||fe==="BOTH")&&u.push(...hs.filter(f=>f.role==="SUB_ADMIN").map(f=>f.name)),As({id:`reminder-${Date.now()}`,message:`Reminder to ${u.join(", ")}: ${X.trim()}`,createdAt:new Date().toISOString(),reportId:_.id}),P(null),ie("")}},className:"px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700",children:"Send"})]})]})}),Me&&Me.issues.length>0&&n.jsx("div",{className:"fixed inset-0 bg-black/40 z-[210] flex items-center justify-center p-4",children:n.jsxs("div",{className:"bg-panel rounded-2xl shadow-2xl w-full max-w-lg p-6 space-y-4",dir:"rtl",children:[n.jsxs("div",{className:"flex items-center justify-between gap-2",children:[n.jsx("h3",{className:"text-lg font-bold text-textLight",children:"  "}),n.jsx("button",{type:"button",onClick:()=>Ye(null),className:"p-1 rounded hover:bg-slate-100 text-textMuted",children:n.jsx(_t,{className:"w-4 h-4"})})]}),n.jsx("p",{className:"text-xs text-textMuted",children:"       PDF    .       ."}),n.jsx("ul",{className:"space-y-2 text-sm text-textLight",children:Me.issues.map(u=>n.jsxs("li",{className:"flex items-start justify-between gap-3 border border-slate-100 rounded-md px-3 py-2 bg-slate-50",children:[n.jsx("span",{className:"flex-1",children:u.label}),n.jsxs("div",{className:"flex flex-col items-end gap-1",children:[n.jsx("button",{type:"button",className:"text-[11px] text-indigo-700 hover:text-indigo-900 underline whitespace-nowrap",onClick:()=>{Be(!0),At(u.intent)},children:"  ?"}),n.jsx("button",{type:"button",className:"text-[11px] text-textLight hover:text-textLight underline whitespace-nowrap",onClick:()=>{Ye(null),(u.kind==="TRANSLATION_OUTDATED"||u.kind==="TONE_RISK_NOT_RUN"||u.kind==="EXPENSES_OLD")&&(Zt(),r("STEP2"))},children:u.kind==="TRANSLATION_OUTDATED"?" ":u.kind==="TONE_RISK_NOT_RUN"?" Tone & Risk":u.kind==="EXPENSES_OLD"?"  ":" "})]})]},u.id))}),n.jsx("div",{className:"flex items-center justify-between pt-3 border-t border-slate-100 gap-3",children:n.jsx("button",{type:"button",className:"px-4 py-1.5 rounded-md bg-green-600 text-xs text-white hover:bg-green-700",onClick:()=>{const u=Me;Ye(null),u!=null&&u.onContinue&&u.onContinue()},children:"  "})})]})}),Er&&n.jsx(Tv,{report:Er,sessions:zi,onSwitch:ae,onClose:ma,currentUser:e,onAddRowNote:Li,onResolveRowNote:Oi,onAddWorksheetRow:Mi,previousReport:a.filter(u=>u.id!==Er.id&&u.odakanitNo&&u.odakanitNo===Er.odakanitNo).sort((u,f)=>new Date(f.reportDate).getTime()-new Date(u.reportDate).getTime())[0]})]})},Tv=({report:e,sessions:t,onSwitch:s,onClose:r,currentUser:a,onAddRowNote:o,onResolveRowNote:l,onAddWorksheetRow:i,previousReport:c})=>{const[m,p]=y.useState("table"),[h,v]=y.useState(""),[A,D]=y.useState(null),[I,W]=y.useState({category:"EXPERT_OUR",serviceProvider:"",amount:"",customLabel:""}),N=e.expenseWorksheet||_s(),x=N.rows.filter(E=>E.type==="EXPENSE"),b=N.rows.filter(E=>E.type==="ADJUSTMENT"),B=N.notes.filter(E=>!E.resolved),H=N.totals||si(N.rows),z=(a==null?void 0:a.role)==="FINANCE"||(a==null?void 0:a.role)==="SUB_ADMIN",Y=ns.find(E=>E.value===I.category),Q=(Y==null?void 0:Y.type)!=="ADJUSTMENT",G=E=>{h.trim()&&(o(e.id,E,h.trim()),v(""),D(null))},ae=()=>{const E=parseFloat(I.amount);isNaN(E)||E<=0||(i(e.id,{category:I.category,serviceProvider:Q?I.serviceProvider:void 0,amount:E,customLabel:I.customLabel}),W({category:"EXPERT_OUR",serviceProvider:"",amount:"",customLabel:""}))};return n.jsx("div",{className:"fixed inset-0 bg-black/40 z-[220] flex items-center justify-center p-4",children:n.jsxs("div",{className:"bg-panel rounded-2xl shadow-2xl w-full max-w-5xl max-h-[90vh] overflow-hidden flex flex-col",children:[n.jsxs("div",{className:"flex justify-between items-center px-5 py-3 border-b bg-navySecondary",children:[n.jsxs("div",{children:[n.jsx("p",{className:"text-xs text-textMuted uppercase",children:"Expense Worksheet"}),n.jsxs("h2",{className:"text-lg font-bold text-textLight",children:[e.insuredName||e.odakanitNo||"Case","  ",e.ownerName]})]}),n.jsx("button",{onClick:()=>r(e.id),className:"text-textMuted hover:text-textLight",children:n.jsx(_t,{className:"w-5 h-5"})})]}),n.jsx("div",{className:"flex border-b bg-panel px-4 overflow-x-auto",children:t.map(E=>n.jsxs("button",{onClick:()=>s(E.reportId),className:`flex items-center gap-2 px-3 py-2 text-sm border-b-2 ${E.reportId===e.id?"border-lpBlue text-lpBlue font-bold":"border-transparent text-gray-400"}`,children:[E.title,n.jsx("span",{onClick:R=>{R.stopPropagation(),r(E.reportId)},className:"text-gray-400 hover:text-red-500",children:n.jsx(_t,{className:"w-3 h-3"})})]},E.reportId))}),n.jsx("div",{className:"flex gap-2 px-5 pt-4 text-sm font-semibold",children:["table","history","notes","compare"].map(E=>n.jsx("button",{onClick:()=>p(E),className:`px-3 py-1 rounded-full ${m===E?"bg-navy text-white":"bg-navySecondary text-textMuted"}`,children:E==="table"?"Worksheet":E==="history"?"History":E==="notes"?`Notes (${B.length})`:"Compare"},E))}),n.jsxs("div",{className:"flex-1 overflow-auto p-5 space-y-4",children:[m==="table"&&n.jsxs(n.Fragment,{children:[n.jsxs("div",{className:"grid grid-cols-3 gap-4 text-center bg-navySecondary rounded-lg py-3",children:[n.jsxs("div",{children:[n.jsx("p",{className:"text-xs uppercase text-gray-400",children:"Total Expenses"}),n.jsxs("p",{className:"text-lg font-bold text-textLight",children:["",H.totalExpenses.toLocaleString()]})]}),n.jsxs("div",{children:[n.jsx("p",{className:"text-xs uppercase text-gray-400",children:"Adjustments"}),n.jsxs("p",{className:"text-lg font-bold text-yellow-700",children:["",H.totalAdjustments.toLocaleString()]})]}),n.jsxs("div",{children:[n.jsx("p",{className:"text-xs uppercase text-gray-400",children:"Balance Due"}),n.jsxs("p",{className:"text-lg font-bold text-green-700",children:["",H.totalBalance.toLocaleString()]})]})]}),z&&n.jsxs("div",{className:"border rounded-lg p-3 bg-amber-50 space-y-2",children:[n.jsx("p",{className:"text-xs font-bold text-amber-700",children:"  "}),n.jsxs("div",{className:"grid md:grid-cols-3 gap-2",children:[n.jsx("select",{value:I.category,onChange:E=>W({...I,category:E.target.value}),className:"border rounded text-xs p-2",children:ns.map(E=>n.jsx("option",{value:E.value,children:E.label},E.value))}),I.category==="OTHER"&&n.jsx("input",{className:"border rounded text-xs p-2",placeholder:" ",value:I.customLabel,onChange:E=>W({...I,customLabel:E.target.value})}),Q&&n.jsx("input",{className:"border rounded text-xs p-2",placeholder:" ",value:I.serviceProvider,onChange:E=>W({...I,serviceProvider:E.target.value})}),n.jsx("input",{className:"border rounded text-xs p-2",placeholder:" ",type:"number",min:"0",value:I.amount,onChange:E=>W({...I,amount:E.target.value})}),n.jsx("button",{onClick:ae,className:"bg-amber-500 text-white rounded text-xs font-bold px-3 py-2 hover:bg-amber-600",children:"Add"})]})]}),n.jsxs("div",{className:"grid md:grid-cols-2 gap-6",children:[n.jsxs("div",{children:[n.jsx("h4",{className:"text-sm font-bold text-textMuted mb-2",children:"Service Expenses"}),n.jsxs("div",{className:"space-y-2",children:[x.length===0&&n.jsx("p",{className:"text-xs text-gray-400",children:"No expenses recorded."}),x.map(E=>{const R=N.notes.filter(k=>k.rowId===E.id&&!k.resolved).length;return n.jsxs("div",{className:"border rounded-lg p-3 bg-panel shadow-sm",children:[n.jsxs("div",{className:"flex justify-between",children:[n.jsxs("div",{children:[n.jsx("p",{className:"font-semibold text-sm",children:E.label}),E.serviceProvider&&n.jsx("p",{className:"text-xs text-textMuted",children:E.serviceProvider})]}),n.jsxs("div",{className:"text-right",children:[n.jsxs("p",{className:"font-bold text-lpBlue",children:["",E.amount.toLocaleString()]}),n.jsxs("button",{className:"text-[10px] text-gray-400",onClick:()=>D(A===E.id?null:E.id),children:[" Notes (",R,")"]})]})]}),A===E.id&&n.jsxs("div",{className:"mt-2 flex gap-2",children:[n.jsx("input",{className:"flex-1 border rounded text-xs p-2",value:h,onChange:k=>v(k.target.value),placeholder:"Add note..."}),n.jsx("button",{onClick:()=>G(E.id),className:"px-3 py-1 text-xs bg-navy text-white rounded",children:"Save"})]})]},E.id)})]})]}),n.jsxs("div",{children:[n.jsx("h4",{className:"text-sm font-bold text-textMuted mb-2",children:"Adjustments"}),n.jsxs("div",{className:"space-y-2",children:[b.length===0&&n.jsx("p",{className:"text-xs text-gray-400",children:"No adjustments yet."}),b.map(E=>n.jsx("div",{className:"border rounded-lg p-3 bg-navySecondary",children:n.jsxs("div",{className:"flex justify-between",children:[n.jsx("p",{className:"font-semibold text-sm",children:E.label}),n.jsxs("p",{className:"font-bold text-red-600",children:["",E.amount.toLocaleString()]})]})},E.id))]})]})]}),n.jsxs("div",{className:"border rounded-lg p-3 bg-navySecondary",children:[n.jsx("label",{className:"block text-xs font-bold text-textMuted mb-1",children:"General Note"}),n.jsxs("div",{className:"flex gap-2",children:[n.jsx("input",{className:"flex-1 border rounded text-xs p-2",value:h,onChange:E=>v(E.target.value),placeholder:"Add note for worksheet..."}),n.jsx("button",{onClick:()=>G(void 0),className:"px-3 py-1 text-xs bg-navy text-white rounded",children:"Save"})]})]})]}),m==="history"&&n.jsxs("div",{className:"space-y-2",children:[N.history.length===0&&n.jsx("p",{className:"text-xs text-gray-400",children:"No history recorded yet."}),N.history.map(E=>n.jsxs("div",{className:"border rounded-lg p-3 bg-panel flex justify-between",children:[n.jsxs("div",{children:[n.jsx("p",{className:"text-sm font-semibold",children:E.action}),E.details&&n.jsx("p",{className:"text-xs text-textMuted",children:E.details})]}),n.jsxs("div",{className:"text-right text-[10px] text-gray-400",children:[n.jsx("p",{children:E.userName}),n.jsx("p",{children:new Date(E.timestamp).toLocaleString()})]})]},E.id))]}),m==="notes"&&n.jsxs("div",{className:"space-y-2",children:[N.notes.length===0&&n.jsx("p",{className:"text-xs text-gray-400",children:"No notes yet."}),N.notes.map(E=>n.jsx("div",{className:`border rounded-lg p-3 ${E.resolved?"bg-green-50":"bg-panel"}`,children:n.jsxs("div",{className:"flex justify-between",children:[n.jsxs("div",{children:[n.jsx("p",{className:"text-sm font-semibold",children:E.authorName}),n.jsx("p",{className:"text-xs text-textMuted",children:E.message})]}),n.jsxs("div",{className:"text-right text-[10px] text-gray-400",children:[n.jsx("p",{children:new Date(E.createdAt).toLocaleString()}),!E.resolved&&n.jsx("button",{onClick:()=>l(e.id,E.id),className:"text-xs text-green-600 hover:underline",children:"Resolve"})]})]})},E.id))]}),m==="compare"&&n.jsx("div",{children:c!=null&&c.expenseWorksheet?n.jsxs("div",{className:"grid md:grid-cols-2 gap-4",children:[n.jsxs("div",{className:"border rounded-lg p-3",children:[n.jsx("h4",{className:"text-sm font-bold text-textMuted mb-2",children:"Previous Report"}),n.jsx("p",{className:"text-xs text-gray-400 mb-2",children:new Date(c.reportDate).toLocaleDateString()}),n.jsxs("p",{className:"text-lg font-bold text-textLight",children:["",c.expenseWorksheet.totals.totalBalance.toLocaleString()]})]}),n.jsxs("div",{className:"border rounded-lg p-3",children:[n.jsx("h4",{className:"text-sm font-bold text-textMuted mb-2",children:"Current Report"}),n.jsx("p",{className:"text-xs text-gray-400 mb-2",children:new Date(e.reportDate).toLocaleDateString()}),n.jsxs("p",{className:"text-lg font-bold text-textLight",children:["",H.totalBalance.toLocaleString()]})]})]}):n.jsx("p",{className:"text-xs text-gray-400",children:"No previous worksheet available for comparison."})})]})]})})},Rv=()=>n.jsx(Ub,{children:n.jsx(Iv,{})}),Hu=document.getElementById("root");console.log("Bootstrapping LP app, rootElement exists?",!!Hu);if(!Hu)throw new Error("Could not find root element to mount to");const Cv=Cc.createRoot(Hu);Cv.render(n.jsx(oi.StrictMode,{children:n.jsx(Rv,{})}));export{Bh as g};
