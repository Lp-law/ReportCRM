(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))r(a);new MutationObserver(a=>{for(const o of a)if(o.type==="childList")for(const l of o.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&r(l)}).observe(document,{childList:!0,subtree:!0});function s(a){const o={};return a.integrity&&(o.integrity=a.integrity),a.referrerPolicy&&(o.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?o.credentials="include":a.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function r(a){if(a.ep)return;a.ep=!0;const o=s(a);fetch(a.href,o)}})();function Gh(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var Kp={exports:{}},ii={},Yp={exports:{}},Xe={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Eo=Symbol.for("react.element"),qh=Symbol.for("react.portal"),Xh=Symbol.for("react.fragment"),Jh=Symbol.for("react.strict_mode"),Qh=Symbol.for("react.profiler"),Zh=Symbol.for("react.provider"),eg=Symbol.for("react.context"),tg=Symbol.for("react.forward_ref"),ng=Symbol.for("react.suspense"),sg=Symbol.for("react.memo"),rg=Symbol.for("react.lazy"),Xu=Symbol.iterator;function ag(e){return e===null||typeof e!="object"?null:(e=Xu&&e[Xu]||e["@@iterator"],typeof e=="function"?e:null)}var Gp={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},qp=Object.assign,Xp={};function ia(e,t,s){this.props=e,this.context=t,this.refs=Xp,this.updater=s||Gp}ia.prototype.isReactComponent={};ia.prototype.setState=function(e,t){if(typeof e!="object"&&typeof e!="function"&&e!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,e,t,"setState")};ia.prototype.forceUpdate=function(e){this.updater.enqueueForceUpdate(this,e,"forceUpdate")};function Jp(){}Jp.prototype=ia.prototype;function Pd(e,t,s){this.props=e,this.context=t,this.refs=Xp,this.updater=s||Gp}var Fd=Pd.prototype=new Jp;Fd.constructor=Pd;qp(Fd,ia.prototype);Fd.isPureReactComponent=!0;var Ju=Array.isArray,Qp=Object.prototype.hasOwnProperty,Bd={current:null},Zp={key:!0,ref:!0,__self:!0,__source:!0};function ef(e,t,s){var r,a={},o=null,l=null;if(t!=null)for(r in t.ref!==void 0&&(l=t.ref),t.key!==void 0&&(o=""+t.key),t)Qp.call(t,r)&&!Zp.hasOwnProperty(r)&&(a[r]=t[r]);var c=arguments.length-2;if(c===1)a.children=s;else if(1<c){for(var i=Array(c),u=0;u<c;u++)i[u]=arguments[u+2];a.children=i}if(e&&e.defaultProps)for(r in c=e.defaultProps,c)a[r]===void 0&&(a[r]=c[r]);return{$$typeof:Eo,type:e,key:o,ref:l,props:a,_owner:Bd.current}}function og(e,t){return{$$typeof:Eo,type:e.type,key:t,ref:e.ref,props:e.props,_owner:e._owner}}function $d(e){return typeof e=="object"&&e!==null&&e.$$typeof===Eo}function lg(e){var t={"=":"=0",":":"=2"};return"$"+e.replace(/[=:]/g,function(s){return t[s]})}var Qu=/\/+/g;function Ji(e,t){return typeof e=="object"&&e!==null&&e.key!=null?lg(""+e.key):t.toString(36)}function fl(e,t,s,r,a){var o=typeof e;(o==="undefined"||o==="boolean")&&(e=null);var l=!1;if(e===null)l=!0;else switch(o){case"string":case"number":l=!0;break;case"object":switch(e.$$typeof){case Eo:case qh:l=!0}}if(l)return l=e,a=a(l),e=r===""?"."+Ji(l,0):r,Ju(a)?(s="",e!=null&&(s=e.replace(Qu,"$&/")+"/"),fl(a,t,s,"",function(u){return u})):a!=null&&($d(a)&&(a=og(a,s+(!a.key||l&&l.key===a.key?"":(""+a.key).replace(Qu,"$&/")+"/")+e)),t.push(a)),1;if(l=0,r=r===""?".":r+":",Ju(e))for(var c=0;c<e.length;c++){o=e[c];var i=r+Ji(o,c);l+=fl(o,t,s,i,a)}else if(i=ag(e),typeof i=="function")for(e=i.call(e),c=0;!(o=e.next()).done;)o=o.value,i=r+Ji(o,c++),l+=fl(o,t,s,i,a);else if(o==="object")throw t=String(e),Error("Objects are not valid as a React child (found: "+(t==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":t)+"). If you meant to render a collection of children, use an array instead.");return l}function Wo(e,t,s){if(e==null)return e;var r=[],a=0;return fl(e,r,"","",function(o){return t.call(s,o,a++)}),r}function ig(e){if(e._status===-1){var t=e._result;t=t(),t.then(function(s){(e._status===0||e._status===-1)&&(e._status=1,e._result=s)},function(s){(e._status===0||e._status===-1)&&(e._status=2,e._result=s)}),e._status===-1&&(e._status=0,e._result=t)}if(e._status===1)return e._result.default;throw e._result}var rn={current:null},xl={transition:null},cg={ReactCurrentDispatcher:rn,ReactCurrentBatchConfig:xl,ReactCurrentOwner:Bd};function tf(){throw Error("act(...) is not supported in production builds of React.")}Xe.Children={map:Wo,forEach:function(e,t,s){Wo(e,function(){t.apply(this,arguments)},s)},count:function(e){var t=0;return Wo(e,function(){t++}),t},toArray:function(e){return Wo(e,function(t){return t})||[]},only:function(e){if(!$d(e))throw Error("React.Children.only expected to receive a single React element child.");return e}};Xe.Component=ia;Xe.Fragment=Xh;Xe.Profiler=Qh;Xe.PureComponent=Pd;Xe.StrictMode=Jh;Xe.Suspense=ng;Xe.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=cg;Xe.act=tf;Xe.cloneElement=function(e,t,s){if(e==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+e+".");var r=qp({},e.props),a=e.key,o=e.ref,l=e._owner;if(t!=null){if(t.ref!==void 0&&(o=t.ref,l=Bd.current),t.key!==void 0&&(a=""+t.key),e.type&&e.type.defaultProps)var c=e.type.defaultProps;for(i in t)Qp.call(t,i)&&!Zp.hasOwnProperty(i)&&(r[i]=t[i]===void 0&&c!==void 0?c[i]:t[i])}var i=arguments.length-2;if(i===1)r.children=s;else if(1<i){c=Array(i);for(var u=0;u<i;u++)c[u]=arguments[u+2];r.children=c}return{$$typeof:Eo,type:e.type,key:a,ref:o,props:r,_owner:l}};Xe.createContext=function(e){return e={$$typeof:eg,_currentValue:e,_currentValue2:e,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},e.Provider={$$typeof:Zh,_context:e},e.Consumer=e};Xe.createElement=ef;Xe.createFactory=function(e){var t=ef.bind(null,e);return t.type=e,t};Xe.createRef=function(){return{current:null}};Xe.forwardRef=function(e){return{$$typeof:tg,render:e}};Xe.isValidElement=$d;Xe.lazy=function(e){return{$$typeof:rg,_payload:{_status:-1,_result:e},_init:ig}};Xe.memo=function(e,t){return{$$typeof:sg,type:e,compare:t===void 0?null:t}};Xe.startTransition=function(e){var t=xl.transition;xl.transition={};try{e()}finally{xl.transition=t}};Xe.unstable_act=tf;Xe.useCallback=function(e,t){return rn.current.useCallback(e,t)};Xe.useContext=function(e){return rn.current.useContext(e)};Xe.useDebugValue=function(){};Xe.useDeferredValue=function(e){return rn.current.useDeferredValue(e)};Xe.useEffect=function(e,t){return rn.current.useEffect(e,t)};Xe.useId=function(){return rn.current.useId()};Xe.useImperativeHandle=function(e,t,s){return rn.current.useImperativeHandle(e,t,s)};Xe.useInsertionEffect=function(e,t){return rn.current.useInsertionEffect(e,t)};Xe.useLayoutEffect=function(e,t){return rn.current.useLayoutEffect(e,t)};Xe.useMemo=function(e,t){return rn.current.useMemo(e,t)};Xe.useReducer=function(e,t,s){return rn.current.useReducer(e,t,s)};Xe.useRef=function(e){return rn.current.useRef(e)};Xe.useState=function(e){return rn.current.useState(e)};Xe.useSyncExternalStore=function(e,t,s){return rn.current.useSyncExternalStore(e,t,s)};Xe.useTransition=function(){return rn.current.useTransition()};Xe.version="18.3.1";Yp.exports=Xe;var g=Yp.exports;const ci=Gh(g);/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var dg=g,ug=Symbol.for("react.element"),mg=Symbol.for("react.fragment"),pg=Object.prototype.hasOwnProperty,fg=dg.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,xg={key:!0,ref:!0,__self:!0,__source:!0};function nf(e,t,s){var r,a={},o=null,l=null;s!==void 0&&(o=""+s),t.key!==void 0&&(o=""+t.key),t.ref!==void 0&&(l=t.ref);for(r in t)pg.call(t,r)&&!xg.hasOwnProperty(r)&&(a[r]=t[r]);if(e&&e.defaultProps)for(r in t=e.defaultProps,t)a[r]===void 0&&(a[r]=t[r]);return{$$typeof:ug,type:e,key:o,ref:l,props:a,_owner:fg.current}}ii.Fragment=mg;ii.jsx=nf;ii.jsxs=nf;Kp.exports=ii;var n=Kp.exports,Pc={},sf={exports:{}},bn={},rf={exports:{}},af={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(e){function t(P,X){var ue=P.length;P.push(X);e:for(;0<ue;){var xe=ue-1>>>1,oe=P[xe];if(0<a(oe,X))P[xe]=X,P[ue]=oe,ue=xe;else break e}}function s(P){return P.length===0?null:P[0]}function r(P){if(P.length===0)return null;var X=P[0],ue=P.pop();if(ue!==X){P[0]=ue;e:for(var xe=0,oe=P.length,fe=oe>>>1;xe<fe;){var ve=2*(xe+1)-1,_e=P[ve],ze=ve+1,qe=P[ze];if(0>a(_e,ue))ze<oe&&0>a(qe,_e)?(P[xe]=qe,P[ze]=ue,xe=ze):(P[xe]=_e,P[ve]=ue,xe=ve);else if(ze<oe&&0>a(qe,ue))P[xe]=qe,P[ze]=ue,xe=ze;else break e}}return X}function a(P,X){var ue=P.sortIndex-X.sortIndex;return ue!==0?ue:P.id-X.id}if(typeof performance=="object"&&typeof performance.now=="function"){var o=performance;e.unstable_now=function(){return o.now()}}else{var l=Date,c=l.now();e.unstable_now=function(){return l.now()-c}}var i=[],u=[],p=1,y=null,S=3,w=!1,L=!1,k=!1,U=typeof setTimeout=="function"?setTimeout:null,N=typeof clearTimeout=="function"?clearTimeout:null,x=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function b(P){for(var X=s(u);X!==null;){if(X.callback===null)r(u);else if(X.startTime<=P)r(u),X.sortIndex=X.expirationTime,t(i,X);else break;X=s(u)}}function F(P){if(k=!1,b(P),!L)if(s(i)!==null)L=!0,Y(H);else{var X=s(u);X!==null&&O(F,X.startTime-P)}}function H(P,X){L=!1,k&&(k=!1,N(te),te=-1),w=!0;var ue=S;try{for(b(X),y=s(i);y!==null&&(!(y.expirationTime>X)||P&&!j());){var xe=y.callback;if(typeof xe=="function"){y.callback=null,S=y.priorityLevel;var oe=xe(y.expirationTime<=X);X=e.unstable_now(),typeof oe=="function"?y.callback=oe:y===s(i)&&r(i),b(X)}else r(i);y=s(i)}if(y!==null)var fe=!0;else{var ve=s(u);ve!==null&&O(F,ve.startTime-X),fe=!1}return fe}finally{y=null,S=ue,w=!1}}var V=!1,q=null,te=-1,G=5,le=-1;function j(){return!(e.unstable_now()-le<G)}function T(){if(q!==null){var P=e.unstable_now();le=P;var X=!0;try{X=q(!0,P)}finally{X?E():(V=!1,q=null)}}else V=!1}var E;if(typeof x=="function")E=function(){x(T)};else if(typeof MessageChannel<"u"){var C=new MessageChannel,se=C.port2;C.port1.onmessage=T,E=function(){se.postMessage(null)}}else E=function(){U(T,0)};function Y(P){q=P,V||(V=!0,E())}function O(P,X){te=U(function(){P(e.unstable_now())},X)}e.unstable_IdlePriority=5,e.unstable_ImmediatePriority=1,e.unstable_LowPriority=4,e.unstable_NormalPriority=3,e.unstable_Profiling=null,e.unstable_UserBlockingPriority=2,e.unstable_cancelCallback=function(P){P.callback=null},e.unstable_continueExecution=function(){L||w||(L=!0,Y(H))},e.unstable_forceFrameRate=function(P){0>P||125<P?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):G=0<P?Math.floor(1e3/P):5},e.unstable_getCurrentPriorityLevel=function(){return S},e.unstable_getFirstCallbackNode=function(){return s(i)},e.unstable_next=function(P){switch(S){case 1:case 2:case 3:var X=3;break;default:X=S}var ue=S;S=X;try{return P()}finally{S=ue}},e.unstable_pauseExecution=function(){},e.unstable_requestPaint=function(){},e.unstable_runWithPriority=function(P,X){switch(P){case 1:case 2:case 3:case 4:case 5:break;default:P=3}var ue=S;S=P;try{return X()}finally{S=ue}},e.unstable_scheduleCallback=function(P,X,ue){var xe=e.unstable_now();switch(typeof ue=="object"&&ue!==null?(ue=ue.delay,ue=typeof ue=="number"&&0<ue?xe+ue:xe):ue=xe,P){case 1:var oe=-1;break;case 2:oe=250;break;case 5:oe=1073741823;break;case 4:oe=1e4;break;default:oe=5e3}return oe=ue+oe,P={id:p++,callback:X,priorityLevel:P,startTime:ue,expirationTime:oe,sortIndex:-1},ue>xe?(P.sortIndex=ue,t(u,P),s(i)===null&&P===s(u)&&(k?(N(te),te=-1):k=!0,O(F,ue-xe))):(P.sortIndex=oe,t(i,P),L||w||(L=!0,Y(H))),P},e.unstable_shouldYield=j,e.unstable_wrapCallback=function(P){var X=S;return function(){var ue=S;S=X;try{return P.apply(this,arguments)}finally{S=ue}}}})(af);rf.exports=af;var hg=rf.exports;/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var gg=g,Nn=hg;function pe(e){for(var t="https://reactjs.org/docs/error-decoder.html?invariant="+e,s=1;s<arguments.length;s++)t+="&args[]="+encodeURIComponent(arguments[s]);return"Minified React error #"+e+"; visit "+t+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var of=new Set,Ja={};function vr(e,t){Qr(e,t),Qr(e+"Capture",t)}function Qr(e,t){for(Ja[e]=t,e=0;e<t.length;e++)of.add(t[e])}var ws=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),Fc=Object.prototype.hasOwnProperty,yg=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,Zu={},em={};function Ng(e){return Fc.call(em,e)?!0:Fc.call(Zu,e)?!1:yg.test(e)?em[e]=!0:(Zu[e]=!0,!1)}function bg(e,t,s,r){if(s!==null&&s.type===0)return!1;switch(typeof t){case"function":case"symbol":return!0;case"boolean":return r?!1:s!==null?!s.acceptsBooleans:(e=e.toLowerCase().slice(0,5),e!=="data-"&&e!=="aria-");default:return!1}}function vg(e,t,s,r){if(t===null||typeof t>"u"||bg(e,t,s,r))return!0;if(r)return!1;if(s!==null)switch(s.type){case 3:return!t;case 4:return t===!1;case 5:return isNaN(t);case 6:return isNaN(t)||1>t}return!1}function an(e,t,s,r,a,o,l){this.acceptsBooleans=t===2||t===3||t===4,this.attributeName=r,this.attributeNamespace=a,this.mustUseProperty=s,this.propertyName=e,this.type=t,this.sanitizeURL=o,this.removeEmptyString=l}var Kt={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(e){Kt[e]=new an(e,0,!1,e,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(e){var t=e[0];Kt[t]=new an(t,1,!1,e[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(e){Kt[e]=new an(e,2,!1,e.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(e){Kt[e]=new an(e,2,!1,e,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(e){Kt[e]=new an(e,3,!1,e.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(e){Kt[e]=new an(e,3,!0,e,null,!1,!1)});["capture","download"].forEach(function(e){Kt[e]=new an(e,4,!1,e,null,!1,!1)});["cols","rows","size","span"].forEach(function(e){Kt[e]=new an(e,6,!1,e,null,!1,!1)});["rowSpan","start"].forEach(function(e){Kt[e]=new an(e,5,!1,e.toLowerCase(),null,!1,!1)});var Hd=/[\-:]([a-z])/g;function Ud(e){return e[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(e){var t=e.replace(Hd,Ud);Kt[t]=new an(t,1,!1,e,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(e){var t=e.replace(Hd,Ud);Kt[t]=new an(t,1,!1,e,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(e){var t=e.replace(Hd,Ud);Kt[t]=new an(t,1,!1,e,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(e){Kt[e]=new an(e,1,!1,e.toLowerCase(),null,!1,!1)});Kt.xlinkHref=new an("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(e){Kt[e]=new an(e,1,!1,e.toLowerCase(),null,!0,!0)});function Wd(e,t,s,r){var a=Kt.hasOwnProperty(t)?Kt[t]:null;(a!==null?a.type!==0:r||!(2<t.length)||t[0]!=="o"&&t[0]!=="O"||t[1]!=="n"&&t[1]!=="N")&&(vg(t,s,a,r)&&(s=null),r||a===null?Ng(t)&&(s===null?e.removeAttribute(t):e.setAttribute(t,""+s)):a.mustUseProperty?e[a.propertyName]=s===null?a.type===3?!1:"":s:(t=a.attributeName,r=a.attributeNamespace,s===null?e.removeAttribute(t):(a=a.type,s=a===3||a===4&&s===!0?"":""+s,r?e.setAttributeNS(r,t,s):e.setAttribute(t,s))))}var As=gg.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,zo=Symbol.for("react.element"),Lr=Symbol.for("react.portal"),_r=Symbol.for("react.fragment"),zd=Symbol.for("react.strict_mode"),Bc=Symbol.for("react.profiler"),lf=Symbol.for("react.provider"),cf=Symbol.for("react.context"),Vd=Symbol.for("react.forward_ref"),$c=Symbol.for("react.suspense"),Hc=Symbol.for("react.suspense_list"),Kd=Symbol.for("react.memo"),_s=Symbol.for("react.lazy"),df=Symbol.for("react.offscreen"),tm=Symbol.iterator;function Ea(e){return e===null||typeof e!="object"?null:(e=tm&&e[tm]||e["@@iterator"],typeof e=="function"?e:null)}var wt=Object.assign,Qi;function Ma(e){if(Qi===void 0)try{throw Error()}catch(s){var t=s.stack.trim().match(/\n( *(at )?)/);Qi=t&&t[1]||""}return`
`+Qi+e}var Zi=!1;function ec(e,t){if(!e||Zi)return"";Zi=!0;var s=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(t)if(t=function(){throw Error()},Object.defineProperty(t.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(t,[])}catch(u){var r=u}Reflect.construct(e,[],t)}else{try{t.call()}catch(u){r=u}e.call(t.prototype)}else{try{throw Error()}catch(u){r=u}e()}}catch(u){if(u&&r&&typeof u.stack=="string"){for(var a=u.stack.split(`
`),o=r.stack.split(`
`),l=a.length-1,c=o.length-1;1<=l&&0<=c&&a[l]!==o[c];)c--;for(;1<=l&&0<=c;l--,c--)if(a[l]!==o[c]){if(l!==1||c!==1)do if(l--,c--,0>c||a[l]!==o[c]){var i=`
`+a[l].replace(" at new "," at ");return e.displayName&&i.includes("<anonymous>")&&(i=i.replace("<anonymous>",e.displayName)),i}while(1<=l&&0<=c);break}}}finally{Zi=!1,Error.prepareStackTrace=s}return(e=e?e.displayName||e.name:"")?Ma(e):""}function Sg(e){switch(e.tag){case 5:return Ma(e.type);case 16:return Ma("Lazy");case 13:return Ma("Suspense");case 19:return Ma("SuspenseList");case 0:case 2:case 15:return e=ec(e.type,!1),e;case 11:return e=ec(e.type.render,!1),e;case 1:return e=ec(e.type,!0),e;default:return""}}function Uc(e){if(e==null)return null;if(typeof e=="function")return e.displayName||e.name||null;if(typeof e=="string")return e;switch(e){case _r:return"Fragment";case Lr:return"Portal";case Bc:return"Profiler";case zd:return"StrictMode";case $c:return"Suspense";case Hc:return"SuspenseList"}if(typeof e=="object")switch(e.$$typeof){case cf:return(e.displayName||"Context")+".Consumer";case lf:return(e._context.displayName||"Context")+".Provider";case Vd:var t=e.render;return e=e.displayName,e||(e=t.displayName||t.name||"",e=e!==""?"ForwardRef("+e+")":"ForwardRef"),e;case Kd:return t=e.displayName||null,t!==null?t:Uc(e.type)||"Memo";case _s:t=e._payload,e=e._init;try{return Uc(e(t))}catch{}}return null}function wg(e){var t=e.type;switch(e.tag){case 24:return"Cache";case 9:return(t.displayName||"Context")+".Consumer";case 10:return(t._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return e=t.render,e=e.displayName||e.name||"",t.displayName||(e!==""?"ForwardRef("+e+")":"ForwardRef");case 7:return"Fragment";case 5:return t;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return Uc(t);case 8:return t===zd?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof t=="function")return t.displayName||t.name||null;if(typeof t=="string")return t}return null}function Qs(e){switch(typeof e){case"boolean":case"number":case"string":case"undefined":return e;case"object":return e;default:return""}}function uf(e){var t=e.type;return(e=e.nodeName)&&e.toLowerCase()==="input"&&(t==="checkbox"||t==="radio")}function jg(e){var t=uf(e)?"checked":"value",s=Object.getOwnPropertyDescriptor(e.constructor.prototype,t),r=""+e[t];if(!e.hasOwnProperty(t)&&typeof s<"u"&&typeof s.get=="function"&&typeof s.set=="function"){var a=s.get,o=s.set;return Object.defineProperty(e,t,{configurable:!0,get:function(){return a.call(this)},set:function(l){r=""+l,o.call(this,l)}}),Object.defineProperty(e,t,{enumerable:s.enumerable}),{getValue:function(){return r},setValue:function(l){r=""+l},stopTracking:function(){e._valueTracker=null,delete e[t]}}}}function Vo(e){e._valueTracker||(e._valueTracker=jg(e))}function mf(e){if(!e)return!1;var t=e._valueTracker;if(!t)return!0;var s=t.getValue(),r="";return e&&(r=uf(e)?e.checked?"true":"false":e.value),e=r,e!==s?(t.setValue(e),!0):!1}function Al(e){if(e=e||(typeof document<"u"?document:void 0),typeof e>"u")return null;try{return e.activeElement||e.body}catch{return e.body}}function Wc(e,t){var s=t.checked;return wt({},t,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:s??e._wrapperState.initialChecked})}function nm(e,t){var s=t.defaultValue==null?"":t.defaultValue,r=t.checked!=null?t.checked:t.defaultChecked;s=Qs(t.value!=null?t.value:s),e._wrapperState={initialChecked:r,initialValue:s,controlled:t.type==="checkbox"||t.type==="radio"?t.checked!=null:t.value!=null}}function pf(e,t){t=t.checked,t!=null&&Wd(e,"checked",t,!1)}function zc(e,t){pf(e,t);var s=Qs(t.value),r=t.type;if(s!=null)r==="number"?(s===0&&e.value===""||e.value!=s)&&(e.value=""+s):e.value!==""+s&&(e.value=""+s);else if(r==="submit"||r==="reset"){e.removeAttribute("value");return}t.hasOwnProperty("value")?Vc(e,t.type,s):t.hasOwnProperty("defaultValue")&&Vc(e,t.type,Qs(t.defaultValue)),t.checked==null&&t.defaultChecked!=null&&(e.defaultChecked=!!t.defaultChecked)}function sm(e,t,s){if(t.hasOwnProperty("value")||t.hasOwnProperty("defaultValue")){var r=t.type;if(!(r!=="submit"&&r!=="reset"||t.value!==void 0&&t.value!==null))return;t=""+e._wrapperState.initialValue,s||t===e.value||(e.value=t),e.defaultValue=t}s=e.name,s!==""&&(e.name=""),e.defaultChecked=!!e._wrapperState.initialChecked,s!==""&&(e.name=s)}function Vc(e,t,s){(t!=="number"||Al(e.ownerDocument)!==e)&&(s==null?e.defaultValue=""+e._wrapperState.initialValue:e.defaultValue!==""+s&&(e.defaultValue=""+s))}var Pa=Array.isArray;function Vr(e,t,s,r){if(e=e.options,t){t={};for(var a=0;a<s.length;a++)t["$"+s[a]]=!0;for(s=0;s<e.length;s++)a=t.hasOwnProperty("$"+e[s].value),e[s].selected!==a&&(e[s].selected=a),a&&r&&(e[s].defaultSelected=!0)}else{for(s=""+Qs(s),t=null,a=0;a<e.length;a++){if(e[a].value===s){e[a].selected=!0,r&&(e[a].defaultSelected=!0);return}t!==null||e[a].disabled||(t=e[a])}t!==null&&(t.selected=!0)}}function Kc(e,t){if(t.dangerouslySetInnerHTML!=null)throw Error(pe(91));return wt({},t,{value:void 0,defaultValue:void 0,children:""+e._wrapperState.initialValue})}function rm(e,t){var s=t.value;if(s==null){if(s=t.children,t=t.defaultValue,s!=null){if(t!=null)throw Error(pe(92));if(Pa(s)){if(1<s.length)throw Error(pe(93));s=s[0]}t=s}t==null&&(t=""),s=t}e._wrapperState={initialValue:Qs(s)}}function ff(e,t){var s=Qs(t.value),r=Qs(t.defaultValue);s!=null&&(s=""+s,s!==e.value&&(e.value=s),t.defaultValue==null&&e.defaultValue!==s&&(e.defaultValue=s)),r!=null&&(e.defaultValue=""+r)}function am(e){var t=e.textContent;t===e._wrapperState.initialValue&&t!==""&&t!==null&&(e.value=t)}function xf(e){switch(e){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function Yc(e,t){return e==null||e==="http://www.w3.org/1999/xhtml"?xf(t):e==="http://www.w3.org/2000/svg"&&t==="foreignObject"?"http://www.w3.org/1999/xhtml":e}var Ko,hf=function(e){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(t,s,r,a){MSApp.execUnsafeLocalFunction(function(){return e(t,s,r,a)})}:e}(function(e,t){if(e.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in e)e.innerHTML=t;else{for(Ko=Ko||document.createElement("div"),Ko.innerHTML="<svg>"+t.valueOf().toString()+"</svg>",t=Ko.firstChild;e.firstChild;)e.removeChild(e.firstChild);for(;t.firstChild;)e.appendChild(t.firstChild)}});function Qa(e,t){if(t){var s=e.firstChild;if(s&&s===e.lastChild&&s.nodeType===3){s.nodeValue=t;return}}e.textContent=t}var $a={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},Eg=["Webkit","ms","Moz","O"];Object.keys($a).forEach(function(e){Eg.forEach(function(t){t=t+e.charAt(0).toUpperCase()+e.substring(1),$a[t]=$a[e]})});function gf(e,t,s){return t==null||typeof t=="boolean"||t===""?"":s||typeof t!="number"||t===0||$a.hasOwnProperty(e)&&$a[e]?(""+t).trim():t+"px"}function yf(e,t){e=e.style;for(var s in t)if(t.hasOwnProperty(s)){var r=s.indexOf("--")===0,a=gf(s,t[s],r);s==="float"&&(s="cssFloat"),r?e.setProperty(s,a):e[s]=a}}var kg=wt({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function Gc(e,t){if(t){if(kg[e]&&(t.children!=null||t.dangerouslySetInnerHTML!=null))throw Error(pe(137,e));if(t.dangerouslySetInnerHTML!=null){if(t.children!=null)throw Error(pe(60));if(typeof t.dangerouslySetInnerHTML!="object"||!("__html"in t.dangerouslySetInnerHTML))throw Error(pe(61))}if(t.style!=null&&typeof t.style!="object")throw Error(pe(62))}}function qc(e,t){if(e.indexOf("-")===-1)return typeof t.is=="string";switch(e){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var Xc=null;function Yd(e){return e=e.target||e.srcElement||window,e.correspondingUseElement&&(e=e.correspondingUseElement),e.nodeType===3?e.parentNode:e}var Jc=null,Kr=null,Yr=null;function om(e){if(e=Io(e)){if(typeof Jc!="function")throw Error(pe(280));var t=e.stateNode;t&&(t=fi(t),Jc(e.stateNode,e.type,t))}}function Nf(e){Kr?Yr?Yr.push(e):Yr=[e]:Kr=e}function bf(){if(Kr){var e=Kr,t=Yr;if(Yr=Kr=null,om(e),t)for(e=0;e<t.length;e++)om(t[e])}}function vf(e,t){return e(t)}function Sf(){}var tc=!1;function wf(e,t,s){if(tc)return e(t,s);tc=!0;try{return vf(e,t,s)}finally{tc=!1,(Kr!==null||Yr!==null)&&(Sf(),bf())}}function Za(e,t){var s=e.stateNode;if(s===null)return null;var r=fi(s);if(r===null)return null;s=r[t];e:switch(t){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(r=!r.disabled)||(e=e.type,r=!(e==="button"||e==="input"||e==="select"||e==="textarea")),e=!r;break e;default:e=!1}if(e)return null;if(s&&typeof s!="function")throw Error(pe(231,t,typeof s));return s}var Qc=!1;if(ws)try{var ka={};Object.defineProperty(ka,"passive",{get:function(){Qc=!0}}),window.addEventListener("test",ka,ka),window.removeEventListener("test",ka,ka)}catch{Qc=!1}function Ag(e,t,s,r,a,o,l,c,i){var u=Array.prototype.slice.call(arguments,3);try{t.apply(s,u)}catch(p){this.onError(p)}}var Ha=!1,Il=null,Tl=!1,Zc=null,Ig={onError:function(e){Ha=!0,Il=e}};function Tg(e,t,s,r,a,o,l,c,i){Ha=!1,Il=null,Ag.apply(Ig,arguments)}function Rg(e,t,s,r,a,o,l,c,i){if(Tg.apply(this,arguments),Ha){if(Ha){var u=Il;Ha=!1,Il=null}else throw Error(pe(198));Tl||(Tl=!0,Zc=u)}}function Sr(e){var t=e,s=e;if(e.alternate)for(;t.return;)t=t.return;else{e=t;do t=e,t.flags&4098&&(s=t.return),e=t.return;while(e)}return t.tag===3?s:null}function jf(e){if(e.tag===13){var t=e.memoizedState;if(t===null&&(e=e.alternate,e!==null&&(t=e.memoizedState)),t!==null)return t.dehydrated}return null}function lm(e){if(Sr(e)!==e)throw Error(pe(188))}function Cg(e){var t=e.alternate;if(!t){if(t=Sr(e),t===null)throw Error(pe(188));return t!==e?null:e}for(var s=e,r=t;;){var a=s.return;if(a===null)break;var o=a.alternate;if(o===null){if(r=a.return,r!==null){s=r;continue}break}if(a.child===o.child){for(o=a.child;o;){if(o===s)return lm(a),e;if(o===r)return lm(a),t;o=o.sibling}throw Error(pe(188))}if(s.return!==r.return)s=a,r=o;else{for(var l=!1,c=a.child;c;){if(c===s){l=!0,s=a,r=o;break}if(c===r){l=!0,r=a,s=o;break}c=c.sibling}if(!l){for(c=o.child;c;){if(c===s){l=!0,s=o,r=a;break}if(c===r){l=!0,r=o,s=a;break}c=c.sibling}if(!l)throw Error(pe(189))}}if(s.alternate!==r)throw Error(pe(190))}if(s.tag!==3)throw Error(pe(188));return s.stateNode.current===s?e:t}function Ef(e){return e=Cg(e),e!==null?kf(e):null}function kf(e){if(e.tag===5||e.tag===6)return e;for(e=e.child;e!==null;){var t=kf(e);if(t!==null)return t;e=e.sibling}return null}var Af=Nn.unstable_scheduleCallback,im=Nn.unstable_cancelCallback,Dg=Nn.unstable_shouldYield,Lg=Nn.unstable_requestPaint,It=Nn.unstable_now,_g=Nn.unstable_getCurrentPriorityLevel,Gd=Nn.unstable_ImmediatePriority,If=Nn.unstable_UserBlockingPriority,Rl=Nn.unstable_NormalPriority,Og=Nn.unstable_LowPriority,Tf=Nn.unstable_IdlePriority,di=null,rs=null;function Mg(e){if(rs&&typeof rs.onCommitFiberRoot=="function")try{rs.onCommitFiberRoot(di,e,void 0,(e.current.flags&128)===128)}catch{}}var Un=Math.clz32?Math.clz32:Bg,Pg=Math.log,Fg=Math.LN2;function Bg(e){return e>>>=0,e===0?32:31-(Pg(e)/Fg|0)|0}var Yo=64,Go=4194304;function Fa(e){switch(e&-e){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return e&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return e&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return e}}function Cl(e,t){var s=e.pendingLanes;if(s===0)return 0;var r=0,a=e.suspendedLanes,o=e.pingedLanes,l=s&268435455;if(l!==0){var c=l&~a;c!==0?r=Fa(c):(o&=l,o!==0&&(r=Fa(o)))}else l=s&~a,l!==0?r=Fa(l):o!==0&&(r=Fa(o));if(r===0)return 0;if(t!==0&&t!==r&&!(t&a)&&(a=r&-r,o=t&-t,a>=o||a===16&&(o&4194240)!==0))return t;if(r&4&&(r|=s&16),t=e.entangledLanes,t!==0)for(e=e.entanglements,t&=r;0<t;)s=31-Un(t),a=1<<s,r|=e[s],t&=~a;return r}function $g(e,t){switch(e){case 1:case 2:case 4:return t+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function Hg(e,t){for(var s=e.suspendedLanes,r=e.pingedLanes,a=e.expirationTimes,o=e.pendingLanes;0<o;){var l=31-Un(o),c=1<<l,i=a[l];i===-1?(!(c&s)||c&r)&&(a[l]=$g(c,t)):i<=t&&(e.expiredLanes|=c),o&=~c}}function ed(e){return e=e.pendingLanes&-1073741825,e!==0?e:e&1073741824?1073741824:0}function Rf(){var e=Yo;return Yo<<=1,!(Yo&4194240)&&(Yo=64),e}function nc(e){for(var t=[],s=0;31>s;s++)t.push(e);return t}function ko(e,t,s){e.pendingLanes|=t,t!==536870912&&(e.suspendedLanes=0,e.pingedLanes=0),e=e.eventTimes,t=31-Un(t),e[t]=s}function Ug(e,t){var s=e.pendingLanes&~t;e.pendingLanes=t,e.suspendedLanes=0,e.pingedLanes=0,e.expiredLanes&=t,e.mutableReadLanes&=t,e.entangledLanes&=t,t=e.entanglements;var r=e.eventTimes;for(e=e.expirationTimes;0<s;){var a=31-Un(s),o=1<<a;t[a]=0,r[a]=-1,e[a]=-1,s&=~o}}function qd(e,t){var s=e.entangledLanes|=t;for(e=e.entanglements;s;){var r=31-Un(s),a=1<<r;a&t|e[r]&t&&(e[r]|=t),s&=~a}}var ot=0;function Cf(e){return e&=-e,1<e?4<e?e&268435455?16:536870912:4:1}var Df,Xd,Lf,_f,Of,td=!1,qo=[],zs=null,Vs=null,Ks=null,eo=new Map,to=new Map,Fs=[],Wg="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function cm(e,t){switch(e){case"focusin":case"focusout":zs=null;break;case"dragenter":case"dragleave":Vs=null;break;case"mouseover":case"mouseout":Ks=null;break;case"pointerover":case"pointerout":eo.delete(t.pointerId);break;case"gotpointercapture":case"lostpointercapture":to.delete(t.pointerId)}}function Aa(e,t,s,r,a,o){return e===null||e.nativeEvent!==o?(e={blockedOn:t,domEventName:s,eventSystemFlags:r,nativeEvent:o,targetContainers:[a]},t!==null&&(t=Io(t),t!==null&&Xd(t)),e):(e.eventSystemFlags|=r,t=e.targetContainers,a!==null&&t.indexOf(a)===-1&&t.push(a),e)}function zg(e,t,s,r,a){switch(t){case"focusin":return zs=Aa(zs,e,t,s,r,a),!0;case"dragenter":return Vs=Aa(Vs,e,t,s,r,a),!0;case"mouseover":return Ks=Aa(Ks,e,t,s,r,a),!0;case"pointerover":var o=a.pointerId;return eo.set(o,Aa(eo.get(o)||null,e,t,s,r,a)),!0;case"gotpointercapture":return o=a.pointerId,to.set(o,Aa(to.get(o)||null,e,t,s,r,a)),!0}return!1}function Mf(e){var t=cr(e.target);if(t!==null){var s=Sr(t);if(s!==null){if(t=s.tag,t===13){if(t=jf(s),t!==null){e.blockedOn=t,Of(e.priority,function(){Lf(s)});return}}else if(t===3&&s.stateNode.current.memoizedState.isDehydrated){e.blockedOn=s.tag===3?s.stateNode.containerInfo:null;return}}}e.blockedOn=null}function hl(e){if(e.blockedOn!==null)return!1;for(var t=e.targetContainers;0<t.length;){var s=nd(e.domEventName,e.eventSystemFlags,t[0],e.nativeEvent);if(s===null){s=e.nativeEvent;var r=new s.constructor(s.type,s);Xc=r,s.target.dispatchEvent(r),Xc=null}else return t=Io(s),t!==null&&Xd(t),e.blockedOn=s,!1;t.shift()}return!0}function dm(e,t,s){hl(e)&&s.delete(t)}function Vg(){td=!1,zs!==null&&hl(zs)&&(zs=null),Vs!==null&&hl(Vs)&&(Vs=null),Ks!==null&&hl(Ks)&&(Ks=null),eo.forEach(dm),to.forEach(dm)}function Ia(e,t){e.blockedOn===t&&(e.blockedOn=null,td||(td=!0,Nn.unstable_scheduleCallback(Nn.unstable_NormalPriority,Vg)))}function no(e){function t(a){return Ia(a,e)}if(0<qo.length){Ia(qo[0],e);for(var s=1;s<qo.length;s++){var r=qo[s];r.blockedOn===e&&(r.blockedOn=null)}}for(zs!==null&&Ia(zs,e),Vs!==null&&Ia(Vs,e),Ks!==null&&Ia(Ks,e),eo.forEach(t),to.forEach(t),s=0;s<Fs.length;s++)r=Fs[s],r.blockedOn===e&&(r.blockedOn=null);for(;0<Fs.length&&(s=Fs[0],s.blockedOn===null);)Mf(s),s.blockedOn===null&&Fs.shift()}var Gr=As.ReactCurrentBatchConfig,Dl=!0;function Kg(e,t,s,r){var a=ot,o=Gr.transition;Gr.transition=null;try{ot=1,Jd(e,t,s,r)}finally{ot=a,Gr.transition=o}}function Yg(e,t,s,r){var a=ot,o=Gr.transition;Gr.transition=null;try{ot=4,Jd(e,t,s,r)}finally{ot=a,Gr.transition=o}}function Jd(e,t,s,r){if(Dl){var a=nd(e,t,s,r);if(a===null)mc(e,t,r,Ll,s),cm(e,r);else if(zg(a,e,t,s,r))r.stopPropagation();else if(cm(e,r),t&4&&-1<Wg.indexOf(e)){for(;a!==null;){var o=Io(a);if(o!==null&&Df(o),o=nd(e,t,s,r),o===null&&mc(e,t,r,Ll,s),o===a)break;a=o}a!==null&&r.stopPropagation()}else mc(e,t,r,null,s)}}var Ll=null;function nd(e,t,s,r){if(Ll=null,e=Yd(r),e=cr(e),e!==null)if(t=Sr(e),t===null)e=null;else if(s=t.tag,s===13){if(e=jf(t),e!==null)return e;e=null}else if(s===3){if(t.stateNode.current.memoizedState.isDehydrated)return t.tag===3?t.stateNode.containerInfo:null;e=null}else t!==e&&(e=null);return Ll=e,null}function Pf(e){switch(e){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(_g()){case Gd:return 1;case If:return 4;case Rl:case Og:return 16;case Tf:return 536870912;default:return 16}default:return 16}}var Hs=null,Qd=null,gl=null;function Ff(){if(gl)return gl;var e,t=Qd,s=t.length,r,a="value"in Hs?Hs.value:Hs.textContent,o=a.length;for(e=0;e<s&&t[e]===a[e];e++);var l=s-e;for(r=1;r<=l&&t[s-r]===a[o-r];r++);return gl=a.slice(e,1<r?1-r:void 0)}function yl(e){var t=e.keyCode;return"charCode"in e?(e=e.charCode,e===0&&t===13&&(e=13)):e=t,e===10&&(e=13),32<=e||e===13?e:0}function Xo(){return!0}function um(){return!1}function vn(e){function t(s,r,a,o,l){this._reactName=s,this._targetInst=a,this.type=r,this.nativeEvent=o,this.target=l,this.currentTarget=null;for(var c in e)e.hasOwnProperty(c)&&(s=e[c],this[c]=s?s(o):o[c]);return this.isDefaultPrevented=(o.defaultPrevented!=null?o.defaultPrevented:o.returnValue===!1)?Xo:um,this.isPropagationStopped=um,this}return wt(t.prototype,{preventDefault:function(){this.defaultPrevented=!0;var s=this.nativeEvent;s&&(s.preventDefault?s.preventDefault():typeof s.returnValue!="unknown"&&(s.returnValue=!1),this.isDefaultPrevented=Xo)},stopPropagation:function(){var s=this.nativeEvent;s&&(s.stopPropagation?s.stopPropagation():typeof s.cancelBubble!="unknown"&&(s.cancelBubble=!0),this.isPropagationStopped=Xo)},persist:function(){},isPersistent:Xo}),t}var ca={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(e){return e.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},Zd=vn(ca),Ao=wt({},ca,{view:0,detail:0}),Gg=vn(Ao),sc,rc,Ta,ui=wt({},Ao,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:eu,button:0,buttons:0,relatedTarget:function(e){return e.relatedTarget===void 0?e.fromElement===e.srcElement?e.toElement:e.fromElement:e.relatedTarget},movementX:function(e){return"movementX"in e?e.movementX:(e!==Ta&&(Ta&&e.type==="mousemove"?(sc=e.screenX-Ta.screenX,rc=e.screenY-Ta.screenY):rc=sc=0,Ta=e),sc)},movementY:function(e){return"movementY"in e?e.movementY:rc}}),mm=vn(ui),qg=wt({},ui,{dataTransfer:0}),Xg=vn(qg),Jg=wt({},Ao,{relatedTarget:0}),ac=vn(Jg),Qg=wt({},ca,{animationName:0,elapsedTime:0,pseudoElement:0}),Zg=vn(Qg),ey=wt({},ca,{clipboardData:function(e){return"clipboardData"in e?e.clipboardData:window.clipboardData}}),ty=vn(ey),ny=wt({},ca,{data:0}),pm=vn(ny),sy={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},ry={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},ay={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function oy(e){var t=this.nativeEvent;return t.getModifierState?t.getModifierState(e):(e=ay[e])?!!t[e]:!1}function eu(){return oy}var ly=wt({},Ao,{key:function(e){if(e.key){var t=sy[e.key]||e.key;if(t!=="Unidentified")return t}return e.type==="keypress"?(e=yl(e),e===13?"Enter":String.fromCharCode(e)):e.type==="keydown"||e.type==="keyup"?ry[e.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:eu,charCode:function(e){return e.type==="keypress"?yl(e):0},keyCode:function(e){return e.type==="keydown"||e.type==="keyup"?e.keyCode:0},which:function(e){return e.type==="keypress"?yl(e):e.type==="keydown"||e.type==="keyup"?e.keyCode:0}}),iy=vn(ly),cy=wt({},ui,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),fm=vn(cy),dy=wt({},Ao,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:eu}),uy=vn(dy),my=wt({},ca,{propertyName:0,elapsedTime:0,pseudoElement:0}),py=vn(my),fy=wt({},ui,{deltaX:function(e){return"deltaX"in e?e.deltaX:"wheelDeltaX"in e?-e.wheelDeltaX:0},deltaY:function(e){return"deltaY"in e?e.deltaY:"wheelDeltaY"in e?-e.wheelDeltaY:"wheelDelta"in e?-e.wheelDelta:0},deltaZ:0,deltaMode:0}),xy=vn(fy),hy=[9,13,27,32],tu=ws&&"CompositionEvent"in window,Ua=null;ws&&"documentMode"in document&&(Ua=document.documentMode);var gy=ws&&"TextEvent"in window&&!Ua,Bf=ws&&(!tu||Ua&&8<Ua&&11>=Ua),xm=" ",hm=!1;function $f(e,t){switch(e){case"keyup":return hy.indexOf(t.keyCode)!==-1;case"keydown":return t.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function Hf(e){return e=e.detail,typeof e=="object"&&"data"in e?e.data:null}var Or=!1;function yy(e,t){switch(e){case"compositionend":return Hf(t);case"keypress":return t.which!==32?null:(hm=!0,xm);case"textInput":return e=t.data,e===xm&&hm?null:e;default:return null}}function Ny(e,t){if(Or)return e==="compositionend"||!tu&&$f(e,t)?(e=Ff(),gl=Qd=Hs=null,Or=!1,e):null;switch(e){case"paste":return null;case"keypress":if(!(t.ctrlKey||t.altKey||t.metaKey)||t.ctrlKey&&t.altKey){if(t.char&&1<t.char.length)return t.char;if(t.which)return String.fromCharCode(t.which)}return null;case"compositionend":return Bf&&t.locale!=="ko"?null:t.data;default:return null}}var by={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function gm(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t==="input"?!!by[e.type]:t==="textarea"}function Uf(e,t,s,r){Nf(r),t=_l(t,"onChange"),0<t.length&&(s=new Zd("onChange","change",null,s,r),e.push({event:s,listeners:t}))}var Wa=null,so=null;function vy(e){Zf(e,0)}function mi(e){var t=Fr(e);if(mf(t))return e}function Sy(e,t){if(e==="change")return t}var Wf=!1;if(ws){var oc;if(ws){var lc="oninput"in document;if(!lc){var ym=document.createElement("div");ym.setAttribute("oninput","return;"),lc=typeof ym.oninput=="function"}oc=lc}else oc=!1;Wf=oc&&(!document.documentMode||9<document.documentMode)}function Nm(){Wa&&(Wa.detachEvent("onpropertychange",zf),so=Wa=null)}function zf(e){if(e.propertyName==="value"&&mi(so)){var t=[];Uf(t,so,e,Yd(e)),wf(vy,t)}}function wy(e,t,s){e==="focusin"?(Nm(),Wa=t,so=s,Wa.attachEvent("onpropertychange",zf)):e==="focusout"&&Nm()}function jy(e){if(e==="selectionchange"||e==="keyup"||e==="keydown")return mi(so)}function Ey(e,t){if(e==="click")return mi(t)}function ky(e,t){if(e==="input"||e==="change")return mi(t)}function Ay(e,t){return e===t&&(e!==0||1/e===1/t)||e!==e&&t!==t}var Vn=typeof Object.is=="function"?Object.is:Ay;function ro(e,t){if(Vn(e,t))return!0;if(typeof e!="object"||e===null||typeof t!="object"||t===null)return!1;var s=Object.keys(e),r=Object.keys(t);if(s.length!==r.length)return!1;for(r=0;r<s.length;r++){var a=s[r];if(!Fc.call(t,a)||!Vn(e[a],t[a]))return!1}return!0}function bm(e){for(;e&&e.firstChild;)e=e.firstChild;return e}function vm(e,t){var s=bm(e);e=0;for(var r;s;){if(s.nodeType===3){if(r=e+s.textContent.length,e<=t&&r>=t)return{node:s,offset:t-e};e=r}e:{for(;s;){if(s.nextSibling){s=s.nextSibling;break e}s=s.parentNode}s=void 0}s=bm(s)}}function Vf(e,t){return e&&t?e===t?!0:e&&e.nodeType===3?!1:t&&t.nodeType===3?Vf(e,t.parentNode):"contains"in e?e.contains(t):e.compareDocumentPosition?!!(e.compareDocumentPosition(t)&16):!1:!1}function Kf(){for(var e=window,t=Al();t instanceof e.HTMLIFrameElement;){try{var s=typeof t.contentWindow.location.href=="string"}catch{s=!1}if(s)e=t.contentWindow;else break;t=Al(e.document)}return t}function nu(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t&&(t==="input"&&(e.type==="text"||e.type==="search"||e.type==="tel"||e.type==="url"||e.type==="password")||t==="textarea"||e.contentEditable==="true")}function Iy(e){var t=Kf(),s=e.focusedElem,r=e.selectionRange;if(t!==s&&s&&s.ownerDocument&&Vf(s.ownerDocument.documentElement,s)){if(r!==null&&nu(s)){if(t=r.start,e=r.end,e===void 0&&(e=t),"selectionStart"in s)s.selectionStart=t,s.selectionEnd=Math.min(e,s.value.length);else if(e=(t=s.ownerDocument||document)&&t.defaultView||window,e.getSelection){e=e.getSelection();var a=s.textContent.length,o=Math.min(r.start,a);r=r.end===void 0?o:Math.min(r.end,a),!e.extend&&o>r&&(a=r,r=o,o=a),a=vm(s,o);var l=vm(s,r);a&&l&&(e.rangeCount!==1||e.anchorNode!==a.node||e.anchorOffset!==a.offset||e.focusNode!==l.node||e.focusOffset!==l.offset)&&(t=t.createRange(),t.setStart(a.node,a.offset),e.removeAllRanges(),o>r?(e.addRange(t),e.extend(l.node,l.offset)):(t.setEnd(l.node,l.offset),e.addRange(t)))}}for(t=[],e=s;e=e.parentNode;)e.nodeType===1&&t.push({element:e,left:e.scrollLeft,top:e.scrollTop});for(typeof s.focus=="function"&&s.focus(),s=0;s<t.length;s++)e=t[s],e.element.scrollLeft=e.left,e.element.scrollTop=e.top}}var Ty=ws&&"documentMode"in document&&11>=document.documentMode,Mr=null,sd=null,za=null,rd=!1;function Sm(e,t,s){var r=s.window===s?s.document:s.nodeType===9?s:s.ownerDocument;rd||Mr==null||Mr!==Al(r)||(r=Mr,"selectionStart"in r&&nu(r)?r={start:r.selectionStart,end:r.selectionEnd}:(r=(r.ownerDocument&&r.ownerDocument.defaultView||window).getSelection(),r={anchorNode:r.anchorNode,anchorOffset:r.anchorOffset,focusNode:r.focusNode,focusOffset:r.focusOffset}),za&&ro(za,r)||(za=r,r=_l(sd,"onSelect"),0<r.length&&(t=new Zd("onSelect","select",null,t,s),e.push({event:t,listeners:r}),t.target=Mr)))}function Jo(e,t){var s={};return s[e.toLowerCase()]=t.toLowerCase(),s["Webkit"+e]="webkit"+t,s["Moz"+e]="moz"+t,s}var Pr={animationend:Jo("Animation","AnimationEnd"),animationiteration:Jo("Animation","AnimationIteration"),animationstart:Jo("Animation","AnimationStart"),transitionend:Jo("Transition","TransitionEnd")},ic={},Yf={};ws&&(Yf=document.createElement("div").style,"AnimationEvent"in window||(delete Pr.animationend.animation,delete Pr.animationiteration.animation,delete Pr.animationstart.animation),"TransitionEvent"in window||delete Pr.transitionend.transition);function pi(e){if(ic[e])return ic[e];if(!Pr[e])return e;var t=Pr[e],s;for(s in t)if(t.hasOwnProperty(s)&&s in Yf)return ic[e]=t[s];return e}var Gf=pi("animationend"),qf=pi("animationiteration"),Xf=pi("animationstart"),Jf=pi("transitionend"),Qf=new Map,wm="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function er(e,t){Qf.set(e,t),vr(t,[e])}for(var cc=0;cc<wm.length;cc++){var dc=wm[cc],Ry=dc.toLowerCase(),Cy=dc[0].toUpperCase()+dc.slice(1);er(Ry,"on"+Cy)}er(Gf,"onAnimationEnd");er(qf,"onAnimationIteration");er(Xf,"onAnimationStart");er("dblclick","onDoubleClick");er("focusin","onFocus");er("focusout","onBlur");er(Jf,"onTransitionEnd");Qr("onMouseEnter",["mouseout","mouseover"]);Qr("onMouseLeave",["mouseout","mouseover"]);Qr("onPointerEnter",["pointerout","pointerover"]);Qr("onPointerLeave",["pointerout","pointerover"]);vr("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));vr("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));vr("onBeforeInput",["compositionend","keypress","textInput","paste"]);vr("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));vr("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));vr("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Ba="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),Dy=new Set("cancel close invalid load scroll toggle".split(" ").concat(Ba));function jm(e,t,s){var r=e.type||"unknown-event";e.currentTarget=s,Rg(r,t,void 0,e),e.currentTarget=null}function Zf(e,t){t=(t&4)!==0;for(var s=0;s<e.length;s++){var r=e[s],a=r.event;r=r.listeners;e:{var o=void 0;if(t)for(var l=r.length-1;0<=l;l--){var c=r[l],i=c.instance,u=c.currentTarget;if(c=c.listener,i!==o&&a.isPropagationStopped())break e;jm(a,c,u),o=i}else for(l=0;l<r.length;l++){if(c=r[l],i=c.instance,u=c.currentTarget,c=c.listener,i!==o&&a.isPropagationStopped())break e;jm(a,c,u),o=i}}}if(Tl)throw e=Zc,Tl=!1,Zc=null,e}function ft(e,t){var s=t[cd];s===void 0&&(s=t[cd]=new Set);var r=e+"__bubble";s.has(r)||(ex(t,e,2,!1),s.add(r))}function uc(e,t,s){var r=0;t&&(r|=4),ex(s,e,r,t)}var Qo="_reactListening"+Math.random().toString(36).slice(2);function ao(e){if(!e[Qo]){e[Qo]=!0,of.forEach(function(s){s!=="selectionchange"&&(Dy.has(s)||uc(s,!1,e),uc(s,!0,e))});var t=e.nodeType===9?e:e.ownerDocument;t===null||t[Qo]||(t[Qo]=!0,uc("selectionchange",!1,t))}}function ex(e,t,s,r){switch(Pf(t)){case 1:var a=Kg;break;case 4:a=Yg;break;default:a=Jd}s=a.bind(null,t,s,e),a=void 0,!Qc||t!=="touchstart"&&t!=="touchmove"&&t!=="wheel"||(a=!0),r?a!==void 0?e.addEventListener(t,s,{capture:!0,passive:a}):e.addEventListener(t,s,!0):a!==void 0?e.addEventListener(t,s,{passive:a}):e.addEventListener(t,s,!1)}function mc(e,t,s,r,a){var o=r;if(!(t&1)&&!(t&2)&&r!==null)e:for(;;){if(r===null)return;var l=r.tag;if(l===3||l===4){var c=r.stateNode.containerInfo;if(c===a||c.nodeType===8&&c.parentNode===a)break;if(l===4)for(l=r.return;l!==null;){var i=l.tag;if((i===3||i===4)&&(i=l.stateNode.containerInfo,i===a||i.nodeType===8&&i.parentNode===a))return;l=l.return}for(;c!==null;){if(l=cr(c),l===null)return;if(i=l.tag,i===5||i===6){r=o=l;continue e}c=c.parentNode}}r=r.return}wf(function(){var u=o,p=Yd(s),y=[];e:{var S=Qf.get(e);if(S!==void 0){var w=Zd,L=e;switch(e){case"keypress":if(yl(s)===0)break e;case"keydown":case"keyup":w=iy;break;case"focusin":L="focus",w=ac;break;case"focusout":L="blur",w=ac;break;case"beforeblur":case"afterblur":w=ac;break;case"click":if(s.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":w=mm;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":w=Xg;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":w=uy;break;case Gf:case qf:case Xf:w=Zg;break;case Jf:w=py;break;case"scroll":w=Gg;break;case"wheel":w=xy;break;case"copy":case"cut":case"paste":w=ty;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":w=fm}var k=(t&4)!==0,U=!k&&e==="scroll",N=k?S!==null?S+"Capture":null:S;k=[];for(var x=u,b;x!==null;){b=x;var F=b.stateNode;if(b.tag===5&&F!==null&&(b=F,N!==null&&(F=Za(x,N),F!=null&&k.push(oo(x,F,b)))),U)break;x=x.return}0<k.length&&(S=new w(S,L,null,s,p),y.push({event:S,listeners:k}))}}if(!(t&7)){e:{if(S=e==="mouseover"||e==="pointerover",w=e==="mouseout"||e==="pointerout",S&&s!==Xc&&(L=s.relatedTarget||s.fromElement)&&(cr(L)||L[js]))break e;if((w||S)&&(S=p.window===p?p:(S=p.ownerDocument)?S.defaultView||S.parentWindow:window,w?(L=s.relatedTarget||s.toElement,w=u,L=L?cr(L):null,L!==null&&(U=Sr(L),L!==U||L.tag!==5&&L.tag!==6)&&(L=null)):(w=null,L=u),w!==L)){if(k=mm,F="onMouseLeave",N="onMouseEnter",x="mouse",(e==="pointerout"||e==="pointerover")&&(k=fm,F="onPointerLeave",N="onPointerEnter",x="pointer"),U=w==null?S:Fr(w),b=L==null?S:Fr(L),S=new k(F,x+"leave",w,s,p),S.target=U,S.relatedTarget=b,F=null,cr(p)===u&&(k=new k(N,x+"enter",L,s,p),k.target=b,k.relatedTarget=U,F=k),U=F,w&&L)t:{for(k=w,N=L,x=0,b=k;b;b=Tr(b))x++;for(b=0,F=N;F;F=Tr(F))b++;for(;0<x-b;)k=Tr(k),x--;for(;0<b-x;)N=Tr(N),b--;for(;x--;){if(k===N||N!==null&&k===N.alternate)break t;k=Tr(k),N=Tr(N)}k=null}else k=null;w!==null&&Em(y,S,w,k,!1),L!==null&&U!==null&&Em(y,U,L,k,!0)}}e:{if(S=u?Fr(u):window,w=S.nodeName&&S.nodeName.toLowerCase(),w==="select"||w==="input"&&S.type==="file")var H=Sy;else if(gm(S))if(Wf)H=ky;else{H=jy;var V=wy}else(w=S.nodeName)&&w.toLowerCase()==="input"&&(S.type==="checkbox"||S.type==="radio")&&(H=Ey);if(H&&(H=H(e,u))){Uf(y,H,s,p);break e}V&&V(e,S,u),e==="focusout"&&(V=S._wrapperState)&&V.controlled&&S.type==="number"&&Vc(S,"number",S.value)}switch(V=u?Fr(u):window,e){case"focusin":(gm(V)||V.contentEditable==="true")&&(Mr=V,sd=u,za=null);break;case"focusout":za=sd=Mr=null;break;case"mousedown":rd=!0;break;case"contextmenu":case"mouseup":case"dragend":rd=!1,Sm(y,s,p);break;case"selectionchange":if(Ty)break;case"keydown":case"keyup":Sm(y,s,p)}var q;if(tu)e:{switch(e){case"compositionstart":var te="onCompositionStart";break e;case"compositionend":te="onCompositionEnd";break e;case"compositionupdate":te="onCompositionUpdate";break e}te=void 0}else Or?$f(e,s)&&(te="onCompositionEnd"):e==="keydown"&&s.keyCode===229&&(te="onCompositionStart");te&&(Bf&&s.locale!=="ko"&&(Or||te!=="onCompositionStart"?te==="onCompositionEnd"&&Or&&(q=Ff()):(Hs=p,Qd="value"in Hs?Hs.value:Hs.textContent,Or=!0)),V=_l(u,te),0<V.length&&(te=new pm(te,e,null,s,p),y.push({event:te,listeners:V}),q?te.data=q:(q=Hf(s),q!==null&&(te.data=q)))),(q=gy?yy(e,s):Ny(e,s))&&(u=_l(u,"onBeforeInput"),0<u.length&&(p=new pm("onBeforeInput","beforeinput",null,s,p),y.push({event:p,listeners:u}),p.data=q))}Zf(y,t)})}function oo(e,t,s){return{instance:e,listener:t,currentTarget:s}}function _l(e,t){for(var s=t+"Capture",r=[];e!==null;){var a=e,o=a.stateNode;a.tag===5&&o!==null&&(a=o,o=Za(e,s),o!=null&&r.unshift(oo(e,o,a)),o=Za(e,t),o!=null&&r.push(oo(e,o,a))),e=e.return}return r}function Tr(e){if(e===null)return null;do e=e.return;while(e&&e.tag!==5);return e||null}function Em(e,t,s,r,a){for(var o=t._reactName,l=[];s!==null&&s!==r;){var c=s,i=c.alternate,u=c.stateNode;if(i!==null&&i===r)break;c.tag===5&&u!==null&&(c=u,a?(i=Za(s,o),i!=null&&l.unshift(oo(s,i,c))):a||(i=Za(s,o),i!=null&&l.push(oo(s,i,c)))),s=s.return}l.length!==0&&e.push({event:t,listeners:l})}var Ly=/\r\n?/g,_y=/\u0000|\uFFFD/g;function km(e){return(typeof e=="string"?e:""+e).replace(Ly,`
`).replace(_y,"")}function Zo(e,t,s){if(t=km(t),km(e)!==t&&s)throw Error(pe(425))}function Ol(){}var ad=null,od=null;function ld(e,t){return e==="textarea"||e==="noscript"||typeof t.children=="string"||typeof t.children=="number"||typeof t.dangerouslySetInnerHTML=="object"&&t.dangerouslySetInnerHTML!==null&&t.dangerouslySetInnerHTML.__html!=null}var id=typeof setTimeout=="function"?setTimeout:void 0,Oy=typeof clearTimeout=="function"?clearTimeout:void 0,Am=typeof Promise=="function"?Promise:void 0,My=typeof queueMicrotask=="function"?queueMicrotask:typeof Am<"u"?function(e){return Am.resolve(null).then(e).catch(Py)}:id;function Py(e){setTimeout(function(){throw e})}function pc(e,t){var s=t,r=0;do{var a=s.nextSibling;if(e.removeChild(s),a&&a.nodeType===8)if(s=a.data,s==="/$"){if(r===0){e.removeChild(a),no(t);return}r--}else s!=="$"&&s!=="$?"&&s!=="$!"||r++;s=a}while(s);no(t)}function Ys(e){for(;e!=null;e=e.nextSibling){var t=e.nodeType;if(t===1||t===3)break;if(t===8){if(t=e.data,t==="$"||t==="$!"||t==="$?")break;if(t==="/$")return null}}return e}function Im(e){e=e.previousSibling;for(var t=0;e;){if(e.nodeType===8){var s=e.data;if(s==="$"||s==="$!"||s==="$?"){if(t===0)return e;t--}else s==="/$"&&t++}e=e.previousSibling}return null}var da=Math.random().toString(36).slice(2),es="__reactFiber$"+da,lo="__reactProps$"+da,js="__reactContainer$"+da,cd="__reactEvents$"+da,Fy="__reactListeners$"+da,By="__reactHandles$"+da;function cr(e){var t=e[es];if(t)return t;for(var s=e.parentNode;s;){if(t=s[js]||s[es]){if(s=t.alternate,t.child!==null||s!==null&&s.child!==null)for(e=Im(e);e!==null;){if(s=e[es])return s;e=Im(e)}return t}e=s,s=e.parentNode}return null}function Io(e){return e=e[es]||e[js],!e||e.tag!==5&&e.tag!==6&&e.tag!==13&&e.tag!==3?null:e}function Fr(e){if(e.tag===5||e.tag===6)return e.stateNode;throw Error(pe(33))}function fi(e){return e[lo]||null}var dd=[],Br=-1;function tr(e){return{current:e}}function ht(e){0>Br||(e.current=dd[Br],dd[Br]=null,Br--)}function mt(e,t){Br++,dd[Br]=e.current,e.current=t}var Zs={},en=tr(Zs),un=tr(!1),xr=Zs;function Zr(e,t){var s=e.type.contextTypes;if(!s)return Zs;var r=e.stateNode;if(r&&r.__reactInternalMemoizedUnmaskedChildContext===t)return r.__reactInternalMemoizedMaskedChildContext;var a={},o;for(o in s)a[o]=t[o];return r&&(e=e.stateNode,e.__reactInternalMemoizedUnmaskedChildContext=t,e.__reactInternalMemoizedMaskedChildContext=a),a}function mn(e){return e=e.childContextTypes,e!=null}function Ml(){ht(un),ht(en)}function Tm(e,t,s){if(en.current!==Zs)throw Error(pe(168));mt(en,t),mt(un,s)}function tx(e,t,s){var r=e.stateNode;if(t=t.childContextTypes,typeof r.getChildContext!="function")return s;r=r.getChildContext();for(var a in r)if(!(a in t))throw Error(pe(108,wg(e)||"Unknown",a));return wt({},s,r)}function Pl(e){return e=(e=e.stateNode)&&e.__reactInternalMemoizedMergedChildContext||Zs,xr=en.current,mt(en,e),mt(un,un.current),!0}function Rm(e,t,s){var r=e.stateNode;if(!r)throw Error(pe(169));s?(e=tx(e,t,xr),r.__reactInternalMemoizedMergedChildContext=e,ht(un),ht(en),mt(en,e)):ht(un),mt(un,s)}var xs=null,xi=!1,fc=!1;function nx(e){xs===null?xs=[e]:xs.push(e)}function $y(e){xi=!0,nx(e)}function nr(){if(!fc&&xs!==null){fc=!0;var e=0,t=ot;try{var s=xs;for(ot=1;e<s.length;e++){var r=s[e];do r=r(!0);while(r!==null)}xs=null,xi=!1}catch(a){throw xs!==null&&(xs=xs.slice(e+1)),Af(Gd,nr),a}finally{ot=t,fc=!1}}return null}var $r=[],Hr=0,Fl=null,Bl=0,In=[],Tn=0,hr=null,ys=1,Ns="";function ar(e,t){$r[Hr++]=Bl,$r[Hr++]=Fl,Fl=e,Bl=t}function sx(e,t,s){In[Tn++]=ys,In[Tn++]=Ns,In[Tn++]=hr,hr=e;var r=ys;e=Ns;var a=32-Un(r)-1;r&=~(1<<a),s+=1;var o=32-Un(t)+a;if(30<o){var l=a-a%5;o=(r&(1<<l)-1).toString(32),r>>=l,a-=l,ys=1<<32-Un(t)+a|s<<a|r,Ns=o+e}else ys=1<<o|s<<a|r,Ns=e}function su(e){e.return!==null&&(ar(e,1),sx(e,1,0))}function ru(e){for(;e===Fl;)Fl=$r[--Hr],$r[Hr]=null,Bl=$r[--Hr],$r[Hr]=null;for(;e===hr;)hr=In[--Tn],In[Tn]=null,Ns=In[--Tn],In[Tn]=null,ys=In[--Tn],In[Tn]=null}var yn=null,gn=null,gt=!1,Hn=null;function rx(e,t){var s=Rn(5,null,null,0);s.elementType="DELETED",s.stateNode=t,s.return=e,t=e.deletions,t===null?(e.deletions=[s],e.flags|=16):t.push(s)}function Cm(e,t){switch(e.tag){case 5:var s=e.type;return t=t.nodeType!==1||s.toLowerCase()!==t.nodeName.toLowerCase()?null:t,t!==null?(e.stateNode=t,yn=e,gn=Ys(t.firstChild),!0):!1;case 6:return t=e.pendingProps===""||t.nodeType!==3?null:t,t!==null?(e.stateNode=t,yn=e,gn=null,!0):!1;case 13:return t=t.nodeType!==8?null:t,t!==null?(s=hr!==null?{id:ys,overflow:Ns}:null,e.memoizedState={dehydrated:t,treeContext:s,retryLane:1073741824},s=Rn(18,null,null,0),s.stateNode=t,s.return=e,e.child=s,yn=e,gn=null,!0):!1;default:return!1}}function ud(e){return(e.mode&1)!==0&&(e.flags&128)===0}function md(e){if(gt){var t=gn;if(t){var s=t;if(!Cm(e,t)){if(ud(e))throw Error(pe(418));t=Ys(s.nextSibling);var r=yn;t&&Cm(e,t)?rx(r,s):(e.flags=e.flags&-4097|2,gt=!1,yn=e)}}else{if(ud(e))throw Error(pe(418));e.flags=e.flags&-4097|2,gt=!1,yn=e}}}function Dm(e){for(e=e.return;e!==null&&e.tag!==5&&e.tag!==3&&e.tag!==13;)e=e.return;yn=e}function el(e){if(e!==yn)return!1;if(!gt)return Dm(e),gt=!0,!1;var t;if((t=e.tag!==3)&&!(t=e.tag!==5)&&(t=e.type,t=t!=="head"&&t!=="body"&&!ld(e.type,e.memoizedProps)),t&&(t=gn)){if(ud(e))throw ax(),Error(pe(418));for(;t;)rx(e,t),t=Ys(t.nextSibling)}if(Dm(e),e.tag===13){if(e=e.memoizedState,e=e!==null?e.dehydrated:null,!e)throw Error(pe(317));e:{for(e=e.nextSibling,t=0;e;){if(e.nodeType===8){var s=e.data;if(s==="/$"){if(t===0){gn=Ys(e.nextSibling);break e}t--}else s!=="$"&&s!=="$!"&&s!=="$?"||t++}e=e.nextSibling}gn=null}}else gn=yn?Ys(e.stateNode.nextSibling):null;return!0}function ax(){for(var e=gn;e;)e=Ys(e.nextSibling)}function ea(){gn=yn=null,gt=!1}function au(e){Hn===null?Hn=[e]:Hn.push(e)}var Hy=As.ReactCurrentBatchConfig;function Ra(e,t,s){if(e=s.ref,e!==null&&typeof e!="function"&&typeof e!="object"){if(s._owner){if(s=s._owner,s){if(s.tag!==1)throw Error(pe(309));var r=s.stateNode}if(!r)throw Error(pe(147,e));var a=r,o=""+e;return t!==null&&t.ref!==null&&typeof t.ref=="function"&&t.ref._stringRef===o?t.ref:(t=function(l){var c=a.refs;l===null?delete c[o]:c[o]=l},t._stringRef=o,t)}if(typeof e!="string")throw Error(pe(284));if(!s._owner)throw Error(pe(290,e))}return e}function tl(e,t){throw e=Object.prototype.toString.call(t),Error(pe(31,e==="[object Object]"?"object with keys {"+Object.keys(t).join(", ")+"}":e))}function Lm(e){var t=e._init;return t(e._payload)}function ox(e){function t(N,x){if(e){var b=N.deletions;b===null?(N.deletions=[x],N.flags|=16):b.push(x)}}function s(N,x){if(!e)return null;for(;x!==null;)t(N,x),x=x.sibling;return null}function r(N,x){for(N=new Map;x!==null;)x.key!==null?N.set(x.key,x):N.set(x.index,x),x=x.sibling;return N}function a(N,x){return N=Js(N,x),N.index=0,N.sibling=null,N}function o(N,x,b){return N.index=b,e?(b=N.alternate,b!==null?(b=b.index,b<x?(N.flags|=2,x):b):(N.flags|=2,x)):(N.flags|=1048576,x)}function l(N){return e&&N.alternate===null&&(N.flags|=2),N}function c(N,x,b,F){return x===null||x.tag!==6?(x=vc(b,N.mode,F),x.return=N,x):(x=a(x,b),x.return=N,x)}function i(N,x,b,F){var H=b.type;return H===_r?p(N,x,b.props.children,F,b.key):x!==null&&(x.elementType===H||typeof H=="object"&&H!==null&&H.$$typeof===_s&&Lm(H)===x.type)?(F=a(x,b.props),F.ref=Ra(N,x,b),F.return=N,F):(F=El(b.type,b.key,b.props,null,N.mode,F),F.ref=Ra(N,x,b),F.return=N,F)}function u(N,x,b,F){return x===null||x.tag!==4||x.stateNode.containerInfo!==b.containerInfo||x.stateNode.implementation!==b.implementation?(x=Sc(b,N.mode,F),x.return=N,x):(x=a(x,b.children||[]),x.return=N,x)}function p(N,x,b,F,H){return x===null||x.tag!==7?(x=pr(b,N.mode,F,H),x.return=N,x):(x=a(x,b),x.return=N,x)}function y(N,x,b){if(typeof x=="string"&&x!==""||typeof x=="number")return x=vc(""+x,N.mode,b),x.return=N,x;if(typeof x=="object"&&x!==null){switch(x.$$typeof){case zo:return b=El(x.type,x.key,x.props,null,N.mode,b),b.ref=Ra(N,null,x),b.return=N,b;case Lr:return x=Sc(x,N.mode,b),x.return=N,x;case _s:var F=x._init;return y(N,F(x._payload),b)}if(Pa(x)||Ea(x))return x=pr(x,N.mode,b,null),x.return=N,x;tl(N,x)}return null}function S(N,x,b,F){var H=x!==null?x.key:null;if(typeof b=="string"&&b!==""||typeof b=="number")return H!==null?null:c(N,x,""+b,F);if(typeof b=="object"&&b!==null){switch(b.$$typeof){case zo:return b.key===H?i(N,x,b,F):null;case Lr:return b.key===H?u(N,x,b,F):null;case _s:return H=b._init,S(N,x,H(b._payload),F)}if(Pa(b)||Ea(b))return H!==null?null:p(N,x,b,F,null);tl(N,b)}return null}function w(N,x,b,F,H){if(typeof F=="string"&&F!==""||typeof F=="number")return N=N.get(b)||null,c(x,N,""+F,H);if(typeof F=="object"&&F!==null){switch(F.$$typeof){case zo:return N=N.get(F.key===null?b:F.key)||null,i(x,N,F,H);case Lr:return N=N.get(F.key===null?b:F.key)||null,u(x,N,F,H);case _s:var V=F._init;return w(N,x,b,V(F._payload),H)}if(Pa(F)||Ea(F))return N=N.get(b)||null,p(x,N,F,H,null);tl(x,F)}return null}function L(N,x,b,F){for(var H=null,V=null,q=x,te=x=0,G=null;q!==null&&te<b.length;te++){q.index>te?(G=q,q=null):G=q.sibling;var le=S(N,q,b[te],F);if(le===null){q===null&&(q=G);break}e&&q&&le.alternate===null&&t(N,q),x=o(le,x,te),V===null?H=le:V.sibling=le,V=le,q=G}if(te===b.length)return s(N,q),gt&&ar(N,te),H;if(q===null){for(;te<b.length;te++)q=y(N,b[te],F),q!==null&&(x=o(q,x,te),V===null?H=q:V.sibling=q,V=q);return gt&&ar(N,te),H}for(q=r(N,q);te<b.length;te++)G=w(q,N,te,b[te],F),G!==null&&(e&&G.alternate!==null&&q.delete(G.key===null?te:G.key),x=o(G,x,te),V===null?H=G:V.sibling=G,V=G);return e&&q.forEach(function(j){return t(N,j)}),gt&&ar(N,te),H}function k(N,x,b,F){var H=Ea(b);if(typeof H!="function")throw Error(pe(150));if(b=H.call(b),b==null)throw Error(pe(151));for(var V=H=null,q=x,te=x=0,G=null,le=b.next();q!==null&&!le.done;te++,le=b.next()){q.index>te?(G=q,q=null):G=q.sibling;var j=S(N,q,le.value,F);if(j===null){q===null&&(q=G);break}e&&q&&j.alternate===null&&t(N,q),x=o(j,x,te),V===null?H=j:V.sibling=j,V=j,q=G}if(le.done)return s(N,q),gt&&ar(N,te),H;if(q===null){for(;!le.done;te++,le=b.next())le=y(N,le.value,F),le!==null&&(x=o(le,x,te),V===null?H=le:V.sibling=le,V=le);return gt&&ar(N,te),H}for(q=r(N,q);!le.done;te++,le=b.next())le=w(q,N,te,le.value,F),le!==null&&(e&&le.alternate!==null&&q.delete(le.key===null?te:le.key),x=o(le,x,te),V===null?H=le:V.sibling=le,V=le);return e&&q.forEach(function(T){return t(N,T)}),gt&&ar(N,te),H}function U(N,x,b,F){if(typeof b=="object"&&b!==null&&b.type===_r&&b.key===null&&(b=b.props.children),typeof b=="object"&&b!==null){switch(b.$$typeof){case zo:e:{for(var H=b.key,V=x;V!==null;){if(V.key===H){if(H=b.type,H===_r){if(V.tag===7){s(N,V.sibling),x=a(V,b.props.children),x.return=N,N=x;break e}}else if(V.elementType===H||typeof H=="object"&&H!==null&&H.$$typeof===_s&&Lm(H)===V.type){s(N,V.sibling),x=a(V,b.props),x.ref=Ra(N,V,b),x.return=N,N=x;break e}s(N,V);break}else t(N,V);V=V.sibling}b.type===_r?(x=pr(b.props.children,N.mode,F,b.key),x.return=N,N=x):(F=El(b.type,b.key,b.props,null,N.mode,F),F.ref=Ra(N,x,b),F.return=N,N=F)}return l(N);case Lr:e:{for(V=b.key;x!==null;){if(x.key===V)if(x.tag===4&&x.stateNode.containerInfo===b.containerInfo&&x.stateNode.implementation===b.implementation){s(N,x.sibling),x=a(x,b.children||[]),x.return=N,N=x;break e}else{s(N,x);break}else t(N,x);x=x.sibling}x=Sc(b,N.mode,F),x.return=N,N=x}return l(N);case _s:return V=b._init,U(N,x,V(b._payload),F)}if(Pa(b))return L(N,x,b,F);if(Ea(b))return k(N,x,b,F);tl(N,b)}return typeof b=="string"&&b!==""||typeof b=="number"?(b=""+b,x!==null&&x.tag===6?(s(N,x.sibling),x=a(x,b),x.return=N,N=x):(s(N,x),x=vc(b,N.mode,F),x.return=N,N=x),l(N)):s(N,x)}return U}var ta=ox(!0),lx=ox(!1),$l=tr(null),Hl=null,Ur=null,ou=null;function lu(){ou=Ur=Hl=null}function iu(e){var t=$l.current;ht($l),e._currentValue=t}function pd(e,t,s){for(;e!==null;){var r=e.alternate;if((e.childLanes&t)!==t?(e.childLanes|=t,r!==null&&(r.childLanes|=t)):r!==null&&(r.childLanes&t)!==t&&(r.childLanes|=t),e===s)break;e=e.return}}function qr(e,t){Hl=e,ou=Ur=null,e=e.dependencies,e!==null&&e.firstContext!==null&&(e.lanes&t&&(dn=!0),e.firstContext=null)}function Ln(e){var t=e._currentValue;if(ou!==e)if(e={context:e,memoizedValue:t,next:null},Ur===null){if(Hl===null)throw Error(pe(308));Ur=e,Hl.dependencies={lanes:0,firstContext:e}}else Ur=Ur.next=e;return t}var dr=null;function cu(e){dr===null?dr=[e]:dr.push(e)}function ix(e,t,s,r){var a=t.interleaved;return a===null?(s.next=s,cu(t)):(s.next=a.next,a.next=s),t.interleaved=s,Es(e,r)}function Es(e,t){e.lanes|=t;var s=e.alternate;for(s!==null&&(s.lanes|=t),s=e,e=e.return;e!==null;)e.childLanes|=t,s=e.alternate,s!==null&&(s.childLanes|=t),s=e,e=e.return;return s.tag===3?s.stateNode:null}var Os=!1;function du(e){e.updateQueue={baseState:e.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function cx(e,t){e=e.updateQueue,t.updateQueue===e&&(t.updateQueue={baseState:e.baseState,firstBaseUpdate:e.firstBaseUpdate,lastBaseUpdate:e.lastBaseUpdate,shared:e.shared,effects:e.effects})}function bs(e,t){return{eventTime:e,lane:t,tag:0,payload:null,callback:null,next:null}}function Gs(e,t,s){var r=e.updateQueue;if(r===null)return null;if(r=r.shared,tt&2){var a=r.pending;return a===null?t.next=t:(t.next=a.next,a.next=t),r.pending=t,Es(e,s)}return a=r.interleaved,a===null?(t.next=t,cu(r)):(t.next=a.next,a.next=t),r.interleaved=t,Es(e,s)}function Nl(e,t,s){if(t=t.updateQueue,t!==null&&(t=t.shared,(s&4194240)!==0)){var r=t.lanes;r&=e.pendingLanes,s|=r,t.lanes=s,qd(e,s)}}function _m(e,t){var s=e.updateQueue,r=e.alternate;if(r!==null&&(r=r.updateQueue,s===r)){var a=null,o=null;if(s=s.firstBaseUpdate,s!==null){do{var l={eventTime:s.eventTime,lane:s.lane,tag:s.tag,payload:s.payload,callback:s.callback,next:null};o===null?a=o=l:o=o.next=l,s=s.next}while(s!==null);o===null?a=o=t:o=o.next=t}else a=o=t;s={baseState:r.baseState,firstBaseUpdate:a,lastBaseUpdate:o,shared:r.shared,effects:r.effects},e.updateQueue=s;return}e=s.lastBaseUpdate,e===null?s.firstBaseUpdate=t:e.next=t,s.lastBaseUpdate=t}function Ul(e,t,s,r){var a=e.updateQueue;Os=!1;var o=a.firstBaseUpdate,l=a.lastBaseUpdate,c=a.shared.pending;if(c!==null){a.shared.pending=null;var i=c,u=i.next;i.next=null,l===null?o=u:l.next=u,l=i;var p=e.alternate;p!==null&&(p=p.updateQueue,c=p.lastBaseUpdate,c!==l&&(c===null?p.firstBaseUpdate=u:c.next=u,p.lastBaseUpdate=i))}if(o!==null){var y=a.baseState;l=0,p=u=i=null,c=o;do{var S=c.lane,w=c.eventTime;if((r&S)===S){p!==null&&(p=p.next={eventTime:w,lane:0,tag:c.tag,payload:c.payload,callback:c.callback,next:null});e:{var L=e,k=c;switch(S=t,w=s,k.tag){case 1:if(L=k.payload,typeof L=="function"){y=L.call(w,y,S);break e}y=L;break e;case 3:L.flags=L.flags&-65537|128;case 0:if(L=k.payload,S=typeof L=="function"?L.call(w,y,S):L,S==null)break e;y=wt({},y,S);break e;case 2:Os=!0}}c.callback!==null&&c.lane!==0&&(e.flags|=64,S=a.effects,S===null?a.effects=[c]:S.push(c))}else w={eventTime:w,lane:S,tag:c.tag,payload:c.payload,callback:c.callback,next:null},p===null?(u=p=w,i=y):p=p.next=w,l|=S;if(c=c.next,c===null){if(c=a.shared.pending,c===null)break;S=c,c=S.next,S.next=null,a.lastBaseUpdate=S,a.shared.pending=null}}while(!0);if(p===null&&(i=y),a.baseState=i,a.firstBaseUpdate=u,a.lastBaseUpdate=p,t=a.shared.interleaved,t!==null){a=t;do l|=a.lane,a=a.next;while(a!==t)}else o===null&&(a.shared.lanes=0);yr|=l,e.lanes=l,e.memoizedState=y}}function Om(e,t,s){if(e=t.effects,t.effects=null,e!==null)for(t=0;t<e.length;t++){var r=e[t],a=r.callback;if(a!==null){if(r.callback=null,r=s,typeof a!="function")throw Error(pe(191,a));a.call(r)}}}var To={},as=tr(To),io=tr(To),co=tr(To);function ur(e){if(e===To)throw Error(pe(174));return e}function uu(e,t){switch(mt(co,t),mt(io,e),mt(as,To),e=t.nodeType,e){case 9:case 11:t=(t=t.documentElement)?t.namespaceURI:Yc(null,"");break;default:e=e===8?t.parentNode:t,t=e.namespaceURI||null,e=e.tagName,t=Yc(t,e)}ht(as),mt(as,t)}function na(){ht(as),ht(io),ht(co)}function dx(e){ur(co.current);var t=ur(as.current),s=Yc(t,e.type);t!==s&&(mt(io,e),mt(as,s))}function mu(e){io.current===e&&(ht(as),ht(io))}var vt=tr(0);function Wl(e){for(var t=e;t!==null;){if(t.tag===13){var s=t.memoizedState;if(s!==null&&(s=s.dehydrated,s===null||s.data==="$?"||s.data==="$!"))return t}else if(t.tag===19&&t.memoizedProps.revealOrder!==void 0){if(t.flags&128)return t}else if(t.child!==null){t.child.return=t,t=t.child;continue}if(t===e)break;for(;t.sibling===null;){if(t.return===null||t.return===e)return null;t=t.return}t.sibling.return=t.return,t=t.sibling}return null}var xc=[];function pu(){for(var e=0;e<xc.length;e++)xc[e]._workInProgressVersionPrimary=null;xc.length=0}var bl=As.ReactCurrentDispatcher,hc=As.ReactCurrentBatchConfig,gr=0,St=null,_t=null,Bt=null,zl=!1,Va=!1,uo=0,Uy=0;function Xt(){throw Error(pe(321))}function fu(e,t){if(t===null)return!1;for(var s=0;s<t.length&&s<e.length;s++)if(!Vn(e[s],t[s]))return!1;return!0}function xu(e,t,s,r,a,o){if(gr=o,St=t,t.memoizedState=null,t.updateQueue=null,t.lanes=0,bl.current=e===null||e.memoizedState===null?Ky:Yy,e=s(r,a),Va){o=0;do{if(Va=!1,uo=0,25<=o)throw Error(pe(301));o+=1,Bt=_t=null,t.updateQueue=null,bl.current=Gy,e=s(r,a)}while(Va)}if(bl.current=Vl,t=_t!==null&&_t.next!==null,gr=0,Bt=_t=St=null,zl=!1,t)throw Error(pe(300));return e}function hu(){var e=uo!==0;return uo=0,e}function Jn(){var e={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Bt===null?St.memoizedState=Bt=e:Bt=Bt.next=e,Bt}function _n(){if(_t===null){var e=St.alternate;e=e!==null?e.memoizedState:null}else e=_t.next;var t=Bt===null?St.memoizedState:Bt.next;if(t!==null)Bt=t,_t=e;else{if(e===null)throw Error(pe(310));_t=e,e={memoizedState:_t.memoizedState,baseState:_t.baseState,baseQueue:_t.baseQueue,queue:_t.queue,next:null},Bt===null?St.memoizedState=Bt=e:Bt=Bt.next=e}return Bt}function mo(e,t){return typeof t=="function"?t(e):t}function gc(e){var t=_n(),s=t.queue;if(s===null)throw Error(pe(311));s.lastRenderedReducer=e;var r=_t,a=r.baseQueue,o=s.pending;if(o!==null){if(a!==null){var l=a.next;a.next=o.next,o.next=l}r.baseQueue=a=o,s.pending=null}if(a!==null){o=a.next,r=r.baseState;var c=l=null,i=null,u=o;do{var p=u.lane;if((gr&p)===p)i!==null&&(i=i.next={lane:0,action:u.action,hasEagerState:u.hasEagerState,eagerState:u.eagerState,next:null}),r=u.hasEagerState?u.eagerState:e(r,u.action);else{var y={lane:p,action:u.action,hasEagerState:u.hasEagerState,eagerState:u.eagerState,next:null};i===null?(c=i=y,l=r):i=i.next=y,St.lanes|=p,yr|=p}u=u.next}while(u!==null&&u!==o);i===null?l=r:i.next=c,Vn(r,t.memoizedState)||(dn=!0),t.memoizedState=r,t.baseState=l,t.baseQueue=i,s.lastRenderedState=r}if(e=s.interleaved,e!==null){a=e;do o=a.lane,St.lanes|=o,yr|=o,a=a.next;while(a!==e)}else a===null&&(s.lanes=0);return[t.memoizedState,s.dispatch]}function yc(e){var t=_n(),s=t.queue;if(s===null)throw Error(pe(311));s.lastRenderedReducer=e;var r=s.dispatch,a=s.pending,o=t.memoizedState;if(a!==null){s.pending=null;var l=a=a.next;do o=e(o,l.action),l=l.next;while(l!==a);Vn(o,t.memoizedState)||(dn=!0),t.memoizedState=o,t.baseQueue===null&&(t.baseState=o),s.lastRenderedState=o}return[o,r]}function ux(){}function mx(e,t){var s=St,r=_n(),a=t(),o=!Vn(r.memoizedState,a);if(o&&(r.memoizedState=a,dn=!0),r=r.queue,gu(xx.bind(null,s,r,e),[e]),r.getSnapshot!==t||o||Bt!==null&&Bt.memoizedState.tag&1){if(s.flags|=2048,po(9,fx.bind(null,s,r,a,t),void 0,null),$t===null)throw Error(pe(349));gr&30||px(s,t,a)}return a}function px(e,t,s){e.flags|=16384,e={getSnapshot:t,value:s},t=St.updateQueue,t===null?(t={lastEffect:null,stores:null},St.updateQueue=t,t.stores=[e]):(s=t.stores,s===null?t.stores=[e]:s.push(e))}function fx(e,t,s,r){t.value=s,t.getSnapshot=r,hx(t)&&gx(e)}function xx(e,t,s){return s(function(){hx(t)&&gx(e)})}function hx(e){var t=e.getSnapshot;e=e.value;try{var s=t();return!Vn(e,s)}catch{return!0}}function gx(e){var t=Es(e,1);t!==null&&Wn(t,e,1,-1)}function Mm(e){var t=Jn();return typeof e=="function"&&(e=e()),t.memoizedState=t.baseState=e,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:mo,lastRenderedState:e},t.queue=e,e=e.dispatch=Vy.bind(null,St,e),[t.memoizedState,e]}function po(e,t,s,r){return e={tag:e,create:t,destroy:s,deps:r,next:null},t=St.updateQueue,t===null?(t={lastEffect:null,stores:null},St.updateQueue=t,t.lastEffect=e.next=e):(s=t.lastEffect,s===null?t.lastEffect=e.next=e:(r=s.next,s.next=e,e.next=r,t.lastEffect=e)),e}function yx(){return _n().memoizedState}function vl(e,t,s,r){var a=Jn();St.flags|=e,a.memoizedState=po(1|t,s,void 0,r===void 0?null:r)}function hi(e,t,s,r){var a=_n();r=r===void 0?null:r;var o=void 0;if(_t!==null){var l=_t.memoizedState;if(o=l.destroy,r!==null&&fu(r,l.deps)){a.memoizedState=po(t,s,o,r);return}}St.flags|=e,a.memoizedState=po(1|t,s,o,r)}function Pm(e,t){return vl(8390656,8,e,t)}function gu(e,t){return hi(2048,8,e,t)}function Nx(e,t){return hi(4,2,e,t)}function bx(e,t){return hi(4,4,e,t)}function vx(e,t){if(typeof t=="function")return e=e(),t(e),function(){t(null)};if(t!=null)return e=e(),t.current=e,function(){t.current=null}}function Sx(e,t,s){return s=s!=null?s.concat([e]):null,hi(4,4,vx.bind(null,t,e),s)}function yu(){}function wx(e,t){var s=_n();t=t===void 0?null:t;var r=s.memoizedState;return r!==null&&t!==null&&fu(t,r[1])?r[0]:(s.memoizedState=[e,t],e)}function jx(e,t){var s=_n();t=t===void 0?null:t;var r=s.memoizedState;return r!==null&&t!==null&&fu(t,r[1])?r[0]:(e=e(),s.memoizedState=[e,t],e)}function Ex(e,t,s){return gr&21?(Vn(s,t)||(s=Rf(),St.lanes|=s,yr|=s,e.baseState=!0),t):(e.baseState&&(e.baseState=!1,dn=!0),e.memoizedState=s)}function Wy(e,t){var s=ot;ot=s!==0&&4>s?s:4,e(!0);var r=hc.transition;hc.transition={};try{e(!1),t()}finally{ot=s,hc.transition=r}}function kx(){return _n().memoizedState}function zy(e,t,s){var r=Xs(e);if(s={lane:r,action:s,hasEagerState:!1,eagerState:null,next:null},Ax(e))Ix(t,s);else if(s=ix(e,t,s,r),s!==null){var a=sn();Wn(s,e,r,a),Tx(s,t,r)}}function Vy(e,t,s){var r=Xs(e),a={lane:r,action:s,hasEagerState:!1,eagerState:null,next:null};if(Ax(e))Ix(t,a);else{var o=e.alternate;if(e.lanes===0&&(o===null||o.lanes===0)&&(o=t.lastRenderedReducer,o!==null))try{var l=t.lastRenderedState,c=o(l,s);if(a.hasEagerState=!0,a.eagerState=c,Vn(c,l)){var i=t.interleaved;i===null?(a.next=a,cu(t)):(a.next=i.next,i.next=a),t.interleaved=a;return}}catch{}finally{}s=ix(e,t,a,r),s!==null&&(a=sn(),Wn(s,e,r,a),Tx(s,t,r))}}function Ax(e){var t=e.alternate;return e===St||t!==null&&t===St}function Ix(e,t){Va=zl=!0;var s=e.pending;s===null?t.next=t:(t.next=s.next,s.next=t),e.pending=t}function Tx(e,t,s){if(s&4194240){var r=t.lanes;r&=e.pendingLanes,s|=r,t.lanes=s,qd(e,s)}}var Vl={readContext:Ln,useCallback:Xt,useContext:Xt,useEffect:Xt,useImperativeHandle:Xt,useInsertionEffect:Xt,useLayoutEffect:Xt,useMemo:Xt,useReducer:Xt,useRef:Xt,useState:Xt,useDebugValue:Xt,useDeferredValue:Xt,useTransition:Xt,useMutableSource:Xt,useSyncExternalStore:Xt,useId:Xt,unstable_isNewReconciler:!1},Ky={readContext:Ln,useCallback:function(e,t){return Jn().memoizedState=[e,t===void 0?null:t],e},useContext:Ln,useEffect:Pm,useImperativeHandle:function(e,t,s){return s=s!=null?s.concat([e]):null,vl(4194308,4,vx.bind(null,t,e),s)},useLayoutEffect:function(e,t){return vl(4194308,4,e,t)},useInsertionEffect:function(e,t){return vl(4,2,e,t)},useMemo:function(e,t){var s=Jn();return t=t===void 0?null:t,e=e(),s.memoizedState=[e,t],e},useReducer:function(e,t,s){var r=Jn();return t=s!==void 0?s(t):t,r.memoizedState=r.baseState=t,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:e,lastRenderedState:t},r.queue=e,e=e.dispatch=zy.bind(null,St,e),[r.memoizedState,e]},useRef:function(e){var t=Jn();return e={current:e},t.memoizedState=e},useState:Mm,useDebugValue:yu,useDeferredValue:function(e){return Jn().memoizedState=e},useTransition:function(){var e=Mm(!1),t=e[0];return e=Wy.bind(null,e[1]),Jn().memoizedState=e,[t,e]},useMutableSource:function(){},useSyncExternalStore:function(e,t,s){var r=St,a=Jn();if(gt){if(s===void 0)throw Error(pe(407));s=s()}else{if(s=t(),$t===null)throw Error(pe(349));gr&30||px(r,t,s)}a.memoizedState=s;var o={value:s,getSnapshot:t};return a.queue=o,Pm(xx.bind(null,r,o,e),[e]),r.flags|=2048,po(9,fx.bind(null,r,o,s,t),void 0,null),s},useId:function(){var e=Jn(),t=$t.identifierPrefix;if(gt){var s=Ns,r=ys;s=(r&~(1<<32-Un(r)-1)).toString(32)+s,t=":"+t+"R"+s,s=uo++,0<s&&(t+="H"+s.toString(32)),t+=":"}else s=Uy++,t=":"+t+"r"+s.toString(32)+":";return e.memoizedState=t},unstable_isNewReconciler:!1},Yy={readContext:Ln,useCallback:wx,useContext:Ln,useEffect:gu,useImperativeHandle:Sx,useInsertionEffect:Nx,useLayoutEffect:bx,useMemo:jx,useReducer:gc,useRef:yx,useState:function(){return gc(mo)},useDebugValue:yu,useDeferredValue:function(e){var t=_n();return Ex(t,_t.memoizedState,e)},useTransition:function(){var e=gc(mo)[0],t=_n().memoizedState;return[e,t]},useMutableSource:ux,useSyncExternalStore:mx,useId:kx,unstable_isNewReconciler:!1},Gy={readContext:Ln,useCallback:wx,useContext:Ln,useEffect:gu,useImperativeHandle:Sx,useInsertionEffect:Nx,useLayoutEffect:bx,useMemo:jx,useReducer:yc,useRef:yx,useState:function(){return yc(mo)},useDebugValue:yu,useDeferredValue:function(e){var t=_n();return _t===null?t.memoizedState=e:Ex(t,_t.memoizedState,e)},useTransition:function(){var e=yc(mo)[0],t=_n().memoizedState;return[e,t]},useMutableSource:ux,useSyncExternalStore:mx,useId:kx,unstable_isNewReconciler:!1};function Bn(e,t){if(e&&e.defaultProps){t=wt({},t),e=e.defaultProps;for(var s in e)t[s]===void 0&&(t[s]=e[s]);return t}return t}function fd(e,t,s,r){t=e.memoizedState,s=s(r,t),s=s==null?t:wt({},t,s),e.memoizedState=s,e.lanes===0&&(e.updateQueue.baseState=s)}var gi={isMounted:function(e){return(e=e._reactInternals)?Sr(e)===e:!1},enqueueSetState:function(e,t,s){e=e._reactInternals;var r=sn(),a=Xs(e),o=bs(r,a);o.payload=t,s!=null&&(o.callback=s),t=Gs(e,o,a),t!==null&&(Wn(t,e,a,r),Nl(t,e,a))},enqueueReplaceState:function(e,t,s){e=e._reactInternals;var r=sn(),a=Xs(e),o=bs(r,a);o.tag=1,o.payload=t,s!=null&&(o.callback=s),t=Gs(e,o,a),t!==null&&(Wn(t,e,a,r),Nl(t,e,a))},enqueueForceUpdate:function(e,t){e=e._reactInternals;var s=sn(),r=Xs(e),a=bs(s,r);a.tag=2,t!=null&&(a.callback=t),t=Gs(e,a,r),t!==null&&(Wn(t,e,r,s),Nl(t,e,r))}};function Fm(e,t,s,r,a,o,l){return e=e.stateNode,typeof e.shouldComponentUpdate=="function"?e.shouldComponentUpdate(r,o,l):t.prototype&&t.prototype.isPureReactComponent?!ro(s,r)||!ro(a,o):!0}function Rx(e,t,s){var r=!1,a=Zs,o=t.contextType;return typeof o=="object"&&o!==null?o=Ln(o):(a=mn(t)?xr:en.current,r=t.contextTypes,o=(r=r!=null)?Zr(e,a):Zs),t=new t(s,o),e.memoizedState=t.state!==null&&t.state!==void 0?t.state:null,t.updater=gi,e.stateNode=t,t._reactInternals=e,r&&(e=e.stateNode,e.__reactInternalMemoizedUnmaskedChildContext=a,e.__reactInternalMemoizedMaskedChildContext=o),t}function Bm(e,t,s,r){e=t.state,typeof t.componentWillReceiveProps=="function"&&t.componentWillReceiveProps(s,r),typeof t.UNSAFE_componentWillReceiveProps=="function"&&t.UNSAFE_componentWillReceiveProps(s,r),t.state!==e&&gi.enqueueReplaceState(t,t.state,null)}function xd(e,t,s,r){var a=e.stateNode;a.props=s,a.state=e.memoizedState,a.refs={},du(e);var o=t.contextType;typeof o=="object"&&o!==null?a.context=Ln(o):(o=mn(t)?xr:en.current,a.context=Zr(e,o)),a.state=e.memoizedState,o=t.getDerivedStateFromProps,typeof o=="function"&&(fd(e,t,o,s),a.state=e.memoizedState),typeof t.getDerivedStateFromProps=="function"||typeof a.getSnapshotBeforeUpdate=="function"||typeof a.UNSAFE_componentWillMount!="function"&&typeof a.componentWillMount!="function"||(t=a.state,typeof a.componentWillMount=="function"&&a.componentWillMount(),typeof a.UNSAFE_componentWillMount=="function"&&a.UNSAFE_componentWillMount(),t!==a.state&&gi.enqueueReplaceState(a,a.state,null),Ul(e,s,a,r),a.state=e.memoizedState),typeof a.componentDidMount=="function"&&(e.flags|=4194308)}function sa(e,t){try{var s="",r=t;do s+=Sg(r),r=r.return;while(r);var a=s}catch(o){a=`
Error generating stack: `+o.message+`
`+o.stack}return{value:e,source:t,stack:a,digest:null}}function Nc(e,t,s){return{value:e,source:null,stack:s??null,digest:t??null}}function hd(e,t){try{console.error(t.value)}catch(s){setTimeout(function(){throw s})}}var qy=typeof WeakMap=="function"?WeakMap:Map;function Cx(e,t,s){s=bs(-1,s),s.tag=3,s.payload={element:null};var r=t.value;return s.callback=function(){Yl||(Yl=!0,kd=r),hd(e,t)},s}function Dx(e,t,s){s=bs(-1,s),s.tag=3;var r=e.type.getDerivedStateFromError;if(typeof r=="function"){var a=t.value;s.payload=function(){return r(a)},s.callback=function(){hd(e,t)}}var o=e.stateNode;return o!==null&&typeof o.componentDidCatch=="function"&&(s.callback=function(){hd(e,t),typeof r!="function"&&(qs===null?qs=new Set([this]):qs.add(this));var l=t.stack;this.componentDidCatch(t.value,{componentStack:l!==null?l:""})}),s}function $m(e,t,s){var r=e.pingCache;if(r===null){r=e.pingCache=new qy;var a=new Set;r.set(t,a)}else a=r.get(t),a===void 0&&(a=new Set,r.set(t,a));a.has(s)||(a.add(s),e=c0.bind(null,e,t,s),t.then(e,e))}function Hm(e){do{var t;if((t=e.tag===13)&&(t=e.memoizedState,t=t!==null?t.dehydrated!==null:!0),t)return e;e=e.return}while(e!==null);return null}function Um(e,t,s,r,a){return e.mode&1?(e.flags|=65536,e.lanes=a,e):(e===t?e.flags|=65536:(e.flags|=128,s.flags|=131072,s.flags&=-52805,s.tag===1&&(s.alternate===null?s.tag=17:(t=bs(-1,1),t.tag=2,Gs(s,t,1))),s.lanes|=1),e)}var Xy=As.ReactCurrentOwner,dn=!1;function nn(e,t,s,r){t.child=e===null?lx(t,null,s,r):ta(t,e.child,s,r)}function Wm(e,t,s,r,a){s=s.render;var o=t.ref;return qr(t,a),r=xu(e,t,s,r,o,a),s=hu(),e!==null&&!dn?(t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~a,ks(e,t,a)):(gt&&s&&su(t),t.flags|=1,nn(e,t,r,a),t.child)}function zm(e,t,s,r,a){if(e===null){var o=s.type;return typeof o=="function"&&!ku(o)&&o.defaultProps===void 0&&s.compare===null&&s.defaultProps===void 0?(t.tag=15,t.type=o,Lx(e,t,o,r,a)):(e=El(s.type,null,r,t,t.mode,a),e.ref=t.ref,e.return=t,t.child=e)}if(o=e.child,!(e.lanes&a)){var l=o.memoizedProps;if(s=s.compare,s=s!==null?s:ro,s(l,r)&&e.ref===t.ref)return ks(e,t,a)}return t.flags|=1,e=Js(o,r),e.ref=t.ref,e.return=t,t.child=e}function Lx(e,t,s,r,a){if(e!==null){var o=e.memoizedProps;if(ro(o,r)&&e.ref===t.ref)if(dn=!1,t.pendingProps=r=o,(e.lanes&a)!==0)e.flags&131072&&(dn=!0);else return t.lanes=e.lanes,ks(e,t,a)}return gd(e,t,s,r,a)}function _x(e,t,s){var r=t.pendingProps,a=r.children,o=e!==null?e.memoizedState:null;if(r.mode==="hidden")if(!(t.mode&1))t.memoizedState={baseLanes:0,cachePool:null,transitions:null},mt(zr,xn),xn|=s;else{if(!(s&1073741824))return e=o!==null?o.baseLanes|s:s,t.lanes=t.childLanes=1073741824,t.memoizedState={baseLanes:e,cachePool:null,transitions:null},t.updateQueue=null,mt(zr,xn),xn|=e,null;t.memoizedState={baseLanes:0,cachePool:null,transitions:null},r=o!==null?o.baseLanes:s,mt(zr,xn),xn|=r}else o!==null?(r=o.baseLanes|s,t.memoizedState=null):r=s,mt(zr,xn),xn|=r;return nn(e,t,a,s),t.child}function Ox(e,t){var s=t.ref;(e===null&&s!==null||e!==null&&e.ref!==s)&&(t.flags|=512,t.flags|=2097152)}function gd(e,t,s,r,a){var o=mn(s)?xr:en.current;return o=Zr(t,o),qr(t,a),s=xu(e,t,s,r,o,a),r=hu(),e!==null&&!dn?(t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~a,ks(e,t,a)):(gt&&r&&su(t),t.flags|=1,nn(e,t,s,a),t.child)}function Vm(e,t,s,r,a){if(mn(s)){var o=!0;Pl(t)}else o=!1;if(qr(t,a),t.stateNode===null)Sl(e,t),Rx(t,s,r),xd(t,s,r,a),r=!0;else if(e===null){var l=t.stateNode,c=t.memoizedProps;l.props=c;var i=l.context,u=s.contextType;typeof u=="object"&&u!==null?u=Ln(u):(u=mn(s)?xr:en.current,u=Zr(t,u));var p=s.getDerivedStateFromProps,y=typeof p=="function"||typeof l.getSnapshotBeforeUpdate=="function";y||typeof l.UNSAFE_componentWillReceiveProps!="function"&&typeof l.componentWillReceiveProps!="function"||(c!==r||i!==u)&&Bm(t,l,r,u),Os=!1;var S=t.memoizedState;l.state=S,Ul(t,r,l,a),i=t.memoizedState,c!==r||S!==i||un.current||Os?(typeof p=="function"&&(fd(t,s,p,r),i=t.memoizedState),(c=Os||Fm(t,s,c,r,S,i,u))?(y||typeof l.UNSAFE_componentWillMount!="function"&&typeof l.componentWillMount!="function"||(typeof l.componentWillMount=="function"&&l.componentWillMount(),typeof l.UNSAFE_componentWillMount=="function"&&l.UNSAFE_componentWillMount()),typeof l.componentDidMount=="function"&&(t.flags|=4194308)):(typeof l.componentDidMount=="function"&&(t.flags|=4194308),t.memoizedProps=r,t.memoizedState=i),l.props=r,l.state=i,l.context=u,r=c):(typeof l.componentDidMount=="function"&&(t.flags|=4194308),r=!1)}else{l=t.stateNode,cx(e,t),c=t.memoizedProps,u=t.type===t.elementType?c:Bn(t.type,c),l.props=u,y=t.pendingProps,S=l.context,i=s.contextType,typeof i=="object"&&i!==null?i=Ln(i):(i=mn(s)?xr:en.current,i=Zr(t,i));var w=s.getDerivedStateFromProps;(p=typeof w=="function"||typeof l.getSnapshotBeforeUpdate=="function")||typeof l.UNSAFE_componentWillReceiveProps!="function"&&typeof l.componentWillReceiveProps!="function"||(c!==y||S!==i)&&Bm(t,l,r,i),Os=!1,S=t.memoizedState,l.state=S,Ul(t,r,l,a);var L=t.memoizedState;c!==y||S!==L||un.current||Os?(typeof w=="function"&&(fd(t,s,w,r),L=t.memoizedState),(u=Os||Fm(t,s,u,r,S,L,i)||!1)?(p||typeof l.UNSAFE_componentWillUpdate!="function"&&typeof l.componentWillUpdate!="function"||(typeof l.componentWillUpdate=="function"&&l.componentWillUpdate(r,L,i),typeof l.UNSAFE_componentWillUpdate=="function"&&l.UNSAFE_componentWillUpdate(r,L,i)),typeof l.componentDidUpdate=="function"&&(t.flags|=4),typeof l.getSnapshotBeforeUpdate=="function"&&(t.flags|=1024)):(typeof l.componentDidUpdate!="function"||c===e.memoizedProps&&S===e.memoizedState||(t.flags|=4),typeof l.getSnapshotBeforeUpdate!="function"||c===e.memoizedProps&&S===e.memoizedState||(t.flags|=1024),t.memoizedProps=r,t.memoizedState=L),l.props=r,l.state=L,l.context=i,r=u):(typeof l.componentDidUpdate!="function"||c===e.memoizedProps&&S===e.memoizedState||(t.flags|=4),typeof l.getSnapshotBeforeUpdate!="function"||c===e.memoizedProps&&S===e.memoizedState||(t.flags|=1024),r=!1)}return yd(e,t,s,r,o,a)}function yd(e,t,s,r,a,o){Ox(e,t);var l=(t.flags&128)!==0;if(!r&&!l)return a&&Rm(t,s,!1),ks(e,t,o);r=t.stateNode,Xy.current=t;var c=l&&typeof s.getDerivedStateFromError!="function"?null:r.render();return t.flags|=1,e!==null&&l?(t.child=ta(t,e.child,null,o),t.child=ta(t,null,c,o)):nn(e,t,c,o),t.memoizedState=r.state,a&&Rm(t,s,!0),t.child}function Mx(e){var t=e.stateNode;t.pendingContext?Tm(e,t.pendingContext,t.pendingContext!==t.context):t.context&&Tm(e,t.context,!1),uu(e,t.containerInfo)}function Km(e,t,s,r,a){return ea(),au(a),t.flags|=256,nn(e,t,s,r),t.child}var Nd={dehydrated:null,treeContext:null,retryLane:0};function bd(e){return{baseLanes:e,cachePool:null,transitions:null}}function Px(e,t,s){var r=t.pendingProps,a=vt.current,o=!1,l=(t.flags&128)!==0,c;if((c=l)||(c=e!==null&&e.memoizedState===null?!1:(a&2)!==0),c?(o=!0,t.flags&=-129):(e===null||e.memoizedState!==null)&&(a|=1),mt(vt,a&1),e===null)return md(t),e=t.memoizedState,e!==null&&(e=e.dehydrated,e!==null)?(t.mode&1?e.data==="$!"?t.lanes=8:t.lanes=1073741824:t.lanes=1,null):(l=r.children,e=r.fallback,o?(r=t.mode,o=t.child,l={mode:"hidden",children:l},!(r&1)&&o!==null?(o.childLanes=0,o.pendingProps=l):o=bi(l,r,0,null),e=pr(e,r,s,null),o.return=t,e.return=t,o.sibling=e,t.child=o,t.child.memoizedState=bd(s),t.memoizedState=Nd,e):Nu(t,l));if(a=e.memoizedState,a!==null&&(c=a.dehydrated,c!==null))return Jy(e,t,l,r,c,a,s);if(o){o=r.fallback,l=t.mode,a=e.child,c=a.sibling;var i={mode:"hidden",children:r.children};return!(l&1)&&t.child!==a?(r=t.child,r.childLanes=0,r.pendingProps=i,t.deletions=null):(r=Js(a,i),r.subtreeFlags=a.subtreeFlags&14680064),c!==null?o=Js(c,o):(o=pr(o,l,s,null),o.flags|=2),o.return=t,r.return=t,r.sibling=o,t.child=r,r=o,o=t.child,l=e.child.memoizedState,l=l===null?bd(s):{baseLanes:l.baseLanes|s,cachePool:null,transitions:l.transitions},o.memoizedState=l,o.childLanes=e.childLanes&~s,t.memoizedState=Nd,r}return o=e.child,e=o.sibling,r=Js(o,{mode:"visible",children:r.children}),!(t.mode&1)&&(r.lanes=s),r.return=t,r.sibling=null,e!==null&&(s=t.deletions,s===null?(t.deletions=[e],t.flags|=16):s.push(e)),t.child=r,t.memoizedState=null,r}function Nu(e,t){return t=bi({mode:"visible",children:t},e.mode,0,null),t.return=e,e.child=t}function nl(e,t,s,r){return r!==null&&au(r),ta(t,e.child,null,s),e=Nu(t,t.pendingProps.children),e.flags|=2,t.memoizedState=null,e}function Jy(e,t,s,r,a,o,l){if(s)return t.flags&256?(t.flags&=-257,r=Nc(Error(pe(422))),nl(e,t,l,r)):t.memoizedState!==null?(t.child=e.child,t.flags|=128,null):(o=r.fallback,a=t.mode,r=bi({mode:"visible",children:r.children},a,0,null),o=pr(o,a,l,null),o.flags|=2,r.return=t,o.return=t,r.sibling=o,t.child=r,t.mode&1&&ta(t,e.child,null,l),t.child.memoizedState=bd(l),t.memoizedState=Nd,o);if(!(t.mode&1))return nl(e,t,l,null);if(a.data==="$!"){if(r=a.nextSibling&&a.nextSibling.dataset,r)var c=r.dgst;return r=c,o=Error(pe(419)),r=Nc(o,r,void 0),nl(e,t,l,r)}if(c=(l&e.childLanes)!==0,dn||c){if(r=$t,r!==null){switch(l&-l){case 4:a=2;break;case 16:a=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:a=32;break;case 536870912:a=268435456;break;default:a=0}a=a&(r.suspendedLanes|l)?0:a,a!==0&&a!==o.retryLane&&(o.retryLane=a,Es(e,a),Wn(r,e,a,-1))}return Eu(),r=Nc(Error(pe(421))),nl(e,t,l,r)}return a.data==="$?"?(t.flags|=128,t.child=e.child,t=d0.bind(null,e),a._reactRetry=t,null):(e=o.treeContext,gn=Ys(a.nextSibling),yn=t,gt=!0,Hn=null,e!==null&&(In[Tn++]=ys,In[Tn++]=Ns,In[Tn++]=hr,ys=e.id,Ns=e.overflow,hr=t),t=Nu(t,r.children),t.flags|=4096,t)}function Ym(e,t,s){e.lanes|=t;var r=e.alternate;r!==null&&(r.lanes|=t),pd(e.return,t,s)}function bc(e,t,s,r,a){var o=e.memoizedState;o===null?e.memoizedState={isBackwards:t,rendering:null,renderingStartTime:0,last:r,tail:s,tailMode:a}:(o.isBackwards=t,o.rendering=null,o.renderingStartTime=0,o.last=r,o.tail=s,o.tailMode=a)}function Fx(e,t,s){var r=t.pendingProps,a=r.revealOrder,o=r.tail;if(nn(e,t,r.children,s),r=vt.current,r&2)r=r&1|2,t.flags|=128;else{if(e!==null&&e.flags&128)e:for(e=t.child;e!==null;){if(e.tag===13)e.memoizedState!==null&&Ym(e,s,t);else if(e.tag===19)Ym(e,s,t);else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===t)break e;for(;e.sibling===null;){if(e.return===null||e.return===t)break e;e=e.return}e.sibling.return=e.return,e=e.sibling}r&=1}if(mt(vt,r),!(t.mode&1))t.memoizedState=null;else switch(a){case"forwards":for(s=t.child,a=null;s!==null;)e=s.alternate,e!==null&&Wl(e)===null&&(a=s),s=s.sibling;s=a,s===null?(a=t.child,t.child=null):(a=s.sibling,s.sibling=null),bc(t,!1,a,s,o);break;case"backwards":for(s=null,a=t.child,t.child=null;a!==null;){if(e=a.alternate,e!==null&&Wl(e)===null){t.child=a;break}e=a.sibling,a.sibling=s,s=a,a=e}bc(t,!0,s,null,o);break;case"together":bc(t,!1,null,null,void 0);break;default:t.memoizedState=null}return t.child}function Sl(e,t){!(t.mode&1)&&e!==null&&(e.alternate=null,t.alternate=null,t.flags|=2)}function ks(e,t,s){if(e!==null&&(t.dependencies=e.dependencies),yr|=t.lanes,!(s&t.childLanes))return null;if(e!==null&&t.child!==e.child)throw Error(pe(153));if(t.child!==null){for(e=t.child,s=Js(e,e.pendingProps),t.child=s,s.return=t;e.sibling!==null;)e=e.sibling,s=s.sibling=Js(e,e.pendingProps),s.return=t;s.sibling=null}return t.child}function Qy(e,t,s){switch(t.tag){case 3:Mx(t),ea();break;case 5:dx(t);break;case 1:mn(t.type)&&Pl(t);break;case 4:uu(t,t.stateNode.containerInfo);break;case 10:var r=t.type._context,a=t.memoizedProps.value;mt($l,r._currentValue),r._currentValue=a;break;case 13:if(r=t.memoizedState,r!==null)return r.dehydrated!==null?(mt(vt,vt.current&1),t.flags|=128,null):s&t.child.childLanes?Px(e,t,s):(mt(vt,vt.current&1),e=ks(e,t,s),e!==null?e.sibling:null);mt(vt,vt.current&1);break;case 19:if(r=(s&t.childLanes)!==0,e.flags&128){if(r)return Fx(e,t,s);t.flags|=128}if(a=t.memoizedState,a!==null&&(a.rendering=null,a.tail=null,a.lastEffect=null),mt(vt,vt.current),r)break;return null;case 22:case 23:return t.lanes=0,_x(e,t,s)}return ks(e,t,s)}var Bx,vd,$x,Hx;Bx=function(e,t){for(var s=t.child;s!==null;){if(s.tag===5||s.tag===6)e.appendChild(s.stateNode);else if(s.tag!==4&&s.child!==null){s.child.return=s,s=s.child;continue}if(s===t)break;for(;s.sibling===null;){if(s.return===null||s.return===t)return;s=s.return}s.sibling.return=s.return,s=s.sibling}};vd=function(){};$x=function(e,t,s,r){var a=e.memoizedProps;if(a!==r){e=t.stateNode,ur(as.current);var o=null;switch(s){case"input":a=Wc(e,a),r=Wc(e,r),o=[];break;case"select":a=wt({},a,{value:void 0}),r=wt({},r,{value:void 0}),o=[];break;case"textarea":a=Kc(e,a),r=Kc(e,r),o=[];break;default:typeof a.onClick!="function"&&typeof r.onClick=="function"&&(e.onclick=Ol)}Gc(s,r);var l;s=null;for(u in a)if(!r.hasOwnProperty(u)&&a.hasOwnProperty(u)&&a[u]!=null)if(u==="style"){var c=a[u];for(l in c)c.hasOwnProperty(l)&&(s||(s={}),s[l]="")}else u!=="dangerouslySetInnerHTML"&&u!=="children"&&u!=="suppressContentEditableWarning"&&u!=="suppressHydrationWarning"&&u!=="autoFocus"&&(Ja.hasOwnProperty(u)?o||(o=[]):(o=o||[]).push(u,null));for(u in r){var i=r[u];if(c=a!=null?a[u]:void 0,r.hasOwnProperty(u)&&i!==c&&(i!=null||c!=null))if(u==="style")if(c){for(l in c)!c.hasOwnProperty(l)||i&&i.hasOwnProperty(l)||(s||(s={}),s[l]="");for(l in i)i.hasOwnProperty(l)&&c[l]!==i[l]&&(s||(s={}),s[l]=i[l])}else s||(o||(o=[]),o.push(u,s)),s=i;else u==="dangerouslySetInnerHTML"?(i=i?i.__html:void 0,c=c?c.__html:void 0,i!=null&&c!==i&&(o=o||[]).push(u,i)):u==="children"?typeof i!="string"&&typeof i!="number"||(o=o||[]).push(u,""+i):u!=="suppressContentEditableWarning"&&u!=="suppressHydrationWarning"&&(Ja.hasOwnProperty(u)?(i!=null&&u==="onScroll"&&ft("scroll",e),o||c===i||(o=[])):(o=o||[]).push(u,i))}s&&(o=o||[]).push("style",s);var u=o;(t.updateQueue=u)&&(t.flags|=4)}};Hx=function(e,t,s,r){s!==r&&(t.flags|=4)};function Ca(e,t){if(!gt)switch(e.tailMode){case"hidden":t=e.tail;for(var s=null;t!==null;)t.alternate!==null&&(s=t),t=t.sibling;s===null?e.tail=null:s.sibling=null;break;case"collapsed":s=e.tail;for(var r=null;s!==null;)s.alternate!==null&&(r=s),s=s.sibling;r===null?t||e.tail===null?e.tail=null:e.tail.sibling=null:r.sibling=null}}function Jt(e){var t=e.alternate!==null&&e.alternate.child===e.child,s=0,r=0;if(t)for(var a=e.child;a!==null;)s|=a.lanes|a.childLanes,r|=a.subtreeFlags&14680064,r|=a.flags&14680064,a.return=e,a=a.sibling;else for(a=e.child;a!==null;)s|=a.lanes|a.childLanes,r|=a.subtreeFlags,r|=a.flags,a.return=e,a=a.sibling;return e.subtreeFlags|=r,e.childLanes=s,t}function Zy(e,t,s){var r=t.pendingProps;switch(ru(t),t.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Jt(t),null;case 1:return mn(t.type)&&Ml(),Jt(t),null;case 3:return r=t.stateNode,na(),ht(un),ht(en),pu(),r.pendingContext&&(r.context=r.pendingContext,r.pendingContext=null),(e===null||e.child===null)&&(el(t)?t.flags|=4:e===null||e.memoizedState.isDehydrated&&!(t.flags&256)||(t.flags|=1024,Hn!==null&&(Td(Hn),Hn=null))),vd(e,t),Jt(t),null;case 5:mu(t);var a=ur(co.current);if(s=t.type,e!==null&&t.stateNode!=null)$x(e,t,s,r,a),e.ref!==t.ref&&(t.flags|=512,t.flags|=2097152);else{if(!r){if(t.stateNode===null)throw Error(pe(166));return Jt(t),null}if(e=ur(as.current),el(t)){r=t.stateNode,s=t.type;var o=t.memoizedProps;switch(r[es]=t,r[lo]=o,e=(t.mode&1)!==0,s){case"dialog":ft("cancel",r),ft("close",r);break;case"iframe":case"object":case"embed":ft("load",r);break;case"video":case"audio":for(a=0;a<Ba.length;a++)ft(Ba[a],r);break;case"source":ft("error",r);break;case"img":case"image":case"link":ft("error",r),ft("load",r);break;case"details":ft("toggle",r);break;case"input":nm(r,o),ft("invalid",r);break;case"select":r._wrapperState={wasMultiple:!!o.multiple},ft("invalid",r);break;case"textarea":rm(r,o),ft("invalid",r)}Gc(s,o),a=null;for(var l in o)if(o.hasOwnProperty(l)){var c=o[l];l==="children"?typeof c=="string"?r.textContent!==c&&(o.suppressHydrationWarning!==!0&&Zo(r.textContent,c,e),a=["children",c]):typeof c=="number"&&r.textContent!==""+c&&(o.suppressHydrationWarning!==!0&&Zo(r.textContent,c,e),a=["children",""+c]):Ja.hasOwnProperty(l)&&c!=null&&l==="onScroll"&&ft("scroll",r)}switch(s){case"input":Vo(r),sm(r,o,!0);break;case"textarea":Vo(r),am(r);break;case"select":case"option":break;default:typeof o.onClick=="function"&&(r.onclick=Ol)}r=a,t.updateQueue=r,r!==null&&(t.flags|=4)}else{l=a.nodeType===9?a:a.ownerDocument,e==="http://www.w3.org/1999/xhtml"&&(e=xf(s)),e==="http://www.w3.org/1999/xhtml"?s==="script"?(e=l.createElement("div"),e.innerHTML="<script><\/script>",e=e.removeChild(e.firstChild)):typeof r.is=="string"?e=l.createElement(s,{is:r.is}):(e=l.createElement(s),s==="select"&&(l=e,r.multiple?l.multiple=!0:r.size&&(l.size=r.size))):e=l.createElementNS(e,s),e[es]=t,e[lo]=r,Bx(e,t,!1,!1),t.stateNode=e;e:{switch(l=qc(s,r),s){case"dialog":ft("cancel",e),ft("close",e),a=r;break;case"iframe":case"object":case"embed":ft("load",e),a=r;break;case"video":case"audio":for(a=0;a<Ba.length;a++)ft(Ba[a],e);a=r;break;case"source":ft("error",e),a=r;break;case"img":case"image":case"link":ft("error",e),ft("load",e),a=r;break;case"details":ft("toggle",e),a=r;break;case"input":nm(e,r),a=Wc(e,r),ft("invalid",e);break;case"option":a=r;break;case"select":e._wrapperState={wasMultiple:!!r.multiple},a=wt({},r,{value:void 0}),ft("invalid",e);break;case"textarea":rm(e,r),a=Kc(e,r),ft("invalid",e);break;default:a=r}Gc(s,a),c=a;for(o in c)if(c.hasOwnProperty(o)){var i=c[o];o==="style"?yf(e,i):o==="dangerouslySetInnerHTML"?(i=i?i.__html:void 0,i!=null&&hf(e,i)):o==="children"?typeof i=="string"?(s!=="textarea"||i!=="")&&Qa(e,i):typeof i=="number"&&Qa(e,""+i):o!=="suppressContentEditableWarning"&&o!=="suppressHydrationWarning"&&o!=="autoFocus"&&(Ja.hasOwnProperty(o)?i!=null&&o==="onScroll"&&ft("scroll",e):i!=null&&Wd(e,o,i,l))}switch(s){case"input":Vo(e),sm(e,r,!1);break;case"textarea":Vo(e),am(e);break;case"option":r.value!=null&&e.setAttribute("value",""+Qs(r.value));break;case"select":e.multiple=!!r.multiple,o=r.value,o!=null?Vr(e,!!r.multiple,o,!1):r.defaultValue!=null&&Vr(e,!!r.multiple,r.defaultValue,!0);break;default:typeof a.onClick=="function"&&(e.onclick=Ol)}switch(s){case"button":case"input":case"select":case"textarea":r=!!r.autoFocus;break e;case"img":r=!0;break e;default:r=!1}}r&&(t.flags|=4)}t.ref!==null&&(t.flags|=512,t.flags|=2097152)}return Jt(t),null;case 6:if(e&&t.stateNode!=null)Hx(e,t,e.memoizedProps,r);else{if(typeof r!="string"&&t.stateNode===null)throw Error(pe(166));if(s=ur(co.current),ur(as.current),el(t)){if(r=t.stateNode,s=t.memoizedProps,r[es]=t,(o=r.nodeValue!==s)&&(e=yn,e!==null))switch(e.tag){case 3:Zo(r.nodeValue,s,(e.mode&1)!==0);break;case 5:e.memoizedProps.suppressHydrationWarning!==!0&&Zo(r.nodeValue,s,(e.mode&1)!==0)}o&&(t.flags|=4)}else r=(s.nodeType===9?s:s.ownerDocument).createTextNode(r),r[es]=t,t.stateNode=r}return Jt(t),null;case 13:if(ht(vt),r=t.memoizedState,e===null||e.memoizedState!==null&&e.memoizedState.dehydrated!==null){if(gt&&gn!==null&&t.mode&1&&!(t.flags&128))ax(),ea(),t.flags|=98560,o=!1;else if(o=el(t),r!==null&&r.dehydrated!==null){if(e===null){if(!o)throw Error(pe(318));if(o=t.memoizedState,o=o!==null?o.dehydrated:null,!o)throw Error(pe(317));o[es]=t}else ea(),!(t.flags&128)&&(t.memoizedState=null),t.flags|=4;Jt(t),o=!1}else Hn!==null&&(Td(Hn),Hn=null),o=!0;if(!o)return t.flags&65536?t:null}return t.flags&128?(t.lanes=s,t):(r=r!==null,r!==(e!==null&&e.memoizedState!==null)&&r&&(t.child.flags|=8192,t.mode&1&&(e===null||vt.current&1?Mt===0&&(Mt=3):Eu())),t.updateQueue!==null&&(t.flags|=4),Jt(t),null);case 4:return na(),vd(e,t),e===null&&ao(t.stateNode.containerInfo),Jt(t),null;case 10:return iu(t.type._context),Jt(t),null;case 17:return mn(t.type)&&Ml(),Jt(t),null;case 19:if(ht(vt),o=t.memoizedState,o===null)return Jt(t),null;if(r=(t.flags&128)!==0,l=o.rendering,l===null)if(r)Ca(o,!1);else{if(Mt!==0||e!==null&&e.flags&128)for(e=t.child;e!==null;){if(l=Wl(e),l!==null){for(t.flags|=128,Ca(o,!1),r=l.updateQueue,r!==null&&(t.updateQueue=r,t.flags|=4),t.subtreeFlags=0,r=s,s=t.child;s!==null;)o=s,e=r,o.flags&=14680066,l=o.alternate,l===null?(o.childLanes=0,o.lanes=e,o.child=null,o.subtreeFlags=0,o.memoizedProps=null,o.memoizedState=null,o.updateQueue=null,o.dependencies=null,o.stateNode=null):(o.childLanes=l.childLanes,o.lanes=l.lanes,o.child=l.child,o.subtreeFlags=0,o.deletions=null,o.memoizedProps=l.memoizedProps,o.memoizedState=l.memoizedState,o.updateQueue=l.updateQueue,o.type=l.type,e=l.dependencies,o.dependencies=e===null?null:{lanes:e.lanes,firstContext:e.firstContext}),s=s.sibling;return mt(vt,vt.current&1|2),t.child}e=e.sibling}o.tail!==null&&It()>ra&&(t.flags|=128,r=!0,Ca(o,!1),t.lanes=4194304)}else{if(!r)if(e=Wl(l),e!==null){if(t.flags|=128,r=!0,s=e.updateQueue,s!==null&&(t.updateQueue=s,t.flags|=4),Ca(o,!0),o.tail===null&&o.tailMode==="hidden"&&!l.alternate&&!gt)return Jt(t),null}else 2*It()-o.renderingStartTime>ra&&s!==1073741824&&(t.flags|=128,r=!0,Ca(o,!1),t.lanes=4194304);o.isBackwards?(l.sibling=t.child,t.child=l):(s=o.last,s!==null?s.sibling=l:t.child=l,o.last=l)}return o.tail!==null?(t=o.tail,o.rendering=t,o.tail=t.sibling,o.renderingStartTime=It(),t.sibling=null,s=vt.current,mt(vt,r?s&1|2:s&1),t):(Jt(t),null);case 22:case 23:return ju(),r=t.memoizedState!==null,e!==null&&e.memoizedState!==null!==r&&(t.flags|=8192),r&&t.mode&1?xn&1073741824&&(Jt(t),t.subtreeFlags&6&&(t.flags|=8192)):Jt(t),null;case 24:return null;case 25:return null}throw Error(pe(156,t.tag))}function e0(e,t){switch(ru(t),t.tag){case 1:return mn(t.type)&&Ml(),e=t.flags,e&65536?(t.flags=e&-65537|128,t):null;case 3:return na(),ht(un),ht(en),pu(),e=t.flags,e&65536&&!(e&128)?(t.flags=e&-65537|128,t):null;case 5:return mu(t),null;case 13:if(ht(vt),e=t.memoizedState,e!==null&&e.dehydrated!==null){if(t.alternate===null)throw Error(pe(340));ea()}return e=t.flags,e&65536?(t.flags=e&-65537|128,t):null;case 19:return ht(vt),null;case 4:return na(),null;case 10:return iu(t.type._context),null;case 22:case 23:return ju(),null;case 24:return null;default:return null}}var sl=!1,Qt=!1,t0=typeof WeakSet=="function"?WeakSet:Set,Ie=null;function Wr(e,t){var s=e.ref;if(s!==null)if(typeof s=="function")try{s(null)}catch(r){kt(e,t,r)}else s.current=null}function Sd(e,t,s){try{s()}catch(r){kt(e,t,r)}}var Gm=!1;function n0(e,t){if(ad=Dl,e=Kf(),nu(e)){if("selectionStart"in e)var s={start:e.selectionStart,end:e.selectionEnd};else e:{s=(s=e.ownerDocument)&&s.defaultView||window;var r=s.getSelection&&s.getSelection();if(r&&r.rangeCount!==0){s=r.anchorNode;var a=r.anchorOffset,o=r.focusNode;r=r.focusOffset;try{s.nodeType,o.nodeType}catch{s=null;break e}var l=0,c=-1,i=-1,u=0,p=0,y=e,S=null;t:for(;;){for(var w;y!==s||a!==0&&y.nodeType!==3||(c=l+a),y!==o||r!==0&&y.nodeType!==3||(i=l+r),y.nodeType===3&&(l+=y.nodeValue.length),(w=y.firstChild)!==null;)S=y,y=w;for(;;){if(y===e)break t;if(S===s&&++u===a&&(c=l),S===o&&++p===r&&(i=l),(w=y.nextSibling)!==null)break;y=S,S=y.parentNode}y=w}s=c===-1||i===-1?null:{start:c,end:i}}else s=null}s=s||{start:0,end:0}}else s=null;for(od={focusedElem:e,selectionRange:s},Dl=!1,Ie=t;Ie!==null;)if(t=Ie,e=t.child,(t.subtreeFlags&1028)!==0&&e!==null)e.return=t,Ie=e;else for(;Ie!==null;){t=Ie;try{var L=t.alternate;if(t.flags&1024)switch(t.tag){case 0:case 11:case 15:break;case 1:if(L!==null){var k=L.memoizedProps,U=L.memoizedState,N=t.stateNode,x=N.getSnapshotBeforeUpdate(t.elementType===t.type?k:Bn(t.type,k),U);N.__reactInternalSnapshotBeforeUpdate=x}break;case 3:var b=t.stateNode.containerInfo;b.nodeType===1?b.textContent="":b.nodeType===9&&b.documentElement&&b.removeChild(b.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(pe(163))}}catch(F){kt(t,t.return,F)}if(e=t.sibling,e!==null){e.return=t.return,Ie=e;break}Ie=t.return}return L=Gm,Gm=!1,L}function Ka(e,t,s){var r=t.updateQueue;if(r=r!==null?r.lastEffect:null,r!==null){var a=r=r.next;do{if((a.tag&e)===e){var o=a.destroy;a.destroy=void 0,o!==void 0&&Sd(t,s,o)}a=a.next}while(a!==r)}}function yi(e,t){if(t=t.updateQueue,t=t!==null?t.lastEffect:null,t!==null){var s=t=t.next;do{if((s.tag&e)===e){var r=s.create;s.destroy=r()}s=s.next}while(s!==t)}}function wd(e){var t=e.ref;if(t!==null){var s=e.stateNode;switch(e.tag){case 5:e=s;break;default:e=s}typeof t=="function"?t(e):t.current=e}}function Ux(e){var t=e.alternate;t!==null&&(e.alternate=null,Ux(t)),e.child=null,e.deletions=null,e.sibling=null,e.tag===5&&(t=e.stateNode,t!==null&&(delete t[es],delete t[lo],delete t[cd],delete t[Fy],delete t[By])),e.stateNode=null,e.return=null,e.dependencies=null,e.memoizedProps=null,e.memoizedState=null,e.pendingProps=null,e.stateNode=null,e.updateQueue=null}function Wx(e){return e.tag===5||e.tag===3||e.tag===4}function qm(e){e:for(;;){for(;e.sibling===null;){if(e.return===null||Wx(e.return))return null;e=e.return}for(e.sibling.return=e.return,e=e.sibling;e.tag!==5&&e.tag!==6&&e.tag!==18;){if(e.flags&2||e.child===null||e.tag===4)continue e;e.child.return=e,e=e.child}if(!(e.flags&2))return e.stateNode}}function jd(e,t,s){var r=e.tag;if(r===5||r===6)e=e.stateNode,t?s.nodeType===8?s.parentNode.insertBefore(e,t):s.insertBefore(e,t):(s.nodeType===8?(t=s.parentNode,t.insertBefore(e,s)):(t=s,t.appendChild(e)),s=s._reactRootContainer,s!=null||t.onclick!==null||(t.onclick=Ol));else if(r!==4&&(e=e.child,e!==null))for(jd(e,t,s),e=e.sibling;e!==null;)jd(e,t,s),e=e.sibling}function Ed(e,t,s){var r=e.tag;if(r===5||r===6)e=e.stateNode,t?s.insertBefore(e,t):s.appendChild(e);else if(r!==4&&(e=e.child,e!==null))for(Ed(e,t,s),e=e.sibling;e!==null;)Ed(e,t,s),e=e.sibling}var Wt=null,$n=!1;function Ls(e,t,s){for(s=s.child;s!==null;)zx(e,t,s),s=s.sibling}function zx(e,t,s){if(rs&&typeof rs.onCommitFiberUnmount=="function")try{rs.onCommitFiberUnmount(di,s)}catch{}switch(s.tag){case 5:Qt||Wr(s,t);case 6:var r=Wt,a=$n;Wt=null,Ls(e,t,s),Wt=r,$n=a,Wt!==null&&($n?(e=Wt,s=s.stateNode,e.nodeType===8?e.parentNode.removeChild(s):e.removeChild(s)):Wt.removeChild(s.stateNode));break;case 18:Wt!==null&&($n?(e=Wt,s=s.stateNode,e.nodeType===8?pc(e.parentNode,s):e.nodeType===1&&pc(e,s),no(e)):pc(Wt,s.stateNode));break;case 4:r=Wt,a=$n,Wt=s.stateNode.containerInfo,$n=!0,Ls(e,t,s),Wt=r,$n=a;break;case 0:case 11:case 14:case 15:if(!Qt&&(r=s.updateQueue,r!==null&&(r=r.lastEffect,r!==null))){a=r=r.next;do{var o=a,l=o.destroy;o=o.tag,l!==void 0&&(o&2||o&4)&&Sd(s,t,l),a=a.next}while(a!==r)}Ls(e,t,s);break;case 1:if(!Qt&&(Wr(s,t),r=s.stateNode,typeof r.componentWillUnmount=="function"))try{r.props=s.memoizedProps,r.state=s.memoizedState,r.componentWillUnmount()}catch(c){kt(s,t,c)}Ls(e,t,s);break;case 21:Ls(e,t,s);break;case 22:s.mode&1?(Qt=(r=Qt)||s.memoizedState!==null,Ls(e,t,s),Qt=r):Ls(e,t,s);break;default:Ls(e,t,s)}}function Xm(e){var t=e.updateQueue;if(t!==null){e.updateQueue=null;var s=e.stateNode;s===null&&(s=e.stateNode=new t0),t.forEach(function(r){var a=u0.bind(null,e,r);s.has(r)||(s.add(r),r.then(a,a))})}}function Fn(e,t){var s=t.deletions;if(s!==null)for(var r=0;r<s.length;r++){var a=s[r];try{var o=e,l=t,c=l;e:for(;c!==null;){switch(c.tag){case 5:Wt=c.stateNode,$n=!1;break e;case 3:Wt=c.stateNode.containerInfo,$n=!0;break e;case 4:Wt=c.stateNode.containerInfo,$n=!0;break e}c=c.return}if(Wt===null)throw Error(pe(160));zx(o,l,a),Wt=null,$n=!1;var i=a.alternate;i!==null&&(i.return=null),a.return=null}catch(u){kt(a,t,u)}}if(t.subtreeFlags&12854)for(t=t.child;t!==null;)Vx(t,e),t=t.sibling}function Vx(e,t){var s=e.alternate,r=e.flags;switch(e.tag){case 0:case 11:case 14:case 15:if(Fn(t,e),Xn(e),r&4){try{Ka(3,e,e.return),yi(3,e)}catch(k){kt(e,e.return,k)}try{Ka(5,e,e.return)}catch(k){kt(e,e.return,k)}}break;case 1:Fn(t,e),Xn(e),r&512&&s!==null&&Wr(s,s.return);break;case 5:if(Fn(t,e),Xn(e),r&512&&s!==null&&Wr(s,s.return),e.flags&32){var a=e.stateNode;try{Qa(a,"")}catch(k){kt(e,e.return,k)}}if(r&4&&(a=e.stateNode,a!=null)){var o=e.memoizedProps,l=s!==null?s.memoizedProps:o,c=e.type,i=e.updateQueue;if(e.updateQueue=null,i!==null)try{c==="input"&&o.type==="radio"&&o.name!=null&&pf(a,o),qc(c,l);var u=qc(c,o);for(l=0;l<i.length;l+=2){var p=i[l],y=i[l+1];p==="style"?yf(a,y):p==="dangerouslySetInnerHTML"?hf(a,y):p==="children"?Qa(a,y):Wd(a,p,y,u)}switch(c){case"input":zc(a,o);break;case"textarea":ff(a,o);break;case"select":var S=a._wrapperState.wasMultiple;a._wrapperState.wasMultiple=!!o.multiple;var w=o.value;w!=null?Vr(a,!!o.multiple,w,!1):S!==!!o.multiple&&(o.defaultValue!=null?Vr(a,!!o.multiple,o.defaultValue,!0):Vr(a,!!o.multiple,o.multiple?[]:"",!1))}a[lo]=o}catch(k){kt(e,e.return,k)}}break;case 6:if(Fn(t,e),Xn(e),r&4){if(e.stateNode===null)throw Error(pe(162));a=e.stateNode,o=e.memoizedProps;try{a.nodeValue=o}catch(k){kt(e,e.return,k)}}break;case 3:if(Fn(t,e),Xn(e),r&4&&s!==null&&s.memoizedState.isDehydrated)try{no(t.containerInfo)}catch(k){kt(e,e.return,k)}break;case 4:Fn(t,e),Xn(e);break;case 13:Fn(t,e),Xn(e),a=e.child,a.flags&8192&&(o=a.memoizedState!==null,a.stateNode.isHidden=o,!o||a.alternate!==null&&a.alternate.memoizedState!==null||(Su=It())),r&4&&Xm(e);break;case 22:if(p=s!==null&&s.memoizedState!==null,e.mode&1?(Qt=(u=Qt)||p,Fn(t,e),Qt=u):Fn(t,e),Xn(e),r&8192){if(u=e.memoizedState!==null,(e.stateNode.isHidden=u)&&!p&&e.mode&1)for(Ie=e,p=e.child;p!==null;){for(y=Ie=p;Ie!==null;){switch(S=Ie,w=S.child,S.tag){case 0:case 11:case 14:case 15:Ka(4,S,S.return);break;case 1:Wr(S,S.return);var L=S.stateNode;if(typeof L.componentWillUnmount=="function"){r=S,s=S.return;try{t=r,L.props=t.memoizedProps,L.state=t.memoizedState,L.componentWillUnmount()}catch(k){kt(r,s,k)}}break;case 5:Wr(S,S.return);break;case 22:if(S.memoizedState!==null){Qm(y);continue}}w!==null?(w.return=S,Ie=w):Qm(y)}p=p.sibling}e:for(p=null,y=e;;){if(y.tag===5){if(p===null){p=y;try{a=y.stateNode,u?(o=a.style,typeof o.setProperty=="function"?o.setProperty("display","none","important"):o.display="none"):(c=y.stateNode,i=y.memoizedProps.style,l=i!=null&&i.hasOwnProperty("display")?i.display:null,c.style.display=gf("display",l))}catch(k){kt(e,e.return,k)}}}else if(y.tag===6){if(p===null)try{y.stateNode.nodeValue=u?"":y.memoizedProps}catch(k){kt(e,e.return,k)}}else if((y.tag!==22&&y.tag!==23||y.memoizedState===null||y===e)&&y.child!==null){y.child.return=y,y=y.child;continue}if(y===e)break e;for(;y.sibling===null;){if(y.return===null||y.return===e)break e;p===y&&(p=null),y=y.return}p===y&&(p=null),y.sibling.return=y.return,y=y.sibling}}break;case 19:Fn(t,e),Xn(e),r&4&&Xm(e);break;case 21:break;default:Fn(t,e),Xn(e)}}function Xn(e){var t=e.flags;if(t&2){try{e:{for(var s=e.return;s!==null;){if(Wx(s)){var r=s;break e}s=s.return}throw Error(pe(160))}switch(r.tag){case 5:var a=r.stateNode;r.flags&32&&(Qa(a,""),r.flags&=-33);var o=qm(e);Ed(e,o,a);break;case 3:case 4:var l=r.stateNode.containerInfo,c=qm(e);jd(e,c,l);break;default:throw Error(pe(161))}}catch(i){kt(e,e.return,i)}e.flags&=-3}t&4096&&(e.flags&=-4097)}function s0(e,t,s){Ie=e,Kx(e)}function Kx(e,t,s){for(var r=(e.mode&1)!==0;Ie!==null;){var a=Ie,o=a.child;if(a.tag===22&&r){var l=a.memoizedState!==null||sl;if(!l){var c=a.alternate,i=c!==null&&c.memoizedState!==null||Qt;c=sl;var u=Qt;if(sl=l,(Qt=i)&&!u)for(Ie=a;Ie!==null;)l=Ie,i=l.child,l.tag===22&&l.memoizedState!==null?Zm(a):i!==null?(i.return=l,Ie=i):Zm(a);for(;o!==null;)Ie=o,Kx(o),o=o.sibling;Ie=a,sl=c,Qt=u}Jm(e)}else a.subtreeFlags&8772&&o!==null?(o.return=a,Ie=o):Jm(e)}}function Jm(e){for(;Ie!==null;){var t=Ie;if(t.flags&8772){var s=t.alternate;try{if(t.flags&8772)switch(t.tag){case 0:case 11:case 15:Qt||yi(5,t);break;case 1:var r=t.stateNode;if(t.flags&4&&!Qt)if(s===null)r.componentDidMount();else{var a=t.elementType===t.type?s.memoizedProps:Bn(t.type,s.memoizedProps);r.componentDidUpdate(a,s.memoizedState,r.__reactInternalSnapshotBeforeUpdate)}var o=t.updateQueue;o!==null&&Om(t,o,r);break;case 3:var l=t.updateQueue;if(l!==null){if(s=null,t.child!==null)switch(t.child.tag){case 5:s=t.child.stateNode;break;case 1:s=t.child.stateNode}Om(t,l,s)}break;case 5:var c=t.stateNode;if(s===null&&t.flags&4){s=c;var i=t.memoizedProps;switch(t.type){case"button":case"input":case"select":case"textarea":i.autoFocus&&s.focus();break;case"img":i.src&&(s.src=i.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(t.memoizedState===null){var u=t.alternate;if(u!==null){var p=u.memoizedState;if(p!==null){var y=p.dehydrated;y!==null&&no(y)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(pe(163))}Qt||t.flags&512&&wd(t)}catch(S){kt(t,t.return,S)}}if(t===e){Ie=null;break}if(s=t.sibling,s!==null){s.return=t.return,Ie=s;break}Ie=t.return}}function Qm(e){for(;Ie!==null;){var t=Ie;if(t===e){Ie=null;break}var s=t.sibling;if(s!==null){s.return=t.return,Ie=s;break}Ie=t.return}}function Zm(e){for(;Ie!==null;){var t=Ie;try{switch(t.tag){case 0:case 11:case 15:var s=t.return;try{yi(4,t)}catch(i){kt(t,s,i)}break;case 1:var r=t.stateNode;if(typeof r.componentDidMount=="function"){var a=t.return;try{r.componentDidMount()}catch(i){kt(t,a,i)}}var o=t.return;try{wd(t)}catch(i){kt(t,o,i)}break;case 5:var l=t.return;try{wd(t)}catch(i){kt(t,l,i)}}}catch(i){kt(t,t.return,i)}if(t===e){Ie=null;break}var c=t.sibling;if(c!==null){c.return=t.return,Ie=c;break}Ie=t.return}}var r0=Math.ceil,Kl=As.ReactCurrentDispatcher,bu=As.ReactCurrentOwner,Cn=As.ReactCurrentBatchConfig,tt=0,$t=null,Rt=null,Vt=0,xn=0,zr=tr(0),Mt=0,fo=null,yr=0,Ni=0,vu=0,Ya=null,cn=null,Su=0,ra=1/0,fs=null,Yl=!1,kd=null,qs=null,rl=!1,Us=null,Gl=0,Ga=0,Ad=null,wl=-1,jl=0;function sn(){return tt&6?It():wl!==-1?wl:wl=It()}function Xs(e){return e.mode&1?tt&2&&Vt!==0?Vt&-Vt:Hy.transition!==null?(jl===0&&(jl=Rf()),jl):(e=ot,e!==0||(e=window.event,e=e===void 0?16:Pf(e.type)),e):1}function Wn(e,t,s,r){if(50<Ga)throw Ga=0,Ad=null,Error(pe(185));ko(e,s,r),(!(tt&2)||e!==$t)&&(e===$t&&(!(tt&2)&&(Ni|=s),Mt===4&&Bs(e,Vt)),pn(e,r),s===1&&tt===0&&!(t.mode&1)&&(ra=It()+500,xi&&nr()))}function pn(e,t){var s=e.callbackNode;Hg(e,t);var r=Cl(e,e===$t?Vt:0);if(r===0)s!==null&&im(s),e.callbackNode=null,e.callbackPriority=0;else if(t=r&-r,e.callbackPriority!==t){if(s!=null&&im(s),t===1)e.tag===0?$y(ep.bind(null,e)):nx(ep.bind(null,e)),My(function(){!(tt&6)&&nr()}),s=null;else{switch(Cf(r)){case 1:s=Gd;break;case 4:s=If;break;case 16:s=Rl;break;case 536870912:s=Tf;break;default:s=Rl}s=eh(s,Yx.bind(null,e))}e.callbackPriority=t,e.callbackNode=s}}function Yx(e,t){if(wl=-1,jl=0,tt&6)throw Error(pe(327));var s=e.callbackNode;if(Xr()&&e.callbackNode!==s)return null;var r=Cl(e,e===$t?Vt:0);if(r===0)return null;if(r&30||r&e.expiredLanes||t)t=ql(e,r);else{t=r;var a=tt;tt|=2;var o=qx();($t!==e||Vt!==t)&&(fs=null,ra=It()+500,mr(e,t));do try{l0();break}catch(c){Gx(e,c)}while(!0);lu(),Kl.current=o,tt=a,Rt!==null?t=0:($t=null,Vt=0,t=Mt)}if(t!==0){if(t===2&&(a=ed(e),a!==0&&(r=a,t=Id(e,a))),t===1)throw s=fo,mr(e,0),Bs(e,r),pn(e,It()),s;if(t===6)Bs(e,r);else{if(a=e.current.alternate,!(r&30)&&!a0(a)&&(t=ql(e,r),t===2&&(o=ed(e),o!==0&&(r=o,t=Id(e,o))),t===1))throw s=fo,mr(e,0),Bs(e,r),pn(e,It()),s;switch(e.finishedWork=a,e.finishedLanes=r,t){case 0:case 1:throw Error(pe(345));case 2:or(e,cn,fs);break;case 3:if(Bs(e,r),(r&130023424)===r&&(t=Su+500-It(),10<t)){if(Cl(e,0)!==0)break;if(a=e.suspendedLanes,(a&r)!==r){sn(),e.pingedLanes|=e.suspendedLanes&a;break}e.timeoutHandle=id(or.bind(null,e,cn,fs),t);break}or(e,cn,fs);break;case 4:if(Bs(e,r),(r&4194240)===r)break;for(t=e.eventTimes,a=-1;0<r;){var l=31-Un(r);o=1<<l,l=t[l],l>a&&(a=l),r&=~o}if(r=a,r=It()-r,r=(120>r?120:480>r?480:1080>r?1080:1920>r?1920:3e3>r?3e3:4320>r?4320:1960*r0(r/1960))-r,10<r){e.timeoutHandle=id(or.bind(null,e,cn,fs),r);break}or(e,cn,fs);break;case 5:or(e,cn,fs);break;default:throw Error(pe(329))}}}return pn(e,It()),e.callbackNode===s?Yx.bind(null,e):null}function Id(e,t){var s=Ya;return e.current.memoizedState.isDehydrated&&(mr(e,t).flags|=256),e=ql(e,t),e!==2&&(t=cn,cn=s,t!==null&&Td(t)),e}function Td(e){cn===null?cn=e:cn.push.apply(cn,e)}function a0(e){for(var t=e;;){if(t.flags&16384){var s=t.updateQueue;if(s!==null&&(s=s.stores,s!==null))for(var r=0;r<s.length;r++){var a=s[r],o=a.getSnapshot;a=a.value;try{if(!Vn(o(),a))return!1}catch{return!1}}}if(s=t.child,t.subtreeFlags&16384&&s!==null)s.return=t,t=s;else{if(t===e)break;for(;t.sibling===null;){if(t.return===null||t.return===e)return!0;t=t.return}t.sibling.return=t.return,t=t.sibling}}return!0}function Bs(e,t){for(t&=~vu,t&=~Ni,e.suspendedLanes|=t,e.pingedLanes&=~t,e=e.expirationTimes;0<t;){var s=31-Un(t),r=1<<s;e[s]=-1,t&=~r}}function ep(e){if(tt&6)throw Error(pe(327));Xr();var t=Cl(e,0);if(!(t&1))return pn(e,It()),null;var s=ql(e,t);if(e.tag!==0&&s===2){var r=ed(e);r!==0&&(t=r,s=Id(e,r))}if(s===1)throw s=fo,mr(e,0),Bs(e,t),pn(e,It()),s;if(s===6)throw Error(pe(345));return e.finishedWork=e.current.alternate,e.finishedLanes=t,or(e,cn,fs),pn(e,It()),null}function wu(e,t){var s=tt;tt|=1;try{return e(t)}finally{tt=s,tt===0&&(ra=It()+500,xi&&nr())}}function Nr(e){Us!==null&&Us.tag===0&&!(tt&6)&&Xr();var t=tt;tt|=1;var s=Cn.transition,r=ot;try{if(Cn.transition=null,ot=1,e)return e()}finally{ot=r,Cn.transition=s,tt=t,!(tt&6)&&nr()}}function ju(){xn=zr.current,ht(zr)}function mr(e,t){e.finishedWork=null,e.finishedLanes=0;var s=e.timeoutHandle;if(s!==-1&&(e.timeoutHandle=-1,Oy(s)),Rt!==null)for(s=Rt.return;s!==null;){var r=s;switch(ru(r),r.tag){case 1:r=r.type.childContextTypes,r!=null&&Ml();break;case 3:na(),ht(un),ht(en),pu();break;case 5:mu(r);break;case 4:na();break;case 13:ht(vt);break;case 19:ht(vt);break;case 10:iu(r.type._context);break;case 22:case 23:ju()}s=s.return}if($t=e,Rt=e=Js(e.current,null),Vt=xn=t,Mt=0,fo=null,vu=Ni=yr=0,cn=Ya=null,dr!==null){for(t=0;t<dr.length;t++)if(s=dr[t],r=s.interleaved,r!==null){s.interleaved=null;var a=r.next,o=s.pending;if(o!==null){var l=o.next;o.next=a,r.next=l}s.pending=r}dr=null}return e}function Gx(e,t){do{var s=Rt;try{if(lu(),bl.current=Vl,zl){for(var r=St.memoizedState;r!==null;){var a=r.queue;a!==null&&(a.pending=null),r=r.next}zl=!1}if(gr=0,Bt=_t=St=null,Va=!1,uo=0,bu.current=null,s===null||s.return===null){Mt=1,fo=t,Rt=null;break}e:{var o=e,l=s.return,c=s,i=t;if(t=Vt,c.flags|=32768,i!==null&&typeof i=="object"&&typeof i.then=="function"){var u=i,p=c,y=p.tag;if(!(p.mode&1)&&(y===0||y===11||y===15)){var S=p.alternate;S?(p.updateQueue=S.updateQueue,p.memoizedState=S.memoizedState,p.lanes=S.lanes):(p.updateQueue=null,p.memoizedState=null)}var w=Hm(l);if(w!==null){w.flags&=-257,Um(w,l,c,o,t),w.mode&1&&$m(o,u,t),t=w,i=u;var L=t.updateQueue;if(L===null){var k=new Set;k.add(i),t.updateQueue=k}else L.add(i);break e}else{if(!(t&1)){$m(o,u,t),Eu();break e}i=Error(pe(426))}}else if(gt&&c.mode&1){var U=Hm(l);if(U!==null){!(U.flags&65536)&&(U.flags|=256),Um(U,l,c,o,t),au(sa(i,c));break e}}o=i=sa(i,c),Mt!==4&&(Mt=2),Ya===null?Ya=[o]:Ya.push(o),o=l;do{switch(o.tag){case 3:o.flags|=65536,t&=-t,o.lanes|=t;var N=Cx(o,i,t);_m(o,N);break e;case 1:c=i;var x=o.type,b=o.stateNode;if(!(o.flags&128)&&(typeof x.getDerivedStateFromError=="function"||b!==null&&typeof b.componentDidCatch=="function"&&(qs===null||!qs.has(b)))){o.flags|=65536,t&=-t,o.lanes|=t;var F=Dx(o,c,t);_m(o,F);break e}}o=o.return}while(o!==null)}Jx(s)}catch(H){t=H,Rt===s&&s!==null&&(Rt=s=s.return);continue}break}while(!0)}function qx(){var e=Kl.current;return Kl.current=Vl,e===null?Vl:e}function Eu(){(Mt===0||Mt===3||Mt===2)&&(Mt=4),$t===null||!(yr&268435455)&&!(Ni&268435455)||Bs($t,Vt)}function ql(e,t){var s=tt;tt|=2;var r=qx();($t!==e||Vt!==t)&&(fs=null,mr(e,t));do try{o0();break}catch(a){Gx(e,a)}while(!0);if(lu(),tt=s,Kl.current=r,Rt!==null)throw Error(pe(261));return $t=null,Vt=0,Mt}function o0(){for(;Rt!==null;)Xx(Rt)}function l0(){for(;Rt!==null&&!Dg();)Xx(Rt)}function Xx(e){var t=Zx(e.alternate,e,xn);e.memoizedProps=e.pendingProps,t===null?Jx(e):Rt=t,bu.current=null}function Jx(e){var t=e;do{var s=t.alternate;if(e=t.return,t.flags&32768){if(s=e0(s,t),s!==null){s.flags&=32767,Rt=s;return}if(e!==null)e.flags|=32768,e.subtreeFlags=0,e.deletions=null;else{Mt=6,Rt=null;return}}else if(s=Zy(s,t,xn),s!==null){Rt=s;return}if(t=t.sibling,t!==null){Rt=t;return}Rt=t=e}while(t!==null);Mt===0&&(Mt=5)}function or(e,t,s){var r=ot,a=Cn.transition;try{Cn.transition=null,ot=1,i0(e,t,s,r)}finally{Cn.transition=a,ot=r}return null}function i0(e,t,s,r){do Xr();while(Us!==null);if(tt&6)throw Error(pe(327));s=e.finishedWork;var a=e.finishedLanes;if(s===null)return null;if(e.finishedWork=null,e.finishedLanes=0,s===e.current)throw Error(pe(177));e.callbackNode=null,e.callbackPriority=0;var o=s.lanes|s.childLanes;if(Ug(e,o),e===$t&&(Rt=$t=null,Vt=0),!(s.subtreeFlags&2064)&&!(s.flags&2064)||rl||(rl=!0,eh(Rl,function(){return Xr(),null})),o=(s.flags&15990)!==0,s.subtreeFlags&15990||o){o=Cn.transition,Cn.transition=null;var l=ot;ot=1;var c=tt;tt|=4,bu.current=null,n0(e,s),Vx(s,e),Iy(od),Dl=!!ad,od=ad=null,e.current=s,s0(s),Lg(),tt=c,ot=l,Cn.transition=o}else e.current=s;if(rl&&(rl=!1,Us=e,Gl=a),o=e.pendingLanes,o===0&&(qs=null),Mg(s.stateNode),pn(e,It()),t!==null)for(r=e.onRecoverableError,s=0;s<t.length;s++)a=t[s],r(a.value,{componentStack:a.stack,digest:a.digest});if(Yl)throw Yl=!1,e=kd,kd=null,e;return Gl&1&&e.tag!==0&&Xr(),o=e.pendingLanes,o&1?e===Ad?Ga++:(Ga=0,Ad=e):Ga=0,nr(),null}function Xr(){if(Us!==null){var e=Cf(Gl),t=Cn.transition,s=ot;try{if(Cn.transition=null,ot=16>e?16:e,Us===null)var r=!1;else{if(e=Us,Us=null,Gl=0,tt&6)throw Error(pe(331));var a=tt;for(tt|=4,Ie=e.current;Ie!==null;){var o=Ie,l=o.child;if(Ie.flags&16){var c=o.deletions;if(c!==null){for(var i=0;i<c.length;i++){var u=c[i];for(Ie=u;Ie!==null;){var p=Ie;switch(p.tag){case 0:case 11:case 15:Ka(8,p,o)}var y=p.child;if(y!==null)y.return=p,Ie=y;else for(;Ie!==null;){p=Ie;var S=p.sibling,w=p.return;if(Ux(p),p===u){Ie=null;break}if(S!==null){S.return=w,Ie=S;break}Ie=w}}}var L=o.alternate;if(L!==null){var k=L.child;if(k!==null){L.child=null;do{var U=k.sibling;k.sibling=null,k=U}while(k!==null)}}Ie=o}}if(o.subtreeFlags&2064&&l!==null)l.return=o,Ie=l;else e:for(;Ie!==null;){if(o=Ie,o.flags&2048)switch(o.tag){case 0:case 11:case 15:Ka(9,o,o.return)}var N=o.sibling;if(N!==null){N.return=o.return,Ie=N;break e}Ie=o.return}}var x=e.current;for(Ie=x;Ie!==null;){l=Ie;var b=l.child;if(l.subtreeFlags&2064&&b!==null)b.return=l,Ie=b;else e:for(l=x;Ie!==null;){if(c=Ie,c.flags&2048)try{switch(c.tag){case 0:case 11:case 15:yi(9,c)}}catch(H){kt(c,c.return,H)}if(c===l){Ie=null;break e}var F=c.sibling;if(F!==null){F.return=c.return,Ie=F;break e}Ie=c.return}}if(tt=a,nr(),rs&&typeof rs.onPostCommitFiberRoot=="function")try{rs.onPostCommitFiberRoot(di,e)}catch{}r=!0}return r}finally{ot=s,Cn.transition=t}}return!1}function tp(e,t,s){t=sa(s,t),t=Cx(e,t,1),e=Gs(e,t,1),t=sn(),e!==null&&(ko(e,1,t),pn(e,t))}function kt(e,t,s){if(e.tag===3)tp(e,e,s);else for(;t!==null;){if(t.tag===3){tp(t,e,s);break}else if(t.tag===1){var r=t.stateNode;if(typeof t.type.getDerivedStateFromError=="function"||typeof r.componentDidCatch=="function"&&(qs===null||!qs.has(r))){e=sa(s,e),e=Dx(t,e,1),t=Gs(t,e,1),e=sn(),t!==null&&(ko(t,1,e),pn(t,e));break}}t=t.return}}function c0(e,t,s){var r=e.pingCache;r!==null&&r.delete(t),t=sn(),e.pingedLanes|=e.suspendedLanes&s,$t===e&&(Vt&s)===s&&(Mt===4||Mt===3&&(Vt&130023424)===Vt&&500>It()-Su?mr(e,0):vu|=s),pn(e,t)}function Qx(e,t){t===0&&(e.mode&1?(t=Go,Go<<=1,!(Go&130023424)&&(Go=4194304)):t=1);var s=sn();e=Es(e,t),e!==null&&(ko(e,t,s),pn(e,s))}function d0(e){var t=e.memoizedState,s=0;t!==null&&(s=t.retryLane),Qx(e,s)}function u0(e,t){var s=0;switch(e.tag){case 13:var r=e.stateNode,a=e.memoizedState;a!==null&&(s=a.retryLane);break;case 19:r=e.stateNode;break;default:throw Error(pe(314))}r!==null&&r.delete(t),Qx(e,s)}var Zx;Zx=function(e,t,s){if(e!==null)if(e.memoizedProps!==t.pendingProps||un.current)dn=!0;else{if(!(e.lanes&s)&&!(t.flags&128))return dn=!1,Qy(e,t,s);dn=!!(e.flags&131072)}else dn=!1,gt&&t.flags&1048576&&sx(t,Bl,t.index);switch(t.lanes=0,t.tag){case 2:var r=t.type;Sl(e,t),e=t.pendingProps;var a=Zr(t,en.current);qr(t,s),a=xu(null,t,r,e,a,s);var o=hu();return t.flags|=1,typeof a=="object"&&a!==null&&typeof a.render=="function"&&a.$$typeof===void 0?(t.tag=1,t.memoizedState=null,t.updateQueue=null,mn(r)?(o=!0,Pl(t)):o=!1,t.memoizedState=a.state!==null&&a.state!==void 0?a.state:null,du(t),a.updater=gi,t.stateNode=a,a._reactInternals=t,xd(t,r,e,s),t=yd(null,t,r,!0,o,s)):(t.tag=0,gt&&o&&su(t),nn(null,t,a,s),t=t.child),t;case 16:r=t.elementType;e:{switch(Sl(e,t),e=t.pendingProps,a=r._init,r=a(r._payload),t.type=r,a=t.tag=p0(r),e=Bn(r,e),a){case 0:t=gd(null,t,r,e,s);break e;case 1:t=Vm(null,t,r,e,s);break e;case 11:t=Wm(null,t,r,e,s);break e;case 14:t=zm(null,t,r,Bn(r.type,e),s);break e}throw Error(pe(306,r,""))}return t;case 0:return r=t.type,a=t.pendingProps,a=t.elementType===r?a:Bn(r,a),gd(e,t,r,a,s);case 1:return r=t.type,a=t.pendingProps,a=t.elementType===r?a:Bn(r,a),Vm(e,t,r,a,s);case 3:e:{if(Mx(t),e===null)throw Error(pe(387));r=t.pendingProps,o=t.memoizedState,a=o.element,cx(e,t),Ul(t,r,null,s);var l=t.memoizedState;if(r=l.element,o.isDehydrated)if(o={element:r,isDehydrated:!1,cache:l.cache,pendingSuspenseBoundaries:l.pendingSuspenseBoundaries,transitions:l.transitions},t.updateQueue.baseState=o,t.memoizedState=o,t.flags&256){a=sa(Error(pe(423)),t),t=Km(e,t,r,s,a);break e}else if(r!==a){a=sa(Error(pe(424)),t),t=Km(e,t,r,s,a);break e}else for(gn=Ys(t.stateNode.containerInfo.firstChild),yn=t,gt=!0,Hn=null,s=lx(t,null,r,s),t.child=s;s;)s.flags=s.flags&-3|4096,s=s.sibling;else{if(ea(),r===a){t=ks(e,t,s);break e}nn(e,t,r,s)}t=t.child}return t;case 5:return dx(t),e===null&&md(t),r=t.type,a=t.pendingProps,o=e!==null?e.memoizedProps:null,l=a.children,ld(r,a)?l=null:o!==null&&ld(r,o)&&(t.flags|=32),Ox(e,t),nn(e,t,l,s),t.child;case 6:return e===null&&md(t),null;case 13:return Px(e,t,s);case 4:return uu(t,t.stateNode.containerInfo),r=t.pendingProps,e===null?t.child=ta(t,null,r,s):nn(e,t,r,s),t.child;case 11:return r=t.type,a=t.pendingProps,a=t.elementType===r?a:Bn(r,a),Wm(e,t,r,a,s);case 7:return nn(e,t,t.pendingProps,s),t.child;case 8:return nn(e,t,t.pendingProps.children,s),t.child;case 12:return nn(e,t,t.pendingProps.children,s),t.child;case 10:e:{if(r=t.type._context,a=t.pendingProps,o=t.memoizedProps,l=a.value,mt($l,r._currentValue),r._currentValue=l,o!==null)if(Vn(o.value,l)){if(o.children===a.children&&!un.current){t=ks(e,t,s);break e}}else for(o=t.child,o!==null&&(o.return=t);o!==null;){var c=o.dependencies;if(c!==null){l=o.child;for(var i=c.firstContext;i!==null;){if(i.context===r){if(o.tag===1){i=bs(-1,s&-s),i.tag=2;var u=o.updateQueue;if(u!==null){u=u.shared;var p=u.pending;p===null?i.next=i:(i.next=p.next,p.next=i),u.pending=i}}o.lanes|=s,i=o.alternate,i!==null&&(i.lanes|=s),pd(o.return,s,t),c.lanes|=s;break}i=i.next}}else if(o.tag===10)l=o.type===t.type?null:o.child;else if(o.tag===18){if(l=o.return,l===null)throw Error(pe(341));l.lanes|=s,c=l.alternate,c!==null&&(c.lanes|=s),pd(l,s,t),l=o.sibling}else l=o.child;if(l!==null)l.return=o;else for(l=o;l!==null;){if(l===t){l=null;break}if(o=l.sibling,o!==null){o.return=l.return,l=o;break}l=l.return}o=l}nn(e,t,a.children,s),t=t.child}return t;case 9:return a=t.type,r=t.pendingProps.children,qr(t,s),a=Ln(a),r=r(a),t.flags|=1,nn(e,t,r,s),t.child;case 14:return r=t.type,a=Bn(r,t.pendingProps),a=Bn(r.type,a),zm(e,t,r,a,s);case 15:return Lx(e,t,t.type,t.pendingProps,s);case 17:return r=t.type,a=t.pendingProps,a=t.elementType===r?a:Bn(r,a),Sl(e,t),t.tag=1,mn(r)?(e=!0,Pl(t)):e=!1,qr(t,s),Rx(t,r,a),xd(t,r,a,s),yd(null,t,r,!0,e,s);case 19:return Fx(e,t,s);case 22:return _x(e,t,s)}throw Error(pe(156,t.tag))};function eh(e,t){return Af(e,t)}function m0(e,t,s,r){this.tag=e,this.key=s,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=t,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=r,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Rn(e,t,s,r){return new m0(e,t,s,r)}function ku(e){return e=e.prototype,!(!e||!e.isReactComponent)}function p0(e){if(typeof e=="function")return ku(e)?1:0;if(e!=null){if(e=e.$$typeof,e===Vd)return 11;if(e===Kd)return 14}return 2}function Js(e,t){var s=e.alternate;return s===null?(s=Rn(e.tag,t,e.key,e.mode),s.elementType=e.elementType,s.type=e.type,s.stateNode=e.stateNode,s.alternate=e,e.alternate=s):(s.pendingProps=t,s.type=e.type,s.flags=0,s.subtreeFlags=0,s.deletions=null),s.flags=e.flags&14680064,s.childLanes=e.childLanes,s.lanes=e.lanes,s.child=e.child,s.memoizedProps=e.memoizedProps,s.memoizedState=e.memoizedState,s.updateQueue=e.updateQueue,t=e.dependencies,s.dependencies=t===null?null:{lanes:t.lanes,firstContext:t.firstContext},s.sibling=e.sibling,s.index=e.index,s.ref=e.ref,s}function El(e,t,s,r,a,o){var l=2;if(r=e,typeof e=="function")ku(e)&&(l=1);else if(typeof e=="string")l=5;else e:switch(e){case _r:return pr(s.children,a,o,t);case zd:l=8,a|=8;break;case Bc:return e=Rn(12,s,t,a|2),e.elementType=Bc,e.lanes=o,e;case $c:return e=Rn(13,s,t,a),e.elementType=$c,e.lanes=o,e;case Hc:return e=Rn(19,s,t,a),e.elementType=Hc,e.lanes=o,e;case df:return bi(s,a,o,t);default:if(typeof e=="object"&&e!==null)switch(e.$$typeof){case lf:l=10;break e;case cf:l=9;break e;case Vd:l=11;break e;case Kd:l=14;break e;case _s:l=16,r=null;break e}throw Error(pe(130,e==null?e:typeof e,""))}return t=Rn(l,s,t,a),t.elementType=e,t.type=r,t.lanes=o,t}function pr(e,t,s,r){return e=Rn(7,e,r,t),e.lanes=s,e}function bi(e,t,s,r){return e=Rn(22,e,r,t),e.elementType=df,e.lanes=s,e.stateNode={isHidden:!1},e}function vc(e,t,s){return e=Rn(6,e,null,t),e.lanes=s,e}function Sc(e,t,s){return t=Rn(4,e.children!==null?e.children:[],e.key,t),t.lanes=s,t.stateNode={containerInfo:e.containerInfo,pendingChildren:null,implementation:e.implementation},t}function f0(e,t,s,r,a){this.tag=t,this.containerInfo=e,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=nc(0),this.expirationTimes=nc(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=nc(0),this.identifierPrefix=r,this.onRecoverableError=a,this.mutableSourceEagerHydrationData=null}function Au(e,t,s,r,a,o,l,c,i){return e=new f0(e,t,s,c,i),t===1?(t=1,o===!0&&(t|=8)):t=0,o=Rn(3,null,null,t),e.current=o,o.stateNode=e,o.memoizedState={element:r,isDehydrated:s,cache:null,transitions:null,pendingSuspenseBoundaries:null},du(o),e}function x0(e,t,s){var r=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:Lr,key:r==null?null:""+r,children:e,containerInfo:t,implementation:s}}function th(e){if(!e)return Zs;e=e._reactInternals;e:{if(Sr(e)!==e||e.tag!==1)throw Error(pe(170));var t=e;do{switch(t.tag){case 3:t=t.stateNode.context;break e;case 1:if(mn(t.type)){t=t.stateNode.__reactInternalMemoizedMergedChildContext;break e}}t=t.return}while(t!==null);throw Error(pe(171))}if(e.tag===1){var s=e.type;if(mn(s))return tx(e,s,t)}return t}function nh(e,t,s,r,a,o,l,c,i){return e=Au(s,r,!0,e,a,o,l,c,i),e.context=th(null),s=e.current,r=sn(),a=Xs(s),o=bs(r,a),o.callback=t??null,Gs(s,o,a),e.current.lanes=a,ko(e,a,r),pn(e,r),e}function vi(e,t,s,r){var a=t.current,o=sn(),l=Xs(a);return s=th(s),t.context===null?t.context=s:t.pendingContext=s,t=bs(o,l),t.payload={element:e},r=r===void 0?null:r,r!==null&&(t.callback=r),e=Gs(a,t,l),e!==null&&(Wn(e,a,l,o),Nl(e,a,l)),l}function Xl(e){if(e=e.current,!e.child)return null;switch(e.child.tag){case 5:return e.child.stateNode;default:return e.child.stateNode}}function np(e,t){if(e=e.memoizedState,e!==null&&e.dehydrated!==null){var s=e.retryLane;e.retryLane=s!==0&&s<t?s:t}}function Iu(e,t){np(e,t),(e=e.alternate)&&np(e,t)}function h0(){return null}var sh=typeof reportError=="function"?reportError:function(e){console.error(e)};function Tu(e){this._internalRoot=e}Si.prototype.render=Tu.prototype.render=function(e){var t=this._internalRoot;if(t===null)throw Error(pe(409));vi(e,t,null,null)};Si.prototype.unmount=Tu.prototype.unmount=function(){var e=this._internalRoot;if(e!==null){this._internalRoot=null;var t=e.containerInfo;Nr(function(){vi(null,e,null,null)}),t[js]=null}};function Si(e){this._internalRoot=e}Si.prototype.unstable_scheduleHydration=function(e){if(e){var t=_f();e={blockedOn:null,target:e,priority:t};for(var s=0;s<Fs.length&&t!==0&&t<Fs[s].priority;s++);Fs.splice(s,0,e),s===0&&Mf(e)}};function Ru(e){return!(!e||e.nodeType!==1&&e.nodeType!==9&&e.nodeType!==11)}function wi(e){return!(!e||e.nodeType!==1&&e.nodeType!==9&&e.nodeType!==11&&(e.nodeType!==8||e.nodeValue!==" react-mount-point-unstable "))}function sp(){}function g0(e,t,s,r,a){if(a){if(typeof r=="function"){var o=r;r=function(){var u=Xl(l);o.call(u)}}var l=nh(t,r,e,0,null,!1,!1,"",sp);return e._reactRootContainer=l,e[js]=l.current,ao(e.nodeType===8?e.parentNode:e),Nr(),l}for(;a=e.lastChild;)e.removeChild(a);if(typeof r=="function"){var c=r;r=function(){var u=Xl(i);c.call(u)}}var i=Au(e,0,!1,null,null,!1,!1,"",sp);return e._reactRootContainer=i,e[js]=i.current,ao(e.nodeType===8?e.parentNode:e),Nr(function(){vi(t,i,s,r)}),i}function ji(e,t,s,r,a){var o=s._reactRootContainer;if(o){var l=o;if(typeof a=="function"){var c=a;a=function(){var i=Xl(l);c.call(i)}}vi(t,l,e,a)}else l=g0(s,t,e,a,r);return Xl(l)}Df=function(e){switch(e.tag){case 3:var t=e.stateNode;if(t.current.memoizedState.isDehydrated){var s=Fa(t.pendingLanes);s!==0&&(qd(t,s|1),pn(t,It()),!(tt&6)&&(ra=It()+500,nr()))}break;case 13:Nr(function(){var r=Es(e,1);if(r!==null){var a=sn();Wn(r,e,1,a)}}),Iu(e,1)}};Xd=function(e){if(e.tag===13){var t=Es(e,134217728);if(t!==null){var s=sn();Wn(t,e,134217728,s)}Iu(e,134217728)}};Lf=function(e){if(e.tag===13){var t=Xs(e),s=Es(e,t);if(s!==null){var r=sn();Wn(s,e,t,r)}Iu(e,t)}};_f=function(){return ot};Of=function(e,t){var s=ot;try{return ot=e,t()}finally{ot=s}};Jc=function(e,t,s){switch(t){case"input":if(zc(e,s),t=s.name,s.type==="radio"&&t!=null){for(s=e;s.parentNode;)s=s.parentNode;for(s=s.querySelectorAll("input[name="+JSON.stringify(""+t)+'][type="radio"]'),t=0;t<s.length;t++){var r=s[t];if(r!==e&&r.form===e.form){var a=fi(r);if(!a)throw Error(pe(90));mf(r),zc(r,a)}}}break;case"textarea":ff(e,s);break;case"select":t=s.value,t!=null&&Vr(e,!!s.multiple,t,!1)}};vf=wu;Sf=Nr;var y0={usingClientEntryPoint:!1,Events:[Io,Fr,fi,Nf,bf,wu]},Da={findFiberByHostInstance:cr,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},N0={bundleType:Da.bundleType,version:Da.version,rendererPackageName:Da.rendererPackageName,rendererConfig:Da.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:As.ReactCurrentDispatcher,findHostInstanceByFiber:function(e){return e=Ef(e),e===null?null:e.stateNode},findFiberByHostInstance:Da.findFiberByHostInstance||h0,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var al=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!al.isDisabled&&al.supportsFiber)try{di=al.inject(N0),rs=al}catch{}}bn.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=y0;bn.createPortal=function(e,t){var s=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!Ru(t))throw Error(pe(200));return x0(e,t,null,s)};bn.createRoot=function(e,t){if(!Ru(e))throw Error(pe(299));var s=!1,r="",a=sh;return t!=null&&(t.unstable_strictMode===!0&&(s=!0),t.identifierPrefix!==void 0&&(r=t.identifierPrefix),t.onRecoverableError!==void 0&&(a=t.onRecoverableError)),t=Au(e,1,!1,null,null,s,!1,r,a),e[js]=t.current,ao(e.nodeType===8?e.parentNode:e),new Tu(t)};bn.findDOMNode=function(e){if(e==null)return null;if(e.nodeType===1)return e;var t=e._reactInternals;if(t===void 0)throw typeof e.render=="function"?Error(pe(188)):(e=Object.keys(e).join(","),Error(pe(268,e)));return e=Ef(t),e=e===null?null:e.stateNode,e};bn.flushSync=function(e){return Nr(e)};bn.hydrate=function(e,t,s){if(!wi(t))throw Error(pe(200));return ji(null,e,t,!0,s)};bn.hydrateRoot=function(e,t,s){if(!Ru(e))throw Error(pe(405));var r=s!=null&&s.hydratedSources||null,a=!1,o="",l=sh;if(s!=null&&(s.unstable_strictMode===!0&&(a=!0),s.identifierPrefix!==void 0&&(o=s.identifierPrefix),s.onRecoverableError!==void 0&&(l=s.onRecoverableError)),t=nh(t,null,e,1,s??null,a,!1,o,l),e[js]=t.current,ao(e),r)for(e=0;e<r.length;e++)s=r[e],a=s._getVersion,a=a(s._source),t.mutableSourceEagerHydrationData==null?t.mutableSourceEagerHydrationData=[s,a]:t.mutableSourceEagerHydrationData.push(s,a);return new Si(t)};bn.render=function(e,t,s){if(!wi(t))throw Error(pe(200));return ji(null,e,t,!1,s)};bn.unmountComponentAtNode=function(e){if(!wi(e))throw Error(pe(40));return e._reactRootContainer?(Nr(function(){ji(null,null,e,!1,function(){e._reactRootContainer=null,e[js]=null})}),!0):!1};bn.unstable_batchedUpdates=wu;bn.unstable_renderSubtreeIntoContainer=function(e,t,s,r){if(!wi(s))throw Error(pe(200));if(e==null||e._reactInternals===void 0)throw Error(pe(38));return ji(e,t,s,!1,r)};bn.version="18.3.1-next-f1338f8080-20240426";function rh(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(rh)}catch(e){console.error(e)}}rh(),sf.exports=bn;var b0=sf.exports,rp=b0;Pc.createRoot=rp.createRoot,Pc.hydrateRoot=rp.hydrateRoot;/**
 * @license
 * (c) Copyright 2023 Grammarly, Inc.
 * 
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 * 
 *     http://www.apache.org/licenses/LICENSE-2.0
 * 
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ol(e,t,s){return t in e?Object.defineProperty(e,t,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[t]=s,e}var ap=new Map;class xo extends Error{constructor(t,s){super(),ol(this,"args",void 0),ol(this,"code",void 0),ol(this,"url",void 0),ol(this,"_c",void 0);var r=new URL("https://developer.grammarly.com/docs/error-explainer");r.searchParams.set("code",t.toString()),s.forEach(a=>r.searchParams.append("args",function(o){if(o instanceof Error)return o.message+`
`+String(o.stack);if(o==null)return"null";if(typeof o=="object")try{return Object.prototype.toString.call(o)}catch{}return String(o)}(a))),this.stack!=null&&r.searchParams.set("trace",this.stack),this.message="Minified error #".concat(t,": See ").concat(r.toString()," for details."),this.args=s,this.code=t,this.url=r.toString()}toUserMessage(){var t=ap.get("".concat(this.code));if(t==null)return[this];var s=new Map(this.args.map((a,o)=>["${".concat(o,"}"),a])),r=t.split(/(\${\d+})/).filter(a=>a!=="");return r.map(a=>{var o;return(o=s.get(a))!==null&&o!==void 0?o:a})}toJSON(){return{name:"InvariantError",message:this.message,description:this._m,code:this.code,args:this.args,stack:this.stack}}static setMessages(t){ap=t}static create(t,s,r,a){a!=null&&s.push(a);var o=new xo(t,s,r);return o.stack=a==null?void 0:a.stack,o._m=r,o}}const op=new WeakMap;async function v0(e,t){const s=op.get(e);if(s!=null)return await s;(function(a){a.Grammarly==null&&(a.Grammarly={})})(e);const r=new Promise((a,o)=>{try{let c=function(i,u){return i.document.querySelectorAll(`script[src^="${u.replace(/\?.*$/,"")}"]`)[0]}(e,t);c!=null?l():(c=function(i,u){const p=i.document.createElement("script");return p.src=u,i.document.head.appendChild(p),p}(e,t),c.addEventListener("load",l),c.addEventListener("error",function(){try{throw new xo(23,[])}catch(i){o(i)}}))}catch(c){return o(c)}function l(){try{if(e.Grammarly==null||typeof e.Grammarly.EditorSDK!="function")throw new xo(22,[]);a(e.Grammarly)}catch(c){o(c)}}});return op.set(e,r),await r}async function lp(e,t,s,r){if(typeof window>"u"&&r===void 0)throw new xo(21,[]);const a=function(c){return c.location.origin!=="null"?c.location.origin:c.origin!=="null"?c.origin:"null"}(r??window);a==="null"&&(r??window).top!==(r??window)&&console.warn("Grammarly is not supported in IFrames with `null` origin. Consider adding `sandbox='allow-same-origin allow-scripts'` to <iframe> element.");const o=new URL("https://js.grammarly.com/grammarly-editor-sdk@2.5",a);t!=null&&o.searchParams.set("clientId",t),o.searchParams.set("packageName",e);const l=await v0(r??window,o.toString());if(t!=null)return new l.EditorSDK(t,s)}const wc={onBeforeSuggestionCardOpen:"before-suggestion-card-open",onSuggestionCardOpen:"suggestion-card-open",onSuggestionCardClose:"suggestion-card-close",onSuggestionCardAction:"suggestion-card-action",onPluginTurnedOff:"plugin-turned-off",onPluginError:"plugin-error",onDocumentStats:"document-stats",onSessionStats:"session-stats"};/**
 * @license
 * (c) Copyright 2023 Grammarly, Inc.
 * 
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 * 
 *     http://www.apache.org/licenses/LICENSE-2.0
 * 
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const S0=ci.createContext({});function w0(e,t,s){const r=g.useCallback(a=>e==null?void 0:e(new CustomEvent("plugin-error",{detail:a})),[e]);g.useEffect(()=>{var a;typeof navigator<"u"&&(t!=null&&((a=s==null?void 0:s.current)===null||a===void 0?void 0:a.ownerDocument.defaultView)!=null&&window!==s.current.ownerDocument.defaultView?lp("@grammarly/editor-sdk-react",t,void 0,s.current.ownerDocument.defaultView).catch(r):lp("@grammarly/editor-sdk-react").catch(r))},s!=null&&t!=null?[s,t]:[])}function ip(e){return typeof e=="function"}const ho=e=>{const[t,{clientId:s,config:r,children:a,className:o,...l}]=function(k){const U={},N={...k};return Object.keys(wc).forEach(x=>{U[x]=k[x],x in N&&delete N[x]}),[U,N]}(e),c=g.useContext(S0),i=g.useRef(),u=g.useRef(),p=g.useRef(),y=g.useCallback(k=>{i.current=k,w()},[]),S=function(k){const[U,N]=g.useState({}),x=g.useCallback(()=>{customElements.whenDefined(k).then(()=>N(b=>({...b,[k]:!0}))).catch(()=>{})},[k]);return g.useEffect(x,[x]),!!U[k]}("grammarly-editor-plugin"),w=g.useCallback(()=>{var k;i.current!=null&&u.current!=null&&S&&i.current.connect(u.current,(k=p.current)!==null&&k!==void 0?k:void 0)},[S]),L=g.useMemo(()=>({...c.config,...r}),[c.config,r]);return g.useEffect(()=>{i.current&&(i.current.config=L)},[i,L]),g.useEffect(()=>{if(i.current==null)return;const{current:k}=i,U=[];return Object.keys(wc).forEach(N=>{const x=t[N],b=wc[N];x!=null&&(k.addEventListener(b,x),U.push(()=>k.removeEventListener(b,x)))}),()=>U.forEach(N=>N())},[...Object.values(t),S,i.current]),w0(e.onPluginError,s??c.clientId,i),ci.createElement("grammarly-editor-plugin",{...l,ref:y,clientId:s??c.clientId,autodetect:ip(a)?"off":"on",class:o},ip(a)?a({setEditor:k=>{u.current=k,w()},setViewport:k=>{p.current=k,w()}}):a)};/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */var j0={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const E0=e=>e.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase().trim(),Ke=(e,t)=>{const s=g.forwardRef(({color:r="currentColor",size:a=24,strokeWidth:o=2,absoluteStrokeWidth:l,className:c="",children:i,...u},p)=>g.createElement("svg",{ref:p,...j0,width:a,height:a,stroke:r,strokeWidth:l?Number(o)*24/Number(a):o,className:["lucide",`lucide-${E0(e)}`,c].join(" "),...u},[...t.map(([y,S])=>g.createElement(y,S)),...Array.isArray(i)?i:[i]]));return s.displayName=`${e}`,s};/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const qa=Ke("AlertTriangle",[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3Z",key:"c3ski4"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ah=Ke("ArrowRight",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"m12 5 7 7-7 7",key:"xquz4c"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Jl=Ke("Bell",[["path",{d:"M6 8a6 6 0 0 1 12 0c0 7 3 9 3 9H3s3-2 3-9",key:"1qo2s2"}],["path",{d:"M10.3 21a1.94 1.94 0 0 0 3.4 0",key:"qgo35s"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const k0=Ke("Calculator",[["rect",{width:"16",height:"20",x:"4",y:"2",rx:"2",key:"1nb95v"}],["line",{x1:"8",x2:"16",y1:"6",y2:"6",key:"x4nwl0"}],["line",{x1:"16",x2:"16",y1:"14",y2:"18",key:"wjye3r"}],["path",{d:"M16 10h.01",key:"1m94wz"}],["path",{d:"M12 10h.01",key:"1nrarc"}],["path",{d:"M8 10h.01",key:"19clt8"}],["path",{d:"M12 14h.01",key:"1etili"}],["path",{d:"M8 14h.01",key:"6423bh"}],["path",{d:"M12 18h.01",key:"mhygvu"}],["path",{d:"M8 18h.01",key:"lrp35t"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const A0=Ke("Calendar",[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const oh=Ke("Check",[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const I0=Ke("ChevronDown",[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ql=Ke("ChevronLeft",[["path",{d:"m15 18-6-6 6-6",key:"1wnfg3"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ts=Ke("ChevronRight",[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const T0=Ke("ChevronUp",[["path",{d:"m18 15-6-6-6 6",key:"153udz"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const R0=Ke("Clock",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polyline",{points:"12 6 12 12 16 14",key:"68esgv"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const C0=Ke("FilePlus2",[["path",{d:"M4 22h14a2 2 0 0 0 2-2V7l-5-5H6a2 2 0 0 0-2 2v4",key:"1pf5j1"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M3 15h6",key:"4e2qda"}],["path",{d:"M6 12v6",key:"1u72j0"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const D0=Ke("FileSpreadsheet",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M8 13h2",key:"yr2amv"}],["path",{d:"M14 13h2",key:"un5t4a"}],["path",{d:"M8 17h2",key:"2yhykz"}],["path",{d:"M14 17h2",key:"10kma7"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const go=Ke("FileText",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M10 9H8",key:"b1mrlr"}],["path",{d:"M16 13H8",key:"t4e002"}],["path",{d:"M16 17H8",key:"z1uh3a"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const lh=Ke("FolderOpen",[["path",{d:"m6 14 1.5-2.9A2 2 0 0 1 9.24 10H20a2 2 0 0 1 1.94 2.5l-1.54 6a2 2 0 0 1-1.95 1.5H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h3.9a2 2 0 0 1 1.69.9l.81 1.2a2 2 0 0 0 1.67.9H18a2 2 0 0 1 2 2v2",key:"usdka0"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const L0=Ke("Globe",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 2a14.5 14.5 0 0 0 0 20 14.5 14.5 0 0 0 0-20",key:"13o1zl"}],["path",{d:"M2 12h20",key:"9i4pu4"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Cu=Ke("HelpCircle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3",key:"1u773s"}],["path",{d:"M12 17h.01",key:"p32p05"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ih=Ke("History",[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}],["path",{d:"M12 7v5l4 2",key:"1fdv2h"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Du=Ke("Home",[["path",{d:"m3 9 9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z",key:"y5dka4"}],["polyline",{points:"9 22 9 12 15 12 15 22",key:"e2us08"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const _0=Ke("KeyRound",[["path",{d:"M2 18v3c0 .6.4 1 1 1h4v-3h3v-3h2l1.4-1.4a6.5 6.5 0 1 0-4-4Z",key:"167ctg"}],["circle",{cx:"16.5",cy:"7.5",r:".5",fill:"currentColor",key:"w0ekpg"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const aa=Ke("Lightbulb",[["path",{d:"M15 14c.2-1 .7-1.7 1.5-2.5 1-.9 1.5-2.2 1.5-3.5A6 6 0 0 0 6 8c0 1 .2 2.2 1.5 3.5.7.7 1.3 1.5 1.5 2.5",key:"1gvzjb"}],["path",{d:"M9 18h6",key:"x1upvd"}],["path",{d:"M10 22h4",key:"ceow96"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const O0=Ke("ListPlus",[["path",{d:"M11 12H3",key:"51ecnj"}],["path",{d:"M16 6H3",key:"1wxfjs"}],["path",{d:"M16 18H3",key:"12xzn7"}],["path",{d:"M18 9v6",key:"1twb98"}],["path",{d:"M21 12h-6",key:"bt1uis"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Lt=Ke("Loader2",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ch=Ke("LogOut",[["path",{d:"M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4",key:"1uf3rs"}],["polyline",{points:"16 17 21 12 16 7",key:"1gabdz"}],["line",{x1:"21",x2:"9",y1:"12",y2:"12",key:"1uyos4"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Lu=Ke("NotebookPen",[["path",{d:"M13.4 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2v-7.4",key:"re6nr2"}],["path",{d:"M2 6h4",key:"aawbzj"}],["path",{d:"M2 10h4",key:"l0bgd4"}],["path",{d:"M2 14h4",key:"1gsvsf"}],["path",{d:"M2 18h4",key:"1bu2t1"}],["path",{d:"M18.4 2.6a2.17 2.17 0 0 1 3 3L16 11l-4 1 1-4Z",key:"1dba1m"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const M0=Ke("Paperclip",[["path",{d:"m21.44 11.05-9.19 9.19a6 6 0 0 1-8.49-8.49l8.57-8.57A4 4 0 1 1 18 8.84l-8.59 8.57a2 2 0 0 1-2.83-2.83l8.49-8.48",key:"1u3ebp"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const _u=Ke("Plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const dh=Ke("Receipt",[["path",{d:"M4 2v20l2-1 2 1 2-1 2 1 2-1 2 1 2-1 2 1V2l-2 1-2-1-2 1-2-1-2 1-2-1-2 1Z",key:"q3az6g"}],["path",{d:"M16 8h-6a2 2 0 1 0 0 4h4a2 2 0 1 1 0 4H8",key:"1h4pet"}],["path",{d:"M12 17.5v-11",key:"1jc1ny"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const P0=Ke("Search",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["path",{d:"m21 21-4.3-4.3",key:"1qie3q"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Zl=Ke("Send",[["path",{d:"m22 2-7 20-4-9-9-4Z",key:"1q3vgg"}],["path",{d:"M22 2 11 13",key:"nzbqef"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const F0=Ke("ShieldAlert",[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}],["path",{d:"M12 8v4",key:"1got3b"}],["path",{d:"M12 16h.01",key:"1drbdi"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const B0=Ke("Sparkles",[["path",{d:"m12 3-1.912 5.813a2 2 0 0 1-1.275 1.275L3 12l5.813 1.912a2 2 0 0 1 1.275 1.275L12 21l1.912-5.813a2 2 0 0 1 1.275-1.275L21 12l-5.813-1.912a2 2 0 0 1-1.275-1.275L12 3Z",key:"17u4zn"}],["path",{d:"M5 3v4",key:"bklmnn"}],["path",{d:"M19 17v4",key:"iiml17"}],["path",{d:"M3 5h4",key:"nem4j1"}],["path",{d:"M17 19h4",key:"lbex7p"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $0=Ke("Star",[["polygon",{points:"12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2",key:"8f66p6"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const uh=Ke("Table",[["path",{d:"M12 3v18",key:"108xh3"}],["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}],["path",{d:"M3 9h18",key:"1pudct"}],["path",{d:"M3 15h18",key:"5xshup"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $s=Ke("Trash2",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const yo=Ke("Upload",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"17 8 12 3 7 8",key:"t8dd8p"}],["line",{x1:"12",x2:"12",y1:"3",y2:"15",key:"widbto"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const H0=Ke("UserCheck",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["polyline",{points:"16 11 18 13 22 9",key:"1pwet4"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const U0=Ke("User",[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const W0=Ke("Wand2",[["path",{d:"m21.64 3.64-1.28-1.28a1.21 1.21 0 0 0-1.72 0L2.36 18.64a1.21 1.21 0 0 0 0 1.72l1.28 1.28a1.2 1.2 0 0 0 1.72 0L21.64 5.36a1.2 1.2 0 0 0 0-1.72Z",key:"1bcowg"}],["path",{d:"m14 7 3 3",key:"1r5n42"}],["path",{d:"M5 6v4",key:"ilb8ba"}],["path",{d:"M19 14v4",key:"blhpug"}],["path",{d:"M10 2v2",key:"7u0qdc"}],["path",{d:"M7 8H3",key:"zfb6yr"}],["path",{d:"M21 16h-4",key:"1cnmox"}],["path",{d:"M11 3H9",key:"1obp7u"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ot=Ke("X",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]]),mh=["The facts outlined in the statement of claim","Statement of Claim  Factual Summary"],Ws="Factual background  Statement of Claim",ph=["Factual Summary from the Letter of Demand"],Ro="Factual background  Letter of Demand",Ou="The plaintiff's expert opinion",Mu="The claimant's expert opinion",vs=[{id:"u1",username:"lior",password:"lior123",name:"Lior Perry",email:"lior@lp-law.co.il",role:"ADMIN"},{id:"u2",username:"lidor",password:"lidor123",name:"Lidor Kabilo",email:"Lidor@lp-law.co.il",role:"SUB_ADMIN"},{id:"u3",username:"iris",password:"iris123",name:"Iris Alfman",email:"Iris@lp-law.co.il",role:"FINANCE"},{id:"u4",username:"hava",password:"hava123",name:"Hava Kabilo",email:"Hava@lp-law.co.il",role:"LAWYER"},{id:"u5",username:"may",password:"may123",name:"May Harari",email:"May@lp-law.co.il",role:"LAWYER"},{id:"u6",username:"vlada",password:"vlada123",name:"Vlada Boltach",email:"Vlada@lp-law.co.il",role:"LAWYER"},{id:"u7",username:"orly",password:"orly123",name:"Orly Day",email:"Orly@lp-law.co.il",role:"LAWYER"}],cp=["W/R/B Underwriting","QBE Insurance Group","Market Form Underwriting","Dale Underwriting Partners","MedPro & CNA Syndicate","Hardy (Underwriting Agencies) Limited"],Dr=[Ws,Ro,Ou,Mu,"The insured's expert opinion","Insurance Coverage","Risk Assessment","MPL","Strategy","Expenses breakdown","Expenses & Compensation breakdown","Recommendations","Strategy & Recommendations","Request for Approval of a Settlement Agreement"],fh=["New lawsuit","Letter of demand","New third-party notice","Caution Notice"],No="/api/templates",bo=async e=>{if(!e.ok){const s=await e.text().catch(()=>"");throw new Error(s||`Request failed with status ${e.status}`)}const t=await e.json();return Array.isArray(t)?t:[]},dp=async()=>{const e=await fetch(No);return bo(e)},up=async(e,t)=>{const s={"Content-Type":"application/json","x-user-role":t};if(!e.id){const a=await fetch(No,{method:"POST",headers:s,body:JSON.stringify(e)});return bo(a)}const r=await fetch(`${No}/${encodeURIComponent(e.id)}`,{method:"PUT",headers:s,body:JSON.stringify(e)});return bo(r)},z0=async(e,t)=>{const s=await fetch(`${No}/${encodeURIComponent(e)}`,{method:"DELETE",headers:{"x-user-role":t}});return bo(s)},V0=async(e,t,s)=>{const r=await fetch(`${No}/${encodeURIComponent(e)}/reorder`,{method:"POST",headers:{"Content-Type":"application/json","x-user-role":s},body:JSON.stringify({direction:t})});return bo(r)},Rd=async e=>{if(!e||!e.trim())return"";try{const t=await fetch("/api/translate",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({text:e})});if(!t.ok)throw new Error(`Server error: ${t.statusText}`);return(await t.json()).translation||""}catch(t){return console.error("Translation error:",t),"Error translation."}},K0=async(e,t)=>{try{const s=await fetch("/api/extract-policy",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({image:e,mimeType:t})});if(!s.ok)throw new Error("Server error");return await s.json()}catch(s){return console.error(s),{}}},Y0=async(e,t="SAFE_POLISH")=>{try{const s=await fetch("/api/refine-text",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({text:e,mode:t})}),r=await s.json().catch(()=>({}));if(s.status===422&&r&&r.error&&r.error.code==="FACT_PROTECTION_FAILED")return{text:typeof r.refined=="string"?r.refined:e,factProtectionBlocked:!0};if(!s.ok)throw new Error("Refinement failed");return{text:typeof r.refined=="string"&&r.refined.trim()?r.refined:e,factProtectionBlocked:!1}}catch(s){throw console.error("Hebrew refinement error:",s),s}},xh=async e=>{if(!e||!e.trim())return e;try{const t=await fetch("/api/improve-english",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({text:e})});if(!t.ok)throw new Error("English improvement failed");const s=await t.json(),r=typeof s.improved=="string"?s.improved:"";return r.trim()?r:e}catch(t){throw console.error("English improvement error:",t),t}},G0=async e=>{if(!e||!e.trim())return"";try{const t=await fetch("/api/hebrew-report-summary",{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({text:e})}),s=await t.json().catch(()=>({}));if(!t.ok){const a=s&&typeof s.error=="string"&&s.error||"Hebrew report summary failed";throw new Error(a)}return typeof s.summary=="string"&&s.summary.trim()?s.summary.trim():""}catch(t){throw console.error("Hebrew report summary error:",t),t instanceof Error?t:new Error("Hebrew report summary error")}},q0=async(e,t,s="CLAIM",r)=>{const a=await fetch("/api/analyze-medical-complaint",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({fileBase64:e,mimeType:t,analysisType:s,expertCountMode:r==null?void 0:r.expertCountMode,partyRole:r==null?void 0:r.partyRole,sectionKey:r==null?void 0:r.sectionKey,plaintiffName:r==null?void 0:r.plaintiffName,insuredName:r==null?void 0:r.insuredName,insurerName:r==null?void 0:r.insurerName,reportSubject:r==null?void 0:r.reportSubject})}),o=await a.json().catch(()=>({})),l=o.analysis??null,c=typeof o.claimSummary=="string"?o.claimSummary:"";return a.ok?o.success===!1?{analysis:null,claimSummary:"",success:!1,reason:o.reason}:{analysis:l,claimSummary:c,success:!0}:(console.error("Medical complaint analysis failed",a.status,o),{analysis:null,claimSummary:"",success:!1,reason:o.reason||"REQUEST_FAILED"})},X0=async(e,t)=>{const s=await fetch("/api/analyze-dental-opinion",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({fileBase64:e,mimeType:t})}),r=await s.json().catch(()=>({})),a=typeof r.result=="string"?r.result:"",o=typeof r.reason=="string"?r.reason:void 0;return s.ok?r.success===!1?{success:!1,text:"",reason:o||"AI_UNAVAILABLE"}:{success:!0,text:a}:(console.error("Dental opinion analysis failed",s.status,r),{success:!1,text:"",reason:o||"REQUEST_FAILED"})},J0=async(e,t)=>{try{const s=await fetch("/api/extract-expenses",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({fileBase64:e,mimeType:t})});if(!s.ok)throw new Error("Expenses extraction failed");return await s.json()}catch(s){return console.error(s),{items:[]}}},Q0=async e=>{try{const t=await fetch("/api/help-chat",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({question:e})});if(!t.ok)throw new Error("Chat failed");return(await t.json()).answer||"Sorry, I could not answer that."}catch(t){return console.error(t),"System error. Please try again."}},Z0=async e=>{try{const t=await fetch("/api/assistant/help",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)}),s=await t.json().catch(()=>({}));t.ok||console.error("Assistant help HTTP error:",t.status,s);const r=typeof s.title=="string"&&s.title.trim()?s.title.trim():"    ",a=Array.isArray(s.bullets)?s.bullets.filter(c=>typeof c=="string"&&c.trim().length>0):["        -AI.","       (, ,  PDF).","  ,      ."],o=typeof s.warning=="string"&&s.warning.trim()?s.warning.trim():void 0,l=typeof s.nextSuggestion=="string"&&s.nextSuggestion.trim()?s.nextSuggestion.trim():void 0;return{title:r,bullets:a,warning:o,nextSuggestion:l}}catch(t){throw console.error("Assistant help error:",t),t}},mp=async e=>{try{if(!(await fetch("/api/send-email",{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify(e)})).ok)throw new Error("Email failed");return!0}catch(t){return console.error(t),!1}},jc=async e=>{try{const t=await fetch("/api/render-report-pdf",{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({report:e})});if(!t.ok)throw new Error("PDF rendering failed");return await t.blob()}catch(t){throw console.error("PDF render error:",t),t}};async function eN(e,t){try{const s=await fetch("/api/analyze-tone-risk",{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({content:e})});let r=null;try{r=await s.json()}catch{r=null}if(!s.ok){const p=r&&r.error&&typeof r.error.message=="string"?r.error.message:"Tone & Risk analysis failed";throw new Error(p)}const a=!!(r&&r.ok),o=r&&typeof r.runAt=="string"?r.runAt:new Date().toISOString(),l=Array.isArray(r==null?void 0:r.issues)?r.issues:[],c=r&&typeof r.promptVersion=="string"?r.promptVersion:"unknown",i=r&&typeof r.meta=="object"?{sectionsSent:Number(r.meta.sectionsSent)||0,charsBefore:Number(r.meta.charsBefore)||0,charsAfter:Number(r.meta.charsAfter)||0,truncatedSections:Number(r.meta.truncatedSections)||0}:{sectionsSent:0,charsBefore:0,charsAfter:0,truncatedSections:0},u=r&&typeof r.error=="object"?{code:r.error.code,message:r.error.message}:void 0;if(!a){const p=u&&typeof u.message=="string"&&u.message||"Tone & Risk analysis failed",y=new Error(p);throw y.code=(u==null?void 0:u.code)||"LLM_FAILED",y}return{ok:!0,runAt:o,promptVersion:c,issues:l,meta:i,error:void 0}}catch(s){throw console.error("Tone & Risk analysis error:",s),s instanceof Error?s:new Error("Tone & Risk analysis error")}}async function tN(e,t){const s=await fetch("/api/review-hebrew-style",{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({content:e})}),r=await s.json().catch(()=>({})),a=Array.isArray(r.issues)?r.issues:[],o=typeof r.runAt=="string"?r.runAt:new Date().toISOString();return s.ok?r.success===!1?{runAt:o,issues:a,success:!1,reason:r.reason}:{runAt:o,issues:a,success:!0}:(console.error("Hebrew style review failed",s.status,r),{runAt:o,issues:a,success:!1,reason:r.reason||"REQUEST_FAILED"})}const oa="/api/best-practices",la=async e=>{if(!e.ok){const s=await e.text().catch(()=>"");throw new Error(s||`Request failed with status ${e.status}`)}const t=await e.json();return Array.isArray(t)?t:[]},nN=async()=>{const e=await fetch(oa);return la(e)},pp=async(e,t)=>{const s={"Content-Type":"application/json","x-user-role":t};if(!e.id){const a=await fetch(oa,{method:"POST",headers:s,body:JSON.stringify(e)});return la(a)}const r=await fetch(`${oa}/${encodeURIComponent(e.id)}`,{method:"PUT",headers:s,body:JSON.stringify(e)});return la(r)},sN=async(e,t)=>{const s=await fetch(`${oa}/${encodeURIComponent(e)}`,{method:"DELETE",headers:{"x-user-role":t}});return la(s)},rN=async(e,t,s)=>{const r=await fetch(`${oa}/${encodeURIComponent(e)}`,{method:"PUT",headers:{"Content-Type":"application/json","x-user-role":s},body:JSON.stringify({isEnabled:t})});return la(r)},fp=async(e,t,s)=>{const r=await fetch(`${oa}/${encodeURIComponent(e)}/usage`,{method:"POST",headers:{"Content-Type":"application/json","x-user-role":s},body:JSON.stringify({mode:t})});return la(r)},Pu=e=>e===Ou,Fu=e=>e===Mu,xp=e=>Pu(e)||Fu(e),aN=e=>Pu(e)||e===Ws?"PLAINTIFF":Fu(e)||e===Ro?"CLAIMANT":null,hp=(e,t="SINGLE")=>`${t==="MULTIPLE"?"Expert opinions":"Expert opinion"}  ${e==="PLAINTIFF"?"Statement of Claim":"Letter of Demand"}`,Cd=(e,t)=>Pu(e)?hp("PLAINTIFF",t):Fu(e)?hp("CLAIMANT",t):e,oN=({data:e})=>{const[t,s]=g.useState(""),[r,a]=g.useState(!1),[o,l]=g.useState(null);if(g.useEffect(()=>{let i=!1;return(async()=>{a(!0),l(null);try{const p=await fetch("/api/render-report-html",{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({report:e})});if(!p.ok)throw new Error("Failed to load report HTML");const y=await p.text();i||s(y)}catch(p){console.error(p),i||l("   ")}finally{i||a(!1)}})(),()=>{i=!0}},[e]),o)return n.jsx("div",{className:"w-[210mm] min-h-[297mm] bg-panel border border-borderDark shadow-2xl mx-auto flex items-center justify-center text-sm text-red-300",children:o});if(r&&!t)return n.jsx("div",{className:"w-[210mm] min-h-[297mm] bg-panel shadow-2xl mx-auto flex flex-col items-center justify-center text-sm text-textMuted",children:n.jsx("span",{children:"  ..."})});const c=!!e.policyFile&&(e.attachPolicyAsAppendix??!0);return n.jsxs("div",{className:"space-y-2",children:[n.jsx("iframe",{title:"Report Preview",className:"w-[210mm] min-h-[297mm] bg-panel shadow-2xl mx-auto border-none print:shadow-none print:w-full",srcDoc:t}),c&&n.jsx("p",{className:"w-[210mm] mx-auto text-[11px] text-textMuted text-right",children:"The policy file will be attached as Appendix A in the final PDF (not shown in this preview)."})]})},lN=e=>{switch(e){case"HEBREW_SUBMITTED":return" ";case"HEBREW_CHANGES_REQUESTED":return" ";case"HEBREW_APPROVED":return" ";case"HEBREW_REOPENED_EXTERNAL":return"  ()";case"HEBREW_DRAFT":default:return" "}},iN=e=>{switch(e){case"SUBMITTED":return"  ";case"CHANGES_REQUESTED":return"  ";case"APPROVED":return"  ";case"DRAFT":default:return"  (  )"}},kl="report-review-panel",Dd="external-feedback-panel",cN=({report:e,currentUser:t,onSubmitToAdmin:s,onApproveHebrew:r,onRequestChanges:a,onMarkIssueDone:o,onAddExternalFeedbackIssues:l,onReopenHebrewDueToExternalFeedback:c})=>{const[i,u]=g.useState(!1),[p,y]=g.useState(""),[S,w]=g.useState(""),[L,k]=g.useState("NORMAL"),[U,N]=g.useState(""),[x,b]=g.useState("INTERNAL"),[F,H]=g.useState("ENGLISH_ONLY"),V=g.useMemo(()=>{const Y=e.reportReview;return Y||{status:"DRAFT",issues:[]}},[e.reportReview]),q=g.useMemo(()=>{const Y={};return V.issues.filter(O=>(O.origin??"INTERNAL")==="INTERNAL").forEach(O=>{const P=O.sectionKey||"GENERAL";Y[P]||(Y[P]=[]),Y[P]=[...Y[P],O]}),Y},[V.issues]),te=g.useMemo(()=>{const Y={};return V.issues.filter(O=>O.origin==="EXTERNAL").forEach(O=>{const P=O.sectionKey||"GENERAL";Y[P]||(Y[P]=[]),Y[P]=[...Y[P],O]}),Y},[V.issues]),G=(t==null?void 0:t.role)==="LAWYER",le=(t==null?void 0:t.role)==="ADMIN",j=V.issues.some(Y=>(Y.origin??"INTERNAL")==="EXTERNAL"&&Y.status!=="DONE"&&Y.externalAction==="REQUIRES_HEBREW"),T=Y=>{b(Y),y(""),w(""),k("NORMAL"),N(""),H("ENGLISH_ONLY"),u(!0)},E=()=>{const Y=p.trim(),O=S.trim();if(!Y||!O)return;const P={title:Y,instruction:O,severity:L,type:"OTHER",sectionKey:void 0,externalAction:x==="EXTERNAL"?F:void 0};x==="EXTERNAL"&&l?l([P],U.trim()||void 0):a([P]),u(!1)},C=iN(V.status),se=lN(e.hebrewWorkflowStatus);return n.jsxs("section",{id:kl,className:"mt-4 rounded-xl border border-borderDark bg-navySecondary px-4 py-3",dir:"rtl",lang:"he",children:[n.jsxs("div",{className:"mb-2 flex items-center justify-between gap-3",children:[n.jsxs("div",{children:[n.jsx("div",{className:"text-xs font-semibold text-textMuted500",children:" "}),n.jsx("div",{className:"text-sm font-medium text-textLight",children:C})]}),n.jsx("span",{className:"inline-flex items-center rounded-full bg-navySecondary px-3 py-1 text-xs font-medium text-textMuted700",children:se})]}),G&&n.jsx("div",{className:"mb-3 text-xs text-amber-700",children:e.hebrewWorkflowStatus==="HEBREW_REOPENED_EXTERNAL"?"            .":V.status==="SUBMITTED"?"   .       .":V.status==="CHANGES_REQUESTED"?"   .      .":null}),le&&j&&n.jsx("div",{className:"mb-3 text-xs font-semibold text-red-700",children:"      .    ."}),V.issues.length>0&&n.jsxs("div",{className:"mb-3 space-y-3",children:[Object.keys(q).length>0&&n.jsxs("div",{children:[n.jsx("div",{className:"mb-1 text-xs font-semibold text-textMuted",children:"  ()"}),Object.entries(q).map(([Y,O])=>n.jsxs("div",{className:"rounded-lg bg-panel p-2 mb-1",children:[Y!=="GENERAL"&&n.jsxs("div",{className:"mb-1 text-[11px] font-semibold text-textMuted500",children:[": ",Y]}),n.jsx("ul",{className:"space-y-1",children:O.map(P=>n.jsxs("li",{className:"flex items-start justify-between gap-2 rounded-md border border-borderDark bg-navySecondary px-2 py-1.5",children:[n.jsxs("div",{children:[n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsx("span",{className:`inline-flex items-center rounded-full px-2 py-0.5 text-[10px] font-semibold ${P.severity==="CRITICAL"?"bg-red-100 text-red-700":P.severity==="NORMAL"?"bg-amber-50 text-amber-700":"bg-navySecondary text-textMuted"}`,children:P.severity==="CRITICAL"?"":P.severity==="NORMAL"?"":""}),n.jsx("span",{className:"text-xs font-medium text-textLight",children:P.title})]}),n.jsx("div",{className:"mt-1 text-[11px] text-textMuted700",children:P.instruction})]}),(G||le)&&n.jsx("button",{type:"button",className:"mt-1 inline-flex items-center rounded-full border border-emerald-200 bg-emerald-50 px-2 py-0.5 text-[10px] font-medium text-emerald-700 hover:bg-emerald-100 disabled:opacity-50",disabled:P.status==="DONE",onClick:()=>o(P.id),children:P.status==="DONE"?"":" "})]},P.id))})]},Y))]}),Object.keys(te).length>0&&n.jsxs("div",{id:Dd,children:[n.jsx("div",{className:"mb-1 text-xs font-semibold text-textMuted",children:"  "}),Object.entries(te).map(([Y,O])=>n.jsxs("div",{className:"rounded-lg bg-panel p-2 mb-1",children:[Y!=="GENERAL"&&n.jsxs("div",{className:"mb-1 text-[11px] font-semibold text-textMuted500",children:[": ",Y]}),n.jsx("ul",{className:"space-y-1",children:O.map(P=>n.jsxs("li",{className:"flex items-start justify-between gap-2 rounded-md border border-borderDark bg-navySecondary px-2 py-1.5",children:[n.jsxs("div",{children:[n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsx("span",{className:`inline-flex items-center rounded-full px-2 py-0.5 text-[10px] font-semibold ${P.severity==="CRITICAL"?"bg-red-100 text-red-700":P.severity==="NORMAL"?"bg-amber-50 text-amber-700":"bg-navySecondary text-textMuted"}`,children:P.severity==="CRITICAL"?"":P.severity==="NORMAL"?"":""}),n.jsx("span",{className:"text-xs font-medium text-textLight",children:P.title})]}),n.jsx("div",{className:"mt-1 text-[11px] text-textMuted700",children:P.instruction})]}),(G||le)&&n.jsx("button",{type:"button",className:"mt-1 inline-flex items-center rounded-full border border-emerald-200 bg-emerald-50 px-2 py-0.5 text-[10px] font-medium text-emerald-700 hover:bg-emerald-100 disabled:opacity-50",disabled:P.status==="DONE",onClick:()=>o(P.id),children:P.status==="DONE"?"":" "})]},P.id))})]},Y))]})]}),n.jsxs("div",{className:"mt-3 flex flex-wrap items-center gap-2",children:[G&&n.jsx("button",{type:"button",className:"rounded-md bg-sky-700 px-3 py-1.5 text-xs font-semibold text-white hover:bg-sky-800 disabled:opacity-50",onClick:s,disabled:V.status==="SUBMITTED"||V.status==="APPROVED",children:"  "}),le&&n.jsxs(n.Fragment,{children:[n.jsx("button",{type:"button",className:"rounded-md bg-emerald-700 px-3 py-1.5 text-xs font-semibold text-white hover:bg-emerald-800 disabled:opacity-50",onClick:r,children:"  "}),n.jsx("button",{type:"button",className:"rounded-md bg-amber-700 px-3 py-1.5 text-xs font-semibold text-white hover:bg-amber-800",onClick:()=>T("INTERNAL"),children:" "}),l&&n.jsx("button",{type:"button",className:"rounded-md bg-slate-700 px-3 py-1.5 text-xs font-semibold text-white hover:bg-slate-800",onClick:()=>T("EXTERNAL"),children:"   "}),c&&e.status==="SENT"&&n.jsx("button",{type:"button",className:"rounded-md bg-red-700 px-3 py-1.5 text-xs font-semibold text-white hover:bg-red-800",onClick:c,children:"   ( )"}),c&&e.status!=="SENT"&&n.jsx("span",{className:"text-[11px] text-textMuted500",children:"       (SENT)."})]})]}),i&&n.jsx("div",{className:"fixed inset-0 z-[180] flex items-center justify-center bg-black/40",children:n.jsxs("div",{className:"w-full max-w-md rounded-xl bg-panel p-4 shadow-2xl",dir:"rtl",lang:"he",children:[n.jsx("h3",{className:"mb-3 text-sm font-bold text-textLight",children:"   "}),n.jsxs("div",{className:"mb-3 space-y-2",children:[n.jsxs("div",{children:[n.jsx("label",{className:"mb-1 block text-xs font-semibold text-textMuted700",children:"  ()"}),n.jsx("input",{type:"text",className:"w-full rounded-md border border-borderDark px-2 py-1.5 text-sm",value:p,onChange:Y=>y(Y.target.value)})]}),n.jsxs("div",{children:[n.jsx("label",{className:"mb-1 block text-xs font-semibold text-textMuted700",children:"  ()"}),n.jsx("textarea",{className:"w-full rounded-md border border-borderDark px-2 py-1.5 text-sm",rows:3,value:S,onChange:Y=>w(Y.target.value)})]}),n.jsxs("div",{children:[n.jsx("label",{className:"mb-1 block text-xs font-semibold text-textMuted700",children:" "}),n.jsxs("select",{className:"w-full rounded-md border border-borderDark px-2 py-1.5 text-xs",value:L,onChange:Y=>k(Y.target.value),children:[n.jsx("option",{value:"NORMAL",children:""}),n.jsx("option",{value:"CRITICAL",children:""}),n.jsx("option",{value:"STYLE",children:""})]})]}),x==="EXTERNAL"&&n.jsxs("div",{children:[n.jsx("label",{className:"mb-1 block text-xs font-semibold text-textMuted700",children:"    ()"}),n.jsx("input",{type:"text",className:"w-full rounded-md border border-borderDark px-2 py-1.5 text-sm",value:U,onChange:Y=>N(Y.target.value)}),n.jsx("label",{className:"mb-1 mt-3 block text-xs font-semibold text-textMuted700",children:" "}),n.jsxs("select",{className:"w-full rounded-md border border-borderDark px-2 py-1.5 text-xs",value:F,onChange:Y=>H(Y.target.value),children:[n.jsx("option",{value:"ENGLISH_ONLY",children:"  "}),n.jsx("option",{value:"REQUIRES_HEBREW",children:"  "})]})]})]}),n.jsxs("div",{className:"mt-4 flex justify-end gap-2",children:[n.jsx("button",{type:"button",className:"rounded-md border border-borderDark px-3 py-1.5 text-xs font-medium text-textMuted700 hover:bg-navySecondary",onClick:()=>u(!1),children:""}),n.jsx("button",{type:"button",className:"rounded-md bg-amber-700 px-3 py-1.5 text-xs font-semibold text-white hover:bg-amber-800 disabled:opacity-50",onClick:E,disabled:!p.trim()||!S.trim(),children:" "})]})]})})]})},vo="REPLACE_WITH_GRAMMARLY_CLIENT_ID",Bu={[Ws]:"Statement of Claim",[Ro]:"Letter of Demand",[Ou]:"Statement of Claim Expert Opinion",[Mu]:"Letter of Demand Expert Opinion","The plaintiff's expert opinion":"Plaintiff Expert Opinion","The claimant's expert opinion":"Claimant Expert Opinion","The insured's expert opinion":"Insured Expert Opinion","Insurance Coverage":"Insurance Coverage","Risk Assessment":"Risk Assessment",MPL:"MPL",Strategy:"Strategy","Expenses breakdown":"Expenses Breakdown","Expenses & Compensation breakdown":"Expenses & Compensation",Recommendations:"Recommendations","Strategy & Recommendations":"Strategy & Recommendations","Request for Approval of a Settlement Agreement":"Settlement Approval",Update:"Update"};mh.forEach(e=>{Bu[e]="Statement of Claim"});ph.forEach(e=>{Bu[e]="Letter of Demand"});const dN=e=>(Bu[e]||e||"").trim(),hh=e=>e.map(dN).filter(Boolean),Ld=e=>{const t=new Set;return e.map(s=>s.trim()).filter(s=>{if(!s)return!1;const r=s.toLowerCase();return t.has(r)?!1:(t.add(r),!0)})},$u=/[\\/:*?"<>|]/g,Ec=e=>(e||"").trim(),uN=e=>{const t=(e.filenameTag||"").toLowerCase(),s=(e.plaintiffTitle||"").toLowerCase();return t.includes("demand")||s==="claimant"},mN=e=>{var t;return(((t=e.reportHistory)==null?void 0:t.length)||0)+1},pN=120,fN=e=>{if(!e.length)return"";if(e.length===1)return e[0];if(e.length===2)return`${e[0]} & ${e[1]}`;const t=e.slice(0,-1),s=e[e.length-1];return`${t.join(", ")} & ${s}`},ir=e=>{const t=Ec(e.insurerName),s=Ec(e.insuredName),r=Ec(e.plaintiffName),a=mN(e);let o=[];const l=Array.isArray(e.fileNameTitles)?Zt(e.fileNameTitles.map(L=>zt(L))):[];l.length>0?o=Ld(l):a===1?o=[uN(e)?"New Letter of demand":"New Lawsuit"]:(o=Ld(hh(e.selectedSections||[])),o.length||(o=["Update"]));const c=fN(o),i=`Report ${a}`;let p=[t||void 0,s||void 0,r||void 0,c||void 0].filter(Boolean).join(" - ");if(p=p.replace($u," ").replace(/\s+/g," ").replace(/-+/g,"-").trim(),!p){const L=i;return L.toLowerCase().endsWith(".pdf")?L:`${L}.pdf`}const y=` - ${i}`,S=Math.max(0,pN-y.length);if(p.length>S){const L=p.slice(0,S),k=L.lastIndexOf(" ");p=(k>0?L.slice(0,k):L).trim()}let w=`${p}${y}`;return w=w.replace(/\s+/g," ").replace(/-+/g,"-").trim(),w||(w=`Report-${Date.now()}`),w.toLowerCase().endsWith(".pdf")?w:`${w}.pdf`},ei=e=>ir(e).replace(/\.pdf$/i,""),gh=e=>`fileNameTopics:${e||"default"}`,xN=["Update","Expenses","New Lawsuit","New Third Party Notice","New Letter of Demand","Risk Assessment","Strategy","Recommendation","Request for Settlement Approval","Judgment","Request to Reopen a Claim","Dismissal for Inaction"],zt=e=>{const t=(e||"").trim();return t?t.replace($u," ").replace(/\s+/g," ").trim():""},ti=e=>zt(e).trim().toLowerCase(),Zt=e=>{const t=new Set,s=[];for(const r of e){const a=zt(r),o=ti(a);o&&(t.has(o)||(t.add(o),s.push(a)))}return s},hN=e=>{if(typeof window>"u")return[];try{const t=window.localStorage.getItem(gh(e));if(!t)return[];const s=JSON.parse(t);return Array.isArray(s)?Zt(s.map(r=>typeof r=="string"?r:"").map(zt)):[]}catch{return[]}},gN=(e,t)=>{if(!(typeof window>"u"))try{const s=Zt(t.map(zt)).filter(Boolean);window.localStorage.setItem(gh(e),JSON.stringify(s))}catch{}},yN=(e,t,s=15)=>{const r=zt(t),a=ti(r);if(!a)return Zt(e).slice(0,s);const o=(e||[]).filter(c=>ti(c)!==a),l=[r,...o];return Zt(l).slice(0,s)},yh=e=>`topicCombos:${e||"default"}`,Nh=e=>`insurerDefaultTopics:${e||"default"}`,bh=e=>{if(!e)return null;try{return JSON.parse(e)}catch{return null}},_d=e=>{if(typeof window>"u")return[];const t=window.localStorage.getItem(yh(e)),s=bh(t);return Array.isArray(s)?s.filter(a=>Array.isArray(a)).map(a=>a.map(o=>zt(o)).filter(Boolean)).filter(a=>a.length>0):[]},gp=(e,t)=>{if(typeof window>"u")return;const s=t.map(r=>Zt(r.map(a=>zt(a))).filter(Boolean)).filter(r=>r.length>0);try{window.localStorage.setItem(yh(e),JSON.stringify(s))}catch{}},yp=e=>e.map(s=>ti(s)).filter(Boolean).sort().join("|"),Np=(e,t,s=6)=>{const r=Zt(t.map(c=>zt(c))).filter(Boolean);if(!r.length)return e;const a=yp(r),o=[],l=new Set;o.push(r),l.add(a);for(const c of e){const i=yp(c);if(!l.has(i)&&(o.push(Zt(c.map(u=>zt(u))).filter(Boolean)),l.add(i),o.length>=s))break}return o.slice(0,s)},Hu=e=>(e||"").trim().toLowerCase(),Uu=e=>{if(typeof window>"u")return{};const t=window.localStorage.getItem(Nh(e)),s=bh(t);if(!s||typeof s!="object")return{};const r={};for(const[a,o]of Object.entries(s)){if(!Array.isArray(o))continue;const l=Zt(o.map(c=>zt(c))).filter(Boolean).slice(0,8);l.length&&(r[a]=l)}return r},vh=(e,t)=>{if(typeof window>"u")return;const s={};for(const[r,a]of Object.entries(t)){const o=Zt((a||[]).map(l=>zt(l))).filter(Boolean).slice(0,8);o.length&&(s[r]=o)}try{window.localStorage.setItem(Nh(e),JSON.stringify(s))}catch{}},NN=(e,t)=>{const s=Uu(e),r=Hu(t);return s[r]||[]},bN=(e,t,s)=>{if(!t)return;const r=Hu(t),a=Uu(e),o=Zt(s.map(l=>zt(l))).filter(Boolean).slice(0,8);o.length?a[r]=o:delete a[r],vh(e,a)},vN=(e,t)=>{if(!t)return;const s=Hu(t),r=Uu(e);r[s]&&(delete r[s],vh(e,r))},bp=[{id:"general_update",label:"General Update",body:`Dear Sir/Madam,

Please find below our general update regarding the above-captioned matter.

Best regards,
Lior Perry, Adv.`},{id:"risk_assessment",label:"Risk Assessment",body:`Dear Sir/Madam,

Kindly review the following risk assessment prepared for the insurer.

Best regards,
Lior Perry, Adv.`},{id:"expert_opinion",label:"Expert Opinion",body:`Dear Sir/Madam,

Please find our expert opinion summary for your review and records.

Best regards,
Lior Perry, Adv.`},{id:"full_report",label:"Full Report Delivery",body:`Dear Sir/Madam,

Attached is the full report for the current update, including all relevant sections.

Best regards,
Lior Perry, Adv.`},{id:"zeev_new_demand",label:"Zeev  New demand letter",body:`Dear Zeev,

I've attached a report regarding a new demand letter.

Sincerely,
Lior`},{id:"zeev_claim_update",label:"Zeev  Claim update",body:`Dear Zeev,

I've attached a report on the claim in question.

Sincerely,
Lior`},{id:"zeev_new_lawsuit",label:"Zeev  New lawsuit",body:`Dear Zeev,

I've attached a report regarding a new lawsuit.

Sincerely,
Lior`},{id:"zeev_lawsuit_update",label:"Zeev  Lawsuit update",body:`Dear Zeev,

I've attached a report on the lawsuit in question.

Sincerely,
Lior`}],vp=e=>`emailTemplates:${e||"default"}`,SN=({isOpen:e,report:t,userId:s,isSending:r=!1,recipientsPreview:a,defaultSubject:o,subjectDraft:l,onSubjectDraftChange:c,selectedTopics:i,onSelectedTopicsChange:u,isResendMode:p,onClose:y,onSend:S})=>{const w=bp[0],[L,k]=g.useState(w.id),[U,N]=g.useState(w.body),[x,b]=g.useState([]),[F,H]=g.useState([]),[V,q]=g.useState(l),[te,G]=g.useState(""),[le,j]=g.useState(""),[T,E]=g.useState([]),[C,se]=g.useState([]),Y=re=>{if(typeof window>"u")return[];try{const D=localStorage.getItem(vp(re));if(!D)return[];const ae=JSON.parse(D);return Array.isArray(ae)?ae.filter(ee=>typeof(ee==null?void 0:ee.id)=="string"&&typeof(ee==null?void 0:ee.label)=="string"&&typeof(ee==null?void 0:ee.body)=="string"):[]}catch{return[]}},O=re=>{typeof window>"u"||localStorage.setItem(vp(s),JSON.stringify(re))},P=g.useMemo(()=>[...bp,...x],[x]),X=g.useMemo(()=>P.reduce((re,D)=>(re[D.id]=D,re),{}),[P]);g.useEffect(()=>{if(!e)return;const re=Y(s);b(re);const D=hN(s);H(D),E(_d(s)),se(NN(s,t.insurerName)),q(l),j(""),G("")},[e,s,l,t.insurerName]),g.useEffect(()=>{if(!e)return;const re=t.selectedEmailTemplate&&X[t.selectedEmailTemplate]?t.selectedEmailTemplate:w.id;k(re),N(t.emailBodyDraft||X[re].body)},[e,w.id,t.emailBodyDraft,t.selectedEmailTemplate,X]);const ue=re=>{k(re);const D=X[re];D&&N(D.body)},xe=()=>{const re=window.prompt("  ?");if(!re)return;const D=re.trim();if(!D)return;const ae={id:`custom_${Date.now()}`,label:D,body:U},ee=[...x,ae];b(ee),O(ee),k(ae.id)},oe=g.useMemo(()=>Zt([...F,...xN]),[F]),fe=g.useMemo(()=>{const re=le.trim().toLowerCase();return re?oe.filter(D=>D.toLowerCase().includes(re)):oe},[oe,le]),ve=g.useMemo(()=>{if(!p)return null;const re=typeof t.reportNumber=="number"&&t.reportNumber>0?`#${t.reportNumber}`:"",D=t.sentAt?new Date(t.sentAt).toLocaleDateString("en-GB",{day:"2-digit",month:"short",year:"numeric"}):"";return n.jsxs("div",{className:"mb-3 flex items-start gap-2 rounded-md border border-amber-300 bg-amber-50 px-3 py-2 text-[11px] text-amber-900",children:[n.jsx(qa,{className:"w-3 h-3 mt-[2px]"}),n.jsxs("div",{children:[n.jsxs("p",{className:"font-semibold",children:["    ",re||"",D?`   ${D}`:"","."]}),n.jsx("p",{className:"mt-1",children:"   (resend)   ,    .       ."})]})]})},[p,t.reportNumber,t.sentAt]),_e=re=>{const D=zt(re);if(!D)return;const ae=D.toLowerCase(),ee=i.some(be=>be.trim().toLowerCase()===ae)?i.filter(be=>be.trim().toLowerCase()!==ae):[...i,D];u(Zt(ee))},ze=()=>{const re=zt(te);if(!re)return;const D=yN(F,re,15);H(D),gN(s,D);const ae=Zt([...i,re]);u(ae),G("")},qe=g.useMemo(()=>ir({...t,fileNameTitles:i}),[t,i]),st=!a.cc.some(re=>re.toLowerCase()!=="reports@lp-law.co.il"),Je=a.to[0]||"",J=a.to.length===1&&Je.toLowerCase()==="lidor@lp-law.co.il";return e?n.jsx("div",{className:"fixed inset-0 bg-black/50 z-[999] flex items-center justify-center p-4",children:n.jsxs("div",{className:"bg-panel rounded-2xl shadow-2xl w-full max-w-3xl max-h-[90vh] overflow-hidden flex flex-col",children:[n.jsxs("div",{className:"flex items-center justify-between border-b px-6 py-4",children:[n.jsxs("div",{className:"flex items-center gap-3",children:[n.jsx("h2",{className:"text-lg font-semibold text-gray-800",children:"Compose Email"}),J&&n.jsx("span",{className:"inline-flex items-center rounded-full bg-blue-50 px-2.5 py-0.5 text-[11px] font-semibold text-blue-800 border border-blue-200",children:"SANDBOX"})]}),n.jsx("button",{onClick:y,className:"text-gray-500 hover:text-gray-700",children:n.jsx(Ot,{className:"w-5 h-5"})})]}),n.jsxs("div",{className:"flex-1 overflow-y-auto px-6 py-4 space-y-4",children:[ve,st&&n.jsxs("div",{className:"flex items-start gap-2 text-xs text-amber-800 bg-amber-50 border border-amber-200 rounded-md px-3 py-2",children:[n.jsx(qa,{className:"w-3.5 h-3.5 mt-[1px]"}),n.jsx("p",{children:"         .       (To)   CC."})]}),J&&n.jsxs("div",{className:"flex items-start gap-2 text-xs text-blue-800 bg-blue-50 border border-blue-200 rounded-md px-3 py-2",children:[n.jsx(qa,{className:"w-3.5 h-3.5 mt-[1px]"}),n.jsx("p",{children:" :         ,    ."})]}),n.jsxs("div",{className:"text-xs text-gray-600 space-y-1 border rounded-md border-gray-200 bg-gray-50 px-3 py-2",children:[n.jsxs("div",{className:"flex items-center justify-between",children:[n.jsx("span",{className:"font-semibold",children:"To:"})," ",n.jsx("span",{children:a.to.join("; ")||""})]}),a.cc.length>0&&n.jsxs("div",{className:"flex items-center justify-between",children:[n.jsx("span",{className:"font-semibold",children:"CC:"})," ",n.jsx("span",{children:a.cc.join("; ")})]}),n.jsxs("p",{className:"text-[11px] text-gray-500 mt-1",children:["To: ",Je||""," (primary), CC: Office + report owner ( )."]}),n.jsxs("div",{children:[n.jsx("span",{className:"font-semibold",children:"Subject:"})," ",V||"(will be generated from case data)"]}),n.jsxs("div",{children:[n.jsx("span",{className:"font-semibold",children:"Attachment:"})," ",qe]}),n.jsx("p",{className:"text-[11px] text-amber-700 mt-1",children:" :       ,        -PDF ."})]}),n.jsxs("div",{children:[n.jsxs("div",{className:"flex items-center justify-between mb-1",children:[n.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Subject"}),n.jsx("button",{type:"button",onClick:()=>{q(o),c(void 0)},className:"text-[11px] text-blue-700 hover:underline disabled:opacity-50",disabled:r,children:"Reset"})]}),n.jsx("input",{type:"text",value:V,onChange:re=>{const D=re.target.value;q(D),c(D)},className:"w-full border rounded-md p-2 text-sm",disabled:r})]}),n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Template"}),n.jsxs("div",{className:"flex gap-3",children:[n.jsx("select",{value:L,onChange:re=>ue(re.target.value),className:"flex-1 border rounded-md p-2",children:P.map(re=>n.jsx("option",{value:re.id,children:re.label},re.id))}),n.jsx("button",{type:"button",onClick:xe,className:"px-3 py-2 bg-panel border rounded-md text-sm font-medium text-gray-700 hover:bg-gray-100",disabled:r,children:"Save Template"})]})]}),n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"PDF Filename Topics"}),T.length>0&&n.jsxs("div",{className:"mb-2",children:[n.jsx("p",{className:"text-[11px] font-semibold text-gray-700 mb-1",children:"Recent combinations"}),n.jsx("div",{className:"flex flex-wrap gap-2",children:T.map((re,D)=>n.jsx("button",{type:"button",onClick:()=>u(re),className:"inline-flex items-center gap-1 rounded-full bg-gray-100 px-3 py-1 text-[11px] text-gray-800 border border-gray-300 hover:bg-gray-200",children:re.join(" + ")},D))})]}),n.jsx("div",{className:"flex flex-wrap gap-2 mb-2",children:i.length===0?n.jsx("span",{className:"text-xs text-gray-400",children:"No topics selected yet. You can choose from the list below or add your own."}):i.map(re=>n.jsxs("button",{type:"button",onClick:()=>_e(re),className:"inline-flex items-center gap-1 rounded-full bg-blue-50 px-3 py-1 text-xs text-blue-800 border border-blue-200 hover:bg-blue-100",children:[n.jsx("span",{children:re}),n.jsx("span",{className:"text-[10px]",children:""})]},re))}),n.jsx("button",{type:"button",onClick:()=>{u([]),j("")},className:"mb-2 text-[11px] text-blue-700 hover:underline",disabled:r,children:"  "}),n.jsx("div",{className:"flex items-center gap-2 mb-2",children:n.jsx("input",{type:"text",value:le,onChange:re=>j(re.target.value),placeholder:"  ...",className:"flex-1 border rounded-md p-1.5 text-[11px]",disabled:r})}),n.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-1 mb-2 max-h-32 overflow-y-auto border rounded-md p-2 bg-panel",children:fe.map(re=>{const D=`topic-${re}`,ae=re.toLowerCase(),ee=i.some(be=>be.trim().toLowerCase()===ae);return n.jsxs("label",{htmlFor:D,className:"flex items-center gap-1 text-xs text-gray-700 cursor-pointer",children:[n.jsx("input",{id:D,type:"checkbox",className:"h-3 w-3",checked:ee,onChange:()=>_e(re),disabled:r}),n.jsx("span",{className:"whitespace-normal break-words",children:re})]},re)})}),n.jsxs("div",{className:"flex gap-2 mt-1",children:[n.jsx("input",{type:"text",value:te,onChange:re=>G(re.target.value),placeholder:"Add custom topic",className:"flex-1 border rounded-md p-2 text-xs",disabled:r}),n.jsx("button",{type:"button",onClick:ze,className:"px-3 py-1.5 bg-panel border rounded-md text-xs font-medium text-gray-700 hover:bg-gray-100 disabled:opacity-50",disabled:r,children:"Add"})]}),n.jsxs("div",{className:"mt-3 space-y-1 text-[11px] text-gray-700",children:[n.jsxs("div",{className:"flex gap-2 flex-wrap items-center",children:[n.jsx("button",{type:"button",onClick:()=>{const re=Zt(i.map(D=>zt(D)));re.length&&(bN(s,t.insurerName,re),se(re))},className:"px-2 py-1 rounded-full border border-gray-300 bg-panel hover:bg-gray-100",disabled:r||i.length===0,children:"     "}),C.length>0&&n.jsxs(n.Fragment,{children:[n.jsx("button",{type:"button",onClick:()=>u(C),className:"px-2 py-1 rounded-full border border-blue-300 bg-blue-50 text-blue-800 hover:bg-blue-100 disabled:opacity-50",disabled:r,children:"     "}),n.jsx("button",{type:"button",onClick:()=>{vN(s,t.insurerName),se([])},className:"text-[11px] text-red-600 hover:underline",disabled:r,children:"    "})]})]}),C.length>0&&i.length===0&&n.jsx("p",{className:"text-[11px] text-gray-500",children:"     .       ."})]})]}),n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Email Body"}),n.jsx(ho,{clientId:vo,children:n.jsx("textarea",{value:U,onChange:re=>N(re.target.value),rows:12,dir:"ltr",className:"w-full border rounded-md p-3 text-sm",style:{direction:"ltr",textAlign:"left",unicodeBidi:"plaintext"}})})]}),n.jsxs("div",{className:"border-t pt-4 text-right",children:[n.jsx("p",{className:"text-sm font-semibold text-gray-600 mb-2",children:"Signature"}),n.jsxs("div",{className:"inline-flex flex-col items-end",children:[n.jsx("img",{src:"/assets/branding/signature.png",alt:"Signature placeholder",className:"h-16 object-contain mb-2 opacity-80",onError:re=>{re.currentTarget.style.display="none"}}),n.jsx("span",{className:"text-sm text-gray-700 font-semibold",children:"Adv. Lior Perry"})]})]})]}),n.jsxs("div",{className:"flex justify-end gap-3 border-t px-6 py-4 bg-gray-50",children:[n.jsx("button",{onClick:y,className:"px-4 py-2 rounded-md text-gray-600 hover:bg-gray-200",disabled:r,children:"Cancel"}),n.jsx("button",{onClick:()=>S({body:U,templateId:L,subjectBase:V.trim(),topics:Zt(i.map(re=>zt(re)))}),className:"px-5 py-2 rounded-md bg-lpBlue text-white font-semibold hover:bg-blue-900 disabled:opacity-60 disabled:cursor-not-allowed",disabled:r,children:r?"Sending":"Send Email"})]})]})}):null},wN=({isOpen:e,availableTitles:t,selectedTitles:s,onClose:r,onSave:a})=>{const o=g.useMemo(()=>S=>{const w=new Set,L=[];return S.forEach(k=>{const U=t.find(N=>N.label===k&&!w.has(N.id));U&&(L.push(U.id),w.add(U.id))}),L},[t]),l=g.useCallback(()=>{const S=o(s);return S.length?S:t.map(w=>w.id)},[o,s,t]),[c,i]=g.useState(l);if(g.useEffect(()=>{e&&i(l())},[e,l]),!e)return null;const u=S=>{i(w=>w.includes(S)?w.filter(L=>L!==S):[...w,S])},p=()=>{i(t.map(S=>S.id))},y=()=>{const S=c.map(w=>{var L;return(L=t.find(k=>k.id===w))==null?void 0:L.label}).filter(Boolean);a(S)};return n.jsx("div",{className:"fixed inset-0 bg-black/40 z-[900] flex items-center justify-center p-4",children:n.jsxs("div",{className:"bg-panel rounded-2xl shadow-2xl w-full max-w-md max-h-[90vh] overflow-hidden flex flex-col",children:[n.jsxs("div",{className:"flex items-center justify-between px-5 py-3 border-b bg-navySecondary50",children:[n.jsx("h3",{className:"text-lg font-semibold text-gray-800",children:"Select File Name Titles"}),n.jsx("button",{onClick:r,className:"text-gray-500 hover:text-gray-800",children:n.jsx(Ot,{className:"w-5 h-5"})})]}),n.jsxs("div",{className:"flex-1 overflow-y-auto p-5 space-y-3",children:[t.length===0&&n.jsx("p",{className:"text-sm text-gray-500",children:"No sections available to include."}),t.map(S=>n.jsxs("label",{className:"flex items-center gap-3 border rounded-lg px-3 py-2 text-sm",children:[n.jsx("input",{type:"checkbox",className:"h-4 w-4 text-lpBlue",checked:c.includes(S.id),onChange:()=>u(S.id)}),n.jsx("span",{className:"text-gray-800",children:S.label||"[Untitled Section]"})]},S.id)),t.length>0&&n.jsx("button",{type:"button",className:"text-xs text-lpBlue hover:underline",onClick:p,children:"Select All"})]}),n.jsxs("div",{className:"flex justify-end gap-3 border-t px-5 py-4 bg-navySecondary50",children:[n.jsx("button",{onClick:r,className:"px-4 py-2 text-gray-600 hover:bg-navySecondary200 rounded-md",children:"Cancel"}),n.jsx("button",{onClick:y,className:"px-5 py-2 bg-lpBlue text-white rounded-md font-semibold hover:bg-blue-900",children:"Save"})]})]})})},ke=e=>(e||"").replace(/\u00A0/g," ").replace(/\s+/g,"").trim();var ua=1e9,jN={precision:20,rounding:4,toExpNeg:-7,toExpPos:21,LN10:"2.302585092994045684017991454684364207601101488628772976033327900967572609677352480235997205089598298341967784042286"},zu,yt=!0,On="[DecimalError] ",fr=On+"Invalid argument: ",Wu=On+"Exponent out of range: ",ma=Math.floor,lr=Math.pow,EN=/^(\d+(\.\d*)?|\.\d+)(e[+-]?\d+)?$/i,hn,Ft=1e7,xt=7,Sh=9007199254740991,ni=ma(Sh/xt),Te={};Te.absoluteValue=Te.abs=function(){var e=new this.constructor(this);return e.s&&(e.s=1),e};Te.comparedTo=Te.cmp=function(e){var t,s,r,a,o=this;if(e=new o.constructor(e),o.s!==e.s)return o.s||-e.s;if(o.e!==e.e)return o.e>e.e^o.s<0?1:-1;for(r=o.d.length,a=e.d.length,t=0,s=r<a?r:a;t<s;++t)if(o.d[t]!==e.d[t])return o.d[t]>e.d[t]^o.s<0?1:-1;return r===a?0:r>a^o.s<0?1:-1};Te.decimalPlaces=Te.dp=function(){var e=this,t=e.d.length-1,s=(t-e.e)*xt;if(t=e.d[t],t)for(;t%10==0;t/=10)s--;return s<0?0:s};Te.dividedBy=Te.div=function(e){return Ss(this,new this.constructor(e))};Te.dividedToIntegerBy=Te.idiv=function(e){var t=this,s=t.constructor;return dt(Ss(t,new s(e),0,1),s.precision)};Te.equals=Te.eq=function(e){return!this.cmp(e)};Te.exponent=function(){return Ct(this)};Te.greaterThan=Te.gt=function(e){return this.cmp(e)>0};Te.greaterThanOrEqualTo=Te.gte=function(e){return this.cmp(e)>=0};Te.isInteger=Te.isint=function(){return this.e>this.d.length-2};Te.isNegative=Te.isneg=function(){return this.s<0};Te.isPositive=Te.ispos=function(){return this.s>0};Te.isZero=function(){return this.s===0};Te.lessThan=Te.lt=function(e){return this.cmp(e)<0};Te.lessThanOrEqualTo=Te.lte=function(e){return this.cmp(e)<1};Te.logarithm=Te.log=function(e){var t,s=this,r=s.constructor,a=r.precision,o=a+5;if(e===void 0)e=new r(10);else if(e=new r(e),e.s<1||e.eq(hn))throw Error(On+"NaN");if(s.s<1)throw Error(On+(s.s?"NaN":"-Infinity"));return s.eq(hn)?new r(0):(yt=!1,t=Ss(So(s,o),So(e,o),o),yt=!0,dt(t,a))};Te.minus=Te.sub=function(e){var t=this;return e=new t.constructor(e),t.s==e.s?Eh(t,e):wh(t,(e.s=-e.s,e))};Te.modulo=Te.mod=function(e){var t,s=this,r=s.constructor,a=r.precision;if(e=new r(e),!e.s)throw Error(On+"NaN");return s.s?(yt=!1,t=Ss(s,e,0,1).times(e),yt=!0,s.minus(t)):dt(new r(s),a)};Te.naturalExponential=Te.exp=function(){return jh(this)};Te.naturalLogarithm=Te.ln=function(){return So(this)};Te.negated=Te.neg=function(){var e=new this.constructor(this);return e.s=-e.s||0,e};Te.plus=Te.add=function(e){var t=this;return e=new t.constructor(e),t.s==e.s?wh(t,e):Eh(t,(e.s=-e.s,e))};Te.precision=Te.sd=function(e){var t,s,r,a=this;if(e!==void 0&&e!==!!e&&e!==1&&e!==0)throw Error(fr+e);if(t=Ct(a)+1,r=a.d.length-1,s=r*xt+1,r=a.d[r],r){for(;r%10==0;r/=10)s--;for(r=a.d[0];r>=10;r/=10)s++}return e&&t>s?t:s};Te.squareRoot=Te.sqrt=function(){var e,t,s,r,a,o,l,c=this,i=c.constructor;if(c.s<1){if(!c.s)return new i(0);throw Error(On+"NaN")}for(e=Ct(c),yt=!1,a=Math.sqrt(+c),a==0||a==1/0?(t=ns(c.d),(t.length+e)%2==0&&(t+="0"),a=Math.sqrt(t),e=ma((e+1)/2)-(e<0||e%2),a==1/0?t="5e"+e:(t=a.toExponential(),t=t.slice(0,t.indexOf("e")+1)+e),r=new i(t)):r=new i(a.toString()),s=i.precision,a=l=s+3;;)if(o=r,r=o.plus(Ss(c,o,l+2)).times(.5),ns(o.d).slice(0,l)===(t=ns(r.d)).slice(0,l)){if(t=t.slice(l-3,l+1),a==l&&t=="4999"){if(dt(o,s+1,0),o.times(o).eq(c)){r=o;break}}else if(t!="9999")break;l+=4}return yt=!0,dt(r,s)};Te.times=Te.mul=function(e){var t,s,r,a,o,l,c,i,u,p=this,y=p.constructor,S=p.d,w=(e=new y(e)).d;if(!p.s||!e.s)return new y(0);for(e.s*=p.s,s=p.e+e.e,i=S.length,u=w.length,i<u&&(o=S,S=w,w=o,l=i,i=u,u=l),o=[],l=i+u,r=l;r--;)o.push(0);for(r=u;--r>=0;){for(t=0,a=i+r;a>r;)c=o[a]+w[r]*S[a-r-1]+t,o[a--]=c%Ft|0,t=c/Ft|0;o[a]=(o[a]+t)%Ft|0}for(;!o[--l];)o.pop();return t?++s:o.shift(),e.d=o,e.e=s,yt?dt(e,y.precision):e};Te.toDecimalPlaces=Te.todp=function(e,t){var s=this,r=s.constructor;return s=new r(s),e===void 0?s:(os(e,0,ua),t===void 0?t=r.rounding:os(t,0,8),dt(s,e+Ct(s)+1,t))};Te.toExponential=function(e,t){var s,r=this,a=r.constructor;return e===void 0?s=br(r,!0):(os(e,0,ua),t===void 0?t=a.rounding:os(t,0,8),r=dt(new a(r),e+1,t),s=br(r,!0,e+1)),s};Te.toFixed=function(e,t){var s,r,a=this,o=a.constructor;return e===void 0?br(a):(os(e,0,ua),t===void 0?t=o.rounding:os(t,0,8),r=dt(new o(a),e+Ct(a)+1,t),s=br(r.abs(),!1,e+Ct(r)+1),a.isneg()&&!a.isZero()?"-"+s:s)};Te.toInteger=Te.toint=function(){var e=this,t=e.constructor;return dt(new t(e),Ct(e)+1,t.rounding)};Te.toNumber=function(){return+this};Te.toPower=Te.pow=function(e){var t,s,r,a,o,l,c=this,i=c.constructor,u=12,p=+(e=new i(e));if(!e.s)return new i(hn);if(c=new i(c),!c.s){if(e.s<1)throw Error(On+"Infinity");return c}if(c.eq(hn))return c;if(r=i.precision,e.eq(hn))return dt(c,r);if(t=e.e,s=e.d.length-1,l=t>=s,o=c.s,l){if((s=p<0?-p:p)<=Sh){for(a=new i(hn),t=Math.ceil(r/xt+4),yt=!1;s%2&&(a=a.times(c),wp(a.d,t)),s=ma(s/2),s!==0;)c=c.times(c),wp(c.d,t);return yt=!0,e.s<0?new i(hn).div(a):dt(a,r)}}else if(o<0)throw Error(On+"NaN");return o=o<0&&e.d[Math.max(t,s)]&1?-1:1,c.s=1,yt=!1,a=e.times(So(c,r+u)),yt=!0,a=jh(a),a.s=o,a};Te.toPrecision=function(e,t){var s,r,a=this,o=a.constructor;return e===void 0?(s=Ct(a),r=br(a,s<=o.toExpNeg||s>=o.toExpPos)):(os(e,1,ua),t===void 0?t=o.rounding:os(t,0,8),a=dt(new o(a),e,t),s=Ct(a),r=br(a,e<=s||s<=o.toExpNeg,e)),r};Te.toSignificantDigits=Te.tosd=function(e,t){var s=this,r=s.constructor;return e===void 0?(e=r.precision,t=r.rounding):(os(e,1,ua),t===void 0?t=r.rounding:os(t,0,8)),dt(new r(s),e,t)};Te.toString=Te.valueOf=Te.val=Te.toJSON=Te[Symbol.for("nodejs.util.inspect.custom")]=function(){var e=this,t=Ct(e),s=e.constructor;return br(e,t<=s.toExpNeg||t>=s.toExpPos)};function wh(e,t){var s,r,a,o,l,c,i,u,p=e.constructor,y=p.precision;if(!e.s||!t.s)return t.s||(t=new p(e)),yt?dt(t,y):t;if(i=e.d,u=t.d,l=e.e,a=t.e,i=i.slice(),o=l-a,o){for(o<0?(r=i,o=-o,c=u.length):(r=u,a=l,c=i.length),l=Math.ceil(y/xt),c=l>c?l+1:c+1,o>c&&(o=c,r.length=1),r.reverse();o--;)r.push(0);r.reverse()}for(c=i.length,o=u.length,c-o<0&&(o=c,r=u,u=i,i=r),s=0;o;)s=(i[--o]=i[o]+u[o]+s)/Ft|0,i[o]%=Ft;for(s&&(i.unshift(s),++a),c=i.length;i[--c]==0;)i.pop();return t.d=i,t.e=a,yt?dt(t,y):t}function os(e,t,s){if(e!==~~e||e<t||e>s)throw Error(fr+e)}function ns(e){var t,s,r,a=e.length-1,o="",l=e[0];if(a>0){for(o+=l,t=1;t<a;t++)r=e[t]+"",s=xt-r.length,s&&(o+=Ms(s)),o+=r;l=e[t],r=l+"",s=xt-r.length,s&&(o+=Ms(s))}else if(l===0)return"0";for(;l%10===0;)l/=10;return o+l}var Ss=function(){function e(r,a){var o,l=0,c=r.length;for(r=r.slice();c--;)o=r[c]*a+l,r[c]=o%Ft|0,l=o/Ft|0;return l&&r.unshift(l),r}function t(r,a,o,l){var c,i;if(o!=l)i=o>l?1:-1;else for(c=i=0;c<o;c++)if(r[c]!=a[c]){i=r[c]>a[c]?1:-1;break}return i}function s(r,a,o){for(var l=0;o--;)r[o]-=l,l=r[o]<a[o]?1:0,r[o]=l*Ft+r[o]-a[o];for(;!r[0]&&r.length>1;)r.shift()}return function(r,a,o,l){var c,i,u,p,y,S,w,L,k,U,N,x,b,F,H,V,q,te,G=r.constructor,le=r.s==a.s?1:-1,j=r.d,T=a.d;if(!r.s)return new G(r);if(!a.s)throw Error(On+"Division by zero");for(i=r.e-a.e,q=T.length,H=j.length,w=new G(le),L=w.d=[],u=0;T[u]==(j[u]||0);)++u;if(T[u]>(j[u]||0)&&--i,o==null?x=o=G.precision:l?x=o+(Ct(r)-Ct(a))+1:x=o,x<0)return new G(0);if(x=x/xt+2|0,u=0,q==1)for(p=0,T=T[0],x++;(u<H||p)&&x--;u++)b=p*Ft+(j[u]||0),L[u]=b/T|0,p=b%T|0;else{for(p=Ft/(T[0]+1)|0,p>1&&(T=e(T,p),j=e(j,p),q=T.length,H=j.length),F=q,k=j.slice(0,q),U=k.length;U<q;)k[U++]=0;te=T.slice(),te.unshift(0),V=T[0],T[1]>=Ft/2&&++V;do p=0,c=t(T,k,q,U),c<0?(N=k[0],q!=U&&(N=N*Ft+(k[1]||0)),p=N/V|0,p>1?(p>=Ft&&(p=Ft-1),y=e(T,p),S=y.length,U=k.length,c=t(y,k,S,U),c==1&&(p--,s(y,q<S?te:T,S))):(p==0&&(c=p=1),y=T.slice()),S=y.length,S<U&&y.unshift(0),s(k,y,U),c==-1&&(U=k.length,c=t(T,k,q,U),c<1&&(p++,s(k,q<U?te:T,U))),U=k.length):c===0&&(p++,k=[0]),L[u++]=p,c&&k[0]?k[U++]=j[F]||0:(k=[j[F]],U=1);while((F++<H||k[0]!==void 0)&&x--)}return L[0]||L.shift(),w.e=i,dt(w,l?o+Ct(w)+1:o)}}();function jh(e,t){var s,r,a,o,l,c,i=0,u=0,p=e.constructor,y=p.precision;if(Ct(e)>16)throw Error(Wu+Ct(e));if(!e.s)return new p(hn);for(yt=!1,c=y,l=new p(.03125);e.abs().gte(.1);)e=e.times(l),u+=5;for(r=Math.log(lr(2,u))/Math.LN10*2+5|0,c+=r,s=a=o=new p(hn),p.precision=c;;){if(a=dt(a.times(e),c),s=s.times(++i),l=o.plus(Ss(a,s,c)),ns(l.d).slice(0,c)===ns(o.d).slice(0,c)){for(;u--;)o=dt(o.times(o),c);return p.precision=y,t==null?(yt=!0,dt(o,y)):o}o=l}}function Ct(e){for(var t=e.e*xt,s=e.d[0];s>=10;s/=10)t++;return t}function kc(e,t,s){if(t>e.LN10.sd())throw yt=!0,s&&(e.precision=s),Error(On+"LN10 precision limit exceeded");return dt(new e(e.LN10),t)}function Ms(e){for(var t="";e--;)t+="0";return t}function So(e,t){var s,r,a,o,l,c,i,u,p,y=1,S=10,w=e,L=w.d,k=w.constructor,U=k.precision;if(w.s<1)throw Error(On+(w.s?"NaN":"-Infinity"));if(w.eq(hn))return new k(0);if(t==null?(yt=!1,u=U):u=t,w.eq(10))return t==null&&(yt=!0),kc(k,u);if(u+=S,k.precision=u,s=ns(L),r=s.charAt(0),o=Ct(w),Math.abs(o)<15e14){for(;r<7&&r!=1||r==1&&s.charAt(1)>3;)w=w.times(e),s=ns(w.d),r=s.charAt(0),y++;o=Ct(w),r>1?(w=new k("0."+s),o++):w=new k(r+"."+s.slice(1))}else return i=kc(k,u+2,U).times(o+""),w=So(new k(r+"."+s.slice(1)),u-S).plus(i),k.precision=U,t==null?(yt=!0,dt(w,U)):w;for(c=l=w=Ss(w.minus(hn),w.plus(hn),u),p=dt(w.times(w),u),a=3;;){if(l=dt(l.times(p),u),i=c.plus(Ss(l,new k(a),u)),ns(i.d).slice(0,u)===ns(c.d).slice(0,u))return c=c.times(2),o!==0&&(c=c.plus(kc(k,u+2,U).times(o+""))),c=Ss(c,new k(y),u),k.precision=U,t==null?(yt=!0,dt(c,U)):c;c=i,a+=2}}function Sp(e,t){var s,r,a;for((s=t.indexOf("."))>-1&&(t=t.replace(".","")),(r=t.search(/e/i))>0?(s<0&&(s=r),s+=+t.slice(r+1),t=t.substring(0,r)):s<0&&(s=t.length),r=0;t.charCodeAt(r)===48;)++r;for(a=t.length;t.charCodeAt(a-1)===48;)--a;if(t=t.slice(r,a),t){if(a-=r,s=s-r-1,e.e=ma(s/xt),e.d=[],r=(s+1)%xt,s<0&&(r+=xt),r<a){for(r&&e.d.push(+t.slice(0,r)),a-=xt;r<a;)e.d.push(+t.slice(r,r+=xt));t=t.slice(r),r=xt-t.length}else r-=a;for(;r--;)t+="0";if(e.d.push(+t),yt&&(e.e>ni||e.e<-ni))throw Error(Wu+s)}else e.s=0,e.e=0,e.d=[0];return e}function dt(e,t,s){var r,a,o,l,c,i,u,p,y=e.d;for(l=1,o=y[0];o>=10;o/=10)l++;if(r=t-l,r<0)r+=xt,a=t,u=y[p=0];else{if(p=Math.ceil((r+1)/xt),o=y.length,p>=o)return e;for(u=o=y[p],l=1;o>=10;o/=10)l++;r%=xt,a=r-xt+l}if(s!==void 0&&(o=lr(10,l-a-1),c=u/o%10|0,i=t<0||y[p+1]!==void 0||u%o,i=s<4?(c||i)&&(s==0||s==(e.s<0?3:2)):c>5||c==5&&(s==4||i||s==6&&(r>0?a>0?u/lr(10,l-a):0:y[p-1])%10&1||s==(e.s<0?8:7))),t<1||!y[0])return i?(o=Ct(e),y.length=1,t=t-o-1,y[0]=lr(10,(xt-t%xt)%xt),e.e=ma(-t/xt)||0):(y.length=1,y[0]=e.e=e.s=0),e;if(r==0?(y.length=p,o=1,p--):(y.length=p+1,o=lr(10,xt-r),y[p]=a>0?(u/lr(10,l-a)%lr(10,a)|0)*o:0),i)for(;;)if(p==0){(y[0]+=o)==Ft&&(y[0]=1,++e.e);break}else{if(y[p]+=o,y[p]!=Ft)break;y[p--]=0,o=1}for(r=y.length;y[--r]===0;)y.pop();if(yt&&(e.e>ni||e.e<-ni))throw Error(Wu+Ct(e));return e}function Eh(e,t){var s,r,a,o,l,c,i,u,p,y,S=e.constructor,w=S.precision;if(!e.s||!t.s)return t.s?t.s=-t.s:t=new S(e),yt?dt(t,w):t;if(i=e.d,y=t.d,r=t.e,u=e.e,i=i.slice(),l=u-r,l){for(p=l<0,p?(s=i,l=-l,c=y.length):(s=y,r=u,c=i.length),a=Math.max(Math.ceil(w/xt),c)+2,l>a&&(l=a,s.length=1),s.reverse(),a=l;a--;)s.push(0);s.reverse()}else{for(a=i.length,c=y.length,p=a<c,p&&(c=a),a=0;a<c;a++)if(i[a]!=y[a]){p=i[a]<y[a];break}l=0}for(p&&(s=i,i=y,y=s,t.s=-t.s),c=i.length,a=y.length-c;a>0;--a)i[c++]=0;for(a=y.length;a>l;){if(i[--a]<y[a]){for(o=a;o&&i[--o]===0;)i[o]=Ft-1;--i[o],i[a]+=Ft}i[a]-=y[a]}for(;i[--c]===0;)i.pop();for(;i[0]===0;i.shift())--r;return i[0]?(t.d=i,t.e=r,yt?dt(t,w):t):new S(0)}function br(e,t,s){var r,a=Ct(e),o=ns(e.d),l=o.length;return t?(s&&(r=s-l)>0?o=o.charAt(0)+"."+o.slice(1)+Ms(r):l>1&&(o=o.charAt(0)+"."+o.slice(1)),o=o+(a<0?"e":"e+")+a):a<0?(o="0."+Ms(-a-1)+o,s&&(r=s-l)>0&&(o+=Ms(r))):a>=l?(o+=Ms(a+1-l),s&&(r=s-a-1)>0&&(o=o+"."+Ms(r))):((r=a+1)<l&&(o=o.slice(0,r)+"."+o.slice(r)),s&&(r=s-l)>0&&(a+1===l&&(o+="."),o+=Ms(r))),e.s<0?"-"+o:o}function wp(e,t){if(e.length>t)return e.length=t,!0}function kh(e){var t,s,r;function a(o){var l=this;if(!(l instanceof a))return new a(o);if(l.constructor=a,o instanceof a){l.s=o.s,l.e=o.e,l.d=(o=o.d)?o.slice():o;return}if(typeof o=="number"){if(o*0!==0)throw Error(fr+o);if(o>0)l.s=1;else if(o<0)o=-o,l.s=-1;else{l.s=0,l.e=0,l.d=[0];return}if(o===~~o&&o<1e7){l.e=0,l.d=[o];return}return Sp(l,o.toString())}else if(typeof o!="string")throw Error(fr+o);if(o.charCodeAt(0)===45?(o=o.slice(1),l.s=-1):l.s=1,EN.test(o))Sp(l,o);else throw Error(fr+o)}if(a.prototype=Te,a.ROUND_UP=0,a.ROUND_DOWN=1,a.ROUND_CEIL=2,a.ROUND_FLOOR=3,a.ROUND_HALF_UP=4,a.ROUND_HALF_DOWN=5,a.ROUND_HALF_EVEN=6,a.ROUND_HALF_CEIL=7,a.ROUND_HALF_FLOOR=8,a.clone=kh,a.config=a.set=kN,e===void 0&&(e={}),e)for(r=["precision","rounding","toExpNeg","toExpPos","LN10"],t=0;t<r.length;)e.hasOwnProperty(s=r[t++])||(e[s]=this[s]);return a.config(e),a}function kN(e){if(!e||typeof e!="object")throw Error(On+"Object expected");var t,s,r,a=["precision",1,ua,"rounding",0,8,"toExpNeg",-1/0,0,"toExpPos",0,1/0];for(t=0;t<a.length;t+=3)if((r=e[s=a[t]])!==void 0)if(ma(r)===r&&r>=a[t+1]&&r<=a[t+2])this[s]=r;else throw Error(fr+s+": "+r);if((r=e[s="LN10"])!==void 0)if(r==Math.LN10)this[s]=new this(r);else throw Error(fr+s+": "+r);return this}var zu=kh(jN);hn=new zu(1);const hs=zu;hs.set({precision:20,rounding:hs.ROUND_HALF_UP});const zn=e=>new hs(e??0),gs=e=>e.toDecimalPlaces(2).toNumber(),Ah=(e,t)=>{const s=zn(e),r=zn(t);return gs(s.mul(r))},Ih=(e,t)=>{const s=zn(e),r=zn(t).div(100);return gs(s.mul(r))},Th=(e,t)=>{const s=zn(e),r=zn(t);return gs(s.add(r))},Ac=e=>{if(e.lineTotalAmount!=null)return zn(e.lineTotalAmount);const t=e.lineNetAmount!=null?e.lineNetAmount:Ah(e.quantity??0,e.unitPrice??0),s=e.lineVatAmount!=null?e.lineVatAmount:Ih(t,e.vatRate??0);return zn(Th(t,s))},Dn=(e,t)=>{const s=t.reduce((w,L)=>w.add(Ac(L)),new hs(0)),r=t.reduce((w,L)=>L.isIncludedInRequestedAmount===!1?w:w.add(Ac(L)),new hs(0)),a=t.reduce((w,L)=>L.lineVatAmount==null?w:w.add(zn(L.lineVatAmount)),new hs(0)),l=t.filter(w=>(w.kind==="ADJUSTMENT"||w.kind==="COMPENSATION")&&w.isIncludedInRequestedAmount===!1).reduce((w,L)=>w.add(Ac(L)),new hs(0)),c=zn(e.deductibleAmount??0),i=zn(e.alreadyPaidAmount??0),u=c.add(i).add(l),p=r.sub(u),y=!!e.infoOnly,S=y?new hs(0):p.greaterThan(0)?p:new hs(0);return{grossExpensesTotal:gs(s),includedExpensesTotal:gs(r),vatTotal:gs(a),adjustmentsTotal:gs(u),amountBeforeInfoOnly:gs(p),amountToRequest:gs(S),infoOnlyApplied:y}},Rh="financial_expenses_store_v1",ll=()=>({sheets:{},lineItems:{},attachments:{},auditEvents:{},insurerRulesets:{},exceptionAnnotations:{},payments:{}}),jt=()=>{if(typeof window>"u")return ll();try{const e=window.localStorage.getItem(Rh);if(!e)return ll();const t=JSON.parse(e);return!t||typeof t!="object"?ll():{sheets:t.sheets||{},lineItems:t.lineItems||{},attachments:t.attachments||{},auditEvents:t.auditEvents||{},insurerRulesets:t.insurerRulesets||{},exceptionAnnotations:t.exceptionAnnotations||{},payments:t.payments||{}}}catch(e){return console.error("Failed to load financial expenses store",e),ll()}},Sn=e=>{if(!(typeof window>"u"))try{window.localStorage.setItem(Rh,JSON.stringify(e))}catch(t){console.error("Failed to persist financial expenses store",t)}},AN=e=>{let t=0;for(let s=0;s<e.length;s++)t=(t<<5)-t+e.charCodeAt(s),t|=0;return Math.abs(t).toString(16)},IN=(e,t,s)=>{const r={sheet:e,lineItems:t.map(a=>({id:a.id,sheetId:a.sheetId,kind:a.kind,expenseType:a.expenseType,providerName:a.providerName,description:a.description,date:a.date,quantity:a.quantity,unitPrice:a.unitPrice,vatRate:a.vatRate,isIncludedInRequestedAmount:a.isIncludedInRequestedAmount,lineNetAmount:a.lineNetAmount,lineVatAmount:a.lineVatAmount,lineTotalAmount:a.lineTotalAmount,attachmentId:a.attachmentId})),attachments:s.map(a=>({id:a.id,sheetId:a.sheetId,fileKey:a.fileKey,originalFileName:a.originalFileName,mimeType:a.mimeType,sizeBytes:a.sizeBytes,linkedLineItemId:a.linkedLineItemId}))};return AN(JSON.stringify(r))},fn=()=>new Date().toISOString(),pa=e=>`${e}_${Math.random().toString(36).slice(2,10)}_${Date.now().toString(36)}`,wo=(e,t)=>{const s=Object.values(e.lineItems).filter(a=>a.sheetId===t),r=Object.values(e.attachments).filter(a=>a.sheetId===t);return{lineItems:s,attachments:r}},TN=e=>{const t=jt(),s=ke(e);return Object.values(t.payments).filter(r=>!r.isDeleted&&ke(r.caseId)===s).sort((r,a)=>{const o=new Date(r.paidAt).getTime(),l=new Date(a.paidAt).getTime();return o-l})},RN=e=>{let t=jt();const s=pa("fpay"),r=fn(),a={id:s,caseId:ke(e.caseId),sheetId:e.sheetId??null,amount:e.amount,paidAt:e.paidAt,reference:e.reference??null,note:e.note??null,isDeleted:!1,createdAt:r,updatedAt:r};return t={...t,payments:{...t.payments,[s]:a}},Sn(t),a},CN=e=>{let t=jt();const s=t.payments[e];if(!s)return null;const r={...s,isDeleted:!0,updatedAt:fn()};return t={...t,payments:{...t.payments,[e]:r}},Sn(t),r},jp=(e,t,s)=>{const r=jt(),a=ke(e);if(!a)return s??0;const o=t?new Date(t).getTime():Date.now();if(Number.isNaN(o))return s??0;let l=0,c=!1;return Object.values(r.payments).forEach(i=>{if(i.isDeleted||ke(i.caseId)!==a)return;c=!0;const u=new Date(i.paidAt).getTime();if(Number.isNaN(u)||u>o)return;const p=Number(i.amount)||0;p<=0||(l+=p)}),c?l:s??0},DN=e=>jt().insurerRulesets[e]||null,il=()=>{const e=jt();return Object.values(e.sheets).sort((t,s)=>{const r=new Date(t.updatedAt||t.createdAt).getTime();return new Date(s.updatedAt||s.createdAt).getTime()-r})},cl=e=>{const t=jt(),s=t.sheets[e];if(!s)return null;const{lineItems:r,attachments:a}=wo(t,e);return{sheet:s,lineItems:r,attachments:a}},Is=(e,t)=>{const s=e.sheets[t];if(!s)return e;const{lineItems:r,attachments:a}=wo(e,t),o={...s,sheetVersionNumber:s.sheetVersionNumber+1,sheetVersionHash:IN(s,r,a),updatedAt:fn()};return{...e,sheets:{...e.sheets,[t]:o}}},Ts=(e,t,s,r,a,o,l,c)=>{const i=e.sheets[t];if(!i)return e;const u=pa("fae"),p={id:u,sheetId:t,actorUserId:s,actorRole:r,eventType:a,eventAt:fn(),entityType:o,entityId:l??null,diffJson:c,sheetVersionNumberAtEvent:i.sheetVersionNumber,sheetVersionHashAtEvent:i.sheetVersionHash};return{...e,auditEvents:{...e.auditEvents,[u]:p}}},LN=e=>{const t=jt(),s=pa("fes"),r=fn(),a={id:s,caseId:e.caseId,insurerId:e.insurerId??null,insurerName:e.insurerName??null,periodStart:e.periodStart??null,periodEnd:e.periodEnd??null,periodLabel:e.periodLabel??null,versionIndex:e.versionIndex,status:"DRAFT",archivedReason:null,currency:e.currency||"ILS",deductibleAmount:e.deductibleAmount??null,alreadyPaidAmount:e.alreadyPaidAmount??null,infoOnly:!!e.infoOnly,attachedToReportId:null,attachedAt:null,createdByUserId:e.createdByUserId,createdAt:r,updatedAt:r,readyAt:null,sheetVersionNumber:1,sheetVersionHash:"",insurerRulesetId:e.insurerRulesetId??null,insurerRulesetVersion:e.insurerRulesetVersion??null};let o={...t,sheets:{...t.sheets,[s]:a}};return o=Is(o,s),o=Ts(o,s,e.createdByUserId,"FINANCE","SHEET_CREATED","SHEET",s,{caseId:e.caseId,insurerId:e.insurerId??null,insurerName:e.insurerName??null}),Sn(o),o.sheets[s]},_N=e=>{let t=jt();if(!t.sheets[e])return console.warn("deleteFinancialExpenseSheet: sheet not found",e),t;const r={...t.sheets};delete r[e];const a={};Object.values(t.lineItems).forEach(l=>{l.sheetId!==e&&(a[l.id]=l)});const o={};return Object.values(t.attachments).forEach(l=>{l.sheetId!==e&&(o[l.id]=l)}),t={...t,sheets:r,lineItems:a,attachments:o},Sn(t),t},ON=e=>{let t=jt();const s=t.sheets[e.sheetId];if(!s)return console.warn("updateFinancialExpenseSheetMeta: sheet not found",e.sheetId),null;const r={...s,...e.patch,updatedAt:fn()};t={...t,sheets:{...t.sheets,[e.sheetId]:r}};const a={};return Object.keys(e.patch).forEach(o=>{const l=s[o],c=r[o];l!==c&&(a[o]={before:l,after:c})}),t=Is(t,e.sheetId),t=Ts(t,e.sheetId,e.actorUserId,e.actorRole,"SHEET_META_UPDATED","SHEET",e.sheetId,Object.keys(a).length?a:void 0),Sn(t),t.sheets[e.sheetId]},MN=e=>{let t=jt();if(!t.sheets[e.sheetId])return console.warn("addFinancialExpenseLineItem: sheet not found",e.sheetId),null;const s=pa("fli"),r=fn(),a={id:s,sheetId:e.sheetId,kind:e.kind,expenseType:e.expenseType??null,providerName:e.providerName??null,providerId:e.providerId??null,description:e.description,date:e.date??null,quantity:e.quantity??null,unitPrice:e.unitPrice??null,vatRate:e.vatRate??null,isIncludedInRequestedAmount:e.isIncludedInRequestedAmount??!0,lineNetAmount:e.lineNetAmount??null,lineVatAmount:e.lineVatAmount??null,lineTotalAmount:e.lineTotalAmount??null,attachmentId:e.attachmentId??null,createdAt:r,updatedAt:r};return t={...t,lineItems:{...t.lineItems,[s]:a}},t=Is(t,e.sheetId),t=Ts(t,e.sheetId,e.actorUserId,e.actorRole,"LINE_ITEM_CREATED","LINE_ITEM",s,{kind:e.kind,description:e.description,amount:e.lineTotalAmount??null}),Sn(t),a},PN=e=>{let t=jt();const s=t.lineItems[e.lineItemId];if(!s||s.sheetId!==e.sheetId)return console.warn("updateFinancialExpenseLineItem: line item not found",e.lineItemId),null;const r={...s,...e.patch,updatedAt:fn()};t={...t,lineItems:{...t.lineItems,[e.lineItemId]:r}};const a={};return Object.keys(e.patch).forEach(o=>{const l=s[o],c=r[o];l!==c&&(a[o]={before:l,after:c})}),t=Is(t,e.sheetId),t=Ts(t,e.sheetId,e.actorUserId,e.actorRole,"LINE_ITEM_UPDATED","LINE_ITEM",e.lineItemId,Object.keys(a).length?a:void 0),Sn(t),t.lineItems[e.lineItemId]},FN=e=>{let t=jt();const s=t.lineItems[e.lineItemId];if(!s||s.sheetId!==e.sheetId)return console.warn("deleteFinancialExpenseLineItem: line item not found",e.lineItemId),!1;const{[e.lineItemId]:r,...a}=t.lineItems;return t={...t,lineItems:a},t=Is(t,e.sheetId),t=Ts(t,e.sheetId,e.actorUserId,e.actorRole,"LINE_ITEM_DELETED","LINE_ITEM",e.lineItemId,{deleted:r}),Sn(t),!0},BN=e=>{let t=jt();if(!t.sheets[e.sheetId])return console.warn("addFinancialExpenseAttachment: sheet not found",e.sheetId),null;const s=pa("fat"),r=fn(),a={id:s,sheetId:e.sheetId,fileKey:e.fileKey,originalFileName:e.originalFileName,mimeType:e.mimeType??null,sizeBytes:e.sizeBytes??null,uploadedByUserId:e.uploadedByUserId,uploadedAt:r,linkedLineItemId:e.linkedLineItemId??null};return t={...t,attachments:{...t.attachments,[s]:a}},t=Is(t,e.sheetId),t=Ts(t,e.sheetId,e.uploadedByUserId,"FINANCE","ATTACHMENT_ADDED","ATTACHMENT",s,{fileKey:e.fileKey,originalFileName:e.originalFileName}),Sn(t),a},$N=e=>{let t=jt();const s=t.attachments[e.attachmentId];if(!s||s.sheetId!==e.sheetId)return console.warn("linkAttachmentToLineItem: attachment not found",e.attachmentId),null;const r=s.linkedLineItemId??null,a={...s,linkedLineItemId:e.lineItemId};if(t={...t,attachments:{...t.attachments,[e.attachmentId]:a}},e.lineItemId){const o=t.lineItems[e.lineItemId];o&&(t={...t,lineItems:{...t.lineItems,[e.lineItemId]:{...o,attachmentId:e.attachmentId,updatedAt:fn()}}})}else if(r){const o=t.lineItems[r];o&&o.attachmentId===e.attachmentId&&(t={...t,lineItems:{...t.lineItems,[r]:{...o,attachmentId:null,updatedAt:fn()}}})}return t=Is(t,e.sheetId),t=Ts(t,e.sheetId,e.actorUserId,e.actorRole,"ATTACHMENT_LINKED","ATTACHMENT",e.attachmentId,{before:r,after:e.lineItemId}),Sn(t),t.attachments[e.attachmentId]},HN=e=>{let t=jt();const s=t.sheets[e.sheetId];if(!s)return console.warn("recordSheetReadyAttempt: sheet not found",e.sheetId),null;let r=s;if(e.success){const a=fn();r={...s,status:"READY_FOR_REPORT",readyAt:a,updatedAt:a,insurerRulesetId:e.decisionLog.rulesetId??s.insurerRulesetId??null,insurerRulesetVersion:e.decisionLog.rulesetVersion??s.insurerRulesetVersion??null},t={...t,sheets:{...t.sheets,[e.sheetId]:r}},t=Is(t,e.sheetId)}return t=Ts(t,e.sheetId,e.actorUserId,e.actorRole,"SHEET_READY_ATTEMPT","SHEET",e.sheetId,{success:e.success,decisionLog:e.decisionLog}),Sn(t),t.sheets[e.sheetId]},UN=e=>{let t=jt();const s=t.sheets[e.sheetId];if(!s||s.status!=="READY_FOR_REPORT")return s||null;const r=fn(),a={...s,status:"DRAFT",readyAt:null,updatedAt:r};return t={...t,sheets:{...t.sheets,[e.sheetId]:a}},t=Is(t,e.sheetId),t=Ts(t,e.sheetId,e.actorUserId,e.actorRole,"SHEET_REVERTED_TO_DRAFT","SHEET",e.sheetId,{from:"READY_FOR_REPORT",to:"DRAFT"}),Sn(t),t.sheets[e.sheetId]},WN=(e,t)=>{const s=jt(),r=Object.values(s.sheets),a=new Map;t.forEach(c=>{a.set(c.id,c)});const o=r.map(c=>{var k,U;const{lineItems:i}=wo(s,c.id),u=Dn(c,i),p=c.attachedToReportId?a.get(c.attachedToReportId):void 0,y=Object.values(s.auditEvents).filter(N=>N.sheetId===c.id&&N.diffJson&&N.diffJson.decisionLog);y.sort((N,x)=>new Date(x.eventAt).getTime()-new Date(N.eventAt).getTime());const S=((U=(k=y[0])==null?void 0:k.diffJson)==null?void 0:U.decisionLog)||null,w=S!=null&&S.blockingIssueCodes&&Array.isArray(S.blockingIssueCodes)?S.blockingIssueCodes:void 0,L=(p==null?void 0:p.expensesSheetId)===c.id?!!p.expensesOutOfSync:!1;return{sheetId:c.id,caseId:c.caseId,insurerName:c.insurerName??null,status:c.status,versionIndex:c.versionIndex,updatedAt:c.updatedAt,readyAt:c.readyAt??null,attachedAt:c.attachedAt??null,sentAt:(p==null?void 0:p.sentAt)||null,amountToRequest:u.amountToRequest,infoOnly:c.infoOnly,expensesOutOfSync:L,blockingIssueCodesLatest:w}}),l=c=>{if(!c)return!1;const i=new Date(c).getTime();return!(Number.isNaN(i)||e.dateFrom&&i<new Date(e.dateFrom).getTime()||e.dateTo&&i>new Date(e.dateTo).getTime())};return o.filter(c=>{var i,u;if(e.status&&c.status!==e.status||e.insurerId&&((i=s.sheets[c.sheetId])==null?void 0:i.insurerId)!==e.insurerId||e.insurerName&&!(c.insurerName||"").toLowerCase().includes(e.insurerName.toLowerCase()))return!1;if(e.caseIdOrSearch){const p=e.caseIdOrSearch.toLowerCase();if(!`${c.caseId} ${c.insurerName||""}`.toLowerCase().includes(p))return!1}return!(e.isInfoOnly!=null&&c.infoOnly!==e.isInfoOnly||e.minAmountToRequest!=null&&c.amountToRequest<e.minAmountToRequest||e.maxAmountToRequest!=null&&c.amountToRequest>e.maxAmountToRequest||(e.dateFrom||e.dateTo)&&!l(c.updatedAt)||e.hasMissingAttachments&&!((u=c.blockingIssueCodesLatest)!=null&&u.includes("MISSING_ATTACHMENT_REQUIRED")))}).sort((c,i)=>new Date(i.updatedAt).getTime()-new Date(c.updatedAt).getTime())},zN=e=>{const t=jt(),s=Object.values(t.sheets),r=new Map;e.forEach(i=>{r.set(i.id,i)});let a=0,o=0,l=0,c=0;return s.forEach(i=>{i.status==="READY_FOR_REPORT"&&(a+=1),i.status==="ATTACHED_TO_REPORT"&&(o+=1);const u=i.attachedToReportId?r.get(i.attachedToReportId):void 0;(u==null?void 0:u.status)==="SENT"&&(l+=1);const p=(u==null?void 0:u.expensesSheetId)===i.id&&u.expensesOutOfSync===!0,y=Object.values(t.auditEvents).some(S=>{var w;return S.sheetId===i.id&&S.eventType==="SHEET_READY_ATTEMPT"&&((w=S.diffJson)==null?void 0:w.success)===!1});(p||y)&&(c+=1)}),{readyCount:a,attachedCount:o,sentCount:l,exceptionsCount:c}},Ic=(e,t)=>{if(!e||!t)return null;const s=new Date(e).getTime(),r=new Date(t).getTime();return Number.isNaN(s)||Number.isNaN(r)?null:(r-s)/(1e3*60*60)},Tc=e=>e.length?e.reduce((s,r)=>s+r,0)/e.length:null,Rc=e=>{if(!e.length)return null;const t=[...e].sort((r,a)=>r-a),s=Math.floor(t.length/2);return t.length%2===0?(t[s-1]+t[s])/2:t[s]},dl=(e,t=5)=>({count:e.length,samples:e.slice(0,t)}),VN=e=>{let t=jt();const s=pa("fexa"),r=fn(),a={id:s,sheetId:e.sheetId,noteType:"EXCEPTION_STATUS",value:e.value,actorUserId:e.actorUserId,createdAt:r};return t={...t,exceptionAnnotations:{...t.exceptionAnnotations,[s]:a}},Sn(t),a},KN=e=>{const t=jt(),s=Object.values(t.exceptionAnnotations).filter(r=>r.sheetId===e&&r.noteType==="EXCEPTION_STATUS");return s.length?(s.sort((r,a)=>new Date(a.createdAt).getTime()-new Date(r.createdAt).getTime()),s[0].value):null},YN=e=>{const t=jt(),s=Object.values(t.sheets),r=new Map;e.forEach(G=>{r.set(G.id,G)});const a=[],o=[],l=[];let c=0,i=0;const u=[],p=[],y=[],S=[],w=3,L=3,k=Date.now(),U=new Map;Object.values(t.auditEvents).forEach(G=>{const le=U.get(G.sheetId)||[];le.push(G),U.set(G.sheetId,le)});const N=[];s.forEach(G=>{const{lineItems:le}=wo(t,G.id),j=Dn(G,le);if(c+=j.amountToRequest,G.infoOnly&&(i+=1),G.createdAt&&G.readyAt){const E=Ic(G.createdAt,G.readyAt);E!=null&&a.push(E)}if(G.readyAt&&G.attachedAt){const E=Ic(G.readyAt,G.attachedAt);E!=null&&o.push(E)}const T=G.attachedToReportId?r.get(G.attachedToReportId):void 0;if(G.attachedAt&&(T!=null&&T.sentAt)){const E=Ic(G.attachedAt,T.sentAt);E!=null&&l.push(E)}j.amountToRequest>0&&N.push(j.amountToRequest)});let x=0;if(N.length>=5){const G=[...N].sort((j,T)=>j-T),le=Math.floor(G.length*.95)-1;x=G[Math.max(0,le)]}else N.length>0&&(x=Math.max(...N));s.forEach(G=>{var ue,xe;const{lineItems:le}=wo(t,G.id),j=Dn(G,le),T=G.attachedToReportId?r.get(G.attachedToReportId):void 0,E=U.get(G.id)||[],C=E.filter(oe=>oe.diffJson&&oe.diffJson.decisionLog);C.sort((oe,fe)=>new Date(fe.eventAt).getTime()-new Date(oe.eventAt).getTime());const se=((xe=(ue=C[0])==null?void 0:ue.diffJson)==null?void 0:xe.decisionLog)||null,Y=se!=null&&se.blockingIssueCodes&&Array.isArray(se.blockingIssueCodes)?se.blockingIssueCodes:[];if((T==null?void 0:T.expensesSheetId)===G.id&&T.expensesOutOfSync===!0){const oe=new Date(G.updatedAt||G.createdAt).getTime();Number.isNaN(oe)||(k-oe)/864e5>=w&&u.push({sheetId:G.id,caseId:G.caseId,reason:"DIVERGENCE_OLD",updatedAt:G.updatedAt})}(G.status==="READY_FOR_REPORT"||G.status==="ATTACHED_TO_REPORT")&&Y.includes("MISSING_ATTACHMENT_REQUIRED")&&j.amountToRequest>0&&p.push({sheetId:G.id,caseId:G.caseId,reason:"MISSING_ATTACHMENTS",updatedAt:G.updatedAt}),x>0&&j.amountToRequest>=x&&y.push({sheetId:G.id,caseId:G.caseId,reason:"HIGH_AMOUNT",updatedAt:G.updatedAt,amountToRequest:j.amountToRequest});const X=E.filter(oe=>{var fe;return oe.eventType==="SHEET_READY_ATTEMPT"&&((fe=oe.diffJson)==null?void 0:fe.success)===!1}).length;X>=L&&S.push({sheetId:G.id,caseId:G.caseId,reason:"REPEATED_BLOCKS",failedAttempts:X,updatedAt:G.updatedAt})});const b=s.length,F=s.filter(G=>{const le=G.attachedToReportId?r.get(G.attachedToReportId):void 0;return(le==null?void 0:le.status)==="SENT"}).length,H=b>0?Number((i/b).toFixed(3)):null,V={draftToReadyAvgHours:Tc(a),draftToReadyMedianHours:Rc(a),readyToAttachedAvgHours:Tc(o),readyToAttachedMedianHours:Rc(o),attachedToSentAvgHours:Tc(l),attachedToSentMedianHours:Rc(l)},q={totalSheets:b,totalSentReports:F,totalAmountRequested:c,infoOnlyRatio:H},te={divergenceOld:dl(u),missingAttachments:dl(p),highAmounts:{threshold:x,...dl(y)},repeatedBlocks:{threshold:L,...dl(S)}};return{sla:V,volumes:q,exceptions:te}},GN=(e,t=10)=>{const s=jt();return Object.values(s.auditEvents).filter(r=>r.sheetId===e).sort((r,a)=>new Date(a.eventAt).getTime()-new Date(r.eventAt).getTime()).slice(0,t)},qN=5e3,Cc=new Map,La=e=>({actorUserId:e.id,actorRole:e.role}),Ye={async listSheets(){return il()},async listPaymentsForCase(e){return TN(e)},getPaidToDateForSheet(e){const t=e.updatedAt||e.createdAt||new Date().toISOString();return jp(e.caseId,t,e.alreadyPaidAmount??0)},async getLatestSheetForCase(e){const t=il(),s=ke(e),a=t.filter(o=>ke(o.caseId)===s).sort((o,l)=>{const c=new Date(o.updatedAt||o.createdAt).getTime();return new Date(l.updatedAt||l.createdAt).getTime()-c})[0];return a?cl(a.id):null},async isNewFinancialModel(e){if(!e)return!1;const t=await il(),s=ke(e);return t.some(r=>ke(r.caseId)===s)},logIfMixedModel(e){if(!!!e.expensesSheetId)return;(e.expensesItems&&e.expensesItems.length>0||!!e.expenseWorksheet||!!e.expensesSum)&&console.error("[FinancialExpenses] Mixed model detected for report",e.id," expensesSheetId is set but legacy expenses fields are also populated.")},async getSheet(e){return cl(e)},async getRulesetForSheet(e){const t=e.insurerRulesetId||e.insurerId||"default",s=DN(t);if(s)return s;const r=new Date().toISOString();return{insurerId:t,policyFamily:"FLEXIBLE",requiredAttachmentTypes:[],requireAttachmentPerLine:!1,requireAttachmentForExpenseTypes:[],amountThresholdRequiringAttachment:null,infoOnlyTextVariant:null,notesInternal:null,rulesetVersion:"default",updatedAt:r}},async createSheet(e,t){const s={...t,createdByUserId:e.id};return LN(s)},async createPaymentEvent(e,t){return RN(t)},async updateSheetMeta(e,t,s){const r={sheetId:t,...La(e),patch:s};return ON(r)},async addLineItem(e,t,s){const r={...s,sheetId:t,...La(e)};return MN(r)},async updateLineItem(e,t,s,r){const a={sheetId:t,lineItemId:s,...La(e),patch:r};return PN(a)},async deleteLineItem(e,t,s){const r={sheetId:t,lineItemId:s,...La(e)};return FN(r)},async softDeletePaymentEvent(e){return CN(e)},buildCumulativeExpensesSnapshot(e,t){const s=`${e}::${t||"now"}`,r=Cc.get(s),a=Date.now();if(r&&a-r.ts<qN)return r.value;const o=cl(e);if(!o)return Cc.set(s,{ts:a,value:null}),null;const l=o.sheet,c=t||l.updatedAt||l.createdAt||new Date().toISOString(),i=jp(l.caseId,c,l.alreadyPaidAmount??0),u={...l,alreadyPaidAmount:i},p=il(),y=ke(l.caseId),S=new Date(c).getTime(),w=p.filter(F=>{if(F.id===l.id||ke(F.caseId)!==y)return!1;const H=new Date(F.updatedAt||F.createdAt).getTime();return Number.isNaN(H)||Number.isNaN(S)?!0:H<=S}),L=[];w.forEach(F=>{const H=cl(F.id);H&&H.lineItems.forEach(V=>{V.kind==="EXPENSE"&&L.push(V)})});const k=o.lineItems,N=[...[...L,...k]].sort((F,H)=>{const V=j=>{const T=j.date?new Date(j.date).getTime():NaN;if(!Number.isNaN(T))return T;const E=j.createdAt?new Date(j.createdAt).getTime():NaN;return Number.isNaN(E)?0:E},q=V(F),te=V(H);if(q!==te)return q-te;const G=`${F.sheetId||""}-${F.id}`,le=`${H.sheetId||""}-${H.id}`;return G.localeCompare(le)}),b={effectiveSheet:u,currentLines:k,historicalLines:L,allLines:N,opts:{isNewLine:F=>F.kind==="EXPENSE"&&F.sheetId===l.id,isHistoricalLine:F=>F.kind==="EXPENSE"&&F.sheetId!==l.id}};return Cc.set(s,{ts:a,value:b}),b},async deleteSheet(e){_N(e)},async addAttachment(e,t,s){const r={...s,sheetId:t,uploadedByUserId:e.id};return BN(r)},async linkAttachmentToLineItem(e,t,s,r){const a={sheetId:t,attachmentId:s,lineItemId:r,...La(e)};return $N(a)},async recordReadyAttempt(e,t){const s={...t,actorUserId:e.id,actorRole:e.role};return HN(s)},async revertSheetToDraft(e,t){return UN({sheetId:t,actorUserId:e.id,actorRole:e.role})},async listSheetsForLidor(e,t,s){if(e.role!=="ADMIN"&&e.role!=="SUB_ADMIN")throw new Error("Access denied: only ADMIN or SUB_ADMIN can view financial control data.");return WN(t,s)},async getLidorCounts(e,t){if(e.role!=="ADMIN"&&e.role!=="SUB_ADMIN")throw new Error("Access denied: only ADMIN or SUB_ADMIN can view financial control data.");return zN(t)},async getLidorKpis(e,t){if(e.role!=="ADMIN"&&e.role!=="SUB_ADMIN")throw new Error("Access denied: only ADMIN or SUB_ADMIN can view financial control data.");return YN(t)},async getExceptionStatusForSheet(e,t){if(e.role!=="ADMIN"&&e.role!=="SUB_ADMIN")throw new Error("Access denied: only ADMIN or SUB_ADMIN can view financial control data.");return KN(t)},async setExceptionStatusForSheet(e,t,s){if(e.role!=="ADMIN"&&e.role!=="SUB_ADMIN")throw new Error("Access denied: only ADMIN or SUB_ADMIN can view financial control data.");return VN({sheetId:t,value:s,actorUserId:e.id})},async getSheetAuditForLidor(e,t,s=10){if(e.role!=="ADMIN"&&e.role!=="SUB_ADMIN")throw new Error("Access denied: only ADMIN or SUB_ADMIN can view financial control data.");return GN(t,s)}},XN={dashboardTitle:" ",brandName:"Lior Perry",brandSubtitle:"  ",welcomeBack:" ",roleLawyer:"",gettingStartedTitle:" ",gettingStartedBodyLine1:"  .",gettingStartedBodyLine2:"   .          .",gettingStartedStep1:"  ",gettingStartedStep2:" ",gettingStartedStep3:"  ",gettingStartedCta:"  ",searchSectionLabel:" ",searchLabel:" ",searchPlaceholder:"  , ,     ...",statusLabel:"",sortByLabel:" ",sortByUpdated:" ",sortByReportDate:" ",sortByInsured:"",onlyMyCases:"  ",clearFilters:" ",searchByOdakanit:"    ",searchOdakanitPlaceholder:"    ...",noCaseFolderFound:"       .",statsSectionLabel:"  ",statsActiveCases:" ",statsActionRequired:"  ",statsWaitingOnOthers:" ",statsFinanceTasks:"  ",statsDraftsReady:" /  ",caseListTitle:"   ",caseListHeaderTitle:" ",caseListHeaderReportNo:"REPORT NO",caseListHeaderPlaintiff:"PLAINTIFF / CLAIMANT",caseListHeaderInsured:"INSURED",caseListHeaderInsurer:"INSURER",caseListHeaderOdakanit:"  ",caseListStatusAttention:"  ",caseListStatusOpen:"  ",caseListStatusNone:"  ",caseListEmpty:"   .",caseListHintActiveOnly:"(     )",financeBannerTitle:"    ",financeBannerBody:"      .         .",bucketActionRequiredTitle:"  ",bucketActionRequiredDescription:"    .",bucketWaitingTitle:" ",bucketWaitingDescription:"   ,     .",bucketInProgressTitle:"",bucketInProgressDescription:"   .",bucketSentTitle:" / ",bucketSentDescription:"     .",emptyActionRequiredTitle:"    ",emptyActionRequiredDesc:"    ,   .",emptyWaitingTitle:"   ",emptyWaitingDesc:"      .",emptyInProgressTitle:"  ",emptyInProgressDesc:"    .",emptySentTitle:"   ",emptySentDesc:"  ,     .",emptyInProgressCta:"  ",defaultEmptyTitle:"  ",defaultEmptyDescription:"     .",untitledCase:"  ",labelInsured:"",labelPlaintiff:"",labelInsurer:" ",labelFile:" ",labelUpdated:":",labelNextStep:" :",nextStepReview:"  ",nextStepWaitingInvoices:" ",nextStepReadyToSend:" ",nextStepDraft:"  ",nextStepSent:"",nextStepContinue:" ",openContinue:" / ",preview:" ",viewSections:"  ",deleteDraftConfirm:"   ?     .",deleteDraftAria:" ",deleteTitle:"",pin:" ",unpin:" ",alertTimeBreach:" ",alertResponseDelay:" ",openNotificationsAria:" ",openNotificationsTitle:"",openNewCaseFolderAria:"  ",openNewCaseFolderTitle:"  ",openHelpCenterAria:"  ",openHelpCenterTitle:" ",logoutAria:"",logoutTitle:"",workQueuesAria:"  ",expand:"",collapse:"",statusDraft:"",statusActionRequired:" ",statusWaitingInvoices:" ",statusPendingReview:" ",statusApproved:"",statusReadyToSend:" ",statusSent:"",densityLabel:" :",densityComfortable:"",densityCompact:"",resumeLastCase:"   ",resumeLabel:"",internalFile:" ",workloadTitle:"  ",workloadActionLabel:"  ",workloadWaitingLabel:"   ",workloadDraftLabel:" ",financeReportsTitle:" /    ",financeReportsHint:"           .",financeReportsHeaderOdakanit:" ",financeReportsHeaderInsured:"",financeReportsHeaderPlaintiff:"",financeReportsHeaderStatus:" ",financeReportsHeaderUpdated:" ",financeReportsEmpty:"     .",focusModeLabel:"    ",tagNewCase:" ",tagOngoingCase:" ",notificationTitle:" ",dailySummary:" ",noNotifications:"  .",clearAll:" ",footerArchiveNote:"      "},Ce=e=>XN[e],Dc=({label:e,value:t,icon:s,accentClass:r,selected:a,onClick:o})=>{const l=n.jsxs("div",{className:["flex items-center justify-between rounded-2xl border px-4 py-3 shadow-sm transition","focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-gold focus-visible:ring-offset-2",a?"border-gold bg-gold/10":"border-borderDark bg-panel hover:bg-navySecondary"].join(" "),children:[n.jsxs("div",{children:[n.jsx("p",{className:["text-[11px] uppercase tracking-wide",a?"font-bold text-textLight":"font-semibold text-textMuted"].join(" "),children:e}),n.jsx("p",{className:"mt-1 text-xl font-bold text-gray-900",children:t})]}),n.jsx("div",{className:["inline-flex h-9 w-9 items-center justify-center rounded-full",r].join(" "),"aria-hidden":"true",children:s})]});return o?n.jsx("button",{type:"button",onClick:o,className:"w-full text-left",children:l}):l},JN=({activeCases:e,actionRequired:t,waitingOnOthers:s,draftsAndReady:r,financeTasks:a,selectedFilter:o,onChangeFilter:l})=>{const c=i=>{l&&l(o===i?null:i)};return n.jsxs("section",{"aria-label":Ce("statsSectionLabel"),className:"mb-6 grid gap-4 grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-3 xl:grid-cols-3",children:[n.jsx(Dc,{label:Ce("statsFinanceTasks"),value:a,icon:n.jsx(D0,{className:"h-4 w-4 text-goldLight"}),accentClass:"bg-gold/20",selected:o==="FINANCE",onClick:()=>c("FINANCE")}),n.jsx(Dc,{label:Ce("statsWaitingOnOthers"),value:s,icon:n.jsx(R0,{className:"h-4 w-4 text-goldLight"}),accentClass:"bg-gold/20",selected:o==="WAITING",onClick:()=>c("WAITING")}),n.jsx(Dc,{label:Ce("statsDraftsReady"),value:r,icon:n.jsx(Zl,{className:"h-4 w-4 text-goldLight"}),accentClass:"bg-gold/20",selected:o==="DRAFTS",onClick:()=>c("DRAFTS")})]})};Ce("statusDraft"),Ce("statusActionRequired"),Ce("statusWaitingInvoices"),Ce("statusPendingReview"),Ce("statusApproved"),Ce("statusReadyToSend"),Ce("statusSent");const _a=e=>(e||"").trim().toLowerCase(),Lc=e=>{const t=(e.odakanitNo||"").trim();if(t)return`odakanit:${t}`;const s=[`umr:${_a(e.marketRef)}`,`line:${_a(e.lineSlipNo)}`,`cert:${_a(e.certificateRef)}`,`insured:${_a(e.insuredName)}`,`plaintiff:${_a(e.plaintiffName)}`].filter(r=>!r.endsWith(":"));return s.length?s.join("|"):`id:${e.id}`},QN=24*60*60*1e3,ZN=e=>{const t=e.updatedAt||e.reportDate;if(!t)return null;const s=new Date(t).getTime();return Number.isFinite(s)?s:null},eb=e=>{const t=ZN(e);return!t||(Date.now()-t)/QN<=3?null:e.status==="DRAFT"?Ce("alertResponseDelay"):e.status==="WAITING_FOR_INVOICES"||e.status==="READY_TO_SEND"?Ce("alertTimeBreach"):null},tb=e=>e.status==="TASK_ASSIGNED"||e.status==="PENDING_REVIEW"||e.status==="READY_TO_SEND",nb=({report:e})=>e.expensesSheetId?e.supersededByReportId?n.jsx("span",{className:"inline-flex items-center rounded-full bg-slate-100 px-1.5 py-0.5 text-[9px] font-semibold text-slate-700 border border-slate-200",title:"        ",children:""}):n.jsx("span",{className:"inline-flex items-center rounded-full bg-emerald-50 px-1.5 py-0.5 text-[9px] font-semibold text-emerald-800 border border-emerald-200",title:"      ",children:" ()"}):null,sb=Ce("brandName"),rb=Ce("brandSubtitle"),ab={DRAFT:Ce("statusDraft"),TASK_ASSIGNED:Ce("statusActionRequired"),WAITING_FOR_INVOICES:Ce("statusWaitingInvoices"),PENDING_REVIEW:Ce("statusPendingReview"),APPROVED:Ce("statusApproved"),READY_TO_SEND:Ce("statusReadyToSend"),SENT:Ce("statusSent")},Ep=e=>e==="TASK_ASSIGNED"||e==="PENDING_REVIEW"?"ACTION_REQUIRED":e==="WAITING_FOR_INVOICES"?"WAITING_ON_OTHERS":e==="READY_TO_SEND"?"IN_PROGRESS":e==="SENT"?"SENT_COMPLETED":"IN_PROGRESS",_c=e=>`lp_pins:${e}`,ob=e=>`lp_dashboard_density:${e}`,lb="lp_current_report",kp=e=>`lp_pins_migrated:${e}`,ib=({user:e,reports:t,caseFolders:s,notifications:r,showNotifications:a,setShowNotifications:o,onClearNotifications:l,dailySummaryOptIn:c,setDailySummaryOptIn:i,archiveAfterMs:u,onSelectReport:p,onNewReport:y,onOpenCaseFolder:S,onLogout:w,deleteReportById:L})=>{const[k,U]=g.useState(""),[N,x]=g.useState("ALL"),[b,F]=g.useState(!0),[H,V]=g.useState(null),[q,te]=g.useState("UPDATED"),[G,le]=g.useState(()=>{if(typeof window>"u")return[];try{const Q=window.localStorage.getItem(_c(e.id)),ye=Q?JSON.parse(Q):[];return Array.isArray(ye)?ye.filter(_=>typeof _=="string"):[]}catch{return[]}}),[j,T]=g.useState(()=>{if(typeof window>"u")return"COMFORTABLE";try{return window.localStorage.getItem(ob(e.id))==="COMPACT"?"COMPACT":"COMFORTABLE"}catch{return"COMFORTABLE"}}),E=Date.now(),C=u??Number.MAX_SAFE_INTEGER,[se,Y]=g.useState(!1),[O,P]=g.useState({}),X=g.useMemo(()=>r.filter(ye=>!ye.targetUserId||ye.targetUserId===e.id).filter(ye=>{if(!ye.reportId)return!0;const _=t.find(W=>W.id===ye.reportId);return _?_.status!=="SENT":!0}),[r,e.id,t]),ue=g.useMemo(()=>X.filter(Q=>{if(!Q.reportId)return!1;const ye=t.find(_=>_.id===Q.reportId);return!(!ye||!ye.expensesSheetId||ye.status==="SENT")}).length,[X,t]),{mine:xe,buckets:oe,filteredReports:fe}=g.useMemo(()=>{const Q=t.filter(Se=>{if(Se.deletedAt)return!1;const Ee=(Se.odakanitNo||"").trim();if(!Ee)return!0;const Me=s[Ee];return!(Me&&Me.closedAt)}),ye=Q.filter(Se=>Se.createdBy===e.id),_=b?ye:Q,W=N==="ALL"?_:_.filter(Se=>Se.status===N),de=H==="FINANCE"?W.filter(Se=>!!Se.expensesSheetId):W,ce=(()=>{const Se=k.trim().toLowerCase();return Se?de.filter(Ee=>[Ee.odakanitNo,Ee.insuredName,Ee.plaintiffName,Ee.insurerName,Ee.marketRef].filter(Boolean).join(" ").toLowerCase().includes(Se)):de})(),ne=se?ce.filter(Se=>tb(Se)||!!eb(Se)):ce,ge={ACTION_REQUIRED:[],WAITING_ON_OTHERS:[],IN_PROGRESS:[],SENT_COMPLETED:[]};return ne.forEach(Se=>{const Ee=Ep(Se.status);ge[Ee].push(Se)}),{mine:ye,buckets:ge,filteredReports:ne}},[t,s,e.id,k,N,b,se,E,C,H]),ve=g.useMemo(()=>{const Q=new Set;let ye=0,_=0,W=0,de=0;return xe.forEach(ce=>{ce.status!=="SENT"&&(_+=1,Q.add(Lc(ce))),Ep(ce.status)==="ACTION_REQUIRED"&&(ye+=1),ce.status==="READY_TO_SEND"&&(W+=1),ce.expensesSheetId&&ce.status!=="SENT"&&(de+=1)}),{activeCasesCount:Q.size,actionRequiredCount:ye,draftsInWorkCount:_,readyToSendCount:W,financeTasksCount:de}},[xe]),{activeCasesCount:_e,actionRequiredCount:ze,draftsInWorkCount:qe,readyToSendCount:$e,financeTasksCount:st}=ve,Je=g.useMemo(()=>xe.filter(Q=>Q.status==="WAITING_FOR_INVOICES").length,[xe]),J=xe.filter(Q=>!!Q.expensesSheetId&&Q.status!=="SENT");g.useEffect(()=>{const ye=Array.from(new Set(J.map(_=>_.expensesSheetId).filter(_=>!!_))).filter(_=>!O[_]);ye.length&&ye.forEach(_=>{(async()=>{try{const W=await Ye.getSheet(_);if(!W)return;const de=Dn(W.sheet,W.lineItems);P(ce=>({...ce,[_]:de}))}catch{}})()})},[J,O]);const re=g.useMemo(()=>{const Q=new Map,ye=W=>{const de=ei(W);if(!de)return"";const ce=de.split(" - ");return ce.length<=2?de:ce[ce.length-2]||de};return xe.forEach(W=>{if(!W.odakanitNo)return;const de=W.odakanitNo.trim();if(!de)return;const ce=Q.get(de)||{odakanitNo:de,insuredName:W.insuredName||void 0,plaintiffName:W.plaintiffName||void 0,insurerName:W.insurerName||void 0,latestUpdatedAt:null,latestReportTitle:void 0,latestReportNumber:void 0,nextReportNumber:void 0,hasOpenWork:!1,hasUrgentWork:!1},ne=W.updatedAt||W.reportDate,ge=ne&&new Date(ne).getTime()||0,Se=ce.latestUpdatedAt&&new Date(ce.latestUpdatedAt).getTime()||0;ge>=Se&&(ce.latestUpdatedAt=ne||ce.latestUpdatedAt||null,ce.insuredName=W.insuredName||ce.insuredName,ce.plaintiffName=W.plaintiffName||ce.plaintiffName,ce.insurerName=W.insurerName||ce.insurerName,ce.latestReportTitle=ye(W)),W.status!=="SENT"&&!W.deletedAt&&(ce.hasOpenWork=!0),(W.status==="TASK_ASSIGNED"||W.status==="WAITING_FOR_INVOICES"||W.status==="PENDING_REVIEW"||W.status==="READY_TO_SEND")&&(ce.hasUrgentWork=!0),Q.set(de,ce)}),Array.from(Q.values()).map(W=>{var Se;const de=W.odakanitNo.trim(),ce=[],ne=s[de];(Se=ne==null?void 0:ne.sentReports)!=null&&Se.length&&ne.sentReports.forEach(Ee=>{typeof Ee.reportNo=="number"&&Ee.reportNo>0&&ce.push(Ee.reportNo)}),t.forEach(Ee=>{var Me;if((Ee.odakanitNo||"").trim()===de&&Ee.status==="SENT")if(typeof Ee.reportNumber=="number"&&Ee.reportNumber>0)ce.push(Ee.reportNumber);else{const Qe=(((Me=Ee.reportHistory)==null?void 0:Me.length)||0)+1;ce.push(Qe)}});const ge=ce.length?Math.max(...ce):0;return{...W,latestReportNumber:ge||void 0,nextReportNumber:(ge||0)+1}}).sort((W,de)=>{const ce=W.latestUpdatedAt&&new Date(W.latestUpdatedAt).getTime()||0;return(de.latestUpdatedAt&&new Date(de.latestUpdatedAt).getTime()||0)-ce})},[xe]);g.useMemo(()=>new Set(G),[G]);const D=Q=>{p(Q.id)},ae=Q=>{const ye=H===Q?null:Q;switch(V(ye),ye){case"ACTION":x("TASK_ASSIGNED");break;case"WAITING":x("WAITING_FOR_INVOICES");break;case"DRAFTS":x("READY_TO_SEND");break;case"FINANCE":x("ALL");break;case"ACTIVE":x("ALL");break;default:x("ALL");break}};N!=="ALL"||k.trim(),g.useEffect(()=>{if(!a)return;const Q=ye=>{ye.key==="Escape"&&o(!1)};return window.addEventListener("keydown",Q),()=>window.removeEventListener("keydown",Q)},[a,o]),g.useEffect(()=>{if(typeof window>"u"||!t.length)return;const Q=kp(e.id);if(window.localStorage.getItem(Q)!=="1")try{const _=window.localStorage.getItem(_c(e.id));if(!_){window.localStorage.setItem(Q,"1");return}const W=JSON.parse(_);if(!Array.isArray(W)){window.localStorage.setItem(Q,"1");return}const de=[],ce=ne=>{ne&&(de.includes(ne)||de.push(ne))};W.forEach(ne=>{if(typeof ne!="string")return;const ge=ne.trim();if(!ge)return;const Se=ge.toLowerCase();if(Se.startsWith("odakanit:")||Se.startsWith("umr:")||Se.startsWith("line:")||Se.startsWith("cert:")||Se.startsWith("insured:")||Se.startsWith("plaintiff:")||Se.startsWith("id:")){ce(ge);return}const Me=t.find(Qe=>Lc(Qe)===ge?!0:Qe.id===ge||Qe.odakanitNo&&Qe.odakanitNo===ge||Qe.marketRef&&Qe.marketRef===ge);ce(Me?Lc(Me):`odakanit:${ge}`)}),le(de),window.localStorage.setItem(_c(e.id),JSON.stringify(de)),window.localStorage.setItem(Q,"1")}catch{window.localStorage.setItem(kp(e.id),"1")}},[t,e.id]),g.useMemo(()=>{if(!xe.length)return null;if(typeof window<"u")try{const ye=window.localStorage.getItem(lb),_=ye?xe.find(W=>W.id===ye&&!W.deletedAt):null;if(_)return _}catch{}return[...xe].sort((ye,_)=>{const W=ne=>{const ge=ne.updatedAt||ne.reportDate;return ge&&new Date(ge).getTime()||0},de=W(ye);return W(_)-de})[0]||null},[xe]);const ee=()=>n.jsxs("div",{className:"relative",children:[n.jsxs("button",{type:"button",onClick:()=>o(!a),className:"relative inline-flex h-9 w-9 items-center justify-center rounded-full bg-gold/10 text-xs font-medium text-blue-700 hover:bg-blue-100 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-lpBlue focus-visible:ring-offset-2","aria-label":Ce("openNotificationsAria"),title:Ce("openNotificationsTitle"),children:[n.jsx(Jl,{className:"h-4 w-4","aria-hidden":"true"}),ue>0&&n.jsx("span",{className:"absolute -top-1.5 -right-1.5 inline-flex h-4 min-w-[16px] items-center justify-center rounded-full bg-red-500 px-1 text-[10px] font-bold text-white",children:ue})]}),a&&n.jsxs("div",{className:"absolute right-0 mt-2 w-80 rounded-lg border border-borderDark bg-panel text-xs shadow-xl z-50",children:[n.jsxs("div",{className:"flex items-center justify-between border-b px-3 py-2",children:[n.jsx("span",{className:"font-semibold text-textLight",children:Ce("notificationTitle")}),n.jsxs("label",{className:"flex items-center gap-1 text-[11px] text-textMuted",children:[n.jsx("input",{type:"checkbox",checked:c,onChange:Q=>i(Q.target.checked),className:"h-3 w-3 rounded border-borderDark text-gold focus:ring-gold"}),Ce("dailySummary")]})]}),n.jsxs("div",{className:"max-h-64 overflow-auto divide-y",children:[X.length===0&&n.jsx("div",{className:"p-4 text-center text-textMuted",children:Ce("noNotifications")}),X.map(Q=>n.jsxs("div",{className:"p-3 space-y-1",children:[n.jsx("p",{className:"font-medium text-textLight",children:Q.message}),n.jsx("p",{className:"text-[10px] text-textMuted",children:new Date(Q.createdAt).toLocaleString()}),Q.reportId&&n.jsx("button",{type:"button",className:"mt-1 text-[11px] text-blue-700 hover:underline",onClick:()=>{p(Q.reportId),o(!1)},children:' " '})]},Q.id))]}),n.jsx("div",{className:"px-3 py-2 text-right",children:n.jsx("button",{type:"button",onClick:l,className:"text-[11px] font-medium text-red-500 hover:underline",children:Ce("clearAll")})})]})]}),[be,Oe]=g.useState(""),[Ae,Re]=g.useState(!1),[Ge,He]=g.useState(-1),Pe=g.useMemo(()=>{const Q=be.trim();if(!Q)return[];const ye=Q.toLowerCase(),_=Object.values(s),W=_.filter(ne=>ne.odakanitNo.toLowerCase().startsWith(ye)),de=_.filter(ne=>!ne.odakanitNo.toLowerCase().startsWith(ye)&&ne.odakanitNo.toLowerCase().includes(ye));return[...W,...de].slice(0,8).map(ne=>({odakanitNo:ne.odakanitNo,insuredName:ne.insuredName,plaintiffName:ne.plaintiffName}))},[be,s]);return g.useEffect(()=>{if(!be.trim()){Re(!1),He(-1);return}Pe.length>0?(Re(!0),He(0)):(Re(!1),He(-1))},[be,Pe.length]),n.jsx("div",{className:"min-h-screen bg-navySecondary px-0 pb-6 text-[15px]",dir:"rtl",lang:"he",children:n.jsxs("div",{className:"w-full px-6 md:px-8 lg:px-10 xl:px-12",children:[n.jsxs("header",{className:"sticky top-0 z-20 mb-4 flex flex-col gap-3 border-b border-borderDark bg-panel/80 pb-3 pt-2 backdrop-blur-sm md:flex-row md:items-center md:justify-between",children:[n.jsxs("div",{children:[n.jsx("h1",{className:"text-2xl font-bold text-gold font-heebo",children:Ce("dashboardTitle")}),n.jsxs("p",{className:"text-base text-textMuted text-right",children:[n.jsx("span",{className:"font-semibold",children:sb})," ",n.jsx("span",{className:"text-textMuted",children:rb}),n.jsx("span",{className:"text-textMuted",children:"  "}),Ce("welcomeBack"),","," ",n.jsx("span",{className:"font-semibold",children:e.name})," ",n.jsxs("span",{className:"text-textMuted",children:["(",Ce("roleLawyer"),")"]})]})]}),n.jsxs("div",{className:"flex flex-wrap items-center justify-start gap-2 md:justify-end",children:[n.jsx("button",{type:"button",onClick:y,className:"inline-flex h-9 w-9 items-center justify-center rounded-full bg-lpBlue text-sm font-semibold text-white shadow-sm hover:bg-blue-900 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-lpBlue focus-visible:ring-offset-2","aria-label":Ce("openNewCaseFolderAria"),title:Ce("openNewCaseFolderTitle"),children:n.jsx(_u,{className:"h-4 w-4","aria-hidden":"true"})}),ee(),n.jsx("button",{type:"button",className:"inline-flex h-9 w-9 items-center justify-center rounded-full bg-gold/10 text-sm font-medium text-blue-700 hover:bg-blue-100 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-lpBlue focus-visible:ring-offset-2",onClick:()=>{const Q=new CustomEvent("openUserGuide");window.dispatchEvent(Q)},"aria-label":Ce("openHelpCenterAria"),title:Ce("openHelpCenterTitle"),children:n.jsx(Cu,{className:"h-4 w-4","aria-hidden":"true"})}),n.jsx("button",{type:"button",onClick:w,className:"inline-flex h-9 w-9 items-center justify-center rounded-full text-sm font-semibold text-red-600 hover:bg-red-50 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-red-500 focus-visible:ring-offset-2","aria-label":Ce("logoutAria"),title:Ce("logoutTitle"),children:n.jsx(ch,{className:"h-4 w-4","aria-hidden":"true"})})]})]}),!1,n.jsxs("section",{className:"mb-3 rounded-2xl border border-borderDark bg-panel px-4 py-3 text-xs text-textLight shadow-sm",children:[n.jsx("h2",{className:"mb-1 text-sm font-semibold text-textLight",children:Ce("workloadTitle")}),n.jsxs("div",{className:"flex flex-wrap gap-3 text-[11px] text-textLight mb-2",children:[n.jsxs("span",{children:[st," ",Ce("statsFinanceTasks")]}),n.jsxs("span",{children:[Je," ",Ce("statsWaitingOnOthers")]}),n.jsxs("span",{children:[$e," ",Ce("statsDraftsReady")]})]}),n.jsx("div",{className:"max-h-40 overflow-y-auto rounded-xl border border-dashed border-borderDark bg-navySecondary px-3 py-2",children:xe.filter(Q=>Q.status!=="SENT").length===0?n.jsx("p",{className:"text-[11px] text-textMuted",children:Ce("emptyInProgressTitle")}):n.jsx("ul",{className:"space-y-1 text-[11px]",children:xe.filter(Q=>Q.status!=="SENT").sort((Q,ye)=>{const _=W=>{const de=W.updatedAt||W.reportDate;return de&&new Date(de).getTime()||0};return _(ye)-_(Q)}).map(Q=>n.jsxs("li",{className:"flex items-center justify-between gap-2 border-b border-borderDark/70 pb-1 last:border-b-0",children:[n.jsxs("button",{type:"button",onClick:()=>D(Q),className:"flex-1 text-right hover:text-gold",children:[n.jsx("span",{className:"font-semibold",children:Q.insuredName||Q.plaintiffName||Ce("untitledCase")}),Q.odakanitNo&&n.jsxs("span",{className:"text-textMuted",children:["  ",Q.odakanitNo]})]}),n.jsxs("span",{className:"whitespace-nowrap text-[10px] text-textMuted flex items-center gap-1",children:[n.jsx("span",{children:ab[Q.status]}),n.jsx(nb,{report:Q})]})]},Q.id))})})]}),!1,n.jsxs("section",{className:"mb-3 rounded-2xl border border-borderDark bg-panel px-4 py-3 text-xs text-textLight shadow-sm",children:[n.jsxs("div",{className:"flex items-center justify-between mb-2",children:[n.jsx("h2",{className:"text-sm font-semibold text-textLight",children:Ce("caseListTitle")}),n.jsxs("span",{className:"text-[11px] text-textMuted",children:[re.length," ",Ce("statsActiveCases")]})]}),n.jsx("p",{className:"mb-2 text-[11px] text-textMuted",children:Ce("caseListHintActiveOnly")}),re.length===0?n.jsx("p",{className:"text-[11px] text-textMuted",children:Ce("caseListEmpty")}):n.jsx("div",{className:"overflow-x-auto",children:n.jsxs("table",{className:"min-w-full table-fixed text-[11px]",children:[n.jsx("thead",{children:n.jsxs("tr",{className:"border-b border-borderDark bg-navySecondary",children:[n.jsx("th",{className:"px-2 py-1 text-right font-semibold w-32",children:Ce("caseListHeaderOdakanit")}),n.jsx("th",{className:"px-2 py-1 text-right font-semibold w-40",children:Ce("caseListHeaderInsurer")}),n.jsx("th",{className:"px-2 py-1 text-right font-semibold w-40",children:Ce("caseListHeaderInsured")}),n.jsx("th",{className:"px-2 py-1 text-right font-semibold w-40",children:Ce("caseListHeaderPlaintiff")}),n.jsx("th",{className:"px-2 py-1 text-right font-semibold w-20",children:Ce("caseListHeaderReportNo")}),n.jsx("th",{className:"px-2 py-1 text-right font-semibold w-20",children:Ce("caseListHeaderNextReportNo")??"Next report"})]})}),n.jsx("tbody",{children:re.map((Q,ye)=>{const _=Q.hasUrgentWork,W=Q.hasOpenWork,de=ye%2===0?"bg-panel":"bg-navySecondary",ce=_?"border-l-4 border-red-400 bg-red-50/80":W?"border-l-4 border-amber-300 bg-amber-50/70":"border-l border-transparent";return n.jsxs("tr",{className:`cursor-pointer border-b border-borderDark ${de} ${ce}`,onClick:()=>S(Q.odakanitNo),children:[n.jsx("td",{className:"px-2 py-1 text-right font-mono text-[11px]",children:n.jsx("button",{type:"button",className:"text-gold hover:underline",onClick:()=>S(Q.odakanitNo),children:Q.odakanitNo})}),n.jsx("td",{className:"px-2 py-1 text-right",children:Q.insurerName||""}),n.jsx("td",{className:"px-2 py-1 text-right",children:Q.insuredName||""}),n.jsx("td",{className:"px-2 py-1 text-right",children:Q.plaintiffName||""}),n.jsx("td",{className:"px-2 py-1 text-right font-mono text-[11px]",children:Q.latestReportNumber??""}),n.jsx("td",{className:"px-2 py-1 text-right font-mono text-[11px]",children:Q.nextReportNumber??(Q.latestReportNumber||0)+1})]},Q.odakanitNo)})})]})})]}),!1,!1,n.jsx(JN,{activeCases:_e,actionRequired:ze,waitingOnOthers:Je,draftsAndReady:$e,financeTasks:st,selectedFilter:H,onChangeFilter:ae}),n.jsxs("section",{className:"mb-3 rounded-2xl border border-emerald-100 bg-panel px-4 py-3 text-xs text-textLight shadow-sm",children:[n.jsxs("div",{className:"flex items-center justify-between mb-2",children:[n.jsx("h2",{className:"text-sm font-semibold text-textLight",children:Ce("financeReportsTitle")}),n.jsx("span",{className:"text-[11px] text-textMuted",children:st})]}),n.jsx("p",{className:"mb-2 text-[11px] text-textMuted",children:Ce("financeReportsHint")}),J.length===0?n.jsx("p",{className:"text-[11px] text-textMuted",children:Ce("financeReportsEmpty")}):n.jsx("div",{className:"overflow-x-auto",children:n.jsxs("table",{className:"min-w-full table-fixed text-[11px]",children:[n.jsx("thead",{children:n.jsxs("tr",{className:"border-b border-borderDark bg-navySecondary",children:[n.jsx("th",{className:"px-2 py-1 text-right font-semibold w-48",children:Ce("caseListHeaderTitle")}),n.jsx("th",{className:"px-2 py-1 text-right font-semibold w-20",children:Ce("caseListHeaderReportNo")}),n.jsx("th",{className:"px-2 py-1 text-right font-semibold w-40",children:Ce("caseListHeaderPlaintiff")}),n.jsx("th",{className:"px-2 py-1 text-right font-semibold w-40",children:Ce("caseListHeaderInsured")}),n.jsx("th",{className:"px-2 py-1 text-right font-semibold w-40",children:Ce("caseListHeaderInsurer")}),n.jsx("th",{className:"px-2 py-1 text-right font-semibold w-32",children:Ce("caseListHeaderOdakanit")})]})}),n.jsx("tbody",{children:J.slice().sort((Q,ye)=>{const _=W=>{const de=W.updatedAt||W.reportDate;return de&&new Date(de).getTime()||0};return _(ye)-_(Q)}).map(Q=>{var ce;const ye=ei(Q),_=ye.split(" - "),W=_.length>2&&_[_.length-2]||ye,de=(((ce=Q.reportHistory)==null?void 0:ce.length)||0)+1;return n.jsxs("tr",{className:"cursor-pointer border-b border-borderDark hover:bg-emerald-50/60",onClick:()=>{Q.odakanitNo?S(Q.odakanitNo):D(Q)},children:[n.jsxs("td",{className:"px-2 py-1 text-right",children:[n.jsx("div",{className:"font-semibold text-textLight",children:W||""}),Q.updatedAt&&n.jsx("div",{className:"text-[10px] text-textMuted",children:new Date(Q.updatedAt).toLocaleString("he-IL")})]}),n.jsx("td",{className:"px-2 py-1 text-right font-mono text-[11px]",children:de}),n.jsx("td",{className:"px-2 py-1 text-right",children:Q.plaintiffName||""}),n.jsx("td",{className:"px-2 py-1 text-right",children:Q.insuredName||""}),n.jsx("td",{className:"px-2 py-1 text-right",children:Q.insurerName||""}),n.jsx("td",{className:"px-2 py-1 text-right font-mono text-[11px]",children:Q.odakanitNo||""})]},Q.id)})})]})})]}),!1]})})},cb="modulepreload",db=function(e){return"/"+e},Ap={},ub=function(t,s,r){let a=Promise.resolve();if(s&&s.length>0){document.getElementsByTagName("link");const l=document.querySelector("meta[property=csp-nonce]"),c=(l==null?void 0:l.nonce)||(l==null?void 0:l.getAttribute("nonce"));a=Promise.allSettled(s.map(i=>{if(i=db(i),i in Ap)return;Ap[i]=!0;const u=i.endsWith(".css"),p=u?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${i}"]${p}`))return;const y=document.createElement("link");if(y.rel=u?"stylesheet":cb,u||(y.as="script"),y.crossOrigin="",y.href=i,c&&y.setAttribute("nonce",c),document.head.appendChild(y),u)return new Promise((S,w)=>{y.addEventListener("load",S),y.addEventListener("error",()=>w(new Error(`Unable to preload CSS for ${i}`)))})}))}function o(l){const c=new Event("vite:preloadError",{cancelable:!0});if(c.payload=l,window.dispatchEvent(c),!c.defaultPrevented)throw l}return a.then(l=>{for(const c of l||[])c.status==="rejected"&&o(c.reason);return t().catch(o)})},mb={:"January",:"February",:"March",:"April",:"May",:"June",:"July",:"August",:"September",:"October",:"November",:"December"},pb=e=>{let t=e.trim();return t=t.replace(/Reporl/gi,"Report"),t=t.replace(/Rep0rt/gi,"Report"),t=t.replace(/Repcrt/gi,"Report"),t=t.replace(/\s+/g," "),t},fb=e=>{try{let t=e;Object.entries(mb).forEach(([r,a])=>{const o=new RegExp(r,"gi");t=t.replace(o,a)});const s=new Date(t);return Number.isNaN(s.getTime())?void 0:s.toISOString().slice(0,10)}catch{return}};async function xb(e){var t,s,r;try{const o=await(await ub(()=>import("./index-zB1IR0FC.js").then(k=>k.i),[])).recognize(e,"eng+heb",{logger:()=>{}}),l=((t=o==null?void 0:o.data)==null?void 0:t.lines)||((r=(s=o==null?void 0:o.data)==null?void 0:s.text)==null?void 0:r.split(/\r?\n/).filter(k=>k.trim().length>0).map(k=>({text:k})))||[],c=[],i={},u="(January|February|March|April|May|June|July|August|September|October|November|December||||||||||||)",p=new RegExp(`Report\\s*(\\d+)\\s*-\\s*(.*?),\\s*(${u}\\s+\\d{1,2},\\s*\\d{4})\\.?$`,"i"),y=/^\s*(Line\s*Slip\s*No\.?|LineSlip\s*No\.?)\s*[:\-]?\s*(.+)\s*$/i,S=/^\s*Unique\s+Market\s+Ref\.?\s*[:\-]?\s*(.+)\s*$/i,w=/^\s*Insured\s*[:\-]?\s*(.+)\s*$/i,L=/^\s*(Plaintiff|Claimant)\s*[:\-]?\s*(.+)\s*$/i;return l.forEach(k=>{const U=k.text||"";if(!U.trim())return;const N=pb(U),x=N.match(p);if(x){const q=Number.parseInt(x[1],10),te=(x[2]||"").trim().replace(/[.,]\s*$/,""),G=x[3]||"",le=fb(G);if(!q||!le||!te||te.length<2)return;c.push({reportNo:q,title:te,sentAt:le,rawLine:U,confidence:typeof k.confidence=="number"?Math.round(k.confidence):void 0});return}const b=N.match(y);b&&!i.lineSlipNo&&(i.lineSlipNo=b[2].trim());const F=N.match(S);F&&!i.marketRef&&(i.marketRef=F[1].trim());const H=N.match(w);H&&!i.insuredName&&(i.insuredName=H[1].trim());const V=N.match(L);V&&!i.plaintiffOrClaimant&&(i.plaintiffOrClaimant=V[2].trim())}),c.sort((k,U)=>(k.reportNo||0)-(U.reportNo||0)),{previousReports:c,identifiers:i}}catch(a){return console.error("OCR failed",a),{previousReports:[],identifiers:{}}}}const Ip="seedShortcutsStickerCollapsed_v1",hb=()=>{const[e,t]=g.useState(()=>{if(typeof window>"u")return!1;try{return window.localStorage.getItem(Ip)==="1"}catch{return!1}});return g.useEffect(()=>{if(!(typeof window>"u"))try{window.localStorage.setItem(Ip,e?"1":"0")}catch{}},[e]),n.jsx("div",{className:"fixed bottom-4 right-4 z-[260] max-w-xs text-[11px] text-slate-800",style:{pointerEvents:"none"},children:n.jsxs("div",{className:"rounded-xl shadow-lg border border-amber-200 bg-amber-50/95 px-3 py-2",style:{pointerEvents:"auto"},children:[n.jsxs("div",{className:"flex items-center justify-between gap-2 mb-1",children:[n.jsxs("div",{className:"font-semibold flex items-center gap-1",children:[n.jsx("span",{children:""}),n.jsx("span",{children:"Shortcuts"})]}),n.jsx("button",{type:"button",className:"text-[10px] text-slate-600 hover:text-slate-900",onClick:()=>t(s=>!s),children:e?"+":""})]}),!e&&n.jsxs("div",{className:"space-y-1",children:[n.jsx("div",{className:"font-semibold text-[10px] text-slate-700",children:"Screenshot"}),n.jsxs("ul",{className:"space-y-0.5",children:[n.jsx("li",{children:"Ctrl /  + V  Paste screenshot"}),n.jsx("li",{children:"Ctrl /  + Shift + O  Run OCR"})]}),n.jsx("div",{className:"font-semibold text-[10px] text-slate-700 mt-1",children:"Reports table"}),n.jsxs("ul",{className:"space-y-0.5",children:[n.jsx("li",{children:"Enter  Next field"}),n.jsx("li",{children:"Shift + Enter  New report row (below)"}),n.jsx("li",{children:"Ctrl /  + Enter  New report row"})]}),n.jsx("div",{className:"font-semibold text-[10px] text-slate-700 mt-1",children:"Apply"}),n.jsx("ul",{className:"space-y-0.5",children:n.jsx("li",{children:"Ctrl /  + S  Approve & Apply"})}),n.jsx("div",{className:"font-semibold text-[10px] text-slate-700 mt-1",children:"Navigation"}),n.jsx("ul",{className:"space-y-0.5",children:n.jsx("li",{children:"Ctrl + Alt +  /   Previous / Next case"})}),n.jsx("div",{className:"text-[9px] text-slate-500 mt-1",children:"Shortcuts work only in this screen."})]})]})})},Vu="seedDraftCases_v1",Ch="seedDraftFinalized_v1",gb=7,yb=e=>e.replace(/^\uFEFF/,"").trim().toLowerCase().replace(/[\s_]+/g,"").replace(/[^a-z0-9]/g,""),Tp=(e,t)=>{const s=[];let r="",a=!1;for(let o=0;o<e.length;o+=1){const l=e[o];if(l==='"'){a&&e[o+1]==='"'?(r+='"',o+=1):a=!a;continue}if(l===t&&!a){s.push(r),r="";continue}r+=l}return s.push(r),s.map(o=>o.trim())},Nb=e=>{const s=e.split(/\r?\n/).map(L=>L.trim()).filter(L=>L.length>0);if(!s.length)return{drafts:[],error:" CSV .         ."};const r=s[0].replace(/^\uFEFF/,""),a=(r.match(/,/g)||[]).length,o=(r.match(/;/g)||[]).length,l=r.includes("	"),c=o>a?";":a>0?",":l?"	":",",i=Tp(r,c);if(!i.length)return{drafts:[],error:"  CSV  .    : odakanitNo,assignedLawyer"};const u=i.map(L=>yb(L)),p=u.findIndex(L=>L==="odakanitno"),y=u.findIndex(L=>L==="assignedlawyer");if(p<0||y<0)return{drafts:[],error:`   .       : odakanitNo,assignedLawyer ( ). :
odakanitNo,assignedLawyer`};const S=[],w=new Set;for(let L=1;L<s.length;L+=1){const k=s[L];if(!k)continue;const U=Tp(k,c),N=U[p]||"",x=ke(N);if(!x||w.has(x))continue;w.add(x);const b=(U[y]||"").trim();if(!b)return{drafts:[],error:` ${L+1}  AssignedLawyer   ${x}.    /  .`,delimiter:c};const F=b.toLowerCase();if(!vs.find(V=>V.id.toLowerCase()===F||V.username.toLowerCase()===F)){const V=vs.map(q=>`${q.username} (id: ${q.id})`).join(", ");return{drafts:[],error:` ${L+1}  AssignedLawyer="${b}"   ${x}     .
       (id)    .
  : ${V}`,delimiter:c}}S.push({odakanitNo:x,assignedLawyer:b,reports:[],status:"MISSING_HISTORY"})}return S.length?{drafts:S,delimiter:c}:{drafts:[],error:"    CSV.       odakanitNo assignedLawyer  .",delimiter:c}},Dh=e=>{try{return JSON.stringify(e)}catch{return"[]"}},bb=()=>{if(typeof window>"u")return[];try{const e=window.localStorage.getItem(Vu);if(!e)return[];const t=JSON.parse(e);return Array.isArray(t)?t:[]}catch{return[]}},vb=e=>{if(!(typeof window>"u"))try{window.localStorage.setItem(Vu,Dh(e))}catch{}},Sb=()=>{if(typeof window>"u")return!1;try{return window.localStorage.getItem(Ch)==="1"}catch{return!1}},wb=()=>{if(!(typeof window>"u"))try{window.localStorage.setItem(Ch,"1")}catch{}},jb=(e,t,s=gb)=>{if(!e)return!1;const{odakanitNo:r,seededAt:a,seedSourceLastReportNo:o,seedSourceLastReportDate:l}=e,c=ke(r);if(!c||!!!(a||o||l))return!1;const u=t.filter(p=>!p.deletedAt&&ke(p.odakanitNo)===c);if(u.length>0){const p=typeof o=="number"?o:0,y=l?new Date(l).getTime():0;let S=0,w=0;if(u.forEach(L=>{typeof L.reportNumber=="number"&&L.reportNumber>S&&(S=L.reportNumber);const k=new Date(L.sentAt||L.reportDate).getTime();!Number.isNaN(k)&&k>w&&(w=k)}),S>p&&p>0||w>y&&y>0)return!0}if(a){const p=new Date(a).getTime();if(!Number.isNaN(p)&&(Date.now()-p)/(1e3*60*60*24)>s)return!0}return!!(a&&(o==null||Number.isNaN(o)))},Eb=({caseFolders:e,onUpdateCaseFolders:t,reports:s})=>{const[r,a]=g.useState(()=>bb()),[o,l]=g.useState(""),[c,i]=g.useState(null),[u,p]=g.useState(!1),[y,S]=g.useState(null),[w,L]=g.useState(null);g.useEffect(()=>{vb(r)},[r]);const k=Sb(),U=g.useMemo(()=>r.find(j=>j.odakanitNo===c)||null,[r,c]),N=()=>{const j=`odakanitNo,assignedLawyer
`,T=new Blob([j],{type:"text/csv;charset=utf-8;"}),E=URL.createObjectURL(T),C=document.createElement("a");C.href=E,C.download="seed-cases-template.csv",document.body.appendChild(C),C.click(),document.body.removeChild(C),URL.revokeObjectURL(E)},x=()=>{const{drafts:j,error:T,delimiter:E}=Nb(o);if(T){S(T),L(null);return}S(null),j.length?L(`Loaded ${j.length} cases. Detected delimiter: "${E||","}".`):L(null),a(j)},b=()=>{const j=Dh(r),T=new Blob([j],{type:"application/json;charset=utf-8;"}),E=URL.createObjectURL(T),C=document.createElement("a");C.href=E,C.download="seedDraftCases_v1.json",document.body.appendChild(C),C.click(),document.body.removeChild(C),URL.revokeObjectURL(E)},F=()=>{window.confirm("   -Seed (   CaseFolders)?")&&(a([]),typeof window<"u"&&window.localStorage.removeItem(Vu))},H=()=>{window.confirm(" Finalize    . ?")&&wb()},V=j=>j.status==="APPLIED"?"APPLIED":j.reports&&j.reports.length>0?"READY":"MISSING_HISTORY",q=j=>{j.reports.length&&(t(T=>{var qe,$e,st,Je;const E=ke(j.odakanitNo);if(!E)return T;const C=T[E],se=new Date().toISOString(),Y=C||{odakanitNo:E,reTemplate:(C==null?void 0:C.reTemplate)||"",insuredName:(C==null?void 0:C.insuredName)||"",insurerName:(C==null?void 0:C.insurerName)||"",plaintiffName:(C==null?void 0:C.plaintiffName)||"",marketRef:(C==null?void 0:C.marketRef)||"",lineSlipNo:(C==null?void 0:C.lineSlipNo)||"",certificateRef:(C==null?void 0:C.certificateRef)||"",createdAt:(C==null?void 0:C.createdAt)||se,updatedAt:(C==null?void 0:C.updatedAt)||se,reportIds:(C==null?void 0:C.reportIds)||[],sentReports:(C==null?void 0:C.sentReports)||[]},O=[...Y.sentReports];let P=0,X=null;j.reports.forEach(J=>{if(!J.reportNo||!J.title||!J.sentAt)return;const re=O.findIndex(ae=>ae.reportNo===J.reportNo),D={odakanitNo:E,reportNumber:J.reportNo,insurerName:Y.insurerName,insuredName:j.insuredName||Y.insuredName,plaintiffName:j.plaintiffName||Y.plaintiffName,reportSubject:J.title,reportDate:J.sentAt};re>=0?O[re]={...O[re],reportNo:J.reportNo,sentAt:J.sentAt,snapshot:{...O[re].snapshot||{},...D}}:O.push({reportId:`seed-${E.replace(/[^\w-]+/g,"_")}-${J.reportNo}`,reportNo:J.reportNo,sentAt:J.sentAt,fileName:void 0,snapshot:D}),J.reportNo>P&&(P=J.reportNo),J.sentAt&&(!X||J.sentAt>X)&&(X=J.sentAt)}),O.sort((J,re)=>(J.reportNo||0)-(re.reportNo||0));const ue=((qe=j.insuredName)==null?void 0:qe.trim())||Y.insuredName||void 0,xe=(($e=j.plaintiffName)==null?void 0:$e.trim())||Y.plaintiffName||void 0,oe=((st=j.lineSlipNo)==null?void 0:st.trim())||Y.lineSlipNo||void 0,fe=((Je=j.marketRef)==null?void 0:Je.trim())||Y.marketRef||void 0,ve=[];(ue||xe)&&ve.push(`Re: ${ue||""}${ue&&xe?" / ":""}${xe||""}`.trim()),oe&&ve.push(`LineSlip No. ${oe}`),fe&&ve.push(`Unique Market Ref: ${fe}`);const _e=ve.join(`
`),ze={...Y,insuredName:ue||Y.insuredName,plaintiffName:xe||Y.plaintiffName,lineSlipNo:oe||Y.lineSlipNo,marketRef:fe||Y.marketRef,assignedLawyer:j.assignedLawyer||(C==null?void 0:C.assignedLawyer),reTemplate:_e||Y.reTemplate,seededAt:se,seedSourceLastReportNo:P||Y.seedSourceLastReportNo,seedSourceLastReportDate:X||Y.seedSourceLastReportDate,updatedAt:se,sentReports:O};return{...T,[E]:ze}}),a(T=>T.map(E=>E.odakanitNo===j.odakanitNo?{...E,status:"APPLIED"}:E)))},te=r.map(j=>{const T=V(j),E=j.reports.length,C=E>0?j.reports.map(X=>X.sentAt).filter(Boolean).sort().slice(-1)[0]:"",se=e[ke(j.odakanitNo)],Y=jb(se,s),O=(se==null?void 0:se.seededAt)||null,P=se!=null&&se.seedSourceLastReportNo&&se.seedSourceLastReportDate?`#${se.seedSourceLastReportNo} (${se.seedSourceLastReportDate})`:"";return{draft:j,status:T,reportsCount:E,lastDate:C,stale:Y,lastSeedInfo:O,seedSummary:P}}).filter(j=>u?j.stale:!0),G=r.length,le=r.filter(j=>V(j)==="APPLIED").length;return n.jsxs("div",{className:"mt-6 border border-slate-200 rounded-xl p-4 bg-white",children:[n.jsxs("div",{className:"flex items-center justify-between mb-3",children:[n.jsxs("div",{className:"space-y-0.5",children:[n.jsx("h2",{className:"text-sm font-semibold text-slate-900",children:"Seed Existing Cases (Admin only)"}),n.jsxs("div",{className:"text-[11px] text-slate-600",children:[n.jsxs("span",{className:"font-semibold",children:[le," / ",G||0]})," ","cases completed",G>0&&le===G&&n.jsx("span",{className:"ml-2 text-emerald-600 font-medium",children:" All cases completed"})]})]}),k&&n.jsx("span",{className:"text-[11px] px-2 py-0.5 rounded-full bg-emerald-50 text-emerald-700 border border-emerald-200",children:"Finalized  read only"})]}),n.jsxs("div",{className:"grid md:grid-cols-2 gap-4 text-xs",children:[n.jsxs("div",{className:"space-y-2",children:[n.jsx("h3",{className:"font-semibold text-slate-800",children:"1) Download Template CSV"}),n.jsx("p",{className:"text-slate-600",children:"       CSV   .  : odakanitNo, assignedLawyer."}),n.jsx("button",{type:"button",className:"px-3 py-1.5 rounded bg-slate-800 text-white hover:bg-slate-900",onClick:N,children:"Download Seed Template (CSV)"})]}),n.jsxs("div",{className:"space-y-2",children:[n.jsx("h3",{className:"font-semibold text-slate-800",children:"2) Import Cases CSV"}),n.jsx("p",{className:"text-slate-600",children:"     CSV (  )  Parse.      (localStorage)."}),n.jsx("textarea",{className:"w-full border border-slate-300 rounded p-2 h-24 font-mono",value:o,onChange:j=>l(j.target.value),disabled:k}),y&&n.jsx("div",{className:"mt-1 text-[11px] text-rose-700 bg-rose-50 border border-rose-200 rounded px-2 py-1 whitespace-pre-line",children:y}),w&&!y&&n.jsx("div",{className:"mt-1 text-[11px] text-slate-600",children:w}),n.jsx("button",{type:"button",className:"px-3 py-1.5 rounded bg-blue-600 text-white hover:bg-blue-700 disabled:opacity-50",onClick:x,disabled:k,children:"Parse CSV"})]})]}),n.jsxs("div",{className:"mt-4",children:[n.jsxs("div",{className:"flex items-center justify-between mb-1",children:[n.jsx("h3",{className:"text-xs font-semibold text-slate-800",children:"Imported Cases"}),n.jsxs("label",{className:"flex items-center gap-1 text-[11px] text-slate-600",children:[n.jsx("input",{type:"checkbox",className:"rounded border-slate-300",checked:u,onChange:j=>p(j.target.checked)}),"Show only stale cases"]})]}),te.length===0?n.jsx("p",{className:"text-xs text-slate-500",children:"   ."}):n.jsx("div",{className:"border border-slate-200 rounded overflow-hidden",children:n.jsxs("table",{className:"min-w-full text-[11px]",children:[n.jsx("thead",{className:"bg-slate-50",children:n.jsxs("tr",{children:[n.jsx("th",{className:"px-2 py-1 text-right",children:"odakanitNo"}),n.jsx("th",{className:"px-2 py-1 text-right",children:"Lawyer"}),n.jsx("th",{className:"px-2 py-1 text-right",children:"Status"}),n.jsx("th",{className:"px-2 py-1 text-right",children:"Fresh / Stale"}),n.jsx("th",{className:"px-2 py-1 text-right",children:"#Reports"}),n.jsx("th",{className:"px-2 py-1 text-right",children:"Last date"}),n.jsx("th",{className:"px-2 py-1 text-right",children:"Actions"})]})}),n.jsx("tbody",{children:te.map(({draft:j,status:T,reportsCount:E,lastDate:C,stale:se,lastSeedInfo:Y,seedSummary:O})=>{var P;return n.jsxs("tr",{className:`border-t border-slate-200 ${se?"bg-amber-50":""}`,children:[n.jsx("td",{className:"px-2 py-1 font-mono",children:j.odakanitNo}),n.jsx("td",{className:"px-2 py-1",children:j.assignedLawyer||((P=vs.find(X=>X.id===j.assignedLawyer||X.username===j.assignedLawyer))==null?void 0:P.name)||""}),n.jsx("td",{className:"px-2 py-1",children:T==="APPLIED"?"APPLIED":T==="READY"?"READY":"MISSING_HISTORY"}),n.jsx("td",{className:"px-2 py-1",children:T==="APPLIED"?n.jsxs("div",{className:"space-y-0.5",children:[n.jsx("div",{className:se?"text-amber-700 font-semibold":"text-emerald-700 font-semibold",children:se?"STALE":"FRESH"}),Y&&n.jsxs("div",{className:"text-[9px] text-slate-500",children:["Last seeded: ",new Date(Y).toLocaleDateString()]}),O&&n.jsxs("div",{className:"text-[9px] text-slate-500",children:["Seed based on ",O]})]}):n.jsx("span",{className:"text-[10px] text-slate-400",children:""})}),n.jsx("td",{className:"px-2 py-1 text-center",children:E}),n.jsx("td",{className:"px-2 py-1",children:C||""}),n.jsxs("td",{className:"px-2 py-1 text-left",children:[n.jsx("button",{type:"button",className:"px-2 py-0.5 rounded border border-slate-300 text-slate-700 hover:bg-slate-50 mr-2",onClick:()=>i(j.odakanitNo),disabled:k,children:se?"Re-seed":"Edit"}),n.jsx("button",{type:"button",className:"px-2 py-0.5 rounded border border-emerald-400 text-emerald-700 hover:bg-emerald-50 disabled:opacity-50",onClick:()=>q(j),disabled:T==="MISSING_HISTORY"||k,children:"Apply"})]})]},j.odakanitNo)})})]})})]}),U&&n.jsx("div",{className:"mt-6 border-t border-slate-200 pt-4",children:n.jsx(kb,{draft:U,index:r.findIndex(j=>j.odakanitNo===U.odakanitNo),total:r.length,finalized:k,onChangeDraft:j=>{a(T=>T.map(E=>E.odakanitNo===j.odakanitNo?j:E))},onApply:q,onNavigateRelative:j=>{const T=r.findIndex(C=>C.odakanitNo===U.odakanitNo);if(T<0)return;const E=T+j;E<0||E>=r.length||i(r[E].odakanitNo)},onResetSeedMeta:()=>{const j=ke(U.odakanitNo);j&&(t(T=>{const E=T[j];if(!E)return T;const{seededAt:C,seedSourceLastReportNo:se,seedSourceLastReportDate:Y,...O}=E;return{...T,[j]:O}}),a(T=>T.map(E=>E.odakanitNo===U.odakanitNo?{...E,reports:[],status:"MISSING_HISTORY"}:E)))}})}),n.jsxs("div",{className:"mt-4 flex flex-wrap gap-2 text-xs",children:[n.jsx("button",{type:"button",className:"px-3 py-1.5 rounded border border-slate-300 text-slate-700 hover:bg-slate-50",onClick:b,children:"Export Draft JSON"}),n.jsx("button",{type:"button",className:"px-3 py-1.5 rounded border border-rose-300 text-rose-700 hover:bg-rose-50",onClick:F,disabled:k,children:"Clear Draft Only"}),n.jsx("button",{type:"button",className:"px-3 py-1.5 rounded border border-emerald-400 text-emerald-700 hover:bg-emerald-50 ml-auto disabled:opacity-50",onClick:H,disabled:k,children:"Finalize (readonly)"})]})]})};function kb({draft:e,index:t,total:s,finalized:r,onChangeDraft:a,onApply:o,onNavigateRelative:l,onResetSeedMeta:c}){const[i,u]=g.useState(null),[p,y]=g.useState([]),[S,w]=g.useState([]),[L,k]=g.useState(!1),U=g.useRef([]),N=g.useRef(null);g.useEffect(()=>{u(null),y([]),w([])},[e.odakanitNo]),g.useEffect(()=>{const T=E=>{var P;if(!e||r)return;const C=(P=E.clipboardData)==null?void 0:P.items;if(!C||C.length===0)return;const se=Array.from(C).find(X=>X.type&&X.type.startsWith("image/"));if(!se){u("Clipboard does not contain an image.");return}const Y=se.getAsFile();if(!Y)return;const O=new FileReader;O.onload=()=>{const X=O.result;a({...e,screenshotDataUrl:X}),u(null)},O.readAsDataURL(Y)};return window.addEventListener("paste",T),()=>{window.removeEventListener("paste",T)}},[e,r,a]),g.useEffect(()=>{const T=E=>{const C=E.target,se=C&&(C.tagName==="INPUT"||C.tagName==="TEXTAREA"||C.isContentEditable),O=navigator.platform.toUpperCase().includes("MAC")?E.metaKey:E.ctrlKey;if(!(se&&!O)){if(O&&!E.shiftKey&&!E.altKey&&E.key.toLowerCase()==="s"){if(E.preventDefault(),!r){if(x())return;o(e)}return}if(O&&E.shiftKey&&!E.altKey&&E.key.toLowerCase()==="o"){E.preventDefault(),!r&&e.screenshotDataUrl&&!L&&te();return}if(O&&!E.shiftKey&&!E.altKey&&E.key==="Enter"){E.preventDefault(),r||b();return}if(O&&E.altKey&&(E.key==="ArrowDown"||E.key==="ArrowUp")){E.preventDefault();const P=E.key==="ArrowDown"?1:-1;if(x(!0)&&!window.confirm("This case has invalid rows. Navigate to another case anyway?"))return;l(P)}if(!O&&!E.altKey&&!E.shiftKey&&E.key==="/"){const P=document.getElementById("seed-cases-search-input");P&&(E.preventDefault(),P.focus())}}};return window.addEventListener("keydown",T),()=>{window.removeEventListener("keydown",T)}},[e,r,o,l,L]);const x=(T=!1)=>{var Y;const E=[];let C=!1;if(!e.reports||e.reports.length===0)return u("   ."),!0;const se=new Set;if(e.reports.forEach((O,P)=>{const X={};!Number.isInteger(O.reportNo)||O.reportNo<=0?X.reportNo="     .":se.has(O.reportNo)?X.reportNo="  .":se.add(O.reportNo),O.sentAt?Number.isNaN(new Date(O.sentAt).getTime())&&(X.sentAt="  ."):X.sentAt=" .",(!O.title||O.title.trim().length<2)&&(X.title="  ( 2 )."),(X.reportNo||X.sentAt||X.title)&&(C=!0),E[P]=X}),y(E),u(C?"    .":null),C&&!T){const O=E.findIndex(P=>P.reportNo||P.sentAt||P.title);O>=0&&U.current[O]&&((Y=U.current[O])==null||Y.focus())}return C},b=()=>{const T=e.reports.length>0?Math.max(...e.reports.map(C=>C.reportNo||0)):0,E={...e,reports:[...e.reports,{reportNo:T+1,sentAt:"",title:""}]};a(E)},F=T=>{const E=e.reports[T],C=e.reports.length>0?Math.max(...e.reports.map(P=>P.reportNo||0)):0,Y={reportNo:(E&&Number.isInteger(E.reportNo)&&E.reportNo>0?E.reportNo:C)+1,sentAt:"",title:""},O=[...e.reports];O.splice(T+1,0,Y),a({...e,reports:O}),setTimeout(()=>{const P=U.current[T+1];P&&P.focus()},0)},H=(T,E)=>{T.key==="Enter"&&T.shiftKey&&!T.ctrlKey&&!T.metaKey&&!T.altKey&&(T.preventDefault(),r||F(E))},V=(T,E,C)=>{const se=e.reports.map((Y,O)=>O===T?{...Y,[E]:E==="reportNo"?Number(C.replace(/[^\d]/g,""))||0:C}:Y);a({...e,reports:se})},q=T=>{const E=e.reports.filter((C,se)=>se!==T);a({...e,reports:E})},te=async()=>{if(e.screenshotDataUrl){k(!0);try{const{previousReports:T,identifiers:E}=await xb(e.screenshotDataUrl);w(T);const C={...e,insuredName:E.insuredName||e.insuredName,plaintiffName:E.plaintiffOrClaimant||e.plaintiffName,lineSlipNo:E.lineSlipNo||e.lineSlipNo,marketRef:E.marketRef||e.marketRef};a(C),T.length?u(null):u("   .   .")}catch{u("OCR .   .")}finally{k(!1)}}},G=()=>{if(!S.length)return;const T=S.filter(E=>E.reportNo&&E.sentAt&&E.title).map(E=>({reportNo:E.reportNo,sentAt:E.sentAt,title:E.title}));T.length&&(a({...e,reports:T}),u(null),y([]))},le=T=>{var se;const E=(se=T.target.files)==null?void 0:se[0];if(!E)return;const C=new FileReader;C.onload=()=>{const Y=C.result;a({...e,screenshotDataUrl:Y}),u(null)},C.readAsDataURL(E)},j=e.screenshotDataUrl;return n.jsxs("div",{className:"mt-2 rounded-lg border border-slate-200 bg-slate-50 p-3 text-[11px] relative",children:[n.jsxs("div",{className:"flex items-center justify-between mb-2",children:[n.jsxs("div",{className:"font-semibold text-slate-800",children:["Case editor  ",e.odakanitNo," ",n.jsxs("span",{className:"text-slate-500",children:["(",t+1,"/",s,")"]})]}),n.jsxs("div",{className:"flex items-center gap-3",children:[n.jsx("button",{type:"button",className:"text-[10px] px-2 py-1 rounded border border-amber-300 text-amber-700 hover:bg-amber-50",onClick:c,disabled:r,children:"Re-seed this case"}),n.jsx("div",{className:"text-[10px] text-slate-500 hidden md:block",children:" : Ctrl+S / S  Apply, Ctrl+Enter   , Ctrl+Shift+O  OCR, Ctrl+Alt+/   "})]})]}),i&&n.jsx("div",{className:"mb-2 rounded bg-amber-50 border border-amber-200 px-2 py-1 text-[11px] text-amber-900",children:i}),n.jsxs("div",{className:"grid md:grid-cols-2 gap-3",children:[n.jsxs("div",{className:"space-y-2",children:[n.jsx("div",{className:"font-semibold text-slate-800",children:"Screenshot / OCR"}),n.jsxs("div",{ref:N,tabIndex:0,className:"border border-dashed border-slate-300 rounded-lg p-2 text-center text-slate-600 bg-white cursor-pointer hover:border-slate-400 focus:outline-none focus:ring-1 focus:ring-slate-400",onClick:()=>{var T;return(T=N.current)==null?void 0:T.focus()},children:[n.jsx("div",{className:"mb-1 font-medium text-slate-800",children:"Click here and press Ctrl+V / V to paste screenshot"}),n.jsx("div",{className:"text-[10px] text-slate-500 mb-2",children:"or choose file from disk"}),n.jsx("input",{type:"file",accept:"image/*",onChange:le,disabled:r,className:"mx-auto block text-[10px]"})]}),j&&n.jsxs("div",{className:"mt-2",children:[n.jsx("div",{className:"text-[10px] text-slate-600 mb-1",children:"Preview:"}),n.jsx("div",{className:"border border-slate-200 rounded overflow-hidden bg-white max-h-64 flex items-center justify-center",children:n.jsx("img",{src:j,alt:"Seed screenshot",className:"max-h-64"})})]}),n.jsx("div",{className:"flex items-center gap-2 mt-2",children:n.jsx("button",{type:"button",onClick:te,disabled:!j||r||L,className:"px-3 py-1.5 rounded bg-indigo-600 text-white disabled:opacity-50 text-[11px]",children:L?"Running OCR":"Extract Previous Reports from Screenshot"})}),S.length>0&&n.jsxs("div",{className:"mt-2 border border-slate-200 rounded bg-white p-2",children:[n.jsxs("div",{className:"flex items-center justify-between mb-1",children:[n.jsxs("div",{className:"font-semibold text-slate-800 text-[11px]",children:["Proposed extraction (",S.length,")"]}),n.jsx("button",{type:"button",className:"px-2 py-0.5 rounded bg-slate-800 text-white text-[10px]",onClick:G,disabled:r,children:"Apply to table"})]}),n.jsx("div",{className:"max-h-40 overflow-auto text-[10px]",children:n.jsxs("table",{className:"min-w-full border-collapse",children:[n.jsx("thead",{children:n.jsxs("tr",{className:"bg-slate-50",children:[n.jsx("th",{className:"px-1 py-0.5 text-right",children:"#"}),n.jsx("th",{className:"px-1 py-0.5 text-right",children:"Title"}),n.jsx("th",{className:"px-1 py-0.5 text-right",children:"Date"}),n.jsx("th",{className:"px-1 py-0.5 text-right",children:"Conf."})]})}),n.jsx("tbody",{children:S.map((T,E)=>n.jsxs("tr",{className:"border-t border-slate-100",children:[n.jsx("td",{className:"px-1 py-0.5 text-right",children:T.reportNo??""}),n.jsx("td",{className:"px-1 py-0.5 text-right",children:T.title||""}),n.jsx("td",{className:"px-1 py-0.5 text-right",children:T.sentAt||""}),n.jsx("td",{className:"px-1 py-0.5 text-right",children:typeof T.confidence=="number"?`${Math.round(T.confidence)}%`:""})]},E))})]})})]})]}),n.jsxs("div",{className:"space-y-3",children:[n.jsxs("div",{className:"flex items-center justify-between",children:[n.jsx("div",{className:"font-semibold text-slate-800",children:"Previous reports table"}),n.jsx("button",{type:"button",onClick:b,disabled:r,className:"px-2 py-1 rounded border border-slate-300 text-[10px] hover:bg-slate-100",children:"+ Add row (Ctrl+Enter)"})]}),n.jsx("div",{className:"border border-slate-200 rounded bg-white max-h-72 overflow-auto",children:n.jsxs("table",{className:"min-w-full text-[11px]",children:[n.jsx("thead",{className:"bg-slate-50",children:n.jsxs("tr",{children:[n.jsx("th",{className:"px-1 py-1 text-right w-16",children:"Report #"}),n.jsx("th",{className:"px-1 py-1 text-right w-32",children:"Date"}),n.jsx("th",{className:"px-1 py-1 text-right",children:"Title"}),n.jsx("th",{className:"px-1 py-1 text-left w-16"})]})}),n.jsx("tbody",{children:e.reports.length===0?n.jsx("tr",{children:n.jsx("td",{colSpan:4,className:"px-2 py-2 text-center text-slate-400 text-[10px]",children:"  .      OCR ."})}):e.reports.map((T,E)=>{var C,se,Y,O,P,X,ue,xe,oe;return n.jsxs("tr",{className:"border-t border-slate-100",children:[n.jsxs("td",{className:"px-1 py-1 align-top",children:[n.jsx("input",{ref:fe=>{U.current[E]=fe},type:"number",className:`w-full border rounded px-1 py-0.5 text-[11px] ${(C=p[E])!=null&&C.reportNo?"border-rose-400":"border-slate-300"}`,value:T.reportNo??"",onChange:fe=>V(E,"reportNo",fe.target.value),onKeyDown:fe=>H(fe,E),disabled:r}),((se=p[E])==null?void 0:se.reportNo)&&n.jsx("div",{className:"mt-0.5 text-[9px] text-rose-600",children:(Y=p[E])==null?void 0:Y.reportNo})]}),n.jsxs("td",{className:"px-1 py-1 align-top",children:[n.jsx("input",{type:"date",className:`w-full border rounded px-1 py-0.5 text-[11px] ${(O=p[E])!=null&&O.sentAt?"border-rose-400":"border-slate-300"}`,value:T.sentAt||"",onChange:fe=>V(E,"sentAt",fe.target.value),onKeyDown:fe=>H(fe,E),disabled:r}),((P=p[E])==null?void 0:P.sentAt)&&n.jsx("div",{className:"mt-0.5 text-[9px] text-rose-600",children:(X=p[E])==null?void 0:X.sentAt})]}),n.jsxs("td",{className:"px-1 py-1 align-top",children:[n.jsx("input",{type:"text",className:`w-full border rounded px-1 py-0.5 text-[11px] ${(ue=p[E])!=null&&ue.title?"border-rose-400":"border-slate-300"}`,value:T.title,onChange:fe=>V(E,"title",fe.target.value),onKeyDown:fe=>H(fe,E),disabled:r}),((xe=p[E])==null?void 0:xe.title)&&n.jsx("div",{className:"mt-0.5 text-[9px] text-rose-600",children:(oe=p[E])==null?void 0:oe.title})]}),n.jsx("td",{className:"px-1 py-1 align-top text-left",children:n.jsx("button",{type:"button",onClick:()=>q(E),disabled:r,className:"px-1.5 py-0.5 rounded border border-slate-300 text-[10px] text-slate-700 hover:bg-slate-100",children:""})})]},E)})})]})}),n.jsxs("div",{className:"border border-slate-200 rounded bg-white p-2 space-y-2",children:[n.jsx("div",{className:"font-semibold text-slate-800 text-[11px]",children:"Extracted identifiers"}),n.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-2 text-[11px]",children:[n.jsxs("div",{className:"space-y-1",children:[n.jsx("label",{className:"block text-[10px] text-slate-600",children:"Insured"}),n.jsx("input",{type:"text",className:"w-full border rounded px-2 py-0.5 text-[11px] border-slate-300",value:e.insuredName||"",onChange:T=>a({...e,insuredName:T.target.value}),disabled:r})]}),n.jsxs("div",{className:"space-y-1",children:[n.jsx("label",{className:"block text-[10px] text-slate-600",children:"Plaintiff / Claimant"}),n.jsx("input",{type:"text",className:"w-full border rounded px-2 py-0.5 text-[11px] border-slate-300",value:e.plaintiffName||"",onChange:T=>a({...e,plaintiffName:T.target.value}),disabled:r})]}),n.jsxs("div",{className:"space-y-1",children:[n.jsx("label",{className:"block text-[10px] text-slate-600",children:"LineSlip No."}),n.jsx("input",{type:"text",className:"w-full border rounded px-2 py-0.5 text-[11px] border-slate-300",value:e.lineSlipNo||"",onChange:T=>a({...e,lineSlipNo:T.target.value}),disabled:r})]}),n.jsxs("div",{className:"space-y-1",children:[n.jsx("label",{className:"block text-[10px] text-slate-600",children:"Unique Market Ref"}),n.jsx("input",{type:"text",className:"w-full border rounded px-2 py-0.5 text-[11px] border-slate-300",value:e.marketRef||"",onChange:T=>a({...e,marketRef:T.target.value}),disabled:r})]})]})]})]})]}),n.jsx(hb,{})]})}const ul={title:"    ",subtitle:"     ,    ",actions:{openNewReport:"  "},queueItem:{noDate:" "}},Ku=(e,t)=>{console.error(`[LP-CRM] ${e}`,t)},Ab=e=>{if(!e)return!1;const t=new Date(e);return Number.isNaN(t.getTime())?!1:t.getTime()>Date.now()},Zn=e=>{const{messageHe:t,...s}=e;return t?{...s,messageHe:t}:{...s,messageHe:{MISSING_PROVIDER:"    .",MISSING_DESCRIPTION:"  .",INVALID_DATE_FUTURE:"     .",INVALID_QUANTITY:"     -0.",INVALID_UNIT_PRICE:"     .",INVALID_VAT_RATE:"     .",NEGATIVE_AMOUNT:"     .",MISSING_ATTACHMENT_REQUIRED:"      .",SHEET_STATUS_INVALID_FOR_READY:"     -READY_FOR_REPORT.",SHEET_STATUS_INVALID_FOR_ATTACH:"     .",SHEET_STATUS_INVALID_FOR_SEND:"    .",SUMS_INCONSISTENT:"     .",INFO_ONLY_INCONSISTENT:'  " "     0.',SNAPSHOT_HASH_MISMATCH:"-Hash        ."}[s.code]||"  ."}},Ib=(e,t,s)=>{const r=s.filter(u=>u.severity==="ERROR").map(u=>u.code),a=s.filter(u=>u.severity==="WARNING").map(u=>u.code),o=!s.some(u=>u.code==="SUMS_INCONSISTENT"),l=!s.some(u=>u.code==="MISSING_ATTACHMENT_REQUIRED"&&u.severity==="ERROR"),c=!s.some(u=>["MISSING_PROVIDER","MISSING_DESCRIPTION"].includes(u.code)),i=!s.some(u=>u.code==="INFO_ONLY_INCONSISTENT");return{evaluatedAt:new Date().toISOString(),insurerId:e.insurerId||void 0,rulesetId:t==null?void 0:t.insurerId,rulesetVersion:t==null?void 0:t.rulesetVersion,checks:{sumsValid:o,attachmentsOk:l,requiredFieldsOk:c,infoOnlyConsistent:i},blockingIssueCodes:r,warningIssueCodes:a}},Tb=e=>{const t=[];return e.kind==="EXPENSE"&&!e.providerName&&t.push(Zn({code:"MISSING_PROVIDER",severity:"ERROR",scope:"LINE_ITEM",entityId:e.id})),e.description||t.push(Zn({code:"MISSING_DESCRIPTION",severity:"ERROR",scope:"LINE_ITEM",entityId:e.id})),Ab(e.date)&&t.push(Zn({code:"INVALID_DATE_FUTURE",severity:"WARNING",scope:"LINE_ITEM",entityId:e.id})),e.quantity!=null&&e.quantity<=0&&t.push(Zn({code:"INVALID_QUANTITY",severity:"ERROR",scope:"LINE_ITEM",entityId:e.id})),e.unitPrice!=null&&e.unitPrice<0&&t.push(Zn({code:"INVALID_UNIT_PRICE",severity:"ERROR",scope:"LINE_ITEM",entityId:e.id})),e.vatRate!=null&&e.vatRate<0&&t.push(Zn({code:"INVALID_VAT_RATE",severity:"ERROR",scope:"LINE_ITEM",entityId:e.id})),[e.lineNetAmount,e.lineVatAmount,e.lineTotalAmount].filter(r=>r!=null).some(r=>r<0)&&t.push(Zn({code:"NEGATIVE_AMOUNT",severity:"ERROR",scope:"LINE_ITEM",entityId:e.id})),t},Rb=(e,t,s,r)=>{if(!r)return[];const a=[],o={};s.forEach(c=>{o[c.id]=c});const l=r.amountThresholdRequiringAttachment??null;return t.forEach(c=>{const i=c.isIncludedInRequestedAmount!==!1,u=!!(c.attachmentId&&o[c.attachmentId]),p=c.lineTotalAmount??0;let y=!1;if(r.policyFamily==="STRICT")i&&c.kind==="EXPENSE"&&(!l||p>=l)&&(y=!0);else if(r.policyFamily==="PARTIAL"){const S=!!c.expenseType&&r.requireAttachmentForExpenseTypes.includes(c.expenseType),w=!!l&&p>=l;i&&(S||w)&&(y=!0)}else r.policyFamily==="FLEXIBLE"&&i&&c.kind==="EXPENSE"&&(!l||p>=l)&&(y=!0);if(y&&!u){const S=r.policyFamily==="FLEXIBLE"?"WARNING":"ERROR";a.push(Zn({code:"MISSING_ATTACHMENT_REQUIRED",severity:S,scope:"LINE_ITEM",entityId:c.id,messageHe:S==="ERROR"?"      .":"       ."}))}}),r.requiredAttachmentTypes.length>0&&a.push(Zn({code:"ATTACHMENT_TYPES_NOT_ENFORCED",severity:"INFO",scope:"SHEET",messageHe:"     ,      ."})),e.infoOnly&&a.length&&r.policyFamily,a},Cb=e=>{const{sheet:t,lineItems:s,attachments:r,ruleset:a}=e,o=[];s.forEach(i=>{o.push(...Tb(i))});const l=Dn(t,s);t.infoOnly&&l.amountToRequest!==0&&o.push(Zn({code:"INFO_ONLY_INCONSISTENT",severity:"ERROR",scope:"SHEET"})),o.push(...Rb(t,s,r,a));const c=Ib(t,a,o);return{issues:o,decisionLog:c}},Rp=e=>Cb(e),Db=e=>{if(!e)return"";const t=new Date(e);if(Number.isNaN(t.getTime()))return"";const s=String(t.getDate()).padStart(2,"0"),r=String(t.getMonth()+1).padStart(2,"0"),a=t.getFullYear();return`${s}/${r}/${a}`},Qn=e=>(e??0).toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2}),si=e=>{if(e.lineTotalAmount!=null)return e.lineTotalAmount;const t=e.lineNetAmount!=null?e.lineNetAmount:Ah(e.quantity??0,e.unitPrice??0),s=e.lineVatAmount!=null?e.lineVatAmount:Ih(t,e.vatRate??0);return Th(t,s)},Lh=(e,t,s)=>{const r=Dn(e,t),a=[`Expenses Table  Case ${e.caseId}`,"",`Deductible: ${Qn(e.deductibleAmount??0)}`,`Payments already made: ${Qn(e.alreadyPaidAmount??0)}`,`Amount to request: ${Qn(r.amountToRequest)}`,"","Expenses:"],o=[],l=[];let c=0;t.forEach(p=>{var V,q;const y=Db(p.date||null),S=p.providerName||"",w=p.description||"",L=p.kind==="EXPENSE"?"Expense":p.kind==="COMPENSATION"?p.compensationSource==="COURT"?"Compensation pursuant to a judgment":"Compensation pursuant to a settlement":"Adjustment",k=((V=s==null?void 0:s.isNewLine)==null?void 0:V.call(s,p))??!1,U=((q=s==null?void 0:s.isHistoricalLine)==null?void 0:q.call(s,p))??!1,N=Qn(si(p)),x=p.vatRate!=null?`, VAT ${p.vatRate}%`:"",b=p.isIncludedInRequestedAmount===!1?" (not included in request)":"",H=` ${y||"-"}  ${k?"[] ":U?"[] ":""}${w}${S?` (${S})`:""}  ${N} (${L}${x})${b}`;if(p.kind==="EXPENSE"){const te=si(p);k&&(c+=te),o.push(H)}else l.push(H)}),o.length||o.push(" No expense items.");const i=s&&typeof s.newExpensesTotal=="number"?s.newExpensesTotal:c;return{text:[...a,...o,"","Adjustments and compensations:",...l.length?l:[" No adjustments or compensations."],"",...i>0?[`Current report expenses only: ${Qn(i)}`]:[],`Total gross expenses: ${Qn(r.grossExpensesTotal)}`,`Total deductions (Deductible + Payments already made + adjustments): ${Qn(r.adjustmentsTotal)}`,`Amount to request: ${Qn(r.amountToRequest)}`].join(`
`),totals:r}},ri=(e,t,s)=>{const r=Dn(e,t),a=r.amountToRequest<=0,o=[],l=(b,F,H)=>{const V=H!=null&&H.isTotal?"total-balance-row":H!=null&&H.isSummary?"summary-row":"",q=(H==null?void 0:H.rowClass)??"",te=`${V} ${q}`.trim();o.push(`<tr class="${te}"><td>${Lb(b)}</td><td class="amount-cell">${Qn(F??0)}</td></tr>`)},c=t.filter(b=>b.kind==="EXPENSE");let i=0;const u=c.reduce((b,F)=>{var E,C;const H=si(F),V=((E=s==null?void 0:s.isNewLine)==null?void 0:E.call(s,F))??!1,q=((C=s==null?void 0:s.isHistoricalLine)==null?void 0:C.call(s,F))??!1;V&&(i+=H);const te=F.providerName?` (${F.providerName})`:"",G=F.description?`${F.description}${te}`:te||"Expense",j=`${V?"  ":q?"  ":""}${G}`;return l(j,H,{rowClass:V?"expense-row-new":q?"expense-row-history":""}),b+H},0),p=e.deductibleAmount??0;t.filter(b=>b.kind==="COMPENSATION").forEach(b=>{const F=b.compensationSource==="COURT"?"Court-awarded compensation":"Settlement compensation";l(F,si(b))}),l("Total expenses so far",u,{isSummary:!0});const S=s&&typeof s.newExpensesTotal=="number"?s.newExpensesTotal:i;S>0&&l("Current report expenses only",S,{isSummary:!0}),l("Deductible",p,{isSummary:!0}),l("Payments already made",e.alreadyPaidAmount??0,{isSummary:!0}),l(a?"Total Balance Due (no payment requested)":"Total Balance Due",r.amountToRequest,{isTotal:!0});const w=['<div class="expenses-table-wrapper">','<table class="expenses-table">',"<thead>",'<tr><th>Expenses</th><th class="amount-cell">Amount ()</th></tr>',"</thead>","<tbody>",...o,"</tbody>","</table>","</div>"].join(""),L=t.some(b=>b.kind==="COMPENSATION"&&b.compensationSource!=="COURT"),k=t.some(b=>b.kind==="COMPENSATION"&&b.compensationSource==="COURT"),U=`${Qn(r.amountToRequest)}`;let N;return k?N='<p class="expenses-payment-note">Pursuant to the judgment rendered in this matter, we kindly request that the Insurer arrange payment of the total amount set out in the attached Expenses Table, in order to bring this claim to a conclusion.<br/><br/><strong>Payment is required within 30 days of receipt of this report.</strong></p>':L?a?N='<p class="expenses-payment-note">Although a settlement has been agreed in principle, the total expenses and compensation fall within the applicable deductible. Accordingly, no payment is required from the Insurer in respect of this claim.</p>':N=`<p class="expenses-payment-note">Should the Insurer approve the settlement, we would be obliged if the Insurer could arrange payment of ${U} to the Brokers bank account in order to bring this claim to a conclusion. This amount represents an all-inclusive settlement, covering both the agreed compensation and the associated expenses. In the event that the settlement is not approved, no payment is required at this stage.</p>`:N=a?'<p class="expenses-payment-note">Given that the deductible exceeds the total expenses incurred in this matter, the Insurer is not required to make any payment in respect of this claim.</p>':`<p class="expenses-payment-note">Accordingly, we would appreciate it if the Insurer could transfer the amount of ${U} to the Brokers bank account.</p>`,{html:w+N+'<p class="expenses-payment-note">All amounts are stated in New Israeli Shekels ().</p>',totals:r}},Lb=e=>e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;"),_b=({open:e,title:t,message:s,confirmText:r,cancelText:a,destructive:o=!1,onConfirm:l,onCancel:c})=>{const i=g.useRef(null);if(g.useEffect(()=>{if(!e)return;const y=S=>{S.key==="Escape"&&(S.stopPropagation(),c())};if(typeof window<"u"&&window.addEventListener("keydown",y),i.current)try{i.current.focus()}catch{}return()=>{typeof window<"u"&&window.removeEventListener("keydown",y)}},[e,c]),!e)return null;const u=y=>{y.target===y.currentTarget&&c()},p=o?"bg-danger text-white hover:bg-red-800":"bg-navy text-gold hover:bg-navySecondary";return n.jsx("div",{className:"fixed inset-0 z-[300] flex items-center justify-center bg-black/50",onClick:u,children:n.jsxs("div",{className:"bg-panel border border-borderDark rounded-xl shadow-xl max-w-md w-full mx-4 p-5 space-y-3",dir:"rtl",children:[n.jsx("h2",{className:"text-sm font-bold text-gold text-right",children:t}),s&&n.jsx("p",{className:"text-xs text-textMuted text-right whitespace-pre-line",children:s}),n.jsxs("div",{className:"flex justify-end gap-2 mt-4",children:[n.jsx("button",{type:"button",onClick:c,className:"px-3 py-1.5 rounded-md border border-borderDark text-xs text-textLight bg-navySecondary hover:bg-borderDark",children:a}),n.jsx("button",{type:"button",ref:i,onClick:l,className:`px-3 py-1.5 rounded-md text-xs font-semibold ${p}`,children:r})]})]})})},Ob=({user:e,sheet:t,paymentEvents:s,onChangeEvents:r})=>{const[a,o]=g.useState(""),[l,c]=g.useState(()=>new Date().toISOString().slice(0,10)),[i,u]=g.useState(""),[p,y]=g.useState(""),[S,w]=g.useState(!1),[L,k]=g.useState(null),U=async()=>{const b=Number(a);if(!Number.isFinite(b)||b<=0){k("     .");return}if(!l){k("    .");return}const H=new Date(l).getTime();if(Number.isNaN(H)){k("   .");return}const V=Date.now();if(H>V){k("     .");return}k(null),w(!0);try{const q=new Date(l).toISOString(),te=await Ye.createPaymentEvent(e,{caseId:t.caseId,sheetId:t.id,amount:b,paidAt:q,reference:i||null,note:p||null});r([...s,te]),o(""),u(""),y(""),k(null)}finally{w(!1)}},N=async b=>{await Ye.softDeletePaymentEvent(b),r(s.filter(F=>F.id!==b))},x=s.filter(b=>!b.isDeleted).sort((b,F)=>{const H=new Date(b.paidAt).getTime();return new Date(F.paidAt).getTime()-H});return n.jsxs("div",{className:"space-y-3",children:[n.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-2 items-end",children:[n.jsxs("div",{children:[n.jsx("label",{className:"block text-[11px] font-medium text-slate-700 mb-1",children:"  ()"}),n.jsx("input",{type:"number",className:"w-full border rounded px-2 py-1 text-xs",value:a,onChange:b=>o(b.target.value),min:0})]}),n.jsxs("div",{children:[n.jsx("label",{className:"block text-[11px] font-medium text-slate-700 mb-1",children:" "}),n.jsx("input",{type:"date",className:"w-full border rounded px-2 py-1 text-xs",value:l,onChange:b=>c(b.target.value)})]}),n.jsxs("div",{children:[n.jsx("label",{className:"block text-[11px] font-medium text-slate-700 mb-1",children:" (  / )"}),n.jsx("input",{type:"text",className:"w-full border rounded px-2 py-1 text-xs",value:i,onChange:b=>u(b.target.value)})]}),n.jsxs("div",{children:[n.jsx("label",{className:"block text-[11px] font-medium text-slate-700 mb-1",children:"  ()"}),n.jsxs("div",{className:"flex gap-2",children:[n.jsx("input",{type:"text",className:"flex-1 border rounded px-2 py-1 text-xs",value:p,onChange:b=>y(b.target.value)}),n.jsx("button",{type:"button",className:"px-3 py-1 text-xs rounded bg-emerald-600 text-white hover:bg-emerald-700 disabled:opacity-50",onClick:U,disabled:S,children:" "})]})]})]}),L&&n.jsx("div",{className:"text-[11px] text-red-600 px-1",children:L}),n.jsx("div",{className:"border-t border-slate-200 pt-2",children:x.length===0?n.jsx("p",{className:"text-[11px] text-slate-500",children:"    .       ."}):n.jsx("div",{className:"space-y-1",children:x.map(b=>n.jsxs("div",{className:"flex flex-wrap items-baseline gap-x-4 gap-y-1 rounded border border-slate-200 bg-white px-2 py-1",children:[n.jsxs("span",{className:"font-medium text-slate-800",children:["",b.amount.toLocaleString("he-IL")]}),n.jsxs("span",{className:"text-slate-600",children:[""," ",new Date(b.paidAt).toLocaleDateString("he-IL",{year:"numeric",month:"2-digit",day:"2-digit"})]}),b.reference&&n.jsxs("span",{className:"text-slate-600",children:[": ",b.reference]}),b.note&&n.jsxs("span",{className:"text-slate-600",children:[": ",b.note]}),n.jsx("button",{type:"button",className:"ml-auto text-xs text-red-600 hover:underline",onClick:()=>N(b.id),children:""})]},b.id))})})]})},Cp={DRAFT:"",READY_FOR_REPORT:" ",ATTACHED_TO_REPORT:" ",ARCHIVED:""},_h=({user:e,sheetWithRelations:t,onSheetUpdated:s,onBack:r,onNotifyLawyer:a,linkedReportForLawyer:o})=>{const[l,c]=g.useState(t.sheet),[i,u]=g.useState(t.lineItems),[p,y]=g.useState(!1),[S,w]=g.useState(null),[L,k]=g.useState(null),[U,N]=g.useState([]),[x,b]=g.useState(t.attachments),[F,H]=g.useState(!1),[V,q]=g.useState(""),[te,G]=g.useState([]),[le,j]=g.useState([]),[T,E]=g.useState("AUTO"),[C,se]=g.useState([]),[Y,O]=g.useState([]),[P,X]=g.useState([]),[ue,xe]=g.useState(null),oe=g.useMemo(()=>Ye.getPaidToDateForSheet(l),[l,Y]),fe=g.useMemo(()=>({...l,alreadyPaidAmount:oe}),[l,oe]);g.useEffect(()=>{c(t.sheet),u(t.lineItems),b(t.attachments),(async()=>{try{const W=t.sheet.caseId,de=ke(W);if(!de){se([]),O([]);return}const ce=await Ye.listPaymentsForCase(W);O(ce);const ge=(await Ye.listSheets()).filter(Nt=>Nt.id!==t.sheet.id).filter(Nt=>ke(Nt.caseId)===de);if(!ge.length){se([]),X([]);return}ge.sort((Nt,rt)=>{const Yt=new Date(Nt.updatedAt||Nt.createdAt).getTime();return new Date(rt.updatedAt||rt.createdAt).getTime()-Yt});const Se=ge.slice(0,3),Ee=[],Me=[];for(const Nt of Se){const rt=await Ye.getSheet(Nt.id);if(!rt)continue;const Yt=Ye.getPaidToDateForSheet(rt.sheet),Ht=Dn({...rt.sheet,alreadyPaidAmount:Yt},rt.lineItems),ls=rt.lineItems.filter(is=>is.kind==="EXPENSE");Me.push(...ls),Ee.push({id:rt.sheet.id,versionIndex:rt.sheet.versionIndex,status:rt.sheet.status,createdAt:rt.sheet.createdAt,updatedAt:rt.sheet.updatedAt,deductibleAmount:rt.sheet.deductibleAmount??0,alreadyPaidAmount:Yt,amountToRequest:Ht.amountToRequest})}Ee.sort((Nt,rt)=>{const Yt=new Date(Nt.updatedAt||Nt.createdAt).getTime();return new Date(rt.updatedAt||rt.createdAt).getTime()-Yt}),se(Ee),X(Me);const Qe=Ye.buildCumulativeExpensesSnapshot(t.sheet.id,new Date().toISOString());if(Qe){const Nt=Dn(Qe.effectiveSheet,Qe.allLines);xe(Nt)}else xe(null)}catch{se([]),O([]),X([]),xe(null)}})()},[t]);const ve=g.useMemo(()=>Dn(fe,i),[fe,i]),_e=g.useMemo(()=>{const _=new Set;return U.forEach(W=>{W.scope==="LINE_ITEM"&&W.entityId&&_.add(W.entityId)}),_},[U]),ze=()=>{const _=Rp({sheet:l,lineItems:i,attachments:x,ruleset:void 0});N(_.issues)};g.useEffect(()=>{ze()},[l,i]),g.useEffect(()=>{if(!(typeof window>"u"))try{const _=window.localStorage.getItem("financeProviderSuggestions"),W=window.localStorage.getItem("financeDescriptionSuggestions");if(_){const de=JSON.parse(_);Array.isArray(de)&&G(de.filter(ce=>typeof ce=="string"))}if(W){const de=JSON.parse(W);Array.isArray(de)&&j(de.filter(ce=>typeof ce=="string"))}}catch{}},[]),g.useEffect(()=>{if(typeof window>"u")return;const _=new Set(te);let W=!1;if(i.forEach(ne=>{const ge=(ne.providerName||"").trim();ge&&!_.has(ge)&&(_.add(ge),W=!0)}),W){const ne=Array.from(_).sort((ge,Se)=>ge.localeCompare(Se,"he-IL"));G(ne);try{window.localStorage.setItem("financeProviderSuggestions",JSON.stringify(ne))}catch{}}const de=new Set(le);let ce=!1;if(i.forEach(ne=>{const ge=(ne.description||"").trim();ge&&!de.has(ge)&&(de.add(ge),ce=!0)}),ce){const ne=Array.from(de).sort((ge,Se)=>ge.localeCompare(Se,"he-IL"));j(ne);try{window.localStorage.setItem("financeDescriptionSuggestions",JSON.stringify(ne))}catch{}}},[i]);const qe=_=>{c(W=>({...W,..._}))},$e=(_,W)=>{u(de=>{const ce=[...de];return ce[_]={...ce[_],...W,sheetId:l.id},ce})},st=()=>{const _={id:`tmp-${Date.now()}`,sheetId:l.id,kind:"EXPENSE",expenseType:null,providerName:"",providerId:null,description:"",date:new Date().toISOString().slice(0,10),quantity:1,unitPrice:0,vatRate:18,isIncludedInRequestedAmount:!0,lineNetAmount:null,lineVatAmount:null,lineTotalAmount:null,attachmentId:null,createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()};u(W=>[...W,_])},Je=_=>{const W=i[_];W&&(u(de=>de.filter((ce,ne)=>ne!==_)),W.id.startsWith("tmp-")||Ye.deleteLineItem(e,l.id,W.id))},J=async _=>{const W=Array.from(_);if(W.length)for(let de=0;de<W.length;de++){const ce=W[de],ne=new FileReader,ge=await new Promise((Ee,Me)=>{ne.onload=()=>Ee(String(ne.result)),ne.onerror=()=>Me(ne.error),ne.readAsDataURL(ce)}),Se=await Ye.addAttachment(e,l.id,{fileKey:ge,originalFileName:ce.name,mimeType:ce.type||"application/octet-stream",sizeBytes:ce.size});Se&&b(Ee=>[...Ee,Se])}},re=async _=>{const{files:W}=_.target;!W||!W.length||(await J(W),_.target.value="")},D=async _=>{_.preventDefault(),_.stopPropagation();const{files:W}=_.dataTransfer;!W||!W.length||await J(W)},ae=async(_,W)=>{const de=W||"";try{const ce=await Ye.linkAttachmentToLineItem(e,l.id,de,W?_.id:null);b(ne=>ne.map(ge=>ce&&ge.id===ce.id?ce:!ce&&ge.id===de?{...ge,linkedLineItemId:W?_.id:null}:ge)),u(ne=>ne.map(ge=>ge.id===_.id?{...ge,attachmentId:W||null}:ge.id===_.attachmentId&&!W?{...ge,attachmentId:null}:ge)),w(W?" /     .":"    .")}catch(ce){console.error("Failed to link attachment to line item",ce)}},ee=async()=>{if(!((e.role==="SUB_ADMIN"||e.role==="ADMIN")&&(l.status==="READY_FOR_REPORT"||l.status==="ATTACHED_TO_REPORT"||l.status==="ARCHIVED")&&!window.confirm(`     (  /   / ).
         .

  ?`))){y(!0);try{const W=await Ye.updateSheetMeta(e,l.id,{insurerName:l.insurerName,periodLabel:l.periodLabel,deductibleAmount:l.deductibleAmount??0,alreadyPaidAmount:l.alreadyPaidAmount??0,infoOnly:l.infoOnly}),de=[];for(const ne of i)if(ne.id.startsWith("tmp-")){const ge=await Ye.addLineItem(e,l.id,{kind:ne.kind,expenseType:ne.expenseType,providerName:ne.providerName,providerId:ne.providerId,description:ne.description,date:ne.date,quantity:ne.quantity,unitPrice:ne.unitPrice,vatRate:ne.vatRate,isIncludedInRequestedAmount:ne.isIncludedInRequestedAmount,lineNetAmount:ne.lineNetAmount,lineVatAmount:ne.lineVatAmount,lineTotalAmount:ne.lineTotalAmount,attachmentId:ne.attachmentId});ge&&de.push(ge)}else{const ge=await Ye.updateLineItem(e,l.id,ne.id,{kind:ne.kind,expenseType:ne.expenseType,providerName:ne.providerName,providerId:ne.providerId,description:ne.description,date:ne.date,quantity:ne.quantity,unitPrice:ne.unitPrice,vatRate:ne.vatRate,isIncludedInRequestedAmount:ne.isIncludedInRequestedAmount,lineNetAmount:ne.lineNetAmount,lineVatAmount:ne.lineVatAmount,lineTotalAmount:ne.lineTotalAmount,attachmentId:ne.attachmentId});ge&&de.push(ge)}const ce=await Ye.getSheet(l.id)||{sheet:W||l,lineItems:de,attachments:[]};s(ce),w("  .")}finally{y(!1)}}},be=async()=>{y(!0);try{const _=await Ye.getRulesetForSheet(l),W=Rp({sheet:l,lineItems:i,attachments:x,ruleset:_}),de=W.issues.map(ge=>ge.code==="MISSING_ATTACHMENT_REQUIRED"&&ge.severity==="ERROR"?{...ge,severity:"WARNING"}:ge);N(de);const ce=de.filter(ge=>ge.severity==="ERROR"&&ge.code!=="MISSING_ATTACHMENT_REQUIRED");if(ce.length){const ge=ce.map(Se=>` ${Se.messageHe}`).join(`
`);q(ge),H(!0),w("          .");return}const ne=await Ye.recordReadyAttempt(e,{sheetId:l.id,success:!0,decisionLog:W.decisionLog});if(ne){c(ne);const ge=await Ye.getSheet(ne.id)||{sheet:ne,lineItems:i,attachments:x};s(ge),a&&a({caseId:ne.caseId,sheetId:ne.id,lawyerId:T==="AUTO"?void 0:T});const Se=T==="AUTO"?(o==null?void 0:o.ownerName)||"  ":(o==null?void 0:o.ownerName)||" ";w(`       ${Se}   ${ne.caseId}.`)}}finally{y(!1)}},Oe=()=>{const _=Ye.buildCumulativeExpensesSnapshot(l.id,new Date().toISOString());if(!_)return;const{effectiveSheet:W,allLines:de,opts:ce}=_,{html:ne}=ri(W,de,ce);k(ne)},Ae=_=>_e.has(_),Re=g.useMemo(()=>{const _=new Set(te);return i.forEach(W=>{W.providerName&&_.add(W.providerName)}),Array.from(_).sort((W,de)=>W.localeCompare(de,"he-IL"))},[i,te]),Ge=g.useMemo(()=>{const _=new Set(le);return i.forEach(W=>{W.description&&_.add(W.description)}),Array.from(_).sort((W,de)=>W.localeCompare(de,"he-IL"))},[i,le]),He=()=>{const _={sheet:l,lineItems:i,attachments:x,totals:ve},W=new Blob([JSON.stringify(_,null,2)],{type:"application/json"}),de=URL.createObjectURL(W),ce=document.createElement("a");ce.href=de,ce.download=`expenses-${l.caseId||l.id}.json`,ce.click(),URL.revokeObjectURL(de)},Pe=()=>{const _=["LineId","Date","Provider","Description","Quantity","UnitPrice","VatRate","IncludedInRequest","LineTotal"],W=i.map(Se=>[Se.id,Se.date||"",(Se.providerName||"").replace(/"/g,'""'),(Se.description||"").replace(/"/g,'""'),Se.quantity??"",Se.unitPrice??"",Se.vatRate??"",Se.isIncludedInRequestedAmount!==!1?"YES":"NO",Se.lineTotalAmount??""]),de=[_.join(","),...W.map(Se=>Se.map(Ee=>{const Me=String(Ee??"");return/[",\n]/.test(Me)?`"${Me}"`:Me}).join(","))].join(`
`),ce=new Blob(["\uFEFF"+de],{type:"text/csv;charset=utf-8;"}),ne=URL.createObjectURL(ce),ge=document.createElement("a");ge.href=ne,ge.download=`expenses-${l.caseId||l.id}.csv`,ge.click(),URL.revokeObjectURL(ne)},Q=g.useMemo(()=>{if(!o)return l.status==="READY_FOR_REPORT"?"   (  ).":l.status==="ATTACHED_TO_REPORT"||l.status==="ARCHIVED"?"     .":"  .";switch(o.status){case"TASK_ASSIGNED":return"      .";case"WAITING_FOR_INVOICES":return"   /  .";case"PENDING_REVIEW":return'"   / .';case"READY_TO_SEND":return'"    .';case"SENT":return'"   .';default:return"    ."}},[o,l.status]),ye=g.useMemo(()=>o?[{id:o.createdBy,name:o.ownerName||'" '}]:[],[o]);return n.jsxs("div",{className:"flex flex-col gap-4",children:[n.jsxs("div",{className:"flex items-center justify-between",children:[n.jsxs("div",{children:[n.jsxs("h2",{className:"text-xl font-semibold text-gray-900",children:["  : ",n.jsx("span",{className:"font-mono",children:l.caseId})]}),n.jsxs("p",{className:"text-sm text-gray-600",children:[": ",n.jsx("span",{children:Cp[l.status]})]}),n.jsxs("p",{className:"mt-1 text-xs text-gray-600",children:['  ":'," ",n.jsx("span",{className:"font-medium text-gray-800",children:Q})]})]}),n.jsxs("div",{className:"flex gap-3 flex-wrap justify-end items-center",children:[ye.length>0&&n.jsxs("div",{className:"text-xs text-gray-700",children:[n.jsx("label",{className:"block mb-1 font-medium",children:"     "}),n.jsxs("select",{className:"border rounded px-2 py-1 text-xs bg-white",value:T,onChange:_=>E(_.target.value||"AUTO"),children:[n.jsx("option",{value:"AUTO",children:'   "  '}),ye.map(_=>n.jsx("option",{value:_.id,children:_.name},_.id))]})]}),n.jsx("button",{type:"button",className:"px-3 py-1 text-sm rounded border border-gray-300 text-gray-700 hover:bg-gray-50",onClick:r,children:" "}),n.jsx("button",{type:"button",className:"px-3 py-1.5 text-sm rounded border border-blue-300 text-blue-700 hover:bg-blue-50",onClick:Oe,children:" "}),n.jsx("button",{type:"button",className:"px-4 py-1.5 text-sm rounded bg-emerald-600 text-white hover:bg-emerald-700 disabled:opacity-50",onClick:be,disabled:p,children:"   "}),n.jsx("button",{type:"button",className:"px-4 py-1.5 text-sm rounded bg-blue-600 text-white hover:bg-blue-700 disabled:opacity-50",onClick:ee,disabled:p,children:p?"":" "}),n.jsx("button",{type:"button",className:"px-3 py-1.5 text-xs rounded border border-gray-300 text-gray-700 hover:bg-gray-50",onClick:He,children:" JSON"}),n.jsx("button",{type:"button",className:"px-3 py-1.5 text-xs rounded border border-gray-300 text-gray-700 hover:bg-gray-50",onClick:Pe,children:" Excel (CSV)"})]})]}),S&&n.jsx("div",{className:"mt-2 rounded border border-green-200 bg-green-50 px-3 py-2 text-sm text-green-800",children:S}),L&&n.jsxs("div",{className:"mt-2 rounded border border-gray-300 bg-white px-3 py-3 text-sm text-left",children:[n.jsxs("div",{className:"flex justify-between items-center mb-2",children:[n.jsx("span",{className:"font-semibold text-gray-800",children:"Expenses Table  Preview"}),n.jsx("button",{type:"button",className:"text-sm text-blue-600 hover:underline",onClick:()=>k(null),children:""})]}),n.jsx("div",{className:"overflow-x-auto text-base",dangerouslySetInnerHTML:{__html:L}})]}),n.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 bg-white border rounded-lg p-4 shadow-sm",children:[n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:""}),n.jsx("input",{className:"w-full border rounded px-2 py-1 text-sm",value:l.insurerName||"",onChange:_=>qe({insurerName:_.target.value})})]}),n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:" / "}),n.jsx("input",{className:"w-full border rounded px-2 py-1 text-sm",value:l.periodLabel||"",onChange:_=>qe({periodLabel:_.target.value})})]}),n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:" "}),n.jsx("input",{type:"number",className:"w-full border rounded px-2 py-1 text-sm",value:l.deductibleAmount??0,onChange:_=>{const W=Number(_.target.value),de=Number.isFinite(W)?Math.max(0,W):0;qe({deductibleAmount:de})}})]}),n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"  "}),n.jsx("input",{type:"number",className:"w-full border rounded px-2 py-1 text-sm bg-gray-50",value:oe,readOnly:!0})]}),n.jsxs("div",{className:"flex items-center gap-2 mt-2",children:[n.jsx("input",{id:"infoOnly",type:"checkbox",checked:l.infoOnly,onChange:_=>qe({infoOnly:_.target.checked})}),n.jsx("label",{htmlFor:"infoOnly",className:"text-sm text-gray-800",children:"   (  )"})]})]}),n.jsxs("div",{className:"flex flex-col gap-2",children:[n.jsxs("div",{className:"flex items-center justify-between text-xs text-gray-700 px-1",children:[n.jsx("span",{className:"font-semibold",children:"    (  )"}),n.jsx("span",{className:"text-gray-500",children:"   / PDF     ."})]}),n.jsxs("div",{className:"flex flex-wrap gap-4 items-center bg-blue-50 border border-blue-100 rounded-lg p-4 text-sm",children:[n.jsxs("div",{children:[n.jsx("div",{className:"text-gray-600",children:"   "}),n.jsxs("div",{className:"font-semibold",children:[ve.grossExpensesTotal.toLocaleString("he-IL")," "]})]}),n.jsxs("div",{children:[n.jsx("div",{className:"text-gray-600",children:"   (  +  + )"}),n.jsxs("div",{className:"font-semibold",children:[ve.adjustmentsTotal.toLocaleString("he-IL")," "]})]}),n.jsxs("div",{children:[n.jsx("div",{className:"text-gray-600",children:"     INFO_ONLY"}),n.jsxs("div",{className:"font-semibold",children:[ve.amountBeforeInfoOnly.toLocaleString("he-IL")," "]})]}),n.jsxs("div",{children:[n.jsx("div",{className:"text-gray-600",children:"   "}),n.jsxs("div",{className:"font-semibold text-blue-700",children:[ve.amountToRequest.toLocaleString("he-IL")," "]})]}),ve.infoOnlyApplied&&n.jsx("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-yellow-100 text-yellow-800",children:"INFO_ONLY    (  )"})]}),n.jsx("div",{className:"px-1 text-[11px] text-gray-500",children:" :         .   (Expenses Table)   -PDF        ."})]}),ue&&n.jsxs("div",{className:"mt-3 flex flex-col gap-2",children:[n.jsx("div",{className:"flex items-center justify-between text-xs text-slate-700 px-1",children:n.jsx("span",{className:"font-semibold",children:"   ( +  )"})}),n.jsxs("div",{className:"flex flex-wrap gap-4 items-center bg-indigo-50 border border-indigo-100 rounded-lg p-4 text-sm",children:[n.jsxs("div",{children:[n.jsx("div",{className:"text-slate-600",children:"   "}),n.jsxs("div",{className:"font-semibold",children:[ue.grossExpensesTotal.toLocaleString("he-IL")," "]})]}),n.jsxs("div",{children:[n.jsx("div",{className:"text-slate-600",children:"  (  +  + )"}),n.jsxs("div",{className:"font-semibold",children:[ue.adjustmentsTotal.toLocaleString("he-IL")," "]})]}),n.jsxs("div",{children:[n.jsx("div",{className:"text-slate-600",children:"   "}),n.jsxs("div",{className:"font-semibold",children:[oe.toLocaleString("he-IL")," "]})]}),n.jsxs("div",{children:[n.jsx("div",{className:"text-slate-600",children:"  /  ()"}),n.jsxs("div",{className:"font-semibold text-indigo-700",children:[ue.amountToRequest.toLocaleString("he-IL")," "]})]})]})]}),n.jsxs("div",{className:"mt-2 text-xs text-gray-500 bg-white border border-dashed border-gray-300 rounded-md p-2",children:[n.jsx("span",{className:"font-semibold mr-1",children:" :"}),"    (, , , ,  ).       ,            ."]}),n.jsxs("div",{className:"bg-white border rounded-lg p-4 shadow-sm flex flex-col gap-2 text-sm",onDragOver:_=>{_.preventDefault(),_.stopPropagation()},onDrop:D,children:[n.jsxs("div",{className:"flex items-center justify-between",children:[n.jsx("div",{className:"font-medium text-gray-900",children:""}),n.jsxs("label",{className:"inline-flex items-center gap-2 cursor-pointer text-xs text-blue-700 hover:text-blue-800",children:[n.jsx("span",{className:"px-2 py-1 border border-blue-400 rounded bg-blue-50",children:" "}),n.jsx("input",{type:"file",className:"hidden",multiple:!0,onChange:re})]})]}),n.jsx("p",{className:"text-xs text-gray-500",children:"         ."}),x.length===0?n.jsx("div",{className:"text-gray-500 text-xs",children:"    ."}):n.jsx("ul",{className:"divide-y divide-gray-100",children:x.map(_=>n.jsxs("li",{className:"py-1 flex items-center justify-between gap-4",children:[n.jsxs("div",{className:"flex flex-col",children:[n.jsx("span",{className:"text-gray-900 text-xs",children:_.originalFileName}),n.jsxs("span",{className:"text-gray-500 text-[11px]",children:[": ",_.sizeBytes!=null?`${(_.sizeBytes/1024).toFixed(1)} KB`:" ","  "," ",_.uploadedAt?new Date(_.uploadedAt).toLocaleString("he-IL",{dateStyle:"short",timeStyle:"short"}):""]})]}),n.jsx("button",{type:"button",className:"text-xs text-blue-700 hover:underline",onClick:()=>{_.fileKey.startsWith("data:")&&window.open(_.fileKey,"_blank")},children:" / "})]},_.id))})]}),U.length>0&&n.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-lg p-3 text-sm",children:[n.jsx("div",{className:"font-semibold text-red-800 mb-1",children:"  :"}),n.jsx("ul",{className:"list-disc pr-5 space-y-0.5",children:U.map(_=>n.jsxs("li",{children:[n.jsxs("span",{className:"font-mono text-xs text-gray-500 ml-1",children:["[",_.severity,"]"]}),n.jsxs("span",{className:"text-red-900",children:[" ",_.messageHe]})]},`${_.code}-${_.scope}-${_.entityId||"sheet"}`))})]}),n.jsxs("div",{className:"bg-white border rounded-lg shadow-sm overflow-x-auto",children:[n.jsxs("table",{className:"min-w-full text-sm",children:[n.jsx("thead",{className:"bg-gray-50",children:n.jsxs("tr",{children:[n.jsx("th",{className:"px-2 py-1 border-b text-right",children:""}),n.jsx("th",{className:"px-2 py-1 border-b text-right",children:""}),n.jsx("th",{className:"px-2 py-1 border-b text-right",children:""}),n.jsx("th",{className:"px-2 py-1 border-b text-right",children:""}),n.jsx("th",{className:"px-2 py-1 border-b text-right",children:""}),n.jsx("th",{className:"px-2 py-1 border-b text-right",children:" "}),n.jsx("th",{className:"px-2 py-1 border-b text-right",children:" %"}),n.jsx("th",{className:"px-2 py-1 border-b text-right",children:" "}),n.jsx("th",{className:"px-2 py-1 border-b text-right",children:" "}),n.jsx("th",{className:"px-2 py-1 border-b text-right",children:""}),n.jsx("th",{className:"px-2 py-1 border-b"})]})}),n.jsxs("tbody",{children:[P.length>0&&n.jsx("tr",{children:n.jsx("td",{className:"px-2 py-1 border-b text-xs text-slate-600 bg-slate-50",colSpan:9,children:"  ( )      ."})}),P.map((_,W)=>{if(_.kind!=="EXPENSE")return null;const de=_.lineTotalAmount??(_.quantity??0)*(_.unitPrice??0)*(1+(_.vatRate??0)/100);return n.jsxs("tr",{className:"bg-slate-50 text-slate-700",children:[n.jsx("td",{className:"px-2 py-1 border-b text-[11px] text-slate-500",children:""}),n.jsx("td",{className:"px-2 py-1 border-b text-xs",children:_.providerName||""}),n.jsx("td",{className:"px-2 py-1 border-b text-xs",children:_.description||""}),n.jsx("td",{className:"px-2 py-1 border-b text-xs whitespace-nowrap",children:_.date||""}),n.jsx("td",{className:"px-2 py-1 border-b text-xs",children:_.quantity??""}),n.jsx("td",{className:"px-2 py-1 border-b text-xs",children:_.unitPrice??""}),n.jsx("td",{className:"px-2 py-1 border-b text-xs",children:_.vatRate??""}),n.jsx("td",{className:"px-2 py-1 border-b text-xs",children:Number.isFinite(de)?de.toLocaleString("he-IL"):""}),n.jsx("td",{className:"px-2 py-1 border-b text-[11px] text-slate-400",children:" "})]},`hist-${_.id}-${W}`)}),i.map((_,W)=>{const de=Ae(_.id),ce=x.find(Ee=>Ee.id===_.attachmentId),ne=_.kind==="COMPENSATION",ge=_.kind==="EXPENSE",Se=_.kind==="COMPENSATION"?_.compensationSource==="COURT"?"COMPENSATION_COURT":"COMPENSATION_SETTLEMENT":_.kind;return n.jsxs("tr",{className:`${de?"bg-red-50":W%2===0?"bg-white":"bg-gray-50"} ${ge?"border-l-4 border-emerald-300 bg-emerald-50/60":""}`,children:[n.jsx("td",{className:"px-2 py-1 border-b",children:n.jsxs("select",{className:"border rounded px-1 py-0.5 text-xs",value:Se,onChange:Ee=>{const Me=Ee.target.value;Me==="EXPENSE"?$e(W,{kind:"EXPENSE",compensationSource:null}):Me==="ADJUSTMENT"?$e(W,{kind:"ADJUSTMENT",compensationSource:null}):Me==="COMPENSATION_SETTLEMENT"?$e(W,{kind:"COMPENSATION",compensationSource:"SETTLEMENT",providerName:"",expenseType:null,vatRate:0,quantity:1}):Me==="COMPENSATION_COURT"&&$e(W,{kind:"COMPENSATION",compensationSource:"COURT",providerName:"",expenseType:null,vatRate:0,quantity:1})},children:[n.jsx("option",{value:"EXPENSE",children:"Expense"}),n.jsx("option",{value:"COMPENSATION_SETTLEMENT",children:"Compensation pursuant to a settlement"}),n.jsx("option",{value:"COMPENSATION_COURT",children:"Compensation pursuant to a judgment"}),n.jsx("option",{value:"ADJUSTMENT",children:"Adjustment"})]})}),n.jsx("td",{className:"px-2 py-1 border-b",children:ne?n.jsx("span",{className:"text-[11px] text-gray-400 whitespace-nowrap",children:"  "}):n.jsxs("div",{className:"flex items-center gap-1",children:[ge&&n.jsx("span",{className:"inline-flex items-center rounded-full bg-emerald-100 text-emerald-700 text-[10px] px-2 py-[1px]",children:""}),n.jsx("input",{list:"provider-suggestions",className:"border rounded px-1 py-0.5 w-32 text-xs",placeholder:" ",value:_.providerName||"",onChange:Ee=>$e(W,{providerName:Ee.target.value})})]})}),n.jsx("td",{className:"px-2 py-1 border-b",children:n.jsx("input",{className:"border rounded px-1 py-0.5 w-64 text-xs",list:"description-suggestions",value:_.description,onChange:Ee=>$e(W,{description:Ee.target.value})})}),n.jsx("td",{className:"px-2 py-1 border-b",children:n.jsx("input",{type:"date",className:"border rounded px-1 py-0.5 text-xs",value:_.date||"",onChange:Ee=>$e(W,{date:Ee.target.value||null})})}),n.jsx("td",{className:"px-2 py-1 border-b",children:n.jsx("input",{type:"number",className:"border rounded px-1 py-0.5 w-20 text-xs disabled:bg-gray-100 disabled:text-gray-400",value:_.quantity??1,disabled:ne,onChange:Ee=>{if(ne)return;const Me=Number(Ee.target.value),Qe=Number.isFinite(Me)?Math.max(0,Me):0;$e(W,{quantity:Qe})}})}),n.jsx("td",{className:"px-2 py-1 border-b",children:n.jsx("input",{type:"number",className:"border rounded px-1 py-0.5 w-24 text-xs",value:_.unitPrice??0,onChange:Ee=>{const Me=Number(Ee.target.value),Qe=Number.isFinite(Me)?Math.max(0,Me):0;$e(W,{unitPrice:Qe})}})}),n.jsx("td",{className:"px-2 py-1 border-b",children:n.jsx("input",{type:"number",className:"border rounded px-1 py-0.5 w-16 text-xs disabled:bg-gray-100 disabled:text-gray-400",value:_.vatRate??0,disabled:ne,onChange:Ee=>{if(ne)return;const Me=Number(Ee.target.value),Qe=Number.isFinite(Me)?Math.max(0,Me):0;$e(W,{vatRate:Qe})}})}),n.jsx("td",{className:"px-2 py-1 border-b text-center",children:n.jsx("input",{type:"checkbox",checked:_.isIncludedInRequestedAmount!==!1,onChange:Ee=>$e(W,{isIncludedInRequestedAmount:Ee.target.checked})})}),n.jsx("td",{className:"px-2 py-1 border-b text-left font-mono text-xs",children:_.lineTotalAmount!=null?_.lineTotalAmount.toLocaleString("he-IL"):""}),n.jsxs("td",{className:"px-2 py-1 border-b text-right",children:[n.jsxs("div",{className:"flex items-center justify-end gap-2",children:[n.jsxs("select",{className:"border rounded px-1 py-0.5 text-xs max-w-[190px]",value:_.attachmentId||"",title:ce?` : ${ce.originalFileName}`:"   ",onChange:Ee=>void ae(_,Ee.target.value?Ee.target.value:null),children:[n.jsx("option",{value:"",children:x.length?"   ":"  "}),x.map(Ee=>n.jsx("option",{value:Ee.id,children:Ee.originalFileName},Ee.id))]}),_.attachmentId?n.jsxs("span",{className:"inline-flex items-center gap-1 text-[11px] text-emerald-700 font-semibold whitespace-nowrap",children:[n.jsx("span",{className:"text-emerald-600",children:""}),n.jsx("span",{children:" "})]}):n.jsx("span",{className:"inline-flex items-center gap-1 text-[11px] text-gray-500 whitespace-nowrap",children:" "})]}),ce&&n.jsxs("div",{className:"mt-0.5 text-[11px] text-gray-700 text-left",children:[n.jsx("span",{className:"text-gray-500",children:":"})," ",n.jsx("span",{className:"font-mono break-all",children:ce.originalFileName})]})]}),n.jsx("td",{className:"px-2 py-1 border-b text-center",children:n.jsx("button",{type:"button",className:"text-xs text-red-600 hover:underline",onClick:()=>Je(W),children:""})})]},_.id)})]})]}),n.jsx("datalist",{id:"provider-suggestions",children:Re.map(_=>n.jsx("option",{value:_},_))}),n.jsx("datalist",{id:"description-suggestions",children:Ge.map(_=>n.jsx("option",{value:_},_))}),n.jsx("div",{className:"p-2",children:n.jsx("button",{type:"button",className:"px-3 py-1 text-xs rounded border border-dashed border-gray-400 text-gray-700 hover:bg-gray-50",onClick:st,children:" "})})]}),n.jsxs("div",{className:"mt-4 rounded-lg border border-slate-200 bg-slate-50 p-3 text-xs",children:[n.jsxs("div",{className:"flex justify-between items-center mb-2",children:[n.jsx("span",{className:"font-semibold text-slate-800",children:" "}),n.jsxs("span",{className:"text-slate-700",children:["    : ",oe.toLocaleString("he-IL")]})]}),n.jsx(Ob,{user:e,sheet:l,paymentEvents:Y,onChangeEvents:O})]}),C.length>0&&n.jsxs("div",{className:"mt-4 rounded-lg border border-slate-200 bg-slate-50 p-3 text-xs",children:[n.jsxs("div",{className:"flex justify-between items-center mb-2",children:[n.jsx("span",{className:"font-semibold text-slate-800",children:"  "}),n.jsxs("span",{className:"text-slate-500",children:["  ",C.length,"    "]})]}),n.jsx("div",{className:"space-y-2",children:C.map(_=>n.jsxs("div",{className:"rounded border border-slate-200 bg-white px-2 py-1 flex flex-wrap gap-x-4 gap-y-1 items-baseline",children:[n.jsxs("span",{className:"font-semibold text-slate-800",children:[" #",_.versionIndex||1]}),n.jsxs("span",{className:"text-slate-600",children:[": ",Cp[_.status]||_.status]}),n.jsxs("span",{className:"text-slate-500",children:[":"," ",new Date(_.updatedAt||_.createdAt).toLocaleString("he-IL",{dateStyle:"short",timeStyle:"short"})]}),n.jsxs("span",{className:"text-slate-700",children:[" : ",_.deductibleAmount.toLocaleString("he-IL")]}),n.jsxs("span",{className:"text-slate-700",children:["  : ",_.alreadyPaidAmount.toLocaleString("he-IL")]}),n.jsxs("span",{className:"text-slate-700",children:[" : ",_.amountToRequest.toLocaleString("he-IL")]})]},_.id))})]}),n.jsx(_b,{open:F,title:"    ",message:V?`      :

${V}`:"      .",confirmText:"",cancelText:"",onConfirm:()=>H(!1),onCancel:()=>H(!1)})]})},Mb=[{id:"READY",label:" "},{id:"ATTACHED",label:" "},{id:"SENT",label:""},{id:"EXCEPTIONS",label:""}],Dp={DRAFT:"",READY_FOR_REPORT:" ",ATTACHED_TO_REPORT:" ",ARCHIVED:""},Pb=({user:e,reports:t,onOpenReport:s})=>{var Je;const[r,a]=g.useState("READY"),[o,l]=g.useState(""),[c,i]=g.useState(""),[u,p]=g.useState(""),[y,S]=g.useState(""),[w,L]=g.useState(""),[k,U]=g.useState([]),[N,x]=g.useState(null),[b,F]=g.useState(null),[H,V]=g.useState(!1),[q,te]=g.useState(null),[G,le]=g.useState(null),[j,T]=g.useState(null),[E,C]=g.useState(!1),[se,Y]=g.useState(null),[O,P]=g.useState(null),[X,ue]=g.useState(!1),[xe,oe]=g.useState(!1),[fe,ve]=g.useState(0);g.useMemo(()=>{if(!N)return 0;switch(r){case"READY":return N.readyCount;case"ATTACHED":return N.attachedCount;case"SENT":return N.sentCount;case"EXCEPTIONS":return N.exceptionsCount;default:return 0}},[N,r]);const _e=J=>{if(J==null)return"";if(J<24)return`${J.toFixed(1)} `;const re=Math.floor(J/24),D=J%24;return D<1?`${re} `:`${re}  ${D.toFixed(1)} `};g.useEffect(()=>{let J=!1;return(async()=>{V(!0),te(null);try{const[D,ae]=await Promise.all([Ye.getLidorCounts(e,t),Ye.getLidorKpis(e,t)]);J||(x(D),F(ae));const ee={};r==="READY"?ee.status="READY_FOR_REPORT":r==="ATTACHED"&&(ee.status="ATTACHED_TO_REPORT"),o.trim()&&(ee.insurerName=o.trim()),u&&(ee.dateFrom=u),y&&(ee.dateTo=y),w.trim()&&(ee.caseIdOrSearch=w.trim()),c&&(ee.status=c);const be=await Ye.listSheetsForLidor(e,ee,t);let Oe=be;r==="SENT"?Oe=be.filter(Ae=>Ae.sentAt):r==="EXCEPTIONS"&&(Oe=be.filter(Ae=>Ae.expensesOutOfSync||Ae.blockingIssueCodesLatest&&Ae.blockingIssueCodesLatest.length>0)),J||(U(Oe),le(null),P(null))}catch(D){console.error(D),J||te("    . /   .")}finally{J||V(!1)}})(),()=>{J=!0}},[e,t,r,o,c,u,y,w,fe]);const ze=async J=>{le(J),P(null),Y(null),C(!0);try{const re=await Ye.getSheet(J.sheetId),D=await Ye.getSheetAuditForLidor(e,J.sheetId,200),ae=await Ye.getExceptionStatusForSheet(e,J.sheetId);P(re?{sheet:re.sheet,lineItems:re.lineItems,attachments:re.attachments,audit:D,exceptionStatus:ae}:{sheet:null,lineItems:[],attachments:[],audit:D,exceptionStatus:ae})}catch(re){console.error(re),Y("     .")}finally{C(!1)}},qe=()=>{if(!O||!O.sheet)return;const J={sheet:O.sheet,lineItems:O.lineItems,attachments:O.attachments};T(J)},$e=()=>{T(null),ve(J=>J+1)};if(j)return n.jsxs("div",{className:"bg-white rounded-xl border border-slate-200 shadow-sm p-4 mt-4",dir:"rtl",children:[n.jsxs("header",{className:"flex items-center justify-between mb-4",children:[n.jsxs("div",{children:[n.jsx("h2",{className:"text-xl font-bold text-slate-900",children:"   ()"}),n.jsx("p",{className:"text-sm text-slate-600 mt-1",children:"           ."})]}),n.jsx("button",{type:"button",className:"px-3 py-1.5 rounded border border-slate-300 text-sm text-slate-700 hover:bg-slate-100",onClick:$e,children:"  "})]}),n.jsx(_h,{user:e,sheetWithRelations:j,onSheetUpdated:J=>{T(J)},onBack:$e})]});const st=async J=>{if(!(!G||!O))try{await Ye.setExceptionStatusForSheet(e,G.sheetId,J),P({...O,exceptionStatus:J})}catch(re){Ku("Failed to update financial exception status",re),Y("     .")}};return n.jsxs("div",{className:"bg-white rounded-xl border border-slate-200 shadow-sm p-4 mt-4",dir:"rtl",children:[n.jsx("header",{className:"flex flex-col md:flex-row md:items-center md:justify-between gap-4 mb-4",children:n.jsxs("div",{children:[n.jsx("h2",{className:"text-xl font-bold text-slate-900",children:" "}),n.jsx("p",{className:"text-sm text-slate-600 mt-1",children:"-    ,      ."}),b&&n.jsxs("p",{className:"mt-1 text-xs text-slate-500",children:["  :"," ",b.exceptions.divergenceOld.count+b.exceptions.missingAttachments.count+b.exceptions.repeatedBlocks.count]})]})}),b&&n.jsxs("section",{className:"mb-4 grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 xl:grid-cols-4 gap-3 text-xs",children:[n.jsxs("div",{className:"rounded-xl border border-slate-200 bg-slate-50 px-3 py-2.5",children:[n.jsx("p",{className:"text-slate-500 mb-1",children:"   "}),n.jsx("p",{className:"text-sm font-semibold text-slate-900",children:_e(b.sla.draftToReadyAvgHours)})]}),n.jsxs("div",{className:"rounded-xl border border-slate-200 bg-slate-50 px-3 py-2.5",children:[n.jsx("p",{className:"text-slate-500 mb-1",children:"   "}),n.jsx("p",{className:"text-sm font-semibold text-slate-900",children:_e(b.sla.readyToAttachedAvgHours)})]}),n.jsxs("div",{className:"rounded-xl border border-slate-200 bg-slate-50 px-3 py-2.5",children:[n.jsx("p",{className:"text-slate-500 mb-1",children:"   "}),n.jsx("p",{className:"text-sm font-semibold text-slate-900",children:_e(b.sla.attachedToSentAvgHours)})]}),n.jsxs("div",{className:"rounded-xl border border-blue-100 bg-blue-50 px-3 py-2.5",children:[n.jsx("p",{className:"text-slate-600 mb-1",children:"  "}),n.jsxs("p",{className:"text-sm font-semibold text-blue-800",children:[b.volumes.totalAmountRequested.toLocaleString("he-IL")," "]}),n.jsxs("p",{className:"text-[11px] text-slate-500 mt-0.5",children:[b.volumes.totalSheets||0,"  "," ",b.volumes.totalSentReports||0,"  "]})]})]}),b&&n.jsxs("section",{className:"mb-4",children:[n.jsx("h3",{className:"text-sm font-semibold text-slate-700 mb-1",children:"  "}),n.jsxs("div",{className:"flex flex-wrap gap-2 text-xs",children:[n.jsxs("button",{type:"button",className:"inline-flex items-center gap-1 px-3 py-1.5 rounded-full border border-amber-200 bg-amber-50 text-amber-800 hover:bg-amber-100 transition disabled:opacity-40 disabled:hover:bg-amber-50",disabled:b.exceptions.divergenceOld.count===0,onClick:()=>a("EXCEPTIONS"),children:[n.jsx("span",{children:"    "}),n.jsxs("span",{className:"font-semibold",children:["(",b.exceptions.divergenceOld.count,")"]})]}),n.jsxs("button",{type:"button",className:"inline-flex items-center gap-1 px-3 py-1.5 rounded-full border border-rose-200 bg-rose-50 text-rose-800 hover:bg-rose-100 transition disabled:opacity-40 disabled:hover:bg-rose-50",disabled:b.exceptions.missingAttachments.count===0,onClick:()=>a("EXCEPTIONS"),children:[n.jsx("span",{children:"  "}),n.jsxs("span",{className:"font-semibold",children:["(",b.exceptions.missingAttachments.count,")"]})]}),n.jsxs("button",{type:"button",className:"inline-flex items-center gap-1 px-3 py-1.5 rounded-full border border-purple-200 bg-purple-50 text-purple-800 hover:bg-purple-100 transition disabled:opacity-40 disabled:hover:bg-purple-50",disabled:b.exceptions.repeatedBlocks.count===0,onClick:()=>a("EXCEPTIONS"),children:[n.jsx("span",{children:"   "}),n.jsxs("span",{className:"font-semibold",children:["(",b.exceptions.repeatedBlocks.count,")"]})]})]})]}),n.jsx("div",{className:"flex flex-wrap gap-2 mb-4",children:Mb.map(J=>n.jsxs("button",{type:"button",onClick:()=>a(J.id),className:`px-3 py-1.5 text-xs font-semibold rounded-full border transition ${r===J.id?"bg-lpBlue text-white border-lpBlue":"bg-slate-50 text-slate-700 border-slate-200 hover:bg-slate-100"}`,children:[n.jsx("span",{children:J.label}),N&&n.jsxs("span",{className:"ml-2 inline-flex items-center justify-center px-2 py-0.5 rounded-full bg-white/20 text-[10px]",children:[J.id==="READY"&&N.readyCount,J.id==="ATTACHED"&&N.attachedCount,J.id==="SENT"&&N.sentCount,J.id==="EXCEPTIONS"&&N.exceptionsCount]})]},J.id))}),n.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-3 mb-4 text-sm",children:[n.jsxs("div",{children:[n.jsx("label",{className:"block text-xs font-medium text-slate-600 mb-1",children:""}),n.jsx("input",{className:"w-full border border-slate-200 rounded-lg px-2 py-1.5",placeholder:"   ",value:o,onChange:J=>l(J.target.value)})]}),n.jsxs("div",{children:[n.jsx("label",{className:"block text-xs font-medium text-slate-600 mb-1",children:""}),n.jsxs("select",{className:"w-full border border-slate-200 rounded-lg px-2 py-1.5",value:c,onChange:J=>i(J.target.value),children:[n.jsx("option",{value:"",children:""}),n.jsx("option",{value:"DRAFT",children:""}),n.jsx("option",{value:"READY_FOR_REPORT",children:" "}),n.jsx("option",{value:"ATTACHED_TO_REPORT",children:" "}),n.jsx("option",{value:"ARCHIVED",children:""})]})]}),n.jsxs("div",{children:[n.jsx("label",{className:"block text-xs font-medium text-slate-600 mb-1",children:" "}),n.jsxs("div",{className:"flex gap-2",children:[n.jsx("input",{type:"date",className:"w-1/2 border border-slate-200 rounded-lg px-2 py-1.5",value:u,onChange:J=>p(J.target.value)}),n.jsx("input",{type:"date",className:"w-1/2 border border-slate-200 rounded-lg px-2 py-1.5",value:y,onChange:J=>S(J.target.value)})]})]}),n.jsxs("div",{children:[n.jsx("label",{className:"block text-xs font-medium text-slate-600 mb-1",children:"   / ID"}),n.jsx("input",{className:"w-full border border-slate-200 rounded-lg px-2 py-1.5",placeholder:'/  ,    "',value:w,onChange:J=>L(J.target.value)})]})]}),H&&n.jsx("div",{className:"mt-6 text-sm text-slate-500 text-center",children:" "}),q&&!H&&n.jsx("div",{className:"mt-6 text-sm text-red-600 text-center",children:q}),!H&&!q&&k.length===0&&n.jsxs("div",{className:"mt-6 border border-dashed border-slate-300 rounded-xl py-10 flex flex-col items-center justify-center text-center text-sm text-slate-500",children:[n.jsx("p",{className:"mb-1",children:"  "}),n.jsx("p",{className:"text-xs text-slate-400",children:"/       ."})]}),!H&&!q&&k.length>0&&n.jsx("div",{className:"mt-4 overflow-x-auto border border-slate-200 rounded-xl",children:n.jsxs("table",{className:"w-full text-sm",children:[n.jsx("thead",{className:"bg-slate-50 text-slate-700",children:n.jsxs("tr",{children:[n.jsx("th",{className:"px-3 py-2 text-right",children:""}),n.jsx("th",{className:"px-3 py-2 text-right",children:""}),n.jsx("th",{className:"px-3 py-2 text-right",children:""}),n.jsx("th",{className:"px-3 py-2 text-right",children:" #"}),n.jsx("th",{className:"px-3 py-2 text-right",children:" "}),n.jsx("th",{className:"px-3 py-2 text-right",children:" "}),n.jsx("th",{className:"px-3 py-2 text-right",title:"         ",children:"INFO_ONLY"}),n.jsx("th",{className:"px-3 py-2 text-right",title:"       ",children:""}),n.jsx("th",{className:"px-3 py-2 text-left",children:""})]})}),n.jsx("tbody",{children:k.map(J=>{var be;const re=(be=J.blockingIssueCodesLatest)==null?void 0:be.includes("MISSING_ATTACHMENT_REQUIRED"),D=J.expensesOutOfSync,ae=(J.blockingIssueCodesLatest||[]).some(Oe=>Oe!=="MISSING_ATTACHMENT_REQUIRED");let ee="";return D?ee=" ":re?ee=" ":ae&&(ee=""),n.jsxs("tr",{className:"border-t border-slate-100 hover:bg-slate-50",children:[n.jsx("td",{className:"px-3 py-2 text-right font-mono text-xs text-slate-800",children:J.caseId}),n.jsx("td",{className:"px-3 py-2 text-right text-slate-800",children:J.insurerName||""}),n.jsx("td",{className:"px-3 py-2 text-right text-slate-800 text-xs",children:Dp[J.status]||J.status}),n.jsxs("td",{className:"px-3 py-2 text-right text-slate-800 text-xs",children:[" #",J.versionIndex]}),n.jsx("td",{className:"px-3 py-2 text-right text-slate-700 text-xs",children:new Date(J.updatedAt).toLocaleString("he-IL",{dateStyle:"short",timeStyle:"short"})}),n.jsxs("td",{className:"px-3 py-2 text-right text-blue-700 font-semibold text-xs",children:[J.amountToRequest.toLocaleString("he-IL")," "]}),n.jsx("td",{className:"px-3 py-2 text-right text-xs text-slate-700",children:J.infoOnly?"":""}),n.jsx("td",{className:"px-3 py-2 text-right text-xs",children:ee?n.jsx("span",{className:"inline-flex px-2 py-0.5 rounded-full bg-amber-100 text-amber-800 border border-amber-200",children:ee}):n.jsx("span",{className:"text-slate-400",children:""})}),n.jsxs("td",{className:"px-3 py-2 text-left text-xs space-x-2 space-x-reverse",children:[n.jsx("button",{type:"button",className:"px-2 py-1 rounded border border-slate-300 text-slate-700 hover:bg-slate-100",onClick:()=>ze(J),children:""}),n.jsx("button",{type:"button",className:"px-2 py-1 rounded border border-slate-300 text-slate-600 hover:bg-slate-100",onClick:()=>{var Oe;(Oe=navigator.clipboard)!=null&&Oe.writeText?navigator.clipboard.writeText(J.sheetId).catch(()=>{}):window.prompt(" :",J.sheetId)},children:" "})]})]},J.sheetId)})})]})}),G&&n.jsxs("div",{className:"mt-6 bg-slate-50 border border-slate-200 rounded-xl p-4",children:[n.jsxs("div",{className:"flex flex-col md:flex-row md:items-center md:justify-between gap-2 mb-2",children:[n.jsxs("h3",{className:"text-sm font-bold text-slate-900",children:["   ",G.caseId," (",G.sheetId,")"]}),n.jsxs("div",{className:"flex flex-wrap gap-2 text-[11px]",children:[n.jsx("button",{type:"button",className:"px-2 py-1 rounded border border-slate-300 text-slate-700 hover:bg-slate-100",onClick:()=>{var J;(J=navigator.clipboard)!=null&&J.writeText?navigator.clipboard.writeText(G.sheetId).catch(()=>{}):window.prompt(" :",G.sheetId)},children:"  "}),((Je=O==null?void 0:O.sheet)==null?void 0:Je.attachedToReportId)&&n.jsx("button",{type:"button",className:"px-2 py-1 rounded border border-slate-300 text-slate-700 hover:bg-slate-100",onClick:()=>{var re;const J=O.sheet.attachedToReportId;(re=navigator.clipboard)!=null&&re.writeText?navigator.clipboard.writeText(J).catch(()=>{}):window.prompt(" :",J)},children:"  "}),n.jsx("button",{type:"button",className:"px-2 py-1 rounded border border-slate-300 text-slate-700 hover:bg-slate-100",onClick:()=>{var re;const J=`${window.location.origin}${window.location.pathname}?financialSheetId=${encodeURIComponent(G.sheetId)}`;(re=navigator.clipboard)!=null&&re.writeText?navigator.clipboard.writeText(J).catch(()=>{}):window.prompt("  :",J)},children:"  "})]})]}),E&&n.jsx("p",{className:"text-xs text-slate-500",children:" "}),se&&n.jsx("p",{className:"text-xs text-red-600",children:se}),!E&&O&&O.sheet&&n.jsxs("div",{className:"space-y-3 text-xs text-slate-800",children:[n.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-2",children:[n.jsxs("div",{children:[n.jsx("span",{className:"font-semibold",children:":"})," ",n.jsx("span",{className:"font-mono",children:O.sheet.caseId})]}),n.jsxs("div",{children:[n.jsx("span",{className:"font-semibold",children:":"})," ",n.jsx("span",{children:O.sheet.insurerName||""})]}),n.jsxs("div",{children:[n.jsx("span",{className:"font-semibold",children:":"})," ",n.jsx("span",{children:Dp[O.sheet.status]||O.sheet.status})]}),n.jsxs("div",{children:[n.jsx("span",{className:"font-semibold",children:" #:"})," ",n.jsx("span",{children:O.sheet.versionIndex})]}),n.jsxs("div",{children:[n.jsx("span",{className:"font-semibold",children:":"})," ",n.jsx("span",{children:new Date(O.sheet.updatedAt).toLocaleString("he-IL",{dateStyle:"short",timeStyle:"short"})})]}),n.jsxs("div",{children:[n.jsx("span",{className:"font-semibold",children:" :"})," ",n.jsx("span",{children:O.sheet.readyAt||""})]}),n.jsxs("div",{children:[n.jsx("span",{className:"font-semibold",children:" :"})," ",n.jsx("span",{children:O.sheet.attachedAt||""})]})]}),n.jsxs("div",{className:"mt-3",children:[n.jsx("h4",{className:"font-semibold text-slate-900 mb-1 text-xs",children:"  (  )"}),n.jsx("p",{className:"text-[11px] text-slate-500 mb-1",children:"       ,      ."}),n.jsxs("div",{className:"inline-flex rounded-full bg-slate-100 p-1 text-[11px] font-semibold text-slate-700",children:[n.jsx("button",{type:"button",className:`px-3 py-1 rounded-full transition ${O.exceptionStatus?"text-slate-600 hover:text-slate-900":"bg-white shadow-sm text-slate-900"}`,onClick:()=>st("IN_PROGRESS"),children:""}),n.jsx("button",{type:"button",className:`px-3 py-1 rounded-full transition ${O.exceptionStatus==="RESOLVED"?"bg-emerald-500 text-white shadow-sm":"text-slate-600 hover:text-slate-900"}`,onClick:()=>st("RESOLVED"),children:""})]})]}),O.audit&&O.audit.length>0&&n.jsxs("div",{className:"mt-2",children:[n.jsxs("div",{className:"flex items-center justify-between mb-1",children:[n.jsx("h4",{className:"font-semibold text-slate-900",children:"Decision Logs"}),n.jsxs("label",{className:"flex items-center gap-1 text-[11px] text-slate-600",children:[n.jsx("input",{type:"checkbox",className:"rounded border-slate-300",checked:xe,onChange:J=>oe(J.target.checked)}),n.jsx("span",{children:" Decision Logs "})]})]}),(()=>{const J=O.audit.filter(D=>D.diffJson&&D.diffJson.decisionLog).sort((D,ae)=>new Date(ae.eventAt).getTime()-new Date(D.eventAt).getTime());if(!J.length)return n.jsx("p",{className:"text-slate-500 text-[11px]",children:"   ."});const re=xe?J:[J[0]];return n.jsx("div",{className:"space-y-2 text-[11px]",children:re.map((D,ae)=>{const ee=D.diffJson.decisionLog;return n.jsxs("div",{className:"border border-slate-200 rounded-lg px-2 py-1.5 bg-white/60",children:[xe&&n.jsxs("div",{className:"flex items-center justify-between mb-0.5 text-[10px] text-slate-500",children:[n.jsx("span",{children:new Date(D.eventAt).toLocaleString("he-IL",{dateStyle:"short",timeStyle:"short"})}),n.jsxs("span",{children:["#",ae+1]})]}),n.jsxs("div",{className:"space-y-1",children:[n.jsxs("div",{children:[n.jsx("span",{className:"font-semibold",title:"      ",children:"Ruleset:"})," ",n.jsxs("span",{children:[ee.rulesetId||""," ("," ",ee.rulesetVersion||"-",")"]})]}),n.jsxs("div",{className:"space-y-0.5",children:[n.jsxs("div",{children:[n.jsx("span",{className:ee.checks.requiredFieldsOk?"text-green-600":"text-red-600",children:ee.checks.requiredFieldsOk?"":""})," ",n.jsx("span",{children:"   "})]}),n.jsxs("div",{children:[n.jsx("span",{className:ee.checks.sumsValid?"text-green-600":"text-red-600",children:ee.checks.sumsValid?"":""})," ",n.jsx("span",{children:" "})]}),n.jsxs("div",{children:[n.jsx("span",{className:ee.checks.attachmentsOk?"text-green-600":"text-red-600",children:ee.checks.attachmentsOk?"":""})," ",n.jsx("span",{children:"    "})]}),n.jsxs("div",{children:[n.jsx("span",{className:ee.checks.infoOnlyConsistent?"text-green-600":"text-red-600",children:ee.checks.infoOnlyConsistent?"":""})," ",n.jsx("span",{children:" INFO_ONLY"})]})]}),n.jsxs("div",{children:[n.jsx("span",{className:"font-semibold",children:" :"})," ",n.jsx("span",{children:(ee.blockingIssueCodes||ee.blockingIssueCodesLatest||[]).join(", ")||""})]})]})]},D.id)})})})()]}),O.audit&&O.audit.length>0&&n.jsxs("div",{className:"mt-3",children:[n.jsxs("div",{className:"flex items-center justify-between mb-1",children:[n.jsx("h4",{className:"font-semibold text-slate-900",children:"Audit Log"}),n.jsxs("label",{className:"flex items-center gap-1 text-[11px] text-slate-600",children:[n.jsx("input",{type:"checkbox",className:"rounded border-slate-300",checked:X,onChange:J=>ue(J.target.checked)}),n.jsx("span",{children:" Audit Log "})]})]}),n.jsx("ul",{className:"space-y-0.5 text-[11px] text-slate-700",children:(X?O.audit:O.audit.slice(0,10)).map(J=>n.jsxs("li",{children:[n.jsx("span",{className:"font-mono text-slate-500 mr-1",children:new Date(J.eventAt).toLocaleString("he-IL",{dateStyle:"short",timeStyle:"short"})})," ",n.jsx("span",{className:"font-semibold",children:J.eventType})," "," ",n.jsx("span",{className:"text-slate-500",children:J.actorRole})]},J.id))})]}),O.sheet.attachedToReportId&&n.jsxs("div",{className:"mt-3",children:[n.jsx("button",{type:"button",className:"px-3 py-1.5 rounded border border-slate-300 text-xs text-slate-700 hover:bg-slate-100",onClick:()=>s(O.sheet.attachedToReportId),children:"  "}),n.jsx("button",{type:"button",className:"ml-2 px-3 py-1.5 rounded border border-blue-500 text-xs text-blue-700 hover:bg-blue-50",onClick:qe,children:"  "})]}),!O.sheet.attachedToReportId&&n.jsx("div",{className:"mt-3",children:n.jsx("button",{type:"button",className:"px-3 py-1.5 rounded border border-blue-500 text-xs text-blue-700 hover:bg-blue-50",onClick:qe,children:"  "})})]})]})]})},ai=e=>{const t=e.updatedAt||e.sentAt||e.reportDate;return t?new Date(t).getTime():0},Fb=e=>{var s;return(((s=e.reportReview)==null?void 0:s.issues)??[]).some(r=>(r.origin??"INTERNAL")==="EXTERNAL"&&r.status!=="DONE")},Bb=e=>{var s;return(((s=e.reportReview)==null?void 0:s.issues)??[]).some(r=>(r.origin??"INTERNAL")==="EXTERNAL"&&r.status!=="DONE"&&r.externalAction==="REQUIRES_HEBREW")},$b=e=>e.filter(t=>t.deletedAt?!1:t.hebrewWorkflowStatus==="HEBREW_REOPENED_EXTERNAL"?!0:Fb(t)).sort((t,s)=>ai(s)-ai(t)),Hb=(e,t)=>e.filter(s=>!(s.deletedAt||s.status!=="SENT"||!t(s)||Bb(s))).sort((s,r)=>ai(r)-ai(s)),Ub="adminDashboardUiState:v1",Wb=["u6","u5","u7","u4"],ml=Wb.map(e=>vs.find(t=>t.id===e&&t.role==="LAWYER")).filter(e=>!!e);function zb(e){var a;if(e.status==="SENT")return"GREEN";const t=(a=e.reportReview)==null?void 0:a.status,s=e.hebrewWorkflowStatus;return(t==="SUBMITTED"||t==="APPROVED"||t==="CHANGES_REQUESTED"||s==="HEBREW_SUBMITTED"||s==="HEBREW_APPROVED"||s==="HEBREW_CHANGES_REQUESTED"||s==="HEBREW_REOPENED_EXTERNAL")&&e.status!=="SENT"?"RED":"YELLOW"}const Vb=({user:e,reports:t,onSelectReport:s,onSelectReportWithFocus:r,onMarkExternalIssuesDone:a,onReopenHebrewDueToExternalFeedback:o,onNewReport:l,caseFolders:c,onUpdateCaseFolders:i,canTranslate:u,onLogout:p,onOpenAssistant:y,onOpenCaseFolder:S})=>{var Y;const w=g.useMemo(()=>t.filter(O=>!O.deletedAt),[t]),L=g.useMemo(()=>$b(w),[w]),k=g.useMemo(()=>Hb(w,u),[w,u]),U=g.useMemo(()=>{const O=new Map;return w.forEach(P=>{if(!P.createdBy)return;const X=O.get(P.createdBy)||[];X.push(P),O.set(P.createdBy,X)}),O},[w]),N=g.useMemo(()=>ml.map(O=>{const X=(U.get(O.id)||[]).filter(fe=>fe.status!=="SENT"),ue=X.filter(fe=>fe.status==="READY_TO_SEND").length,xe=L.filter(fe=>fe.createdBy===O.id).length,oe=k.filter(fe=>fe.createdBy===O.id).length;return{lawyer:O,totalOpen:X.length,readyToSendCount:ue,feedbackCount:xe,resendCount:oe}}),[L,k,U]),x=O=>{var P;return O.hebrewWorkflowStatus?O.hebrewWorkflowStatus:((P=O.reportReview)==null?void 0:P.status)??"-"},b=O=>{if(!O)return ul.queueItem.noDate;try{const P=new Date(O);return`${P.toLocaleDateString("he-IL")} ${P.toLocaleTimeString("he-IL",{hour:"2-digit",minute:"2-digit"}).replace(":00","")}`}catch{return O}},[F,H]=g.useState("ADMIN"),[V,q]=g.useState(((Y=ml[0])==null?void 0:Y.id)||""),[te,G]=g.useState("SUMMARY"),[le,j]=g.useState(null),T=g.useMemo(()=>c?Object.values(c).filter(O=>O.closedAt):[],[c]),E=g.useMemo(()=>ml.find(O=>O.id===V)||ml[0],[V]),C=g.useMemo(()=>{if(!E)return[];const O=U.get(E.id)||[],P=new Map;O.filter(oe=>!oe.deletedAt).forEach(oe=>{const fe=oe.odakanitNo&&oe.odakanitNo.trim().length>0?oe.odakanitNo.trim():"NO_ODAKANIT",ve=P.get(fe)||[];ve.push(oe),P.set(fe,ve)});const X=Array.from(P.entries()).map(([oe,fe])=>{let ve=fe[0];fe.forEach($e=>{const st=new Date($e.updatedAt||$e.reportDate).getTime(),Je=new Date(ve.updatedAt||ve.reportDate).getTime();st>Je&&(ve=$e)});const _e=oe==="NO_ODAKANIT"?"":oe,ze=_e||"  ",qe=ve.updatedAt||ve.reportDate;return{odakanitNo:_e,displayOdakanit:ze,representative:ve,lastUpdatedIso:qe,reportsCount:fe.length}}),ue=[];return c&&Object.values(c).forEach(oe=>{var _e;if(!oe.odakanitNo||oe.assignedLawyer!==E.id)return;const fe=oe.odakanitNo.trim();if(!fe||P.has(fe))return;const ve={id:`seed-folder-${fe}`,createdBy:E.id,ownerName:E.name,ownerEmail:E.email,reportDate:oe.updatedAt||oe.createdAt,status:"DRAFT",reportSubject:oe.reTemplate||"",recipientId:"1",insurerName:oe.insurerName||"",lineSlipNo:oe.lineSlipNo||"",marketRef:oe.marketRef||"",certificateRef:oe.certificateRef||"",insuredName:oe.insuredName||"",plaintiffName:oe.plaintiffName||"",plaintiffTitle:"Plaintiff",sentAt:void 0,reportHistory:[],selectedTimeline:"standard",filenameTag:"New lawsuit",selectedSections:["Update","Recommendations"],content:{},translatedContent:{},invoiceFiles:[],isWaitingForInvoices:!1,requiresExpenses:!1,isTranslated:!1,expensesItems:[],expenseWorksheet:void 0,reportNotes:[],complaintAnalysis:void 0};ue.push({odakanitNo:oe.odakanitNo,displayOdakanit:oe.odakanitNo||"  ",representative:ve,lastUpdatedIso:oe.updatedAt||oe.createdAt,reportsCount:((_e=oe.sentReports)==null?void 0:_e.length)||0})}),[...X,...ue].sort((oe,fe)=>{const ve=oe.lastUpdatedIso?new Date(oe.lastUpdatedIso).getTime():0;return(fe.lastUpdatedIso?new Date(fe.lastUpdatedIso).getTime():0)-ve})},[U,E,c]),se=g.useMemo(()=>{if(!E||!le)return[];const O=U.get(E.id)||[],P=le.trim();return O.filter(X=>!X.deletedAt).filter(X=>(X.odakanitNo||"").trim()===P)},[U,E,le]);return n.jsx("div",{className:"min-h-screen bg-navySecondary",dir:"rtl",children:n.jsxs("div",{className:"w-full px-6 md:px-8 lg:px-10 xl:px-12 py-6",children:[n.jsxs("header",{className:"flex flex-col md:flex-row items-start md:items-center justify-between gap-4 mb-6",children:[n.jsxs("div",{children:[n.jsx("h1",{className:"text-2xl font-bold text-textLight",children:ul.title}),n.jsx("p",{className:"text-sm text-textMuted mt-1",children:ul.subtitle}),n.jsxs("p",{className:"text-xs text-textMuted mt-1",children:["/ ",n.jsx("span",{className:"font-semibold",children:e.name})," ",n.jsxs("span",{className:"ml-1 text-textMuted",children:["(",e.role==="SUB_ADMIN"?"SUB_ADMIN":"ADMIN",")"]})]})]}),n.jsxs("div",{className:"flex flex-col items-stretch md:flex-row md:items-center gap-3",children:[n.jsxs("div",{className:"inline-flex rounded-full bg-slate-100 p-1 text-xs font-semibold text-textMuted",children:[n.jsx("button",{type:"button",onClick:()=>H("ADMIN"),className:`px-3 py-1 rounded-full transition ${F==="ADMIN"?"bg-panel text-textLight shadow-sm":"text-textMuted hover:text-textLight"}`,children:" "}),n.jsx("button",{type:"button",onClick:()=>H("FINANCIAL_CONTROL"),className:`px-3 py-1 rounded-full transition ${F==="FINANCIAL_CONTROL"?"bg-panel text-textLight shadow-sm":"text-textMuted hover:text-textLight"}`,children:" "})]}),y&&n.jsx("button",{type:"button",onClick:()=>y(),className:"inline-flex items-center justify-center px-3 py-2 rounded-lg border border-indigo-200 bg-panel text-xs font-semibold text-indigo-800 hover:bg-indigo-50 transition",children:" "}),n.jsx("button",{type:"button",onClick:p,className:"inline-flex items-center justify-center px-3 py-2 rounded-lg border border-red-200 bg-panel text-sm font-semibold text-red-700 hover:bg-red-50 transition",children:""}),n.jsx("button",{onClick:l,className:"inline-flex items-center justify-center px-4 py-2 rounded-lg bg-lpBlue text-white text-sm font-semibold shadow-sm hover:bg-blue-800 transition",children:ul.actions.openNewReport})]})]}),F==="FINANCIAL_CONTROL"?n.jsx(Pb,{user:e,reports:t,onOpenReport:s}):n.jsxs(n.Fragment,{children:[n.jsxs("section",{className:"mb-6",children:[n.jsx("h2",{className:"text-sm font-semibold text-textLight mb-2",children:"   "}),n.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 xl:grid-cols-5 gap-3 text-xs",children:N.map(O=>{const P=(E==null?void 0:E.id)===O.lawyer.id;return n.jsxs("button",{type:"button",onClick:()=>{q(O.lawyer.id),j(null),G("LAWYER_CASES")},className:`flex flex-col items-stretch rounded-2xl border px-3 py-3 text-right shadow-sm transition ${P?"border-gold bg-blue-50/80":"border-borderDark bg-panel hover:bg-navySecondary"}`,children:[n.jsxs("div",{className:"flex items-center justify-between mb-1",children:[n.jsx("span",{className:"text-[11px] font-semibold text-slate-700",children:O.lawyer.name}),n.jsxs("span",{className:"inline-flex items-center rounded-full bg-slate-100 px-2 py-0.5 text-[10px] text-textMuted",children:[O.totalOpen," "]})]}),n.jsxs("div",{className:"flex flex-col gap-0.5 text-[11px] text-textMuted",children:[n.jsxs("span",{children:[" :",n.jsx("span",{className:"font-semibold text-emerald-700",children:O.readyToSendCount})]}),n.jsxs("span",{children:["  :",n.jsx("span",{className:"font-semibold text-purple-700",children:O.feedbackCount})]})]})]},O.lawyer.id)})})]}),e.role==="ADMIN"&&c&&i&&n.jsx(Eb,{caseFolders:c,onUpdateCaseFolders:i,reports:t}),e.role==="ADMIN"&&T.length>0&&n.jsxs("section",{className:"mb-6 bg-panel rounded-2xl border border-borderDark shadow-sm p-4",children:[n.jsx("div",{className:"flex items-center justify-between mb-3",children:n.jsxs("div",{children:[n.jsx("h2",{className:"text-sm font-semibold text-textLight",children:" "}),n.jsx("p",{className:"text-[11px] text-textMuted",children:"      .   ,   (  )   ."})]})}),n.jsx("div",{className:"overflow-x-auto",children:n.jsxs("table",{className:"min-w-full text-[11px]",children:[n.jsx("thead",{children:n.jsxs("tr",{className:"border-b border-borderDark bg-navySecondary",children:[n.jsx("th",{className:"px-2 py-1 text-right font-semibold",children:"  "}),n.jsx("th",{className:"px-2 py-1 text-right font-semibold",children:""}),n.jsx("th",{className:"px-2 py-1 text-right font-semibold",children:""}),n.jsx("th",{className:"px-2 py-1 text-right font-semibold",children:" "}),n.jsx("th",{className:"px-2 py-1 text-right font-semibold",children:""})]})}),n.jsx("tbody",{children:T.map(O=>{const P=O.closedAt?new Date(O.closedAt).toLocaleDateString("he-IL"):"";return n.jsxs("tr",{className:"border-b border-borderDark",children:[n.jsx("td",{className:"px-2 py-1 text-right font-semibold text-textLight",children:O.odakanitNo}),n.jsx("td",{className:"px-2 py-1 text-right text-slate-700",children:O.insuredName||""}),n.jsx("td",{className:"px-2 py-1 text-right text-slate-700",children:O.plaintiffName||""}),n.jsx("td",{className:"px-2 py-1 text-right text-textMuted",children:P}),n.jsx("td",{className:"px-2 py-1 text-left",children:S&&n.jsx("button",{type:"button",onClick:()=>S(O.odakanitNo),className:"inline-flex items-center rounded-full bg-panel px-3 py-1 text-[11px] font-semibold text-gold border border-gold hover:bg-navySecondary",children:" "})})]},O.odakanitNo)})})]})})]}),te==="LAWYER_CASES"&&E&&n.jsxs("section",{className:"mb-6 bg-panel rounded-2xl border border-borderDark shadow-sm p-4",children:[n.jsxs("div",{className:"flex items-center justify-between mb-3",children:[n.jsxs("div",{children:[n.jsxs("h2",{className:"text-sm font-semibold text-textLight",children:["     ",E.name]}),n.jsx("p",{className:"text-[11px] text-textMuted",children:"        ."})]}),n.jsx("button",{type:"button",onClick:()=>{G("SUMMARY"),j(null)},className:"text-[11px] px-3 py-1.5 rounded-full border border-borderDark text-slate-700 hover:bg-navySecondary",children:" "})]}),C.length===0?n.jsx("p",{className:"text-xs text-textMuted",children:"       ."}):n.jsx("div",{className:"overflow-x-auto",children:n.jsxs("table",{className:"min-w-full text-[11px]",children:[n.jsx("thead",{children:n.jsxs("tr",{className:"border-b border-borderDark bg-navySecondary",children:[n.jsx("th",{className:"px-2 py-1 text-right font-semibold",children:" "}),n.jsx("th",{className:"px-2 py-1 text-right font-semibold w-20",children:"REPORT NO."}),n.jsx("th",{className:"px-2 py-1 text-right font-semibold w-40",children:"PLAINTIFF/CLAIMANT"}),n.jsx("th",{className:"px-2 py-1 text-right font-semibold w-40",children:"INSURED"}),n.jsx("th",{className:"px-2 py-1 text-right font-semibold w-40",children:"INSURER"}),n.jsx("th",{className:"px-2 py-1 text-right font-semibold w-28",children:"'  "})]})}),n.jsx("tbody",{children:C.map(O=>{var qe;const{representative:P}=O,X=!!O.odakanitNo,ue=ei(P),xe=ue?ue.split(" - "):[],oe=xe.length<=2?ue:xe[xe.length-2]||ue,fe=typeof P.reportNumber=="number"&&P.reportNumber>0?P.reportNumber:(((qe=P.reportHistory)==null?void 0:qe.length)||0)+1,ve=P.plaintiffName||"",_e=P.insuredName||"",ze=P.insurerName||"";return n.jsxs("tr",{className:`border-b border-borderDark ${X?"hover:bg-navySecondary cursor-pointer":"bg-navySecondary/40 text-textMuted"}`,onClick:()=>{X&&(j(O.odakanitNo),G("CASE_REPORTS"))},children:[n.jsxs("td",{className:"px-2 py-1 text-right",children:[n.jsx("div",{className:"text-textLight",children:oe||""}),n.jsx("div",{className:"text-[10px] text-textMuted",children:b(O.lastUpdatedIso)})]}),n.jsx("td",{className:"px-2 py-1 text-right text-slate-700 font-mono text-[11px]",children:fe}),n.jsx("td",{className:"px-2 py-1 text-right text-slate-700",children:ve}),n.jsx("td",{className:"px-2 py-1 text-right text-slate-700",children:_e}),n.jsx("td",{className:"px-2 py-1 text-right text-slate-700",children:ze}),n.jsx("td",{className:"px-2 py-1 text-right font-mono text-[11px]",children:O.displayOdakanit})]},O.displayOdakanit)})})]})})]}),te==="CASE_REPORTS"&&E&&le&&n.jsxs("section",{className:"mb-6 bg-panel rounded-2xl border border-borderDark shadow-sm p-4",children:[n.jsxs("div",{className:"flex items-center justify-between mb-3",children:[n.jsxs("div",{children:[n.jsxs("h2",{className:"text-sm font-semibold text-textLight",children:["  ",le,"  ",E.name]}),n.jsx("p",{className:"text-[11px] text-textMuted",children:"  ,     ."})]}),n.jsx("button",{type:"button",onClick:()=>G("LAWYER_CASES"),className:"text-[11px] px-3 py-1.5 rounded-full border border-borderDark text-slate-700 hover:bg-navySecondary",children:" "})]}),se.length===0?n.jsx("p",{className:"text-xs text-textMuted",children:"     ."}):n.jsx("div",{className:"overflow-x-auto",children:n.jsxs("table",{className:"min-w-full text-[11px]",children:[n.jsx("thead",{children:n.jsxs("tr",{className:"border-b border-borderDark bg-navySecondary",children:[n.jsx("th",{className:"px-2 py-1 text-right font-semibold w-64",children:" /  / "}),n.jsx("th",{className:"px-2 py-1 text-right font-semibold w-24",children:' \\"'}),n.jsx("th",{className:"px-2 py-1 text-right font-semibold w-32",children:""}),n.jsx("th",{className:"px-2 py-1 text-right font-semibold w-32",children:" "}),n.jsx("th",{className:"px-2 py-1 text-right font-semibold w-28"})]})}),n.jsx("tbody",{children:se.map(O=>{var fe;const P=zb(O),X=P==="GREEN"?"bg-emerald-50":P==="RED"?"bg-red-50":"bg-yellow-50",ue=!!O.expensesSheetId,xe=O.reportSubject||O.insuredName||O.plaintiffName||"",oe=typeof O.reportNumber=="number"&&O.reportNumber>0?O.reportNumber:(((fe=O.reportHistory)==null?void 0:fe.length)||0)+1;return n.jsxs("tr",{className:`border-b border-borderDark hover:bg-slate-100 cursor-pointer ${X}`,onClick:()=>s(O.id),children:[n.jsxs("td",{className:"px-2 py-1 text-right",children:[n.jsxs("div",{className:"text-textLight flex flex-wrap items-center gap-1 justify-end",children:[n.jsx("span",{children:xe}),ue&&n.jsx("span",{className:"inline-flex items-center rounded-full bg-purple-100 px-2 py-0.5 text-[10px] font-medium text-purple-700",children:" /  "})]}),(O.insuredName||O.plaintiffName)&&n.jsx("div",{className:"text-[10px] text-textMuted",children:[O.insuredName,O.plaintiffName].filter(Boolean).join(" / ")})]}),n.jsx("td",{className:"px-2 py-1 text-right text-slate-700",children:oe}),n.jsxs("td",{className:"px-2 py-1 text-right text-slate-700",children:[x(O)," (",O.status,")"]}),n.jsx("td",{className:"px-2 py-1 text-right text-textMuted whitespace-nowrap",children:b(O.updatedAt||O.reportDate)}),n.jsx("td",{className:"px-2 py-1 text-left",children:n.jsx("button",{type:"button",onClick:ve=>{ve.stopPropagation(),s(O.id)},className:"inline-flex items-center rounded-full bg-lpBlue px-3 py-1 text-[11px] font-semibold text-white shadow-sm hover:bg-blue-900",children:' \\"'})})]},O.id)})})]})})]})]})]})})},Kb={DRAFT:"",READY_FOR_REPORT:" ",ATTACHED_TO_REPORT:" ",ARCHIVED:""},Yb=({user:e,reports:t,onLogout:s,onNotifyLawyer:r,onMarkReportPaid:a,onOpenAssistant:o,caseFolders:l})=>{const[c,i]=g.useState([]),[u,p]=g.useState(!1),[y,S]=g.useState("ALL"),[w,L]=g.useState(""),[k,U]=g.useState(null),[N,x]=g.useState(null),[b,F]=g.useState({}),H=async()=>{p(!0);try{const T=await Ye.listSheets();i(T)}finally{p(!1)}};g.useEffect(()=>{H()},[]);const V=g.useMemo(()=>{const T=new Map;return t.forEach(E=>{if(!E.expensesSheetId)return;const C=T.get(E.expensesSheetId);if(!C){T.set(E.expensesSheetId,E);return}const se=C.updatedAt&&new Date(C.updatedAt).getTime()||0;(E.updatedAt&&new Date(E.updatedAt).getTime()||0)>se&&T.set(E.expensesSheetId,E)}),T},[t]),q=g.useMemo(()=>c.filter(T=>{if(y!=="ALL"&&T.status!==y)return!1;const E=w.trim().toLowerCase();return!(E&&!(T.insurerName||"").toLowerCase().includes(E))}),[c,y,w]);g.useEffect(()=>{const T=q.map(E=>E.id).filter(E=>!b[E]);T.length&&T.forEach(E=>{(async()=>{try{const C=await Ye.getSheet(E);if(!C)return;const se=Dn(C.sheet,C.lineItems);F(Y=>({...Y,[E]:se}))}catch{}})()})},[q,b]);const te=async T=>{const E=await Ye.getSheet(T);E&&(U(T),x(E))},G=async()=>{const E=(window.prompt("  / :")||"").trim();if(!E)return;const C=ke(E),se=t.filter(xe=>ke(xe.odakanitNo||"")===C);let Y=null;se.length>0&&(Y=se.reduce((oe,fe)=>{const ve=oe.updatedAt?new Date(oe.updatedAt).getTime()||0:new Date(oe.reportDate||"").getTime()||0;return(fe.updatedAt?new Date(fe.updatedAt).getTime()||0:new Date(fe.reportDate||"").getTime()||0)>ve?fe:oe}).insurerName||null);let O=1,P=0,X=0;try{const oe=(await Ye.listSheets()).filter(fe=>ke(fe.caseId)===C);if(oe.length>0){oe.sort((_e,ze)=>{const qe=new Date(_e.updatedAt||_e.createdAt).getTime();return new Date(ze.updatedAt||ze.createdAt).getTime()-qe});const fe=oe[0];P=fe.deductibleAmount??0,X=fe.alreadyPaidAmount??0,O=oe.reduce((_e,ze)=>ze.versionIndex&&ze.versionIndex>_e?ze.versionIndex:_e,1)+1}}catch{}const ue=await Ye.createSheet(e,{caseId:E,insurerId:null,insurerName:Y,periodLabel:"",versionIndex:O,currency:"ILS",deductibleAmount:P,alreadyPaidAmount:X,infoOnly:!1});await H(),await te(ue.id)},le=T=>{x(T),i(E=>E.map(C=>C.id===T.sheet.id?T.sheet:C));try{const E=Dn(T.sheet,T.lineItems);F(C=>({...C,[T.sheet.id]:E}))}catch{}},j=()=>{U(null),x(null)};if(k&&N){const T=V.get(N.sheet.id)||null;return n.jsx("div",{className:"w-full px-6 md:px-8 lg:px-10 xl:px-12 py-6",children:n.jsx(_h,{user:e,sheetWithRelations:N,onSheetUpdated:le,onBack:j,onNotifyLawyer:r,linkedReportForLawyer:T})})}return n.jsxs("div",{className:"w-full px-6 md:px-8 lg:px-10 xl:px-12 py-6",children:[n.jsxs("div",{className:"flex items-center justify-between mb-5",children:[n.jsxs("div",{children:[n.jsx("h1",{className:"text-3xl font-semibold text-gray-900",children:" "}),n.jsx("p",{className:"text-base text-gray-600 mt-1",children:"        ()."})]}),n.jsxs("div",{className:"flex gap-2 items-center",children:[o&&n.jsx("button",{type:"button",className:"px-3 py-1.5 text-base rounded border border-indigo-200 text-indigo-800 bg-indigo-50 hover:bg-indigo-100",onClick:o,children:" "}),n.jsx("button",{type:"button",className:"px-3 py-1.5 text-base rounded border border-gray-300 text-gray-700 hover:bg-gray-50",onClick:s,children:""}),n.jsx("button",{type:"button",className:"px-4 py-1.5 text-base rounded bg-blue-600 text-white hover:bg-blue-700",onClick:G,children:"   "})]})]}),n.jsxs("div",{className:"flex flex-wrap gap-4 mb-4 items-end",children:[n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"  "}),n.jsxs("select",{className:"border rounded px-2 py-1 text-base",value:y,onChange:T=>S(T.target.value==="ALL"?"ALL":T.target.value),children:[n.jsx("option",{value:"ALL",children:""}),n.jsx("option",{value:"DRAFT",children:""}),n.jsx("option",{value:"READY_FOR_REPORT",children:" "}),n.jsx("option",{value:"ATTACHED_TO_REPORT",children:" "}),n.jsx("option",{value:"ARCHIVED",children:""})]})]}),n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:""}),n.jsx("input",{className:"border rounded px-2 py-1 text-base",placeholder:"   ",value:w,onChange:T=>L(T.target.value)})]})]}),n.jsx("div",{className:"bg-white border rounded-lg shadow-sm overflow-x-auto text-base",children:n.jsxs("table",{className:"min-w-full",children:[n.jsx("thead",{className:"bg-gray-50",children:n.jsxs("tr",{children:[n.jsx("th",{className:"px-3 py-2 border-b text-right",children:""}),n.jsx("th",{className:"px-3 py-2 border-b text-right",children:""}),n.jsx("th",{className:"px-3 py-2 border-b text-right",children:""}),n.jsx("th",{className:"px-3 py-2 border-b text-right",children:""}),n.jsx("th",{className:"px-3 py-2 border-b text-right",children:" "}),n.jsx("th",{className:"px-3 py-2 border-b text-right",children:" "}),n.jsx("th",{className:"px-3 py-2 border-b text-right",children:""})]})}),n.jsxs("tbody",{children:[u&&n.jsx("tr",{children:n.jsx("td",{colSpan:7,className:"px-3 py-4 text-center text-gray-500",children:" "})}),!u&&q.length===0&&n.jsx("tr",{children:n.jsx("td",{colSpan:7,className:"px-3 py-4 text-center text-gray-500",children:"    ."})}),!u&&q.map(T=>{const E=V.get(T.id),C=b[T.id],se=E?E.status==="TASK_ASSIGNED"?" ":E.status==="WAITING_FOR_INVOICES"?" ":E.status==="READY_TO_SEND"?"   ":E.status==="SENT"?"  ":"  ":"",Y=E?E.status==="SENT"?E.isPaid?"":"  ":se:Kb[T.status],O=(()=>{const P=ke(T.caseId),X=l==null?void 0:l[P];return X&&X.closedAt?"":!X&&!t.some(xe=>ke(xe.odakanitNo)===P)?"  ":""})();return n.jsxs("tr",{className:"hover:bg-gray-50",children:[n.jsx("td",{className:"px-3 py-2 border-b font-mono text-sm text-gray-800",children:n.jsxs("div",{className:"flex flex-col items-start gap-0.5",children:[n.jsx("span",{children:T.caseId}),n.jsx("span",{className:"inline-flex px-2 py-0.5 rounded-full text-[11px] bg-gray-100 text-gray-700 border border-gray-200",children:O===""?" ":O==="  "?"  ":" "})]})}),n.jsx("td",{className:"px-3 py-2 border-b text-gray-800",children:T.insurerName||""}),n.jsxs("td",{className:"px-3 py-2 border-b text-gray-800",children:["  #",T.versionIndex]}),n.jsx("td",{className:"px-3 py-2 border-b",children:n.jsx("span",{className:"inline-flex px-2 py-0.5 rounded-full text-sm bg-gray-100 text-gray-700 border border-gray-200",children:Y})}),n.jsx("td",{className:"px-3 py-2 border-b text-gray-700",children:T.updatedAt?new Date(T.updatedAt).toLocaleString("he-IL",{dateStyle:"short",timeStyle:"short"}):""}),n.jsx("td",{className:"px-3 py-2 border-b text-blue-700 font-semibold",children:C?`${C.amountToRequest.toLocaleString("he-IL")} `:""}),n.jsx("td",{className:"px-3 py-2 border-b text-left",children:n.jsxs("div",{className:"flex items-center gap-2 justify-start",children:[n.jsx("button",{type:"button",className:"px-3 py-1 text-sm rounded border border-blue-500 text-blue-700 hover:bg-blue-50",onClick:()=>void te(T.id),children:""}),E&&E.status==="SENT"&&!E.isPaid&&a&&n.jsx("button",{type:"button",className:"px-3 py-1 text-sm rounded border border-green-500 text-green-700 hover:bg-green-50",onClick:()=>a(E.id),children:""}),n.jsx("button",{type:"button",className:"px-2 py-1 text-sm rounded border border-red-400 text-red-600 hover:bg-red-50",onClick:async()=>{window.confirm("    ?   .")&&(await Ye.deleteSheet(T.id),await H())},children:""})]})})]},T.id)})]})]})})]})},Gb=g.createContext(void 0);let qb=0;const Xb=({children:e})=>{const[t,s]=g.useState([]),r=g.useCallback(l=>{s(c=>c.filter(i=>i.id!==l))},[]),a=g.useCallback(({message:l,type:c="info"})=>{const i=++qb;s(u=>[...u,{id:i,message:l,type:c}]),window.setTimeout(()=>{r(i)},3e3)},[r]),o=l=>l==="success"?"border-l-gold text-goldLight":l==="error"?"border-l-danger text-red-300":"border-l-gold text-textLight";return n.jsxs(Gb.Provider,{value:{showToast:a},children:[e,n.jsx("div",{className:"fixed top-4 right-4 z-[260] flex flex-col gap-2 items-end pointer-events-none",dir:"rtl",children:t.map(l=>n.jsxs("div",{className:`pointer-events-auto max-w-xs bg-panel border border-borderDark rounded-lg shadow-lg px-3 py-2 border-l-4 text-xs flex items-center gap-2 text-textLight ${o(l.type)}`,children:[n.jsx("span",{className:"whitespace-pre-line",children:l.message}),n.jsx("button",{type:"button",onClick:()=>r(l.id),className:"ml-1 p-1 rounded hover:bg-navySecondary text-textMuted",children:n.jsx(Ot,{className:"w-3 h-3"})})]},l.id))})]})},Jb=({folder:e,reports:t,onBack:s,onUpdateReTemplate:r,onCreateReportInCase:a,onOpenReport:o,currentUserRole:l,onCloseCase:c,onReopenCase:i,onDeleteCase:u})=>{const[p,y]=g.useState(e.reTemplate||""),S=()=>{const x=p.trim();x!==e.reTemplate&&r(x)},k=t.filter(x=>x.odakanitNo&&x.odakanitNo.trim()===e.odakanitNo).filter(x=>x.status!=="SENT"&&!x.deletedAt)[0]||null,U=!!e.closedAt,N=g.useMemo(()=>{const x=new Map;return e.sentReports.forEach(b=>{if(!b||!b.reportId)return;const F=x.get(b.reportId);if(!F){x.set(b.reportId,b);return}const H=new Date(F.sentAt).getTime()||0;(new Date(b.sentAt).getTime()||0)>=H&&x.set(b.reportId,b)}),Array.from(x.values()).sort((b,F)=>{const H=new Date(b.sentAt).getTime()||0,V=new Date(F.sentAt).getTime()||0;return H-V})},[e.sentReports]);return n.jsx("div",{className:"min-h-screen bg-bgDark px-0 pb-8",children:n.jsxs("div",{className:"w-full px-6 md:px-8 lg:px-10 xl:px-12 pt-4",children:[n.jsx("button",{type:"button",onClick:s,className:"mb-4 inline-flex items-center rounded-full bg-panel border border-borderDark px-3 py-1.5 text-xs font-medium text-textLight shadow-sm hover:bg-navySecondary focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-gold focus-visible:ring-offset-2",children:"  "}),n.jsxs("header",{className:"mb-4 rounded-2xl bg-panel px-5 py-4 shadow-sm border border-borderDark flex flex-col gap-2 md:flex-row md:items-center md:justify-between",children:[n.jsxs("div",{children:[n.jsxs("h1",{className:"text-xl font-serif font-bold text-navy",children:["   ",e.odakanitNo]}),n.jsx("p",{className:"mt-1 text-xs text-textMuted",children:"       ."}),U&&n.jsx("p",{className:"mt-1 text-[11px] font-semibold text-amber-700",children:" :    .        ."})]}),n.jsxs("div",{className:"flex flex-wrap items-center gap-2 text-xs",children:[l==="ADMIN"&&!U&&c&&n.jsx("button",{type:"button",onClick:c,className:"inline-flex items-center rounded-full bg-red-50 px-3 py-1.5 font-semibold text-red-700 border border-red-200 hover:bg-red-100",children:" "}),l==="ADMIN"&&U&&n.jsxs(n.Fragment,{children:[i&&n.jsx("button",{type:"button",onClick:i,className:"inline-flex items-center rounded-full bg-green-50 px-3 py-1.5 font-semibold text-green-700 border border-green-200 hover:bg-green-100",children:"  "}),u&&n.jsx("button",{type:"button",onClick:u,className:"inline-flex items-center rounded-full bg-panel px-3 py-1.5 font-semibold text-textLight border border-borderDark hover:bg-navySecondary",children:" "})]})]})]}),n.jsxs("section",{className:"mb-4 grid gap-4 md:grid-cols-2",children:[n.jsxs("div",{className:"rounded-2xl bg-panel p-4 shadow-sm border border-borderDark",children:[n.jsx("h2",{className:"mb-2 text-xs font-semibold uppercase tracking-wide text-textMuted",children:" "}),n.jsxs("dl",{className:"space-y-1 text-xs text-textLight",children:[n.jsxs("div",{children:[n.jsx("dt",{className:"font-semibold text-textMuted",children:""}),n.jsx("dd",{children:e.insuredName||""})]}),n.jsxs("div",{children:[n.jsx("dt",{className:"font-semibold text-textMuted",children:""}),n.jsx("dd",{children:e.plaintiffName||""})]}),n.jsxs("div",{children:[n.jsx("dt",{className:"font-semibold text-textMuted",children:""}),n.jsx("dd",{children:e.insurerName||""})]}),n.jsxs("div",{children:[n.jsx("dt",{className:"font-semibold text-textMuted",children:"UMR /  "}),n.jsx("dd",{children:e.marketRef||""})]}),n.jsxs("div",{children:[n.jsx("dt",{className:"font-semibold text-textMuted",children:"Line Slip"}),n.jsx("dd",{children:e.lineSlipNo||""})]}),n.jsxs("div",{children:[n.jsx("dt",{className:"font-semibold text-textMuted",children:" "}),n.jsx("dd",{children:e.certificateRef||""})]}),n.jsxs("div",{children:[n.jsx("dt",{className:"font-semibold text-textMuted",children:"  "}),n.jsx("dd",{children:e.reportIds.length})]}),U&&n.jsxs("div",{children:[n.jsx("dt",{className:"font-semibold text-textMuted",children:" "}),n.jsx("dd",{className:"text-amber-700",children:""})]})]})]}),n.jsxs("div",{className:"rounded-2xl bg-panel p-4 shadow-sm border border-borderDark",children:[n.jsx("h2",{className:"mb-2 text-xs font-semibold uppercase tracking-wide text-textMuted",children:"  (RE)"}),n.jsx("textarea",{className:"w-full rounded-lg border border-borderDark p-2 text-xs text-textLight placeholder:text-textMuted focus:border-navy focus:outline-none focus:ring-1 focus:ring-navy",rows:4,value:p,onChange:x=>y(x.target.value),onBlur:S,placeholder:"Example: John Doe v. XYZ Medical Center - Claim Update"}),n.jsx("div",{className:"mt-3 flex justify-end",children:n.jsx("button",{type:"button",onClick:a,className:"inline-flex items-center rounded-full bg-navy px-4 py-1.5 text-[11px] font-semibold text-white shadow-sm hover:bg-blue-900 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-navy focus-visible:ring-offset-2",children:"    "})})]})]}),n.jsxs("section",{className:"mb-4 rounded-2xl bg-panel p-4 shadow-sm border border-borderDark",children:[n.jsxs("div",{className:"mb-3 flex items-center justify-between gap-3",children:[n.jsxs("div",{children:[n.jsx("h2",{className:"text-sm font-semibold text-textLight",children:"   "}),n.jsx("p",{className:"text-xs text-textMuted",children:"     SENT   ( )."})]}),n.jsxs("div",{className:"flex items-center gap-2",children:[k&&n.jsx("button",{type:"button",onClick:()=>o(k.id),className:"rounded-full bg-amber-50 px-3 py-1 text-[11px] font-semibold text-amber-800 border border-amber-200 hover:bg-amber-100",children:"     "}),!U&&n.jsx(n.Fragment,{children:l==="LAWYER"?!k&&n.jsx("button",{type:"button",onClick:a,className:"inline-flex items-center rounded-full bg-navy px-4 py-1.5 text-xs font-semibold text-white shadow-sm hover:bg-blue-900 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-navy focus-visible:ring-offset-2",children:"    "}):n.jsx("button",{type:"button",onClick:a,className:"inline-flex items-center rounded-full bg-navy px-4 py-1.5 text-xs font-semibold text-white shadow-sm hover:bg-blue-900 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-navy focus-visible:ring-offset-2",children:k?"   ()":"    "})})]})]}),n.jsx("div",{className:"overflow-x-auto",children:n.jsxs("table",{className:"min-w-full text-xs text-left text-textLight",children:[n.jsx("thead",{className:"bg-navySecondary text-[11px] uppercase tracking-wide text-textMuted",children:n.jsxs("tr",{children:[n.jsx("th",{className:"px-3 py-2",children:"' "}),n.jsx("th",{className:"px-3 py-2",children:""}),n.jsx("th",{className:"px-3 py-2",children:" "}),n.jsx("th",{className:"px-3 py-2",children:"  / "}),n.jsx("th",{className:"px-3 py-2",children:""})]})}),n.jsxs("tbody",{className:"divide-y divide-gray-100",children:[N.length===0&&n.jsx("tr",{children:n.jsx("td",{colSpan:4,className:"px-3 py-4 text-center text-textMuted",children:"No sent reports recorded for this case yet."})}),N.map(x=>{const b=x.sentAt?new Date(x.sentAt).toLocaleDateString("en-GB",{day:"2-digit",month:"short",year:"numeric"}):"",F=x.snapshot&&x.snapshot.reportSubject||"",H=x.fileName||F||"";return n.jsxs("tr",{children:[n.jsx("td",{className:"px-3 py-2",children:x.reportNo?`#${x.reportNo}`:""}),n.jsx("td",{className:"px-3 py-2",children:x.isResend?n.jsx("span",{className:"inline-flex items-center rounded-full bg-amber-50 px-2 py-0.5 text-[10px] font-semibold text-amber-800 border border-amber-200",children:" "}):n.jsx("span",{className:"inline-flex items-center rounded-full bg-navySecondary px-2 py-0.5 text-[10px] font-semibold text-textMuted border border-borderDark",children:" "})}),n.jsx("td",{className:"px-3 py-2",children:b}),n.jsx("td",{className:"px-3 py-2",children:H}),n.jsx("td",{className:"px-3 py-2",children:n.jsx("button",{type:"button",onClick:()=>o(x.reportId),className:"inline-flex items-center rounded-full bg-panel px-3 py-1 text-[11px] font-semibold text-navy ring-1 ring-navy hover:bg-blue-50 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-navy focus-visible:ring-offset-2","aria-label":` " ${x.reportId}`,children:""})})]},`${x.reportId}-${x.sentAt}`)})]})]})})]})]})})},Oh="lp_case_folders",Mh="lp_case_folders_migrated",Qb=()=>{if(typeof window>"u")return{};try{const e=window.localStorage.getItem(Oh),t=e?JSON.parse(e):{};return!t||typeof t!="object"?{}:t}catch(e){return console.error("Failed to load case folders",e),{}}},kn=e=>{if(!(typeof window>"u"))try{window.localStorage.setItem(Oh,JSON.stringify(e))}catch(t){console.error("Failed to persist case folders",t)}},Zb=e=>{if(!e||typeof e!="object")return{};const t={};let s=!1;return Object.entries(e).forEach(([r,a])=>{const o=a.odakanitNo||r,l=ke(o);if(!l){s=!0;return}const c=t[l];if(!c){t[l]={...a,odakanitNo:l},l!==r&&(s=!0);return}s=!0;const i=(S,w)=>{if(!S)return w;if(!w)return S;const L=new Date(S.updatedAt||S.createdAt||"").getTime()||0;return(new Date(w.updatedAt||w.createdAt||"").getTime()||0)>L?w:S};let u=c,p=a;(!c.closedAt&&a.closedAt||i(c,a)===a)&&(u=a,p=c);const y={...u,odakanitNo:l,reTemplate:u.reTemplate||p.reTemplate||"",insuredName:u.insuredName||p.insuredName||"",insurerName:u.insurerName||p.insurerName||"",plaintiffName:u.plaintiffName||p.plaintiffName||"",marketRef:u.marketRef||p.marketRef||"",lineSlipNo:u.lineSlipNo||p.lineSlipNo||"",certificateRef:u.certificateRef||p.certificateRef||"",createdAt:u.createdAt||p.createdAt,updatedAt:u.updatedAt||p.updatedAt,closedAt:u.closedAt||p.closedAt||null,closedByUserId:u.closedByUserId||p.closedByUserId||null,reportIds:Array.from(new Set([...u.reportIds||[],...p.reportIds||[]])),sentReports:[...u.sentReports||[],...p.sentReports||[]]};t[l]=y}),s?t:e},Od=(e,t,s)=>{if(!t.odakanitNo)return e;const r=ke(t.odakanitNo);if(!r)return e;const a=s||new Date().toISOString(),o=e[r],l=o||{odakanitNo:r,reTemplate:"",insuredName:"",insurerName:"",plaintiffName:"",marketRef:"",lineSlipNo:"",certificateRef:"",createdAt:(o==null?void 0:o.createdAt)||a,updatedAt:(o==null?void 0:o.updatedAt)||a,reportIds:[],sentReports:(o==null?void 0:o.sentReports)||[]},c={...l,insuredName:t.insuredName||l.insuredName,insurerName:t.insurerName||l.insurerName,plaintiffName:t.plaintiffName||l.plaintiffName,marketRef:t.marketRef||l.marketRef,lineSlipNo:t.lineSlipNo||l.lineSlipNo,certificateRef:t.certificateRef||l.certificateRef,updatedAt:a,reportIds:l.reportIds.includes(t.id)?l.reportIds:[...l.reportIds,t.id],sentReports:l.sentReports},i=(t.reportSubject||"").trim();return i&&(!l.reTemplate||i!==l.reTemplate)&&(c.reTemplate=i),{...e,[r]:c}},Ph=(e,t,s,r,a)=>{var S;if(!t.odakanitNo)return e;const o=ke(t.odakanitNo);if(!o)return e;const l=s||new Date().toISOString(),c=e[o];if(!c)return e;const i=typeof t.reportNumber=="number"&&t.reportNumber>0?t.reportNumber:(((S=t.reportHistory)==null?void 0:S.length)||0)+1,u={id:t.id,odakanitNo:t.odakanitNo,insuredName:t.insuredName,plaintiffName:t.plaintiffName,insurerName:t.insurerName,marketRef:t.marketRef,lineSlipNo:t.lineSlipNo,certificateRef:t.certificateRef,reportDate:t.reportDate,status:"SENT",reportSubject:t.reportSubject},p={reportId:t.id,sentAt:l,reportNo:i,fileName:r,snapshot:u,isResend:!!a,resendIndex:i},y={...c,updatedAt:l,sentReports:[...c.sentReports,p]};return{...e,[o]:y}},Oc=(e,t)=>{let s={...e};return t.forEach(r=>{if(r.odakanitNo&&(s=Od(s,r,r.updatedAt||r.reportDate),r.status==="SENT")){const a=r.sentAt||r.reportDate||new Date().toISOString();s=Ph(s,r,a)}}),s},ev=()=>{if(!(typeof window>"u"))try{window.localStorage.setItem(Mh,"1")}catch{}},tv=()=>{if(typeof window>"u")return!0;try{return window.localStorage.getItem(Mh)==="1"}catch{return!0}},nv=(e,t)=>{const s=e.split(/\s+/).filter(Boolean),r=t.split(/\s+/).filter(Boolean),a=s.length,o=r.length;if(!a&&!o)return[];const l=Array.from({length:a+1},()=>Array(o+1).fill(0));for(let p=a-1;p>=0;p-=1)for(let y=o-1;y>=0;y-=1)s[p]===r[y]?l[p][y]=l[p+1][y+1]+1:l[p][y]=Math.max(l[p+1][y],l[p][y+1]);const c=[];let i=0,u=0;for(;i<a&&u<o;)s[i]===r[u]?(c.push({type:"same",text:s[i]}),i+=1,u+=1):l[i+1][u]>=l[i][u+1]?(c.push({type:"remove",text:s[i]}),i+=1):(c.push({type:"add",text:r[u]}),u+=1);for(;i<a;)c.push({type:"remove",text:s[i]}),i+=1;for(;u<o;)c.push({type:"add",text:r[u]}),u+=1;return c},sv=e=>e==="STEP2"?2:e==="PREVIEW"?3:1,rv=e=>{switch(e){case"STEP1":return"Setup";case"STEP2":return"Draft";case"PREVIEW":return"Preview";case"CASE_FOLDER":return"Case Folder";default:return"Dashboard"}},av=e=>e?e.role:"Guest",ov=e=>e===1?[{intent:"explain_current_screen",label:"   ?"},{intent:"explain_buttons_in_step",label:"    "},{intent:"common_mistakes_here",label:"   1"}]:e===2?[{intent:"explain_current_screen",label:"    2"},{intent:"when_to_use_ai_tools",label:"   -AI "},{intent:"explain_hebrew_rewrite",label:"    "},{intent:"explain_tone_risk",label:"  Tone & Risk"},{intent:"common_mistakes_here",label:"   2"}]:[{intent:"pre_send_checks",label:"    "},{intent:"explain_tone_risk",label:"   Tone & Risk?"},{intent:"common_mistakes_here",label:"   "}],lv=({isOpen:e,onClose:t,view:s,currentUser:r,currentReport:a,loading:o,error:l,response:c,onRunIntent:i})=>{if(!e)return null;const u=sv(s),p=rv(s),y=av(r),S=ov(u),w=!!a;return n.jsxs(n.Fragment,{children:[n.jsx("div",{className:"fixed inset-0 bg-black/10 z-[180]",onClick:t}),n.jsxs("div",{className:"fixed inset-y-0 right-0 z-[190] w-full max-w-md bg-panel border-l border-borderDark200 shadow-2xl flex flex-col",children:[n.jsxs("div",{className:"px-4 py-3 border-b border-borderDark200 flex items-center justify-between bg-navySecondary",children:[n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsx("div",{className:"h-8 w-8 rounded-full bg-indigo-600 flex items-center justify-center text-white",children:n.jsx(aa,{className:"w-4 h-4"})}),n.jsxs("div",{className:"flex flex-col",children:[n.jsx("span",{className:"text-sm font-semibold text-textLight",children:" "}),n.jsxs("span",{className:"text-[11px] text-textMuted",children:["Step ",u,"  ",p,"  ",y]})]})]}),n.jsx("button",{type:"button",onClick:t,className:"p-1 rounded hover:bg-navySecondary text-textMuted",children:n.jsx(Ot,{className:"w-4 h-4"})})]}),n.jsxs("div",{className:"px-4 py-3 border-b border-borderDark bg-panel",children:[n.jsxs("div",{className:"flex items-center justify-between mb-2",children:[n.jsx("span",{className:"text-[11px] font-semibold text-textMuted600",children:"   "}),!w&&n.jsx("span",{className:"text-[10px] text-textMuted",children:'     ".'})]}),n.jsx("div",{className:"flex flex-wrap gap-2",children:S.map(L=>n.jsx("button",{type:"button",disabled:o||!w,onClick:()=>i(L.intent),className:`text-[11px] px-3 py-1.5 rounded-full border transition ${o||!w?"border-borderDark200 text-textMuted bg-navySecondary cursor-not-allowed":"border-indigo-200 text-indigo-800 bg-indigo-50 hover:bg-indigo-100"}`,children:L.label},L.intent))})]}),n.jsxs("div",{className:"flex-1 overflow-auto px-4 py-3 space-y-3",dir:"rtl",children:[o&&n.jsxs("div",{className:"flex items-center gap-2 text-[12px] text-textMuted600",children:[n.jsx(Lt,{className:"w-4 h-4 animate-spin"}),n.jsx("span",{children:"      "})]}),!o&&l&&n.jsxs("div",{className:"rounded-md border border-red-200 bg-red-50 px-3 py-2 text-[12px] text-red-800",children:[n.jsx("div",{className:"font-semibold mb-1",children:"    "}),n.jsx("div",{children:"      .   ,   ."})]}),!o&&!l&&c&&n.jsxs("div",{className:"space-y-2",children:[n.jsx("div",{className:"text-sm font-semibold text-textLight",children:c.title}),n.jsx("ul",{className:"list-disc pr-4 space-y-1 text-[12px] text-textLight",children:c.bullets.map((L,k)=>n.jsx("li",{children:L},k))}),c.warning&&n.jsxs("div",{className:"mt-2 rounded-md border border-amber-200 bg-amber-50 px-3 py-2 text-[11px] text-amber-900",children:[n.jsx("span",{className:"font-semibold",children:" : "}),c.warning]}),c.nextSuggestion&&n.jsxs("div",{className:"mt-1 text-[11px] text-textMuted600",children:[n.jsx("span",{className:"font-semibold",children:" : "}),c.nextSuggestion]})]}),!o&&!l&&!c&&n.jsxs("div",{className:"text-[12px] text-textMuted space-y-1",children:[n.jsx("div",{children:'         ,    " .'}),n.jsx("div",{children:"         ."})]})]}),n.jsxs("div",{className:"px-4 py-3 border-t border-borderDark bg-navySecondary",children:[n.jsx("div",{className:"text-[10px] text-textMuted mb-1",children:"   '        ."}),n.jsx("input",{type:"text",disabled:!0,className:"w-full text-[11px] px-2 py-1.5 rounded border border-dashed border-borderDark200 bg-navySecondary text-textMuted",placeholder:"          ."})]})]})]})},Lp=24*60*60*1e3;function pt(e,t,s=new Date){const r={isLocked:!1,lockType:"NONE",lockAt:null,autoLockAt:null,remainingDays:null,reasonSummary:null},a=s.getTime();if(t!=null&&t.closedAt){const o=t.closedAt;return{...r,isLocked:!0,lockType:"MANUAL",lockAt:o,autoLockAt:null,remainingDays:null,reasonSummary:"      ."}}if(e.manualLockedAt)return{...r,isLocked:!0,lockType:"MANUAL",lockAt:e.manualLockedAt,autoLockAt:null,remainingDays:null,reasonSummary:e.manualLockReason?` : ${e.manualLockReason}`:"   ."};if(e.firstSentAt){const l=new Date(e.firstSentAt).getTime();if(!Number.isFinite(l))return r;const i=35+((e.lockExtensions||[]).reduce((k,U)=>{const N=typeof U.days=="number"&&!Number.isNaN(U.days)?U.days:0;return k+N},0)||0),u=l+i*Lp,p=new Date(u),y=p.toISOString();if(a>=u)return{...r,isLocked:!0,lockType:"AUTO",lockAt:y,autoLockAt:y,remainingDays:null,reasonSummary:"    35    ."};const w=(u-a)/Lp,L=w>0?Math.ceil(w):0;return{...r,isLocked:!1,lockType:"NONE",lockAt:null,autoLockAt:y,remainingDays:L,reasonSummary:`    -${L}  (-${p.toLocaleDateString("he-IL")}).`}}return r}const _p=new Map,iv=60*1e3;function pl(e){const t=`${e.reason}::${e.reportId??"unknown"}`,s=Date.now(),r=_p.get(t)??0;s-r<iv||(_p.set(t,s),console.info("[blocked-edit]",e))}const cv="personal_snippets",Fh=e=>`${cv}:${e}`,dv=(e,t)=>{if(!e)return[];try{const s=JSON.parse(e);if(!Array.isArray(s))return[];const r=new Date().toISOString();return s.map((a,o)=>{const l=a||{},c=typeof l.id=="string"&&l.id?l.id:`ps-${Date.now()}-${o}-${Math.random().toString(36).slice(2,6)}`,i=typeof l.title=="string"&&l.title.trim()?l.title:"Untitled snippet",u=typeof l.body=="string"?l.body:"",p=typeof l.createdAt=="string"&&l.createdAt?l.createdAt:r,y=typeof l.updatedAt=="string"&&l.updatedAt?l.updatedAt:p,S=typeof l.createdByUserId=="string"&&l.createdByUserId?l.createdByUserId:t,w=typeof l.usageCount=="number"&&Number.isFinite(l.usageCount)&&l.usageCount>=0?l.usageCount:0,L=typeof l.lastUsedAt=="string"&&l.lastUsedAt.trim()?l.lastUsedAt:null,k=typeof l.sectionKey=="string"&&l.sectionKey?l.sectionKey:void 0,U=Array.isArray(l.tags)?l.tags.filter(x=>typeof x=="string"&&x.trim()).map(x=>x.trim()):void 0;return{id:c,title:i,body:u,sectionKey:k,tags:U,createdByUserId:S,createdAt:p,updatedAt:y,usageCount:w,lastUsedAt:L}})}catch{return[]}},jo=e=>{if(typeof window>"u")return[];if(!e)return[];const t=window.localStorage.getItem(Fh(e));return dv(t,e)},Yu=(e,t)=>{if(!(typeof window>"u")&&e)try{window.localStorage.setItem(Fh(e),JSON.stringify(t))}catch{}},uv=(e,t)=>{const s=new Date().toISOString(),r=jo(e);let a;if(t.id)a=r.map(o=>o.id===t.id?{...o,title:t.title,body:t.body,sectionKey:t.sectionKey,tags:t.tags,updatedAt:s}:o);else{const l={id:`ps-${Date.now()}-${Math.random().toString(36).slice(2,8)}`,title:t.title,body:t.body,sectionKey:t.sectionKey,tags:t.tags,createdByUserId:e,createdAt:s,updatedAt:s,usageCount:0,lastUsedAt:null};a=[...r,l]}return Yu(e,a),a},Op=(e,t)=>{const r=jo(e).filter(a=>a.id!==t);return Yu(e,r),r},mv=(e,t)=>{const s=jo(e),r=new Date().toISOString(),a=s.map(o=>o.id===t?{...o,usageCount:(o.usageCount||0)+1,lastUsedAt:r}:o);return Yu(e,a),a},Mp="           (OCR). /     /  .",Rr="     .       .",pv={title:"Final Preview",toggleHide:"Hide Preview",toggleShow:"Show Preview",downloadPdf:"Download PDF",editFileNames:"Edit file name titles",finalize:"Finalize & Close",backToEditing:"Back to Editing",backToStep2:"Back to Step 2",backToDashboard:"Back to dashboard",helperScroll:"Scroll to review entire document",collapsedHint:'Click "Show Preview" to review the document before sending.'},fv={title:" ",toggleHide:" ",toggleShow:" ",downloadPdf:" PDF",editFileNames:"  ",finalize:" ",backToEditing:" ",backToStep2:"  2",backToDashboard:"  ",helperScroll:"    ",collapsedHint:'  " "     .'},xv=e=>e==="LAWYER"?fv:pv,Pp={SOC:["   ___________     ____________ ____________   ,   ____________________.","","        ____________________.","","      ,       ________________________."].join(`
`),LOD:["   ___________      .","","        ____________________.","",",    Claimant    ,      ______________________."].join(`
`)},hv=({message:e,type:t,onClose:s})=>{const r="fixed top-4 right-4 z-[100] p-4 rounded-lg shadow-xl border-l-4 flex items-center gap-3 animate-slide-in bg-panel border-borderDark text-textLight",a=t==="success"?"border-l-gold text-goldLight":t==="error"?"border-l-danger text-red-300":t==="warning"?"border-l-gold text-goldLight":"border-l-gold text-textLight";return n.jsxs("div",{className:`${r} ${a}`,children:[n.jsx("span",{children:e}),n.jsx("button",{onClick:s,className:"hover:bg-navySecondary p-1 rounded text-textMuted",children:n.jsx(Ot,{className:"w-4 h-4"})})]})},gv=({onSubmit:e,onCancel:t,initialTitle:s})=>{const[r,a]=g.useState(s||""),[o,l]=g.useState("BEST_PRACTICE"),[c,i]=g.useState(""),[u,p]=g.useState("INSERTABLE"),y=S=>{S.preventDefault();const w=r.trim();if(!w)return;const L=c.split(",").map(k=>k.trim()).filter(Boolean);e({title:w,label:o,tags:L,behavior:u})};return n.jsxs("form",{onSubmit:y,className:"px-4 py-3 space-y-3 text-xs",children:[n.jsxs("div",{className:"space-y-1",children:[n.jsx("label",{className:"block font-semibold text-textLight",children:"Title"}),n.jsx("input",{type:"text",className:"w-full border border-borderDark rounded px-2 py-1 text-xs",value:r,onChange:S=>a(S.target.value),required:!0})]}),n.jsxs("div",{className:"space-y-1",children:[n.jsx("label",{className:"block font-semibold text-textLight",children:"Label / Type"}),n.jsxs("select",{className:"w-full border border-borderDark rounded px-2 py-1 text-xs",value:o,onChange:S=>l(S.target.value==="LLOYDS_RECOMMENDED"?"LLOYDS_RECOMMENDED":"BEST_PRACTICE"),children:[n.jsx("option",{value:"BEST_PRACTICE",children:"Best practice"}),n.jsx("option",{value:"LLOYDS_RECOMMENDED",children:"Lloyds recommended"})]})]}),n.jsxs("div",{className:"space-y-1",children:[n.jsx("label",{className:"block font-semibold text-textLight",children:"Tags (optional)"}),n.jsx("input",{type:"text",className:"w-full border border-borderDark rounded px-2 py-1 text-xs",placeholder:"e.g. lloyds, settlement, high exposure",value:c,onChange:S=>i(S.target.value)})]}),n.jsxs("div",{className:"space-y-1",children:[n.jsx("label",{className:"block font-semibold text-textLight",children:"Behavior"}),n.jsxs("div",{className:"flex items-center gap-3",children:[n.jsxs("label",{className:"flex items-center gap-1",children:[n.jsx("input",{type:"radio",name:"bp-behavior",checked:u==="INSERTABLE",onChange:()=>p("INSERTABLE")}),n.jsx("span",{children:"Insertable (insert into body)"})]}),n.jsxs("label",{className:"flex items-center gap-1",children:[n.jsx("input",{type:"radio",name:"bp-behavior",checked:u==="COPY_ONLY",onChange:()=>p("COPY_ONLY")}),n.jsx("span",{children:"Copy only"})]})]})]}),n.jsxs("div",{className:"flex items-center justify-end gap-2 pt-2 border-t border-borderDark mt-2",children:[n.jsx("button",{type:"button",onClick:t,className:"px-3 py-1.5 rounded border border-borderDark text-[11px] text-textLight hover:bg-slate-100",children:""}),n.jsx("button",{type:"submit",className:"px-3 py-1.5 rounded bg-emerald-600 text-white text-[11px] hover:bg-emerald-700",children:" Best Practice"})]})]})},Fp=({value:e,onChange:t,placeholder:s,disabled:r,readOnly:a,dir:o="ltr",className:l,style:c={},textareaRef:i})=>{const u=g.useRef(null),p=i||u;return g.useEffect(()=>{const y=p&&"current"in p?p.current:u.current;y&&(y.style.height="auto",y.style.height=y.scrollHeight+"px")},[e,p]),n.jsx(ho,{clientId:vo,children:n.jsx("textarea",{ref:p,className:l,dir:o,value:e,onChange:a?void 0:t,placeholder:s,disabled:r||a,rows:3,style:{...c,overflow:"hidden",resize:"none"}})})},yv=({onClose:e})=>{const[t,s]=g.useState("MANUAL"),[r,a]=g.useState(""),[o,l]=g.useState([]),[c,i]=g.useState(!1),u=async()=>{if(!r.trim())return;i(!0);const p=await Q0(r);l(y=>[...y,{q:r,a:p}]),a(""),i(!1)};return n.jsx("div",{className:"fixed inset-0 bg-black/50 z-[200] flex items-center justify-center p-4",children:n.jsxs("div",{className:"bg-panel w-full max-w-3xl h-[600px] rounded-xl shadow-2xl flex flex-col overflow-hidden animate-scale-in",children:[n.jsxs("div",{className:"bg-navy p-4 text-gold flex justify-between items-center",children:[n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsx(Cu,{className:"w-6 h-6"}),n.jsx("h2",{className:"font-bold text-lg",children:"  "})]}),n.jsx("button",{onClick:e,className:"hover:bg-panel/20 rounded p-1",children:n.jsx(Ot,{className:"w-5 h-5"})})]}),n.jsxs("div",{className:"flex border-b",children:[n.jsx("button",{onClick:()=>s("MANUAL"),className:`flex-1 p-3 font-bold ${t==="MANUAL"?"text-lpBlue border-b-2 border-lpBlue":"text-textMuted"}`,children:" "}),n.jsx("button",{onClick:()=>s("CHAT"),className:`flex-1 p-3 font-bold ${t==="CHAT"?"text-lpBlue border-b-2 border-lpBlue":"text-textMuted"}`,children:"   "})]}),n.jsx("div",{className:"flex-1 overflow-auto p-6 bg-navySecondary",dir:"rtl",children:t==="MANUAL"?n.jsxs("div",{className:"space-y-4",children:[n.jsxs("details",{className:"bg-panel p-4 rounded shadow-sm group",children:[n.jsxs("summary",{className:"font-bold text-textLight cursor-pointer list-none flex justify-between",children:["   ",n.jsx(ts,{className:"group-open:rotate-90 transition"})]}),n.jsxs("div",{className:"mt-2 text-textMuted text-sm space-y-1",children:[n.jsx("p",{children:"1.       (CRM / Finance /    )."}),n.jsx("p",{children:"2.       +  Notifications   ."}),n.jsx("p",{children:`3.  ""     ' .`})]})]}),n.jsxs("details",{className:"bg-panel p-4 rounded shadow-sm group",children:[n.jsxs("summary",{className:"font-bold text-textLight cursor-pointer list-none flex justify-between",children:['    " ',n.jsx(ts,{className:"group-open:rotate-90 transition"})]}),n.jsxs("div",{className:"mt-2 text-textMuted text-sm space-y-1",children:[n.jsxs("p",{children:["1.   ",n.jsx("strong",{children:"Open New Case Folder"}),",      ."]}),n.jsx("p",{children:"2.  ,   4  (Word/PDF)    ."}),n.jsx("p",{children:"3.   FINANCE FINALIZE     ."})]})]}),n.jsxs("details",{className:"bg-panel p-4 rounded shadow-sm group",children:[n.jsxs("summary",{className:"font-bold text-textLight cursor-pointer list-none flex justify-between",children:["   ",n.jsx(ts,{className:"group-open:rotate-90 transition"})]}),n.jsxs("div",{className:"mt-2 text-textMuted text-sm space-y-1",children:[n.jsx("p",{children:'   View Worksheet  , ,   " .'}),n.jsx("p",{children:" /     ( ADD),    ."}),n.jsx("p",{children:'  ,      "     Expenses.'})]})]}),n.jsxs("details",{className:"bg-panel p-4 rounded shadow-sm group",children:[n.jsxs("summary",{className:"font-bold text-textLight cursor-pointer list-none flex justify-between",children:["    ",n.jsx(ts,{className:"group-open:rotate-90 transition"})]}),n.jsxs("div",{className:"mt-2 text-textMuted text-sm space-y-1",children:[n.jsx("p",{children:"  Manage Favorite Providers     ."}),n.jsx("p",{children:"        ."}),n.jsx("p",{children:'    4   (PDF/Word)  "    .'})]})]}),n.jsxs("details",{className:"bg-panel p-4 rounded shadow-sm group",children:[n.jsxs("summary",{className:"font-bold text-textLight cursor-pointer list-none flex justify-between",children:[' "     ',n.jsx(ts,{className:"group-open:rotate-90 transition"})]}),n.jsxs("div",{className:"mt-2 text-textMuted text-sm space-y-1",children:[n.jsx("p",{children:"       -FINANCE   FINALIZE."}),n.jsx("p",{children:' FINALIZE  "     (READY TO SEND)   .'}),n.jsx("p",{children:"     (48   , 30   )     ."})]})]})]}):n.jsxs("div",{className:"flex flex-col h-full",children:[n.jsxs("div",{className:"flex-1 space-y-4 mb-4 overflow-auto",children:[o.length===0&&n.jsx("div",{className:"text-center text-gray-400 mt-10",children:"     !"}),o.map((p,y)=>n.jsxs("div",{className:"space-y-1",children:[n.jsx("div",{className:"bg-blue-100 text-blue-900 p-2 rounded-lg rounded-tr-none self-end w-fit ml-auto max-w-[80%]",children:p.q}),n.jsx("div",{className:"bg-panel border text-textLight p-2 rounded-lg rounded-tl-none self-start w-fit mr-auto max-w-[80%]",children:p.a})]},y))]}),n.jsxs("div",{className:"flex gap-2",dir:"ltr",children:[n.jsx("input",{className:"flex-1 border p-2 rounded",placeholder:"/   ...",value:r,onChange:p=>a(p.target.value),onKeyDown:p=>p.key==="Enter"&&u()}),n.jsx("button",{onClick:u,disabled:c,className:"bg-navy text-gold px-4 rounded hover:bg-navySecondary",children:c?n.jsx(Lt,{className:"w-5 h-5 animate-spin"}):n.jsx(Zl,{className:"w-5 h-5"})})]})]})})]})})},Nv=({reports:e,currentUser:t,onMarkPaid:s})=>{const r=e.filter(l=>l.expensesSum&&!l.isPaid),a=r.reduce((l,c)=>{var u;const i=parseFloat(((u=c.expensesSum)==null?void 0:u.replace(/,/g,""))||"0");return l+(isNaN(i)?0:i)},0),o=t.role==="SUB_ADMIN";return r.length?n.jsxs("div",{className:"mb-8 bg-panel rounded-xl shadow-sm border border-indigo-100 overflow-hidden",children:[n.jsxs("div",{className:"bg-gradient-to-r from-indigo-600 to-indigo-800 p-4 text-white flex justify-between items-center",children:[n.jsxs("h3",{className:"font-bold text-lg flex items-center",children:[n.jsx(k0,{className:"w-6 h-6 mr-2"})," Financial Control - Outstanding Expenses"]}),n.jsxs("div",{className:"text-xl font-bold bg-panel/20 px-4 py-1 rounded",children:["Total: ",a.toLocaleString()]})]}),n.jsx("div",{className:"overflow-x-auto",children:n.jsxs("table",{className:"w-full text-left text-sm",children:[n.jsx("thead",{className:"bg-indigo-50 text-indigo-800",children:n.jsxs("tr",{children:[n.jsx("th",{className:"p-3",children:"Report Date"}),n.jsx("th",{className:"p-3",children:"Insured / File"}),n.jsx("th",{className:"p-3",children:"Amount Requested"}),n.jsx("th",{className:"p-3",children:"Action"})]})}),n.jsx("tbody",{className:"divide-y divide-gray-100",children:r.map(l=>n.jsxs("tr",{className:"hover:bg-navySecondary",children:[n.jsx("td",{className:"p-3",children:new Date(l.reportDate).toLocaleDateString()}),n.jsxs("td",{className:"p-3 font-medium",children:[l.insuredName," (",l.marketRef,")"]}),n.jsxs("td",{className:"p-3 font-bold text-indigo-700",children:["",l.expensesSum]}),n.jsx("td",{className:"p-3",children:o?n.jsx("button",{onClick:()=>s(l.id),className:"text-red-400 hover:text-red-600 hover:bg-red-50 p-1.5 rounded transition",title:"Mark as Paid",children:n.jsx($s,{className:"w-4 h-4"})}):n.jsx("span",{className:"text-gray-400 cursor-not-allowed",children:n.jsx($s,{className:"w-4 h-4"})})})]},l.id))})]})})]}):null};new URL("/assets/statement%20of%20claim-BbEIHM0L.jpg",import.meta.url).href,new URL("/assets/statement%20of%20defence-BIigMwUC.jpg",import.meta.url).href,new URL("/assets/preliminary%20proceedings-BoY9iCcP.jpg",import.meta.url).href,new URL("/assets/evidence%20submission-CZIKo1E1.jpg",import.meta.url).href,new URL("/assets/evidentiary%20hearing-BibkA_Ru.jpg",import.meta.url).href,new URL("/assets/summaries-BEUvavav.jpg",import.meta.url).href,new URL("/assets/judgment-cIMuyU1R.jpg",import.meta.url).href;const bv=[{value:"LETTER_OF_DEMAND",label:"Letter of Demand"},{value:"FIRST_INSTANCE",label:"First Instance Proceedings"},{value:"APPEAL",label:"Appeal Proceedings"}],Oa={LETTER_OF_DEMAND:[{id:"LOD_ISSUED",label:"Letter of Demand Issued"},{id:"LOD_INTERNAL_REVIEW",label:"Internal Review & Coverage Assessment"},{id:"LOD_RESPONSE",label:"Response to Letter of Demand"},{id:"LOD_PRE_LITIGATION",label:"Pre-Litigation Negotiations"},{id:"LOD_OUTCOME_ESCALATION",label:"Outcome / Escalation Decision"},{id:"LOD_CLAIM_SETTLED",label:"Claim Settled"},{id:"LOD_DEMAND_REJECTED",label:"Demand Rejected"}],FIRST_INSTANCE:[{id:"FI_STATEMENT_OF_CLAIM",label:"Statement of Claim Filed"},{id:"FI_STATEMENT_OF_DEFENCE",label:"Statement of Defence Filed"},{id:"FI_DISCOVERY_DISCLOSURE",label:"Discovery & Disclosure"},{id:"FI_COURT_APPOINTED_EXPERT",label:"Court-Appointed Expert",isDynamic:!0},{id:"FI_RD_DOCS_DAMAGE_SUBMISSIONS",label:"R & D Docs  Damage Assessment Submissions",isDynamic:!0},{id:"FI_EVIDENTIARY_HEARINGS",label:"Evidentiary Hearings"},{id:"FI_SUMMATIONS",label:"Summations"},{id:"FI_JUDGMENT",label:"Judgment"}],APPEAL:[{id:"AP_DECISION_TO_APPEAL",label:"Decision to Appeal"},{id:"AP_NOTICE_OF_APPEAL",label:"Notice of Appeal Filed"},{id:"AP_RESPONSE_TO_APPEAL",label:"Response to Appeal"},{id:"AP_APPEAL_HEARINGS",label:"Appeal Hearings"},{id:"AP_APPEAL_JUDGMENT",label:"Appeal Judgment"}]},ss=[{value:"EXPERT_OUR",label:"Expert fees on our behalf",type:"EXPENSE"},{value:"EXPERT_COURT",label:"Expert fees on behalf of the court",type:"EXPENSE"},{value:"INVESTIGATION",label:"Private Investigation fees",type:"EXPENSE"},{value:"SECONDARY_FEE",label:"Payment of secondary procedure fee",type:"EXPENSE"},{value:"COURT_FEES",label:"Court fees",type:"EXPENSE"},{value:"PHOTOCOPY",label:"Photocopying and binding of documents",type:"EXPENSE"},{value:"MEDICAL_RECORDS",label:"Medical Records Collection",type:"EXPENSE"},{value:"ATTORNEY_PHASE_1",label:"Attorney fees for phase 1",type:"EXPENSE"},{value:"ATTORNEY_PHASE_2",label:"Attorney fees for phase 2",type:"EXPENSE"},{value:"ATTORNEY_PHASE_3",label:"Attorney fees for phase 3",type:"EXPENSE"},{value:"ATTORNEY_PHASE_4",label:"Attorney fees for phase 4",type:"EXPENSE"},{value:"ATTORNEY_PHASE_5",label:"Attorney fees for phase 5",type:"EXPENSE"},{value:"ATTORNEY_EXTRA_HEARING",label:"Attorney fees for extra court hearing",type:"EXPENSE"},{value:"ATTORNEY_THIRD_PARTY",label:"Attorney fees for third party notice",type:"EXPENSE"},{value:"OTHER",label:"Other",type:"EXPENSE"},{value:"COMPENSATION_JUDGMENT",label:"Compensation by Judgment",type:"ADJUSTMENT"},{value:"COMPENSATION_SETTLEMENT",label:"Compensation under Settlement",type:"ADJUSTMENT"},{value:"DEDUCTIBLE",label:"Deductible paid by the insured",type:"ADJUSTMENT"},{value:"PAID_BY_INSURER",label:"Expenses already paid by the insurer",type:"ADJUSTMENT"}],Ps=()=>({status:"DRAFT",rows:[],history:[],notes:[],favorites:[],totals:{totalExpenses:0,totalAdjustments:0,totalBalance:0}}),vv=1e3*60*60*48,Bh=1e3*60*60*24*30,$h=7*24*60*60*1e3,Bp={lineSlip:"UNIQUE MARKET REF",certificate:"CERTIFICATE REF"},ct={REPORTS:"lp_reports",USER:"lp_current_user",VIEW:"lp_view",CURRENT_REPORT:"lp_current_report",CASE_FOLDERS:"lp_case_folders",NOTIFICATIONS:"lp_notifications"},Sv="financial_expenses_store_v1",wv=(e,t,s)=>{if(!(typeof window>"u"))try{const r=[...e];if(t){const i=r.findIndex(p=>p.id===t.id),u=i>=0?{...r[i],...t}:t;i>=0?r[i]=u:r.push(u)}const a={version:1,exportedAt:new Date().toISOString(),reports:r,caseFolders:s,notifications:(()=>{try{const i=localStorage.getItem(ct.NOTIFICATIONS);return i?JSON.parse(i):[]}catch{return[]}})(),financialStore:(()=>{try{const i=localStorage.getItem(Sv);return i?JSON.parse(i):{}}catch{return{}}})(),caseTemplates:(()=>{try{const i=localStorage.getItem("caseTemplates");return i?JSON.parse(i):[]}catch{return[]}})(),favoriteProviders:(()=>{try{const i=localStorage.getItem("favoriteProviders");return i?JSON.parse(i):{}}catch{return{}}})()},o=new Blob([JSON.stringify(a,null,2)],{type:"application/json"}),l=URL.createObjectURL(o),c=document.createElement("a");c.href=l,c.download=`report-crm-backup-${new Date().toISOString().slice(0,10)}.json`,c.click(),URL.revokeObjectURL(l)}catch(r){console.error("Backup download failed",r)}},Xa="Expenses breakdown",Jr=e=>e?e===Xa?!0:/\bexpenses\b/i.test(e):!1,jv=()=>{},$p=(e,t,s)=>{if(!e)return e;let r=!1;const a={...e};if(a.content&&t.forEach(o=>{var c;const l=(c=a.content)==null?void 0:c[o];l!==void 0&&(a.content={...a.content},!a.content[s]&&l&&(a.content[s]=l),delete a.content[o],r=!0)}),a.translatedContent&&t.forEach(o=>{var c;const l=(c=a.translatedContent)==null?void 0:c[o];l!==void 0&&(a.translatedContent={...a.translatedContent},!a.translatedContent[s]&&l&&(a.translatedContent[s]=l),delete a.translatedContent[o],r=!0)}),Array.isArray(a.selectedSections)&&a.selectedSections.some(l=>t.includes(l))){const l=a.selectedSections.map(c=>t.includes(c)?s:c);a.selectedSections=Array.from(new Set(l)),r=!0}return a.expertSummaryMode&&t.forEach(o=>{var c;const l=(c=a.expertSummaryMode)==null?void 0:c[o];l&&(a.expertSummaryMode={...a.expertSummaryMode,[s]:l},delete a.expertSummaryMode[o],r=!0)}),r?a:e},Ev=e=>{let t=$p(e,mh,Ws);return t=$p(t,ph,Ro),t},kv=e=>{const t={...e};return t.reportReview||(t.reportReview={status:"DRAFT",issues:[]}),t.hebrewWorkflowStatus||(t.hebrewWorkflowStatus="HEBREW_DRAFT"),Array.isArray(t.reportReview.issues)&&t.reportReview.issues.length>0&&(t.reportReview={...t.reportReview,issues:t.reportReview.issues.map(s=>{const r=s.origin??"INTERNAL";let a=s.externalAction;return r==="EXTERNAL"&&!a&&(a="ENGLISH_ONLY"),{...s,origin:r,externalAction:a}})}),t},Av=()=>{if(typeof window>"u")return[];try{jv();const e=localStorage.getItem(ct.REPORTS);return(e?JSON.parse(e):[]).map(Ev).map(kv)}catch(e){return console.error("Failed to load stored reports",e),[]}},Iv=()=>{if(typeof window>"u")return"DASHBOARD";const e=localStorage.getItem(ct.VIEW);return e&&(e==="STEP1"||e==="STEP2"||e==="PREVIEW"||e==="DASHBOARD"||e==="CASE_FOLDER")?e:"DASHBOARD"},oi=e=>{const t=e.filter(r=>r.type==="EXPENSE").reduce((r,a)=>r+(a.amount||0),0),s=e.filter(r=>r.type==="ADJUSTMENT").reduce((r,a)=>r+(a.amount||0),0);return{totalExpenses:t,totalAdjustments:s,totalBalance:t-s}},Hp=e=>{var t,s;if((t=e.expenseWorksheet)!=null&&t.totals)return e.expenseWorksheet.totals.totalBalance;if(e.expensesSum){const r=parseFloat(e.expensesSum.replace(/,/g,""));if(!isNaN(r))return r}return(s=e.expensesItems)!=null&&s.length?e.expensesItems.reduce((r,a)=>r+(a.amount||0),0):0},Up=e=>{var t,s,r;return(((s=(t=e.expenseWorksheet)==null?void 0:t.rows)==null?void 0:s.length)??0)>0||(((r=e.expensesItems)==null?void 0:r.length)??0)>0||!!(e.expensesSum&&e.expensesSum!=="0")},An=()=>Math.random().toString(36).slice(2,10),Cr=e=>e==null?e:JSON.parse(JSON.stringify(e)),Wp=e=>new Promise((t,s)=>{const r=new FileReader;r.onloadend=()=>{const a=r.result,o=a.includes(",")?a.split(",")[1]:a;t(o)},r.onerror=()=>s(new Error("Failed to convert blob")),r.readAsDataURL(e)}),li=e=>e?e.replace(/\r\n/g,`
`).replace(/\t/g," ").split(`
`).map(r=>r.replace(/\s+$/g,"").replace(/ {2,}/g," ")).join(`
`).trim().replace(/\n{3,}/g,`

`):"",Hh=e=>{if(!e)return e;let t=e;const s=[{pattern:/\bprosecutor\b/gi,replacement:"plaintiff"},{pattern:/\ba specialist\b/gi,replacement:"an expert"},{pattern:/\bthe specialist\b/gi,replacement:"the expert"},{pattern:/\bProf\.(?=\s|$)/gi,replacement:"prof"},{pattern:/\bNational Insurance Institute\b/gi,replacement:"NII"},{pattern:/\boperation\b/gi,replacement:"surgery"},{pattern:/\bdamage calculations\b/gi,replacement:"R & D Docs"},{pattern:/\bdemander\b/gi,replacement:"claimant"},{pattern:/\bapplicant\b/gi,replacement:"claimant"},{pattern:/\bbranch\b/gi,replacement:"clinic"},{pattern:/\bverdict\b/gi,replacement:"judgment"},{pattern:/\binterrogation\b/gi,replacement:"cross-examination"},{pattern:/\bDr\.(?=\s|$)/gi,replacement:"Dr"},{pattern:/\bversion\b/gi,replacement:"position"},{pattern:/\bpolicyholder\b/gi,replacement:"insured"}];for(const{pattern:r,replacement:a}of s)t=t.replace(r,a);return t=t.replace(/\bopinion\b/gi,(r,a,o)=>{const l=Math.max(0,a-20),c=o.slice(l,a).toLowerCase();return/\bexpert\s*$/.test(c)?r:"expert opinion"}),t},Mc=e=>{const t=e||{};return Object.keys(t).reduce((s,r)=>(s[r]=li(t[r]),s),{})},Tv=e=>e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),Uh=e=>{if(!e)return{protectedText:e,map:{}};let t=e;const s={};let r=0;const a=(l,c)=>{t=t.replace(l,i=>{const u=`${c}_${++r}`;return s[u]||(s[u]=i),u})};a(/(?:|\$||)\s*\d[\d,]*(?:\.\d+)?/g,"MONEY"),a(/\b(?:USD|NIS|ILS|EUR|GBP)\s*\d[\d,]*(?:\.\d+)?\b/gi,"MONEY"),a(/\d[\d,]*(?:\.\d+)?\s*(?:NIS|ILS|USD|EUR|GBP)\b/gi,"MONEY"),a(/\d[\d,]*(?:\.\d+)?%/g,"PCT"),a(/\b\d{1,2}[\/\.]\d{1,2}[\/\.]\d{4}\b/g,"DATE");const o="(January|February|March|April|May|June|July|August|September|October|November|December|Jan|Feb|Mar|Apr|Jun|Jul|Aug|Sep|Oct|Nov|Dec)";return a(new RegExp(`\\b\\d{1,2}\\s+${o}\\s+\\d{4}\\b`,"g"),"DATE"),a(new RegExp(`\\b${o}\\s+\\d{1,2},\\s+\\d{4}\\b`,"g"),"DATE"),a(/\b(?:Policy\s+No\.?|Claim\s+#?|File|Case)\s+[A-Za-z0-9\/\-]+\b/gi,"ID"),a(/\b[A-Za-z0-9]{3,}[A-Za-z0-9\-\/]{3,}\b/g,"ID"),a(/\b\d{1,3}(?:,\d{3})*(?:\.\d+)?\b/g,"NUM"),{protectedText:t,map:s}},Wh=(e,t)=>{if(!e||!t||!Object.keys(t).length)return e;let s=e;for(const[r,a]of Object.entries(t)){const o=new RegExp(Tv(r),"g");s=s.replace(o,a)}return s},Rv=`
               . ,   ,          .

          , ,  ,            .

      -  ,     .

   ,     ,                .

      .
`.trim(),Cv=["The policy period is from [policyStartDate] to [policyEndDate].","","The retroactive date is [retroactiveDate].","","    _______________, ,   .","","      ,     ____________  ____________.","",",         ."].join(`
`),zh=(e,t,s,r,a)=>{const o=Cv,l=F=>`${F}`,c=t||"",i=s||"",u=r||a||"",p=l(`The policy period is from ${c} to ${i}.`),y=l(`The retroactive date is ${u}.`),S=["    _______________, ,   .","","      ,     ____________  ____________.","",",         ."].join(`
`),w=F=>F.replace(/\[policyStartDate\]/gi,c).replace(/\[policyEndDate\]/gi,i).replace(/\[retroactiveDate\]/gi,u),L=`${p}

${y}

${S}`,k=o?w(o):"";if(!k&&!e)return L;let N=e&&e.trim().length?e:k||L;(/\[policyStartDate\]/i.test(N)||/\[policyEndDate\]/i.test(N)||/\[retroactiveDate\]/i.test(N))&&(N=w(N));const x=/The policy period is[^\n]*/i;x.test(N)?N=N.replace(x,p):(!e||!e.trim())&&(N=`${p}

${N}`);const b=/The retroactive date is[^\n]*/i;return b.test(N)?N=N.replace(b,y):(!e||!e.trim())&&(N=N.includes(p)?N.replace(p,`${p}

${y}`):`${y}

${N}`),N.includes("   ")||(N=`${N.trim()}

${S}`),N},Md=(e,t)=>e.map(s=>{var l;const r=ss.find(c=>c.value===s.category),a=(r==null?void 0:r.type)||"EXPENSE",o=s.category==="OTHER"?((l=s.customLabel)==null?void 0:l.trim())||"Other expense":(r==null?void 0:r.label)||"Expense";return{id:s.id||An(),type:a,category:s.category,label:o,serviceProvider:a==="EXPENSE"?s.serviceProvider:void 0,amount:Number(s.amount)||0,locked:!1,createdBy:t==null?void 0:t.id,createdAt:new Date().toISOString(),updatedBy:t==null?void 0:t.id,updatedAt:new Date().toISOString()}}),Dv=e=>e.filter(t=>t.type==="EXPENSE").map(t=>({id:t.id,date:new Date().toISOString().split("T")[0],description:`${t.label}${t.serviceProvider?` (${t.serviceProvider})`:""}`,amount:t.amount,currency:"NIS"})),zp=e=>/[\u0590-\u05FF]/.test(e||""),Lv=({data:e,updateData:t,onNext:s,currentUser:r,timelineGallery:a,onAddTimelineImages:o,onRemoveTimelineImage:l,onSaveAndExit:c,readOnly:i})=>{var st,Je,J,re;const[u,p]=g.useState(""),[y,S]=g.useState(!1),w=e.insurerName===""||cp.includes(e.insurerName),[L,k]=g.useState(!w),[U,N]=g.useState(!1),[x,b]=g.useState(!1);g.useRef(null);const F=g.useRef(e.insuredName),H=g.useRef(e.plaintiffName);g.useEffect(()=>{F.current=e.insuredName},[e.insuredName]),g.useEffect(()=>{H.current=e.plaintiffName},[e.plaintiffName]);const[V,q]=g.useState(()=>({})),te=D=>D?new Date(D).toISOString().split("T")[0]:new Date().toISOString().split("T")[0],G=D=>D.trim().replace(/\s+/g," "),le=D=>{const ae=e,ee="plaintiffName"in D?D.plaintiffName??ae.plaintiffName:ae.plaintiffName,be="insuredName"in D?D.insuredName??ae.insuredName:ae.insuredName;if(!(!!ee&&!!be))return D;const Ae=G(ee),Re=G(be),Ge=`${Ae} v. ${Re}`,He="reportSubject"in D?D.reportSubject??ae.reportSubject:ae.reportSubject,Pe="isSubjectAuto"in D?D.isSubjectAuto??ae.isSubjectAuto:ae.isSubjectAuto;return!He||!He.trim()||Pe?{...D,reportSubject:Ge,isSubjectAuto:!0}:D},j=D=>{i||(D==="OTHER"?(k(!0),t(le({insurerName:""}))):(k(!1),t(le({insurerName:D}))))},T=()=>{if(!e.odakanitNo||!ke(e.odakanitNo)){alert("     (Odakanit)    .");return}s()},E=D=>{i||((e.expensesSheetId||e.expensesHtml)&&Jr(D)&&(D=Xa),e.selectedSections.includes(D)||t({selectedSections:[...e.selectedSections,D]}),S(!1))},C=D=>{if(i||D==="Update")return;if(!!(e.expensesSheetId||e.expensesHtml)&&Jr(D)){window.alert("           .");return}t({selectedSections:e.selectedSections.filter(ee=>ee!==D)})},se=()=>{i||u.trim()&&!e.selectedSections.includes(u)&&(t({selectedSections:[...e.selectedSections,u]}),p(""))},Y=(D,ae)=>{const ee=ae==="UP"?D-1:D+1;if(ee<0||ee>=e.selectedSections.length)return;const be=[...e.selectedSections];[be[D],be[ee]]=[be[ee],be[D]],t({selectedSections:be})},O=()=>{const D=e.proceduralTimeline;return D&&D.procedureType?D:{procedureType:"FIRST_INSTANCE",currentStageId:"FI_STATEMENT_OF_CLAIM",stages:[]}},P=typeof e.selectedTimeline=="string"?e.selectedTimeline.trim().length>0:!!e.selectedTimelineImage;g.useEffect(()=>{if(e.proceduralTimeline||P)return;const D=O();t({proceduralTimeline:D})},[e.proceduralTimeline,P]),g.useEffect(()=>{const D=e.proceduralTimeline;if(!D)return;const ae=Oa[D.procedureType];if(!ae||!ae.length)return;const ee=[];if(ae.forEach(Oe=>{var Ge;const Ae=((Ge=D.stages)==null?void 0:Ge.find(He=>He.id===Oe.id))||void 0;(Oe.isDynamic?!!(Ae!=null&&Ae.include):(Ae==null?void 0:Ae.include)!==!1)&&ee.push(Oe.id)}),!ee.length||ee.includes(D.currentStageId))return;const be=ee[0];be&&be!==D.currentStageId&&t({proceduralTimeline:{...D,currentStageId:be}})},[e.proceduralTimeline,t]);const X=D=>{var Ae;const ae=O(),be=(Ae=Oa[D][0])==null?void 0:Ae.id,Oe={...ae,procedureType:D,currentStageId:be||ae.currentStageId,stages:ae.stages.filter(Re=>Oa[ae.procedureType].some(Ge=>Ge.id===Re.id)).map(Re=>({...Re}))};t({proceduralTimeline:Oe}),q({})},ue=D=>{const ee={...O(),currentStageId:D};t({proceduralTimeline:ee})},xe=(D,ae)=>{const ee=O(),be=Array.isArray(ee.stages)?[...ee.stages]:[],Oe=be.findIndex(Ge=>Ge.id===D);Oe>=0?be[Oe]={...be[Oe],include:ae}:be.push({id:D,label:"",include:ae,isDynamic:!0,monthYear:null});let Ae=ee.currentStageId;if(!ae&&D===ee.currentStageId){const Ge=Oa[ee.procedureType];if(Ge&&Ge.length){const He=[];if(Ge.forEach(Pe=>{const Q=be.find(_=>_.id===Pe.id)||void 0;(Pe.isDynamic?!!(Q!=null&&Q.include):(Q==null?void 0:Q.include)!==!1)&&He.push(Pe.id)}),He.length){const Pe=Ge.findIndex(ye=>ye.id===D);let Q=null;if(Pe>0)for(let ye=Pe-1;ye>=0;ye-=1){const _=Ge[ye].id;if(He.includes(_)){Q=_;break}}Q||(Q=He[0]),Ae=Q}}}const Re={...ee,currentStageId:Ae,stages:be};t({proceduralTimeline:Re})},oe=(D,ae,ee)=>{q(He=>{const Pe={...He};return!!!ae&&!!!ee?delete Pe[D]:Pe[D]={month:ae,year:ee},Pe});const be=O(),Oe=Array.isArray(be.stages)?[...be.stages]:[],Ae=Oe.findIndex(He=>He.id===D);let Re=null;if(ae&&ee){const He=ae.padStart(2,"0");Re=`${ee}-${He}`}Ae>=0?Oe[Ae]={...Oe[Ae],monthYear:Re}:Oe.push({id:D,label:"",include:!0,isDynamic:!1,monthYear:Re});const Ge={...be,stages:Oe};t({proceduralTimeline:Ge})},fe=async D=>{var ee;if(i){D.preventDefault();return}const ae=(ee=D.target.files)==null?void 0:ee[0];if(ae){N(!0);try{const be=new FileReader;be.onload=async()=>{var He;const Oe=be.result.split(",")[1],Ae=await K0(Oe,ae.type);let Re={};if(Ae.insuredName){const Pe={...Re,insuredName:Ae.insuredName},Q=e.isSubjectAuto!==!1;Re=le(Q?{...Pe,isSubjectAuto:!0}:Pe),Q&&(!e.reportSubject||!e.reportSubject.trim())&&(Re.reportSubject=Ae.insuredName,Re.isSubjectAuto=!0)}Ae.marketRef?(Re.marketRef=Ae.marketRef,Re.lineSlipNo=Ae.marketRef):Ae.lineSlipNo&&!Re.lineSlipNo&&(Re.lineSlipNo=Ae.lineSlipNo),Ae.certificateRef&&(Re.certificateRef=Ae.certificateRef),typeof Ae.policyPeriodStart=="string"&&(Re.policyPeriodStart=Ae.policyPeriodStart),typeof Ae.policyPeriodEnd=="string"&&(Re.policyPeriodEnd=Ae.policyPeriodEnd),typeof Ae.retroStart=="string"&&(Re.retroStart=Ae.retroStart),typeof Ae.retroEnd=="string"&&(Re.retroEnd=Ae.retroEnd),Re.policyFile={id:"policy-doc",name:ae.name,data:Oe,type:ae.type};const Ge=zh((He=e.content)==null?void 0:He["Insurance Coverage"],Re.policyPeriodStart||e.policyPeriodStart,Re.policyPeriodEnd||e.policyPeriodEnd,Re.retroStart||e.retroStart,Re.retroEnd||e.retroEnd);Ge&&(Re.content={...e.content,"Insurance Coverage":Ge}),t(Re),N(!1)},be.readAsDataURL(ae)}catch(be){console.error("Error reading file",be),N(!1)}}},ve=10,_e=10,ze=async D=>{if(i){D.preventDefault(),D.target.value="";return}const ae=D.target.files;if(!ae||!ae.length)return;const ee=e.lawyerAppendixFiles??[];if(ee.length>=ve){alert(`You can attach up to ${ve} appendices.`),D.target.value="";return}const be=ve-ee.length,Oe=Array.from(ae).slice(0,be),Ae=[];for(const Re of Oe){if(Re.size/1048576>_e){alert(`${Re.name} is larger than ${_e}MB and will not be attached.`);continue}let He=Re.type;He||(/\.(tif|tiff)$/i.test(Re.name)?He="image/tiff":He="application/octet-stream");const Pe=new FileReader,Q=await new Promise((ye,_)=>{Pe.onload=()=>{const de=String(Pe.result||"").split(",");ye(de[1]||"")},Pe.onerror=()=>_(Pe.error),Pe.readAsDataURL(Re)});Ae.push({id:`lawyer-appx-${Date.now()}-${Math.random().toString(36).slice(2,8)}`,name:Re.name,data:Q,type:He})}Ae.length&&t({lawyerAppendixFiles:[...ee,...Ae]}),D.target.value=""},qe=D=>{if(i)return;const ee=(e.lawyerAppendixFiles??[]).filter(be=>be.id!==D);t({lawyerAppendixFiles:ee})},$e=(D,ae,ee,be)=>n.jsxs("div",{className:"relative group",children:[n.jsx("input",{className:"w-full border border-borderDark p-2 rounded focus:ring-2 focus:ring-lpBlue outline-none pr-8",placeholder:ee,value:D,onChange:i?void 0:Oe=>ae(Oe.target.value),onBlur:i?void 0:be?()=>be(D):void 0,disabled:i}),D&&n.jsx("button",{type:"button",onClick:i?void 0:()=>ae(""),className:`absolute right-2 top-1/2 -translate-y-1/2 text-gray-300 transition-colors ${i?"cursor-not-allowed opacity-50":"hover:text-red-500"}`,disabled:i,children:n.jsx($s,{className:"w-4 h-4"})})]});return n.jsxs("div",{className:"space-y-8",children:[n.jsx("div",{className:"flex justify-end",children:n.jsxs("button",{type:"button",onClick:i?void 0:c,disabled:i,className:`flex items-center text-sm bg-blue-50 px-3 py-1.5 rounded-full ${i?"text-gray-400 cursor-not-allowed":"text-lpBlue hover:text-blue-900"}`,title:i?"  .":void 0,children:[n.jsx(Du,{className:"w-4 h-4 mr-1"}),"  "]})}),n.jsx("h2",{className:"text-3xl font-bold text-lpBlue font-serif border-b pb-2",children:"1. Case Setup & Structure"}),e.odakanitNo&&n.jsx("div",{className:"bg-indigo-50 border-l-4 border-indigo-600 p-4 mb-6",children:n.jsx("div",{className:"flex justify-between items-center",children:n.jsxs("div",{children:[n.jsxs("h3",{className:"font-bold text-indigo-900 flex items-center",children:[n.jsx(lh,{className:"w-5 h-5 mr-2"})," Odakanit Case #",e.odakanitNo]}),n.jsx("p",{className:"text-sm text-indigo-700",children:"This report folder was initiated by Finance."})]})})}),n.jsxs("div",{className:"bg-panel p-6 rounded-lg shadow-sm border border-borderDark relative overflow-hidden",children:[n.jsx("div",{className:"absolute top-0 left-0 w-1 h-full bg-lpGold"}),n.jsxs("h3",{className:"font-bold text-lg mb-4 text-textLight flex items-center",children:[n.jsx(go,{className:"w-5 h-5 mr-2 text-lpGold"}),"Re: Case Details (Mandatory Fields - English)"]}),n.jsx("div",{className:"mb-6 bg-blue-50 border-2 border-dashed border-blue-200 rounded-lg p-4 text-center relative group",children:U?n.jsxs("div",{className:"flex flex-col items-center justify-center py-2",children:[n.jsx(Lt,{className:"w-8 h-8 text-lpBlue animate-spin mb-2"}),n.jsx("span",{className:"text-sm font-bold text-lpBlue",children:"Analyzing Policy Document..."})]}):n.jsx(n.Fragment,{children:e.policyFile?n.jsxs("div",{className:"flex flex-col items-center justify-center gap-3",children:[n.jsxs("div",{className:"flex items-center justify-center gap-3",children:[n.jsxs("div",{className:"flex flex-col items-center text-green-700 font-bold text-center",children:[n.jsxs("div",{className:"flex items-center",children:[n.jsx(oh,{className:"w-6 h-6 mr-2"}),"Policy Document Attached"]}),n.jsxs("span",{className:"text-xs font-normal text-green-800",children:["Original file: ",e.policyFile.name]})]}),n.jsx("button",{className:"text-xs text-red-500 hover:underline disabled:text-gray-400 disabled:cursor-not-allowed",onClick:i?void 0:()=>t({policyFile:void 0}),disabled:i,children:"Remove"})]}),n.jsxs("div",{className:"flex items-center justify-center gap-2 text-xs text-textLight bg-panel/70 px-3 py-1 rounded-full border border-borderDark",children:[n.jsx("input",{id:"attach-policy-appendix",type:"checkbox",className:"h-3 w-3 accent-lpBlue",checked:e.attachPolicyAsAppendix??!0,onChange:i?void 0:D=>t({attachPolicyAsAppendix:D.target.checked}),disabled:i}),n.jsx("label",{htmlFor:"attach-policy-appendix",className:"cursor-pointer",children:"Attach policy as Appendix A to final PDF"})]})]}):n.jsxs(n.Fragment,{children:[n.jsxs("div",{className:`flex flex-col items-center justify-center text-center px-4 ${i?"cursor-not-allowed opacity-60":"cursor-pointer"}`,children:[n.jsx(yo,{className:"w-8 h-8 text-lpBlue mb-2 group-hover:scale-110 transition-transform"}),n.jsx("span",{className:"text-sm font-bold text-textLight",children:"Upload Policy Document"}),n.jsx("span",{className:"text-xs text-textMuted mt-1",children:"Any file uploaded here (PDF/DOCX/scan) is treated as the official policy for this case."})]}),n.jsx("input",{type:"file",className:"absolute inset-0 opacity-0 cursor-pointer",accept:"application/pdf,application/vnd.openxmlformats-officedocument.wordprocessingml.document,text/plain,image/*",onChange:fe,disabled:i})]})})}),n.jsxs("div",{className:"mb-6 mt-4 bg-slate-50 border border-dashed border-borderDark rounded-lg p-4",children:[n.jsxs("h4",{className:"text-sm font-semibold text-textLight mb-2 flex items-center justify-between",children:[n.jsx("span",{children:"Additional Appendices (Lawyer)"}),n.jsxs("span",{className:"text-[11px] text-textMuted",children:[((st=e.lawyerAppendixFiles)==null?void 0:st.length)||0,"/",ve]})]}),n.jsx("div",{className:"flex flex-col md:flex-row gap-3 md:items-center",children:n.jsx("div",{className:"flex-1",children:n.jsxs("label",{htmlFor:"lawyer-appendix-input",className:`flex flex-col items-center justify-center px-3 py-3 border-2 border-dashed border-borderDark rounded-lg text-xs text-textMuted bg-panel transition-colors ${i?"cursor-not-allowed opacity-60":"cursor-pointer hover:border-lpBlue hover:text-lpBlue"}`,children:[n.jsx(yo,{className:"w-5 h-5 mb-1"}),n.jsx("span",{className:"font-semibold",children:"Upload / drag legal appendices"}),n.jsxs("span",{className:"mt-1 text-[11px] text-textMuted",children:["Supported: PDF, PNG, JPG, TIFF (up to ",_e,"MB per file)"]}),n.jsx("input",{id:"lawyer-appendix-input",type:"file",multiple:!0,className:"hidden",accept:"application/pdf,image/png,image/jpeg,image/jpg,image/tiff,image/x-tiff",onChange:ze,disabled:i})]})})}),(((Je=e.lawyerAppendixFiles)==null?void 0:Je.length)||0)>0&&n.jsx("div",{className:"mt-3 border-t border-borderDark pt-2 space-y-1 max-h-40 overflow-y-auto text-xs text-textLight text-left",children:(J=e.lawyerAppendixFiles)==null?void 0:J.map(D=>n.jsxs("div",{className:"flex items-center justify-between gap-2 rounded bg-panel px-2 py-1 border border-borderDark",children:[n.jsxs("div",{className:"flex-1 min-w-0",children:[n.jsx("div",{className:"truncate font-medium",children:D.name}),n.jsx("div",{className:"text-[11px] text-textMuted truncate",children:D.type||"Unknown type"})]}),n.jsx("button",{type:"button",onClick:i?void 0:()=>qe(D.id),className:"text-[11px] text-red-500 hover:text-red-700 disabled:text-gray-400 disabled:cursor-not-allowed",disabled:i,children:"Remove"})]},D.id))})]}),n.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-5",children:[n.jsxs("div",{className:"space-y-1",children:[n.jsxs("label",{className:"text-xs font-bold text-textMuted uppercase flex items-center",children:[n.jsx(A0,{className:"w-3 h-3 mr-1"})," Report Date"]}),n.jsx("input",{type:"date",className:"w-full border border-borderDark p-2 rounded disabled:bg-navySecondary disabled:text-textMuted",value:te(e.reportDate),onChange:i?void 0:D=>t({reportDate:new Date(D.target.value).toISOString()}),disabled:i})]}),n.jsxs("div",{className:"space-y-1",children:[n.jsx("label",{className:"text-xs font-bold text-textMuted uppercase",children:"RE (Subject)"}),n.jsx("input",{type:"text",className:"w-full border border-borderDark p-2 rounded text-sm disabled:bg-navySecondary disabled:text-textMuted",placeholder:"e.g. John Doe v. XYZ Medical Center  Claim Update",value:e.reportSubject||"",onChange:i?void 0:D=>t({reportSubject:D.target.value,isSubjectAuto:!1}),disabled:i})]}),n.jsxs("div",{className:"space-y-1",children:[n.jsx("label",{className:"text-xs font-bold text-textMuted uppercase",children:"Odakanit Case Number (Internal File)"}),$e(e.odakanitNo||"",D=>t({odakanitNo:D}),"e.g., 1/123")]}),n.jsxs("div",{className:"space-y-1",children:[n.jsx("label",{className:"text-xs font-bold text-textMuted uppercase",children:"Insurer Name"}),n.jsxs("select",{className:"w-full border border-borderDark p-2 rounded disabled:bg-navySecondary disabled:text-textMuted",value:L?"OTHER":e.insurerName,onChange:i?void 0:D=>j(D.target.value),disabled:i,children:[n.jsx("option",{value:"",disabled:!0,children:"-- Select Insurer --"}),cp.map(D=>n.jsx("option",{value:D,children:D},D)),n.jsx("option",{value:"OTHER",children:"Other (Enter Manually)"})]}),L&&n.jsx("div",{className:"mt-2 animate-fade-in",children:$e(e.insurerName,D=>t({insurerName:D}),"Type custom insurer name...")})]}),n.jsxs("div",{className:"space-y-1",children:[n.jsx("label",{className:"text-xs font-bold text-textMuted uppercase",children:Bp.lineSlip}),$e(e.lineSlipNo,D=>t({lineSlipNo:D,marketRef:D}),"e.g., B0180PD2391439")]}),n.jsxs("div",{className:"space-y-1",children:[n.jsx("label",{className:"text-xs font-bold text-textMuted uppercase",children:Bp.certificate}),$e(e.certificateRef||"",D=>t({certificateRef:D}),"e.g., 516902624")]}),n.jsxs("div",{className:"space-y-1",children:[n.jsx("label",{className:"text-xs font-bold text-textMuted uppercase",children:"Insured Name"}),$e(e.insuredName,D=>t(le({insuredName:D})),"e.g., Dr. Cohen",D=>{const ae=(D||"").trim();!ae||!zp(ae)||Rd(ae).then(ee=>{!ee||ee.trim()===""||ee==="Error translation."||F.current===ae&&t(le({insuredName:ee.trim()}))}).catch(()=>{})})]}),n.jsxs("div",{className:"space-y-1 md:col-span-2",children:[n.jsxs("div",{className:"flex justify-between items-end mb-1",children:[n.jsx("label",{className:"text-xs font-bold text-textMuted uppercase",children:"Party Name"}),n.jsxs("div",{className:"flex bg-navySecondary rounded p-0.5 text-xs",children:[n.jsx("button",{className:`px-3 py-1 rounded-sm transition-all ${e.plaintiffTitle==="Plaintiff"?"bg-panel shadow text-lpBlue font-bold":"text-textMuted"}`,onClick:()=>t({plaintiffTitle:"Plaintiff"}),children:"Plaintiff"}),n.jsx("button",{className:`px-3 py-1 rounded-sm transition-all ${e.plaintiffTitle==="Claimant"?"bg-panel shadow text-lpBlue font-bold":"text-textMuted"}`,onClick:()=>t({plaintiffTitle:"Claimant"}),children:"Claimant"})]})]}),$e(e.plaintiffName,D=>t(le({plaintiffName:D})),"e.g., Mr. Levi",D=>{const ae=(D||"").trim();!ae||!zp(ae)||Rd(ae).then(ee=>{!ee||ee.trim()===""||ee==="Error translation."||H.current===ae&&t(le({plaintiffName:ee.trim()}))}).catch(()=>{})})]})]})]}),n.jsxs("div",{className:"bg-panel p-6 rounded-lg shadow-sm border border-borderDark",children:[n.jsx("div",{className:"flex justify-between items-center mb-4",children:n.jsxs("div",{children:[n.jsxs("h3",{className:"font-bold text-lg text-textLight flex items-center",children:[n.jsx(ih,{className:"w-5 h-5 mr-2 text-lpBlue"}),"Procedural Timeline"]}),n.jsx("p",{className:"text-sm text-textMuted",children:'   ,    Month/Year    ".'})]})}),n.jsxs("div",{className:"mb-4",children:[n.jsx("label",{className:"block text-xs font-semibold text-textMuted mb-1",children:"Procedure Type"}),n.jsx("select",{className:"border border-borderDark rounded px-3 py-1 text-sm",value:((re=e.proceduralTimeline)==null?void 0:re.procedureType)||"FIRST_INSTANCE",onChange:D=>X(D.target.value),children:bv.map(D=>n.jsx("option",{value:D.value,children:D.label},D.value))})]}),!e.proceduralTimeline&&P&&n.jsxs("div",{className:"border border-dashed border-borderDark rounded-md p-3 bg-navySecondary text-xs text-textLight",children:[n.jsx("p",{className:"mb-2",children:"This report uses the legacy timeline. You can enable the new Procedural Timeline (recommended for new reports)."}),n.jsx("button",{type:"button",className:"inline-flex items-center px-3 py-1 rounded-full bg-navy text-gold text-[11px] font-semibold hover:bg-navySecondary",onClick:()=>t({proceduralTimeline:O()}),children:"Enable Procedural Timeline"})]}),e.proceduralTimeline&&n.jsx("div",{className:"space-y-3",children:Oa[e.proceduralTimeline.procedureType].map(D=>{var Pe,Q,ye;const ae=((Q=(Pe=e.proceduralTimeline)==null?void 0:Pe.stages)==null?void 0:Q.find(_=>_.id===D.id))||void 0,ee=V[D.id],be=!!D.isDynamic,Oe=be?!!(ae!=null&&ae.include):!0,Ae=(ae==null?void 0:ae.monthYear)||"";let Re="",Ge="";if(ee)Re=ee.month||"",Ge=ee.year||"";else if(typeof Ae=="string"&&Ae.includes("-")){const[_,W]=Ae.split("-");_&&W&&(Ge=_,Re=W)}const He=((ye=e.proceduralTimeline)==null?void 0:ye.currentStageId)===D.id;return n.jsxs("div",{className:"flex items-start justify-between border border-borderDark rounded-lg px-3 py-2 bg-panel",children:[n.jsxs("div",{className:"flex items-start gap-3",children:[n.jsx("input",{type:"radio",name:"currentStage",className:"mt-1",checked:He,disabled:!Oe,onChange:()=>Oe&&ue(D.id)}),n.jsxs("div",{children:[n.jsxs("div",{className:"font-semibold text-sm text-textLight flex items-center gap-2",children:[n.jsx("span",{children:D.label}),be&&n.jsx("span",{className:"text-[10px] px-2 py-0.5 rounded-full bg-navySecondary text-textMuted",children:"Dynamic"})]}),n.jsxs("div",{className:"mt-1 flex items-center gap-2 text-xs text-textMuted flex-wrap",children:[n.jsx("span",{children:"Month / Year:"}),n.jsxs("select",{className:"border border-borderDark rounded px-2 py-0.5 text-xs",value:Re,disabled:!Oe,onChange:_=>oe(D.id,_.target.value,Ge),children:[n.jsx("option",{value:"",children:""}),n.jsx("option",{value:"01",children:"January"}),n.jsx("option",{value:"02",children:"February"}),n.jsx("option",{value:"03",children:"March"}),n.jsx("option",{value:"04",children:"April"}),n.jsx("option",{value:"05",children:"May"}),n.jsx("option",{value:"06",children:"June"}),n.jsx("option",{value:"07",children:"July"}),n.jsx("option",{value:"08",children:"August"}),n.jsx("option",{value:"09",children:"September"}),n.jsx("option",{value:"10",children:"October"}),n.jsx("option",{value:"11",children:"November"}),n.jsx("option",{value:"12",children:"December"})]}),n.jsx("input",{type:"number",className:"w-20 border border-borderDark rounded px-2 py-0.5 text-xs",placeholder:"Year",value:Ge,disabled:!Oe,onChange:_=>oe(D.id,Re,_.target.value),min:1900,max:2100})]})]})]}),be&&n.jsxs("div",{className:"flex items-center gap-1 text-xs text-textMuted",children:[n.jsx("span",{children:"Include"}),n.jsx("input",{type:"checkbox",checked:Oe,onChange:_=>xe(D.id,_.target.checked)})]})]},D.id)})})]}),n.jsxs("div",{className:"bg-panel p-6 rounded-lg shadow-sm border border-borderDark",children:[n.jsxs("h3",{className:"font-bold text-lg mb-4 text-textLight flex items-center",children:[n.jsx(O0,{className:"w-5 h-5 mr-2 text-green-600"}),"Current Report Sections"]}),n.jsx("div",{className:"space-y-2 mb-6",children:e.selectedSections.map((D,ae)=>{const ee=ae>0,be=ae<e.selectedSections.length-1,Ae=!!(e.expensesSheetId||e.expensesHtml)&&Jr(D),Re=D==="Update"||Ae;return n.jsxs("div",{className:"flex items-center justify-between p-3 bg-panel border border-borderDark rounded shadow-sm",children:[n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsx("span",{className:"w-6 h-6 rounded-full bg-navySecondary text-textMuted flex items-center justify-center text-xs font-bold",children:ae+1}),n.jsx("span",{className:"font-medium text-textLight",children:D}),D==="Update"&&n.jsx("span",{className:"text-xs bg-blue-100 text-blue-800 px-2 py-0.5 rounded",children:"Fixed"}),Ae&&n.jsx("span",{className:"text-xs bg-amber-100 text-amber-800 px-2 py-0.5 rounded",children:"   "})]}),n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsxs("div",{className:"flex flex-col gap-1",children:[n.jsx("button",{onClick:()=>Y(ae,"UP"),disabled:!ee,className:`p-1 rounded border ${ee?"text-textMuted hover:bg-navySecondary":"text-gray-300 cursor-not-allowed"}`,title:" ",children:n.jsx(T0,{className:"w-4 h-4"})}),n.jsx("button",{onClick:()=>Y(ae,"DOWN"),disabled:!be,className:`p-1 rounded border ${be?"text-textMuted hover:bg-navySecondary":"text-gray-300 cursor-not-allowed"}`,title:" ",children:n.jsx(I0,{className:"w-4 h-4"})})]}),!Re&&n.jsx("button",{onClick:()=>C(D),className:"p-2 rounded-md text-textMuted hover:text-red-400 hover:bg-red-500/10 border border-transparent hover:border-red-400/40 transition",title:" ",children:n.jsx(Ot,{className:"w-4 h-4"})})]})]},`${D}-${ae}`)})}),y?n.jsxs("div",{className:"bg-navySecondary p-4 rounded border animate-fade-in",children:[n.jsxs("div",{className:"flex gap-2",children:[n.jsxs("select",{className:"flex-1 border p-2 rounded",onChange:D=>E(D.target.value),defaultValue:"",children:[n.jsx("option",{value:"",disabled:!0,children:"-- Select a Header --"}),Dr.filter(D=>!e.selectedSections.includes(D)).map(D=>n.jsx("option",{value:D,children:D},D))]}),n.jsx("button",{onClick:()=>S(!1),className:"px-4 py-2 bg-borderDark text-textMuted rounded hover:bg-borderDark",children:"Cancel"})]}),n.jsx("div",{className:"mt-4 pt-4 border-t border-borderDark",children:n.jsxs("div",{className:"flex gap-2",children:[n.jsx("input",{className:"flex-1 border p-2 rounded",placeholder:"Type custom header name...",value:u,onChange:D=>p(D.target.value)}),n.jsx("button",{onClick:()=>{se(),S(!1)},className:"px-4 py-2 bg-purple-600 text-white rounded hover:bg-purple-700",children:"Add Custom"})]})})]}):n.jsxs("button",{onClick:()=>S(!0),className:"w-full py-2 border-2 border-dashed border-borderDark text-textMuted rounded hover:border-green-500 hover:text-green-600 transition flex items-center justify-center font-medium",children:[n.jsx(_u,{className:"w-4 h-4 mr-2"})," Add Report Section"]})]}),n.jsxs("div",{className:"flex flex-wrap justify-between gap-2",children:[n.jsxs("button",{onClick:c,className:"flex items-center text-textMuted px-4 py-2 border rounded hover:bg-navySecondary transition",children:[n.jsx(Ql,{className:"mr-2 w-4 h-4"})," Back to Dashboard"]}),n.jsxs("button",{onClick:T,className:"flex items-center bg-navy text-gold px-6 py-2 rounded hover:bg-navySecondary transition shadow-md",children:["Next Step ",n.jsx(ts,{className:"ml-2 w-4 h-4"})]})]})]})},Vp=e=>{if(!e)return null;try{const t=JSON.stringify(e);let s=0;for(let r=0;r<t.length;r+=1){const a=t.charCodeAt(r);s=(s<<5)-s+a,s|=0}return String(s)}catch{return null}},_v=({data:e,updateData:t,onBack:s,onNext:r,currentUser:a,onSaveAndExit:o,onSaveDraft:l,onTranslate:c,onImproveEnglish:i,onFormatContent:u,onSubmitHebrewForReview:p,onApproveHebrewForTranslation:y,onAddReviewIssues:S,onMarkReviewIssueDone:w,onAddExternalFeedbackIssues:L,onReopenHebrewDueToExternalFeedback:k,step1Focus:U,onStep1FocusConsumed:N,isTranslating:x,isImprovingEnglish:b,onOpenAssistant:F,onActiveSectionChange:H,readOnly:V})=>{var $o;const q=Ws,te=Ro,[G,le]=g.useState(null),[j,T]=g.useState(!1),[E,C]=g.useState(null),[se,Y]=g.useState([]),[O,P]=g.useState(""),[X,ue]=g.useState(!1),[xe,oe]=g.useState(()=>Dr[0]||"Update"),[fe,ve]=g.useState([]),[_e,ze]=g.useState(!1),[qe,$e]=g.useState(null),[st,Je]=g.useState(null),[J,re]=g.useState(null),[D,ae]=g.useState([]),[ee,be]=g.useState(!1),[Oe,Ae]=g.useState(null),[Re,Ge]=g.useState("SAFE_POLISH"),[He,Pe]=g.useState(null),[Q,ye]=g.useState([]),[_,W]=g.useState("TEMPLATES"),[de,ce]=g.useState(""),[ne,ge]=g.useState(!1),[Se,Ee]=g.useState(()=>Dr[0]||"Update"),[Me,Qe]=g.useState(null),[Nt,rt]=g.useState(()=>jo(a.id)),[Yt,Ht]=g.useState(""),[ls,is]=g.useState(!1),[he,lt]=g.useState(null),[cs,Rs]=g.useState("DUAL"),[ut,Kn]=g.useState(null),[ds,wn]=g.useState(null),[sr,Yn]=g.useState(null),[Cs,us]=g.useState(null),[Mn,ms]=g.useState(null),Ds=g.useRef(null),I=g.useRef(null),we=g.useRef({}),[De,Le]=g.useState({date:new Date().toISOString().split("T")[0],description:"",amount:0,currency:"NIS"}),Fe=a.role==="FINANCE"||a.role==="SUB_ADMIN"&&!0,et=e.selectedSections.some(f=>f.toLowerCase().includes("expenses")),jn=a.role==="LAWYER"&&e.requiresExpenses===!0&&et,En=a.role==="ADMIN"&&e.isTranslated,fa=a.role==="LAWYER"||a.role==="ADMIN",on=a.role==="FINANCE"||a.role==="SUB_ADMIN"||a.role==="ADMIN",At=(($o=e.reportReview)==null?void 0:$o.status)==="APPROVED"||e.hebrewWorkflowStatus==="HEBREW_APPROVED",Co=e.translatedContent||{},xa=Object.keys(Co).some(f=>{if(f.toLowerCase().includes("expenses"))return!1;const R=Co[f];return typeof R=="string"&&R.trim().length>0});g.useEffect(()=>{rt(jo(a.id))},[a.id]);const wr=async f=>{var z,Z;if(V||!En||!e.isTranslated||f.toLowerCase().includes("expenses"))return;const R=((z=e.translatedContent)==null?void 0:z[f])||"";if(R.trim()){ms(f);try{const{protectedText:me,map:d}=Uh(R),m=await xh(me),h=Wh(m||me,d),A=Hh(h),v={...e.translatedContent||{},[f]:li(A)};t({translatedContent:v}),typeof l=="function"&&l()}catch(me){console.error("Improve English (single section) failed",me);const d=Cd(f,(Z=e.expertSummaryMode)==null?void 0:Z[f]);window.alert(`   "${d}" .      .`)}finally{ms(me=>me===f?null:me)}}},Ei=f=>typeof f.reportNumber=="number"&&f.reportNumber===1,ki=f=>xp(f)?"EXPERT":f===te?"DEMAND":"CLAIM";g.useEffect(()=>{if(!U)return;const f=()=>{let R=null;U==="EXTERNAL_FEEDBACK"?R=Dd:U==="REVIEW"&&(R=kl);let z=null;if(R&&(z=document.getElementById(R)),z||(z=document.getElementById(kl)),z)try{z.scrollIntoView({behavior:"smooth",block:"start"})}catch{}N&&N()};typeof window<"u"?window.requestAnimationFrame(()=>{const R=U==="EXTERNAL_FEEDBACK"&&document.getElementById(Dd)||document.getElementById(kl);if(R){try{R.scrollIntoView({behavior:"smooth",block:"start"})}catch{}N&&N()}else setTimeout(f,0)}):f()},[U,N]);const Ai=()=>{if(V||!on||!De.description||!De.amount)return;const f={id:Date.now().toString(),date:De.date||"",description:De.description,amount:Number(De.amount),currency:De.currency||"NIS"},R=[...e.expensesItems,f],z=R.reduce((Z,me)=>Z+me.amount,0);t({expensesItems:R,expensesSum:z.toLocaleString()}),Le({date:new Date().toISOString().split("T")[0],description:"",amount:0,currency:"NIS"})},Ii=f=>{if(V)return;const R=e.expensesItems.filter(Z=>Z.id!==f),z=R.reduce((Z,me)=>Z+me.amount,0);t({expensesItems:R,expensesSum:z.toLocaleString()})},Ut=async f=>{if(V)return;const R=f.target.files;if(!R)return;const z=e.invoiceFiles.length;if(z>=4){C({msg:"   4   (PDF  Word).",type:"info"}),f.target.value="";return}const Z=Array.from(R).slice(0,4-z),me=[];for(let v=0;v<Z.length;v++){const M=Z[v],$=new FileReader;await new Promise(B=>{$.onload=K=>{var ie;me.push({id:`inv-${Date.now()}-${v}`,name:M.name,data:((ie=K.target)==null?void 0:ie.result).split(",")[1],type:M.type}),B()},$.readAsDataURL(M)})}const d=[...e.invoiceFiles,...me],m=d.length>0,A=on&&e.status==="WAITING_FOR_INVOICES"&&m?"TASK_ASSIGNED":e.status;t({invoiceFiles:d,isWaitingForInvoices:!m,status:A}),C({msg:"   ( 4 ).",type:"success"})},tn=f=>{const R=e.invoiceFiles.filter(d=>d.id!==f),z=R.length>0,me=on&&!z&&e.status==="TASK_ASSIGNED"?"WAITING_FOR_INVOICES":e.status;t({invoiceFiles:R,isWaitingForInvoices:!z,status:me})},Gt=(f,R)=>{Fe||t({content:{...e.content,[f]:R}})},Ti=f=>f.replace(/{plaintiff}/g,e.plaintiffName||"").replace(/{insured}/g,e.insuredName||"").replace(/\[DATE\]/g,new Date().toLocaleDateString("he-IL"));g.useEffect(()=>{let f=!1;return(async()=>{try{const z=await dp();f||Y(z)}catch(z){console.error("Failed to load templates",z)}try{const z=await nN();f||ye(z)}catch(z){console.error("Failed to load best practices",z)}})(),()=>{f=!0}},[]);const Ri=(f,R)=>{En&&t({translatedContent:{...e.translatedContent,[f]:R}})},jr=f=>se.filter(R=>R.sectionKey===f&&R.isEnabled!==!1).sort((R,z)=>(R.orderIndex||0)-(z.orderIndex||0)||R.createdAt.localeCompare(z.createdAt)),ps=(f,R)=>{if(Fe)return;let z=R.body.replace(/{plaintiff}/g,e.plaintiffName||"the claimant").replace(/{insured}/g,e.insuredName||"the insured").replace(/\[DATE\]/g,new Date().toLocaleDateString("he-IL"));const Z=e.content[f]||"";Gt(f,Z?`${Z}

${z}`:z),le(null)},Ci=async f=>{try{const R=await dp();Y(R)}catch(R){console.error("Failed to refresh templates",R)}P(""),ce(""),le(R=>R===f?null:f)},Di=async f=>{if(a.role!=="ADMIN")return;const R=we.current[f],z=R==null?void 0:R.current;if(!z){C({msg:"     .",type:"error"});return}const Z=z.selectionStart??0,me=z.selectionEnd??0;if(Z===me){C({msg:"     .",type:"info"});return}let m=(e.content[f]||"").slice(Z,me).trim();if(!m){C({msg:"    .",type:"info"});return}if(m.length<15&&!window.confirm("   .    ?"))return;const h=m.split(/\s+/).slice(0,6).join(" "),v=(window.prompt(" :",h)||"").trim();if(!v){C({msg:"   ( ).",type:"info"});return}const M=new Date().toISOString(),$={id:"",sectionKey:f,title:v,body:m,createdByUserId:a.id,createdAt:M,updatedAt:M,isEnabled:!0};try{const B=await up($,a.role);Y(B),C({msg:"  .",type:"success"})}catch(B){console.error("Failed to save template",B),C({msg:"  .",type:"error"})}},Er=async(f,R)=>{if(a.role!=="ADMIN")return;const z=se.find(me=>me.id===f);if(!z)return;const Z={...z,...R,updatedAt:new Date().toISOString()};try{const me=await up(Z,a.role);Y(me)}catch(me){console.error("Failed to update template",me),C({msg:"  .",type:"error"})}},ha=async f=>{if(a.role==="ADMIN")try{const R=await z0(f,a.role);Y(R)}catch(R){console.error("Failed to delete template",R),C({msg:"  .",type:"error"})}},ga=async(f,R)=>{if(a.role==="ADMIN")try{const z=await V0(f,R,a.role);Y(z)}catch(z){console.error("Failed to reorder template",z),C({msg:"   .",type:"error"})}},Do=(f,R)=>{if(!f||!R||f===R)return"  ";const z=f.split(/\s+/).filter(Boolean),Z=R.split(/\s+/).filter(Boolean);if(!z.length||!Z.length)return"  ";const me=Math.max(z.length,Z.length)||1;let d=0;const m=Math.min(z.length,Z.length);for(let A=0;A<m;A+=1)z[A]!==Z[A]&&(d+=1);d+=Math.abs(z.length-Z.length);const h=d/me;return h<.05?"  ":h<.15?" ":h<.35?" ":" "},Li=async f=>{if(Fe)return;const R=e.content[f];if(R){Yn(f),T(!0);try{const z=await Y0(R,Re);if(z.factProtectionBlocked){C({msg:"    ( ).    .",type:"info"});return}const Z=z.text,me=Do(R,Z),d=nv(R,Z),m=d.filter(h=>h.type==="add"||h.type==="remove").length;if(m>0){const h=Date.now()+2e4;Pe({sectionKey:f,tokens:d,changedWords:m,expiresAt:h,open:!1}),setTimeout(()=>{Pe(A=>A&&A.sectionKey===f&&A.expiresAt===h?null:A)},2e4)}else Pe(null);C({msg:`  (${Re==="SAFE_POLISH"?"SAFE_POLISH":"REWRITE"}): ${me}`,type:"success"}),Gt(f,Z)}catch(z){console.error("Refine text failed",z),C({msg:"  .   .",type:"error"})}finally{T(!1),Yn(null)}}},_i=async(f,R,z)=>{var Z;T(!0);try{const me=await J0(R,z);if((Z=me.items)!=null&&Z.length){const d=[...e.expensesItems,...me.items],m=d.reduce((h,A)=>h+(A.amount||0),0);t({expensesItems:d,expensesSum:m.toLocaleString()}),C({msg:`  "${f}"  .`,type:"success"})}else C({msg:"    .",type:"info"})}catch(me){console.error("Expenses extraction failed",me),C({msg:" .   PDF/Word .",type:"error"})}finally{T(!1)}},Oi=f=>new Promise((R,z)=>{const Z=new FileReader;Z.onload=()=>R(Z.result.split(",")[1]),Z.onerror=()=>z(new Error("Failed to read file")),Z.readAsDataURL(f)}),Lo=f=>{var A,v,M,$,B,K,ie,je;if(!f)return;const R=[...e.selectedSections],z=Ne=>{R.includes(Ne)||R.push(Ne)},Z=Ne=>Ne&&Ne.length?Ne.map(Ue=>` ${Ue}`).join(`
`):"",me=(A=f.timeline)!=null&&A.length?f.timeline.map(Ne=>` ${(Ne==null?void 0:Ne.date)||"  "}  ${(Ne==null?void 0:Ne.event)||""}`).join(`
`):"",d={...e.content};if(f.briefSummary||me||(v=f.injuries)!=null&&v.length){z("Update");const Ne=Z(f.injuries),Ue=Z(f.requestedRelief),We=[f.briefSummary||"",Ne?`
 :
${Ne}`:"",Ue?`
 :
${Ue}`:"",me?`
 :
${me}`:""].filter(Boolean);d.Update=We.join(`
`).trim()}if((M=f.facts)!=null&&M.length){const Ne=Ws;z(Ne),d[Ne]=Z(f.facts)}const m=[];if(($=f.allegations)!=null&&$.length&&m.push(` :
${Z(f.allegations)}`),(B=f.negligenceTheory)!=null&&B.length&&m.push(` :
${Z(f.negligenceTheory)}`),(K=f.medicalFindings)!=null&&K.length&&m.push(` :
${Z(f.medicalFindings)}`),m.length){const Ne=e.selectedSections.includes("Strategy & Recommendations")?"Strategy & Recommendations":"Strategy";z(Ne),d[Ne]=m.join(`

`)}f.riskAssessment&&(z("Risk Assessment"),d["Risk Assessment"]=f.riskAssessment);const h=[];(ie=f.recommendedActions)!=null&&ie.length&&h.push(Z(f.recommendedActions)),(je=f.requestedRelief)!=null&&je.length&&h.push(` :
${Z(f.requestedRelief)}`),h.length&&(z("Recommendations"),d.Recommendations=h.join(`

`)),t({content:d,selectedSections:R,complaintAnalysis:f}),C({msg:"     .",type:"success"})},Mi=(f,R)=>{var Pt,Dt,Tt;if(!f)return"";const z=(R==null?void 0:R.analysisType)==="DEMAND"||(R==null?void 0:R.section)===te?"DEMAND":"CLAIM",Z=z==="DEMAND"?"":"",me=z==="DEMAND"?"   ":"  ",d=(Dt=(Pt=f.entities)==null?void 0:Pt.plaintiff)==null?void 0:Dt.trim(),m=(f.defendants||[]).filter(Boolean).join(", "),h=[];h.push(d?`${Z}, ${d}`:Z),m&&h.push(`${me} ${m}`);const A=`${h.join(" ")}.`.replace(/\s+/g," ").trim(),v=(Be,Pn,ln,Gn=!1)=>{const nt=Pn.map(it=>(it||"").trim()).filter(Boolean);if(!nt.length&&Gn)return"";const Et=nt.length?nt:ln?[ln]:[];if(!Et.length)return"";const qt=Et.map((it,qn)=>`${qn+1}. ${it}`.trim()).join(`
`);return`${Be}
${qt}`.trim()},M=(f.timeline||[]).map(Be=>{var qn,Sa,rr,wa,Ho,Uo;if(!(Be!=null&&Be.event)&&!(Be!=null&&Be.date))return"";const Pn=((Be==null?void 0:Be.date)||"").toString().trim(),ln=Pn||" ",Gn=((Be==null?void 0:Be.actor)||"").toString().trim()||(((qn=f.entities)==null?void 0:qn.plaintiff)||"").toString().trim()||Z,nt=((Be==null?void 0:Be.location)||"").toString().trim()||((Uo=(wa=(rr=(Sa=f.entities)==null?void 0:Sa.institution)==null?void 0:rr.toString)==null?void 0:(Ho=wa.call(rr)).trim)==null?void 0:Uo.call(Ho))||"",Et=((Be==null?void 0:Be.event)||"").toString().trim(),qt=((Be==null?void 0:Be.result)||"").toString().trim(),it=[];return it.push(ln),it.push(` ${Gn}`),Et&&it.push(` ${Et}`),nt&&it.push(` ${nt}`),qt&&it.push(` ${qt}`),it.join(" ").replace(/\s+/g," ").trim()}).filter(Boolean)||[],$=(f.facts||[]).filter(Boolean),B=M.length?M:$,ie=v(z==="DEMAND"?"  ,  :":"  ,  :",B,"    ."),je=[];(Tt=f.entities)!=null&&Tt.plaintiff&&je.push(String(f.entities.plaintiff).trim()),Array.isArray(f.defendants)&&je.push(...f.defendants.map(String).map(Be=>Be.trim())),Array.isArray(f.providers)&&je.push(...f.providers.map(String).map(Be=>Be.trim()));const Ne=Array.from(new Set(je.filter(Boolean))),Ue=Ne.length?`      : ${Ne.join(", ")}.`:"",Ve=(Array.isArray(f.gaps)&&f.gaps||Array.isArray(f.missingDetails)&&f.missingDetails||[]).filter(Boolean).map(Be=>String(Be).trim()).filter(Boolean),at=Ve.length?Ve:["   ,        ."],Ze=v("  :",at),bt=(()=>{const Be=(f.injuries||[]).find(ln=>ln&&String(ln).trim())||(f.medicalFindings||[]).find(ln=>ln&&String(ln).trim());return Be?` ${z==="DEMAND"?"":""},         : ${String(Be).trim()}.`:""})();return[A,ie,Ue,Ze,bt].filter(Be=>Be&&String(Be).trim()).join(`

`).trim()},_o=()=>{Gt("Strategy",Rv),C({msg:' " "  .',type:"success"})},Pi=(f,R)=>{var me;const z=(me=f.target.files)==null?void 0:me[0];if(!z)return;if(!R.includes("Expenses")){f.target.value="";return}const Z=new FileReader;Z.onload=async d=>{var h;const m=((h=d.target)==null?void 0:h.result).split(",")[1];await _i(z.name,m,z.type)},Z.readAsDataURL(z),f.target.value=""},kr=f=>{us(null),Kn(f),setTimeout(()=>{var R;(R=Ds.current)==null||R.click()},0)},Oo=async f=>{var Z,me,d;const R=(Z=f.target.files)==null?void 0:Z[0];if(!R||!ut){Kn(null),f.target.value="";return}T(!0);const z=ut.section||ut.mode;wn(z);try{const m=await Oi(R),h=ut.mode==="SECTION"&&ut.section||Ws;if(ut.domain==="dental"&&ut.mode==="SECTION"){try{const ie=await X0(m,R.type||"application/octet-stream"),je=((me=ie.text)==null?void 0:me.trim())??"";if(!ie.success||!je){const Ne=ie.reason==="INVALID_DOCUMENT"?Mp:Rr;C({msg:Ne,type:"info"})}else{const Ne=je,Ue=ut.section||q,We=e.content[Ue]||"",Ve=We?`${We}

${Ne}`:Ne,at={content:{...e.content,[Ue]:Ve},selectedSections:e.selectedSections.includes(Ue)?e.selectedSections:[...e.selectedSections,Ue]};if(ut.analysisType==="EXPERT"&&ut.section){const bt=!!We.trim()?"MULTIPLE":"SINGLE";at.expertSummaryMode={...e.expertSummaryMode||{},[Ue]:bt}}t(at),C({msg:"  ()    .",type:"success"})}}catch(ie){console.error("Dental opinion analysis failed",ie),C({msg:Rr,type:"info"})}finally{T(!1),wn(null),Kn(null),f.target.value=""}return}const v=h===q||h===te,M=xp(h),$={expertCountMode:ut.analysisType==="EXPERT"?((d=e.expertSummaryMode)==null?void 0:d[h])||"SINGLE":void 0,partyRole:aN(h)||void 0};(v||M)&&($.sectionKey=h,$.plaintiffName=e.plaintiffName||"",$.insuredName=e.insuredName||"",$.insurerName=e.insurerName||"",$.reportSubject=e.reportSubject||"");const B=await q0(m,R.type||"application/octet-stream",ut.analysisType||"CLAIM",$);if(B.success===!1){const ie=B.reason==="INVALID_DOCUMENT"?Mp:Rr;C({msg:ie,type:"info"});return}const K=(B==null?void 0:B.analysis)||null;if(ut.mode==="SECTION"){const ie=((B==null?void 0:B.claimSummary)||"").trim()||Mi(K,{analysisType:ut.analysisType,section:ut.section});if(!ie)C({msg:Rr,type:"info"});else{const je=ut.section||q,Ne=e.content[je]||"",Ue=Ne?`${Ne}

${ie}`:ie,We={content:{...e.content,[je]:Ue},selectedSections:e.selectedSections.includes(je)?e.selectedSections:[...e.selectedSections,je]};if(ut.analysisType==="EXPERT"&&ut.section){const at=!!Ne.trim()?"MULTIPLE":"SINGLE";We.expertSummaryMode={...e.expertSummaryMode||{},[je]:at}}K&&(We.complaintAnalysis=K),t(We),C({msg:"     .",type:"success"})}}else K?(Lo(K),ut.mode==="POLICY"&&t({policyFile:{id:`policy-${Date.now()}`,name:R.name,data:m,type:R.type}})):C({msg:Rr,type:"info"})}catch(m){console.error(m),C({msg:Rr,type:"info"})}finally{T(!1),wn(null),Kn(null),f.target.value=""}},Fi=()=>{const{policyPeriodStart:f,policyPeriodEnd:R,retroStart:z,retroEnd:Z}=e;if(!f&&!R&&!z&&!Z){C({msg:"    .  POLCY .",type:"info"});return}const me=zh(e.content["Insurance Coverage"],f,R,z,Z);Gt("Insurance Coverage",me),C({msg:"   .",type:"success"})},Bi=!!(e.policyPeriodStart||e.policyPeriodEnd||e.retroStart||e.retroEnd),$i=async f=>{if(e.odakanitNo)try{const Z=await Ye.getLatestSheetForCase(e.odakanitNo);if(Z&&Z.lineItems&&Z.lineItems.length>0){const me=Ye.buildCumulativeExpensesSnapshot(Z.sheet.id,new Date().toISOString());if(!me)return;const{effectiveSheet:d,allLines:m,opts:h}=me,{text:A}=Lh(d,m,h),{html:v}=ri(d,m,h);if(Gt(f,A),Z.attachments&&Z.attachments.length){const $=e.invoiceFiles||[],B=Math.max(0,4-$.length);if(B>0){const K=Z.attachments.slice(0,B).map((ie,je)=>{const[Ne,Ue]=ie.fileKey.split(",");let We=ie.mimeType||"application/octet-stream";if(Ne&&Ne.startsWith("data:")){const at=Ne.match(/^data:(.*?);base64$/);at&&at[1]&&(We=at[1])}const Ve=Ue||ie.fileKey;return{id:`fes-inv-${ie.id}-${je}`,name:ie.originalFileName,data:Ve,type:We}});if(K.length){const ie=[...$,...K],je=ie.length>0,Ue=on&&e.status==="WAITING_FOR_INVOICES"&&je?"TASK_ASSIGNED":e.status;t({invoiceFiles:ie,isWaitingForInvoices:!je,status:Ue,expensesSheetId:Z.sheet.id,expensesSnapshotAt:Z.sheet.updatedAt||new Date().toISOString(),expensesHtml:v||e.expensesHtml})}}}C({msg:"Expenses Table was inserted into the EXPENSES section.",type:"success"});return}}catch(Z){Ku("Failed to load Expenses Table for report",Z)}const R=e.expenseWorksheet;if(!R||!R.rows||R.rows.length===0){C({msg:"    .",type:"info"});return}if(R.status!=="LOCKED"){C({msg:'       ".',type:"info"});return}const z=Xi(R);Gt(f,z),C({msg:'   ".',type:"success"})},Hi=()=>{u&&(u(),C({msg:"    .",type:"success"}))},Ui=async()=>{if(!Fe){ze(!0);try{const f=await eN(e.content||{},a.role),R=f.issues||[];ve(R);const z=f.runAt||new Date().toISOString();$e(z),t({toneRiskLastRunAt:z}),Je(f.meta||null),R.length?C({msg:"     .",type:"info"}):C({msg:"   Tone & Risk .",type:"success"})}catch(f){console.error("Tone & Risk check failed",f),C({msg:" Tone & Risk        .",type:"error"})}finally{ze(!1)}}},Wi=()=>{ve([]),$e(null),Je(null),re(null)},zi=(f,R)=>{if(!f||!R)return!1;const z=/(\d{1,2}\/\d{1,2}\/\d{2,4}|\d+(?:\.\d+)?%?)/g,Z=[];let me;for(;(me=z.exec(f))!==null;)me[0]&&Z.push(me[0]);return Z.length?Z.some(d=>!R.includes(d)):!1},Vi=f=>{var me,d;if(!f.suggestion)return;const R=f.sectionKey,z=e.content[R]||"";if(!z||!f.excerpt||!z.includes(f.excerpt)){(me=navigator.clipboard)==null||me.writeText(f.suggestion).catch(()=>{}),C({msg:"    .   .",type:"info"});return}if(zi(f.excerpt,f.suggestion)){(d=navigator.clipboard)==null||d.writeText(f.suggestion).catch(()=>{}),C({msg:"    /      .",type:"info"});return}re({sectionKey:R,prevText:z});const Z=z.replace(f.excerpt,f.suggestion);Gt(R,Z)},Ki=()=>{if(!J)return;const{sectionKey:f,prevText:R}=J;Gt(f,R),re(null),C({msg:"  .",type:"info"})},Yi=async()=>{if(!Fe){be(!0);try{const f=await tN(e.content||{},a.role),R=f.issues||[];if(ae(R),Ae(f.runAt||new Date().toISOString()),f.success===!1){C({msg:"    .    .",type:"info"});return}R.length?C({msg:"       .",type:"info"}):C({msg:"     .",type:"success"})}catch(f){console.error("Hebrew style review failed",f),C({msg:"    .    .",type:"info"})}finally{be(!1)}}},Gi=(f,R)=>{if(Fe||V)return;const z=Ti(R.body),Z=e.content[f]||"";Gt(f,Z?`${Z}

${z}`:z),le(null);const me=mv(a.id,R.id);rt(me)},ya=async f=>{try{await navigator.clipboard.writeText(f.body),C({msg:"  .",type:"info"})}catch{C({msg:"     ",type:"warning"})}},Na=f=>{var m;if(!f.suggestion)return;const R=f.sectionKey,z=e.content[R]||"",Z=f.excerpt;if(!(Z&&z.includes(Z))){(m=navigator.clipboard)==null||m.writeText(f.suggestion).catch(()=>{}),C({msg:"    .   .",type:"info"});return}const d=z.replace(Z,f.suggestion);Gt(R,d)},Ar=f=>Q.filter(R=>R.sectionKey===f&&R.isEnabled!==!1).sort((R,z)=>{const Z=R.label==="LLOYDS_RECOMMENDED"?0:1,me=z.label==="LLOYDS_RECOMMENDED"?0:1;if(Z!==me)return Z-me;const d=R.usageCount||0;return(z.usageCount||0)-d}),Mo=f=>{if(a.role!=="ADMIN")return;const R=we.current[f],z=R==null?void 0:R.current;if(!z){C({msg:"     .",type:"error"});return}const Z=z.selectionStart??0,me=z.selectionEnd??0;if(Z===me){C({msg:"     -Best Practice.",type:"info"});return}const m=(e.content[f]||"").slice(Z,me).trim();if(!m){C({msg:"    .",type:"info"});return}Qe({sectionKey:f,body:m})},qi=async({title:f,label:R,tags:z,behavior:Z})=>{if(!Me)return;const me=new Date().toISOString(),d={id:"",sectionKey:Me.sectionKey,title:f,body:Me.body,label:R,tags:z.length?z:void 0,isEnabled:!0,createdByUserId:a.id,createdAt:me,updatedAt:me,usageCount:0,lastUsedAt:null,behavior:Z};try{const m=await pp(d,a.role);ye(m),C({msg:"Best Practice  .",type:"success"})}catch(m){console.error("Failed to save best practice",m),C({msg:" -Best Practice .",type:"error"})}Qe(null)},ba=()=>{Qe(null)},Po=async(f,R)=>{if(Fe)return;const z=e.content[f]||"",Z=z?`${z}

${R.body}`:R.body;Gt(f,Z);try{const me=await fp(R.id,"INSERT",a.role);ye(me)}catch(me){console.error("Failed to record best practice usage (insert)",me)}},va=async f=>{var R;(R=navigator.clipboard)==null||R.writeText(f.body).catch(()=>{});try{const z=await fp(f.id,"COPY",a.role);ye(z)}catch(z){console.error("Failed to record best practice usage (copy)",z)}C({msg:"  .",type:"info"})},Ir=async(f,R)=>{const z=Q.find(me=>me.id===f);if(!z)return;const Z={...z,...R,updatedAt:new Date().toISOString()};try{const me=await pp(Z,a.role);ye(me)}catch(me){console.error("Failed to update best practice",me),C({msg:" -Best Practice .",type:"error"})}},Fo=async f=>{try{const R=await sN(f,a.role);ye(R)}catch(R){console.error("Failed to delete best practice",R),C({msg:" -Best Practice .",type:"error"})}},Bo=async(f,R)=>{try{const z=await rN(f,R,a.role);ye(z)}catch(z){console.error("Failed to toggle best practice enabled",z),C({msg:"  -Best Practice .",type:"error"})}},Xi=f=>{const R=f.rows.filter(d=>d.type==="EXPENSE"),z=f.rows.filter(d=>d.type==="ADJUSTMENT"),Z=R.map(d=>` ${d.label}${d.serviceProvider?` (${d.serviceProvider})`:""}  ${d.amount.toLocaleString()}`),me=z.map(d=>` ${d.label}  ${d.amount.toLocaleString()}`);return["     ","",":",Z.length?Z.join(`
`):"   ",""," / :",me.length?me.join(`
`):"  ","",`" : ${f.totals.totalExpenses.toLocaleString()}`,`" : ${f.totals.totalAdjustments.toLocaleString()}`,` : ${f.totals.totalBalance.toLocaleString()}`].join(`
`)};return n.jsxs(n.Fragment,{children:[n.jsx("input",{type:"file",ref:Ds,className:"hidden",accept:".pdf,.doc,.docx,.txt,.jpg,.jpeg,.png,application/pdf,application/msword,application/vnd.openxmlformats-officedocument.wordprocessingml.document,text/plain,image/*",onChange:Oo}),n.jsxs("div",{className:"space-y-6",children:[n.jsxs("div",{className:"flex flex-wrap justify-between items-center gap-2",children:[n.jsxs("button",{onClick:s,className:"flex items-center text-sm text-textMuted bg-navySecondary px-3 py-1.5 rounded-full hover:bg-borderDark",children:[n.jsx(Ql,{className:"w-4 h-4 mr-1"}),"   1"]}),n.jsxs("div",{className:"flex items-center gap-3",children:[a.role==="ADMIN"&&(c||i)&&n.jsxs("div",{className:"flex flex-col items-end gap-1",children:[c&&n.jsx("button",{onClick:c,disabled:!At||x,className:`flex items-center text-sm px-3 py-1.5 rounded-full transition ${At&&!x?"text-indigo-700 bg-indigo-50 hover:bg-indigo-100":"text-slate-400 bg-slate-100 cursor-not-allowed"}`,children:x?n.jsxs(n.Fragment,{children:[n.jsx(Lt,{className:"w-4 h-4 mr-1 animate-spin"})," ..."]}):n.jsxs(n.Fragment,{children:[n.jsx(L0,{className:"w-4 h-4 mr-1"})," Auto-Translate"]})}),i&&n.jsx("button",{onClick:i,disabled:!e.isTranslated||!xa||!!b,className:`flex items-center text-sm px-3 py-1.5 rounded-full transition ${e.isTranslated&&xa&&!b?"text-emerald-700 bg-emerald-50 hover:bg-emerald-100":"text-slate-400 bg-slate-100 cursor-not-allowed"}`,children:b?n.jsxs(n.Fragment,{children:[n.jsx(Lt,{className:"w-4 h-4 mr-1 animate-spin"})," Improving..."]}):n.jsx(n.Fragment,{children:"Improve English"})}),c&&!At&&!x&&n.jsx("p",{className:"text-[11px] text-textMuted",children:"      ."}),e.translationStale&&n.jsx("p",{className:"text-[11px] text-amber-700 max-w-xs text-right",children:" :      ,      ."}),x&&n.jsx("p",{className:"text-[11px] text-indigo-600",children:"      ."})]}),a.role==="ADMIN"&&En&&n.jsxs("div",{className:"flex flex-col items-end gap-1 text-[11px] text-textLight",children:[n.jsx("span",{className:"font-semibold",children:"  "}),n.jsxs("div",{className:"inline-flex rounded-full border border-borderDark overflow-hidden bg-panel",children:[n.jsx("button",{type:"button",onClick:()=>Rs("DUAL"),className:`px-3 py-1 ${cs==="DUAL"?"bg-slate-800 text-white":"bg-panel text-textLight hover:bg-slate-100"} text-[11px]`,children:" + "}),n.jsx("button",{type:"button",onClick:()=>Rs("ENGLISH_ONLY"),className:`px-3 py-1 border-r border-borderDark ${cs==="ENGLISH_ONLY"?"bg-slate-800 text-white":"bg-panel text-textLight hover:bg-slate-100"} text-[11px]`,children:" "})]})]}),a.role==="ADMIN"&&u&&n.jsxs("button",{onClick:Hi,className:"flex items-center text-sm text-purple-700 bg-purple-50 px-3 py-1.5 rounded-full hover:bg-purple-100",children:[n.jsx(Lu,{className:"w-4 h-4 mr-1"})," Format Text"]}),n.jsxs("button",{onClick:o,className:"flex items-center text-sm text-lpBlue bg-blue-50 px-3 py-1.5 rounded-full hover:bg-blue-100",children:[n.jsx(Du,{className:"w-4 h-4 mr-1"}),"  "]})]})]}),j&&n.jsxs("div",{className:"flex items-center justify-end gap-2 text-[11px] text-indigo-600",children:[n.jsx(Lt,{className:"w-3 h-3 animate-spin"}),n.jsx("span",{children:"   ,     "})]}),E&&n.jsx(hv,{message:E.msg,type:E.type,onClose:()=>C(null)}),n.jsxs("div",{className:"flex items-center justify-between gap-2",children:[n.jsx("h2",{className:"text-2xl font-bold text-lpBlue font-serif",children:"2. Draft Content"}),!Fe&&F&&n.jsxs("button",{type:"button",onClick:()=>F(),className:"flex items-center text-[11px] px-3 py-1.5 rounded-full bg-indigo-50 text-indigo-800 border border-indigo-200 hover:bg-indigo-100",title:"         (  ).",children:[n.jsx(aa,{className:"w-3 h-3 ml-1"})," "]})]}),!Fe&&n.jsxs("div",{className:"mb-3 mt-1 space-y-1",children:[n.jsxs("div",{className:"flex items-center justify-between gap-2",children:[n.jsx("div",{className:"flex items-center gap-2",children:n.jsx("span",{className:"text-[11px] font-semibold text-textMuted",children:"  "})}),qe&&n.jsxs("div",{className:"text-[11px] text-textMuted",children:[" Tone & Risk :"," ",new Date(qe).toLocaleString("he-IL",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"})]})]}),n.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[n.jsx("button",{type:"button",onClick:Yi,disabled:ee,title:"        .        .",className:`flex items-center text-sm font-semibold px-4 py-2 rounded-lg border ${ee?"bg-slate-100 text-slate-400 border-borderDark cursor-not-allowed":"bg-blue-500/20 text-blue-200 border-blue-400/60 hover:bg-blue-500/30"}`,children:ee?n.jsxs(n.Fragment,{children:[n.jsx(Lt,{className:"w-4 h-4 mr-1.5 animate-spin"}),"   ..."]}):n.jsx(n.Fragment,{children:"  ( )"})}),D.length>0&&n.jsxs("button",{type:"button",onClick:()=>{const f=document.getElementById("hebrew-style-panel");f&&f.scrollIntoView({behavior:"smooth",block:"start"})},className:"inline-flex items-center text-xs font-medium px-2.5 py-1 rounded-full bg-blue-500/20 text-blue-200 border border-blue-400/60 hover:bg-blue-500/30",children:[" ",D.length>1&&` (${D.length})`]}),n.jsx("button",{type:"button",onClick:Ui,disabled:_e,title:"         .        .",className:`flex items-center text-sm font-semibold px-4 py-2 rounded-lg border ${_e?"bg-slate-100 text-slate-400 border-borderDark cursor-not-allowed":"bg-amber-500/20 text-amber-200 border-amber-400/60 hover:bg-amber-500/30"}`,children:_e?n.jsxs(n.Fragment,{children:[n.jsx(Lt,{className:"w-4 h-4 mr-1.5 animate-spin"}),"  Tone & Risk..."]}):n.jsx(n.Fragment,{children:" Tone & Risk ()"})}),fe.length>0&&n.jsx("button",{type:"button",onClick:Wi,className:"text-[11px] text-textMuted hover:text-textLight underline",children:"  Tone & Risk"})]}),n.jsxs("div",{className:"flex flex-wrap items-center gap-4 text-[11px] text-textMuted",children:[Oe&&!D.length&&!ee&&n.jsx("span",{children:"  ."}),qe&&!fe.length&&!_e&&n.jsx("span",{children:"  Tone & Risk."})]})]}),!Fe&&fe.length>0&&n.jsxs("div",{id:"tone-risk-panel",className:"mb-4 border border-amber-200 bg-amber-50 rounded-md p-3 text-xs space-y-2",children:[n.jsxs("div",{className:"flex items-center justify-between gap-2 mb-1",children:[n.jsxs("div",{className:"font-semibold text-amber-900",children:[" ",fe.length,"  Tone & Risk"]}),J&&n.jsx("button",{type:"button",onClick:Ki,className:"text-[11px] text-textMuted hover:text-textLight underline",children:"  "})]}),st&&n.jsxs("div",{className:"text-[11px] text-textMuted",children:[" ",st.sectionsSent,"  |  : ",st.charsBefore," |  : ",st.charsAfter,st.truncatedSections>0&&n.jsxs("span",{className:"ml-2 text-amber-700",children:["      (",st.truncatedSections,")"]})]}),n.jsx("div",{className:"space-y-2 max-h-60 overflow-y-auto",children:fe.map(f=>n.jsxs("div",{className:"bg-panel border border-amber-200 rounded px-2 py-2 space-y-1",children:[n.jsx("div",{className:"flex items-center justify-between gap-2",children:n.jsxs("div",{className:"flex items-center gap-1",children:[n.jsx("span",{className:"inline-flex items-center rounded-full px-2 py-0.5 text-[10px] font-semibold bg-slate-100 text-textLight",children:f.sectionKey||"Unknown section"}),n.jsx("span",{className:`inline-flex items-center rounded-full px-2 py-0.5 text-[10px] font-semibold ${f.severity==="CRITICAL"?"bg-red-100 text-red-700":f.severity==="WARNING"?"bg-amber-100 text-amber-700":"bg-slate-100 text-textMuted"}`,children:f.severity}),n.jsx("span",{className:"inline-flex items-center rounded-full px-2 py-0.5 text-[10px] bg-indigo-50 text-indigo-700 font-mono",children:f.kind})]})}),n.jsxs("div",{className:"text-[11px] text-textLight",children:[n.jsx("span",{className:"font-semibold",children:":"})," ",n.jsxs("span",{className:"italic",children:['"',f.excerpt,'"']})]}),n.jsxs("div",{className:"text-[11px] text-textLight",children:[n.jsx("span",{className:"font-semibold",children:":"})," ",f.message]}),f.suggestion&&n.jsxs("div",{className:"text-[11px] text-textLight",children:[n.jsx("span",{className:"font-semibold",children:" :"})," ",n.jsx("span",{className:"whitespace-pre-wrap",children:f.suggestion})]}),n.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[f.suggestion&&n.jsxs(n.Fragment,{children:[n.jsx("button",{type:"button",onClick:()=>{var R;return(R=navigator.clipboard)==null?void 0:R.writeText(f.suggestion||"").catch(()=>{})},className:"px-2 py-0.5 rounded border border-borderDark text-[11px] text-textLight hover:bg-slate-100",children:"  "}),n.jsx("button",{type:"button",onClick:()=>Vi(f),className:"px-2 py-0.5 rounded border border-emerald-300 text-[11px] text-emerald-700 hover:bg-emerald-50",children:" "})]}),n.jsx("button",{type:"button",onClick:()=>ae(R=>R.filter(z=>z.id!==f.id)),className:"px-2 py-0.5 rounded border border-borderDark text-[11px] text-textMuted hover:bg-slate-100 ml-auto",children:""})]})]},f.id))})]}),!Fe&&D.length>0&&n.jsxs("div",{id:"hebrew-style-panel",className:"mb-4 border border-blue-200 bg-blue-50 rounded-md p-3 text-xs space-y-2",children:[n.jsxs("div",{className:"flex items-center justify-between gap-2 mb-1",children:[n.jsxs("div",{className:"font-semibold text-blue-900",children:[" ",D.length,"   "]}),Oe&&n.jsxs("div",{className:"text-[11px] text-textMuted",children:[" :"," ",new Date(Oe).toLocaleString("he-IL",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"})]})]}),n.jsx("div",{className:"space-y-2 max-h-60 overflow-y-auto",children:D.map(f=>{const R=e.content[f.sectionKey]||"",z=!!f.suggestion&&!!f.excerpt&&R.includes(f.excerpt);return n.jsxs("div",{className:"bg-panel border border-blue-200 rounded px-2 py-2 space-y-1",children:[n.jsx("div",{className:"flex items-center justify-between gap-2",children:n.jsxs("div",{className:"flex items-center gap-1",children:[n.jsx("span",{className:"inline-flex items-center rounded-full px-2 py-0.5 text-[10px] font-semibold bg-slate-100 text-textLight",children:f.sectionKey||"Unknown section"}),n.jsx("span",{className:`inline-flex items-center rounded-full px-2 py-0.5 text-[10px] font-semibold ${f.severity==="CRITICAL"?"bg-red-100 text-red-700":f.severity==="WARNING"?"bg-amber-100 text-amber-700":"bg-slate-100 text-textMuted"}`,children:f.severity}),n.jsx("span",{className:"inline-flex items-center rounded-full px-2 py-0.5 text-[10px] bg-blue-50 text-blue-700 font-mono",children:f.category})]})}),n.jsxs("div",{className:"text-[11px] text-textLight",children:[n.jsx("span",{className:"font-semibold",children:":"})," ",n.jsxs("span",{className:"italic",children:['"',f.excerpt,'"']})]}),n.jsxs("div",{className:"text-[11px] text-textLight",children:[n.jsx("span",{className:"font-semibold",children:":"})," ",f.message]}),f.suggestion&&n.jsxs("div",{className:"text-[11px] text-textLight",children:[n.jsx("span",{className:"font-semibold",children:" :"})," ",n.jsx("span",{className:"whitespace-pre-wrap",children:f.suggestion})]}),f.suggestion&&n.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[n.jsx("button",{type:"button",onClick:()=>{var Z;return(Z=navigator.clipboard)==null?void 0:Z.writeText(f.suggestion||"").catch(()=>{})},className:"px-2 py-0.5 rounded border border-borderDark text-[11px] text-textLight hover:bg-slate-100",children:" "}),z&&n.jsx("button",{type:"button",onClick:()=>Na(f),className:"px-2 py-0.5 rounded border border-emerald-300 text-[11px] text-emerald-700 hover:bg-emerald-50",children:" "})]})]},f.id)})})]}),Fe&&n.jsxs("div",{className:"bg-orange-100 border-l-4 border-orange-500 p-4 text-orange-800",children:[n.jsxs("p",{className:"font-bold flex items-center",children:[n.jsx(F0,{className:"w-5 h-5 mr-2"})," Restricted Access Mode"]}),n.jsxs("p",{className:"text-sm",children:["You are logged in as ",a.role,". You can only modify the Invoice Attachments in the Expenses section."]})]}),e.financeInstructions&&n.jsx("div",{className:"bg-red-50 border-l-4 border-red-600 p-4 shadow-md rounded-r-lg animate-pulse-slow",children:n.jsxs("div",{className:"flex items-start",children:[n.jsx("div",{className:"flex-shrink-0",children:n.jsx(qa,{className:"h-5 w-5 text-red-600"})}),n.jsxs("div",{className:"ml-3 w-full",children:[n.jsx("h3",{className:"text-sm font-bold text-red-800",children:"Instruction from Finance"}),n.jsx("div",{className:"mt-2 text-sm text-red-700 whitespace-pre-wrap",children:e.financeInstructions}),e.expensesSourceFile&&n.jsxs("div",{className:"mt-4 pt-2 border-t border-red-200",children:[n.jsx("p",{className:"text-xs font-bold text-red-800 mb-1",children:"Attached Expenses Source File (Word/Excel):"}),n.jsxs("div",{className:"flex items-center bg-panel p-2 rounded border border-red-200 max-w-md",children:[n.jsx(go,{className:"w-4 h-4 text-blue-600 mr-2"}),n.jsx("span",{className:"text-sm text-textLight flex-1",children:e.expensesSourceFile.name}),n.jsx("a",{href:`data:${e.expensesSourceFile.type};base64,${e.expensesSourceFile.data}`,download:e.expensesSourceFile.name,className:"text-xs bg-blue-100 text-blue-700 px-2 py-1 rounded hover:bg-blue-200 font-bold",children:"Download"})]})]})]})]})}),jn&&n.jsxs("div",{className:"bg-amber-50 border-l-4 border-amber-500 p-4 shadow rounded-r-lg flex gap-3 items-start",children:[n.jsx(qa,{className:"w-5 h-5 text-amber-600 mt-1"}),n.jsxs("div",{children:[n.jsx("p",{className:"font-bold text-amber-900",children:"    "}),n.jsx("p",{className:"text-sm text-amber-800",children:"  /   .              ."})]})]}),n.jsx(cN,{report:e,currentUser:a,onSubmitToAdmin:()=>p&&p(),onApproveHebrew:()=>y&&y(),onRequestChanges:f=>S&&S(f),onMarkIssueDone:f=>w&&w(f),onAddExternalFeedbackIssues:(f,R)=>L&&L(f,R),onReopenHebrewDueToExternalFeedback:()=>k&&k()}),n.jsx("div",{className:"space-y-8",children:e.selectedSections.map(f=>{var d,m,h,A;const R=Cd(f,(d=e.expertSummaryMode)==null?void 0:d[f]),z=/expert/i.test(R),Z=fe.filter(v=>v.sectionKey===f).length,me=D.filter(v=>v.sectionKey===f).length;return n.jsxs("div",{className:`bg-panel p-6 rounded-lg shadow-sm border transition-all ${Fe&&!f.includes("Expenses")?"opacity-60 pointer-events-none border-gray-100":"border-borderDark"}`,onClick:v=>{if(!H||typeof f!="string"||!f.trim())return;const M=v.target;!M||M.closest('button, a, input, textarea, select, svg, [role="button"]')||H(f)},children:[n.jsxs("div",{className:"flex justify-between items-center mb-3 pb-3 border-b border-gold/30",children:[n.jsxs("div",{className:"flex flex-col gap-1",children:[n.jsx("h3",{className:"font-bold text-xl text-gold uppercase tracking-wider border-r-2 border-gold/50 pr-2",children:R}),f.includes("Expenses")&&e.expensesSnapshotAt&&n.jsxs("p",{className:"text-[11px] text-textMuted",children:["Based on the latest Expenses Table as of"," ",new Date(e.expensesSnapshotAt).toLocaleString("en-GB",{day:"2-digit",month:"short",year:"numeric",hour:"2-digit",minute:"2-digit"}),"."]}),!f.includes("Expenses")&&(me>0||Z>0)&&n.jsxs("div",{className:"flex flex-wrap gap-1 text-[10px]",children:[me>0&&n.jsxs("button",{type:"button",onClick:()=>{const v=document.getElementById("hebrew-style-panel");v&&v.scrollIntoView({behavior:"smooth",block:"start"})},className:"inline-flex items-center rounded-full px-2 py-0.5 bg-blue-50 text-blue-800 border border-blue-200 hover:bg-blue-100",children:[" ",me>1&&` (${me})`]}),Z>0&&n.jsxs("button",{type:"button",onClick:()=>{const v=document.getElementById("tone-risk-panel");v&&v.scrollIntoView({behavior:"smooth",block:"start"})},className:"inline-flex items-center rounded-full px-2 py-0.5 bg-amber-50 text-amber-800 border border-amber-200 hover:bg-amber-100",children:[" Tone & Risk",Z>1&&` (${Z})`]})]})]}),!Fe&&n.jsxs("div",{className:"flex items-center gap-2",children:[!f.includes("Expenses")&&n.jsx("button",{className:"inline-flex items-center px-2.5 py-2 rounded-lg border border-borderDark hover:border-gold/50 hover:bg-gold/10 text-textMuted hover:text-goldLight transition",disabled:j,onClick:()=>{kr({mode:"SECTION",section:f,analysisType:ki(f)})},title:"   ",children:ds===f?n.jsx(Lt,{className:"w-4 h-4 animate-spin"}):n.jsx(M0,{className:"w-4 h-4"})}),z&&n.jsx("button",{className:"inline-flex items-center px-2.5 py-2 rounded-lg border border-borderDark hover:border-gold/50 hover:bg-gold/10 text-textMuted hover:text-goldLight transition",disabled:j,onClick:()=>{kr({mode:"SECTION",section:f,analysisType:"EXPERT",domain:"dental"})},title:"     ",children:ds===f&&(ut==null?void 0:ut.domain)==="dental"?n.jsx(Lt,{className:"w-4 h-4 animate-spin"}):n.jsx("span",{className:"text-lg leading-none",children:""})}),f.includes("Expenses")&&fa&&n.jsx("button",{onClick:()=>$i(f),className:"p-1.5 hover:bg-green-50 rounded text-textMuted hover:text-green-600",title:"   ",children:n.jsx(uh,{className:"w-4 h-4"})}),!f.includes("Expenses")&&n.jsxs(n.Fragment,{children:[f==="Strategy"&&!Fe&&n.jsx("button",{onClick:_o,className:"px-3 py-1 text-xs font-semibold text-blue-700 bg-blue-50 border border-blue-200 rounded-full hover:bg-blue-100",children:" "}),n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsxs("button",{onClick:()=>Li(f),className:"inline-flex items-center px-4 py-2 rounded-lg text-sm font-semibold text-white bg-purple-600 hover:bg-purple-500 border border-purple-500/50 transition",title:"      ,     .     .",children:[sr===f?n.jsx(Lt,{className:"w-4 h-4 mr-1.5 animate-spin"}):n.jsx(B0,{className:"w-4 h-4 mr-1.5"}),"  "]}),n.jsxs("div",{className:"flex rounded-full border border-purple-200 overflow-hidden text-[10px] bg-panel",title:"    ",children:[n.jsx("button",{type:"button",onClick:()=>Ge("SAFE_POLISH"),className:`px-2 py-0.5 ${Re==="SAFE_POLISH"?"bg-purple-100 text-purple-800":"text-purple-500 hover:bg-purple-50"}`,children:" "}),n.jsx("button",{type:"button",onClick:()=>Ge("REWRITE"),className:`px-2 py-0.5 border-l border-purple-100 ${Re==="REWRITE"?"bg-purple-100 text-purple-800":"text-purple-500 hover:bg-purple-50"}`,children:" "})]})]}),f==="Insurance Coverage"&&Bi&&n.jsx("button",{onClick:Fi,className:"p-1.5 hover:bg-blue-50 rounded text-textMuted hover:text-blue-600",title:"Auto-fill policy data",children:n.jsx(W0,{className:"w-4 h-4"})})]}),He&&He.sectionKey===f&&He.changedWords>0&&He.expiresAt>Date.now()&&n.jsxs("div",{className:"mt-1 text-[11px] text-textMuted bg-purple-50/40 border border-purple-100 rounded px-2 py-1",children:[n.jsxs("div",{className:"flex items-center justify-between gap-2",children:[n.jsxs("span",{children:["  ",He.changedWords,"   ."]}),n.jsx("button",{type:"button",className:"underline text-purple-700 hover:text-purple-900",onClick:()=>Pe(v=>v&&v.sectionKey===f?{...v,open:!v.open}:v),children:He.open?" ":" "})]}),He.open&&n.jsx("div",{className:"mt-1 text-[11px] text-textLight whitespace-pre-wrap leading-relaxed",children:He.tokens.map((v,M)=>v.type==="same"?` ${v.text}`:v.type==="add"?` [+${v.text}+]`:` [-${v.text}-]`)})]}),jr(f).length>0&&n.jsxs("button",{onClick:()=>Ci(f),className:"flex items-center gap-1 px-2 py-1 rounded text-xs font-bold bg-navySecondary text-textMuted border hover:bg-yellow-50",children:[n.jsx(aa,{className:"w-3 h-3"})," Ideas"]}),a.role==="ADMIN"&&n.jsxs("div",{className:"flex items-center gap-1",children:[n.jsx("button",{type:"button",onClick:()=>Di(f),className:"px-2 py-1 rounded text-[11px] border border-dashed border-borderDark text-textMuted hover:bg-slate-50",children:"Save selection as template"}),n.jsx("button",{type:"button",onClick:()=>Mo(f),className:"px-2 py-1 rounded text-[11px] border border-dashed border-emerald-300 text-emerald-700 hover:bg-emerald-50",children:"Save selection as Best Practice"})]})]})]}),f==="Update"&&Ei(e)&&n.jsxs("div",{className:"mb-3 text-xs text-textLight",children:[n.jsx("span",{className:"block mb-1 font-semibold",children:"    ()"}),n.jsxs("div",{className:"flex flex-wrap gap-2",children:[n.jsx("button",{type:"button",className:"px-3 py-1 rounded-full border border-borderDark bg-navySecondary hover:bg-navySecondary text-[11px] font-semibold text-textLight",onClick:()=>{const v=Pp.SOC,M=e.content.Update||"",$=v.split(`
`)[0];if(M.trimStart().startsWith($))return;const K=M.trim().length>0?`${v}

${M.trimStart()}`:v;Gt("Update",K)},children:"  (Statement of Claim)"}),n.jsx("button",{type:"button",className:"px-3 py-1 rounded-full border border-borderDark bg-navySecondary hover:bg-navySecondary text-[11px] font-semibold text-textLight",onClick:()=>{const v=Pp.LOD,M=e.content.Update||"",$=v.split(`
`)[0];if(M.trimStart().startsWith($))return;const K=M.trim().length>0?`${v}

${M.trimStart()}`:v;Gt("Update",K)},children:"  (Letter of Demand)"})]})]}),G===f&&!Fe&&n.jsxs("div",{className:"mb-4 p-3 bg-yellow-50 rounded border border-yellow-200",children:[n.jsxs("div",{className:"flex items-center justify-between gap-2 mb-2",children:[n.jsxs("div",{className:"flex items-center gap-2 text-[11px]",children:[n.jsx("button",{type:"button",className:`px-2 py-1 rounded-full border ${_==="TEMPLATES"?"bg-panel border-yellow-400 text-yellow-800 font-semibold":"bg-yellow-100/60 border-yellow-200 text-yellow-700"}`,onClick:()=>W("TEMPLATES"),children:"Templates"}),n.jsx("button",{type:"button",className:`px-2 py-1 rounded-full border ${_==="BEST_PRACTICES"?"bg-panel border-emerald-400 text-emerald-800 font-semibold":"bg-emerald-50/70 border-emerald-200 text-emerald-700"}`,onClick:()=>W("BEST_PRACTICES"),children:"Best Practices"}),n.jsx("button",{type:"button",className:`px-2 py-1 rounded-full border ${_==="MY_SNIPPETS"?"bg-panel border-sky-400 text-sky-800 font-semibold":"bg-sky-50/70 border-sky-200 text-sky-700"}`,onClick:()=>W("MY_SNIPPETS"),children:" "})]}),_==="TEMPLATES"&&n.jsx("input",{type:"text",className:"flex-1 border border-yellow-300 rounded px-2 py-1 text-xs",placeholder:"Search templates",value:O,onChange:v=>P(v.target.value)}),_==="BEST_PRACTICES"&&n.jsx("input",{type:"text",className:"flex-1 border border-emerald-300 rounded px-2 py-1 text-xs",placeholder:"Search best practices",value:de,onChange:v=>ce(v.target.value)}),_==="MY_SNIPPETS"&&n.jsx("input",{type:"text",className:"flex-1 border border-sky-300 rounded px-2 py-1 text-xs",placeholder:"  ",value:Yt,onChange:v=>Ht(v.target.value)}),a.role==="ADMIN"&&_==="TEMPLATES"&&n.jsx("button",{type:"button",onClick:()=>{oe(f),ue(!0)},className:"text-[11px] px-2 py-1 rounded bg-panel text-textLight border border-borderDark hover:bg-slate-50",children:"Manage templates"}),a.role==="ADMIN"&&_==="BEST_PRACTICES"&&n.jsx("button",{type:"button",onClick:()=>{Ee(f),ge(!0)},className:"text-[11px] px-2 py-1 rounded bg-panel text-textLight border border-borderDark hover:bg-slate-50",children:"Manage best practices"}),_==="MY_SNIPPETS"&&n.jsx("button",{type:"button",onClick:()=>{is(!0),lt(null)},className:"text-[11px] px-2 py-1 rounded bg-panel text-textLight border border-borderDark hover:bg-slate-50",children:" "})]}),n.jsx("div",{className:"grid grid-cols-1 gap-2 max-h-60 overflow-y-auto text-xs",children:_==="TEMPLATES"?(()=>{const v=jr(f),M=O.trim().toLowerCase(),$=M?v.filter(B=>B.title.toLowerCase().includes(M)||B.body.toLowerCase().includes(M)):v;return $.length?$.map(B=>{const K=B.body.length>160?`${B.body.slice(0,160)}`:B.body;return n.jsxs("div",{className:"flex items-center gap-2 bg-panel border border-yellow-100 rounded px-2 py-2 hover:bg-yellow-100 cursor-pointer",onClick:()=>ps(f,B),children:[n.jsxs("div",{className:"flex-1 min-w-0 text-right",children:[n.jsx("div",{className:"font-semibold text-textLight truncate",children:B.title}),n.jsx("div",{className:"text-[11px] text-textMuted max-h-10 overflow-hidden whitespace-pre-wrap",children:K})]}),n.jsx("button",{type:"button",className:"text-[11px] px-2 py-1 rounded bg-yellow-50 text-yellow-800 border border-yellow-200 hover:bg-yellow-100",children:"Insert"})]},B.id)}):n.jsx("p",{className:"text-[11px] text-textMuted",children:"No templates found for this section."})})():_==="BEST_PRACTICES"?(()=>{const v=Ar(f),M=de.trim().toLowerCase(),$=M?v.filter(B=>{const K=(B.tags||[]).join(" ").toLowerCase();return B.title.toLowerCase().includes(M)||B.body.toLowerCase().includes(M)||K.includes(M)}):v;return $.length?$.map(B=>{const K=B.body.length>160?`${B.body.slice(0,160)}`:B.body,ie=B.behavior!=="COPY_ONLY";return n.jsxs("div",{className:"flex items-center gap-2 bg-panel border border-emerald-100 rounded px-2 py-2 hover:bg-emerald-50 cursor-default",children:[n.jsxs("div",{className:"flex-1 min-w-0 text-right",children:[n.jsxs("div",{className:"flex flex-wrap items-center justify-end gap-1 mb-0.5",children:[n.jsx("span",{className:"font-semibold text-textLight truncate",children:B.title}),n.jsx("span",{className:`inline-flex items-center rounded-full px-2 py-0.5 text-[9px] font-semibold ${B.label==="LLOYDS_RECOMMENDED"?"bg-purple-100 text-purple-700":"bg-emerald-100 text-emerald-700"}`,children:B.label==="LLOYDS_RECOMMENDED"?"Lloyds recommended":"Best practice"}),B.tags&&B.tags.length>0&&n.jsx("span",{className:"inline-flex items-center rounded-full px-2 py-0.5 text-[9px] bg-slate-100 text-textLight",children:B.tags.join(", ")})]}),n.jsx("div",{className:"text-[11px] text-textMuted max-h-10 overflow-hidden whitespace-pre-wrap",children:K})]}),n.jsxs("div",{className:"flex flex-col items-stretch gap-1",children:[ie&&n.jsx("button",{type:"button",onClick:()=>Po(f,B),className:"text-[11px] px-2 py-0.5 rounded bg-emerald-50 text-emerald-800 border border-emerald-200 hover:bg-emerald-100",children:"Insert"}),n.jsx("button",{type:"button",onClick:()=>va(B),className:"text-[11px] px-2 py-0.5 rounded bg-slate-50 text-textLight border border-borderDark hover:bg-slate-100",children:"Copy"})]})]},B.id)}):n.jsx("p",{className:"text-[11px] text-textMuted",children:"No best practices found for this section."})})():(()=>{const v=Yt.trim().toLowerCase(),$=Nt.filter(B=>!B.sectionKey||B.sectionKey===f).filter(B=>{if(!v)return!0;const K=(B.tags||[]).join(" ").toLowerCase();return B.title.toLowerCase().includes(v)||B.body.toLowerCase().includes(v)||K.includes(v)}).slice().sort((B,K)=>{const ie=B.lastUsedAt||"",je=K.lastUsedAt||"";if(ie&&je&&ie!==je)return je.localeCompare(ie);if(ie&&!je)return-1;if(!ie&&je)return 1;const Ne=B.updatedAt||B.createdAt;return(K.updatedAt||K.createdAt).localeCompare(Ne)});return $.length?$.map(B=>{const K=B.body.length>160?`${B.body.slice(0,160)}`:B.body;return n.jsxs("div",{className:"flex items-center gap-2 bg-panel border border-sky-100 rounded px-2 py-2 hover:bg-sky-50 cursor-default",children:[n.jsxs("div",{className:"flex-1 min-w-0 text-right",children:[n.jsxs("div",{className:"flex flex-wrap items-center justify-end gap-1 mb-0.5",children:[n.jsx("span",{className:"font-semibold text-textLight truncate",children:B.title}),B.tags&&B.tags.length>0&&n.jsx("span",{className:"inline-flex items-center rounded-full px-2 py-0.5 text-[9px] bg-slate-100 text-textLight",children:B.tags.join(", ")})]}),n.jsx("div",{className:"text-[11px] text-textMuted max-h-10 overflow-hidden whitespace-pre-wrap",children:K})]}),n.jsxs("div",{className:"flex flex-col items-stretch gap-1",children:[n.jsx("button",{type:"button",onClick:()=>Gi(f,B),className:"text-[11px] px-2 py-0.5 rounded bg-sky-50 text-sky-800 border border-sky-200 hover:bg-sky-100 disabled:opacity-50 disabled:cursor-not-allowed",disabled:V,title:V?"       .":void 0,children:""}),n.jsx("button",{type:"button",onClick:()=>ya(B),className:"text-[11px] px-2 py-0.5 rounded bg-slate-50 text-textLight border border-borderDark hover:bg-slate-100",children:""}),n.jsx("button",{type:"button",onClick:()=>{is(!0),lt({id:B.id,title:B.title,sectionKey:B.sectionKey||"",tagsInput:(B.tags||[]).join(", "),body:B.body})},className:"text-[11px] px-2 py-0.5 rounded bg-slate-50 text-textLight border border-borderDark hover:bg-slate-100",children:""}),n.jsx("button",{type:"button",onClick:()=>{if(window.confirm("    ?")){const ie=Op(a.id,B.id);rt(ie)}},className:"text-[11px] px-2 py-0.5 rounded bg-red-50 text-red-700 border border-red-200 hover:bg-red-100",children:""})]})]},B.id)}):n.jsx("p",{className:"text-[11px] text-textMuted",children:"   ."})})()})]}),f.includes("Expenses")?n.jsxs("div",{className:"space-y-4",children:[on&&n.jsxs("div",{className:"bg-blue-50 p-4 rounded border border-blue-100 mb-4",children:[n.jsx("h4",{className:"text-sm font-bold text-blue-800 mb-2",children:"Add Expense Item"}),n.jsxs("div",{className:"flex gap-2 flex-wrap",children:[n.jsx("input",{type:"date",className:"border p-2 rounded text-sm",value:De.date,onChange:v=>Le({...De,date:v.target.value})}),n.jsx("input",{type:"text",className:"border p-2 rounded text-sm flex-1",placeholder:"Description (e.g. Court Fee)",value:De.description,onChange:v=>Le({...De,description:v.target.value})}),n.jsx("input",{type:"number",className:"border p-2 rounded text-sm w-24",placeholder:"Amount",value:De.amount,onChange:v=>Le({...De,amount:Number(v.target.value)})}),n.jsx("button",{onClick:Ai,className:"bg-blue-600 text-white px-4 py-2 rounded text-sm font-bold hover:bg-blue-700",children:"Add"})]})]}),on&&n.jsxs("div",{className:"flex items-center justify-between mb-2",children:[n.jsxs("div",{className:"relative text-xs",children:[n.jsxs("button",{className:"flex items-center text-indigo-600 bg-panel px-2 py-1 rounded hover:bg-indigo-50",onClick:()=>us(Cs===f?null:f),children:[n.jsx(yo,{className:"w-3 h-3 mr-1"})," Auto-extract"]}),Cs===f&&n.jsxs("div",{className:"absolute right-0 mt-2 w-44 bg-panel border border-borderDark rounded-lg shadow-lg z-20",children:[n.jsxs("label",{className:"w-full block px-3 py-2 hover:bg-navySecondary cursor-pointer text-right",children:["  ",n.jsx("input",{type:"file",className:"hidden",onChange:v=>{us(null),Pi(v,f)},accept:".pdf,.jpg,.png"})]}),n.jsx("button",{className:"w-full text-right px-3 py-2 hover:bg-navySecondary",onClick:()=>kr({mode:"EXPENSES",section:f}),children:"  OCR"})]})]}),j&&n.jsxs("span",{className:"text-xs text-indigo-500 flex items-center",children:[n.jsx(Lt,{className:"w-3 h-3 animate-spin mr-1"}),"   ,     "]})]}),n.jsxs("div",{className:"space-y-2",children:[n.jsxs("div",{className:"flex justify-between items-center bg-indigo-50 p-2 rounded border border-indigo-200",children:[n.jsxs("span",{className:"text-sm font-bold text-indigo-900",children:["Total Extracted: ",e.expensesSum||"0"]}),on&&n.jsx("button",{onClick:()=>t({expensesItems:[],expensesSum:"0"}),className:"text-xs text-red-500 hover:underline",children:"Clear All"})]}),n.jsx("div",{className:"overflow-x-auto border rounded",children:n.jsxs("table",{className:"w-full text-sm border-collapse border-borderDark",children:[n.jsx("thead",{className:"bg-navySecondary",children:n.jsxs("tr",{children:[n.jsx("th",{className:"p-2 text-left text-textMuted",children:"Date"}),n.jsx("th",{className:"p-2 text-left text-textMuted",children:"Description"}),n.jsx("th",{className:"p-2 text-right text-textMuted",children:"Amount"}),!Fe&&n.jsx("th",{className:"p-2 w-8"})]})}),n.jsxs("tbody",{children:[e.expensesItems.length===0&&n.jsx("tr",{children:n.jsx("td",{colSpan:4,className:"p-4 text-center text-gray-400 italic",children:"No expenses added."})}),e.expensesItems.map((v,M)=>n.jsxs("tr",{className:"border-t",children:[n.jsx("td",{className:"p-2",children:v.date}),n.jsx("td",{className:"p-2",children:v.description}),n.jsxs("td",{className:"p-2 text-right",children:[v.amount," ",v.currency]}),on&&n.jsx("td",{className:"p-2 text-center",children:n.jsx("button",{onClick:()=>Ii(v.id),className:"text-red-400 hover:text-red-600",children:n.jsx(Ot,{className:"w-3 h-3"})})})]},M))]})]})}),on&&n.jsx("div",{className:"bg-indigo-50 p-3 rounded border",children:n.jsxs("select",{className:"w-full text-sm border p-2 rounded",value:e.paymentRecommendation||"",onChange:v=>t({paymentRecommendation:v.target.value}),children:[n.jsx("option",{value:"",children:"-- Select Recommendation --"}),n.jsx("option",{value:"The expenses are lower than the Deductible...",children:"Option A: Lower than Deductible"}),n.jsxs("option",{value:`It would be appreciated... transfer ${e.expensesSum||"..."}`,children:["Option B: Transfer Funds (",e.expensesSum," )"]})]})})]}),n.jsxs("div",{className:`border-t-2 pt-4 mt-6 ${Fe?"bg-green-50 p-4 rounded border-green-200":""}`,children:[n.jsxs("h4",{className:"font-bold text-sm text-textLight mb-2 flex items-center",children:[n.jsx(dh,{className:"w-4 h-4 mr-2"})," Tax Invoices (Appendices)"]}),(on||!e.isWaitingForInvoices)&&n.jsxs("div",{className:"flex flex-wrap items-center gap-2 mb-2",children:[n.jsxs("button",{onClick:()=>{var v;return(v=I.current)==null?void 0:v.click()},className:"px-3 py-1.5 text-xs bg-navySecondary text-textLight rounded hover:bg-borderDark flex items-center gap-1",children:[n.jsx(yo,{className:"w-3 h-3"})," "]}),n.jsx("button",{onClick:()=>kr({mode:"INVOICE"}),className:"px-3 py-1.5 text-xs bg-red-100 text-red-700 rounded hover:bg-red-200 flex items-center gap-1",children:ds==="INVOICE"?n.jsx(Lt,{className:"w-3 h-3 animate-spin"}):" "}),n.jsx("input",{ref:I,type:"file",className:"hidden",multiple:!0,accept:".pdf,.doc,.docx,application/msword,application/vnd.openxmlformats-officedocument.wordprocessingml.document,application/pdf",onChange:Ut})]}),n.jsx("div",{className:"mt-2 space-y-2",children:e.invoiceFiles.map(v=>n.jsxs("div",{className:"flex items-center justify-between bg-panel p-2 rounded border shadow-sm text-xs",children:[n.jsxs("span",{className:"flex items-center",children:[n.jsx(go,{className:"w-3 h-3 mr-2 text-blue-500"})," ",v.name]}),n.jsx("button",{onClick:()=>tn(v.id),className:"text-red-400 hover:text-red-600",children:n.jsx(Ot,{className:"w-3 h-3"})})]},v.id))})]})]}):n.jsxs("div",{className:"relative",children:[!(En&&cs==="ENGLISH_ONLY")&&n.jsx(Fp,{className:"w-full border border-borderDark rounded-md p-4 min-h-[100px] text-right font-sans focus:ring-1 focus:ring-lpBlue outline-none transition-all",dir:"rtl",value:e.content[f]||"",onChange:v=>Gt(f,v.target.value),disabled:Fe,readOnly:V,placeholder:"Type Hebrew content here...",style:{lineHeight:"1.6",textAlign:"justify"},textareaRef:(we.current[f]||(we.current[f]=ci.createRef()),we.current[f])}),En&&n.jsxs("div",{className:cs==="ENGLISH_ONLY"?"":"mt-4 border-t pt-4",children:[n.jsxs("div",{className:"flex items-center justify-between mb-2",children:[n.jsx("label",{className:"text-xs font-bold text-textMuted uppercase block",children:"English Output (Editable)"}),a.role==="ADMIN"&&e.isTranslated&&!f.toLowerCase().includes("expenses")&&n.jsx("button",{type:"button",onClick:()=>wr(f),disabled:!!Mn&&Mn===f||!(((m=e.translatedContent)==null?void 0:m[f])||"").trim(),className:`text-[11px] px-2 py-1 rounded-full border transition ${Mn===f?"border-emerald-400 text-emerald-600 bg-emerald-50 cursor-wait":(((h=e.translatedContent)==null?void 0:h[f])||"").trim()?"border-emerald-500 text-emerald-700 hover:bg-emerald-50":"border-borderDark text-slate-400 cursor-not-allowed"}`,children:Mn===f?n.jsxs("span",{className:"inline-flex items-center gap-1",children:[n.jsx(Lt,{className:"w-3 h-3 animate-spin"}),"Improving..."]}):"Improve this section"})]}),n.jsx(Fp,{className:"w-full border border-indigo-200 rounded-md p-4 min-h-[100px] font-serif focus:ring-1 focus:ring-indigo-300 outline-none transition-all",dir:"ltr",value:((A=e.translatedContent)==null?void 0:A[f])||"",onChange:v=>Ri(f,v.target.value),placeholder:"Translated text will appear here after Auto-Translate...",readOnly:V,style:{lineHeight:"1.6",textAlign:"justify"}})]})]})]},f)})}),a.role==="ADMIN"&&X&&n.jsx("div",{className:"fixed inset-0 z-[120] flex items-center justify-center bg-black/40",children:n.jsxs("div",{className:"bg-panel rounded-lg shadow-xl w-full max-w-3xl max-h-[80vh] overflow-hidden flex flex-col",children:[n.jsxs("div",{className:"px-4 py-2 border-b flex items-center justify-between",children:[n.jsx("h3",{className:"text-sm font-semibold text-textLight",children:"Manage Templates"}),n.jsx("button",{type:"button",onClick:()=>ue(!1),className:"text-textMuted hover:text-textLight",children:n.jsx(Ot,{className:"w-4 h-4"})})]}),n.jsx("div",{className:"px-4 py-3 border-b flex items-center gap-3 text-xs",children:n.jsxs("label",{className:"font-semibold text-textLight",children:["Section:",n.jsx("select",{className:"ml-2 border border-borderDark rounded px-2 py-1 text-xs",value:xe,onChange:f=>oe(f.target.value),children:Dr.map(f=>n.jsx("option",{value:f,children:f},f))})]})}),n.jsx("div",{className:"flex-1 overflow-y-auto px-4 py-3 space-y-3 text-xs",children:(()=>{const f=se.filter(R=>R.sectionKey===xe).sort((R,z)=>(R.orderIndex||0)-(z.orderIndex||0)||R.createdAt.localeCompare(z.createdAt));return f.length?f.map((R,z)=>n.jsxs("div",{className:"border border-borderDark rounded-md p-2 bg-slate-50 space-y-1",children:[n.jsxs("div",{className:"flex items-center justify-between gap-2",children:[n.jsx("input",{type:"text",className:"flex-1 border border-borderDark rounded px-2 py-1 text-xs",value:R.title,onChange:Z=>Er(R.id,{title:Z.target.value})}),n.jsxs("label",{className:"flex items-center gap-1 text-[11px] text-textLight",children:[n.jsx("input",{type:"checkbox",checked:R.isEnabled!==!1,onChange:Z=>Er(R.id,{isEnabled:Z.target.checked})}),"Enabled"]})]}),n.jsx("textarea",{className:"w-full border border-borderDark rounded px-2 py-1 text-xs mt-1",rows:3,value:R.body,onChange:Z=>Er(R.id,{body:Z.target.value})}),n.jsxs("div",{className:"flex items-center justify-between mt-1",children:[n.jsxs("div",{className:"flex items-center gap-1",children:[n.jsx("button",{type:"button",className:"px-2 py-0.5 rounded border border-borderDark text-[11px] text-textLight hover:bg-slate-100",onClick:()=>ga(R.id,"UP"),disabled:z===0,children:""}),n.jsx("button",{type:"button",className:"px-2 py-0.5 rounded border border-borderDark text-[11px] text-textLight hover:bg-slate-100",onClick:()=>ga(R.id,"DOWN"),disabled:z===f.length-1,children:""})]}),n.jsx("button",{type:"button",className:"px-2 py-0.5 rounded border border-red-200 text-[11px] text-red-700 hover:bg-red-50",onClick:()=>{window.confirm("Delete this template?")&&ha(R.id)},children:"Delete"})]})]},R.id)):n.jsx("p",{className:"text-[11px] text-textMuted",children:"No templates defined yet for this section."})})()})]})}),a.role==="ADMIN"&&ne&&n.jsx("div",{className:"fixed inset-0 z-[120] flex items-center justify-center bg-black/40",children:n.jsxs("div",{className:"bg-panel rounded-lg shadow-xl w-full max-w-3xl max-h-[80vh] overflow-hidden flex flex-col",children:[n.jsxs("div",{className:"px-4 py-2 border-b flex items-center justify-between",children:[n.jsx("h3",{className:"text-sm font-semibold text-textLight",children:"Manage Best Practices"}),n.jsx("button",{type:"button",onClick:()=>ge(!1),className:"text-textMuted hover:text-textLight",children:n.jsx(Ot,{className:"w-4 h-4"})})]}),n.jsx("div",{className:"px-4 py-3 border-b flex items-center gap-3 text-xs",children:n.jsxs("label",{className:"font-semibold text-textLight",children:["Section:",n.jsx("select",{className:"ml-2 border border-borderDark rounded px-2 py-1 text-xs",value:Se,onChange:f=>Ee(f.target.value),children:Dr.map(f=>n.jsx("option",{value:f,children:f},f))})]})}),n.jsx("div",{className:"flex-1 overflow-y-auto px-4 py-3 space-y-3 text-xs",children:(()=>{const f=Q.filter(R=>R.sectionKey===Se).sort((R,z)=>{const Z=R.label==="LLOYDS_RECOMMENDED"?0:1,me=z.label==="LLOYDS_RECOMMENDED"?0:1;if(Z!==me)return Z-me;const d=R.usageCount||0;return(z.usageCount||0)-d});return f.length?f.map(R=>n.jsxs("div",{className:"border border-borderDark rounded-md p-2 bg-slate-50 space-y-1",children:[n.jsxs("div",{className:"flex items-center justify-between gap-2",children:[n.jsx("input",{type:"text",className:"flex-1 border border-borderDark rounded px-2 py-1 text-xs",value:R.title,onChange:z=>Ir(R.id,{title:z.target.value})}),n.jsxs("select",{className:"border border-borderDark rounded px-2 py-1 text-[11px]",value:R.label,onChange:z=>Ir(R.id,{label:z.target.value==="LLOYDS_RECOMMENDED"?"LLOYDS_RECOMMENDED":"BEST_PRACTICE"}),children:[n.jsx("option",{value:"BEST_PRACTICE",children:"Best practice"}),n.jsx("option",{value:"LLOYDS_RECOMMENDED",children:"Lloyds recommended"})]}),n.jsxs("label",{className:"flex items-center gap-1 text-[11px] text-textLight",children:[n.jsx("input",{type:"checkbox",checked:R.isEnabled!==!1,onChange:z=>Bo(R.id,z.target.checked)}),"Enabled"]})]}),n.jsx("textarea",{className:"w-full border border-borderDark rounded px-2 py-1 text-xs mt-1",rows:3,value:R.body,onChange:z=>Ir(R.id,{body:z.target.value})}),n.jsx("input",{type:"text",className:"w-full border border-borderDark rounded px-2 py-1 text-[11px] mt-1",placeholder:"Tags (comma separated)",value:(R.tags||[]).join(", "),onChange:z=>Ir(R.id,{tags:z.target.value.split(",").map(Z=>Z.trim()).filter(Boolean)})}),n.jsxs("div",{className:"flex items-center justify-between mt-1",children:[n.jsxs("div",{className:"flex items-center gap-2 text-[10px] text-textMuted",children:[n.jsxs("span",{children:["Usage: ",R.usageCount||0]}),R.lastUsedAt&&n.jsxs("span",{children:["Last used:"," ",new Date(R.lastUsedAt).toLocaleString("he-IL",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"})]})]}),n.jsx("button",{type:"button",className:"px-2 py-0.5 rounded border border-red-200 text-[11px] text-red-700 hover:bg-red-50",onClick:()=>{window.confirm("Delete this best practice?")&&Fo(R.id)},children:"Delete"})]})]},R.id)):n.jsx("p",{className:"text-[11px] text-textMuted",children:"No best practices defined yet for this section."})})()})]})}),ls&&n.jsx("div",{className:"fixed inset-0 z-[120] flex items-center justify-center bg-black/40",children:n.jsxs("div",{className:"bg-panel rounded-lg shadow-xl w-full max-w-3xl max-h-[80vh] overflow-hidden flex flex-col",children:[n.jsxs("div",{className:"px-4 py-2 border-b flex items-center justify-between",children:[n.jsx("h3",{className:"text-sm font-semibold text-textLight",children:" "}),n.jsx("button",{type:"button",onClick:()=>{is(!1),lt(null)},className:"text-textMuted hover:text-textLight",children:n.jsx(Ot,{className:"w-4 h-4"})})]}),n.jsxs("div",{className:"flex-1 overflow-y-auto px-4 py-3 space-y-4 text-xs",children:[n.jsxs("div",{className:"flex items-center justify-between gap-2",children:[n.jsx("p",{className:"text-[11px] text-textMuted",children:"          ."}),n.jsx("button",{type:"button",className:"px-3 py-1.5 rounded bg-sky-600 text-white text-[11px] font-semibold hover:bg-sky-700",onClick:()=>lt({id:void 0,title:"",sectionKey:"",tagsInput:"",body:""}),children:" "})]}),Nt.length===0&&n.jsx("p",{className:"text-[11px] text-textMuted",children:'    .     " ".'}),Nt.length>0&&n.jsxs("div",{className:"space-y-2",children:[n.jsx("h4",{className:"text-[11px] font-semibold text-textLight",children:" "}),n.jsx("div",{className:"space-y-1",children:Nt.slice().sort((f,R)=>(R.updatedAt||R.createdAt).localeCompare(f.updatedAt||f.createdAt)).map(f=>n.jsxs("div",{className:"flex items-center justify-between gap-2 border border-borderDark rounded-md px-2 py-1 bg-slate-50",children:[n.jsx("div",{className:"flex-1 min-w-0 text-right",children:n.jsxs("div",{className:"flex flex-wrap items-center justify-end gap-1",children:[n.jsx("span",{className:"font-semibold text-textLight truncate",children:f.title}),f.sectionKey&&n.jsx("span",{className:"inline-flex items-center rounded-full px-2 py-0.5 text-[9px] bg-slate-100 text-textLight",children:f.sectionKey}),f.tags&&f.tags.length>0&&n.jsx("span",{className:"inline-flex items-center rounded-full px-2 py-0.5 text-[9px] bg-slate-100 text-textLight",children:f.tags.join(", ")})]})}),n.jsxs("div",{className:"flex items-center gap-1",children:[n.jsx("button",{type:"button",className:"px-2 py-0.5 rounded border border-borderDark text-[11px] text-textLight hover:bg-slate-100",onClick:()=>lt({id:f.id,title:f.title,sectionKey:f.sectionKey||"",tagsInput:(f.tags||[]).join(", "),body:f.body}),children:""}),n.jsx("button",{type:"button",className:"px-2 py-0.5 rounded border border-red-200 text-[11px] text-red-700 hover:bg-red-50",onClick:()=>{if(window.confirm("Delete this personal snippet?")){const R=Op(a.id,f.id);rt(R),he&&he.id===f.id&&lt(null)}},children:""})]})]},f.id))})]}),he&&n.jsxs("form",{className:"border-t border-borderDark pt-3 space-y-3",onSubmit:f=>{f.preventDefault();const R=he.title.trim(),z=he.body.trim();if(!R||!z)return;const Z=he.tagsInput.split(",").map(d=>d.trim()).filter(Boolean)||[],me=uv(a.id,{id:he.id,title:R,body:z,sectionKey:he.sectionKey||void 0,tags:Z});rt(me),lt(null)},children:[n.jsx("h4",{className:"text-[11px] font-semibold text-textLight",children:he.id?" ":" "}),n.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-2",children:[n.jsxs("div",{className:"space-y-1",children:[n.jsx("label",{className:"block font-semibold text-textLight",children:""}),n.jsx("input",{type:"text",className:"w-full border border-borderDark rounded px-2 py-1 text-xs",value:he.title,onChange:f=>lt(R=>R&&{...R,title:f.target.value}),required:!0})]}),n.jsxs("div",{className:"space-y-1",children:[n.jsx("label",{className:"block font-semibold text-textLight",children:" ()"}),n.jsxs("select",{className:"w-full border border-borderDark rounded px-2 py-1 text-xs",value:he.sectionKey,onChange:f=>lt(R=>R&&{...R,sectionKey:f.target.value}),children:[n.jsx("option",{value:"",children:" "}),Dr.map(f=>n.jsx("option",{value:f,children:f},f))]})]})]}),n.jsxs("div",{className:"space-y-1",children:[n.jsx("label",{className:"block font-semibold text-textLight",children:" (,  )"}),n.jsx("input",{type:"text",className:"w-full border border-borderDark rounded px-2 py-1 text-xs",value:he.tagsInput,onChange:f=>lt(R=>R&&{...R,tagsInput:f.target.value})})]}),n.jsxs("div",{className:"space-y-1",children:[n.jsx("label",{className:"block font-semibold text-textLight",children:" "}),n.jsx("textarea",{className:"w-full border border-borderDark rounded px-2 py-1 text-xs",rows:5,value:he.body,onChange:f=>lt(R=>R&&{...R,body:f.target.value})})]}),n.jsxs("div",{className:"flex items-center justify-end gap-2 pt-2 border-t border-borderDark",children:[n.jsx("button",{type:"button",className:"px-3 py-1.5 rounded border border-borderDark text-[11px] text-textLight hover:bg-slate-100",onClick:()=>lt(null),children:""}),n.jsx("button",{type:"submit",className:"px-3 py-1.5 rounded bg-sky-600 text-white text-[11px] font-semibold hover:bg-sky-700",children:""})]})]})]})]})}),a.role==="ADMIN"&&Me&&n.jsx("div",{className:"fixed inset-0 z-[130] flex items-center justify-center bg-black/40",children:n.jsxs("div",{className:"bg-panel rounded-lg shadow-xl w-full max-w-md max-h-[80vh] overflow-hidden flex flex-col",children:[n.jsxs("div",{className:"px-4 py-2 border-b flex items-center justify-between",children:[n.jsx("h3",{className:"text-sm font-semibold text-textLight",children:"Save Best Practice"}),n.jsx("button",{type:"button",onClick:ba,className:"text-textMuted hover:text-textLight",children:n.jsx(Ot,{className:"w-4 h-4"})})]}),n.jsx(gv,{onSubmit:qi,onCancel:ba,initialTitle:Me.body.split(/\s+/).slice(0,6).join(" ")})]})}),n.jsxs("div",{className:"flex justify-between pt-4",children:[n.jsxs("button",{onClick:s,className:"flex items-center text-textMuted px-4 py-2 hover:bg-navySecondary rounded",children:[n.jsx(Ql,{className:"mr-2 w-4 h-4"})," Back"]}),n.jsxs("button",{onClick:r,className:"flex items-center bg-navy text-white px-6 py-2 rounded hover:bg-navySecondary transition",children:["Next Step ",n.jsx(ts,{className:"ml-2 w-4 h-4"})]})]})]})]})},Ov=({onClose:e,onSubmit:t,currentUser:s,favoriteProviders:r=[],onSaveFavorite:a})=>{const o=s.role==="LAWYER",[l,c]=g.useState(o?s.id:""),[i,u]=g.useState(""),[p,y]=g.useState(""),[S,w]=g.useState(null),[L,k]=g.useState([{id:An(),category:"EXPERT_OUR",serviceProvider:"",amount:""}]),[U,N]=g.useState([]),x=4,b=async()=>{if(!l||!p)return;let j=null;const T=E=>t({lawyerId:l,instructions:i,odakanitNo:p,file:E,worksheet:L,invoiceFiles:U});if(S){const E=new FileReader;E.onload=C=>{var se;j={name:S.name,type:S.type,data:((se=C.target)==null?void 0:se.result).split(",")[1]},T(j)},E.readAsDataURL(S)}else T()},F=async j=>{const T=j.target.files;if(!T)return;if(U.length>=x){alert("   4 ."),j.target.value="";return}const E=Array.from(T).slice(0,x-U.length),C=await Promise.all(E.map(se=>new Promise(Y=>{const O=new FileReader;O.onload=P=>{var X;return Y({id:`inv-${Date.now()}-${Math.random().toString(36).slice(2,6)}`,name:se.name,data:((X=P.target)==null?void 0:X.result).split(",")[1],type:se.type})},O.readAsDataURL(se)})));N(se=>[...se,...C]),j.target.value=""},H=j=>{N(T=>T.filter(E=>E.id!==j))},V=(j,T,E)=>{k(C=>C.map(se=>se.id===j?{...se,[T]:E}:se))},q=j=>{const T=ss.find(E=>E.type===j)||ss[0];k(E=>[...E,{id:An(),category:T.value,serviceProvider:"",amount:"",customLabel:""}])},te=j=>{k(T=>T.length===1?T:T.filter(E=>E.id!==j))},G=Md(L,s),le=oi(G);return n.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-[200]",children:n.jsxs("div",{className:"bg-panel p-6 rounded-lg shadow-xl w-96 animate-scale-in",children:[n.jsx("h3",{className:"font-bold text-lg mb-4 text-textLight",children:o?"  ":"Open New Finance Case"}),n.jsxs("div",{className:"space-y-3",children:[n.jsxs("div",{children:[n.jsx("label",{className:"block text-xs font-bold text-textMuted",children:"Internal Case # (Odakanit)"}),n.jsx("input",{className:"w-full border p-2 rounded",value:p,onChange:j=>y(j.target.value),placeholder:"e.g. 55492"})]}),!o&&n.jsxs(n.Fragment,{children:[n.jsxs("div",{children:[n.jsx("label",{className:"block text-xs font-bold text-textMuted",children:"Assign Lawyer"}),n.jsxs("select",{className:"w-full border p-2 rounded",value:l,onChange:j=>c(j.target.value),children:[n.jsx("option",{value:"",children:"-- Select --"}),vs.filter(j=>j.role==="LAWYER").map(j=>n.jsx("option",{value:j.id,children:j.name},j.id))]})]}),n.jsxs("div",{children:[n.jsx("label",{className:"block text-xs font-bold text-textMuted",children:"Instructions"}),n.jsx(ho,{clientId:vo,children:n.jsx("textarea",{className:"w-full border p-2 rounded",rows:3,value:i,onChange:j=>u(j.target.value),placeholder:"Notes for lawyer..."})})]}),n.jsxs("div",{children:[n.jsx("label",{className:"block text-xs font-bold text-textMuted",children:"Attach Expenses File"}),n.jsx("input",{type:"file",onChange:j=>{var T;return w(((T=j.target.files)==null?void 0:T[0])||null)},className:"text-xs"})]}),n.jsxs("div",{className:"border rounded-lg p-3 bg-amber-50",children:[n.jsxs("div",{className:"flex justify-between items-center mb-2",children:[n.jsx("label",{className:"block text-xs font-bold text-amber-700",children:"Expense Worksheet"}),n.jsxs("div",{className:"flex gap-2 text-xs text-amber-700 font-semibold",children:[n.jsx("button",{type:"button",onClick:()=>q("EXPENSE"),className:"hover:underline",children:"+ Expense"}),n.jsx("button",{type:"button",onClick:()=>q("ADJUSTMENT"),className:"hover:underline",children:"+ Adjustment"})]})]}),n.jsx("div",{className:"space-y-2 max-h-48 overflow-auto pr-1",children:L.map(j=>{const T=ss.find(Y=>Y.value===j.category),E=(T==null?void 0:T.type)!=="ADJUSTMENT",C=r.filter(Y=>Y.category===j.category||Y.category==="OTHER"),se=Md([j],s)[0];return n.jsxs("div",{className:"border border-amber-100 bg-panel rounded-lg p-2 space-y-2",children:[n.jsxs("div",{children:[n.jsx("label",{className:"block text-[10px] font-bold text-textMuted",children:"Expense Details"}),n.jsx("select",{value:j.category,onChange:Y=>V(j.id,"category",Y.target.value),className:"w-full border rounded text-xs p-2",children:ss.map(Y=>n.jsx("option",{value:Y.value,children:Y.label},Y.value))})]}),j.category==="OTHER"&&n.jsxs("div",{children:[n.jsx("label",{className:"block text-[10px] font-bold text-textMuted",children:"Custom Label"}),n.jsx("input",{className:"w-full border rounded text-xs p-2",placeholder:"Describe expense",value:j.customLabel||"",onChange:Y=>V(j.id,"customLabel",Y.target.value)})]}),E&&n.jsxs("div",{children:[n.jsx("label",{className:"block text-[10px] font-bold text-textMuted",children:"Service Provider"}),n.jsx("input",{list:`provider-${j.id}`,className:"w-full border rounded text-xs p-2",placeholder:"Provider name",value:j.serviceProvider,onChange:Y=>V(j.id,"serviceProvider",Y.target.value)}),n.jsx("datalist",{id:`provider-${j.id}`,children:C.map(Y=>n.jsx("option",{value:Y.serviceProvider,children:Y.label},Y.id))}),n.jsx("button",{type:"button",onClick:()=>a&&j.serviceProvider.trim()&&a({id:An(),category:j.category,label:(se==null?void 0:se.label)||"Expense",serviceProvider:j.serviceProvider.trim()}),className:"text-[10px] text-amber-600 hover:underline mt-1",children:"Save to favorites"})]}),n.jsxs("div",{children:[n.jsx("label",{className:"block text-[10px] font-bold text-textMuted",children:"Cost ()"}),n.jsx("input",{type:"number",min:"0",className:"w-full border rounded text-xs p-2",placeholder:"",value:j.amount,onChange:Y=>V(j.id,"amount",Y.target.value)})]}),n.jsx("div",{className:"text-right",children:n.jsx("button",{type:"button",onClick:()=>te(j.id),className:"text-[10px] text-red-500 hover:underline",children:"Remove"})})]},j.id)})}),n.jsxs("div",{className:"text-right text-xs font-bold text-amber-800 mt-2",children:["Total balance preview: ",le.totalBalance.toLocaleString()]})]}),n.jsxs("div",{className:"border rounded-lg p-3 bg-panel",children:[n.jsxs("div",{className:"flex justify-between items-center mb-2",children:[n.jsx("label",{className:"block text-xs font-bold text-textLight",children:"Tax Invoices (PDF / Word)"}),n.jsxs("span",{className:"text-[11px] text-textMuted",children:[U.length,"/",x]})]}),n.jsxs("label",{className:"flex flex-col items-center justify-center w-full h-24 border-2 border-borderDark border-dashed rounded-lg cursor-pointer bg-panel hover:bg-navySecondary",children:[n.jsxs("div",{className:"flex flex-col items-center justify-center pt-5 pb-6",children:[n.jsx(yo,{className:"w-6 h-6 text-gray-400 mb-2"}),n.jsx("p",{className:"text-xs text-textMuted",children:"   ( 4 )"})]}),n.jsx("input",{type:"file",className:"hidden",multiple:!0,accept:".pdf,.doc,.docx,application/msword,application/vnd.openxmlformats-officedocument.wordprocessingml.document,application/pdf",onChange:F})]}),n.jsxs("div",{className:"mt-2 space-y-2 max-h-32 overflow-auto",children:[U.map(j=>n.jsxs("div",{className:"flex items-center justify-between bg-navySecondary p-2 rounded border text-xs",children:[n.jsxs("span",{className:"flex items-center gap-2 text-textLight",children:[n.jsx(go,{className:"w-3 h-3 text-blue-500"}),j.name]}),n.jsx("button",{type:"button",onClick:()=>H(j.id),className:"text-red-400 hover:text-red-600",children:n.jsx(Ot,{className:"w-3 h-3"})})]},j.id)),U.length===0&&n.jsx("p",{className:"text-xs text-gray-400 text-center",children:"   ."})]})]})]}),o&&n.jsx("p",{className:"text-xs text-textMuted",children:"    .    ."}),n.jsx("button",{onClick:b,className:"w-full bg-indigo-600 text-white py-2 rounded font-bold mt-2 hover:bg-indigo-700",children:o?"Create Personal Folder":"Create Folder"}),n.jsx("button",{onClick:e,className:"w-full text-textMuted text-sm hover:underline mt-1",children:"Cancel"})]})]})})},Mv=({user:e,reports:t,onSelectReport:s,onNewReport:r,onLogout:a,onUpdateReport:o,onDeleteReport:l,onFinanceTaskCreate:c,onNotifyLawyerFromFinance:i,caseTemplates:u=[],onStartTemplate:p,onStartNextReport:y,archiveAfterMs:S,favoriteProviders:w={},onSaveFavorite:L,onDeleteFavorite:k,onOpenWorksheet:U,onRequestReminder:N,onRequestNote:x,onSoftDeleteReport:b,onRestoreReport:F,notifications:H=[],showNotifications:V,setShowNotifications:q,onClearNotifications:te,dailySummaryOptIn:G,setDailySummaryOptIn:le,caseFolders:j,onOpenCaseFolder:T,onOpenAssistant:E})=>{const C=e.role==="ADMIN"||e.role==="SUB_ADMIN"||e.role==="FINANCE",se=e.role==="LAWYER"||e.role==="SUB_ADMIN"||e.role==="FINANCE",[Y,O]=g.useState(!1),[P,X]=g.useState(!1),[ue,xe]=g.useState(!1),[oe,fe]=g.useState(!1),[ve,_e]=g.useState({category:"EXPERT_OUR",label:"",provider:""}),[ze,qe]=g.useState(""),[$e,st]=g.useState(null),Je=e.role==="ADMIN",J=e.role==="SUB_ADMIN"||e.role==="FINANCE";if(e.role==="FINANCE"){const I=we=>{o(we,{isPaid:!0})};return n.jsx(Yb,{user:e,reports:t,onLogout:a,onNotifyLawyer:i,onMarkReportPaid:I,onOpenAssistant:()=>E&&E(),caseFolders:j})}if(!C&&e.role==="LAWYER")return n.jsx(ib,{user:e,reports:t,caseFolders:j||{},notifications:H,showNotifications:V,setShowNotifications:q,onClearNotifications:te,dailySummaryOptIn:G,setDailySummaryOptIn:le,archiveAfterMs:S,onSelectReport:s,onNewReport:r,onOpenCaseFolder:T,onLogout:a,deleteReportById:l});const re=Date.now(),D=S??Number.MAX_SAFE_INTEGER,ae=I=>I.status==="SENT"&&I.sentAt&&re-new Date(I.sentAt).getTime()>=D,ee=C?t:t.filter(I=>I.createdBy===e.id),be=ee.filter(ae),Oe=ee.filter(I=>!ae(I)&&!I.deletedAt),Ae=ee.filter(I=>I.deletedAt&&re-new Date(I.deletedAt).getTime()<$h),Re=ee.filter(I=>!I.deletedAt),Ge=Je?Oe:se?Re:ee,He=Je?be:se?Ae:[],Pe=C?[]:t.filter(I=>I.status==="READY_TO_SEND"&&I.createdBy===e.id&&!I.deletedAt),Q=C?[]:t.filter(I=>["TASK_ASSIGNED","WAITING_FOR_INVOICES"].includes(I.status)&&I.createdBy===e.id&&!I.deletedAt),ye=I=>{var we;if((we=I.reportHistory)!=null&&we.length)return I.reportHistory;if(I.status==="SENT"){const De=I.sentAt||I.reportDate||new Date().toISOString();return[{id:`${I.id}-legacy`,reportNumber:1,subject:`${I.insurerName||"Report"}${I.insuredName?` - ${I.insuredName}`:""}`,date:De,sent:!0}]}return[]},_=C?[]:t.filter(I=>I.createdBy===e.id&&!I.deletedAt).flatMap(I=>{const we=ye(I);return we.length?we.map((De,Le)=>{var Fe;return{parent:I,entry:De,reportNumber:De.reportNumber||Le+1,sentAt:De.date||((Fe=De.snapshot)==null?void 0:Fe.createdAt)||I.sentAt,isLatest:Le===we.length-1}}):[]}).sort((I,we)=>{const De=I.sentAt?new Date(I.sentAt).getTime():0;return(we.sentAt?new Date(we.sentAt).getTime():0)-De}),W=I=>{const we=ye(I),De=we[we.length-1],Le=(De==null?void 0:De.date)||I.sentAt;return Le?new Date(Le).getTime():0},de=C?[]:t.filter(I=>I.createdBy!==e.id||I.deletedAt||I.status!=="SENT"?!1:ye(I).length>0).sort((I,we)=>W(we)-W(I)),ce=C?[]:[{id:"ready",title:"  ",subtitle:"    ",items:Pe,empty:"   .",actionLabel:" ",action:I=>s(I.id),tone:"border-red-100"},{id:"finance",title:"   ",subtitle:"  /   ",items:Q,empty:"   .",actionLabel:" ",action:I=>s(I.id),tone:"border-amber-100"},{id:"followup",title:'"  ',subtitle:' "    "   ',items:de,empty:' "   .',actionLabel:'" ',action:y?I=>y(I.id):void 0,tone:"border-blue-100"},{id:"sent",title:" ",subtitle:'      "   ',items:_,empty:"     .",tone:"border-green-100"}],ne=C?t.filter(I=>I.odakanitNo&&!I.deletedAt):[],ge=(w==null?void 0:w[e.id])||[],Se=()=>{if(!ve.provider.trim())return;const I=ss.find(De=>De.value===ve.category),we=ve.label.trim()||(I==null?void 0:I.label)||"Favorite provider";L&&L(e.id,{id:An(),category:ve.category,label:we,serviceProvider:ve.provider.trim()}),_e({category:ve.category,label:"",provider:""})},Ee=I=>{k&&k(e.id,I)};u.filter(I=>I.ownerId===e.id);const Me=t.filter(I=>Up(I)&&!I.deletedAt),Qe=e.role==="FINANCE"||e.role==="SUB_ADMIN",Nt=Je||se,rt=Je?`Items move here ${S/(1e3*60*60)}h after sending and are deleted after ${Bh/(1e3*60*60*24)} days.`:se?"     7    .":"",Yt=Me.filter(I=>!["READY_TO_SEND","SENT"].includes(I.status)),Ht=Me.filter(I=>I.status==="READY_TO_SEND"),ls=Me.filter(I=>I.status==="SENT"),is=ls.reduce((I,we)=>I+Hp(we),0),he=I=>I==="SENT"?"bg-gold/20 text-goldLight border-gold":I==="READY_TO_SEND"?"bg-danger/30 text-red-300 border-danger":"bg-navySecondary text-textMuted border-borderDark",lt=I=>I==="READY_TO_SEND"?"READY TO SEND":I.replace(/_/g," "),cs=I=>{o(I,{isPaid:!0})},Rs=ue?He:Ge,ut=I=>{const we=I.createdBy||"unknown",De=I.odakanitNo||I.marketRef||I.id||"unknown",Le=(I.plaintiffName||"unknown").toLowerCase();return`${we}::${De}::${Le}`},Kn=Qe?Rs.filter(Up):Rs,ds=new Set((Qe?[]:Rs).map(I=>ut(I))),wn=!C&&!Qe?u.filter(I=>I.ownerId===e.id&&!ds.has(I.caseKey)).map(I=>({id:`template-${I.caseKey}`,createdBy:I.ownerId,ownerName:I.ownerName,reportDate:I.lastUpdated,status:"TASK_ASSIGNED",recipientId:"1",insurerName:I.insurerName||"",lineSlipNo:I.lineSlipNo||"",marketRef:I.marketRef||"",insuredName:I.insuredName||"",plaintiffName:I.plaintiffName||"",plaintiffTitle:I.plaintiffTitle||"Plaintiff",odakanitNo:I.odakanitNo,selectedTimeline:"standard",filenameTag:fh[0],selectedSections:["Update"],content:{},translatedContent:{},expertSummaryMode:{},invoiceFiles:[],isWaitingForInvoices:!1,isTranslated:!1,expensesItems:[],expenseWorksheet:Ps(),reportNotes:[],__templateKey:I.caseKey})):[],sr=Qe?Kn:[...Kn,...wn],Yn=ze.trim().toLowerCase(),Cs=I=>Yn?`${I.odakanitNo||""} ${I.insuredName||""} ${I.plaintiffName||""} ${I.ownerName||""}`.toLowerCase().includes(Yn):!0,us=Yn?sr.filter(Cs):sr,Mn=Qe?[]:(()=>{const I=new Map;return us.forEach(we=>{if(we.__templateKey)return;const De=we.odakanitNo||we.marketRef||we.insuredName||we.id,Le=we.reportDate?new Date(we.reportDate).getTime():0,Fe=I.get(De);Fe?(Fe.reports.push(we),Le>Fe.latestDate&&(Fe.latestDate=Le),!Fe.caseLabel&&(we.insuredName||we.plaintiffName)&&(Fe.caseLabel=we.insuredName||we.plaintiffName||Fe.caseLabel),!Fe.insuredName&&we.insuredName&&(Fe.insuredName=we.insuredName),!Fe.plaintiffName&&we.plaintiffName&&(Fe.plaintiffName=we.plaintiffName)):I.set(De,{key:De,odakanitNo:we.odakanitNo||"",caseLabel:we.insuredName||we.plaintiffName||we.marketRef||"",insuredName:we.insuredName||"",plaintiffName:we.plaintiffName||"",reports:[we],latestDate:Le})}),Array.from(I.values()).sort((we,De)=>De.latestDate-we.latestDate)})(),ms=I=>!["READY_TO_SEND","SENT"].includes(I.status),Ds=I=>{if(!ms(I)){alert("      -READY TO SEND  .");return}const we=I.insuredName||I.plaintiffName||I.odakanitNo||I.id;window.confirm(`  " "${we}"?    .`)&&l&&l(I.id)};return g.useEffect(()=>{$e&&(Mn.some(I=>I.key===$e)||st(null))},[$e,Mn]),n.jsxs("div",{className:"min-h-screen bg-bgDark p-6 relative",children:[P&&n.jsx(yv,{onClose:()=>X(!1)}),Y&&n.jsx(Ov,{currentUser:e,onClose:()=>O(!1),onSubmit:I=>{c(I),O(!1)},favoriteProviders:w[e.id]||[],onSaveFavorite:I=>L&&L(e.id,I)}),oe&&n.jsx("div",{className:"fixed inset-0 bg-black/40 flex items-center justify-center z-[200] p-4",children:n.jsxs("div",{className:"bg-panel rounded-2xl shadow-2xl w-full max-w-2xl p-6 space-y-4",children:[n.jsxs("div",{className:"flex items-center justify-between",children:[n.jsxs("h3",{className:"text-lg font-bold text-textLight flex items-center gap-2",children:[n.jsx($0,{className:"w-4 h-4 text-amber-500"}),"   "]}),n.jsx("button",{onClick:()=>fe(!1),className:"text-textMuted hover:text-textLight",children:n.jsx(Ot,{className:"w-5 h-5"})})]}),n.jsxs("div",{className:"grid md:grid-cols-3 gap-3",children:[n.jsxs("div",{children:[n.jsx("label",{className:"block text-xs font-bold text-textMuted mb-1",children:""}),n.jsx("select",{value:ve.category,onChange:I=>_e({...ve,category:I.target.value}),className:"w-full border rounded text-sm p-2",children:ss.filter(I=>I.type==="EXPENSE").map(I=>n.jsx("option",{value:I.value,children:I.label},I.value))})]}),n.jsxs("div",{children:[n.jsx("label",{className:"block text-xs font-bold text-textMuted mb-1",children:" "}),n.jsx("input",{className:"w-full border rounded text-sm p-2",value:ve.label,onChange:I=>_e({...ve,label:I.target.value}),placeholder:":  "})]}),n.jsxs("div",{children:[n.jsx("label",{className:"block text-xs font-bold text-textMuted mb-1",children:" "}),n.jsx("input",{className:"w-full border rounded text-sm p-2",value:ve.provider,onChange:I=>_e({...ve,provider:I.target.value}),placeholder:'"  '})]})]}),n.jsx("div",{className:"text-right",children:n.jsx("button",{onClick:Se,className:"bg-amber-500 text-white px-4 py-2 rounded font-bold hover:bg-amber-600",children:" "})}),n.jsxs("div",{className:"max-h-64 overflow-y-auto border rounded-lg divide-y",children:[ge.length===0&&n.jsx("p",{className:"text-sm text-gray-400 text-center py-6",children:"   ."}),ge.map(I=>n.jsxs("div",{className:"p-3 flex items-center justify-between",children:[n.jsxs("div",{children:[n.jsx("p",{className:"text-sm font-bold text-textLight",children:I.label}),n.jsx("p",{className:"text-xs text-textMuted",children:I.serviceProvider})]}),n.jsx("button",{onClick:()=>Ee(I.id),className:"text-xs text-red-500 hover:underline",children:""})]},I.id))]})]})}),n.jsxs("div",{className:"w-full px-6 md:px-8 lg:px-10 xl:px-12",children:[n.jsxs("div",{className:"flex justify-between items-center mb-8",children:[n.jsxs("div",{children:[n.jsx("h1",{className:"text-3xl font-serif font-bold text-lpBlue",children:"Lior Perry Law Office"}),n.jsxs("p",{className:"text-textMuted",children:["Welcome back, ",n.jsx("span",{className:"font-bold",children:e.name})," (",e.role,")"]})]}),n.jsxs("div",{className:"flex items-center gap-3 flex-wrap justify-end",children:[Nt&&n.jsxs("button",{onClick:()=>xe(I=>!I),className:`flex items-center px-4 py-2 rounded shadow text-sm font-bold ${ue?"bg-gray-300 text-textLight":"bg-borderDark text-textLight"} hover:bg-borderDark`,children:[n.jsx($s,{className:"w-4 h-4 mr-2"})," ",ue?"Back to Reports":`Recycle Bin (${He.length})`]}),n.jsxs("button",{onClick:()=>O(!0),className:"flex items-center bg-indigo-600 text-white px-4 py-2 rounded shadow hover:bg-indigo-700 font-bold",children:[n.jsx(_u,{className:"w-4 h-4 mr-2"})," Open New Case Folder"]}),n.jsxs("button",{type:"button",onClick:()=>E&&E(),className:"flex items-center text-indigo-700 bg-indigo-50 px-3 py-2 rounded hover:bg-indigo-100",children:[n.jsx(aa,{className:"w-4 h-4 mr-2"}),"  "]}),n.jsxs("div",{className:"relative",children:[n.jsxs("button",{onClick:()=>q(I=>!I),className:"flex items-center text-blue-600 bg-blue-50 px-3 py-2 rounded hover:bg-blue-100 relative",children:[n.jsx(Jl,{className:"w-4 h-4 mr-2"})," Notifications",H.length>0&&n.jsx("span",{className:"absolute -top-2 -right-2 bg-red-500 text-white text-[10px] rounded-full px-1",children:H.length})]}),V&&n.jsxs("div",{className:"absolute right-0 mt-2 w-80 bg-panel border border-borderDark shadow-xl rounded-lg z-50",children:[n.jsxs("div",{className:"flex items-center justify-between px-3 py-2 border-b",children:[n.jsx("span",{className:"text-sm font-bold text-textLight",children:"Smart Notifications"}),n.jsxs("label",{className:"text-xs text-textMuted flex items-center gap-1",children:[n.jsx("input",{type:"checkbox",checked:G,onChange:I=>le(I.target.checked)}),"Daily summary"]})]}),n.jsxs("div",{className:"max-h-64 overflow-auto divide-y",children:[H.length===0&&n.jsx("div",{className:"p-4 text-xs text-gray-400 text-center",children:"No notifications yet."}),H.map(I=>n.jsxs("div",{className:"p-3 text-sm",children:[n.jsx("p",{className:"font-medium text-textLight",children:I.message}),n.jsx("p",{className:"text-[10px] text-gray-400",children:new Date(I.createdAt).toLocaleString()})]},I.id))]}),n.jsx("div",{className:"px-3 py-2 text-right text-xs",children:n.jsx("button",{onClick:te,className:"text-red-500 hover:underline",children:"Clear all"})})]})]}),n.jsxs("button",{onClick:()=>X(!0),className:"flex items-center text-blue-600 bg-blue-50 px-3 py-2 rounded hover:bg-blue-100",children:[n.jsx(Cu,{className:"w-4 h-4 mr-2"})," "]}),!1,n.jsxs("button",{onClick:a,className:"flex items-center text-red-600 hover:bg-red-50 px-4 py-2 rounded",children:[n.jsx(ch,{className:"w-4 h-4 mr-2"})," Logout"]})]})]}),C&&n.jsx(Nv,{reports:t,currentUser:e,onMarkPaid:cs}),J&&n.jsxs("div",{className:"mb-8 bg-panel border border-amber-200 rounded-2xl shadow p-6 space-y-4",children:[n.jsxs("div",{className:"flex items-center justify-between flex-wrap gap-3",children:[n.jsxs("div",{children:[n.jsxs("h3",{className:"text-lg font-bold text-amber-700 flex items-center gap-2",children:[n.jsx(dh,{className:"w-5 h-5"})," Expenses Overview"]}),n.jsx("p",{className:"text-sm text-textMuted",children:"Tracking all reports that include expense tables."})]}),n.jsxs("div",{className:"flex items-center gap-4 text-sm",children:[n.jsx("button",{onClick:()=>fe(!0),className:"text-xs text-amber-700 underline hover:text-amber-900",children:"Manage Favorite Providers"}),n.jsxs("div",{className:"text-center",children:[n.jsx("p",{className:"text-xs uppercase text-gray-400",children:"Assigned to Lawyers"}),n.jsx("p",{className:"text-xl font-bold text-amber-700",children:Yt.length})]}),n.jsxs("div",{className:"text-center",children:[n.jsx("p",{className:"text-xs uppercase text-gray-400",children:"Waiting for Lior"}),n.jsx("p",{className:"text-xl font-bold text-blue-600",children:Ht.length})]}),n.jsxs("div",{className:"text-center",children:[n.jsx("p",{className:"text-xs uppercase text-gray-400",children:"Sent to Insurer"}),n.jsx("p",{className:"text-xl font-bold text-green-600",children:ls.length})]}),n.jsxs("div",{className:"text-center",children:[n.jsx("p",{className:"text-xs uppercase text-gray-400",children:"Total Sent Balance"}),n.jsxs("p",{className:"text-xl font-bold text-green-700",children:["",is.toLocaleString()]})]})]})]}),n.jsx("div",{className:"overflow-x-auto",children:n.jsxs("table",{className:"w-full text-sm",children:[n.jsx("thead",{className:"bg-amber-50 text-amber-800",children:n.jsxs("tr",{children:[n.jsx("th",{className:"p-2 text-left",children:"Case / Lawyer"}),n.jsx("th",{className:"p-2 text-left",children:"Status"}),n.jsx("th",{className:"p-2 text-right",children:"Total Balance ()"}),n.jsx("th",{className:"p-2 text-right",children:"Action"})]})}),n.jsxs("tbody",{className:"divide-y",children:[Me.length===0&&n.jsx("tr",{children:n.jsx("td",{colSpan:4,className:"p-4 text-center text-gray-400",children:"No expense reports yet."})}),Me.map(I=>n.jsxs("tr",{className:"hover:bg-amber-50 transition",children:[n.jsxs("td",{className:"p-2",children:[n.jsx("div",{className:"font-semibold text-textLight",children:I.insuredName||"Unnamed Case"}),n.jsxs("div",{className:"text-xs text-textMuted",children:["Lawyer: ",I.ownerName]})]}),n.jsx("td",{className:"p-2",children:n.jsx("span",{className:`px-2 py-1 rounded-full text-[10px] font-bold uppercase tracking-wide shadow-sm border ${he(I.status)}`,children:lt(I.status)})}),n.jsxs("td",{className:"p-2 text-right font-bold",children:["",Hp(I).toLocaleString()]}),n.jsx("td",{className:"p-2 text-right",children:n.jsx("button",{onClick:()=>s(I.id),className:"text-lpBlue hover:underline text-xs font-bold",children:"Open"})})]},`expense-${I.id}`))]})]})})]}),!C&&ce.length>0&&n.jsx("div",{className:"space-y-6 mb-8",children:ce.map(I=>n.jsxs("div",{className:"bg-panel border rounded-2xl shadow-sm",children:[n.jsx("div",{className:"flex flex-wrap justify-between items-center gap-3 px-4 py-3 border-b",children:n.jsxs("div",{children:[n.jsx("h3",{className:"font-bold text-textLight",children:I.title}),n.jsx("p",{className:"text-sm text-textMuted",children:I.subtitle})]})}),I.items.length===0?n.jsx("div",{className:"p-6 text-center text-gray-400 text-sm",children:I.empty}):n.jsx("div",{className:"p-4 space-y-3",children:I.items.map(we=>{var Fe;if(I.id==="sent"){const et=we,jn=et.sentAt?new Date(et.sentAt).toLocaleDateString("he-IL"):"",En=et.isLatest&&et.parent.status==="SENT"&&typeof y=="function",fa=et.isLatest&&et.parent.status!=="SENT";return n.jsxs("div",{className:`border ${I.tone} rounded-xl p-4`,children:[n.jsxs("div",{className:"grid md:grid-cols-4 gap-4 text-sm text-textMuted",children:[n.jsxs("div",{children:[n.jsx("p",{className:"text-xs uppercase text-gray-400",children:" "}),n.jsx("p",{className:"font-bold text-textLight",children:et.parent.odakanitNo||""})]}),n.jsxs("div",{children:[n.jsx("p",{className:"text-xs uppercase text-gray-400",children:" "}),n.jsx("p",{className:"font-bold text-textLight",children:et.parent.insuredName||""})]}),n.jsxs("div",{children:[n.jsx("p",{className:"text-xs uppercase text-gray-400",children:et.parent.plaintiffTitle}),n.jsx("p",{className:"font-bold text-textLight",children:et.parent.plaintiffName||""})]}),n.jsxs("div",{children:[n.jsxs("p",{className:"text-xs uppercase text-gray-400",children:[" #",et.reportNumber]}),n.jsx("p",{className:"font-bold text-textLight",children:jn})]})]}),n.jsxs("div",{className:"mt-2 text-sm text-textMuted space-y-1",children:[n.jsxs("p",{children:[n.jsx("span",{className:"font-semibold text-textLight",children:":"})," ",et.entry.subject||""]}),et.entry.fileName&&n.jsxs("p",{className:"text-xs text-textMuted",children:[" : ",et.entry.fileName]})]}),n.jsxs("div",{className:"mt-3 flex flex-wrap gap-2 justify-end",children:[En&&y&&n.jsx("button",{onClick:()=>y(et.parent.id),className:"px-4 py-2 rounded-full bg-navy text-white text-sm font-semibold hover:bg-navySecondary",children:'" '}),fa&&n.jsx("span",{className:"text-xs text-textMuted font-semibold px-3 py-1 rounded-full bg-navySecondary",children:'"  '})]})]},`${et.parent.id}-${et.entry.id}`)}const De=we,Le=typeof De.reportNumber=="number"&&De.reportNumber>0?De.reportNumber:(((Fe=De.reportHistory)==null?void 0:Fe.length)||0)+1;return n.jsxs("div",{className:`border ${I.tone} rounded-xl p-4`,children:[n.jsxs("div",{className:"grid md:grid-cols-4 gap-4 text-sm text-textMuted",children:[n.jsxs("div",{children:[n.jsx("p",{className:"text-xs uppercase text-gray-400",children:" "}),n.jsx("p",{className:"font-bold text-textLight",children:De.odakanitNo||""})]}),n.jsxs("div",{children:[n.jsx("p",{className:"text-xs uppercase text-gray-400",children:" "}),n.jsx("p",{className:"font-bold text-textLight",children:De.plaintiffName||""})]}),n.jsxs("div",{children:[n.jsx("p",{className:"text-xs uppercase text-gray-400",children:" "}),n.jsx("p",{className:"font-bold text-textLight",children:De.insuredName||""})]}),n.jsxs("div",{children:[n.jsx("p",{className:"text-xs uppercase text-gray-400",children:" "}),n.jsxs("p",{className:"font-bold text-textLight",children:["#",Le]})]})]}),I.id==="followup"&&n.jsx("div",{className:"mt-2 text-xs text-textMuted",children:(()=>{var En;const et=(En=De.reportHistory)==null?void 0:En[De.reportHistory.length-1],jn=et!=null&&et.date?new Date(et.date).toLocaleDateString("he-IL"):De.sentAt?new Date(De.sentAt).toLocaleDateString("he-IL"):"";return`"  : #${(et==null?void 0:et.reportNumber)||Le-1}  ${jn}`})()}),n.jsxs("div",{className:"mt-3 flex flex-wrap gap-2 justify-end",children:[I.id==="finance"&&ms(De)&&n.jsxs("button",{onClick:()=>Ds(De),className:"px-3 py-2 rounded-full border border-red-200 text-red-600 text-sm font-semibold flex items-center gap-1 hover:bg-red-50",title:"  ",children:[n.jsx($s,{className:"w-4 h-4"}),""]}),I.action&&n.jsx("button",{onClick:()=>I.action&&I.action(De),className:"px-4 py-2 rounded-full bg-navy text-white text-sm font-semibold hover:bg-navySecondary",children:I.actionLabel})]})]},De.id)})})]},I.id))}),C&&n.jsxs("div",{className:"mb-8",children:[n.jsx("div",{className:"flex justify-between items-end mb-4",children:n.jsxs("h3",{className:"text-lg font-bold text-textLight flex items-center",children:[n.jsx(lh,{className:"w-6 h-6 mr-2 text-indigo-600"})," Active Case Folders"]})}),n.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[ne.length===0&&n.jsx("p",{className:"text-gray-400 italic col-span-3 text-center py-4",children:"No active finance folders."}),ne.map(I=>{var Le;const we=(()=>{switch(I.status){case"WAITING_FOR_INVOICES":return{badge:"bg-yellow-50 text-yellow-700",text:"Awaiting Finance Finalize",icon:n.jsx(Lt,{className:"text-yellow-500 w-5 h-5 animate-spin"})};case"TASK_ASSIGNED":return{badge:"bg-blue-50 text-blue-700",text:"Pending Lawyer Action",icon:n.jsx(ah,{className:"text-blue-500 w-5 h-5"})};case"READY_TO_SEND":return{badge:"bg-orange-50 text-orange-700",text:"Waiting for Lior",icon:n.jsx(Lt,{className:"text-orange-500 w-5 h-5 animate-spin"})};case"SENT":return{badge:"bg-green-50 text-green-700",text:"Completed",icon:n.jsx(oh,{className:"text-green-500 w-6 h-6"})};default:return{badge:"bg-navySecondary text-textMuted",text:I.status,icon:n.jsx(Lt,{className:"text-gray-400 w-5 h-5 animate-spin"})}}})(),De=(Le=vs.find(Fe=>Fe.id===I.createdBy))==null?void 0:Le.name;return n.jsxs("div",{className:"bg-panel p-4 rounded-lg shadow border-t-4 relative border-indigo-100",children:[n.jsxs("div",{className:"flex justify-between items-start mb-2",children:[n.jsxs("h4",{className:"font-bold text-lg",children:["Case #",I.odakanitNo]}),we.icon]}),n.jsxs("div",{className:"text-sm text-textMuted mb-1 flex items-center",children:[n.jsx(H0,{className:"w-4 h-4 mr-1"})," Assigned to: ",De]}),n.jsx("div",{className:"text-xs text-textMuted mb-4",children:new Date(I.reportDate).toLocaleDateString()}),n.jsx("div",{className:"flex justify-end gap-2 mt-2",children:I.status==="SENT"?n.jsxs("button",{onClick:()=>l(I.id),className:"text-red-500 hover:bg-red-50 px-3 py-1 rounded text-sm flex items-center",children:[n.jsx($s,{className:"w-4 h-4 mr-1"})," Delete Folder"]}):n.jsx("span",{className:`text-xs font-bold px-2 py-1 rounded ${we.badge}`,children:we.text})})]},I.id)})]})]}),(C||Qe)&&n.jsxs("div",{className:"bg-panel rounded-xl shadow-sm border border-borderDark overflow-hidden",children:[n.jsxs("div",{className:"p-4 border-b border-gray-100 bg-navySecondary/50 flex flex-wrap gap-3 items-center justify-between",children:[n.jsxs("h3",{className:"font-bold text-textLight flex items-center",children:[n.jsx(ih,{className:"w-4 h-4 mr-2 text-gray-400"})," ",ue?"Recycle Bin":"All Reports"]}),n.jsxs("div",{className:"flex items-center gap-3 flex-wrap justify-end",children:[ue&&rt&&n.jsx("span",{className:"text-xs text-textMuted",children:rt}),n.jsxs("div",{className:"relative w-full sm:w-72",children:[n.jsx(P0,{className:"w-4 h-4 text-gray-400 absolute left-3 top-1/2 -translate-y-1/2"}),n.jsx("input",{value:ze,onChange:I=>qe(I.target.value),placeholder:"     ",className:"w-full border border-borderDark rounded-full pl-9 pr-10 py-1.5 text-sm focus:ring-2 focus:ring-blue-200 outline-none"}),ze&&n.jsx("button",{onClick:()=>qe(""),className:"absolute right-3 top-1/2 -translate-y-1/2 text-gray-400 hover:text-red-500",children:n.jsx(Ot,{className:"w-4 h-4"})})]})]})]}),Qe?n.jsxs("table",{className:"w-full text-left",children:[n.jsx("thead",{className:"bg-navySecondary text-textMuted text-xs uppercase tracking-wider font-semibold",children:n.jsxs("tr",{children:[n.jsx("th",{className:"p-4",children:"Insurer / Subject"}),C&&n.jsx("th",{className:"p-4",children:"Lawyer"}),n.jsx("th",{className:"p-4",children:"Status"}),n.jsx("th",{className:"p-4 text-right",children:"Action"})]})}),n.jsxs("tbody",{className:"divide-y divide-gray-100",children:[us.length===0&&n.jsx("tr",{children:n.jsx("td",{colSpan:C?4:3,className:"p-6 text-center text-gray-400 text-sm",children:Yn?"    .":"  ."})}),us.map(I=>{const we=I.status==="READY_TO_SEND",De=I.status==="SENT",Le=!!I.__templateKey;return n.jsxs("tr",{className:`transition cursor-default ${we?"bg-red-50":De?"bg-green-50/50":"hover:bg-blue-50/30"}`,children:[n.jsxs("td",{className:"p-4",children:[n.jsx("div",{className:"font-bold text-textLight",children:I.insurerName||"Untitled"}),n.jsxs("div",{className:"text-xs text-textMuted",children:[I.marketRef," ",I.insuredName?` - ${I.insuredName}`:""]})]}),C&&n.jsx("td",{className:"p-4 text-sm text-textMuted font-medium",children:I.ownerName}),n.jsx("td",{className:"p-4",children:n.jsx("span",{className:`px-2.5 py-1 rounded-full text-[10px] font-bold uppercase tracking-wide shadow-sm border ${he(I.status)}`,children:lt(I.status)})}),n.jsx("td",{className:"p-4 text-right",children:n.jsxs("div",{className:"flex justify-end gap-2 flex-wrap",children:[n.jsxs(n.Fragment,{children:[n.jsxs("button",{onClick:()=>U(I.id),className:"text-xs bg-navySecondary hover:bg-borderDark px-3 py-1.5 rounded flex items-center gap-1",children:[n.jsx(uh,{className:"w-3 h-3"})," View Expenses"]}),n.jsxs("button",{onClick:()=>N(I),className:"text-xs bg-blue-50 text-blue-700 hover:bg-blue-100 px-3 py-1.5 rounded flex items-center gap-1",children:[n.jsx(Jl,{className:"w-3 h-3"})," Reminder"]}),n.jsxs("button",{onClick:()=>x(I),className:"text-xs bg-purple-50 text-purple-700 hover:bg-purple-100 px-3 py-1.5 rounded flex items-center gap-1",children:[n.jsx(Lu,{className:"w-3 h-3"})," Add Note"]})]}),se&&!Je&&!ue&&n.jsxs("button",{onClick:()=>!Le&&b(I.id),disabled:Le,className:`text-xs px-3 py-1.5 rounded flex items-center gap-1 ${Le?"bg-navySecondary text-gray-400 cursor-not-allowed":"bg-red-50 text-red-700 hover:bg-red-100"}`,children:[n.jsx($s,{className:"w-3 h-3"})," Delete"]}),ue&&n.jsxs(n.Fragment,{children:[Je&&n.jsx("button",{onClick:()=>o(I.id,{sentAt:new Date().toISOString()}),className:"text-green-600 hover:bg-green-50 px-3 py-1.5 rounded text-sm font-bold",children:"Restore"}),!Je&&se&&n.jsx("button",{onClick:()=>F(I.id),className:"text-green-600 hover:bg-green-50 px-3 py-1.5 rounded text-sm font-bold",children:"Restore"})]})]})})]},I.id)})]})]}):n.jsx("div",{children:Mn.length===0?n.jsx("div",{className:"p-6 text-center text-gray-400 text-sm",children:Yn?"    .":"  ."}):n.jsx("div",{className:"divide-y divide-gray-100",children:Mn.map(I=>{const we=I.latestDate?new Date(I.latestDate).toLocaleDateString("he-IL"):"-",De=[...I.reports].sort((Le,Fe)=>{const et=Le.reportDate?new Date(Le.reportDate).getTime():0;return(Fe.reportDate?new Date(Fe.reportDate).getTime():0)-et});return n.jsxs("div",{className:"p-4",children:[n.jsxs("div",{className:"flex flex-wrap justify-between gap-3",children:[n.jsxs("div",{children:[n.jsx("p",{className:"text-xs uppercase text-gray-400",children:" "}),n.jsx("p",{className:"text-xl font-bold text-textLight",children:I.odakanitNo||""}),n.jsxs("p",{className:"text-xs text-textMuted",children:[" : ",n.jsx("span",{className:"font-semibold",children:I.plaintiffName||""}),"   : ",n.jsx("span",{className:"font-semibold",children:I.insuredName||""})]}),n.jsxs("p",{className:"text-xs text-gray-400",children:[" : ",we]})]}),n.jsxs("div",{className:"text-right",children:[n.jsx("p",{className:"text-xs text-textMuted",children:'" '}),n.jsx("p",{className:"text-2xl font-bold text-textLight",children:I.reports.length}),n.jsx("button",{onClick:()=>st(Le=>Le===I.key?null:I.key),className:"mt-2 px-4 py-1.5 text-sm font-semibold rounded-full border border-borderDark text-textLight hover:bg-navySecondary",children:$e===I.key?" ":" "})]})]}),$e===I.key&&n.jsx("div",{className:"mt-4 bg-navySecondary border border-borderDark rounded-xl overflow-hidden",children:n.jsxs("table",{className:"w-full text-sm",children:[n.jsx("thead",{className:"bg-navySecondary text-textMuted text-xs uppercase tracking-wide",children:n.jsxs("tr",{children:[n.jsx("th",{className:"p-3 text-left",children:" "}),n.jsx("th",{className:"p-3 text-left",children:" "}),n.jsx("th",{className:"p-3 text-left",children:" "}),n.jsx("th",{className:"p-3 text-left",children:""}),n.jsx("th",{className:"p-3 text-right",children:""})]})}),n.jsx("tbody",{className:"divide-y divide-gray-200",children:De.map(Le=>{const Fe=Le.status==="READY_TO_SEND",et=Le.status==="SENT",jn=!!Le.__templateKey;return n.jsxs("tr",{className:`bg-panel ${Fe?"bg-red-50":et?"bg-green-50/60":""}`,children:[n.jsx("td",{className:"p-3",children:Le.reportDate?new Date(Le.reportDate).toLocaleDateString("he-IL"):""}),n.jsx("td",{className:"p-3",children:Le.plaintiffName||""}),n.jsx("td",{className:"p-3",children:Le.insuredName||""}),n.jsx("td",{className:"p-3",children:n.jsx("span",{className:`px-2.5 py-1 rounded-full text-[10px] font-bold uppercase tracking-wide shadow-sm border ${he(Le.status)}`,children:lt(Le.status)})}),n.jsx("td",{className:"p-3 text-right",children:n.jsxs("div",{className:"flex justify-end gap-2 flex-wrap",children:[n.jsxs("button",{onClick:()=>s(Le.id),className:"text-lpBlue hover:bg-blue-50 px-3 py-1.5 rounded transition font-bold text-xs flex items-center",children:["Open ",n.jsx(ts,{className:"w-3 h-3 ml-1"})]}),se&&!Je&&!ue&&n.jsxs("button",{onClick:()=>!jn&&b(Le.id),disabled:jn,className:`text-xs px-3 py-1.5 rounded flex items-center gap-1 ${jn?"bg-navySecondary text-gray-400 cursor-not-allowed":"bg-red-50 text-red-700 hover:bg-red-100"}`,children:[n.jsx($s,{className:"w-3 h-3"})," Delete"]}),ue&&n.jsxs(n.Fragment,{children:[Je&&n.jsx("button",{onClick:()=>o(Le.id,{sentAt:new Date().toISOString()}),className:"text-green-600 hover:bg-green-50 px-3 py-1.5 rounded text-xs font-bold",children:"Restore"}),!Je&&se&&n.jsx("button",{onClick:()=>F(Le.id),className:"text-green-600 hover:bg-green-50 px-3 py-1.5 rounded text-xs font-bold",children:"Restore"})]})]})})]},Le.id)})})]})})]},I.key)})})})]}),!C&&n.jsx("div",{className:"fixed bottom-8 right-8",children:n.jsx("button",{onClick:r,className:"bg-navy text-white p-4 rounded-full shadow-xl hover:bg-navySecondary transition transform hover:scale-110",children:n.jsx(C0,{className:"w-6 h-6"})})})]})]})},Pv=({onLogin:e})=>{const[t,s]=g.useState(""),[r,a]=g.useState(""),[o,l]=g.useState(!1),c=async()=>{if(!t||!r){alert("    .");return}l(!0);try{const i=await fetch("/api/login",{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({username:t,password:r})});if(!i.ok){const p=await i.json().catch(()=>({})),y=(p==null?void 0:p.error)||"    .";alert(y);return}const u=await i.json();u&&u.user?e(u.user):alert("Login response was invalid.")}catch(i){console.error("Login failed",i),alert("  (  ?).  .")}finally{l(!1)}};return n.jsx("div",{className:"min-h-screen flex items-center justify-center px-4 bg-bgDark",children:n.jsxs("div",{className:"w-full max-w-sm bg-panel border border-borderDark rounded-2xl p-10 text-center shadow-2xl",children:[n.jsx("div",{className:"mx-auto mb-6 h-20 w-20 rounded-full bg-gold/20 border border-gold flex items-center justify-center text-4xl font-bold text-gold shadow-lg",children:"LP"}),n.jsx("div",{className:"text-sm tracking-[0.5em] text-gold uppercase mb-2",children:"Lloyd's"}),n.jsx("div",{className:"text-3xl font-serif text-textLight mb-1",children:"REPORT"}),n.jsx("div",{className:"text-xs text-textMuted uppercase tracking-[0.4em] mb-8",children:"Builder System"}),n.jsxs("div",{className:"space-y-4 text-left",children:[n.jsx("label",{className:"text-xs uppercase text-textMuted tracking-[0.2em]",children:"Username"}),n.jsxs("div",{className:"relative",children:[n.jsx(U0,{className:"w-4 h-4 text-gold absolute left-3 top-1/2 -translate-y-1/2"}),n.jsx("input",{className:"w-full bg-navy border border-borderDark rounded-full py-3 pl-10 pr-4 text-textLight placeholder-textMuted focus:outline-none focus:ring-2 focus:ring-gold/50",placeholder:"Username",value:t,onChange:i=>s(i.target.value)})]}),n.jsx("label",{className:"text-xs uppercase text-textMuted tracking-[0.2em]",children:"Password"}),n.jsxs("div",{className:"relative",children:[n.jsx(_0,{className:"w-4 h-4 text-gold absolute left-3 top-1/2 -translate-y-1/2"}),n.jsx("input",{type:"password",className:"w-full bg-navy border border-borderDark rounded-full py-3 pl-10 pr-4 text-textLight placeholder-textMuted focus:outline-none focus:ring-2 focus:ring-gold/50",placeholder:"Password",value:r,onChange:i=>a(i.target.value)})]})]}),n.jsxs("button",{onClick:c,disabled:o,className:"mt-8 w-full bg-navy text-gold border border-gold py-3 rounded-full font-semibold tracking-wide flex items-center justify-center gap-2 hover:bg-navySecondary transition-colors disabled:opacity-60 disabled:cursor-not-allowed",children:[o?"Signing in":"Sign In"," ",n.jsx(ah,{className:"w-4 h-4"})]}),n.jsx("div",{className:"mt-6 text-[11px] text-textMuted tracking-[0.3em] uppercase",children:"Lior Perry Law Office & Notary  2024"})]})})},Fv=()=>{var Z,me;const[e,t]=g.useState(null),[s,r]=g.useState(!1),[a,o]=g.useState(()=>Iv()),[l,c]=g.useState(()=>Av()),[i,u]=g.useState(null),p=g.useRef(l),y=g.useRef(i),[S,w]=g.useState(null);console.log("AppInner render",{currentUser:e,view:a,reportsCount:l.length});const L=g.useRef(!1),[k,U]=g.useState(null),[N,x]=g.useState([]),[b,F]=g.useState(!1);e==null||e.role;const[H,V]=g.useState(()=>{if(typeof window>"u")return[];try{const d=window.localStorage.getItem(ct.NOTIFICATIONS),m=d?JSON.parse(d):[];return Array.isArray(m)?m.filter(h=>h&&typeof h.id=="string"&&typeof h.message=="string"&&typeof h.createdAt=="string"):[]}catch{return[]}}),[q,te]=g.useState(!1),[G,le]=g.useState(!1),[j,T]=g.useState([]),[E,C]=g.useState(null),[se,Y]=g.useState(()=>{if(typeof window>"u")return{};try{const d=localStorage.getItem("favoriteProviders");return d?JSON.parse(d):{}}catch(d){return console.error("Failed to load favorite providers",d),{}}});g.useEffect(()=>{let d=!1;return fetch("/api/me",{credentials:"include"}).then(m=>m.ok?m.json():null).then(m=>{!d&&(m!=null&&m.user)&&t(m.user)}).catch(()=>{}).finally(()=>{d||r(!0)}),()=>{d=!0}},[]),g.useEffect(()=>{if(!(typeof window>"u"))try{window.localStorage.setItem(ct.NOTIFICATIONS,JSON.stringify(H))}catch{}},[H]);const[O,P]=g.useState(null),[X,ue]=g.useState(""),[xe,oe]=g.useState(null),[fe,ve]=g.useState(""),[_e,ze]=g.useState("LAWYER"),[qe,$e]=g.useState(!1),[st,Je]=g.useState(!1),[J,re]=g.useState(!1),[D,ae]=g.useState(!1),[ee,be]=g.useState(!1),[Oe,Ae]=g.useState(!1),[Re,Ge]=g.useState(!1),[He,Pe]=g.useState(!1),[Q,ye]=g.useState(!1),[_,W]=g.useState(null),[de,ce]=g.useState(null),[ne,ge]=g.useState(()=>{if(typeof window>"u")return[];try{const d=localStorage.getItem("caseTemplates");return d?JSON.parse(d):[]}catch(d){return console.error("Failed to load case templates",d),[]}}),[Se,Ee]=g.useState(null),[Me,Qe]=g.useState(""),[Nt,rt]=g.useState(!1),[Yt,Ht]=g.useState(null),[ls,is]=g.useState(void 0);g.useEffect(()=>{if(!i&&S!==null){w(null);return}i&&S&&i.id!==S&&w(null)},[i,S]),g.useEffect(()=>{typeof window>"u"||tv()||l.length&&lt(d=>{const m=Oc(d,l);return kn(m),ev(),m})},[l]);const[he,lt]=g.useState(()=>{const d=Qb(),m=Zb(d);return m!==d&&kn(m),m}),cs=g.useRef(he);g.useEffect(()=>{p.current=l,y.current=i,cs.current=he},[l,i,he]),g.useEffect(()=>{if(typeof window>"u"||!e)return;const d=m=>{const h=p.current,A=y.current;if(cs.current,h&&A){const v=[...h],M=v.findIndex(B=>B.id===A.id),$=M>=0?{...v[M],...A}:A;M>=0?v[M]=$:v.push($);try{localStorage.setItem(ct.REPORTS,JSON.stringify(v))}catch(B){console.error("beforeunload save failed",B)}}(h!=null&&h.length||A)&&(m.preventDefault(),m.returnValue="")};return window.addEventListener("beforeunload",d),()=>window.removeEventListener("beforeunload",d)},[e]),g.useEffect(()=>{a!=="PREVIEW"&&F(!1)},[a]);const Rs=d=>d?d==="SUB_ADMIN"?"OPS":d==="FINANCE"||d==="LAWYER"||d==="ADMIN"?d:"LAWYER":"LAWYER",ut=d=>d.deletedAt?Date.now()-new Date(d.deletedAt).getTime()>=$h:d.status==="SENT"&&d.sentAt?Date.now()-new Date(d.sentAt).getTime()>=Bh:!1;g.useEffect(()=>{const d=()=>{c(h=>h.filter(A=>!ut(A)))};d();const m=setInterval(d,60*60*1e3);return()=>clearInterval(m)},[]),g.useEffect(()=>{if(!G)return;const d=setInterval(()=>{if(!l.length)return;const m=l.filter(v=>v.status==="READY_TO_SEND").length,h=l.filter(v=>v.status==="SENT").length,A=`Daily summary: ${m} ready to send, ${h} sent reports.`;V(v=>[{id:`daily-${Date.now()}`,message:A,createdAt:new Date().toISOString(),severity:"info"},...v])},1e3*60*60*12);return()=>clearInterval(d)},[G,l]),g.useEffect(()=>{try{localStorage.setItem("caseTemplates",JSON.stringify(ne))}catch(d){console.error("Failed to persist case templates",d)}},[ne]),g.useEffect(()=>{try{localStorage.setItem("favoriteProviders",JSON.stringify(se))}catch(d){console.error("Failed to persist favorites",d)}},[se]);const Kn=async d=>{if(!e||!i){Pe(!0),W(null),ce({title:"   ",bullets:["           .","  ,         .","  ,          ."]});return}const m=a==="STEP2"?2:a==="PREVIEW"?3:1,h=a==="STEP1"?"Step1":a==="STEP2"?"Step2Draft":a==="PREVIEW"?"Step3Preview":"Dashboard",A={step:m,role:Rs(e.role),screen:h,section:m===2&&ls?ls:void 0},v={hebrewApproved:i.hebrewWorkflowStatus==="HEBREW_APPROVED",hasTranslation:!!i.isTranslated,translationOutdated:!!i.translationStale,toneRiskRun:!!i.toneRiskLastRunAt,expensesLastUpdatedAt:i.expensesSnapshotAt||void 0};Pe(!0),ye(!0),W(null);try{const M=await Z0({intent:d,context:A,reportMeta:v});ce(M)}catch(M){console.error("Smart assistant request failed",M),W("REQUEST_FAILED"),ce(null)}finally{ye(!1)}},ds=(d,m)=>{if(!d||!m)return[];const h=[];d.translationStale&&h.push({id:"translation-outdated",kind:"TRANSLATION_OUTDATED",label:"       (translationStale=true).     .",intent:"pre_send_checks"});const A=m.role;return(A==="LAWYER"||A==="ADMIN")&&!d.toneRiskLastRunAt&&h.push({id:"tone-risk-not-run",kind:"TONE_RISK_NOT_RUN",label:"   Tone & Risk  .       .",intent:"explain_tone_risk"}),h};g.useEffect(()=>{let d=!1;return(async()=>{var M;if(typeof window>"u")return;const h=l.filter($=>!!$.expensesSheetId&&!$.expensesHtml&&!$.expensesHtmlMissing);if(!h.length)return;let A=!1;const v=[...l];for(const $ of h)try{const B=await Ye.getSheet($.expensesSheetId);if(B&&B.sheet&&((M=B.lineItems)!=null&&M.length)){const K=Ye.buildCumulativeExpensesSnapshot(B.sheet.id,new Date().toISOString());if(!K)continue;const{effectiveSheet:ie,allLines:je,opts:Ne}=K,{html:Ue}=ri(ie,je,Ne);if(Ue){const We=v.findIndex(Ve=>Ve.id===$.id);We!==-1&&(v[We]={...v[We],expensesHtml:Ue},A=!0)}}else{const K=v.findIndex(ie=>ie.id===$.id);K!==-1&&(v[K]={...v[K],expensesHtmlMissing:!0},A=!0)}}catch(B){console.error("Failed to migrate expensesHtml for report",$.id,B);const K=v.findIndex(ie=>ie.id===$.id);K!==-1&&(v[K]={...v[K],expensesHtmlMissing:!0},A=!0)}!d&&A&&c(v)})(),()=>{d=!0}},[l]),g.useEffect(()=>{if(!(typeof window>"u"))try{localStorage.setItem(ct.REPORTS,JSON.stringify(l))}catch(d){console.error("Failed to persist reports",d)}},[l]),g.useEffect(()=>{typeof window>"u"||(e?localStorage.setItem(ct.USER,e.username):localStorage.removeItem(ct.USER))},[e]),g.useEffect(()=>{typeof window>"u"||localStorage.setItem(ct.VIEW,a)},[a]),g.useEffect(()=>{typeof window>"u"||(i?localStorage.setItem(ct.CURRENT_REPORT,i.id):localStorage.removeItem(ct.CURRENT_REPORT))},[i]),g.useEffect(()=>{if(typeof window>"u"||L.current)return;const d=localStorage.getItem(ct.CURRENT_REPORT);if(!d){L.current=!0;return}const m=l.find(h=>h.id===d);if(m){const h=!!(m.expensesSheetId||m.expensesHtml);let A=m;if(h&&Array.isArray(m.selectedSections)&&!m.selectedSections.some(v=>Jr(v))){const v=[...m.selectedSections],M=v.includes("Update"),$=v.includes("Recommendations"),B=M?Math.min(v.indexOf("Update")+1,$?v.indexOf("Recommendations"):v.length):0;v.splice(B,0,Xa),A={...m,selectedSections:Array.from(new Set(v))}}u(A)}L.current=!0},[l,e]),g.useEffect(()=>{a==="DASHBOARD"||a==="CASE_FOLDER"||i||(o("DASHBOARD"),typeof window<"u"&&(localStorage.setItem(ct.VIEW,"DASHBOARD"),localStorage.removeItem(ct.CURRENT_REPORT)))},[i,a]);const wn=()=>({id:Date.now().toString(),createdBy:e.id,ownerName:e.name,ownerEmail:e.email,reportNumber:1,reportDate:new Date().toISOString(),updatedAt:new Date().toISOString(),status:"DRAFT",reportSubject:"",recipientId:"1",insurerName:"",lineSlipNo:"",marketRef:"",certificateRef:"",insuredName:"",plaintiffName:"",plaintiffTitle:"Plaintiff",policyPeriodStart:"",policyPeriodEnd:"",retroStart:"",retroEnd:"",sentAt:void 0,reportHistory:[],selectedTimeline:"standard",filenameTag:fh[0],selectedSections:["Update","Recommendations"],content:{},translatedContent:{},invoiceFiles:[],isWaitingForInvoices:!1,requiresExpenses:!1,isTranslated:!1,expensesItems:[],expenseWorksheet:Ps(),reportNotes:[],complaintAnalysis:void 0,attachPolicyAsAppendix:!0}),sr=({odakanitNo:d,reports:m,caseFolder:h})=>{var $;const A=ke(d);if(!A)return 1;const v=[];return($=h==null?void 0:h.sentReports)!=null&&$.length&&h.sentReports.forEach(B=>{typeof B.reportNo=="number"&&B.reportNo>0&&v.push(B.reportNo)}),m.forEach(B=>{var K;if(ke(B.odakanitNo)===A&&B.status==="SENT")if(typeof B.reportNumber=="number"&&B.reportNumber>0)v.push(B.reportNumber);else{const ie=(((K=B.reportHistory)==null?void 0:K.length)||0)+1;v.push(ie)}}),(v.length?Math.max(...v):0)+1},Yn=d=>{const m=d.createdBy||"unknown",h=d.odakanitNo||d.marketRef||d.id,A=(d.plaintiffName||"unknown").toLowerCase();return`${m}::${h}::${A}`},Cs=d=>{const m=Yn(d),h={caseKey:m,ownerId:d.createdBy,ownerName:d.ownerName,odakanitNo:d.odakanitNo,plaintiffName:d.plaintiffName,plaintiffTitle:d.plaintiffTitle,insurerName:d.insurerName,lineSlipNo:d.lineSlipNo,marketRef:d.marketRef,certificateRef:d.certificateRef,insuredName:d.insuredName,policyPeriodStart:d.policyPeriodStart,policyPeriodEnd:d.policyPeriodEnd,retroStart:d.retroStart,retroEnd:d.retroEnd,lastUpdated:new Date().toISOString()};ge(A=>A.find(M=>M.caseKey===m)?A.map(M=>M.caseKey===m?h:M):[...A,h])},us=d=>{if(!e)return;const m=ne.find(A=>A.caseKey===d&&A.ownerId===e.id);if(!m)return;const h={...wn(),odakanitNo:m.odakanitNo||"",insurerName:m.insurerName||"",lineSlipNo:m.lineSlipNo||"",marketRef:m.marketRef||"",certificateRef:m.certificateRef||"",insuredName:m.insuredName||"",plaintiffName:m.plaintiffName||"",plaintiffTitle:m.plaintiffTitle||"Plaintiff",policyPeriodStart:m.policyPeriodStart||"",policyPeriodEnd:m.policyPeriodEnd||"",retroStart:m.retroStart||"",retroEnd:m.retroEnd||""};u(h),o("STEP1")},Mn=d=>{var ie;if(!e)return;const m=ms(d);if(!m||m.createdBy!==e.id||(((ie=m.reportHistory)==null?void 0:ie.length)||0)===0||m.status!=="SENT")return;const h=m.reportHistory[m.reportHistory.length-1];if(!h)return;const v=h.snapshot||m,M=v.selectedSections&&v.selectedSections.length?[...v.selectedSections]:[...m.selectedSections||[]],$=M.length?M:["Update","Recommendations"],B=new Date().toISOString(),K={...m,reportDate:B,updatedAt:B,status:"DRAFT",sentAt:void 0,reportNotes:[],content:{},translatedContent:{},executiveSummary:void 0,complaintAnalysis:void 0,expensesItems:[],expensesSum:void 0,paymentRecommendation:void 0,expenseWorksheet:Ps(),invoiceFiles:[],expensesSourceFile:void 0,requiresExpenses:!1,isWaitingForInvoices:!1,isTranslated:!1,selectedEmailTemplate:void 0,emailBodyDraft:void 0,fileNameTitles:[],deletedAt:void 0,deletedBy:void 0,selectedSections:$,reportHistory:[...m.reportHistory||[]]};K.insurerName=v.insurerName||"",K.lineSlipNo=v.lineSlipNo||"",K.marketRef=v.marketRef||"",K.certificateRef=v.certificateRef||"",K.insuredName=v.insuredName||"",K.plaintiffName=v.plaintiffName||"",K.plaintiffTitle=v.plaintiffTitle||m.plaintiffTitle,K.policyPeriodStart=v.policyPeriodStart||"",K.policyPeriodEnd=v.policyPeriodEnd||"",K.retroStart=v.retroStart||"",K.retroEnd=v.retroEnd||"",K.filenameTag=v.filenameTag||K.filenameTag,K.fileNameTitles=[],K.selectedTimeline=v.selectedTimeline||K.selectedTimeline,K.selectedTimelineImage=v.selectedTimelineImage,K.odakanitNo=v.odakanitNo||m.odakanitNo,K.recipientId=v.recipientId||m.recipientId,c(je=>je.map(Ne=>Ne.id===m.id?K:Ne)),u(K),Cs(K),o("STEP1")},ms=d=>l.find(m=>m.id===d),Ds=(d,m)=>{if(d.status!==m.status||d.hebrewWorkflowStatus!==m.hebrewWorkflowStatus||d.insuredName!==m.insuredName||d.plaintiffName!==m.plaintiffName||d.insurerName!==m.insurerName||d.odakanitNo!==m.odakanitNo||d.marketRef!==m.marketRef||d.lineSlipNo!==m.lineSlipNo||d.certificateRef!==m.certificateRef||d.policyPeriodStart!==m.policyPeriodStart||d.policyPeriodEnd!==m.policyPeriodEnd||d.retroStart!==m.retroStart||d.retroEnd!==m.retroEnd||d.reportSubject!==m.reportSubject||d.executiveSummary!==m.executiveSummary)return!0;const h=(A,v)=>JSON.stringify(A)===JSON.stringify(v);return!h(d.content,m.content)||!h(d.translatedContent,m.translatedContent)||!h(d.expenseWorksheet,m.expenseWorksheet)||!h(d.expensesItems,m.expensesItems)||d.expensesSum!==m.expensesSum||d.paymentRecommendation!==m.paymentRecommendation||!h(d.complaintAnalysis,m.complaintAnalysis)||!h(d.reportReview,m.reportReview)},I=(d,m)=>{d.odakanitNo&&lt(h=>{const A=Od(h,d,m);return kn(A),A})},we=(d,m,h,A)=>{d.odakanitNo&&lt(v=>{const M=Ph(v,d,m,h,A);return kn(M),M})},De=d=>{var h;return(h=d==null?void 0:d.sentReports)!=null&&h.length?d.sentReports.map((A,v)=>{var K,ie;const M=typeof A.reportNo=="number"&&A.reportNo>0?A.reportNo:v+1,$=A.sentAt||((K=A.snapshot)==null?void 0:K.reportDate)||"",B=((ie=A.snapshot)==null?void 0:ie.reportSubject)||A.fileName||"";return!B||!$?null:{id:A.reportId,reportNumber:M,subject:B,date:$,sent:!0,fileName:A.fileName,snapshot:A.snapshot}}).filter(A=>!!A).sort((A,v)=>A.reportNumber-v.reportNumber):[]},Le=(d,m)=>{const h=d.reportReview??{status:"DRAFT",issues:[]};return{...d,reportReview:m(h)}},Fe=d=>{At(d,m=>{const h=(e==null?void 0:e.id)||"unknown",A=new Date().toISOString();return{...Le(m,M=>({...M,status:"SUBMITTED",submittedAt:A,submittedByUserId:M.submittedByUserId||h})),hebrewWorkflowStatus:"HEBREW_SUBMITTED"}})},et=d=>{(e==null?void 0:e.role)==="ADMIN"&&At(d,m=>{const h=(e==null?void 0:e.id)||"unknown",A=new Date().toISOString();return{...Le(m,M=>({...M,status:"APPROVED",reviewedAt:A,reviewedByUserId:h})),hebrewWorkflowStatus:"HEBREW_APPROVED"}})},jn=(d,m)=>{m.length&&At(d,h=>{const A=(e==null?void 0:e.id)||"unknown",v=new Date().toISOString();return{...Le(h,$=>({...$,status:"CHANGES_REQUESTED",reviewedAt:v,reviewedByUserId:A,issues:[...$.issues,...m.map(B=>({id:`issue-${Date.now()}-${Math.random().toString(36).slice(2)}`,createdAt:v,createdByUserId:A,sectionKey:B.sectionKey,severity:B.severity,type:B.type,title:B.title,instruction:B.instruction,status:"OPEN"}))]})),hebrewWorkflowStatus:"HEBREW_CHANGES_REQUESTED"}})},En=(d,m)=>{At(d,h=>{const A=new Date().toISOString();return Le(h,v=>({...v,issues:v.issues.map(M=>M.id===m&&M.status!=="DONE"?{...M,status:"DONE",doneAt:A}:M)}))})},fa=d=>{(e==null?void 0:e.role)==="ADMIN"&&At(d,m=>{const h=new Date().toISOString();return Le(m,A=>({...A,issues:A.issues.map(v=>(v.origin??"INTERNAL")==="EXTERNAL"&&v.status!=="DONE"?{...v,status:"DONE",doneAt:h}:v)}))})},on=d=>{var h;return d?((h=d.reportReview)==null?void 0:h.status)==="APPROVED"||d.hebrewWorkflowStatus==="HEBREW_APPROVED":!1},At=(d,m)=>{const h=new Date().toISOString();let A=null,v=null;if(c(M=>M.map($=>{var at;if($.id!==d)return $;const B=ke($.odakanitNo),K=B&&he?he[B]:void 0,ie=pt($,K||void 0),je=!!(K!=null&&K.closedAt),Ne=(e==null?void 0:e.role)==="ADMIN"&&S===$.id&&!je;if((e==null?void 0:e.role)==="LAWYER"&&$.status==="SENT"&&!Ne)return pl({reason:"LAWYER_SENT_BLOCK",reportId:$.id,odakanitNo:$.odakanitNo,role:e==null?void 0:e.role,status:$.status,lockType:ie.lockType}),$;if(!Ne&&ie.isLocked)return pl({reason:he&&((at=he[B])!=null&&at.closedAt)?"CASE_CLOSED_BLOCK":"LOCKSTATE_BLOCK",reportId:$.id,odakanitNo:$.odakanitNo,role:e==null?void 0:e.role,status:$.status,lockType:ie.lockType}),$;const We=m($);return A=$,v=We,Ds($,We)?{...We,updatedAt:h}:We})),A&&v&&A.odakanitNo&&v.odakanitNo){const M=A.odakanitNo.trim(),$=v.odakanitNo.trim();M&&$&&M!==$&&lt(B=>{let K={...B};const ie=K[M];if(ie){const je=ie.reportIds.filter(Ne=>Ne!==v.id);K[M]={...ie,reportIds:je}}return K=Od(K,v,h),kn(K),K})}u(M=>{if(!M||M.id!==d)return M;const $=m(M);return Ds(M,$)?{...$,updatedAt:h}:$})},Co=(d,m,h)=>{m.length&&(e==null?void 0:e.role)==="ADMIN"&&At(d,A=>{const v=(e==null?void 0:e.id)||"unknown",M=new Date().toISOString();return{...Le(A,B=>({...B,status:"CHANGES_REQUESTED",reviewedAt:M,reviewedByUserId:v,issues:[...B.issues,...m.map(K=>({id:`issue-${Date.now()}-${Math.random().toString(36).slice(2)}`,createdAt:M,createdByUserId:v,sectionKey:K.sectionKey,severity:K.severity,type:K.type,title:K.title,instruction:K.instruction,status:"OPEN",origin:"EXTERNAL",externalRefId:h,externalAction:K.externalAction??"ENGLISH_ONLY"}))]})),postSendFeedbackMeta:{...A.postSendFeedbackMeta||{},lastFeedbackAt:M}}})},xa=d=>{(e==null?void 0:e.role)==="ADMIN"&&At(d,m=>{const h=new Date().toISOString(),A=m.reportReview??{status:"DRAFT",issues:[]};return{...m,hebrewWorkflowStatus:"HEBREW_REOPENED_EXTERNAL",reportReview:{...A,status:A.status==="CHANGES_REQUESTED"?A.status:"CHANGES_REQUESTED"},postSendFeedbackMeta:{...m.postSendFeedbackMeta||{},reopenedDueToFeedbackAt:h}}})},wr=d=>{V(m=>[d,...m])},Ei=d=>{T(m=>m.some(h=>h.reportId===d)?m:[...m,{reportId:d}]),C(d)},ki=d=>{T(m=>m.filter(h=>h.reportId!==d)),C(m=>m===d?null:m)},Ai=(d,m)=>{Y(h=>{const A=h[d]||[];return A.some(v=>v.serviceProvider.toLowerCase()===m.serviceProvider.toLowerCase()&&v.category===m.category)?h:{...h,[d]:[m,...A]}})},Ii=(d,m)=>{Y(h=>{const A=h[d]||[];return{...h,[d]:A.filter(v=>v.id!==m)}})},Ut=d=>{var m;if(i){const h=ke(i.odakanitNo),A=h&&he?he[h]:void 0,v=pt(i,A||void 0),M=!!(A!=null&&A.closedAt),$=(e==null?void 0:e.role)==="ADMIN"&&S===i.id&&!M;if((e==null?void 0:e.role)==="LAWYER"&&i.status==="SENT"&&!$){pl({reason:"LAWYER_SENT_BLOCK",reportId:i.id,odakanitNo:i.odakanitNo,role:e==null?void 0:e.role,status:i.status,lockType:v.lockType});return}if(!$&&v.isLocked){pl({reason:he&&h&&((m=he[h])!=null&&m.closedAt)?"CASE_CLOSED_BLOCK":"LOCKSTATE_BLOCK",reportId:i.id,odakanitNo:i.odakanitNo,role:e==null?void 0:e.role,status:i.status,lockType:v.lockType});return}const K=i;let ie={...i,...d};if(K.translationBaseHash&&d.content){const Ne=K.translationBaseHash,Ue=Vp(d.content);Ue&&Ue!==Ne&&(ie={...ie,translationStale:!0})}K.updateAutoSummarySourceReportId&&d.content&&d.content.Update!==void 0&&(ie={...ie,updateAutoSummaryEdited:!0});const je=Ds(K,ie);u(je?{...ie,updatedAt:new Date().toISOString()}:ie)}},tn=()=>{i&&c(d=>{const h=d.find(A=>A.id===i.id)?d.map(A=>A.id===i.id?i:A):[...d,i];return I(i),h})},Gt=()=>{if(!i)return;const d=Mc(i.content),m=Mc(i.translatedContent);Ut({content:d,translatedContent:m})},Ti=async()=>{if(i){if(!on(i)){window.alert("       .");return}Je(!0);try{const d=Mc(i.content),m={};for(const A of Object.keys(d)){const v=d[A];if(v){const M=await Rd(v);m[A]=li(M)}}const h=Vp(d);Ut({content:d,translatedContent:m,isTranslated:!0,translationBaseHash:h,translationStale:!1}),window.alert("  .")}catch(d){console.error("Translate failed",d),window.alert(" .    .")}finally{Je(!1)}}},Ri=async()=>{if(!i)return;if(!i.isTranslated){window.alert("    (Auto-Translate)   .");return}const d=i.translatedContent||{},m=Object.keys(d).filter(h=>!h.toLowerCase().includes("expenses")&&typeof d[h]=="string"&&d[h].trim().length>0);if(!m.length){window.alert("   .");return}re(!0);try{const h={...d},A=[];for(const v of m){const M=d[v];if(!(!M||!M.trim()))try{const{protectedText:$,map:B}=Uh(M),K=await xh($),ie=Wh(K||$,B),je=Hh(ie);h[v]=li(je)}catch($){console.error(`Improve English failed for section "${v}"`,$),A.push(v),h[v]=M}}if(Ut({translatedContent:h}),tn(),!A.length)window.alert("   .");else{const v=A.map(M=>{var $;return Cd(M,($=i.expertSummaryMode)==null?void 0:$[M])});window.alert(`   .
  : ${v.join(", ")}.
   .`)}}catch(h){console.error("Improve English failed",h),window.alert("  .    .")}finally{re(!1)}},jr=d=>{const m=new Set(["lidor@lp-law.co.il"]),h=new Set(["reports@lp-law.co.il"]);if(d.ownerEmail)h.add(d.ownerEmail);else{const A=vs.find(v=>v.id===d.createdBy);A!=null&&A.email&&h.add(A.email)}return{to:Array.from(m),cc:Array.from(h)}},ps=d=>ei(d),Ci=d=>({...d,invoiceFiles:[],policyFile:void 0,expensesSourceFile:void 0}),Di=(d,m)=>{var v,M,$;const h=d.content?Cr(d.content):{},A=d.translatedContent?Cr(d.translatedContent):{};return{createdAt:m,reportDate:d.reportDate,subject:((v=d.emailSubjectDraft)==null?void 0:v.trim())||ps(d),status:"SENT",odakanitNo:d.odakanitNo,recipientId:d.recipientId,insurerName:d.insurerName,lineSlipNo:d.lineSlipNo,marketRef:d.marketRef,insuredName:d.insuredName,plaintiffName:d.plaintiffName,plaintiffTitle:d.plaintiffTitle,policyPeriodStart:d.policyPeriodStart,policyPeriodEnd:d.policyPeriodEnd,retroStart:d.retroStart,retroEnd:d.retroEnd,filenameTag:d.filenameTag,fileNameTitles:d.fileNameTitles?[...d.fileNameTitles]:void 0,selectedSections:[...d.selectedSections||[]],content:h,translatedContent:A,executiveSummary:d.executiveSummary,complaintAnalysis:d.complaintAnalysis?Cr(d.complaintAnalysis):void 0,requiresExpenses:!!d.requiresExpenses,isWaitingForInvoices:!!d.isWaitingForInvoices,isTranslated:!!d.isTranslated,selectedTimeline:d.selectedTimeline,selectedTimelineImage:d.selectedTimelineImage,expensesItems:(M=d.expensesItems)!=null&&M.length?Cr(d.expensesItems):void 0,expenseWorksheet:d.expenseWorksheet?Cr(d.expenseWorksheet):void 0,expensesSum:d.expensesSum,paymentRecommendation:d.paymentRecommendation,reportNotes:($=d.reportNotes)!=null&&$.length?Cr(d.reportNotes):void 0,ownerName:d.ownerName,ownerEmail:d.ownerEmail}},Er=(d,m,h)=>{var $,B;const A=(($=d.emailSubjectDraft)==null?void 0:$.trim())||ps(d),v=((B=d.reportHistory)==null?void 0:B.length)||0,M=typeof d.reportNumber=="number"&&d.reportNumber>0?d.reportNumber:v+1;return{id:An(),reportNumber:M,subject:A,date:h,sent:!0,fileName:m,snapshot:Di(d,h)}},ha=d=>{if(!d)return d;const m="",h="";return d.startsWith(m)?d:`${m}${d}${h}`},ga=(d,m,h)=>{if(typeof window>"u")return;const A=d.to.join(";"),v=B=>encodeURIComponent(B),M=[];d.cc.length&&M.push(`cc=${v(d.cc.join(";"))}`),M.push(`subject=${v(m)}`),M.push(`body=${v(ha(h))}`);const $=`mailto:${A}?${M.join("&")}`;window.location.href=$},Do=async()=>{if(i){$e(!0);try{const d=await jc(i),m=ir(i),h=URL.createObjectURL(d),A=document.createElement("a");A.href=h,A.download=m,document.body.appendChild(A),A.click(),A.remove(),URL.revokeObjectURL(h)}catch(d){console.error("PDF download failed",d),alert(" -PDF .  .")}finally{$e(!1)}}},Li=async()=>{const d=ds(i,e);if(!d.length){await Do();return}Ht({issues:d,onContinue:()=>{Ht(null),Do()}})},_i=()=>{i&&((e==null?void 0:e.role)==="ADMIN"?(Ae(!1),ae(!0)):Oo())},Oi=()=>{var h,A;if(!i||(e==null?void 0:e.role)!=="ADMIN")return;if(i.status!=="SENT"){setShowToast({msg:"       (SENT).",type:"error"});return}if(!on(i)){setShowToast({msg:"   /   .       .",type:"error"});return}if(((A=(h=i.reportReview)==null?void 0:h.issues)==null?void 0:A.some(v=>(v.origin??"INTERNAL")==="EXTERNAL"&&v.status!=="DONE"&&v.externalAction==="REQUIRES_HEBREW"))??!1){setShowToast({msg:"      .    /      .",type:"error"});return}if(!(i.isTranslated&&i.translatedContent&&Object.values(i.translatedContent).some(v=>v&&v.trim().length>0))){setShowToast({msg:"    .      .",type:"error"});return}Ae(!0),ae(!0)},Lo=async({body:d,templateId:m,subjectBase:h,topics:A},v)=>{const M=v??i;if(!M||M.translationStale&&!window.confirm("     .      .    ?"))return;const $={...M,selectedEmailTemplate:m,emailBodyDraft:d,emailSubjectDraft:h.trim()?h.trim():void 0,fileNameTitles:A};if(Ut({selectedEmailTemplate:m,emailBodyDraft:d,emailSubjectDraft:$.emailSubjectDraft,fileNameTitles:A}),e){const Ve=_d(e.id),at=Np(Ve,A,6);gp(e.id,at)}const B=ha(d);be(!0);let K=null,ie="";const je=h.trim()||ps($);let Ne="",Ue=null,We=!1;try{Ue=await jc($);const Ve=await Wp(Ue);Ne=ir($),K=jr($),ie=je,We=await mp({to:K.to,cc:K.cc,subject:ie,body:B,attachmentBase64:Ve,attachmentName:Ne}),We?setShowToast({msg:"  .",type:"success"}):setShowToast({msg:"          ( PDF  ,    ).",type:"error"})}catch(Ve){console.error("Email send failed",Ve),setShowToast({msg:"          ( PDF  ,    ).",type:"error"})}finally{if(K){if(!We){if(Ue){const Ve=Ne||ir($),at=URL.createObjectURL(Ue),Ze=document.createElement("a");Ze.href=at,Ze.download=Ve,document.body.appendChild(Ze),Ze.click(),document.body.removeChild(Ze),URL.revokeObjectURL(at)}ga(K,ie||je,B)}Oo(Ne||void 0),ae(!1)}be(!1)}},Mi=async d=>{if(!i)return;let m=i;if(m.odakanitNo){const M=ke(m.odakanitNo);if(M){const B=l.filter(ie=>ke(ie.odakanitNo)===M).reduce((ie,je)=>{const Ne=typeof je.reportNumber=="number"&&je.reportNumber>0?je.reportNumber:ie;return Ne>ie?Ne:ie},0);if((typeof m.reportNumber=="number"&&m.reportNumber>0?m.reportNumber:B)<B){window.alert("       .       .       .");return}}}const h=!!i.expensesSheetId||!!i.expensesHtml,A=Array.isArray(i.selectedSections)&&i.selectedSections.some(M=>Jr(M));if(h&&!A){if(!window.confirm(`       ,        .

       ?`))return;const $=[...i.selectedSections||[]],B=$.includes("Update"),K=$.includes("Recommendations"),ie=B?Math.min($.indexOf("Update")+1,K?$.indexOf("Recommendations"):$.length):0;$.splice(ie,0,Xa);const je=Array.from(new Set($)),Ne={...i,selectedSections:je};Ut({selectedSections:je}),m=Ne}const v=ds(m,e);if(!v.length){await Lo(d,m);return}Ht({issues:v,onContinue:()=>{Ht(null),Lo(d,m)}})},_o=async({body:d,templateId:m,subjectBase:h,topics:A},v)=>{var We,Ve,at;const M=v??i;if(!M||(e==null?void 0:e.role)!=="ADMIN"||M.translationStale&&!window.confirm("     .      .     ?"))return;const $={...M,selectedEmailTemplate:m,emailBodyDraft:d,emailSubjectDraft:h.trim()?h.trim():void 0,fileNameTitles:A};if(Ut({selectedEmailTemplate:m,emailBodyDraft:d,emailSubjectDraft:$.emailSubjectDraft,fileNameTitles:A}),e&&A.length){const Ze=_d(e.id),bt=Np(Ze,A,6);gp(e.id,bt)}const B=ha(d);be(!0);let K=null,ie="",je="";const Ne=h.trim()||ps($);let Ue=!1;try{const Ze=await jc($),bt=await Wp(Ze);je=ir($),K=jr($),ie=`Resend  ${Ne}`,Ue=await mp({to:K.to,cc:K.cc,subject:ie,body:B,attachmentBase64:bt,attachmentName:je}),Ue?setShowToast({msg:"   ( ).",type:"success"}):setShowToast({msg:"         .",type:"error"});const Pt=new Date().toISOString(),Dt=Er({...M,status:"SENT",sentAt:Pt},je,Pt),Tt=typeof M.reportNumber=="number"&&M.reportNumber>0?M.reportNumber:(((We=M.reportHistory)==null?void 0:We.length)||0)+1,Be=ke(M.odakanitNo),Pn=Be&&he?he[Be]:void 0,Gn=!pt(M,Pn||void 0).isLocked,nt={...Dt,subject:Gn?`Corrected resend #${Tt}  ${Dt.subject}`:`Resent #${Tt}  ${Dt.subject}`,isCorrection:Gn,revisionIndex:Gn?(((at=(Ve=M.reportHistory)==null?void 0:Ve.filter(qt=>qt.isCorrection))==null?void 0:at.length)||0)+1:void 0},Et={...M,status:"SENT",sentAt:Pt,reportHistory:[...M.reportHistory||[],nt],selectedEmailTemplate:void 0,emailBodyDraft:void 0};Cs(Et),I(Et,Pt),we(Et,Pt,nt.fileName||je,!0),u(Et),c(qt=>qt.map(it=>it.id===Et.id?Et:it))}catch(Ze){console.error("Resend email failed",Ze),setShowToast({msg:"         .",type:"error"})}finally{if(K){const Ze=Ne||ps(M),bt=ie||`UPDATED: ${Ze}`;Ue||ga(K,bt,B),ae(!1)}Ae(!1),be(!1)}},Pi=async d=>{if(!i)return;let m=i;const h=!!i.expensesSheetId||!!i.expensesHtml,A=Array.isArray(i.selectedSections)&&i.selectedSections.some(M=>Jr(M));if(h&&!A){if(!window.confirm(`        ,        .

        ?`))return;const $=[...i.selectedSections||[]],B=$.includes("Update"),K=$.includes("Recommendations"),ie=B?Math.min($.indexOf("Update")+1,K?$.indexOf("Recommendations"):$.length):0;$.splice(ie,0,Xa);const je=Array.from(new Set($)),Ne={...i,selectedSections:je};Ut({selectedSections:je}),m=Ne}const v=ds(m,e);if(!v.length){await _o(d,m);return}Ht({issues:v,onContinue:()=>{Ht(null),_o(d,m)}})},kr=d=>{if(!d)return;let m=d.trim();if(!(!m||(m=m.replace($u," ").replace(/\s+/g," ").trim(),!m)||(m.toLowerCase().endsWith(".pdf.pdf")&&(m=m.slice(0,-4)),m.toLowerCase().endsWith(".pdf")||(m=`${m}.pdf`),m.length>255)))return m},Oo=d=>{var M;if(!i)return;let m="READY_TO_SEND",h=i.sentAt,A=i;if((e==null?void 0:e.role)==="ADMIN"){m="SENT";const $=new Date().toISOString();h=$;const K=kr(d)||ir(Ci(i)),ie=Er({...i},K,h);A={...i,reportHistory:[...i.reportHistory||[],ie],selectedEmailTemplate:void 0,emailBodyDraft:void 0,firstSentAt:i.firstSentAt||$}}else((e==null?void 0:e.role)==="FINANCE"||(e==null?void 0:e.role)==="SUB_ADMIN")&&(m="TASK_ASSIGNED");const v={...A,status:m,sentAt:h};if(Cs(v),I(v,h||new Date().toISOString()),m==="SENT"&&h){const $=(M=v.reportHistory)==null?void 0:M[v.reportHistory.length-1];we(v,h,$==null?void 0:$.fileName,!1)}u(v),c($=>$.find(K=>K.id===v.id)?$.map(K=>K.id===v.id?v:K):[...$,v]),o("DASHBOARD")},Fi=(d,m)=>{e&&(At(d,h=>{const A=[{id:An(),authorId:e.id,authorName:e.name,message:m,createdAt:new Date().toISOString()},...h.reportNotes||[]];return{...h,reportNotes:A}}),wr({id:`note-${Date.now()}`,message:`${e.name} added a note: "${m}"`,createdAt:new Date().toISOString()}))},Bi=(d,m)=>{At(d,h=>{const A=h.expenseWorksheet||Ps(),v={id:An(),timestamp:new Date().toISOString(),userId:(e==null?void 0:e.id)||"system",userName:(e==null?void 0:e.name)||"System",action:m.action||"UPDATE",details:m.details};return{...h,expenseWorksheet:{...A,history:[v,...A.history||[]]}}})},$i=(d,m,h)=>{e&&(At(d,A=>{const v=A.expenseWorksheet||Ps(),M={id:An(),rowId:m,authorId:e.id,authorName:e.name,message:h,createdAt:new Date().toISOString()};return{...A,expenseWorksheet:{...v,notes:[M,...v.notes||[]]}}}),Bi(d,{action:"NOTE_ADDED",details:h}))},Hi=d=>{const m=new Date().toISOString();At(d,h=>({...h,deletedAt:m,deletedBy:e==null?void 0:e.id}))},Ui=d=>{At(d,m=>{const h={...m};return delete h.deletedAt,delete h.deletedBy,h})},Wi=(d,m)=>{At(d,h=>{const A=h.expenseWorksheet||Ps();return{...h,expenseWorksheet:{...A,notes:A.notes.map(v=>v.id===m?{...v,resolved:!0,resolvedAt:new Date().toISOString()}:v)}}})},zi=(d,m)=>{!m.amount||m.amount<=0||At(d,h=>{var Ue,We;const A=h.expenseWorksheet||Ps(),v=ss.find(Ve=>Ve.value===m.category),M=(v==null?void 0:v.type)||"EXPENSE",$=m.category==="OTHER"?((Ue=m.customLabel)==null?void 0:Ue.trim())||"Other expense":(v==null?void 0:v.label)||"Expense",B={id:An(),type:M,category:m.category,label:$,serviceProvider:M==="EXPENSE"?(We=m.serviceProvider)==null?void 0:We.trim():void 0,amount:m.amount,createdBy:e==null?void 0:e.id,createdAt:new Date().toISOString()},K=[...A.rows||[],B],ie=oi(K),je=Dv(K),Ne={id:An(),timestamp:new Date().toISOString(),userId:(e==null?void 0:e.id)||"system",userName:(e==null?void 0:e.name)||"System",action:"ROW_ADDED",details:`${$} ${B.amount.toLocaleString()}`};return{...h,expenseWorksheet:{...A,rows:K,totals:ie,history:[Ne,...A.history||[]]},expensesItems:je,expensesSum:ie.totalExpenses.toLocaleString()}})},Vi=d=>{const m=vs.find(K=>K.id===d.lawyerId);if(!m)return;const h=Md(d.worksheet||[],e||void 0),A=oi(h),v=d.invoiceFiles||[],M=v.length===0,$={...wn(),createdBy:m.id,ownerName:m.name,ownerEmail:m.email,status:M?"WAITING_FOR_INVOICES":"TASK_ASSIGNED",odakanitNo:d.odakanitNo,financeInstructions:d.instructions,expensesSourceFile:d.file,selectedSections:["Update","Expenses breakdown"],isWaitingForInvoices:M,requiresExpenses:!0},B={...$,expensesItems:h.filter(K=>K.type==="EXPENSE").map(K=>({id:K.id,date:new Date().toISOString().split("T")[0],description:`${K.label}${K.serviceProvider?` (${K.serviceProvider})`:""}`,amount:K.amount,currency:"NIS"})),expensesSum:h.length?A.totalExpenses.toLocaleString():$.expensesSum,invoiceFiles:v,expenseWorksheet:{status:"DRAFT",rows:h,history:[{id:An(),timestamp:new Date().toISOString(),userId:(e==null?void 0:e.id)||"system",userName:(e==null?void 0:e.name)||"System",action:"WORKSHEET_CREATED",details:`${h.length} rows added via finance request`}],notes:[],favorites:se[d.lawyerId]||[],totals:A}};c(K=>[...K,B]),wr({id:`worksheet-${Date.now()}`,message:`New expense worksheet created for case ${d.odakanitNo||B.id}`,createdAt:new Date().toISOString(),reportId:B.id,severity:"info"})},Ki=async({caseId:d,sheetId:m,lawyerId:h})=>{var Tt,Be,Pn,ln,Gn;const A=ke(d),v=he==null?void 0:he[A],M=l.filter(nt=>ke(nt.odakanitNo)===A);if(v&&v.closedAt){window.alert("        .   ,     .");return}if(!M.length&&!v){window.alert("     ( ).       .");return}if(!M.length)return;const $=(nt,Et)=>{const qt=nt.updatedAt?new Date(nt.updatedAt).getTime():0;return(Et.updatedAt?new Date(Et.updatedAt).getTime():0)-qt};let B=M.filter(nt=>!h||nt.createdBy===h).sort($)[0];if(B||(B=M.sort($)[0]),!B)return;const K=h||B.createdBy;if(!K)return;const ie=B.odakanitNo||d,je=B.insuredName||B.plaintiffName||"case",Ne=`New financial update (Expenses breakdown) is available for Odakanit case ${ie} (${je}).`;let Ue=null,We,Ve=null,at=[];try{const nt=await Ye.getSheet(m);if(nt&&nt.sheet&&((Tt=nt.lineItems)!=null&&Tt.length)){const Et=Ye.buildCumulativeExpensesSnapshot(nt.sheet.id,new Date().toISOString());if(!Et)return;const{effectiveSheet:qt,allLines:it,opts:qn}=Et,{text:Sa,totals:rr}=Lh(qt,it,qn),wa=((Be=nt.attachments)==null?void 0:Be.length)??0,Ho=rr.amountToRequest.toLocaleString("he-IL",{minimumFractionDigits:2,maximumFractionDigits:2}),Uo="This expenses breakdown was prepared by the finance department and is attached for your review.",Vh=`Summary: total amount to request ${Ho}${wa>0?` (invoices attached: ${wa})`:""}.`;Ue=`${Uo}

${Vh}`;const{html:Kh}=ri(qt,it,qn);if(Ve=Kh,We=nt.sheet.updatedAt||new Date().toISOString(),nt.attachments&&nt.attachments.length){const qu=nt.attachments.slice(0,4).map((ja,Yh)=>({id:`fes-inv-${ja.id}-${Yh}`,name:ja.originalFileName,data:ja.fileKey.split(",").pop()||ja.fileKey,type:ja.mimeType||"application/pdf"}));qu.length&&(at=qu)}}}catch(nt){Ku("Failed to build Expenses Breakdown text for finance notification",nt)}const Ze=new Date().toISOString(),bt=Ue||"An expenses table has been prepared by the finance department for this case. Please review the attached sheet or coordinate with Finance as needed.",Pt=typeof B.reportNumber=="number"&&B.reportNumber>0?B.reportNumber+1:(((Pn=B.reportHistory)==null?void 0:Pn.length)||0)+1;let Dt={...B,id:`${Date.now()}-finance`,createdBy:K,status:"TASK_ASSIGNED",reportDate:Ze,updatedAt:Ze,expensesSheetId:m,expensesSnapshotAt:We||Ze,invoiceFiles:at,reportNumber:Pt,reportHistory:B.reportHistory||[],attachPolicyAsAppendix:!1,expensesHtml:Ve||void 0,content:{...B.content,Update:((ln=B.content)==null?void 0:ln.Update)||"","Expenses breakdown":bt,Recommendations:((Gn=B.content)==null?void 0:Gn.Recommendations)||""},selectedSections:["Update","Expenses breakdown","Recommendations"],supersededByReportId:null,supersedesReportId:null};c(nt=>{const Et=[...nt].filter(it=>it.expensesSheetId===m&&!it.deletedAt&&it.id!==Dt.id).sort((it,qn)=>{const Sa=new Date(it.updatedAt||it.reportDate||"").getTime()||0;return(new Date(qn.updatedAt||qn.reportDate||"").getTime()||0)-Sa})[0];let qt=nt;return Et&&(qt=nt.map(it=>it.id===Et.id?{...it,supersededByReportId:Dt.id}:it),Dt={...Dt,supersedesReportId:Et.id}),[...qt,Dt]}),wr({id:`${Date.now()}`,message:Ne,createdAt:new Date().toISOString(),reportId:Dt.id,severity:"info",targetUserId:K})},Yi=d=>{t(d),o("DASHBOARD"),u(null),w(null),L.current=!1,typeof window<"u"&&(localStorage.setItem(ct.USER,d.username),localStorage.setItem(ct.VIEW,"DASHBOARD"),localStorage.removeItem(ct.CURRENT_REPORT))},[Gi,ya]=g.useState(!1),[Na,Ar]=g.useState(!1),Mo=()=>{if(!(l.length>0||i)){ba();return}Ar(!1),ya(!0)},qi=()=>{ya(!1),Ar(!1),ba()},ba=()=>{if(t(null),u(null),w(null),L.current=!1,o("DASHBOARD"),U(null),F(!1),ae(!1),be(!1),Ae(!1),Ge(!1),P(null),ue(""),oe(null),ve(""),ze("LAWYER"),T([]),C(null),te(!1),Ee(null),x([]),typeof window<"u")try{localStorage.removeItem(ct.USER),localStorage.removeItem(ct.CURRENT_REPORT),localStorage.setItem(ct.VIEW,"DASHBOARD"),localStorage.removeItem(Ub)}catch(d){console.error("Failed to clear session storage on logout",d)}};if(!s)return n.jsx("div",{className:"min-h-screen flex items-center justify-center bg-bgDark",children:n.jsxs("div",{className:"text-textMuted text-sm flex items-center gap-2",children:[n.jsx(Lt,{className:"w-5 h-5 animate-spin","aria-hidden":!0}),n.jsx("span",{children:"..."})]})});if(!e)return n.jsx(Pv,{onLogin:Yi});if(a==="CASE_FOLDER"&&Se){const d=he[Se]||null,m=()=>{o("DASHBOARD")};return d?n.jsx(Jb,{folder:d,reports:l,currentUserRole:e.role,onBack:m,onUpdateReTemplate:h=>{lt(A=>{const v=A[Se];if(!v)return A;const M={...v,reTemplate:h,updatedAt:new Date().toISOString()},$={...A,[Se]:M};return kn($),$})},onCloseCase:e.role==="ADMIN"?()=>{const h=Se;if(!h)return;const A=ke(h);if(l.some($=>ke($.odakanitNo)===A&&$.status!=="SENT"&&!$.deletedAt)){window.alert("         .        .");return}if(!window.confirm("        .   ?"))return;const M=new Date().toISOString();lt($=>{const B=$[h];if(!B)return $;const K={...B,closedAt:M,closedByUserId:e.id,updatedAt:M},ie={...$,[h]:K};return kn(ie),ie})}:void 0,onReopenCase:e.role==="ADMIN"?()=>{const h=Se;h&&window.confirm("         .   ?")&&lt(A=>{const v=A[h];if(!v)return A;const M={...v,closedAt:null,closedByUserId:null,updatedAt:new Date().toISOString()},$={...A,[h]:M};return kn($),$})}:void 0,onDeleteCase:e.role==="ADMIN"?()=>{const h=Se;if(!h)return;const A=ke(h);if(l.some(M=>ke(M.odakanitNo)===A&&M.status!=="SENT"&&!M.deletedAt)){window.alert("       .        .");return}window.confirm("           (  ).   ?")&&window.confirm(" :      ?     .")&&(lt(M=>{const $={...M};return delete $[h],kn($),$}),c(M=>M.filter($=>ke($.odakanitNo)!==A)),Ee(null),o("DASHBOARD"))}:void 0,onCreateReportInCase:()=>{const h=he[Se];if(!h||!e)return;if(h.closedAt){window.alert("  .      .");return}const A=l.find(Ve=>Ve.odakanitNo&&ke(Ve.odakanitNo)===ke(h.odakanitNo)&&Ve.status!=="SENT"&&!Ve.deletedAt);if(A&&e.role==="LAWYER"){window.alert("     .     .      .");return}if(A&&e.role==="ADMIN"&&!window.confirm("     .       ( ,    )?"))return;const v=new Date().toISOString(),M=wn(),$=De(h),B=sr({odakanitNo:h.odakanitNo,reports:l,caseFolder:h}),K=Array.isArray(h.sentReports)?h.sentReports:[];let ie=null,je="";if(K.length>0){ie=[...K].sort((Dt,Tt)=>{const Be=new Date(Dt.sentAt||"").getTime()||0;return(new Date(Tt.sentAt||"").getTime()||0)-Be})[0];const Ve=(ie==null?void 0:ie.snapshot)||{},at=Ve.content||{},Ze=Array.isArray(Ve.selectedSections)?Ve.selectedSections:[],bt=Ze.length>0?Ze:Object.keys(at),Pt=[];bt.forEach(Dt=>{const Tt=at[Dt];typeof Tt=="string"&&Tt.trim()&&Pt.push(Tt.trim())}),je=Pt.join(`

`).trim()}const Ne=!!(ie&&je),Ue="    ",We={...M,odakanitNo:h.odakanitNo,reportSubject:h.reTemplate||"",insuredName:h.insuredName||"",plaintiffName:h.plaintiffName||"",insurerName:h.insurerName||"",marketRef:h.marketRef||"",lineSlipNo:h.lineSlipNo||"",certificateRef:h.certificateRef||"",reportDate:v,updatedAt:v,reportHistory:$,reportNumber:B,content:Ne?{...M.content||{},Update:Ue}:M.content,updateAutoSummarySourceReportId:Ne?ie.reportId:null,updateAutoSummaryGeneratedAt:Ne?v:null,updateAutoSummaryEdited:!1};if(u(We),w(null),o("STEP1"),typeof window<"u")try{localStorage.setItem(ct.CURRENT_REPORT,We.id)}catch{}if(I(We,v),Ne){const Ve=je,at=ie.reportId;(async()=>{try{let Ze=await G0(Ve);Ze=(Ze||"").trim(),Ze||(Ze=`,     ${Ve.trim().slice(0,600)}`),Ze.startsWith(",  ")||(Ze=`,     ${Ze}`),At(We.id,bt=>{var Pt;return bt.updateAutoSummaryEdited||((Pt=bt.content)==null?void 0:Pt.Update)!==Ue?bt:{...bt,content:{...bt.content||{},Update:Ze},updateAutoSummarySourceReportId:at,updateAutoSummaryGeneratedAt:new Date().toISOString()}})}catch(Ze){console.error("Auto summary generation failed, falling back to snippet.",Ze);const bt=Ve.trim();if(!bt)return;const Dt=`,     ${bt.slice(0,600)}`;At(We.id,Tt=>{var Be;return Tt.updateAutoSummaryEdited||((Be=Tt.content)==null?void 0:Be.Update)!==Ue?Tt:{...Tt,content:{...Tt.content||{},Update:Dt},updateAutoSummarySourceReportId:at,updateAutoSummaryGeneratedAt:new Date().toISOString()}})}})()}},onOpenReport:h=>{const A=l.find(v=>v.id===h);if(A&&(u(A),w(null),o("STEP1"),typeof window<"u"))try{localStorage.setItem(ct.CURRENT_REPORT,A.id)}catch{}}}):n.jsx("div",{className:"min-h-screen flex items-center justify-center bg-bgDark px-4",children:n.jsxs("div",{className:"max-w-md rounded-2xl bg-panel p-6 text-center text-sm text-textLight shadow-sm border border-borderDark",children:[n.jsx("p",{className:"mb-3 font-semibold text-gold",children:"Case folder not found"}),n.jsx("p",{className:"mb-4 text-xs text-textMuted",children:"The requested case folder is no longer available. You can return to the dashboard and select another case."}),n.jsx("button",{type:"button",onClick:m,className:"inline-flex items-center rounded-full bg-navy px-4 py-1.5 text-xs font-semibold text-gold shadow-sm hover:bg-navySecondary focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-gold focus-visible:ring-offset-2",children:"Back to dashboard"})]})})}const Po=()=>{if((e==null?void 0:e.role)==="LAWYER"){Qe(""),rt(!0);return}const d=wn();if(u(d),w(null),o("STEP1"),typeof window<"u")try{localStorage.setItem(ct.CURRENT_REPORT,d.id)}catch{}},va=(d,m)=>{const h=l.find(A=>A.id===d);if(h&&(u(h),w(null),o("STEP1"),U(m||null),typeof window<"u"))try{localStorage.setItem(ct.CURRENT_REPORT,h.id)}catch{}};if(a==="DASHBOARD")return(e==null?void 0:e.role)==="ADMIN"||(e==null?void 0:e.role)==="SUB_ADMIN"?n.jsx(Vb,{user:e,reports:l,caseFolders:he,onUpdateCaseFolders:d=>{lt(m=>{const h=d(m);return kn(h),h})},onNewReport:Po,onSelectReport:va,onSelectReportWithFocus:(d,m)=>va(d,m),onMarkExternalIssuesDone:fa,onReopenHebrewDueToExternalFeedback:d=>xa(d),canTranslate:on,onLogout:Mo,onOpenAssistant:()=>Pe(!0),onOpenCaseFolder:d=>{const m=ke(d);m&&(lt(h=>{const A=Oc(h,l);return kn(A),A}),Ee(m),o("CASE_FOLDER"))}}):n.jsxs(n.Fragment,{children:[n.jsx(Mv,{user:e,reports:l,onNewReport:Po,onSelectReport:va,onLogout:Mo,onUpdateReport:(d,m)=>{At(d,h=>({...h,...m}))},onDeleteReport:d=>c(m=>m.filter(h=>h.id!==d)),onFinanceTaskCreate:Vi,onNotifyLawyerFromFinance:Ki,caseTemplates:ne,onStartTemplate:us,onStartNextReport:Mn,archiveAfterMs:vv,favoriteProviders:se,onSaveFavorite:Ai,onDeleteFavorite:Ii,onOpenWorksheet:Ei,onRequestReminder:d=>{oe(d),ve(`Reminder for ${d.insuredName||"case"}`)},onRequestNote:d=>{P(d),ue("")},onSoftDeleteReport:Hi,onRestoreReport:Ui,notifications:H.filter(d=>!d.targetUserId||d.targetUserId===(e==null?void 0:e.id)),showNotifications:q,setShowNotifications:te,onClearNotifications:()=>V([]),dailySummaryOptIn:G,setDailySummaryOptIn:le,caseFolders:he,onOpenCaseFolder:d=>{const m=ke(d);m&&(lt(h=>{const A=Oc(h,l);return kn(A),A}),Ee(m),o("CASE_FOLDER"))},onOpenAssistant:()=>Pe(!0)}),(e==null?void 0:e.role)==="LAWYER"&&Nt&&n.jsx("div",{className:"fixed inset-0 z-[250] flex items-center justify-center bg-black/40",children:n.jsxs("div",{className:"bg-panel rounded-2xl shadow-xl max-w-sm w-full mx-4 p-5 space-y-3",dir:"rtl",children:[n.jsx("h2",{className:"text-sm font-bold text-textLight text-right",children:"    "}),n.jsx("p",{className:"text-xs text-textMuted text-right",children:'/   .         / " .          .'}),n.jsx("input",{type:"text",className:"w-full border border-borderDark rounded px-3 py-1.5 text-sm text-textLight",placeholder:": 1/123",value:Me,onChange:d=>Qe(d.target.value)}),n.jsxs("div",{className:"flex justify-end gap-2 mt-2",children:[n.jsx("button",{type:"button",className:"px-3 py-1.5 rounded-md border border-borderDark text-xs text-textLight bg-panel hover:bg-slate-50",onClick:()=>{rt(!1),Qe("")},children:""}),n.jsx("button",{type:"button",className:"px-3 py-1.5 rounded-md bg-navy text-xs font-semibold text-gold hover:bg-navySecondary",onClick:()=>{const d=Me.trim();if(!d){alert("    .");return}const m=d,h=he[m],A=new Date().toISOString();if(h){const v=wn(),M=De(h),$=sr({odakanitNo:h.odakanitNo,reports:l,caseFolder:h}),B={...v,odakanitNo:h.odakanitNo,reportSubject:h.reTemplate||"",insuredName:h.insuredName||"",plaintiffName:h.plaintiffName||"",insurerName:h.insurerName||"",marketRef:h.marketRef||"",lineSlipNo:h.lineSlipNo||"",certificateRef:h.certificateRef||"",reportDate:A,updatedAt:A,reportHistory:M,reportNumber:$};if(u(B),o("STEP1"),typeof window<"u")try{localStorage.setItem(ct.CURRENT_REPORT,B.id)}catch{}I(B,A)}else{const M={...wn(),odakanitNo:m};if(u(M),o("STEP1"),typeof window<"u")try{localStorage.setItem(ct.CURRENT_REPORT,M.id)}catch{}I(M,A)}rt(!1),Qe("")},children:""})]})]})})]});if(!i)return null;const Ir=typeof i.reportNumber=="number"&&i.reportNumber>0?i.reportNumber:(((Z=i.reportHistory)==null?void 0:Z.length)||0)+1,Fo=hh(i.selectedSections||[]),Bo=Fo.map((d,m)=>({id:`${m}-${d.replace(/\s+/g,"-")||"title"}`,label:d})).filter(d=>!!d.label),Xi=Ld(Fo),$o=i.fileNameTitles&&i.fileNameTitles.length?i.fileNameTitles:Xi,f=Ir!==1&&Bo.length>0,R=j.map(d=>{const m=ms(d.reportId);return m?{...d,report:m,title:`${m.insuredName||"Case"} (${m.ownerName})`}:null}).filter(Boolean),z=E?ms(E):null;return n.jsxs(n.Fragment,{children:[n.jsx("div",{className:"min-h-screen bg-navySecondary pb-12",children:n.jsxs("div",{className:"w-full pt-6 px-6 md:px-8 lg:px-10 xl:px-12",children:[n.jsxs("div",{className:"flex justify-between items-center mb-8",children:[n.jsxs("div",{className:"flex items-center bg-panel p-2 rounded-full shadow-sm",children:[n.jsx("div",{className:`px-4 py-1 rounded-full ${a==="STEP1"?"bg-navy text-white font-bold":"text-textMuted"}`,children:"1. Setup"}),n.jsx(ts,{className:"w-4 h-4 text-gray-300 mx-2"}),n.jsx("div",{className:`px-4 py-1 rounded-full ${a==="STEP2"?"bg-navy text-white font-bold":"text-textMuted"}`,children:"2. Draft"}),n.jsx(ts,{className:"w-4 h-4 text-gray-300 mx-2"}),n.jsx("div",{className:`px-4 py-1 rounded-full ${a==="PREVIEW"?"bg-navy text-white font-bold":"text-textMuted"}`,children:"3. Preview"})]}),n.jsxs("button",{type:"button",onClick:()=>Pe(!0),className:"flex items-center text-[11px] px-3 py-1.5 rounded-full bg-indigo-50 text-indigo-800 border border-indigo-200 hover:bg-indigo-100",title:"     ,     .",children:[n.jsx(aa,{className:"w-3 h-3 ml-1"})," "]})]}),i&&(()=>{const d=ke(i.odakanitNo),m=d&&he?he[d]:void 0,h=pt(i,m||void 0),A=!!(m!=null&&m.closedAt),v=(e==null?void 0:e.role)==="ADMIN"&&S===i.id;return(h.isLocked||A)&&!(v&&!A)})()&&n.jsxs("div",{className:"mb-4 rounded-2xl border border-amber-300 bg-amber-50 px-4 py-3 text-xs text-amber-900 flex items-start justify-between gap-3",children:[n.jsxs("div",{children:[n.jsx("p",{className:"font-semibold text-[13px]",children:(()=>{const d=ke(i.odakanitNo),m=d&&he?he[d]:void 0,h=pt(i,m||void 0);return m!=null&&m.closedAt?"      .":h.lockType==="MANUAL"?"   .":h.lockType==="AUTO"&&h.lockAt?`    ${new Date(h.lockAt).toLocaleDateString("he-IL")}.`:"  ."})()}),n.jsx("p",{className:"mt-1 text-[11px]",children:'  ,    PDF,      "     .'})]}),(e==null?void 0:e.role)==="ADMIN"&&n.jsxs("div",{className:"flex flex-col items-end gap-2",children:[(()=>{const d=ke(i.odakanitNo),m=d&&he?he[d]:void 0,h=pt(i,m||void 0);return i.status==="SENT"&&!h.isLocked})()&&n.jsx("button",{type:"button",className:"shrink-0 inline-flex items-center rounded-full bg-panel px-3 py-1.5 text-[11px] font-semibold text-amber-900 border border-amber-300 hover:bg-amber-100",onClick:()=>{const d=window.prompt(`      .
 /     (  ):`);if(!d||!d.trim())return;w(i.id);const m=new Date().toISOString(),h=e.id,A=e.name;Ut({lastAdminOverrideAt:m,lastAdminOverrideById:h,lastAdminOverrideByName:A,lastAdminOverrideReason:d.trim()})},children:"  ()"}),(()=>{const d=ke(i.odakanitNo),m=d&&he?he[d]:void 0,h=pt(i,m||void 0),A=!h.isLocked&&!!i.firstSentAt&&!(m!=null&&m.closedAt),v=!(m!=null&&m.closedAt)&&!i.manualLockedAt&&!h.isLocked;return n.jsxs("div",{className:"flex flex-wrap gap-2 justify-end",children:[A&&n.jsx("button",{type:"button",className:"inline-flex items-center rounded-full bg-amber-100 px-3 py-1.5 text-[10px] font-semibold text-amber-900 border border-amber-300 hover:bg-amber-200",onClick:()=>{const M=window.prompt(`   -35  .
 /   (  ):`);if(!M||!M.trim())return;const $=new Date().toISOString(),B=i.lockExtensions||[];Ut({lockExtensions:[...B,{extendedAt:$,extendedById:e.id,extendedByName:e.name,days:35,reason:M.trim()}]})},children:"   (+35 )"}),v&&n.jsx("button",{type:"button",className:"inline-flex items-center rounded-full bg-amber-100 px-3 py-1.5 text-[10px] font-semibold text-amber-900 border border-amber-300 hover:bg-amber-200",onClick:()=>{const M=window.prompt(`     .
 /     (  ):`);if(!M||!M.trim())return;const $=new Date().toISOString();Ut({manualLockedAt:$,manualLockedById:e.id,manualLockedByName:e.name,manualLockReason:M.trim()})},children:"  "})]})})()]})]}),a==="STEP1"&&n.jsx(Lv,{data:i,updateData:Ut,onNext:()=>{if(i){const d=ke(i.odakanitNo),m=d&&he?he[d]:void 0;pt(i,m||void 0).isLocked||tn()}o("STEP2")},onBack:()=>{if(i){const d=ke(i.odakanitNo),m=d&&he?he[d]:void 0;pt(i,m||void 0).isLocked||tn()}o("DASHBOARD")},currentUser:e,timelineGallery:N,onAddTimelineImages:d=>x(m=>[...m,...d.map(h=>({...h,id:Date.now().toString()}))]),onRemoveTimelineImage:d=>x(m=>m.filter(h=>h.id!==d)),onSaveAndExit:()=>{if(i){const d=ke(i.odakanitNo),m=d&&he?he[d]:void 0;pt(i,m||void 0).isLocked||tn()}o("DASHBOARD")},readOnly:!!i&&(()=>{const d=ke(i.odakanitNo),m=d&&he?he[d]:void 0,h=pt(i,m||void 0),A=!!(m!=null&&m.closedAt),v=(e==null?void 0:e.role)==="ADMIN"&&S===i.id&&!A,M=(e==null?void 0:e.role)==="LAWYER"&&i.status==="SENT";return v?!1:M||A?!0:h.isLocked})()}),a==="STEP2"&&n.jsx(_v,{data:i,updateData:Ut,onNext:()=>{if(i){const d=ke(i.odakanitNo),m=d&&he?he[d]:void 0;pt(i,m||void 0).isLocked||tn()}o("PREVIEW")},onBack:()=>{if(i){const d=ke(i.odakanitNo),m=d&&he?he[d]:void 0;pt(i,m||void 0).isLocked||tn()}o("STEP1")},currentUser:e,timelineGallery:N,onAddTimelineImages:d=>{},onSaveAndExit:()=>{if(i){const d=ke(i.odakanitNo),m=d&&he?he[d]:void 0;pt(i,m||void 0).isLocked||tn()}o("DASHBOARD")},onSaveDraft:i&&(()=>{const d=ke(i.odakanitNo),m=d&&he?he[d]:void 0,h=pt(i,m||void 0);if(!((e==null?void 0:e.role)==="LAWYER"&&i.status==="SENT"||h.isLocked))return tn})(),onTranslate:i&&(()=>{const d=ke(i.odakanitNo),m=d&&he?he[d]:void 0,h=pt(i,m||void 0);if(!((e==null?void 0:e.role)==="LAWYER"&&i.status==="SENT"||h.isLocked))return Ti})(),onFormatContent:i&&(()=>{const d=ke(i.odakanitNo),m=d&&he?he[d]:void 0,h=pt(i,m||void 0);if(!((e==null?void 0:e.role)==="LAWYER"&&i.status==="SENT"||h.isLocked))return Gt})(),onSubmitHebrewForReview:i&&(()=>{const d=ke(i.odakanitNo),m=d&&he?he[d]:void 0,h=pt(i,m||void 0);if(!((e==null?void 0:e.role)==="LAWYER"&&i.status==="SENT"||h.isLocked))return()=>Fe(i.id)})(),onApproveHebrewForTranslation:i&&(()=>{const d=ke(i.odakanitNo),m=d&&he?he[d]:void 0,h=pt(i,m||void 0);if(!((e==null?void 0:e.role)==="LAWYER"&&i.status==="SENT"||h.isLocked))return()=>et(i.id)})(),onAddReviewIssues:i&&(()=>{const d=ke(i.odakanitNo),m=d&&he?he[d]:void 0,h=pt(i,m||void 0);if(!((e==null?void 0:e.role)==="LAWYER"&&i.status==="SENT"||h.isLocked))return v=>jn(i.id,v)})(),onMarkReviewIssueDone:i&&(()=>{const d=ke(i.odakanitNo),m=d&&he?he[d]:void 0,h=pt(i,m||void 0);if(!((e==null?void 0:e.role)==="LAWYER"&&i.status==="SENT"||h.isLocked))return v=>En(i.id,v)})(),onAddExternalFeedbackIssues:i&&(()=>{const d=ke(i.odakanitNo),m=d&&he?he[d]:void 0,h=pt(i,m||void 0);if(!((e==null?void 0:e.role)==="LAWYER"&&i.status==="SENT"||h.isLocked))return(v,M)=>Co(i.id,v,M)})(),onReopenHebrewDueToExternalFeedback:i&&(()=>{const d=ke(i.odakanitNo),m=d&&he?he[d]:void 0,h=pt(i,m||void 0);if(!((e==null?void 0:e.role)==="LAWYER"&&i.status==="SENT"||h.isLocked))return()=>xa(i.id)})(),step1Focus:k,onStep1FocusConsumed:()=>U(null),isTranslating:st,isImprovingEnglish:J,onImproveEnglish:i&&(()=>{const d=ke(i.odakanitNo),m=d&&he?he[d]:void 0,h=pt(i,m||void 0);if(!((e==null?void 0:e.role)==="LAWYER"&&i.status==="SENT"||h.isLocked))return Ri})(),onOpenAssistant:()=>Pe(!0),onActiveSectionChange:d=>is(d),readOnly:!!i&&(()=>{const d=(e==null?void 0:e.role)==="ADMIN"&&S===i.id;if(!i)return!1;const m=ke(i.odakanitNo),h=m&&he?he[m]:void 0,A=pt(i,h||void 0);return!d&&A.isLocked})()}),a==="PREVIEW"&&(()=>{const d=xv(e==null?void 0:e.role),m=(e==null?void 0:e.role)==="LAWYER";return n.jsxs("div",{className:"space-y-6 animate-fade-in",dir:m?"rtl":void 0,lang:m?"he":void 0,children:[n.jsxs("div",{className:"flex justify-between items-center flex-wrap gap-2",children:[n.jsxs("button",{onClick:()=>{tn(),o("STEP2")},className:"flex items-center text-sm text-textMuted bg-navySecondary px-3 py-1.5 rounded-full hover:bg-borderDark",children:[n.jsx(Ql,{className:"w-4 h-4 mr-1"}),d.backToStep2]}),n.jsxs("button",{onClick:()=>{tn(),o("DASHBOARD")},className:"flex items-center text-sm text-lpBlue bg-blue-50 px-3 py-1.5 rounded-full hover:bg-blue-100",children:[n.jsx(Du,{className:"w-4 h-4 mr-1"}),d.backToDashboard]})]}),n.jsxs("div",{className:"flex justify-between items-center bg-panel p-4 rounded shadow mb-4",children:[n.jsxs("div",{children:[n.jsx("h2",{className:"text-xl font-bold text-lpBlue",children:d.title}),n.jsx("p",{className:"mt-1 text-xs text-textMuted",children:"Export options let you back up the current report data (JSON/CSV) in addition to the PDF."})]}),n.jsxs("div",{className:"flex gap-2 flex-wrap justify-end items-center",children:[n.jsxs("button",{type:"button",onClick:()=>Pe(!0),className:"flex items-center text-[11px] px-3 py-1.5 rounded-full bg-indigo-50 text-indigo-800 border border-indigo-200 hover:bg-indigo-100",title:"         PDF.",children:[n.jsx(aa,{className:"w-3 h-3 mr-1"})," "]}),n.jsx("button",{onClick:()=>F(h=>!h),className:"flex items-center bg-borderDark text-textLight px-4 py-2 rounded hover:bg-borderDark",children:b?d.toggleHide:d.toggleShow}),n.jsxs("button",{onClick:Li,disabled:qe,className:"flex items-center bg-panel text-textLight border border-borderDark px-4 py-2 rounded hover:bg-navySecondary disabled:opacity-50",children:[qe?n.jsx(Lt,{className:"w-4 h-4 mr-2 animate-spin"}):n.jsx(go,{className:"w-4 h-4 mr-2"}),d.downloadPdf]}),n.jsx("button",{onClick:()=>Ge(!0),disabled:!f,className:"flex items-center bg-panel text-textLight border border-borderDark px-4 py-2 rounded hover:bg-navySecondary disabled:opacity-40",children:d.editFileNames}),n.jsx("button",{onClick:()=>{const h={report:i},A=new Blob([JSON.stringify(h,null,2)],{type:"application/json"}),v=URL.createObjectURL(A),M=document.createElement("a");M.href=v,M.download=`report-${i.odakanitNo||i.id}.json`,M.click(),URL.revokeObjectURL(v)},className:"flex items-center bg-panel text-textLight border border-borderDark px-3 py-2 rounded hover:bg-navySecondary text-xs",children:"JSON Export"}),n.jsx("button",{onClick:()=>{const h=["OdakanitNo","InsuredName","PlaintiffName","InsurerName","MarketRef","LineSlipNo","CertificateRef","ReportDate","Status"],A=[i.odakanitNo||"",i.insuredName||"",i.plaintiffName||"",i.insurerName||"",i.marketRef||"",i.lineSlipNo||"",i.certificateRef||"",i.reportDate||"",i.status||""],v=ie=>{const je=String(ie??"");return/[",\n]/.test(je)?`"${je.replace(/"/g,'""')}"`:je},M=[h.join(","),A.map(v).join(",")].join(`
`),$=new Blob(["\uFEFF"+M],{type:"text/csv;charset=utf-8;"}),B=URL.createObjectURL($),K=document.createElement("a");K.href=B,K.download=`report-${i.odakanitNo||i.id}.csv`,K.click(),URL.revokeObjectURL(B)},className:"flex items-center bg-panel text-textLight border border-borderDark px-3 py-2 rounded hover:bg-navySecondary text-xs",children:"CSV Export"}),n.jsxs("button",{onClick:_i,className:"flex items-center bg-green-600 text-white px-4 py-2 rounded hover:bg-green-700",children:[n.jsx(Zl,{className:"w-4 h-4 mr-2"}),d.finalize]}),e.role==="ADMIN"&&n.jsxs("button",{onClick:Oi,className:"flex items-center bg-orange-600 text-white px-4 py-2 rounded hover:bg-orange-700",children:[n.jsx(Zl,{className:"w-4 h-4 mr-2"}),"   "]})]})]}),b?n.jsxs("div",{className:"bg-panel rounded-2xl shadow p-4 space-y-4",children:[n.jsx("div",{className:"flex items-center justify-end flex-wrap gap-3",children:n.jsx("span",{className:"text-xs text-textMuted",children:d.helperScroll})}),n.jsx("div",{className:"border rounded-2xl bg-navySecondary p-4 pr-6 max-h-[900px] overflow-auto shadow-inner",children:n.jsx("div",{className:"scale-[0.85] origin-top flex justify-center overflow-visible",children:n.jsx(oN,{data:i})})})]}):n.jsx("div",{className:"text-center text-textMuted border border-dashed border-borderDark rounded-2xl p-6 bg-navySecondary",children:d.collapsedHint}),n.jsx("div",{className:"flex justify-start mt-4",children:n.jsx("button",{onClick:()=>o("STEP2"),className:"px-6 py-2 bg-borderDark text-textLight rounded hover:bg-borderDark",children:d.backToEditing})})]})})()]})}),i&&n.jsx(SN,{isOpen:D,isSending:ee,report:i,userId:e==null?void 0:e.id,recipientsPreview:jr(i),defaultSubject:ps(i),subjectDraft:((me=i.emailSubjectDraft)==null?void 0:me.trim())||ps(i),onSubjectDraftChange:d=>Ut({emailSubjectDraft:d&&d.trim()?d.trim():void 0}),selectedTopics:i.fileNameTitles||[],onSelectedTopicsChange:d=>Ut({fileNameTitles:d}),isResendMode:Oe,onClose:()=>{ee||(Ae(!1),ae(!1))},onSend:Oe?Pi:Mi}),i&&n.jsx(wN,{isOpen:Re,availableTitles:Bo,selectedTitles:$o,onClose:()=>Ge(!1),onSave:d=>{const m=d.map(h=>h.trim()).filter(Boolean);Ut({fileNameTitles:m}),Ge(!1)}}),n.jsx(lv,{isOpen:He,onClose:()=>{Pe(!1)},view:a,currentUser:e,currentReport:i,loading:Q,error:_,response:de,onRunIntent:Kn}),O&&n.jsx("div",{className:"fixed inset-0 bg-black/40 z-[200] flex items-center justify-center p-4",children:n.jsxs("div",{className:"bg-panel rounded-xl shadow-xl w-full max-w-md p-6 space-y-4",children:[n.jsxs("h3",{className:"text-lg font-bold text-textLight flex items-center gap-2",children:[n.jsx(Lu,{className:"w-4 h-4"})," Add Note"]}),n.jsxs("p",{className:"text-sm text-textMuted",children:["Case: ",O.insuredName||O.odakanitNo||O.id]}),n.jsx(ho,{clientId:vo,children:n.jsx("textarea",{className:"w-full border rounded p-3 text-sm",rows:4,value:X,onChange:d=>ue(d.target.value),placeholder:"Write your note..."})}),n.jsxs("div",{className:"flex justify-end gap-2",children:[n.jsx("button",{onClick:()=>{P(null),ue("")},className:"px-4 py-2 text-textMuted hover:bg-navySecondary rounded",children:"Cancel"}),n.jsx("button",{onClick:()=>{O&&X.trim()&&(Fi(O.id,X.trim()),P(null),ue(""))},className:"px-4 py-2 bg-navy text-white rounded hover:bg-navySecondary",children:"Save"})]})]})}),xe&&n.jsx("div",{className:"fixed inset-0 bg-black/40 z-[200] flex items-center justify-center p-4",children:n.jsxs("div",{className:"bg-panel rounded-xl shadow-xl w-full max-w-md p-6 space-y-4",children:[n.jsxs("h3",{className:"text-lg font-bold text-textLight flex items-center gap-2",children:[n.jsx(Jl,{className:"w-4 h-4"})," Send Reminder"]}),n.jsxs("p",{className:"text-sm text-textMuted",children:["Case: ",xe.insuredName||xe.odakanitNo||xe.id]}),n.jsx("label",{className:"text-xs font-bold text-textMuted",children:"Recipients"}),n.jsxs("select",{className:"w-full border rounded p-2 text-sm",value:_e,onChange:d=>ze(d.target.value),children:[n.jsx("option",{value:"LAWYER",children:"Lawyer"}),n.jsx("option",{value:"SUB_ADMIN",children:"Sub-Admin"}),n.jsx("option",{value:"BOTH",children:"Both"})]}),n.jsx("label",{className:"text-xs font-bold text-textMuted",children:"Message"}),n.jsx(ho,{clientId:vo,children:n.jsx("textarea",{className:"w-full border rounded p-3 text-sm",rows:4,value:fe,onChange:d=>ve(d.target.value),placeholder:"Reminder details..."})}),n.jsxs("div",{className:"flex justify-end gap-2",children:[n.jsx("button",{onClick:()=>{oe(null),ve("")},className:"px-4 py-2 text-textMuted hover:bg-navySecondary rounded",children:"Cancel"}),n.jsx("button",{onClick:()=>{if(xe&&fe.trim()){const d=[];(_e==="LAWYER"||_e==="BOTH")&&d.push(xe.ownerName),(_e==="SUB_ADMIN"||_e==="BOTH")&&d.push(...vs.filter(m=>m.role==="SUB_ADMIN").map(m=>m.name)),wr({id:`reminder-${Date.now()}`,message:`Reminder to ${d.join(", ")}: ${fe.trim()}`,createdAt:new Date().toISOString(),reportId:xe.id}),oe(null),ve("")}},className:"px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700",children:"Send"})]})]})}),Gi&&n.jsx("div",{className:"fixed inset-0 bg-black/50 z-[250] flex items-center justify-center p-4",dir:"rtl",children:n.jsxs("div",{className:"bg-panel rounded-2xl shadow-2xl w-full max-w-md p-6 space-y-4",children:[n.jsx("h3",{className:"text-lg font-bold text-gold",children:"  "}),n.jsx("p",{className:"text-sm text-textLight",children:"     .        ."}),n.jsxs("div",{className:"flex flex-wrap gap-2 justify-end",children:[n.jsx("button",{type:"button",onClick:()=>{wv(l,i,he),Ar(!0)},className:"px-4 py-2 rounded-lg bg-navy text-gold text-sm font-semibold hover:bg-navySecondary",children:" "}),n.jsx("button",{type:"button",onClick:qi,disabled:!Na,title:Na?"":"    ",className:"px-4 py-2 rounded-lg bg-red-600 text-white text-sm font-semibold hover:bg-red-700 disabled:opacity-50 disabled:cursor-not-allowed",children:""}),n.jsx("button",{type:"button",onClick:()=>{ya(!1),Ar(!1)},className:"px-4 py-2 rounded-lg border border-borderDark text-textLight text-sm hover:bg-navySecondary",children:""})]}),Na&&n.jsx("p",{className:"text-xs text-green-600",children:" .   ."})]})}),Yt&&Yt.issues.length>0&&n.jsx("div",{className:"fixed inset-0 bg-black/40 z-[210] flex items-center justify-center p-4",children:n.jsxs("div",{className:"bg-panel rounded-2xl shadow-2xl w-full max-w-lg p-6 space-y-4",dir:"rtl",children:[n.jsxs("div",{className:"flex items-center justify-between gap-2",children:[n.jsx("h3",{className:"text-lg font-bold text-textLight",children:"  "}),n.jsx("button",{type:"button",onClick:()=>Ht(null),className:"p-1 rounded hover:bg-slate-100 text-textMuted",children:n.jsx(Ot,{className:"w-4 h-4"})})]}),n.jsx("p",{className:"text-xs text-textMuted",children:"       PDF    .       ."}),n.jsx("ul",{className:"space-y-2 text-sm text-textLight",children:Yt.issues.map(d=>n.jsxs("li",{className:"flex items-start justify-between gap-3 border border-slate-100 rounded-md px-3 py-2 bg-slate-50",children:[n.jsx("span",{className:"flex-1",children:d.label}),n.jsxs("div",{className:"flex flex-col items-end gap-1",children:[n.jsx("button",{type:"button",className:"text-[11px] text-indigo-700 hover:text-indigo-900 underline whitespace-nowrap",onClick:()=>{Pe(!0),Kn(d.intent)},children:"  ?"}),n.jsx("button",{type:"button",className:"text-[11px] text-textLight hover:text-textLight underline whitespace-nowrap",onClick:()=>{Ht(null),(d.kind==="TRANSLATION_OUTDATED"||d.kind==="TONE_RISK_NOT_RUN"||d.kind==="EXPENSES_OLD")&&(tn(),o("STEP2"))},children:d.kind==="TRANSLATION_OUTDATED"?" ":d.kind==="TONE_RISK_NOT_RUN"?" Tone & Risk":d.kind==="EXPENSES_OLD"?"  ":" "})]})]},d.id))}),n.jsx("div",{className:"flex items-center justify-between pt-3 border-t border-slate-100 gap-3",children:n.jsx("button",{type:"button",className:"px-4 py-1.5 rounded-md bg-green-600 text-xs text-white hover:bg-green-700",onClick:()=>{const d=Yt;Ht(null),d!=null&&d.onContinue&&d.onContinue()},children:"  "})})]})}),z&&n.jsx(Bv,{report:z,sessions:R,onSwitch:C,onClose:ki,currentUser:e,onAddRowNote:$i,onResolveRowNote:Wi,onAddWorksheetRow:zi,previousReport:l.filter(d=>d.id!==z.id&&d.odakanitNo&&d.odakanitNo===z.odakanitNo).sort((d,m)=>new Date(m.reportDate).getTime()-new Date(d.reportDate).getTime())[0]})]})},Bv=({report:e,sessions:t,onSwitch:s,onClose:r,currentUser:a,onAddRowNote:o,onResolveRowNote:l,onAddWorksheetRow:c,previousReport:i})=>{const[u,p]=g.useState("table"),[y,S]=g.useState(""),[w,L]=g.useState(null),[k,U]=g.useState({category:"EXPERT_OUR",serviceProvider:"",amount:"",customLabel:""}),N=e.expenseWorksheet||Ps(),x=N.rows.filter(j=>j.type==="EXPENSE"),b=N.rows.filter(j=>j.type==="ADJUSTMENT"),F=N.notes.filter(j=>!j.resolved),H=N.totals||oi(N.rows),V=(a==null?void 0:a.role)==="FINANCE"||(a==null?void 0:a.role)==="SUB_ADMIN",q=ss.find(j=>j.value===k.category),te=(q==null?void 0:q.type)!=="ADJUSTMENT",G=j=>{y.trim()&&(o(e.id,j,y.trim()),S(""),L(null))},le=()=>{const j=parseFloat(k.amount);isNaN(j)||j<=0||(c(e.id,{category:k.category,serviceProvider:te?k.serviceProvider:void 0,amount:j,customLabel:k.customLabel}),U({category:"EXPERT_OUR",serviceProvider:"",amount:"",customLabel:""}))};return n.jsx("div",{className:"fixed inset-0 bg-black/40 z-[220] flex items-center justify-center p-4",children:n.jsxs("div",{className:"bg-panel rounded-2xl shadow-2xl w-full max-w-5xl max-h-[90vh] overflow-hidden flex flex-col",children:[n.jsxs("div",{className:"flex justify-between items-center px-5 py-3 border-b bg-navySecondary",children:[n.jsxs("div",{children:[n.jsx("p",{className:"text-xs text-textMuted uppercase",children:"Expense Worksheet"}),n.jsxs("h2",{className:"text-lg font-bold text-textLight",children:[e.insuredName||e.odakanitNo||"Case","  ",e.ownerName]})]}),n.jsx("button",{onClick:()=>r(e.id),className:"text-textMuted hover:text-textLight",children:n.jsx(Ot,{className:"w-5 h-5"})})]}),n.jsx("div",{className:"flex border-b bg-panel px-4 overflow-x-auto",children:t.map(j=>n.jsxs("button",{onClick:()=>s(j.reportId),className:`flex items-center gap-2 px-3 py-2 text-sm border-b-2 ${j.reportId===e.id?"border-lpBlue text-lpBlue font-bold":"border-transparent text-gray-400"}`,children:[j.title,n.jsx("span",{onClick:T=>{T.stopPropagation(),r(j.reportId)},className:"text-gray-400 hover:text-red-500",children:n.jsx(Ot,{className:"w-3 h-3"})})]},j.reportId))}),n.jsx("div",{className:"flex gap-2 px-5 pt-4 text-sm font-semibold",children:["table","history","notes","compare"].map(j=>n.jsx("button",{onClick:()=>p(j),className:`px-3 py-1 rounded-full ${u===j?"bg-navy text-white":"bg-navySecondary text-textMuted"}`,children:j==="table"?"Worksheet":j==="history"?"History":j==="notes"?`Notes (${F.length})`:"Compare"},j))}),n.jsxs("div",{className:"flex-1 overflow-auto p-5 space-y-4",children:[u==="table"&&n.jsxs(n.Fragment,{children:[n.jsxs("div",{className:"grid grid-cols-3 gap-4 text-center bg-navySecondary rounded-lg py-3",children:[n.jsxs("div",{children:[n.jsx("p",{className:"text-xs uppercase text-gray-400",children:"Total Expenses"}),n.jsxs("p",{className:"text-lg font-bold text-textLight",children:["",H.totalExpenses.toLocaleString()]})]}),n.jsxs("div",{children:[n.jsx("p",{className:"text-xs uppercase text-gray-400",children:"Adjustments"}),n.jsxs("p",{className:"text-lg font-bold text-yellow-700",children:["",H.totalAdjustments.toLocaleString()]})]}),n.jsxs("div",{children:[n.jsx("p",{className:"text-xs uppercase text-gray-400",children:"Balance Due"}),n.jsxs("p",{className:"text-lg font-bold text-green-700",children:["",H.totalBalance.toLocaleString()]})]})]}),V&&n.jsxs("div",{className:"border rounded-lg p-3 bg-amber-50 space-y-2",children:[n.jsx("p",{className:"text-xs font-bold text-amber-700",children:"  "}),n.jsxs("div",{className:"grid md:grid-cols-3 gap-2",children:[n.jsx("select",{value:k.category,onChange:j=>U({...k,category:j.target.value}),className:"border rounded text-xs p-2",children:ss.map(j=>n.jsx("option",{value:j.value,children:j.label},j.value))}),k.category==="OTHER"&&n.jsx("input",{className:"border rounded text-xs p-2",placeholder:" ",value:k.customLabel,onChange:j=>U({...k,customLabel:j.target.value})}),te&&n.jsx("input",{className:"border rounded text-xs p-2",placeholder:" ",value:k.serviceProvider,onChange:j=>U({...k,serviceProvider:j.target.value})}),n.jsx("input",{className:"border rounded text-xs p-2",placeholder:" ",type:"number",min:"0",value:k.amount,onChange:j=>U({...k,amount:j.target.value})}),n.jsx("button",{onClick:le,className:"bg-amber-500 text-white rounded text-xs font-bold px-3 py-2 hover:bg-amber-600",children:"Add"})]})]}),n.jsxs("div",{className:"grid md:grid-cols-2 gap-6",children:[n.jsxs("div",{children:[n.jsx("h4",{className:"text-sm font-bold text-textMuted mb-2",children:"Service Expenses"}),n.jsxs("div",{className:"space-y-2",children:[x.length===0&&n.jsx("p",{className:"text-xs text-gray-400",children:"No expenses recorded."}),x.map(j=>{const T=N.notes.filter(E=>E.rowId===j.id&&!E.resolved).length;return n.jsxs("div",{className:"border rounded-lg p-3 bg-panel shadow-sm",children:[n.jsxs("div",{className:"flex justify-between",children:[n.jsxs("div",{children:[n.jsx("p",{className:"font-semibold text-sm",children:j.label}),j.serviceProvider&&n.jsx("p",{className:"text-xs text-textMuted",children:j.serviceProvider})]}),n.jsxs("div",{className:"text-right",children:[n.jsxs("p",{className:"font-bold text-lpBlue",children:["",j.amount.toLocaleString()]}),n.jsxs("button",{className:"text-[10px] text-gray-400",onClick:()=>L(w===j.id?null:j.id),children:[" Notes (",T,")"]})]})]}),w===j.id&&n.jsxs("div",{className:"mt-2 flex gap-2",children:[n.jsx("input",{className:"flex-1 border rounded text-xs p-2",value:y,onChange:E=>S(E.target.value),placeholder:"Add note..."}),n.jsx("button",{onClick:()=>G(j.id),className:"px-3 py-1 text-xs bg-navy text-white rounded",children:"Save"})]})]},j.id)})]})]}),n.jsxs("div",{children:[n.jsx("h4",{className:"text-sm font-bold text-textMuted mb-2",children:"Adjustments"}),n.jsxs("div",{className:"space-y-2",children:[b.length===0&&n.jsx("p",{className:"text-xs text-gray-400",children:"No adjustments yet."}),b.map(j=>n.jsx("div",{className:"border rounded-lg p-3 bg-navySecondary",children:n.jsxs("div",{className:"flex justify-between",children:[n.jsx("p",{className:"font-semibold text-sm",children:j.label}),n.jsxs("p",{className:"font-bold text-red-600",children:["",j.amount.toLocaleString()]})]})},j.id))]})]})]}),n.jsxs("div",{className:"border rounded-lg p-3 bg-navySecondary",children:[n.jsx("label",{className:"block text-xs font-bold text-textMuted mb-1",children:"General Note"}),n.jsxs("div",{className:"flex gap-2",children:[n.jsx("input",{className:"flex-1 border rounded text-xs p-2",value:y,onChange:j=>S(j.target.value),placeholder:"Add note for worksheet..."}),n.jsx("button",{onClick:()=>G(void 0),className:"px-3 py-1 text-xs bg-navy text-white rounded",children:"Save"})]})]})]}),u==="history"&&n.jsxs("div",{className:"space-y-2",children:[N.history.length===0&&n.jsx("p",{className:"text-xs text-gray-400",children:"No history recorded yet."}),N.history.map(j=>n.jsxs("div",{className:"border rounded-lg p-3 bg-panel flex justify-between",children:[n.jsxs("div",{children:[n.jsx("p",{className:"text-sm font-semibold",children:j.action}),j.details&&n.jsx("p",{className:"text-xs text-textMuted",children:j.details})]}),n.jsxs("div",{className:"text-right text-[10px] text-gray-400",children:[n.jsx("p",{children:j.userName}),n.jsx("p",{children:new Date(j.timestamp).toLocaleString()})]})]},j.id))]}),u==="notes"&&n.jsxs("div",{className:"space-y-2",children:[N.notes.length===0&&n.jsx("p",{className:"text-xs text-gray-400",children:"No notes yet."}),N.notes.map(j=>n.jsx("div",{className:`border rounded-lg p-3 ${j.resolved?"bg-green-50":"bg-panel"}`,children:n.jsxs("div",{className:"flex justify-between",children:[n.jsxs("div",{children:[n.jsx("p",{className:"text-sm font-semibold",children:j.authorName}),n.jsx("p",{className:"text-xs text-textMuted",children:j.message})]}),n.jsxs("div",{className:"text-right text-[10px] text-gray-400",children:[n.jsx("p",{children:new Date(j.createdAt).toLocaleString()}),!j.resolved&&n.jsx("button",{onClick:()=>l(e.id,j.id),className:"text-xs text-green-600 hover:underline",children:"Resolve"})]})]})},j.id))]}),u==="compare"&&n.jsx("div",{children:i!=null&&i.expenseWorksheet?n.jsxs("div",{className:"grid md:grid-cols-2 gap-4",children:[n.jsxs("div",{className:"border rounded-lg p-3",children:[n.jsx("h4",{className:"text-sm font-bold text-textMuted mb-2",children:"Previous Report"}),n.jsx("p",{className:"text-xs text-gray-400 mb-2",children:new Date(i.reportDate).toLocaleDateString()}),n.jsxs("p",{className:"text-lg font-bold text-textLight",children:["",i.expenseWorksheet.totals.totalBalance.toLocaleString()]})]}),n.jsxs("div",{className:"border rounded-lg p-3",children:[n.jsx("h4",{className:"text-sm font-bold text-textMuted mb-2",children:"Current Report"}),n.jsx("p",{className:"text-xs text-gray-400 mb-2",children:new Date(e.reportDate).toLocaleDateString()}),n.jsxs("p",{className:"text-lg font-bold text-textLight",children:["",H.totalBalance.toLocaleString()]})]})]}):n.jsx("p",{className:"text-xs text-gray-400",children:"No previous worksheet available for comparison."})})]})]})})},$v=()=>n.jsx(Xb,{children:n.jsx(Fv,{})}),Gu=document.getElementById("root");console.log("Bootstrapping LP app, rootElement exists?",!!Gu);if(!Gu)throw new Error("Could not find root element to mount to");const Hv=Pc.createRoot(Gu);Hv.render(n.jsx(ci.StrictMode,{children:n.jsx($v,{})}));export{Gh as g};
