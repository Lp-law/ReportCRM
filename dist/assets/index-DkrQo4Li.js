(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))r(a);new MutationObserver(a=>{for(const o of a)if(o.type==="childList")for(const l of o.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&r(l)}).observe(document,{childList:!0,subtree:!0});function s(a){const o={};return a.integrity&&(o.integrity=a.integrity),a.referrerPolicy&&(o.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?o.credentials="include":a.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function r(a){if(a.ep)return;a.ep=!0;const o=s(a);fetch(a.href,o)}})();function Qh(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var Gp={exports:{}},di={},qp={exports:{}},tt={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var ko=Symbol.for("react.element"),Zh=Symbol.for("react.portal"),eg=Symbol.for("react.fragment"),tg=Symbol.for("react.strict_mode"),ng=Symbol.for("react.profiler"),sg=Symbol.for("react.provider"),rg=Symbol.for("react.context"),ag=Symbol.for("react.forward_ref"),og=Symbol.for("react.suspense"),lg=Symbol.for("react.memo"),ig=Symbol.for("react.lazy"),Qu=Symbol.iterator;function cg(e){return e===null||typeof e!="object"?null:(e=Qu&&e[Qu]||e["@@iterator"],typeof e=="function"?e:null)}var Xp={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},Jp=Object.assign,Qp={};function ua(e,t,s){this.props=e,this.context=t,this.refs=Qp,this.updater=s||Xp}ua.prototype.isReactComponent={};ua.prototype.setState=function(e,t){if(typeof e!="object"&&typeof e!="function"&&e!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,e,t,"setState")};ua.prototype.forceUpdate=function(e){this.updater.enqueueForceUpdate(this,e,"forceUpdate")};function Zp(){}Zp.prototype=ua.prototype;function Bd(e,t,s){this.props=e,this.context=t,this.refs=Qp,this.updater=s||Xp}var $d=Bd.prototype=new Zp;$d.constructor=Bd;Jp($d,ua.prototype);$d.isPureReactComponent=!0;var Zu=Array.isArray,ef=Object.prototype.hasOwnProperty,Hd={current:null},tf={key:!0,ref:!0,__self:!0,__source:!0};function nf(e,t,s){var r,a={},o=null,l=null;if(t!=null)for(r in t.ref!==void 0&&(l=t.ref),t.key!==void 0&&(o=""+t.key),t)ef.call(t,r)&&!tf.hasOwnProperty(r)&&(a[r]=t[r]);var c=arguments.length-2;if(c===1)a.children=s;else if(1<c){for(var i=Array(c),u=0;u<c;u++)i[u]=arguments[u+2];a.children=i}if(e&&e.defaultProps)for(r in c=e.defaultProps,c)a[r]===void 0&&(a[r]=c[r]);return{$$typeof:ko,type:e,key:o,ref:l,props:a,_owner:Hd.current}}function dg(e,t){return{$$typeof:ko,type:e.type,key:t,ref:e.ref,props:e.props,_owner:e._owner}}function Ud(e){return typeof e=="object"&&e!==null&&e.$$typeof===ko}function ug(e){var t={"=":"=0",":":"=2"};return"$"+e.replace(/[=:]/g,function(s){return t[s]})}var em=/\/+/g;function Ji(e,t){return typeof e=="object"&&e!==null&&e.key!=null?ug(""+e.key):t.toString(36)}function hl(e,t,s,r,a){var o=typeof e;(o==="undefined"||o==="boolean")&&(e=null);var l=!1;if(e===null)l=!0;else switch(o){case"string":case"number":l=!0;break;case"object":switch(e.$$typeof){case ko:case Zh:l=!0}}if(l)return l=e,a=a(l),e=r===""?"."+Ji(l,0):r,Zu(a)?(s="",e!=null&&(s=e.replace(em,"$&/")+"/"),hl(a,t,s,"",function(u){return u})):a!=null&&(Ud(a)&&(a=dg(a,s+(!a.key||l&&l.key===a.key?"":(""+a.key).replace(em,"$&/")+"/")+e)),t.push(a)),1;if(l=0,r=r===""?".":r+":",Zu(e))for(var c=0;c<e.length;c++){o=e[c];var i=r+Ji(o,c);l+=hl(o,t,s,i,a)}else if(i=cg(e),typeof i=="function")for(e=i.call(e),c=0;!(o=e.next()).done;)o=o.value,i=r+Ji(o,c++),l+=hl(o,t,s,i,a);else if(o==="object")throw t=String(e),Error("Objects are not valid as a React child (found: "+(t==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":t)+"). If you meant to render a collection of children, use an array instead.");return l}function Ko(e,t,s){if(e==null)return e;var r=[],a=0;return hl(e,r,"","",function(o){return t.call(s,o,a++)}),r}function mg(e){if(e._status===-1){var t=e._result;t=t(),t.then(function(s){(e._status===0||e._status===-1)&&(e._status=1,e._result=s)},function(s){(e._status===0||e._status===-1)&&(e._status=2,e._result=s)}),e._status===-1&&(e._status=0,e._result=t)}if(e._status===1)return e._result.default;throw e._result}var xn={current:null},gl={transition:null},pg={ReactCurrentDispatcher:xn,ReactCurrentBatchConfig:gl,ReactCurrentOwner:Hd};function sf(){throw Error("act(...) is not supported in production builds of React.")}tt.Children={map:Ko,forEach:function(e,t,s){Ko(e,function(){t.apply(this,arguments)},s)},count:function(e){var t=0;return Ko(e,function(){t++}),t},toArray:function(e){return Ko(e,function(t){return t})||[]},only:function(e){if(!Ud(e))throw Error("React.Children.only expected to receive a single React element child.");return e}};tt.Component=ua;tt.Fragment=eg;tt.Profiler=ng;tt.PureComponent=Bd;tt.StrictMode=tg;tt.Suspense=og;tt.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=pg;tt.act=sf;tt.cloneElement=function(e,t,s){if(e==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+e+".");var r=Jp({},e.props),a=e.key,o=e.ref,l=e._owner;if(t!=null){if(t.ref!==void 0&&(o=t.ref,l=Hd.current),t.key!==void 0&&(a=""+t.key),e.type&&e.type.defaultProps)var c=e.type.defaultProps;for(i in t)ef.call(t,i)&&!tf.hasOwnProperty(i)&&(r[i]=t[i]===void 0&&c!==void 0?c[i]:t[i])}var i=arguments.length-2;if(i===1)r.children=s;else if(1<i){c=Array(i);for(var u=0;u<i;u++)c[u]=arguments[u+2];r.children=c}return{$$typeof:ko,type:e.type,key:a,ref:o,props:r,_owner:l}};tt.createContext=function(e){return e={$$typeof:rg,_currentValue:e,_currentValue2:e,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},e.Provider={$$typeof:sg,_context:e},e.Consumer=e};tt.createElement=nf;tt.createFactory=function(e){var t=nf.bind(null,e);return t.type=e,t};tt.createRef=function(){return{current:null}};tt.forwardRef=function(e){return{$$typeof:ag,render:e}};tt.isValidElement=Ud;tt.lazy=function(e){return{$$typeof:ig,_payload:{_status:-1,_result:e},_init:mg}};tt.memo=function(e,t){return{$$typeof:lg,type:e,compare:t===void 0?null:t}};tt.startTransition=function(e){var t=gl.transition;gl.transition={};try{e()}finally{gl.transition=t}};tt.unstable_act=sf;tt.useCallback=function(e,t){return xn.current.useCallback(e,t)};tt.useContext=function(e){return xn.current.useContext(e)};tt.useDebugValue=function(){};tt.useDeferredValue=function(e){return xn.current.useDeferredValue(e)};tt.useEffect=function(e,t){return xn.current.useEffect(e,t)};tt.useId=function(){return xn.current.useId()};tt.useImperativeHandle=function(e,t,s){return xn.current.useImperativeHandle(e,t,s)};tt.useInsertionEffect=function(e,t){return xn.current.useInsertionEffect(e,t)};tt.useLayoutEffect=function(e,t){return xn.current.useLayoutEffect(e,t)};tt.useMemo=function(e,t){return xn.current.useMemo(e,t)};tt.useReducer=function(e,t,s){return xn.current.useReducer(e,t,s)};tt.useRef=function(e){return xn.current.useRef(e)};tt.useState=function(e){return xn.current.useState(e)};tt.useSyncExternalStore=function(e,t,s){return xn.current.useSyncExternalStore(e,t,s)};tt.useTransition=function(){return xn.current.useTransition()};tt.version="18.3.1";qp.exports=tt;var g=qp.exports;const ui=Qh(g);/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var fg=g,xg=Symbol.for("react.element"),hg=Symbol.for("react.fragment"),gg=Object.prototype.hasOwnProperty,yg=fg.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,bg={key:!0,ref:!0,__self:!0,__source:!0};function rf(e,t,s){var r,a={},o=null,l=null;s!==void 0&&(o=""+s),t.key!==void 0&&(o=""+t.key),t.ref!==void 0&&(l=t.ref);for(r in t)gg.call(t,r)&&!bg.hasOwnProperty(r)&&(a[r]=t[r]);if(e&&e.defaultProps)for(r in t=e.defaultProps,t)a[r]===void 0&&(a[r]=t[r]);return{$$typeof:xg,type:e,key:o,ref:l,props:a,_owner:yg.current}}di.Fragment=hg;di.jsx=rf;di.jsxs=rf;Gp.exports=di;var n=Gp.exports,Bc={},af={exports:{}},Tn={},of={exports:{}},lf={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(e){function t(D,J){var ue=D.length;D.push(J);e:for(;0<ue;){var ce=ue-1>>>1,le=D[ce];if(0<a(le,J))D[ce]=J,D[ue]=le,ue=ce;else break e}}function s(D){return D.length===0?null:D[0]}function r(D){if(D.length===0)return null;var J=D[0],ue=D.pop();if(ue!==J){D[0]=ue;e:for(var ce=0,le=D.length,fe=le>>>1;ce<fe;){var Ee=2*(ce+1)-1,ve=D[Ee],$e=Ee+1,Ze=D[$e];if(0>a(ve,ue))$e<le&&0>a(Ze,ve)?(D[ce]=Ze,D[$e]=ue,ce=$e):(D[ce]=ve,D[Ee]=ue,ce=Ee);else if($e<le&&0>a(Ze,ue))D[ce]=Ze,D[$e]=ue,ce=$e;else break e}}return J}function a(D,J){var ue=D.sortIndex-J.sortIndex;return ue!==0?ue:D.id-J.id}if(typeof performance=="object"&&typeof performance.now=="function"){var o=performance;e.unstable_now=function(){return o.now()}}else{var l=Date,c=l.now();e.unstable_now=function(){return l.now()-c}}var i=[],u=[],p=1,y=null,N=3,w=!1,R=!1,E=!1,W=typeof setTimeout=="function"?setTimeout:null,b=typeof clearTimeout=="function"?clearTimeout:null,h=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function S(D){for(var J=s(u);J!==null;){if(J.callback===null)r(u);else if(J.startTime<=D)r(u),J.sortIndex=J.expirationTime,t(i,J);else break;J=s(u)}}function P(D){if(E=!1,S(D),!R)if(s(i)!==null)R=!0,M(U);else{var J=s(u);J!==null&&I(P,J.startTime-D)}}function U(D,J){R=!1,E&&(E=!1,b(ee),ee=-1),w=!0;var ue=N;try{for(S(J),y=s(i);y!==null&&(!(y.expirationTime>J)||D&&!j());){var ce=y.callback;if(typeof ce=="function"){y.callback=null,N=y.priorityLevel;var le=ce(y.expirationTime<=J);J=e.unstable_now(),typeof le=="function"?y.callback=le:y===s(i)&&r(i),S(J)}else r(i);y=s(i)}if(y!==null)var fe=!0;else{var Ee=s(u);Ee!==null&&I(P,Ee.startTime-J),fe=!1}return fe}finally{y=null,N=ue,w=!1}}var z=!1,q=null,ee=-1,G=5,se=-1;function j(){return!(e.unstable_now()-se<G)}function F(){if(q!==null){var D=e.unstable_now();se=D;var J=!0;try{J=q(!0,D)}finally{J?L():(z=!1,q=null)}}else z=!1}var L;if(typeof h=="function")L=function(){h(F)};else if(typeof MessageChannel<"u"){var O=new MessageChannel,H=O.port2;O.port1.onmessage=F,L=function(){H.postMessage(null)}}else L=function(){W(F,0)};function M(D){q=D,z||(z=!0,L())}function I(D,J){ee=W(function(){D(e.unstable_now())},J)}e.unstable_IdlePriority=5,e.unstable_ImmediatePriority=1,e.unstable_LowPriority=4,e.unstable_NormalPriority=3,e.unstable_Profiling=null,e.unstable_UserBlockingPriority=2,e.unstable_cancelCallback=function(D){D.callback=null},e.unstable_continueExecution=function(){R||w||(R=!0,M(U))},e.unstable_forceFrameRate=function(D){0>D||125<D?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):G=0<D?Math.floor(1e3/D):5},e.unstable_getCurrentPriorityLevel=function(){return N},e.unstable_getFirstCallbackNode=function(){return s(i)},e.unstable_next=function(D){switch(N){case 1:case 2:case 3:var J=3;break;default:J=N}var ue=N;N=J;try{return D()}finally{N=ue}},e.unstable_pauseExecution=function(){},e.unstable_requestPaint=function(){},e.unstable_runWithPriority=function(D,J){switch(D){case 1:case 2:case 3:case 4:case 5:break;default:D=3}var ue=N;N=D;try{return J()}finally{N=ue}},e.unstable_scheduleCallback=function(D,J,ue){var ce=e.unstable_now();switch(typeof ue=="object"&&ue!==null?(ue=ue.delay,ue=typeof ue=="number"&&0<ue?ce+ue:ce):ue=ce,D){case 1:var le=-1;break;case 2:le=250;break;case 5:le=1073741823;break;case 4:le=1e4;break;default:le=5e3}return le=ue+le,D={id:p++,callback:J,priorityLevel:D,startTime:ue,expirationTime:le,sortIndex:-1},ue>ce?(D.sortIndex=ue,t(u,D),s(i)===null&&D===s(u)&&(E?(b(ee),ee=-1):E=!0,I(P,ue-ce))):(D.sortIndex=le,t(i,D),R||w||(R=!0,M(U))),D},e.unstable_shouldYield=j,e.unstable_wrapCallback=function(D){var J=N;return function(){var ue=N;N=J;try{return D.apply(this,arguments)}finally{N=ue}}}})(lf);of.exports=lf;var Ng=of.exports;/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var vg=g,In=Ng;function me(e){for(var t="https://reactjs.org/docs/error-decoder.html?invariant="+e,s=1;s<arguments.length;s++)t+="&args[]="+encodeURIComponent(arguments[s]);return"Minified React error #"+e+"; visit "+t+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var cf=new Set,Qa={};function jr(e,t){ta(e,t),ta(e+"Capture",t)}function ta(e,t){for(Qa[e]=t,e=0;e<t.length;e++)cf.add(t[e])}var ks=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),$c=Object.prototype.hasOwnProperty,Sg=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,tm={},nm={};function wg(e){return $c.call(nm,e)?!0:$c.call(tm,e)?!1:Sg.test(e)?nm[e]=!0:(tm[e]=!0,!1)}function jg(e,t,s,r){if(s!==null&&s.type===0)return!1;switch(typeof t){case"function":case"symbol":return!0;case"boolean":return r?!1:s!==null?!s.acceptsBooleans:(e=e.toLowerCase().slice(0,5),e!=="data-"&&e!=="aria-");default:return!1}}function Eg(e,t,s,r){if(t===null||typeof t>"u"||jg(e,t,s,r))return!0;if(r)return!1;if(s!==null)switch(s.type){case 3:return!t;case 4:return t===!1;case 5:return isNaN(t);case 6:return isNaN(t)||1>t}return!1}function hn(e,t,s,r,a,o,l){this.acceptsBooleans=t===2||t===3||t===4,this.attributeName=r,this.attributeNamespace=a,this.mustUseProperty=s,this.propertyName=e,this.type=t,this.sanitizeURL=o,this.removeEmptyString=l}var Qt={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(e){Qt[e]=new hn(e,0,!1,e,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(e){var t=e[0];Qt[t]=new hn(t,1,!1,e[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(e){Qt[e]=new hn(e,2,!1,e.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(e){Qt[e]=new hn(e,2,!1,e,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(e){Qt[e]=new hn(e,3,!1,e.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(e){Qt[e]=new hn(e,3,!0,e,null,!1,!1)});["capture","download"].forEach(function(e){Qt[e]=new hn(e,4,!1,e,null,!1,!1)});["cols","rows","size","span"].forEach(function(e){Qt[e]=new hn(e,6,!1,e,null,!1,!1)});["rowSpan","start"].forEach(function(e){Qt[e]=new hn(e,5,!1,e.toLowerCase(),null,!1,!1)});var Wd=/[\-:]([a-z])/g;function zd(e){return e[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(e){var t=e.replace(Wd,zd);Qt[t]=new hn(t,1,!1,e,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(e){var t=e.replace(Wd,zd);Qt[t]=new hn(t,1,!1,e,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(e){var t=e.replace(Wd,zd);Qt[t]=new hn(t,1,!1,e,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(e){Qt[e]=new hn(e,1,!1,e.toLowerCase(),null,!1,!1)});Qt.xlinkHref=new hn("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(e){Qt[e]=new hn(e,1,!1,e.toLowerCase(),null,!0,!0)});function Vd(e,t,s,r){var a=Qt.hasOwnProperty(t)?Qt[t]:null;(a!==null?a.type!==0:r||!(2<t.length)||t[0]!=="o"&&t[0]!=="O"||t[1]!=="n"&&t[1]!=="N")&&(Eg(t,s,a,r)&&(s=null),r||a===null?wg(t)&&(s===null?e.removeAttribute(t):e.setAttribute(t,""+s)):a.mustUseProperty?e[a.propertyName]=s===null?a.type===3?!1:"":s:(t=a.attributeName,r=a.attributeNamespace,s===null?e.removeAttribute(t):(a=a.type,s=a===3||a===4&&s===!0?"":""+s,r?e.setAttributeNS(r,t,s):e.setAttribute(t,s))))}var Rs=vg.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,Yo=Symbol.for("react.element"),Mr=Symbol.for("react.portal"),Pr=Symbol.for("react.fragment"),Kd=Symbol.for("react.strict_mode"),Hc=Symbol.for("react.profiler"),df=Symbol.for("react.provider"),uf=Symbol.for("react.context"),Yd=Symbol.for("react.forward_ref"),Uc=Symbol.for("react.suspense"),Wc=Symbol.for("react.suspense_list"),Gd=Symbol.for("react.memo"),Ps=Symbol.for("react.lazy"),mf=Symbol.for("react.offscreen"),sm=Symbol.iterator;function Ea(e){return e===null||typeof e!="object"?null:(e=sm&&e[sm]||e["@@iterator"],typeof e=="function"?e:null)}var Tt=Object.assign,Qi;function Ma(e){if(Qi===void 0)try{throw Error()}catch(s){var t=s.stack.trim().match(/\n( *(at )?)/);Qi=t&&t[1]||""}return`
`+Qi+e}var Zi=!1;function ec(e,t){if(!e||Zi)return"";Zi=!0;var s=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(t)if(t=function(){throw Error()},Object.defineProperty(t.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(t,[])}catch(u){var r=u}Reflect.construct(e,[],t)}else{try{t.call()}catch(u){r=u}e.call(t.prototype)}else{try{throw Error()}catch(u){r=u}e()}}catch(u){if(u&&r&&typeof u.stack=="string"){for(var a=u.stack.split(`
`),o=r.stack.split(`
`),l=a.length-1,c=o.length-1;1<=l&&0<=c&&a[l]!==o[c];)c--;for(;1<=l&&0<=c;l--,c--)if(a[l]!==o[c]){if(l!==1||c!==1)do if(l--,c--,0>c||a[l]!==o[c]){var i=`
`+a[l].replace(" at new "," at ");return e.displayName&&i.includes("<anonymous>")&&(i=i.replace("<anonymous>",e.displayName)),i}while(1<=l&&0<=c);break}}}finally{Zi=!1,Error.prepareStackTrace=s}return(e=e?e.displayName||e.name:"")?Ma(e):""}function kg(e){switch(e.tag){case 5:return Ma(e.type);case 16:return Ma("Lazy");case 13:return Ma("Suspense");case 19:return Ma("SuspenseList");case 0:case 2:case 15:return e=ec(e.type,!1),e;case 11:return e=ec(e.type.render,!1),e;case 1:return e=ec(e.type,!0),e;default:return""}}function zc(e){if(e==null)return null;if(typeof e=="function")return e.displayName||e.name||null;if(typeof e=="string")return e;switch(e){case Pr:return"Fragment";case Mr:return"Portal";case Hc:return"Profiler";case Kd:return"StrictMode";case Uc:return"Suspense";case Wc:return"SuspenseList"}if(typeof e=="object")switch(e.$$typeof){case uf:return(e.displayName||"Context")+".Consumer";case df:return(e._context.displayName||"Context")+".Provider";case Yd:var t=e.render;return e=e.displayName,e||(e=t.displayName||t.name||"",e=e!==""?"ForwardRef("+e+")":"ForwardRef"),e;case Gd:return t=e.displayName||null,t!==null?t:zc(e.type)||"Memo";case Ps:t=e._payload,e=e._init;try{return zc(e(t))}catch{}}return null}function Ag(e){var t=e.type;switch(e.tag){case 24:return"Cache";case 9:return(t.displayName||"Context")+".Consumer";case 10:return(t._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return e=t.render,e=e.displayName||e.name||"",t.displayName||(e!==""?"ForwardRef("+e+")":"ForwardRef");case 7:return"Fragment";case 5:return t;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return zc(t);case 8:return t===Kd?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof t=="function")return t.displayName||t.name||null;if(typeof t=="string")return t}return null}function tr(e){switch(typeof e){case"boolean":case"number":case"string":case"undefined":return e;case"object":return e;default:return""}}function pf(e){var t=e.type;return(e=e.nodeName)&&e.toLowerCase()==="input"&&(t==="checkbox"||t==="radio")}function Ig(e){var t=pf(e)?"checked":"value",s=Object.getOwnPropertyDescriptor(e.constructor.prototype,t),r=""+e[t];if(!e.hasOwnProperty(t)&&typeof s<"u"&&typeof s.get=="function"&&typeof s.set=="function"){var a=s.get,o=s.set;return Object.defineProperty(e,t,{configurable:!0,get:function(){return a.call(this)},set:function(l){r=""+l,o.call(this,l)}}),Object.defineProperty(e,t,{enumerable:s.enumerable}),{getValue:function(){return r},setValue:function(l){r=""+l},stopTracking:function(){e._valueTracker=null,delete e[t]}}}}function Go(e){e._valueTracker||(e._valueTracker=Ig(e))}function ff(e){if(!e)return!1;var t=e._valueTracker;if(!t)return!0;var s=t.getValue(),r="";return e&&(r=pf(e)?e.checked?"true":"false":e.value),e=r,e!==s?(t.setValue(e),!0):!1}function Tl(e){if(e=e||(typeof document<"u"?document:void 0),typeof e>"u")return null;try{return e.activeElement||e.body}catch{return e.body}}function Vc(e,t){var s=t.checked;return Tt({},t,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:s??e._wrapperState.initialChecked})}function rm(e,t){var s=t.defaultValue==null?"":t.defaultValue,r=t.checked!=null?t.checked:t.defaultChecked;s=tr(t.value!=null?t.value:s),e._wrapperState={initialChecked:r,initialValue:s,controlled:t.type==="checkbox"||t.type==="radio"?t.checked!=null:t.value!=null}}function xf(e,t){t=t.checked,t!=null&&Vd(e,"checked",t,!1)}function Kc(e,t){xf(e,t);var s=tr(t.value),r=t.type;if(s!=null)r==="number"?(s===0&&e.value===""||e.value!=s)&&(e.value=""+s):e.value!==""+s&&(e.value=""+s);else if(r==="submit"||r==="reset"){e.removeAttribute("value");return}t.hasOwnProperty("value")?Yc(e,t.type,s):t.hasOwnProperty("defaultValue")&&Yc(e,t.type,tr(t.defaultValue)),t.checked==null&&t.defaultChecked!=null&&(e.defaultChecked=!!t.defaultChecked)}function am(e,t,s){if(t.hasOwnProperty("value")||t.hasOwnProperty("defaultValue")){var r=t.type;if(!(r!=="submit"&&r!=="reset"||t.value!==void 0&&t.value!==null))return;t=""+e._wrapperState.initialValue,s||t===e.value||(e.value=t),e.defaultValue=t}s=e.name,s!==""&&(e.name=""),e.defaultChecked=!!e._wrapperState.initialChecked,s!==""&&(e.name=s)}function Yc(e,t,s){(t!=="number"||Tl(e.ownerDocument)!==e)&&(s==null?e.defaultValue=""+e._wrapperState.initialValue:e.defaultValue!==""+s&&(e.defaultValue=""+s))}var Pa=Array.isArray;function Gr(e,t,s,r){if(e=e.options,t){t={};for(var a=0;a<s.length;a++)t["$"+s[a]]=!0;for(s=0;s<e.length;s++)a=t.hasOwnProperty("$"+e[s].value),e[s].selected!==a&&(e[s].selected=a),a&&r&&(e[s].defaultSelected=!0)}else{for(s=""+tr(s),t=null,a=0;a<e.length;a++){if(e[a].value===s){e[a].selected=!0,r&&(e[a].defaultSelected=!0);return}t!==null||e[a].disabled||(t=e[a])}t!==null&&(t.selected=!0)}}function Gc(e,t){if(t.dangerouslySetInnerHTML!=null)throw Error(me(91));return Tt({},t,{value:void 0,defaultValue:void 0,children:""+e._wrapperState.initialValue})}function om(e,t){var s=t.value;if(s==null){if(s=t.children,t=t.defaultValue,s!=null){if(t!=null)throw Error(me(92));if(Pa(s)){if(1<s.length)throw Error(me(93));s=s[0]}t=s}t==null&&(t=""),s=t}e._wrapperState={initialValue:tr(s)}}function hf(e,t){var s=tr(t.value),r=tr(t.defaultValue);s!=null&&(s=""+s,s!==e.value&&(e.value=s),t.defaultValue==null&&e.defaultValue!==s&&(e.defaultValue=s)),r!=null&&(e.defaultValue=""+r)}function lm(e){var t=e.textContent;t===e._wrapperState.initialValue&&t!==""&&t!==null&&(e.value=t)}function gf(e){switch(e){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function qc(e,t){return e==null||e==="http://www.w3.org/1999/xhtml"?gf(t):e==="http://www.w3.org/2000/svg"&&t==="foreignObject"?"http://www.w3.org/1999/xhtml":e}var qo,yf=function(e){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(t,s,r,a){MSApp.execUnsafeLocalFunction(function(){return e(t,s,r,a)})}:e}(function(e,t){if(e.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in e)e.innerHTML=t;else{for(qo=qo||document.createElement("div"),qo.innerHTML="<svg>"+t.valueOf().toString()+"</svg>",t=qo.firstChild;e.firstChild;)e.removeChild(e.firstChild);for(;t.firstChild;)e.appendChild(t.firstChild)}});function Za(e,t){if(t){var s=e.firstChild;if(s&&s===e.lastChild&&s.nodeType===3){s.nodeValue=t;return}}e.textContent=t}var $a={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},Tg=["Webkit","ms","Moz","O"];Object.keys($a).forEach(function(e){Tg.forEach(function(t){t=t+e.charAt(0).toUpperCase()+e.substring(1),$a[t]=$a[e]})});function bf(e,t,s){return t==null||typeof t=="boolean"||t===""?"":s||typeof t!="number"||t===0||$a.hasOwnProperty(e)&&$a[e]?(""+t).trim():t+"px"}function Nf(e,t){e=e.style;for(var s in t)if(t.hasOwnProperty(s)){var r=s.indexOf("--")===0,a=bf(s,t[s],r);s==="float"&&(s="cssFloat"),r?e.setProperty(s,a):e[s]=a}}var Rg=Tt({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function Xc(e,t){if(t){if(Rg[e]&&(t.children!=null||t.dangerouslySetInnerHTML!=null))throw Error(me(137,e));if(t.dangerouslySetInnerHTML!=null){if(t.children!=null)throw Error(me(60));if(typeof t.dangerouslySetInnerHTML!="object"||!("__html"in t.dangerouslySetInnerHTML))throw Error(me(61))}if(t.style!=null&&typeof t.style!="object")throw Error(me(62))}}function Jc(e,t){if(e.indexOf("-")===-1)return typeof t.is=="string";switch(e){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var Qc=null;function qd(e){return e=e.target||e.srcElement||window,e.correspondingUseElement&&(e=e.correspondingUseElement),e.nodeType===3?e.parentNode:e}var Zc=null,qr=null,Xr=null;function im(e){if(e=To(e)){if(typeof Zc!="function")throw Error(me(280));var t=e.stateNode;t&&(t=hi(t),Zc(e.stateNode,e.type,t))}}function vf(e){qr?Xr?Xr.push(e):Xr=[e]:qr=e}function Sf(){if(qr){var e=qr,t=Xr;if(Xr=qr=null,im(e),t)for(e=0;e<t.length;e++)im(t[e])}}function wf(e,t){return e(t)}function jf(){}var tc=!1;function Ef(e,t,s){if(tc)return e(t,s);tc=!0;try{return wf(e,t,s)}finally{tc=!1,(qr!==null||Xr!==null)&&(jf(),Sf())}}function eo(e,t){var s=e.stateNode;if(s===null)return null;var r=hi(s);if(r===null)return null;s=r[t];e:switch(t){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(r=!r.disabled)||(e=e.type,r=!(e==="button"||e==="input"||e==="select"||e==="textarea")),e=!r;break e;default:e=!1}if(e)return null;if(s&&typeof s!="function")throw Error(me(231,t,typeof s));return s}var ed=!1;if(ks)try{var ka={};Object.defineProperty(ka,"passive",{get:function(){ed=!0}}),window.addEventListener("test",ka,ka),window.removeEventListener("test",ka,ka)}catch{ed=!1}function Cg(e,t,s,r,a,o,l,c,i){var u=Array.prototype.slice.call(arguments,3);try{t.apply(s,u)}catch(p){this.onError(p)}}var Ha=!1,Rl=null,Cl=!1,td=null,Dg={onError:function(e){Ha=!0,Rl=e}};function Lg(e,t,s,r,a,o,l,c,i){Ha=!1,Rl=null,Cg.apply(Dg,arguments)}function _g(e,t,s,r,a,o,l,c,i){if(Lg.apply(this,arguments),Ha){if(Ha){var u=Rl;Ha=!1,Rl=null}else throw Error(me(198));Cl||(Cl=!0,td=u)}}function Er(e){var t=e,s=e;if(e.alternate)for(;t.return;)t=t.return;else{e=t;do t=e,t.flags&4098&&(s=t.return),e=t.return;while(e)}return t.tag===3?s:null}function kf(e){if(e.tag===13){var t=e.memoizedState;if(t===null&&(e=e.alternate,e!==null&&(t=e.memoizedState)),t!==null)return t.dehydrated}return null}function cm(e){if(Er(e)!==e)throw Error(me(188))}function Og(e){var t=e.alternate;if(!t){if(t=Er(e),t===null)throw Error(me(188));return t!==e?null:e}for(var s=e,r=t;;){var a=s.return;if(a===null)break;var o=a.alternate;if(o===null){if(r=a.return,r!==null){s=r;continue}break}if(a.child===o.child){for(o=a.child;o;){if(o===s)return cm(a),e;if(o===r)return cm(a),t;o=o.sibling}throw Error(me(188))}if(s.return!==r.return)s=a,r=o;else{for(var l=!1,c=a.child;c;){if(c===s){l=!0,s=a,r=o;break}if(c===r){l=!0,r=a,s=o;break}c=c.sibling}if(!l){for(c=o.child;c;){if(c===s){l=!0,s=o,r=a;break}if(c===r){l=!0,r=o,s=a;break}c=c.sibling}if(!l)throw Error(me(189))}}if(s.alternate!==r)throw Error(me(190))}if(s.tag!==3)throw Error(me(188));return s.stateNode.current===s?e:t}function Af(e){return e=Og(e),e!==null?If(e):null}function If(e){if(e.tag===5||e.tag===6)return e;for(e=e.child;e!==null;){var t=If(e);if(t!==null)return t;e=e.sibling}return null}var Tf=In.unstable_scheduleCallback,dm=In.unstable_cancelCallback,Mg=In.unstable_shouldYield,Pg=In.unstable_requestPaint,_t=In.unstable_now,Fg=In.unstable_getCurrentPriorityLevel,Xd=In.unstable_ImmediatePriority,Rf=In.unstable_UserBlockingPriority,Dl=In.unstable_NormalPriority,Bg=In.unstable_LowPriority,Cf=In.unstable_IdlePriority,mi=null,us=null;function $g(e){if(us&&typeof us.onCommitFiberRoot=="function")try{us.onCommitFiberRoot(mi,e,void 0,(e.current.flags&128)===128)}catch{}}var qn=Math.clz32?Math.clz32:Wg,Hg=Math.log,Ug=Math.LN2;function Wg(e){return e>>>=0,e===0?32:31-(Hg(e)/Ug|0)|0}var Xo=64,Jo=4194304;function Fa(e){switch(e&-e){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return e&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return e&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return e}}function Ll(e,t){var s=e.pendingLanes;if(s===0)return 0;var r=0,a=e.suspendedLanes,o=e.pingedLanes,l=s&268435455;if(l!==0){var c=l&~a;c!==0?r=Fa(c):(o&=l,o!==0&&(r=Fa(o)))}else l=s&~a,l!==0?r=Fa(l):o!==0&&(r=Fa(o));if(r===0)return 0;if(t!==0&&t!==r&&!(t&a)&&(a=r&-r,o=t&-t,a>=o||a===16&&(o&4194240)!==0))return t;if(r&4&&(r|=s&16),t=e.entangledLanes,t!==0)for(e=e.entanglements,t&=r;0<t;)s=31-qn(t),a=1<<s,r|=e[s],t&=~a;return r}function zg(e,t){switch(e){case 1:case 2:case 4:return t+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function Vg(e,t){for(var s=e.suspendedLanes,r=e.pingedLanes,a=e.expirationTimes,o=e.pendingLanes;0<o;){var l=31-qn(o),c=1<<l,i=a[l];i===-1?(!(c&s)||c&r)&&(a[l]=zg(c,t)):i<=t&&(e.expiredLanes|=c),o&=~c}}function nd(e){return e=e.pendingLanes&-1073741825,e!==0?e:e&1073741824?1073741824:0}function Df(){var e=Xo;return Xo<<=1,!(Xo&4194240)&&(Xo=64),e}function nc(e){for(var t=[],s=0;31>s;s++)t.push(e);return t}function Ao(e,t,s){e.pendingLanes|=t,t!==536870912&&(e.suspendedLanes=0,e.pingedLanes=0),e=e.eventTimes,t=31-qn(t),e[t]=s}function Kg(e,t){var s=e.pendingLanes&~t;e.pendingLanes=t,e.suspendedLanes=0,e.pingedLanes=0,e.expiredLanes&=t,e.mutableReadLanes&=t,e.entangledLanes&=t,t=e.entanglements;var r=e.eventTimes;for(e=e.expirationTimes;0<s;){var a=31-qn(s),o=1<<a;t[a]=0,r[a]=-1,e[a]=-1,s&=~o}}function Jd(e,t){var s=e.entangledLanes|=t;for(e=e.entanglements;s;){var r=31-qn(s),a=1<<r;a&t|e[r]&t&&(e[r]|=t),s&=~a}}var ut=0;function Lf(e){return e&=-e,1<e?4<e?e&268435455?16:536870912:4:1}var _f,Qd,Of,Mf,Pf,sd=!1,Qo=[],Ys=null,Gs=null,qs=null,to=new Map,no=new Map,Hs=[],Yg="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function um(e,t){switch(e){case"focusin":case"focusout":Ys=null;break;case"dragenter":case"dragleave":Gs=null;break;case"mouseover":case"mouseout":qs=null;break;case"pointerover":case"pointerout":to.delete(t.pointerId);break;case"gotpointercapture":case"lostpointercapture":no.delete(t.pointerId)}}function Aa(e,t,s,r,a,o){return e===null||e.nativeEvent!==o?(e={blockedOn:t,domEventName:s,eventSystemFlags:r,nativeEvent:o,targetContainers:[a]},t!==null&&(t=To(t),t!==null&&Qd(t)),e):(e.eventSystemFlags|=r,t=e.targetContainers,a!==null&&t.indexOf(a)===-1&&t.push(a),e)}function Gg(e,t,s,r,a){switch(t){case"focusin":return Ys=Aa(Ys,e,t,s,r,a),!0;case"dragenter":return Gs=Aa(Gs,e,t,s,r,a),!0;case"mouseover":return qs=Aa(qs,e,t,s,r,a),!0;case"pointerover":var o=a.pointerId;return to.set(o,Aa(to.get(o)||null,e,t,s,r,a)),!0;case"gotpointercapture":return o=a.pointerId,no.set(o,Aa(no.get(o)||null,e,t,s,r,a)),!0}return!1}function Ff(e){var t=mr(e.target);if(t!==null){var s=Er(t);if(s!==null){if(t=s.tag,t===13){if(t=kf(s),t!==null){e.blockedOn=t,Pf(e.priority,function(){Of(s)});return}}else if(t===3&&s.stateNode.current.memoizedState.isDehydrated){e.blockedOn=s.tag===3?s.stateNode.containerInfo:null;return}}}e.blockedOn=null}function yl(e){if(e.blockedOn!==null)return!1;for(var t=e.targetContainers;0<t.length;){var s=rd(e.domEventName,e.eventSystemFlags,t[0],e.nativeEvent);if(s===null){s=e.nativeEvent;var r=new s.constructor(s.type,s);Qc=r,s.target.dispatchEvent(r),Qc=null}else return t=To(s),t!==null&&Qd(t),e.blockedOn=s,!1;t.shift()}return!0}function mm(e,t,s){yl(e)&&s.delete(t)}function qg(){sd=!1,Ys!==null&&yl(Ys)&&(Ys=null),Gs!==null&&yl(Gs)&&(Gs=null),qs!==null&&yl(qs)&&(qs=null),to.forEach(mm),no.forEach(mm)}function Ia(e,t){e.blockedOn===t&&(e.blockedOn=null,sd||(sd=!0,In.unstable_scheduleCallback(In.unstable_NormalPriority,qg)))}function so(e){function t(a){return Ia(a,e)}if(0<Qo.length){Ia(Qo[0],e);for(var s=1;s<Qo.length;s++){var r=Qo[s];r.blockedOn===e&&(r.blockedOn=null)}}for(Ys!==null&&Ia(Ys,e),Gs!==null&&Ia(Gs,e),qs!==null&&Ia(qs,e),to.forEach(t),no.forEach(t),s=0;s<Hs.length;s++)r=Hs[s],r.blockedOn===e&&(r.blockedOn=null);for(;0<Hs.length&&(s=Hs[0],s.blockedOn===null);)Ff(s),s.blockedOn===null&&Hs.shift()}var Jr=Rs.ReactCurrentBatchConfig,_l=!0;function Xg(e,t,s,r){var a=ut,o=Jr.transition;Jr.transition=null;try{ut=1,Zd(e,t,s,r)}finally{ut=a,Jr.transition=o}}function Jg(e,t,s,r){var a=ut,o=Jr.transition;Jr.transition=null;try{ut=4,Zd(e,t,s,r)}finally{ut=a,Jr.transition=o}}function Zd(e,t,s,r){if(_l){var a=rd(e,t,s,r);if(a===null)mc(e,t,r,Ol,s),um(e,r);else if(Gg(a,e,t,s,r))r.stopPropagation();else if(um(e,r),t&4&&-1<Yg.indexOf(e)){for(;a!==null;){var o=To(a);if(o!==null&&_f(o),o=rd(e,t,s,r),o===null&&mc(e,t,r,Ol,s),o===a)break;a=o}a!==null&&r.stopPropagation()}else mc(e,t,r,null,s)}}var Ol=null;function rd(e,t,s,r){if(Ol=null,e=qd(r),e=mr(e),e!==null)if(t=Er(e),t===null)e=null;else if(s=t.tag,s===13){if(e=kf(t),e!==null)return e;e=null}else if(s===3){if(t.stateNode.current.memoizedState.isDehydrated)return t.tag===3?t.stateNode.containerInfo:null;e=null}else t!==e&&(e=null);return Ol=e,null}function Bf(e){switch(e){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(Fg()){case Xd:return 1;case Rf:return 4;case Dl:case Bg:return 16;case Cf:return 536870912;default:return 16}default:return 16}}var zs=null,eu=null,bl=null;function $f(){if(bl)return bl;var e,t=eu,s=t.length,r,a="value"in zs?zs.value:zs.textContent,o=a.length;for(e=0;e<s&&t[e]===a[e];e++);var l=s-e;for(r=1;r<=l&&t[s-r]===a[o-r];r++);return bl=a.slice(e,1<r?1-r:void 0)}function Nl(e){var t=e.keyCode;return"charCode"in e?(e=e.charCode,e===0&&t===13&&(e=13)):e=t,e===10&&(e=13),32<=e||e===13?e:0}function Zo(){return!0}function pm(){return!1}function Rn(e){function t(s,r,a,o,l){this._reactName=s,this._targetInst=a,this.type=r,this.nativeEvent=o,this.target=l,this.currentTarget=null;for(var c in e)e.hasOwnProperty(c)&&(s=e[c],this[c]=s?s(o):o[c]);return this.isDefaultPrevented=(o.defaultPrevented!=null?o.defaultPrevented:o.returnValue===!1)?Zo:pm,this.isPropagationStopped=pm,this}return Tt(t.prototype,{preventDefault:function(){this.defaultPrevented=!0;var s=this.nativeEvent;s&&(s.preventDefault?s.preventDefault():typeof s.returnValue!="unknown"&&(s.returnValue=!1),this.isDefaultPrevented=Zo)},stopPropagation:function(){var s=this.nativeEvent;s&&(s.stopPropagation?s.stopPropagation():typeof s.cancelBubble!="unknown"&&(s.cancelBubble=!0),this.isPropagationStopped=Zo)},persist:function(){},isPersistent:Zo}),t}var ma={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(e){return e.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},tu=Rn(ma),Io=Tt({},ma,{view:0,detail:0}),Qg=Rn(Io),sc,rc,Ta,pi=Tt({},Io,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:nu,button:0,buttons:0,relatedTarget:function(e){return e.relatedTarget===void 0?e.fromElement===e.srcElement?e.toElement:e.fromElement:e.relatedTarget},movementX:function(e){return"movementX"in e?e.movementX:(e!==Ta&&(Ta&&e.type==="mousemove"?(sc=e.screenX-Ta.screenX,rc=e.screenY-Ta.screenY):rc=sc=0,Ta=e),sc)},movementY:function(e){return"movementY"in e?e.movementY:rc}}),fm=Rn(pi),Zg=Tt({},pi,{dataTransfer:0}),ey=Rn(Zg),ty=Tt({},Io,{relatedTarget:0}),ac=Rn(ty),ny=Tt({},ma,{animationName:0,elapsedTime:0,pseudoElement:0}),sy=Rn(ny),ry=Tt({},ma,{clipboardData:function(e){return"clipboardData"in e?e.clipboardData:window.clipboardData}}),ay=Rn(ry),oy=Tt({},ma,{data:0}),xm=Rn(oy),ly={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},iy={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},cy={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function dy(e){var t=this.nativeEvent;return t.getModifierState?t.getModifierState(e):(e=cy[e])?!!t[e]:!1}function nu(){return dy}var uy=Tt({},Io,{key:function(e){if(e.key){var t=ly[e.key]||e.key;if(t!=="Unidentified")return t}return e.type==="keypress"?(e=Nl(e),e===13?"Enter":String.fromCharCode(e)):e.type==="keydown"||e.type==="keyup"?iy[e.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:nu,charCode:function(e){return e.type==="keypress"?Nl(e):0},keyCode:function(e){return e.type==="keydown"||e.type==="keyup"?e.keyCode:0},which:function(e){return e.type==="keypress"?Nl(e):e.type==="keydown"||e.type==="keyup"?e.keyCode:0}}),my=Rn(uy),py=Tt({},pi,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),hm=Rn(py),fy=Tt({},Io,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:nu}),xy=Rn(fy),hy=Tt({},ma,{propertyName:0,elapsedTime:0,pseudoElement:0}),gy=Rn(hy),yy=Tt({},pi,{deltaX:function(e){return"deltaX"in e?e.deltaX:"wheelDeltaX"in e?-e.wheelDeltaX:0},deltaY:function(e){return"deltaY"in e?e.deltaY:"wheelDeltaY"in e?-e.wheelDeltaY:"wheelDelta"in e?-e.wheelDelta:0},deltaZ:0,deltaMode:0}),by=Rn(yy),Ny=[9,13,27,32],su=ks&&"CompositionEvent"in window,Ua=null;ks&&"documentMode"in document&&(Ua=document.documentMode);var vy=ks&&"TextEvent"in window&&!Ua,Hf=ks&&(!su||Ua&&8<Ua&&11>=Ua),gm=" ",ym=!1;function Uf(e,t){switch(e){case"keyup":return Ny.indexOf(t.keyCode)!==-1;case"keydown":return t.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function Wf(e){return e=e.detail,typeof e=="object"&&"data"in e?e.data:null}var Fr=!1;function Sy(e,t){switch(e){case"compositionend":return Wf(t);case"keypress":return t.which!==32?null:(ym=!0,gm);case"textInput":return e=t.data,e===gm&&ym?null:e;default:return null}}function wy(e,t){if(Fr)return e==="compositionend"||!su&&Uf(e,t)?(e=$f(),bl=eu=zs=null,Fr=!1,e):null;switch(e){case"paste":return null;case"keypress":if(!(t.ctrlKey||t.altKey||t.metaKey)||t.ctrlKey&&t.altKey){if(t.char&&1<t.char.length)return t.char;if(t.which)return String.fromCharCode(t.which)}return null;case"compositionend":return Hf&&t.locale!=="ko"?null:t.data;default:return null}}var jy={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function bm(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t==="input"?!!jy[e.type]:t==="textarea"}function zf(e,t,s,r){vf(r),t=Ml(t,"onChange"),0<t.length&&(s=new tu("onChange","change",null,s,r),e.push({event:s,listeners:t}))}var Wa=null,ro=null;function Ey(e){tx(e,0)}function fi(e){var t=Hr(e);if(ff(t))return e}function ky(e,t){if(e==="change")return t}var Vf=!1;if(ks){var oc;if(ks){var lc="oninput"in document;if(!lc){var Nm=document.createElement("div");Nm.setAttribute("oninput","return;"),lc=typeof Nm.oninput=="function"}oc=lc}else oc=!1;Vf=oc&&(!document.documentMode||9<document.documentMode)}function vm(){Wa&&(Wa.detachEvent("onpropertychange",Kf),ro=Wa=null)}function Kf(e){if(e.propertyName==="value"&&fi(ro)){var t=[];zf(t,ro,e,qd(e)),Ef(Ey,t)}}function Ay(e,t,s){e==="focusin"?(vm(),Wa=t,ro=s,Wa.attachEvent("onpropertychange",Kf)):e==="focusout"&&vm()}function Iy(e){if(e==="selectionchange"||e==="keyup"||e==="keydown")return fi(ro)}function Ty(e,t){if(e==="click")return fi(t)}function Ry(e,t){if(e==="input"||e==="change")return fi(t)}function Cy(e,t){return e===t&&(e!==0||1/e===1/t)||e!==e&&t!==t}var Qn=typeof Object.is=="function"?Object.is:Cy;function ao(e,t){if(Qn(e,t))return!0;if(typeof e!="object"||e===null||typeof t!="object"||t===null)return!1;var s=Object.keys(e),r=Object.keys(t);if(s.length!==r.length)return!1;for(r=0;r<s.length;r++){var a=s[r];if(!$c.call(t,a)||!Qn(e[a],t[a]))return!1}return!0}function Sm(e){for(;e&&e.firstChild;)e=e.firstChild;return e}function wm(e,t){var s=Sm(e);e=0;for(var r;s;){if(s.nodeType===3){if(r=e+s.textContent.length,e<=t&&r>=t)return{node:s,offset:t-e};e=r}e:{for(;s;){if(s.nextSibling){s=s.nextSibling;break e}s=s.parentNode}s=void 0}s=Sm(s)}}function Yf(e,t){return e&&t?e===t?!0:e&&e.nodeType===3?!1:t&&t.nodeType===3?Yf(e,t.parentNode):"contains"in e?e.contains(t):e.compareDocumentPosition?!!(e.compareDocumentPosition(t)&16):!1:!1}function Gf(){for(var e=window,t=Tl();t instanceof e.HTMLIFrameElement;){try{var s=typeof t.contentWindow.location.href=="string"}catch{s=!1}if(s)e=t.contentWindow;else break;t=Tl(e.document)}return t}function ru(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t&&(t==="input"&&(e.type==="text"||e.type==="search"||e.type==="tel"||e.type==="url"||e.type==="password")||t==="textarea"||e.contentEditable==="true")}function Dy(e){var t=Gf(),s=e.focusedElem,r=e.selectionRange;if(t!==s&&s&&s.ownerDocument&&Yf(s.ownerDocument.documentElement,s)){if(r!==null&&ru(s)){if(t=r.start,e=r.end,e===void 0&&(e=t),"selectionStart"in s)s.selectionStart=t,s.selectionEnd=Math.min(e,s.value.length);else if(e=(t=s.ownerDocument||document)&&t.defaultView||window,e.getSelection){e=e.getSelection();var a=s.textContent.length,o=Math.min(r.start,a);r=r.end===void 0?o:Math.min(r.end,a),!e.extend&&o>r&&(a=r,r=o,o=a),a=wm(s,o);var l=wm(s,r);a&&l&&(e.rangeCount!==1||e.anchorNode!==a.node||e.anchorOffset!==a.offset||e.focusNode!==l.node||e.focusOffset!==l.offset)&&(t=t.createRange(),t.setStart(a.node,a.offset),e.removeAllRanges(),o>r?(e.addRange(t),e.extend(l.node,l.offset)):(t.setEnd(l.node,l.offset),e.addRange(t)))}}for(t=[],e=s;e=e.parentNode;)e.nodeType===1&&t.push({element:e,left:e.scrollLeft,top:e.scrollTop});for(typeof s.focus=="function"&&s.focus(),s=0;s<t.length;s++)e=t[s],e.element.scrollLeft=e.left,e.element.scrollTop=e.top}}var Ly=ks&&"documentMode"in document&&11>=document.documentMode,Br=null,ad=null,za=null,od=!1;function jm(e,t,s){var r=s.window===s?s.document:s.nodeType===9?s:s.ownerDocument;od||Br==null||Br!==Tl(r)||(r=Br,"selectionStart"in r&&ru(r)?r={start:r.selectionStart,end:r.selectionEnd}:(r=(r.ownerDocument&&r.ownerDocument.defaultView||window).getSelection(),r={anchorNode:r.anchorNode,anchorOffset:r.anchorOffset,focusNode:r.focusNode,focusOffset:r.focusOffset}),za&&ao(za,r)||(za=r,r=Ml(ad,"onSelect"),0<r.length&&(t=new tu("onSelect","select",null,t,s),e.push({event:t,listeners:r}),t.target=Br)))}function el(e,t){var s={};return s[e.toLowerCase()]=t.toLowerCase(),s["Webkit"+e]="webkit"+t,s["Moz"+e]="moz"+t,s}var $r={animationend:el("Animation","AnimationEnd"),animationiteration:el("Animation","AnimationIteration"),animationstart:el("Animation","AnimationStart"),transitionend:el("Transition","TransitionEnd")},ic={},qf={};ks&&(qf=document.createElement("div").style,"AnimationEvent"in window||(delete $r.animationend.animation,delete $r.animationiteration.animation,delete $r.animationstart.animation),"TransitionEvent"in window||delete $r.transitionend.transition);function xi(e){if(ic[e])return ic[e];if(!$r[e])return e;var t=$r[e],s;for(s in t)if(t.hasOwnProperty(s)&&s in qf)return ic[e]=t[s];return e}var Xf=xi("animationend"),Jf=xi("animationiteration"),Qf=xi("animationstart"),Zf=xi("transitionend"),ex=new Map,Em="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function sr(e,t){ex.set(e,t),jr(t,[e])}for(var cc=0;cc<Em.length;cc++){var dc=Em[cc],_y=dc.toLowerCase(),Oy=dc[0].toUpperCase()+dc.slice(1);sr(_y,"on"+Oy)}sr(Xf,"onAnimationEnd");sr(Jf,"onAnimationIteration");sr(Qf,"onAnimationStart");sr("dblclick","onDoubleClick");sr("focusin","onFocus");sr("focusout","onBlur");sr(Zf,"onTransitionEnd");ta("onMouseEnter",["mouseout","mouseover"]);ta("onMouseLeave",["mouseout","mouseover"]);ta("onPointerEnter",["pointerout","pointerover"]);ta("onPointerLeave",["pointerout","pointerover"]);jr("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));jr("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));jr("onBeforeInput",["compositionend","keypress","textInput","paste"]);jr("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));jr("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));jr("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Ba="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),My=new Set("cancel close invalid load scroll toggle".split(" ").concat(Ba));function km(e,t,s){var r=e.type||"unknown-event";e.currentTarget=s,_g(r,t,void 0,e),e.currentTarget=null}function tx(e,t){t=(t&4)!==0;for(var s=0;s<e.length;s++){var r=e[s],a=r.event;r=r.listeners;e:{var o=void 0;if(t)for(var l=r.length-1;0<=l;l--){var c=r[l],i=c.instance,u=c.currentTarget;if(c=c.listener,i!==o&&a.isPropagationStopped())break e;km(a,c,u),o=i}else for(l=0;l<r.length;l++){if(c=r[l],i=c.instance,u=c.currentTarget,c=c.listener,i!==o&&a.isPropagationStopped())break e;km(a,c,u),o=i}}}if(Cl)throw e=td,Cl=!1,td=null,e}function St(e,t){var s=t[ud];s===void 0&&(s=t[ud]=new Set);var r=e+"__bubble";s.has(r)||(nx(t,e,2,!1),s.add(r))}function uc(e,t,s){var r=0;t&&(r|=4),nx(s,e,r,t)}var tl="_reactListening"+Math.random().toString(36).slice(2);function oo(e){if(!e[tl]){e[tl]=!0,cf.forEach(function(s){s!=="selectionchange"&&(My.has(s)||uc(s,!1,e),uc(s,!0,e))});var t=e.nodeType===9?e:e.ownerDocument;t===null||t[tl]||(t[tl]=!0,uc("selectionchange",!1,t))}}function nx(e,t,s,r){switch(Bf(t)){case 1:var a=Xg;break;case 4:a=Jg;break;default:a=Zd}s=a.bind(null,t,s,e),a=void 0,!ed||t!=="touchstart"&&t!=="touchmove"&&t!=="wheel"||(a=!0),r?a!==void 0?e.addEventListener(t,s,{capture:!0,passive:a}):e.addEventListener(t,s,!0):a!==void 0?e.addEventListener(t,s,{passive:a}):e.addEventListener(t,s,!1)}function mc(e,t,s,r,a){var o=r;if(!(t&1)&&!(t&2)&&r!==null)e:for(;;){if(r===null)return;var l=r.tag;if(l===3||l===4){var c=r.stateNode.containerInfo;if(c===a||c.nodeType===8&&c.parentNode===a)break;if(l===4)for(l=r.return;l!==null;){var i=l.tag;if((i===3||i===4)&&(i=l.stateNode.containerInfo,i===a||i.nodeType===8&&i.parentNode===a))return;l=l.return}for(;c!==null;){if(l=mr(c),l===null)return;if(i=l.tag,i===5||i===6){r=o=l;continue e}c=c.parentNode}}r=r.return}Ef(function(){var u=o,p=qd(s),y=[];e:{var N=ex.get(e);if(N!==void 0){var w=tu,R=e;switch(e){case"keypress":if(Nl(s)===0)break e;case"keydown":case"keyup":w=my;break;case"focusin":R="focus",w=ac;break;case"focusout":R="blur",w=ac;break;case"beforeblur":case"afterblur":w=ac;break;case"click":if(s.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":w=fm;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":w=ey;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":w=xy;break;case Xf:case Jf:case Qf:w=sy;break;case Zf:w=gy;break;case"scroll":w=Qg;break;case"wheel":w=by;break;case"copy":case"cut":case"paste":w=ay;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":w=hm}var E=(t&4)!==0,W=!E&&e==="scroll",b=E?N!==null?N+"Capture":null:N;E=[];for(var h=u,S;h!==null;){S=h;var P=S.stateNode;if(S.tag===5&&P!==null&&(S=P,b!==null&&(P=eo(h,b),P!=null&&E.push(lo(h,P,S)))),W)break;h=h.return}0<E.length&&(N=new w(N,R,null,s,p),y.push({event:N,listeners:E}))}}if(!(t&7)){e:{if(N=e==="mouseover"||e==="pointerover",w=e==="mouseout"||e==="pointerout",N&&s!==Qc&&(R=s.relatedTarget||s.fromElement)&&(mr(R)||R[As]))break e;if((w||N)&&(N=p.window===p?p:(N=p.ownerDocument)?N.defaultView||N.parentWindow:window,w?(R=s.relatedTarget||s.toElement,w=u,R=R?mr(R):null,R!==null&&(W=Er(R),R!==W||R.tag!==5&&R.tag!==6)&&(R=null)):(w=null,R=u),w!==R)){if(E=fm,P="onMouseLeave",b="onMouseEnter",h="mouse",(e==="pointerout"||e==="pointerover")&&(E=hm,P="onPointerLeave",b="onPointerEnter",h="pointer"),W=w==null?N:Hr(w),S=R==null?N:Hr(R),N=new E(P,h+"leave",w,s,p),N.target=W,N.relatedTarget=S,P=null,mr(p)===u&&(E=new E(b,h+"enter",R,s,p),E.target=S,E.relatedTarget=W,P=E),W=P,w&&R)t:{for(E=w,b=R,h=0,S=E;S;S=Dr(S))h++;for(S=0,P=b;P;P=Dr(P))S++;for(;0<h-S;)E=Dr(E),h--;for(;0<S-h;)b=Dr(b),S--;for(;h--;){if(E===b||b!==null&&E===b.alternate)break t;E=Dr(E),b=Dr(b)}E=null}else E=null;w!==null&&Am(y,N,w,E,!1),R!==null&&W!==null&&Am(y,W,R,E,!0)}}e:{if(N=u?Hr(u):window,w=N.nodeName&&N.nodeName.toLowerCase(),w==="select"||w==="input"&&N.type==="file")var U=ky;else if(bm(N))if(Vf)U=Ry;else{U=Iy;var z=Ay}else(w=N.nodeName)&&w.toLowerCase()==="input"&&(N.type==="checkbox"||N.type==="radio")&&(U=Ty);if(U&&(U=U(e,u))){zf(y,U,s,p);break e}z&&z(e,N,u),e==="focusout"&&(z=N._wrapperState)&&z.controlled&&N.type==="number"&&Yc(N,"number",N.value)}switch(z=u?Hr(u):window,e){case"focusin":(bm(z)||z.contentEditable==="true")&&(Br=z,ad=u,za=null);break;case"focusout":za=ad=Br=null;break;case"mousedown":od=!0;break;case"contextmenu":case"mouseup":case"dragend":od=!1,jm(y,s,p);break;case"selectionchange":if(Ly)break;case"keydown":case"keyup":jm(y,s,p)}var q;if(su)e:{switch(e){case"compositionstart":var ee="onCompositionStart";break e;case"compositionend":ee="onCompositionEnd";break e;case"compositionupdate":ee="onCompositionUpdate";break e}ee=void 0}else Fr?Uf(e,s)&&(ee="onCompositionEnd"):e==="keydown"&&s.keyCode===229&&(ee="onCompositionStart");ee&&(Hf&&s.locale!=="ko"&&(Fr||ee!=="onCompositionStart"?ee==="onCompositionEnd"&&Fr&&(q=$f()):(zs=p,eu="value"in zs?zs.value:zs.textContent,Fr=!0)),z=Ml(u,ee),0<z.length&&(ee=new xm(ee,e,null,s,p),y.push({event:ee,listeners:z}),q?ee.data=q:(q=Wf(s),q!==null&&(ee.data=q)))),(q=vy?Sy(e,s):wy(e,s))&&(u=Ml(u,"onBeforeInput"),0<u.length&&(p=new xm("onBeforeInput","beforeinput",null,s,p),y.push({event:p,listeners:u}),p.data=q))}tx(y,t)})}function lo(e,t,s){return{instance:e,listener:t,currentTarget:s}}function Ml(e,t){for(var s=t+"Capture",r=[];e!==null;){var a=e,o=a.stateNode;a.tag===5&&o!==null&&(a=o,o=eo(e,s),o!=null&&r.unshift(lo(e,o,a)),o=eo(e,t),o!=null&&r.push(lo(e,o,a))),e=e.return}return r}function Dr(e){if(e===null)return null;do e=e.return;while(e&&e.tag!==5);return e||null}function Am(e,t,s,r,a){for(var o=t._reactName,l=[];s!==null&&s!==r;){var c=s,i=c.alternate,u=c.stateNode;if(i!==null&&i===r)break;c.tag===5&&u!==null&&(c=u,a?(i=eo(s,o),i!=null&&l.unshift(lo(s,i,c))):a||(i=eo(s,o),i!=null&&l.push(lo(s,i,c)))),s=s.return}l.length!==0&&e.push({event:t,listeners:l})}var Py=/\r\n?/g,Fy=/\u0000|\uFFFD/g;function Im(e){return(typeof e=="string"?e:""+e).replace(Py,`
`).replace(Fy,"")}function nl(e,t,s){if(t=Im(t),Im(e)!==t&&s)throw Error(me(425))}function Pl(){}var ld=null,id=null;function cd(e,t){return e==="textarea"||e==="noscript"||typeof t.children=="string"||typeof t.children=="number"||typeof t.dangerouslySetInnerHTML=="object"&&t.dangerouslySetInnerHTML!==null&&t.dangerouslySetInnerHTML.__html!=null}var dd=typeof setTimeout=="function"?setTimeout:void 0,By=typeof clearTimeout=="function"?clearTimeout:void 0,Tm=typeof Promise=="function"?Promise:void 0,$y=typeof queueMicrotask=="function"?queueMicrotask:typeof Tm<"u"?function(e){return Tm.resolve(null).then(e).catch(Hy)}:dd;function Hy(e){setTimeout(function(){throw e})}function pc(e,t){var s=t,r=0;do{var a=s.nextSibling;if(e.removeChild(s),a&&a.nodeType===8)if(s=a.data,s==="/$"){if(r===0){e.removeChild(a),so(t);return}r--}else s!=="$"&&s!=="$?"&&s!=="$!"||r++;s=a}while(s);so(t)}function Xs(e){for(;e!=null;e=e.nextSibling){var t=e.nodeType;if(t===1||t===3)break;if(t===8){if(t=e.data,t==="$"||t==="$!"||t==="$?")break;if(t==="/$")return null}}return e}function Rm(e){e=e.previousSibling;for(var t=0;e;){if(e.nodeType===8){var s=e.data;if(s==="$"||s==="$!"||s==="$?"){if(t===0)return e;t--}else s==="/$"&&t++}e=e.previousSibling}return null}var pa=Math.random().toString(36).slice(2),ls="__reactFiber$"+pa,io="__reactProps$"+pa,As="__reactContainer$"+pa,ud="__reactEvents$"+pa,Uy="__reactListeners$"+pa,Wy="__reactHandles$"+pa;function mr(e){var t=e[ls];if(t)return t;for(var s=e.parentNode;s;){if(t=s[As]||s[ls]){if(s=t.alternate,t.child!==null||s!==null&&s.child!==null)for(e=Rm(e);e!==null;){if(s=e[ls])return s;e=Rm(e)}return t}e=s,s=e.parentNode}return null}function To(e){return e=e[ls]||e[As],!e||e.tag!==5&&e.tag!==6&&e.tag!==13&&e.tag!==3?null:e}function Hr(e){if(e.tag===5||e.tag===6)return e.stateNode;throw Error(me(33))}function hi(e){return e[io]||null}var md=[],Ur=-1;function rr(e){return{current:e}}function jt(e){0>Ur||(e.current=md[Ur],md[Ur]=null,Ur--)}function bt(e,t){Ur++,md[Ur]=e.current,e.current=t}var nr={},dn=rr(nr),Nn=rr(!1),yr=nr;function na(e,t){var s=e.type.contextTypes;if(!s)return nr;var r=e.stateNode;if(r&&r.__reactInternalMemoizedUnmaskedChildContext===t)return r.__reactInternalMemoizedMaskedChildContext;var a={},o;for(o in s)a[o]=t[o];return r&&(e=e.stateNode,e.__reactInternalMemoizedUnmaskedChildContext=t,e.__reactInternalMemoizedMaskedChildContext=a),a}function vn(e){return e=e.childContextTypes,e!=null}function Fl(){jt(Nn),jt(dn)}function Cm(e,t,s){if(dn.current!==nr)throw Error(me(168));bt(dn,t),bt(Nn,s)}function sx(e,t,s){var r=e.stateNode;if(t=t.childContextTypes,typeof r.getChildContext!="function")return s;r=r.getChildContext();for(var a in r)if(!(a in t))throw Error(me(108,Ag(e)||"Unknown",a));return Tt({},s,r)}function Bl(e){return e=(e=e.stateNode)&&e.__reactInternalMemoizedMergedChildContext||nr,yr=dn.current,bt(dn,e),bt(Nn,Nn.current),!0}function Dm(e,t,s){var r=e.stateNode;if(!r)throw Error(me(169));s?(e=sx(e,t,yr),r.__reactInternalMemoizedMergedChildContext=e,jt(Nn),jt(dn),bt(dn,e)):jt(Nn),bt(Nn,s)}var ys=null,gi=!1,fc=!1;function rx(e){ys===null?ys=[e]:ys.push(e)}function zy(e){gi=!0,rx(e)}function ar(){if(!fc&&ys!==null){fc=!0;var e=0,t=ut;try{var s=ys;for(ut=1;e<s.length;e++){var r=s[e];do r=r(!0);while(r!==null)}ys=null,gi=!1}catch(a){throw ys!==null&&(ys=ys.slice(e+1)),Tf(Xd,ar),a}finally{ut=t,fc=!1}}return null}var Wr=[],zr=0,$l=null,Hl=0,_n=[],On=0,br=null,vs=1,Ss="";function ir(e,t){Wr[zr++]=Hl,Wr[zr++]=$l,$l=e,Hl=t}function ax(e,t,s){_n[On++]=vs,_n[On++]=Ss,_n[On++]=br,br=e;var r=vs;e=Ss;var a=32-qn(r)-1;r&=~(1<<a),s+=1;var o=32-qn(t)+a;if(30<o){var l=a-a%5;o=(r&(1<<l)-1).toString(32),r>>=l,a-=l,vs=1<<32-qn(t)+a|s<<a|r,Ss=o+e}else vs=1<<o|s<<a|r,Ss=e}function au(e){e.return!==null&&(ir(e,1),ax(e,1,0))}function ou(e){for(;e===$l;)$l=Wr[--zr],Wr[zr]=null,Hl=Wr[--zr],Wr[zr]=null;for(;e===br;)br=_n[--On],_n[On]=null,Ss=_n[--On],_n[On]=null,vs=_n[--On],_n[On]=null}var An=null,kn=null,Et=!1,Gn=null;function ox(e,t){var s=Mn(5,null,null,0);s.elementType="DELETED",s.stateNode=t,s.return=e,t=e.deletions,t===null?(e.deletions=[s],e.flags|=16):t.push(s)}function Lm(e,t){switch(e.tag){case 5:var s=e.type;return t=t.nodeType!==1||s.toLowerCase()!==t.nodeName.toLowerCase()?null:t,t!==null?(e.stateNode=t,An=e,kn=Xs(t.firstChild),!0):!1;case 6:return t=e.pendingProps===""||t.nodeType!==3?null:t,t!==null?(e.stateNode=t,An=e,kn=null,!0):!1;case 13:return t=t.nodeType!==8?null:t,t!==null?(s=br!==null?{id:vs,overflow:Ss}:null,e.memoizedState={dehydrated:t,treeContext:s,retryLane:1073741824},s=Mn(18,null,null,0),s.stateNode=t,s.return=e,e.child=s,An=e,kn=null,!0):!1;default:return!1}}function pd(e){return(e.mode&1)!==0&&(e.flags&128)===0}function fd(e){if(Et){var t=kn;if(t){var s=t;if(!Lm(e,t)){if(pd(e))throw Error(me(418));t=Xs(s.nextSibling);var r=An;t&&Lm(e,t)?ox(r,s):(e.flags=e.flags&-4097|2,Et=!1,An=e)}}else{if(pd(e))throw Error(me(418));e.flags=e.flags&-4097|2,Et=!1,An=e}}}function _m(e){for(e=e.return;e!==null&&e.tag!==5&&e.tag!==3&&e.tag!==13;)e=e.return;An=e}function sl(e){if(e!==An)return!1;if(!Et)return _m(e),Et=!0,!1;var t;if((t=e.tag!==3)&&!(t=e.tag!==5)&&(t=e.type,t=t!=="head"&&t!=="body"&&!cd(e.type,e.memoizedProps)),t&&(t=kn)){if(pd(e))throw lx(),Error(me(418));for(;t;)ox(e,t),t=Xs(t.nextSibling)}if(_m(e),e.tag===13){if(e=e.memoizedState,e=e!==null?e.dehydrated:null,!e)throw Error(me(317));e:{for(e=e.nextSibling,t=0;e;){if(e.nodeType===8){var s=e.data;if(s==="/$"){if(t===0){kn=Xs(e.nextSibling);break e}t--}else s!=="$"&&s!=="$!"&&s!=="$?"||t++}e=e.nextSibling}kn=null}}else kn=An?Xs(e.stateNode.nextSibling):null;return!0}function lx(){for(var e=kn;e;)e=Xs(e.nextSibling)}function sa(){kn=An=null,Et=!1}function lu(e){Gn===null?Gn=[e]:Gn.push(e)}var Vy=Rs.ReactCurrentBatchConfig;function Ra(e,t,s){if(e=s.ref,e!==null&&typeof e!="function"&&typeof e!="object"){if(s._owner){if(s=s._owner,s){if(s.tag!==1)throw Error(me(309));var r=s.stateNode}if(!r)throw Error(me(147,e));var a=r,o=""+e;return t!==null&&t.ref!==null&&typeof t.ref=="function"&&t.ref._stringRef===o?t.ref:(t=function(l){var c=a.refs;l===null?delete c[o]:c[o]=l},t._stringRef=o,t)}if(typeof e!="string")throw Error(me(284));if(!s._owner)throw Error(me(290,e))}return e}function rl(e,t){throw e=Object.prototype.toString.call(t),Error(me(31,e==="[object Object]"?"object with keys {"+Object.keys(t).join(", ")+"}":e))}function Om(e){var t=e._init;return t(e._payload)}function ix(e){function t(b,h){if(e){var S=b.deletions;S===null?(b.deletions=[h],b.flags|=16):S.push(h)}}function s(b,h){if(!e)return null;for(;h!==null;)t(b,h),h=h.sibling;return null}function r(b,h){for(b=new Map;h!==null;)h.key!==null?b.set(h.key,h):b.set(h.index,h),h=h.sibling;return b}function a(b,h){return b=er(b,h),b.index=0,b.sibling=null,b}function o(b,h,S){return b.index=S,e?(S=b.alternate,S!==null?(S=S.index,S<h?(b.flags|=2,h):S):(b.flags|=2,h)):(b.flags|=1048576,h)}function l(b){return e&&b.alternate===null&&(b.flags|=2),b}function c(b,h,S,P){return h===null||h.tag!==6?(h=vc(S,b.mode,P),h.return=b,h):(h=a(h,S),h.return=b,h)}function i(b,h,S,P){var U=S.type;return U===Pr?p(b,h,S.props.children,P,S.key):h!==null&&(h.elementType===U||typeof U=="object"&&U!==null&&U.$$typeof===Ps&&Om(U)===h.type)?(P=a(h,S.props),P.ref=Ra(b,h,S),P.return=b,P):(P=Al(S.type,S.key,S.props,null,b.mode,P),P.ref=Ra(b,h,S),P.return=b,P)}function u(b,h,S,P){return h===null||h.tag!==4||h.stateNode.containerInfo!==S.containerInfo||h.stateNode.implementation!==S.implementation?(h=Sc(S,b.mode,P),h.return=b,h):(h=a(h,S.children||[]),h.return=b,h)}function p(b,h,S,P,U){return h===null||h.tag!==7?(h=hr(S,b.mode,P,U),h.return=b,h):(h=a(h,S),h.return=b,h)}function y(b,h,S){if(typeof h=="string"&&h!==""||typeof h=="number")return h=vc(""+h,b.mode,S),h.return=b,h;if(typeof h=="object"&&h!==null){switch(h.$$typeof){case Yo:return S=Al(h.type,h.key,h.props,null,b.mode,S),S.ref=Ra(b,null,h),S.return=b,S;case Mr:return h=Sc(h,b.mode,S),h.return=b,h;case Ps:var P=h._init;return y(b,P(h._payload),S)}if(Pa(h)||Ea(h))return h=hr(h,b.mode,S,null),h.return=b,h;rl(b,h)}return null}function N(b,h,S,P){var U=h!==null?h.key:null;if(typeof S=="string"&&S!==""||typeof S=="number")return U!==null?null:c(b,h,""+S,P);if(typeof S=="object"&&S!==null){switch(S.$$typeof){case Yo:return S.key===U?i(b,h,S,P):null;case Mr:return S.key===U?u(b,h,S,P):null;case Ps:return U=S._init,N(b,h,U(S._payload),P)}if(Pa(S)||Ea(S))return U!==null?null:p(b,h,S,P,null);rl(b,S)}return null}function w(b,h,S,P,U){if(typeof P=="string"&&P!==""||typeof P=="number")return b=b.get(S)||null,c(h,b,""+P,U);if(typeof P=="object"&&P!==null){switch(P.$$typeof){case Yo:return b=b.get(P.key===null?S:P.key)||null,i(h,b,P,U);case Mr:return b=b.get(P.key===null?S:P.key)||null,u(h,b,P,U);case Ps:var z=P._init;return w(b,h,S,z(P._payload),U)}if(Pa(P)||Ea(P))return b=b.get(S)||null,p(h,b,P,U,null);rl(h,P)}return null}function R(b,h,S,P){for(var U=null,z=null,q=h,ee=h=0,G=null;q!==null&&ee<S.length;ee++){q.index>ee?(G=q,q=null):G=q.sibling;var se=N(b,q,S[ee],P);if(se===null){q===null&&(q=G);break}e&&q&&se.alternate===null&&t(b,q),h=o(se,h,ee),z===null?U=se:z.sibling=se,z=se,q=G}if(ee===S.length)return s(b,q),Et&&ir(b,ee),U;if(q===null){for(;ee<S.length;ee++)q=y(b,S[ee],P),q!==null&&(h=o(q,h,ee),z===null?U=q:z.sibling=q,z=q);return Et&&ir(b,ee),U}for(q=r(b,q);ee<S.length;ee++)G=w(q,b,ee,S[ee],P),G!==null&&(e&&G.alternate!==null&&q.delete(G.key===null?ee:G.key),h=o(G,h,ee),z===null?U=G:z.sibling=G,z=G);return e&&q.forEach(function(j){return t(b,j)}),Et&&ir(b,ee),U}function E(b,h,S,P){var U=Ea(S);if(typeof U!="function")throw Error(me(150));if(S=U.call(S),S==null)throw Error(me(151));for(var z=U=null,q=h,ee=h=0,G=null,se=S.next();q!==null&&!se.done;ee++,se=S.next()){q.index>ee?(G=q,q=null):G=q.sibling;var j=N(b,q,se.value,P);if(j===null){q===null&&(q=G);break}e&&q&&j.alternate===null&&t(b,q),h=o(j,h,ee),z===null?U=j:z.sibling=j,z=j,q=G}if(se.done)return s(b,q),Et&&ir(b,ee),U;if(q===null){for(;!se.done;ee++,se=S.next())se=y(b,se.value,P),se!==null&&(h=o(se,h,ee),z===null?U=se:z.sibling=se,z=se);return Et&&ir(b,ee),U}for(q=r(b,q);!se.done;ee++,se=S.next())se=w(q,b,ee,se.value,P),se!==null&&(e&&se.alternate!==null&&q.delete(se.key===null?ee:se.key),h=o(se,h,ee),z===null?U=se:z.sibling=se,z=se);return e&&q.forEach(function(F){return t(b,F)}),Et&&ir(b,ee),U}function W(b,h,S,P){if(typeof S=="object"&&S!==null&&S.type===Pr&&S.key===null&&(S=S.props.children),typeof S=="object"&&S!==null){switch(S.$$typeof){case Yo:e:{for(var U=S.key,z=h;z!==null;){if(z.key===U){if(U=S.type,U===Pr){if(z.tag===7){s(b,z.sibling),h=a(z,S.props.children),h.return=b,b=h;break e}}else if(z.elementType===U||typeof U=="object"&&U!==null&&U.$$typeof===Ps&&Om(U)===z.type){s(b,z.sibling),h=a(z,S.props),h.ref=Ra(b,z,S),h.return=b,b=h;break e}s(b,z);break}else t(b,z);z=z.sibling}S.type===Pr?(h=hr(S.props.children,b.mode,P,S.key),h.return=b,b=h):(P=Al(S.type,S.key,S.props,null,b.mode,P),P.ref=Ra(b,h,S),P.return=b,b=P)}return l(b);case Mr:e:{for(z=S.key;h!==null;){if(h.key===z)if(h.tag===4&&h.stateNode.containerInfo===S.containerInfo&&h.stateNode.implementation===S.implementation){s(b,h.sibling),h=a(h,S.children||[]),h.return=b,b=h;break e}else{s(b,h);break}else t(b,h);h=h.sibling}h=Sc(S,b.mode,P),h.return=b,b=h}return l(b);case Ps:return z=S._init,W(b,h,z(S._payload),P)}if(Pa(S))return R(b,h,S,P);if(Ea(S))return E(b,h,S,P);rl(b,S)}return typeof S=="string"&&S!==""||typeof S=="number"?(S=""+S,h!==null&&h.tag===6?(s(b,h.sibling),h=a(h,S),h.return=b,b=h):(s(b,h),h=vc(S,b.mode,P),h.return=b,b=h),l(b)):s(b,h)}return W}var ra=ix(!0),cx=ix(!1),Ul=rr(null),Wl=null,Vr=null,iu=null;function cu(){iu=Vr=Wl=null}function du(e){var t=Ul.current;jt(Ul),e._currentValue=t}function xd(e,t,s){for(;e!==null;){var r=e.alternate;if((e.childLanes&t)!==t?(e.childLanes|=t,r!==null&&(r.childLanes|=t)):r!==null&&(r.childLanes&t)!==t&&(r.childLanes|=t),e===s)break;e=e.return}}function Qr(e,t){Wl=e,iu=Vr=null,e=e.dependencies,e!==null&&e.firstContext!==null&&(e.lanes&t&&(bn=!0),e.firstContext=null)}function Bn(e){var t=e._currentValue;if(iu!==e)if(e={context:e,memoizedValue:t,next:null},Vr===null){if(Wl===null)throw Error(me(308));Vr=e,Wl.dependencies={lanes:0,firstContext:e}}else Vr=Vr.next=e;return t}var pr=null;function uu(e){pr===null?pr=[e]:pr.push(e)}function dx(e,t,s,r){var a=t.interleaved;return a===null?(s.next=s,uu(t)):(s.next=a.next,a.next=s),t.interleaved=s,Is(e,r)}function Is(e,t){e.lanes|=t;var s=e.alternate;for(s!==null&&(s.lanes|=t),s=e,e=e.return;e!==null;)e.childLanes|=t,s=e.alternate,s!==null&&(s.childLanes|=t),s=e,e=e.return;return s.tag===3?s.stateNode:null}var Fs=!1;function mu(e){e.updateQueue={baseState:e.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function ux(e,t){e=e.updateQueue,t.updateQueue===e&&(t.updateQueue={baseState:e.baseState,firstBaseUpdate:e.firstBaseUpdate,lastBaseUpdate:e.lastBaseUpdate,shared:e.shared,effects:e.effects})}function ws(e,t){return{eventTime:e,lane:t,tag:0,payload:null,callback:null,next:null}}function Js(e,t,s){var r=e.updateQueue;if(r===null)return null;if(r=r.shared,it&2){var a=r.pending;return a===null?t.next=t:(t.next=a.next,a.next=t),r.pending=t,Is(e,s)}return a=r.interleaved,a===null?(t.next=t,uu(r)):(t.next=a.next,a.next=t),r.interleaved=t,Is(e,s)}function vl(e,t,s){if(t=t.updateQueue,t!==null&&(t=t.shared,(s&4194240)!==0)){var r=t.lanes;r&=e.pendingLanes,s|=r,t.lanes=s,Jd(e,s)}}function Mm(e,t){var s=e.updateQueue,r=e.alternate;if(r!==null&&(r=r.updateQueue,s===r)){var a=null,o=null;if(s=s.firstBaseUpdate,s!==null){do{var l={eventTime:s.eventTime,lane:s.lane,tag:s.tag,payload:s.payload,callback:s.callback,next:null};o===null?a=o=l:o=o.next=l,s=s.next}while(s!==null);o===null?a=o=t:o=o.next=t}else a=o=t;s={baseState:r.baseState,firstBaseUpdate:a,lastBaseUpdate:o,shared:r.shared,effects:r.effects},e.updateQueue=s;return}e=s.lastBaseUpdate,e===null?s.firstBaseUpdate=t:e.next=t,s.lastBaseUpdate=t}function zl(e,t,s,r){var a=e.updateQueue;Fs=!1;var o=a.firstBaseUpdate,l=a.lastBaseUpdate,c=a.shared.pending;if(c!==null){a.shared.pending=null;var i=c,u=i.next;i.next=null,l===null?o=u:l.next=u,l=i;var p=e.alternate;p!==null&&(p=p.updateQueue,c=p.lastBaseUpdate,c!==l&&(c===null?p.firstBaseUpdate=u:c.next=u,p.lastBaseUpdate=i))}if(o!==null){var y=a.baseState;l=0,p=u=i=null,c=o;do{var N=c.lane,w=c.eventTime;if((r&N)===N){p!==null&&(p=p.next={eventTime:w,lane:0,tag:c.tag,payload:c.payload,callback:c.callback,next:null});e:{var R=e,E=c;switch(N=t,w=s,E.tag){case 1:if(R=E.payload,typeof R=="function"){y=R.call(w,y,N);break e}y=R;break e;case 3:R.flags=R.flags&-65537|128;case 0:if(R=E.payload,N=typeof R=="function"?R.call(w,y,N):R,N==null)break e;y=Tt({},y,N);break e;case 2:Fs=!0}}c.callback!==null&&c.lane!==0&&(e.flags|=64,N=a.effects,N===null?a.effects=[c]:N.push(c))}else w={eventTime:w,lane:N,tag:c.tag,payload:c.payload,callback:c.callback,next:null},p===null?(u=p=w,i=y):p=p.next=w,l|=N;if(c=c.next,c===null){if(c=a.shared.pending,c===null)break;N=c,c=N.next,N.next=null,a.lastBaseUpdate=N,a.shared.pending=null}}while(!0);if(p===null&&(i=y),a.baseState=i,a.firstBaseUpdate=u,a.lastBaseUpdate=p,t=a.shared.interleaved,t!==null){a=t;do l|=a.lane,a=a.next;while(a!==t)}else o===null&&(a.shared.lanes=0);vr|=l,e.lanes=l,e.memoizedState=y}}function Pm(e,t,s){if(e=t.effects,t.effects=null,e!==null)for(t=0;t<e.length;t++){var r=e[t],a=r.callback;if(a!==null){if(r.callback=null,r=s,typeof a!="function")throw Error(me(191,a));a.call(r)}}}var Ro={},ms=rr(Ro),co=rr(Ro),uo=rr(Ro);function fr(e){if(e===Ro)throw Error(me(174));return e}function pu(e,t){switch(bt(uo,t),bt(co,e),bt(ms,Ro),e=t.nodeType,e){case 9:case 11:t=(t=t.documentElement)?t.namespaceURI:qc(null,"");break;default:e=e===8?t.parentNode:t,t=e.namespaceURI||null,e=e.tagName,t=qc(t,e)}jt(ms),bt(ms,t)}function aa(){jt(ms),jt(co),jt(uo)}function mx(e){fr(uo.current);var t=fr(ms.current),s=qc(t,e.type);t!==s&&(bt(co,e),bt(ms,s))}function fu(e){co.current===e&&(jt(ms),jt(co))}var At=rr(0);function Vl(e){for(var t=e;t!==null;){if(t.tag===13){var s=t.memoizedState;if(s!==null&&(s=s.dehydrated,s===null||s.data==="$?"||s.data==="$!"))return t}else if(t.tag===19&&t.memoizedProps.revealOrder!==void 0){if(t.flags&128)return t}else if(t.child!==null){t.child.return=t,t=t.child;continue}if(t===e)break;for(;t.sibling===null;){if(t.return===null||t.return===e)return null;t=t.return}t.sibling.return=t.return,t=t.sibling}return null}var xc=[];function xu(){for(var e=0;e<xc.length;e++)xc[e]._workInProgressVersionPrimary=null;xc.length=0}var Sl=Rs.ReactCurrentDispatcher,hc=Rs.ReactCurrentBatchConfig,Nr=0,It=null,$t=null,Vt=null,Kl=!1,Va=!1,mo=0,Ky=0;function an(){throw Error(me(321))}function hu(e,t){if(t===null)return!1;for(var s=0;s<t.length&&s<e.length;s++)if(!Qn(e[s],t[s]))return!1;return!0}function gu(e,t,s,r,a,o){if(Nr=o,It=t,t.memoizedState=null,t.updateQueue=null,t.lanes=0,Sl.current=e===null||e.memoizedState===null?Xy:Jy,e=s(r,a),Va){o=0;do{if(Va=!1,mo=0,25<=o)throw Error(me(301));o+=1,Vt=$t=null,t.updateQueue=null,Sl.current=Qy,e=s(r,a)}while(Va)}if(Sl.current=Yl,t=$t!==null&&$t.next!==null,Nr=0,Vt=$t=It=null,Kl=!1,t)throw Error(me(300));return e}function yu(){var e=mo!==0;return mo=0,e}function rs(){var e={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Vt===null?It.memoizedState=Vt=e:Vt=Vt.next=e,Vt}function $n(){if($t===null){var e=It.alternate;e=e!==null?e.memoizedState:null}else e=$t.next;var t=Vt===null?It.memoizedState:Vt.next;if(t!==null)Vt=t,$t=e;else{if(e===null)throw Error(me(310));$t=e,e={memoizedState:$t.memoizedState,baseState:$t.baseState,baseQueue:$t.baseQueue,queue:$t.queue,next:null},Vt===null?It.memoizedState=Vt=e:Vt=Vt.next=e}return Vt}function po(e,t){return typeof t=="function"?t(e):t}function gc(e){var t=$n(),s=t.queue;if(s===null)throw Error(me(311));s.lastRenderedReducer=e;var r=$t,a=r.baseQueue,o=s.pending;if(o!==null){if(a!==null){var l=a.next;a.next=o.next,o.next=l}r.baseQueue=a=o,s.pending=null}if(a!==null){o=a.next,r=r.baseState;var c=l=null,i=null,u=o;do{var p=u.lane;if((Nr&p)===p)i!==null&&(i=i.next={lane:0,action:u.action,hasEagerState:u.hasEagerState,eagerState:u.eagerState,next:null}),r=u.hasEagerState?u.eagerState:e(r,u.action);else{var y={lane:p,action:u.action,hasEagerState:u.hasEagerState,eagerState:u.eagerState,next:null};i===null?(c=i=y,l=r):i=i.next=y,It.lanes|=p,vr|=p}u=u.next}while(u!==null&&u!==o);i===null?l=r:i.next=c,Qn(r,t.memoizedState)||(bn=!0),t.memoizedState=r,t.baseState=l,t.baseQueue=i,s.lastRenderedState=r}if(e=s.interleaved,e!==null){a=e;do o=a.lane,It.lanes|=o,vr|=o,a=a.next;while(a!==e)}else a===null&&(s.lanes=0);return[t.memoizedState,s.dispatch]}function yc(e){var t=$n(),s=t.queue;if(s===null)throw Error(me(311));s.lastRenderedReducer=e;var r=s.dispatch,a=s.pending,o=t.memoizedState;if(a!==null){s.pending=null;var l=a=a.next;do o=e(o,l.action),l=l.next;while(l!==a);Qn(o,t.memoizedState)||(bn=!0),t.memoizedState=o,t.baseQueue===null&&(t.baseState=o),s.lastRenderedState=o}return[o,r]}function px(){}function fx(e,t){var s=It,r=$n(),a=t(),o=!Qn(r.memoizedState,a);if(o&&(r.memoizedState=a,bn=!0),r=r.queue,bu(gx.bind(null,s,r,e),[e]),r.getSnapshot!==t||o||Vt!==null&&Vt.memoizedState.tag&1){if(s.flags|=2048,fo(9,hx.bind(null,s,r,a,t),void 0,null),Kt===null)throw Error(me(349));Nr&30||xx(s,t,a)}return a}function xx(e,t,s){e.flags|=16384,e={getSnapshot:t,value:s},t=It.updateQueue,t===null?(t={lastEffect:null,stores:null},It.updateQueue=t,t.stores=[e]):(s=t.stores,s===null?t.stores=[e]:s.push(e))}function hx(e,t,s,r){t.value=s,t.getSnapshot=r,yx(t)&&bx(e)}function gx(e,t,s){return s(function(){yx(t)&&bx(e)})}function yx(e){var t=e.getSnapshot;e=e.value;try{var s=t();return!Qn(e,s)}catch{return!0}}function bx(e){var t=Is(e,1);t!==null&&Xn(t,e,1,-1)}function Fm(e){var t=rs();return typeof e=="function"&&(e=e()),t.memoizedState=t.baseState=e,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:po,lastRenderedState:e},t.queue=e,e=e.dispatch=qy.bind(null,It,e),[t.memoizedState,e]}function fo(e,t,s,r){return e={tag:e,create:t,destroy:s,deps:r,next:null},t=It.updateQueue,t===null?(t={lastEffect:null,stores:null},It.updateQueue=t,t.lastEffect=e.next=e):(s=t.lastEffect,s===null?t.lastEffect=e.next=e:(r=s.next,s.next=e,e.next=r,t.lastEffect=e)),e}function Nx(){return $n().memoizedState}function wl(e,t,s,r){var a=rs();It.flags|=e,a.memoizedState=fo(1|t,s,void 0,r===void 0?null:r)}function yi(e,t,s,r){var a=$n();r=r===void 0?null:r;var o=void 0;if($t!==null){var l=$t.memoizedState;if(o=l.destroy,r!==null&&hu(r,l.deps)){a.memoizedState=fo(t,s,o,r);return}}It.flags|=e,a.memoizedState=fo(1|t,s,o,r)}function Bm(e,t){return wl(8390656,8,e,t)}function bu(e,t){return yi(2048,8,e,t)}function vx(e,t){return yi(4,2,e,t)}function Sx(e,t){return yi(4,4,e,t)}function wx(e,t){if(typeof t=="function")return e=e(),t(e),function(){t(null)};if(t!=null)return e=e(),t.current=e,function(){t.current=null}}function jx(e,t,s){return s=s!=null?s.concat([e]):null,yi(4,4,wx.bind(null,t,e),s)}function Nu(){}function Ex(e,t){var s=$n();t=t===void 0?null:t;var r=s.memoizedState;return r!==null&&t!==null&&hu(t,r[1])?r[0]:(s.memoizedState=[e,t],e)}function kx(e,t){var s=$n();t=t===void 0?null:t;var r=s.memoizedState;return r!==null&&t!==null&&hu(t,r[1])?r[0]:(e=e(),s.memoizedState=[e,t],e)}function Ax(e,t,s){return Nr&21?(Qn(s,t)||(s=Df(),It.lanes|=s,vr|=s,e.baseState=!0),t):(e.baseState&&(e.baseState=!1,bn=!0),e.memoizedState=s)}function Yy(e,t){var s=ut;ut=s!==0&&4>s?s:4,e(!0);var r=hc.transition;hc.transition={};try{e(!1),t()}finally{ut=s,hc.transition=r}}function Ix(){return $n().memoizedState}function Gy(e,t,s){var r=Zs(e);if(s={lane:r,action:s,hasEagerState:!1,eagerState:null,next:null},Tx(e))Rx(t,s);else if(s=dx(e,t,s,r),s!==null){var a=fn();Xn(s,e,r,a),Cx(s,t,r)}}function qy(e,t,s){var r=Zs(e),a={lane:r,action:s,hasEagerState:!1,eagerState:null,next:null};if(Tx(e))Rx(t,a);else{var o=e.alternate;if(e.lanes===0&&(o===null||o.lanes===0)&&(o=t.lastRenderedReducer,o!==null))try{var l=t.lastRenderedState,c=o(l,s);if(a.hasEagerState=!0,a.eagerState=c,Qn(c,l)){var i=t.interleaved;i===null?(a.next=a,uu(t)):(a.next=i.next,i.next=a),t.interleaved=a;return}}catch{}finally{}s=dx(e,t,a,r),s!==null&&(a=fn(),Xn(s,e,r,a),Cx(s,t,r))}}function Tx(e){var t=e.alternate;return e===It||t!==null&&t===It}function Rx(e,t){Va=Kl=!0;var s=e.pending;s===null?t.next=t:(t.next=s.next,s.next=t),e.pending=t}function Cx(e,t,s){if(s&4194240){var r=t.lanes;r&=e.pendingLanes,s|=r,t.lanes=s,Jd(e,s)}}var Yl={readContext:Bn,useCallback:an,useContext:an,useEffect:an,useImperativeHandle:an,useInsertionEffect:an,useLayoutEffect:an,useMemo:an,useReducer:an,useRef:an,useState:an,useDebugValue:an,useDeferredValue:an,useTransition:an,useMutableSource:an,useSyncExternalStore:an,useId:an,unstable_isNewReconciler:!1},Xy={readContext:Bn,useCallback:function(e,t){return rs().memoizedState=[e,t===void 0?null:t],e},useContext:Bn,useEffect:Bm,useImperativeHandle:function(e,t,s){return s=s!=null?s.concat([e]):null,wl(4194308,4,wx.bind(null,t,e),s)},useLayoutEffect:function(e,t){return wl(4194308,4,e,t)},useInsertionEffect:function(e,t){return wl(4,2,e,t)},useMemo:function(e,t){var s=rs();return t=t===void 0?null:t,e=e(),s.memoizedState=[e,t],e},useReducer:function(e,t,s){var r=rs();return t=s!==void 0?s(t):t,r.memoizedState=r.baseState=t,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:e,lastRenderedState:t},r.queue=e,e=e.dispatch=Gy.bind(null,It,e),[r.memoizedState,e]},useRef:function(e){var t=rs();return e={current:e},t.memoizedState=e},useState:Fm,useDebugValue:Nu,useDeferredValue:function(e){return rs().memoizedState=e},useTransition:function(){var e=Fm(!1),t=e[0];return e=Yy.bind(null,e[1]),rs().memoizedState=e,[t,e]},useMutableSource:function(){},useSyncExternalStore:function(e,t,s){var r=It,a=rs();if(Et){if(s===void 0)throw Error(me(407));s=s()}else{if(s=t(),Kt===null)throw Error(me(349));Nr&30||xx(r,t,s)}a.memoizedState=s;var o={value:s,getSnapshot:t};return a.queue=o,Bm(gx.bind(null,r,o,e),[e]),r.flags|=2048,fo(9,hx.bind(null,r,o,s,t),void 0,null),s},useId:function(){var e=rs(),t=Kt.identifierPrefix;if(Et){var s=Ss,r=vs;s=(r&~(1<<32-qn(r)-1)).toString(32)+s,t=":"+t+"R"+s,s=mo++,0<s&&(t+="H"+s.toString(32)),t+=":"}else s=Ky++,t=":"+t+"r"+s.toString(32)+":";return e.memoizedState=t},unstable_isNewReconciler:!1},Jy={readContext:Bn,useCallback:Ex,useContext:Bn,useEffect:bu,useImperativeHandle:jx,useInsertionEffect:vx,useLayoutEffect:Sx,useMemo:kx,useReducer:gc,useRef:Nx,useState:function(){return gc(po)},useDebugValue:Nu,useDeferredValue:function(e){var t=$n();return Ax(t,$t.memoizedState,e)},useTransition:function(){var e=gc(po)[0],t=$n().memoizedState;return[e,t]},useMutableSource:px,useSyncExternalStore:fx,useId:Ix,unstable_isNewReconciler:!1},Qy={readContext:Bn,useCallback:Ex,useContext:Bn,useEffect:bu,useImperativeHandle:jx,useInsertionEffect:vx,useLayoutEffect:Sx,useMemo:kx,useReducer:yc,useRef:Nx,useState:function(){return yc(po)},useDebugValue:Nu,useDeferredValue:function(e){var t=$n();return $t===null?t.memoizedState=e:Ax(t,$t.memoizedState,e)},useTransition:function(){var e=yc(po)[0],t=$n().memoizedState;return[e,t]},useMutableSource:px,useSyncExternalStore:fx,useId:Ix,unstable_isNewReconciler:!1};function Kn(e,t){if(e&&e.defaultProps){t=Tt({},t),e=e.defaultProps;for(var s in e)t[s]===void 0&&(t[s]=e[s]);return t}return t}function hd(e,t,s,r){t=e.memoizedState,s=s(r,t),s=s==null?t:Tt({},t,s),e.memoizedState=s,e.lanes===0&&(e.updateQueue.baseState=s)}var bi={isMounted:function(e){return(e=e._reactInternals)?Er(e)===e:!1},enqueueSetState:function(e,t,s){e=e._reactInternals;var r=fn(),a=Zs(e),o=ws(r,a);o.payload=t,s!=null&&(o.callback=s),t=Js(e,o,a),t!==null&&(Xn(t,e,a,r),vl(t,e,a))},enqueueReplaceState:function(e,t,s){e=e._reactInternals;var r=fn(),a=Zs(e),o=ws(r,a);o.tag=1,o.payload=t,s!=null&&(o.callback=s),t=Js(e,o,a),t!==null&&(Xn(t,e,a,r),vl(t,e,a))},enqueueForceUpdate:function(e,t){e=e._reactInternals;var s=fn(),r=Zs(e),a=ws(s,r);a.tag=2,t!=null&&(a.callback=t),t=Js(e,a,r),t!==null&&(Xn(t,e,r,s),vl(t,e,r))}};function $m(e,t,s,r,a,o,l){return e=e.stateNode,typeof e.shouldComponentUpdate=="function"?e.shouldComponentUpdate(r,o,l):t.prototype&&t.prototype.isPureReactComponent?!ao(s,r)||!ao(a,o):!0}function Dx(e,t,s){var r=!1,a=nr,o=t.contextType;return typeof o=="object"&&o!==null?o=Bn(o):(a=vn(t)?yr:dn.current,r=t.contextTypes,o=(r=r!=null)?na(e,a):nr),t=new t(s,o),e.memoizedState=t.state!==null&&t.state!==void 0?t.state:null,t.updater=bi,e.stateNode=t,t._reactInternals=e,r&&(e=e.stateNode,e.__reactInternalMemoizedUnmaskedChildContext=a,e.__reactInternalMemoizedMaskedChildContext=o),t}function Hm(e,t,s,r){e=t.state,typeof t.componentWillReceiveProps=="function"&&t.componentWillReceiveProps(s,r),typeof t.UNSAFE_componentWillReceiveProps=="function"&&t.UNSAFE_componentWillReceiveProps(s,r),t.state!==e&&bi.enqueueReplaceState(t,t.state,null)}function gd(e,t,s,r){var a=e.stateNode;a.props=s,a.state=e.memoizedState,a.refs={},mu(e);var o=t.contextType;typeof o=="object"&&o!==null?a.context=Bn(o):(o=vn(t)?yr:dn.current,a.context=na(e,o)),a.state=e.memoizedState,o=t.getDerivedStateFromProps,typeof o=="function"&&(hd(e,t,o,s),a.state=e.memoizedState),typeof t.getDerivedStateFromProps=="function"||typeof a.getSnapshotBeforeUpdate=="function"||typeof a.UNSAFE_componentWillMount!="function"&&typeof a.componentWillMount!="function"||(t=a.state,typeof a.componentWillMount=="function"&&a.componentWillMount(),typeof a.UNSAFE_componentWillMount=="function"&&a.UNSAFE_componentWillMount(),t!==a.state&&bi.enqueueReplaceState(a,a.state,null),zl(e,s,a,r),a.state=e.memoizedState),typeof a.componentDidMount=="function"&&(e.flags|=4194308)}function oa(e,t){try{var s="",r=t;do s+=kg(r),r=r.return;while(r);var a=s}catch(o){a=`
Error generating stack: `+o.message+`
`+o.stack}return{value:e,source:t,stack:a,digest:null}}function bc(e,t,s){return{value:e,source:null,stack:s??null,digest:t??null}}function yd(e,t){try{console.error(t.value)}catch(s){setTimeout(function(){throw s})}}var Zy=typeof WeakMap=="function"?WeakMap:Map;function Lx(e,t,s){s=ws(-1,s),s.tag=3,s.payload={element:null};var r=t.value;return s.callback=function(){ql||(ql=!0,Id=r),yd(e,t)},s}function _x(e,t,s){s=ws(-1,s),s.tag=3;var r=e.type.getDerivedStateFromError;if(typeof r=="function"){var a=t.value;s.payload=function(){return r(a)},s.callback=function(){yd(e,t)}}var o=e.stateNode;return o!==null&&typeof o.componentDidCatch=="function"&&(s.callback=function(){yd(e,t),typeof r!="function"&&(Qs===null?Qs=new Set([this]):Qs.add(this));var l=t.stack;this.componentDidCatch(t.value,{componentStack:l!==null?l:""})}),s}function Um(e,t,s){var r=e.pingCache;if(r===null){r=e.pingCache=new Zy;var a=new Set;r.set(t,a)}else a=r.get(t),a===void 0&&(a=new Set,r.set(t,a));a.has(s)||(a.add(s),e=p0.bind(null,e,t,s),t.then(e,e))}function Wm(e){do{var t;if((t=e.tag===13)&&(t=e.memoizedState,t=t!==null?t.dehydrated!==null:!0),t)return e;e=e.return}while(e!==null);return null}function zm(e,t,s,r,a){return e.mode&1?(e.flags|=65536,e.lanes=a,e):(e===t?e.flags|=65536:(e.flags|=128,s.flags|=131072,s.flags&=-52805,s.tag===1&&(s.alternate===null?s.tag=17:(t=ws(-1,1),t.tag=2,Js(s,t,1))),s.lanes|=1),e)}var e0=Rs.ReactCurrentOwner,bn=!1;function pn(e,t,s,r){t.child=e===null?cx(t,null,s,r):ra(t,e.child,s,r)}function Vm(e,t,s,r,a){s=s.render;var o=t.ref;return Qr(t,a),r=gu(e,t,s,r,o,a),s=yu(),e!==null&&!bn?(t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~a,Ts(e,t,a)):(Et&&s&&au(t),t.flags|=1,pn(e,t,r,a),t.child)}function Km(e,t,s,r,a){if(e===null){var o=s.type;return typeof o=="function"&&!Iu(o)&&o.defaultProps===void 0&&s.compare===null&&s.defaultProps===void 0?(t.tag=15,t.type=o,Ox(e,t,o,r,a)):(e=Al(s.type,null,r,t,t.mode,a),e.ref=t.ref,e.return=t,t.child=e)}if(o=e.child,!(e.lanes&a)){var l=o.memoizedProps;if(s=s.compare,s=s!==null?s:ao,s(l,r)&&e.ref===t.ref)return Ts(e,t,a)}return t.flags|=1,e=er(o,r),e.ref=t.ref,e.return=t,t.child=e}function Ox(e,t,s,r,a){if(e!==null){var o=e.memoizedProps;if(ao(o,r)&&e.ref===t.ref)if(bn=!1,t.pendingProps=r=o,(e.lanes&a)!==0)e.flags&131072&&(bn=!0);else return t.lanes=e.lanes,Ts(e,t,a)}return bd(e,t,s,r,a)}function Mx(e,t,s){var r=t.pendingProps,a=r.children,o=e!==null?e.memoizedState:null;if(r.mode==="hidden")if(!(t.mode&1))t.memoizedState={baseLanes:0,cachePool:null,transitions:null},bt(Yr,jn),jn|=s;else{if(!(s&1073741824))return e=o!==null?o.baseLanes|s:s,t.lanes=t.childLanes=1073741824,t.memoizedState={baseLanes:e,cachePool:null,transitions:null},t.updateQueue=null,bt(Yr,jn),jn|=e,null;t.memoizedState={baseLanes:0,cachePool:null,transitions:null},r=o!==null?o.baseLanes:s,bt(Yr,jn),jn|=r}else o!==null?(r=o.baseLanes|s,t.memoizedState=null):r=s,bt(Yr,jn),jn|=r;return pn(e,t,a,s),t.child}function Px(e,t){var s=t.ref;(e===null&&s!==null||e!==null&&e.ref!==s)&&(t.flags|=512,t.flags|=2097152)}function bd(e,t,s,r,a){var o=vn(s)?yr:dn.current;return o=na(t,o),Qr(t,a),s=gu(e,t,s,r,o,a),r=yu(),e!==null&&!bn?(t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~a,Ts(e,t,a)):(Et&&r&&au(t),t.flags|=1,pn(e,t,s,a),t.child)}function Ym(e,t,s,r,a){if(vn(s)){var o=!0;Bl(t)}else o=!1;if(Qr(t,a),t.stateNode===null)jl(e,t),Dx(t,s,r),gd(t,s,r,a),r=!0;else if(e===null){var l=t.stateNode,c=t.memoizedProps;l.props=c;var i=l.context,u=s.contextType;typeof u=="object"&&u!==null?u=Bn(u):(u=vn(s)?yr:dn.current,u=na(t,u));var p=s.getDerivedStateFromProps,y=typeof p=="function"||typeof l.getSnapshotBeforeUpdate=="function";y||typeof l.UNSAFE_componentWillReceiveProps!="function"&&typeof l.componentWillReceiveProps!="function"||(c!==r||i!==u)&&Hm(t,l,r,u),Fs=!1;var N=t.memoizedState;l.state=N,zl(t,r,l,a),i=t.memoizedState,c!==r||N!==i||Nn.current||Fs?(typeof p=="function"&&(hd(t,s,p,r),i=t.memoizedState),(c=Fs||$m(t,s,c,r,N,i,u))?(y||typeof l.UNSAFE_componentWillMount!="function"&&typeof l.componentWillMount!="function"||(typeof l.componentWillMount=="function"&&l.componentWillMount(),typeof l.UNSAFE_componentWillMount=="function"&&l.UNSAFE_componentWillMount()),typeof l.componentDidMount=="function"&&(t.flags|=4194308)):(typeof l.componentDidMount=="function"&&(t.flags|=4194308),t.memoizedProps=r,t.memoizedState=i),l.props=r,l.state=i,l.context=u,r=c):(typeof l.componentDidMount=="function"&&(t.flags|=4194308),r=!1)}else{l=t.stateNode,ux(e,t),c=t.memoizedProps,u=t.type===t.elementType?c:Kn(t.type,c),l.props=u,y=t.pendingProps,N=l.context,i=s.contextType,typeof i=="object"&&i!==null?i=Bn(i):(i=vn(s)?yr:dn.current,i=na(t,i));var w=s.getDerivedStateFromProps;(p=typeof w=="function"||typeof l.getSnapshotBeforeUpdate=="function")||typeof l.UNSAFE_componentWillReceiveProps!="function"&&typeof l.componentWillReceiveProps!="function"||(c!==y||N!==i)&&Hm(t,l,r,i),Fs=!1,N=t.memoizedState,l.state=N,zl(t,r,l,a);var R=t.memoizedState;c!==y||N!==R||Nn.current||Fs?(typeof w=="function"&&(hd(t,s,w,r),R=t.memoizedState),(u=Fs||$m(t,s,u,r,N,R,i)||!1)?(p||typeof l.UNSAFE_componentWillUpdate!="function"&&typeof l.componentWillUpdate!="function"||(typeof l.componentWillUpdate=="function"&&l.componentWillUpdate(r,R,i),typeof l.UNSAFE_componentWillUpdate=="function"&&l.UNSAFE_componentWillUpdate(r,R,i)),typeof l.componentDidUpdate=="function"&&(t.flags|=4),typeof l.getSnapshotBeforeUpdate=="function"&&(t.flags|=1024)):(typeof l.componentDidUpdate!="function"||c===e.memoizedProps&&N===e.memoizedState||(t.flags|=4),typeof l.getSnapshotBeforeUpdate!="function"||c===e.memoizedProps&&N===e.memoizedState||(t.flags|=1024),t.memoizedProps=r,t.memoizedState=R),l.props=r,l.state=R,l.context=i,r=u):(typeof l.componentDidUpdate!="function"||c===e.memoizedProps&&N===e.memoizedState||(t.flags|=4),typeof l.getSnapshotBeforeUpdate!="function"||c===e.memoizedProps&&N===e.memoizedState||(t.flags|=1024),r=!1)}return Nd(e,t,s,r,o,a)}function Nd(e,t,s,r,a,o){Px(e,t);var l=(t.flags&128)!==0;if(!r&&!l)return a&&Dm(t,s,!1),Ts(e,t,o);r=t.stateNode,e0.current=t;var c=l&&typeof s.getDerivedStateFromError!="function"?null:r.render();return t.flags|=1,e!==null&&l?(t.child=ra(t,e.child,null,o),t.child=ra(t,null,c,o)):pn(e,t,c,o),t.memoizedState=r.state,a&&Dm(t,s,!0),t.child}function Fx(e){var t=e.stateNode;t.pendingContext?Cm(e,t.pendingContext,t.pendingContext!==t.context):t.context&&Cm(e,t.context,!1),pu(e,t.containerInfo)}function Gm(e,t,s,r,a){return sa(),lu(a),t.flags|=256,pn(e,t,s,r),t.child}var vd={dehydrated:null,treeContext:null,retryLane:0};function Sd(e){return{baseLanes:e,cachePool:null,transitions:null}}function Bx(e,t,s){var r=t.pendingProps,a=At.current,o=!1,l=(t.flags&128)!==0,c;if((c=l)||(c=e!==null&&e.memoizedState===null?!1:(a&2)!==0),c?(o=!0,t.flags&=-129):(e===null||e.memoizedState!==null)&&(a|=1),bt(At,a&1),e===null)return fd(t),e=t.memoizedState,e!==null&&(e=e.dehydrated,e!==null)?(t.mode&1?e.data==="$!"?t.lanes=8:t.lanes=1073741824:t.lanes=1,null):(l=r.children,e=r.fallback,o?(r=t.mode,o=t.child,l={mode:"hidden",children:l},!(r&1)&&o!==null?(o.childLanes=0,o.pendingProps=l):o=Si(l,r,0,null),e=hr(e,r,s,null),o.return=t,e.return=t,o.sibling=e,t.child=o,t.child.memoizedState=Sd(s),t.memoizedState=vd,e):vu(t,l));if(a=e.memoizedState,a!==null&&(c=a.dehydrated,c!==null))return t0(e,t,l,r,c,a,s);if(o){o=r.fallback,l=t.mode,a=e.child,c=a.sibling;var i={mode:"hidden",children:r.children};return!(l&1)&&t.child!==a?(r=t.child,r.childLanes=0,r.pendingProps=i,t.deletions=null):(r=er(a,i),r.subtreeFlags=a.subtreeFlags&14680064),c!==null?o=er(c,o):(o=hr(o,l,s,null),o.flags|=2),o.return=t,r.return=t,r.sibling=o,t.child=r,r=o,o=t.child,l=e.child.memoizedState,l=l===null?Sd(s):{baseLanes:l.baseLanes|s,cachePool:null,transitions:l.transitions},o.memoizedState=l,o.childLanes=e.childLanes&~s,t.memoizedState=vd,r}return o=e.child,e=o.sibling,r=er(o,{mode:"visible",children:r.children}),!(t.mode&1)&&(r.lanes=s),r.return=t,r.sibling=null,e!==null&&(s=t.deletions,s===null?(t.deletions=[e],t.flags|=16):s.push(e)),t.child=r,t.memoizedState=null,r}function vu(e,t){return t=Si({mode:"visible",children:t},e.mode,0,null),t.return=e,e.child=t}function al(e,t,s,r){return r!==null&&lu(r),ra(t,e.child,null,s),e=vu(t,t.pendingProps.children),e.flags|=2,t.memoizedState=null,e}function t0(e,t,s,r,a,o,l){if(s)return t.flags&256?(t.flags&=-257,r=bc(Error(me(422))),al(e,t,l,r)):t.memoizedState!==null?(t.child=e.child,t.flags|=128,null):(o=r.fallback,a=t.mode,r=Si({mode:"visible",children:r.children},a,0,null),o=hr(o,a,l,null),o.flags|=2,r.return=t,o.return=t,r.sibling=o,t.child=r,t.mode&1&&ra(t,e.child,null,l),t.child.memoizedState=Sd(l),t.memoizedState=vd,o);if(!(t.mode&1))return al(e,t,l,null);if(a.data==="$!"){if(r=a.nextSibling&&a.nextSibling.dataset,r)var c=r.dgst;return r=c,o=Error(me(419)),r=bc(o,r,void 0),al(e,t,l,r)}if(c=(l&e.childLanes)!==0,bn||c){if(r=Kt,r!==null){switch(l&-l){case 4:a=2;break;case 16:a=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:a=32;break;case 536870912:a=268435456;break;default:a=0}a=a&(r.suspendedLanes|l)?0:a,a!==0&&a!==o.retryLane&&(o.retryLane=a,Is(e,a),Xn(r,e,a,-1))}return Au(),r=bc(Error(me(421))),al(e,t,l,r)}return a.data==="$?"?(t.flags|=128,t.child=e.child,t=f0.bind(null,e),a._reactRetry=t,null):(e=o.treeContext,kn=Xs(a.nextSibling),An=t,Et=!0,Gn=null,e!==null&&(_n[On++]=vs,_n[On++]=Ss,_n[On++]=br,vs=e.id,Ss=e.overflow,br=t),t=vu(t,r.children),t.flags|=4096,t)}function qm(e,t,s){e.lanes|=t;var r=e.alternate;r!==null&&(r.lanes|=t),xd(e.return,t,s)}function Nc(e,t,s,r,a){var o=e.memoizedState;o===null?e.memoizedState={isBackwards:t,rendering:null,renderingStartTime:0,last:r,tail:s,tailMode:a}:(o.isBackwards=t,o.rendering=null,o.renderingStartTime=0,o.last=r,o.tail=s,o.tailMode=a)}function $x(e,t,s){var r=t.pendingProps,a=r.revealOrder,o=r.tail;if(pn(e,t,r.children,s),r=At.current,r&2)r=r&1|2,t.flags|=128;else{if(e!==null&&e.flags&128)e:for(e=t.child;e!==null;){if(e.tag===13)e.memoizedState!==null&&qm(e,s,t);else if(e.tag===19)qm(e,s,t);else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===t)break e;for(;e.sibling===null;){if(e.return===null||e.return===t)break e;e=e.return}e.sibling.return=e.return,e=e.sibling}r&=1}if(bt(At,r),!(t.mode&1))t.memoizedState=null;else switch(a){case"forwards":for(s=t.child,a=null;s!==null;)e=s.alternate,e!==null&&Vl(e)===null&&(a=s),s=s.sibling;s=a,s===null?(a=t.child,t.child=null):(a=s.sibling,s.sibling=null),Nc(t,!1,a,s,o);break;case"backwards":for(s=null,a=t.child,t.child=null;a!==null;){if(e=a.alternate,e!==null&&Vl(e)===null){t.child=a;break}e=a.sibling,a.sibling=s,s=a,a=e}Nc(t,!0,s,null,o);break;case"together":Nc(t,!1,null,null,void 0);break;default:t.memoizedState=null}return t.child}function jl(e,t){!(t.mode&1)&&e!==null&&(e.alternate=null,t.alternate=null,t.flags|=2)}function Ts(e,t,s){if(e!==null&&(t.dependencies=e.dependencies),vr|=t.lanes,!(s&t.childLanes))return null;if(e!==null&&t.child!==e.child)throw Error(me(153));if(t.child!==null){for(e=t.child,s=er(e,e.pendingProps),t.child=s,s.return=t;e.sibling!==null;)e=e.sibling,s=s.sibling=er(e,e.pendingProps),s.return=t;s.sibling=null}return t.child}function n0(e,t,s){switch(t.tag){case 3:Fx(t),sa();break;case 5:mx(t);break;case 1:vn(t.type)&&Bl(t);break;case 4:pu(t,t.stateNode.containerInfo);break;case 10:var r=t.type._context,a=t.memoizedProps.value;bt(Ul,r._currentValue),r._currentValue=a;break;case 13:if(r=t.memoizedState,r!==null)return r.dehydrated!==null?(bt(At,At.current&1),t.flags|=128,null):s&t.child.childLanes?Bx(e,t,s):(bt(At,At.current&1),e=Ts(e,t,s),e!==null?e.sibling:null);bt(At,At.current&1);break;case 19:if(r=(s&t.childLanes)!==0,e.flags&128){if(r)return $x(e,t,s);t.flags|=128}if(a=t.memoizedState,a!==null&&(a.rendering=null,a.tail=null,a.lastEffect=null),bt(At,At.current),r)break;return null;case 22:case 23:return t.lanes=0,Mx(e,t,s)}return Ts(e,t,s)}var Hx,wd,Ux,Wx;Hx=function(e,t){for(var s=t.child;s!==null;){if(s.tag===5||s.tag===6)e.appendChild(s.stateNode);else if(s.tag!==4&&s.child!==null){s.child.return=s,s=s.child;continue}if(s===t)break;for(;s.sibling===null;){if(s.return===null||s.return===t)return;s=s.return}s.sibling.return=s.return,s=s.sibling}};wd=function(){};Ux=function(e,t,s,r){var a=e.memoizedProps;if(a!==r){e=t.stateNode,fr(ms.current);var o=null;switch(s){case"input":a=Vc(e,a),r=Vc(e,r),o=[];break;case"select":a=Tt({},a,{value:void 0}),r=Tt({},r,{value:void 0}),o=[];break;case"textarea":a=Gc(e,a),r=Gc(e,r),o=[];break;default:typeof a.onClick!="function"&&typeof r.onClick=="function"&&(e.onclick=Pl)}Xc(s,r);var l;s=null;for(u in a)if(!r.hasOwnProperty(u)&&a.hasOwnProperty(u)&&a[u]!=null)if(u==="style"){var c=a[u];for(l in c)c.hasOwnProperty(l)&&(s||(s={}),s[l]="")}else u!=="dangerouslySetInnerHTML"&&u!=="children"&&u!=="suppressContentEditableWarning"&&u!=="suppressHydrationWarning"&&u!=="autoFocus"&&(Qa.hasOwnProperty(u)?o||(o=[]):(o=o||[]).push(u,null));for(u in r){var i=r[u];if(c=a!=null?a[u]:void 0,r.hasOwnProperty(u)&&i!==c&&(i!=null||c!=null))if(u==="style")if(c){for(l in c)!c.hasOwnProperty(l)||i&&i.hasOwnProperty(l)||(s||(s={}),s[l]="");for(l in i)i.hasOwnProperty(l)&&c[l]!==i[l]&&(s||(s={}),s[l]=i[l])}else s||(o||(o=[]),o.push(u,s)),s=i;else u==="dangerouslySetInnerHTML"?(i=i?i.__html:void 0,c=c?c.__html:void 0,i!=null&&c!==i&&(o=o||[]).push(u,i)):u==="children"?typeof i!="string"&&typeof i!="number"||(o=o||[]).push(u,""+i):u!=="suppressContentEditableWarning"&&u!=="suppressHydrationWarning"&&(Qa.hasOwnProperty(u)?(i!=null&&u==="onScroll"&&St("scroll",e),o||c===i||(o=[])):(o=o||[]).push(u,i))}s&&(o=o||[]).push("style",s);var u=o;(t.updateQueue=u)&&(t.flags|=4)}};Wx=function(e,t,s,r){s!==r&&(t.flags|=4)};function Ca(e,t){if(!Et)switch(e.tailMode){case"hidden":t=e.tail;for(var s=null;t!==null;)t.alternate!==null&&(s=t),t=t.sibling;s===null?e.tail=null:s.sibling=null;break;case"collapsed":s=e.tail;for(var r=null;s!==null;)s.alternate!==null&&(r=s),s=s.sibling;r===null?t||e.tail===null?e.tail=null:e.tail.sibling=null:r.sibling=null}}function on(e){var t=e.alternate!==null&&e.alternate.child===e.child,s=0,r=0;if(t)for(var a=e.child;a!==null;)s|=a.lanes|a.childLanes,r|=a.subtreeFlags&14680064,r|=a.flags&14680064,a.return=e,a=a.sibling;else for(a=e.child;a!==null;)s|=a.lanes|a.childLanes,r|=a.subtreeFlags,r|=a.flags,a.return=e,a=a.sibling;return e.subtreeFlags|=r,e.childLanes=s,t}function s0(e,t,s){var r=t.pendingProps;switch(ou(t),t.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return on(t),null;case 1:return vn(t.type)&&Fl(),on(t),null;case 3:return r=t.stateNode,aa(),jt(Nn),jt(dn),xu(),r.pendingContext&&(r.context=r.pendingContext,r.pendingContext=null),(e===null||e.child===null)&&(sl(t)?t.flags|=4:e===null||e.memoizedState.isDehydrated&&!(t.flags&256)||(t.flags|=1024,Gn!==null&&(Cd(Gn),Gn=null))),wd(e,t),on(t),null;case 5:fu(t);var a=fr(uo.current);if(s=t.type,e!==null&&t.stateNode!=null)Ux(e,t,s,r,a),e.ref!==t.ref&&(t.flags|=512,t.flags|=2097152);else{if(!r){if(t.stateNode===null)throw Error(me(166));return on(t),null}if(e=fr(ms.current),sl(t)){r=t.stateNode,s=t.type;var o=t.memoizedProps;switch(r[ls]=t,r[io]=o,e=(t.mode&1)!==0,s){case"dialog":St("cancel",r),St("close",r);break;case"iframe":case"object":case"embed":St("load",r);break;case"video":case"audio":for(a=0;a<Ba.length;a++)St(Ba[a],r);break;case"source":St("error",r);break;case"img":case"image":case"link":St("error",r),St("load",r);break;case"details":St("toggle",r);break;case"input":rm(r,o),St("invalid",r);break;case"select":r._wrapperState={wasMultiple:!!o.multiple},St("invalid",r);break;case"textarea":om(r,o),St("invalid",r)}Xc(s,o),a=null;for(var l in o)if(o.hasOwnProperty(l)){var c=o[l];l==="children"?typeof c=="string"?r.textContent!==c&&(o.suppressHydrationWarning!==!0&&nl(r.textContent,c,e),a=["children",c]):typeof c=="number"&&r.textContent!==""+c&&(o.suppressHydrationWarning!==!0&&nl(r.textContent,c,e),a=["children",""+c]):Qa.hasOwnProperty(l)&&c!=null&&l==="onScroll"&&St("scroll",r)}switch(s){case"input":Go(r),am(r,o,!0);break;case"textarea":Go(r),lm(r);break;case"select":case"option":break;default:typeof o.onClick=="function"&&(r.onclick=Pl)}r=a,t.updateQueue=r,r!==null&&(t.flags|=4)}else{l=a.nodeType===9?a:a.ownerDocument,e==="http://www.w3.org/1999/xhtml"&&(e=gf(s)),e==="http://www.w3.org/1999/xhtml"?s==="script"?(e=l.createElement("div"),e.innerHTML="<script><\/script>",e=e.removeChild(e.firstChild)):typeof r.is=="string"?e=l.createElement(s,{is:r.is}):(e=l.createElement(s),s==="select"&&(l=e,r.multiple?l.multiple=!0:r.size&&(l.size=r.size))):e=l.createElementNS(e,s),e[ls]=t,e[io]=r,Hx(e,t,!1,!1),t.stateNode=e;e:{switch(l=Jc(s,r),s){case"dialog":St("cancel",e),St("close",e),a=r;break;case"iframe":case"object":case"embed":St("load",e),a=r;break;case"video":case"audio":for(a=0;a<Ba.length;a++)St(Ba[a],e);a=r;break;case"source":St("error",e),a=r;break;case"img":case"image":case"link":St("error",e),St("load",e),a=r;break;case"details":St("toggle",e),a=r;break;case"input":rm(e,r),a=Vc(e,r),St("invalid",e);break;case"option":a=r;break;case"select":e._wrapperState={wasMultiple:!!r.multiple},a=Tt({},r,{value:void 0}),St("invalid",e);break;case"textarea":om(e,r),a=Gc(e,r),St("invalid",e);break;default:a=r}Xc(s,a),c=a;for(o in c)if(c.hasOwnProperty(o)){var i=c[o];o==="style"?Nf(e,i):o==="dangerouslySetInnerHTML"?(i=i?i.__html:void 0,i!=null&&yf(e,i)):o==="children"?typeof i=="string"?(s!=="textarea"||i!=="")&&Za(e,i):typeof i=="number"&&Za(e,""+i):o!=="suppressContentEditableWarning"&&o!=="suppressHydrationWarning"&&o!=="autoFocus"&&(Qa.hasOwnProperty(o)?i!=null&&o==="onScroll"&&St("scroll",e):i!=null&&Vd(e,o,i,l))}switch(s){case"input":Go(e),am(e,r,!1);break;case"textarea":Go(e),lm(e);break;case"option":r.value!=null&&e.setAttribute("value",""+tr(r.value));break;case"select":e.multiple=!!r.multiple,o=r.value,o!=null?Gr(e,!!r.multiple,o,!1):r.defaultValue!=null&&Gr(e,!!r.multiple,r.defaultValue,!0);break;default:typeof a.onClick=="function"&&(e.onclick=Pl)}switch(s){case"button":case"input":case"select":case"textarea":r=!!r.autoFocus;break e;case"img":r=!0;break e;default:r=!1}}r&&(t.flags|=4)}t.ref!==null&&(t.flags|=512,t.flags|=2097152)}return on(t),null;case 6:if(e&&t.stateNode!=null)Wx(e,t,e.memoizedProps,r);else{if(typeof r!="string"&&t.stateNode===null)throw Error(me(166));if(s=fr(uo.current),fr(ms.current),sl(t)){if(r=t.stateNode,s=t.memoizedProps,r[ls]=t,(o=r.nodeValue!==s)&&(e=An,e!==null))switch(e.tag){case 3:nl(r.nodeValue,s,(e.mode&1)!==0);break;case 5:e.memoizedProps.suppressHydrationWarning!==!0&&nl(r.nodeValue,s,(e.mode&1)!==0)}o&&(t.flags|=4)}else r=(s.nodeType===9?s:s.ownerDocument).createTextNode(r),r[ls]=t,t.stateNode=r}return on(t),null;case 13:if(jt(At),r=t.memoizedState,e===null||e.memoizedState!==null&&e.memoizedState.dehydrated!==null){if(Et&&kn!==null&&t.mode&1&&!(t.flags&128))lx(),sa(),t.flags|=98560,o=!1;else if(o=sl(t),r!==null&&r.dehydrated!==null){if(e===null){if(!o)throw Error(me(318));if(o=t.memoizedState,o=o!==null?o.dehydrated:null,!o)throw Error(me(317));o[ls]=t}else sa(),!(t.flags&128)&&(t.memoizedState=null),t.flags|=4;on(t),o=!1}else Gn!==null&&(Cd(Gn),Gn=null),o=!0;if(!o)return t.flags&65536?t:null}return t.flags&128?(t.lanes=s,t):(r=r!==null,r!==(e!==null&&e.memoizedState!==null)&&r&&(t.child.flags|=8192,t.mode&1&&(e===null||At.current&1?Ut===0&&(Ut=3):Au())),t.updateQueue!==null&&(t.flags|=4),on(t),null);case 4:return aa(),wd(e,t),e===null&&oo(t.stateNode.containerInfo),on(t),null;case 10:return du(t.type._context),on(t),null;case 17:return vn(t.type)&&Fl(),on(t),null;case 19:if(jt(At),o=t.memoizedState,o===null)return on(t),null;if(r=(t.flags&128)!==0,l=o.rendering,l===null)if(r)Ca(o,!1);else{if(Ut!==0||e!==null&&e.flags&128)for(e=t.child;e!==null;){if(l=Vl(e),l!==null){for(t.flags|=128,Ca(o,!1),r=l.updateQueue,r!==null&&(t.updateQueue=r,t.flags|=4),t.subtreeFlags=0,r=s,s=t.child;s!==null;)o=s,e=r,o.flags&=14680066,l=o.alternate,l===null?(o.childLanes=0,o.lanes=e,o.child=null,o.subtreeFlags=0,o.memoizedProps=null,o.memoizedState=null,o.updateQueue=null,o.dependencies=null,o.stateNode=null):(o.childLanes=l.childLanes,o.lanes=l.lanes,o.child=l.child,o.subtreeFlags=0,o.deletions=null,o.memoizedProps=l.memoizedProps,o.memoizedState=l.memoizedState,o.updateQueue=l.updateQueue,o.type=l.type,e=l.dependencies,o.dependencies=e===null?null:{lanes:e.lanes,firstContext:e.firstContext}),s=s.sibling;return bt(At,At.current&1|2),t.child}e=e.sibling}o.tail!==null&&_t()>la&&(t.flags|=128,r=!0,Ca(o,!1),t.lanes=4194304)}else{if(!r)if(e=Vl(l),e!==null){if(t.flags|=128,r=!0,s=e.updateQueue,s!==null&&(t.updateQueue=s,t.flags|=4),Ca(o,!0),o.tail===null&&o.tailMode==="hidden"&&!l.alternate&&!Et)return on(t),null}else 2*_t()-o.renderingStartTime>la&&s!==1073741824&&(t.flags|=128,r=!0,Ca(o,!1),t.lanes=4194304);o.isBackwards?(l.sibling=t.child,t.child=l):(s=o.last,s!==null?s.sibling=l:t.child=l,o.last=l)}return o.tail!==null?(t=o.tail,o.rendering=t,o.tail=t.sibling,o.renderingStartTime=_t(),t.sibling=null,s=At.current,bt(At,r?s&1|2:s&1),t):(on(t),null);case 22:case 23:return ku(),r=t.memoizedState!==null,e!==null&&e.memoizedState!==null!==r&&(t.flags|=8192),r&&t.mode&1?jn&1073741824&&(on(t),t.subtreeFlags&6&&(t.flags|=8192)):on(t),null;case 24:return null;case 25:return null}throw Error(me(156,t.tag))}function r0(e,t){switch(ou(t),t.tag){case 1:return vn(t.type)&&Fl(),e=t.flags,e&65536?(t.flags=e&-65537|128,t):null;case 3:return aa(),jt(Nn),jt(dn),xu(),e=t.flags,e&65536&&!(e&128)?(t.flags=e&-65537|128,t):null;case 5:return fu(t),null;case 13:if(jt(At),e=t.memoizedState,e!==null&&e.dehydrated!==null){if(t.alternate===null)throw Error(me(340));sa()}return e=t.flags,e&65536?(t.flags=e&-65537|128,t):null;case 19:return jt(At),null;case 4:return aa(),null;case 10:return du(t.type._context),null;case 22:case 23:return ku(),null;case 24:return null;default:return null}}var ol=!1,ln=!1,a0=typeof WeakSet=="function"?WeakSet:Set,ke=null;function Kr(e,t){var s=e.ref;if(s!==null)if(typeof s=="function")try{s(null)}catch(r){Dt(e,t,r)}else s.current=null}function jd(e,t,s){try{s()}catch(r){Dt(e,t,r)}}var Xm=!1;function o0(e,t){if(ld=_l,e=Gf(),ru(e)){if("selectionStart"in e)var s={start:e.selectionStart,end:e.selectionEnd};else e:{s=(s=e.ownerDocument)&&s.defaultView||window;var r=s.getSelection&&s.getSelection();if(r&&r.rangeCount!==0){s=r.anchorNode;var a=r.anchorOffset,o=r.focusNode;r=r.focusOffset;try{s.nodeType,o.nodeType}catch{s=null;break e}var l=0,c=-1,i=-1,u=0,p=0,y=e,N=null;t:for(;;){for(var w;y!==s||a!==0&&y.nodeType!==3||(c=l+a),y!==o||r!==0&&y.nodeType!==3||(i=l+r),y.nodeType===3&&(l+=y.nodeValue.length),(w=y.firstChild)!==null;)N=y,y=w;for(;;){if(y===e)break t;if(N===s&&++u===a&&(c=l),N===o&&++p===r&&(i=l),(w=y.nextSibling)!==null)break;y=N,N=y.parentNode}y=w}s=c===-1||i===-1?null:{start:c,end:i}}else s=null}s=s||{start:0,end:0}}else s=null;for(id={focusedElem:e,selectionRange:s},_l=!1,ke=t;ke!==null;)if(t=ke,e=t.child,(t.subtreeFlags&1028)!==0&&e!==null)e.return=t,ke=e;else for(;ke!==null;){t=ke;try{var R=t.alternate;if(t.flags&1024)switch(t.tag){case 0:case 11:case 15:break;case 1:if(R!==null){var E=R.memoizedProps,W=R.memoizedState,b=t.stateNode,h=b.getSnapshotBeforeUpdate(t.elementType===t.type?E:Kn(t.type,E),W);b.__reactInternalSnapshotBeforeUpdate=h}break;case 3:var S=t.stateNode.containerInfo;S.nodeType===1?S.textContent="":S.nodeType===9&&S.documentElement&&S.removeChild(S.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(me(163))}}catch(P){Dt(t,t.return,P)}if(e=t.sibling,e!==null){e.return=t.return,ke=e;break}ke=t.return}return R=Xm,Xm=!1,R}function Ka(e,t,s){var r=t.updateQueue;if(r=r!==null?r.lastEffect:null,r!==null){var a=r=r.next;do{if((a.tag&e)===e){var o=a.destroy;a.destroy=void 0,o!==void 0&&jd(t,s,o)}a=a.next}while(a!==r)}}function Ni(e,t){if(t=t.updateQueue,t=t!==null?t.lastEffect:null,t!==null){var s=t=t.next;do{if((s.tag&e)===e){var r=s.create;s.destroy=r()}s=s.next}while(s!==t)}}function Ed(e){var t=e.ref;if(t!==null){var s=e.stateNode;switch(e.tag){case 5:e=s;break;default:e=s}typeof t=="function"?t(e):t.current=e}}function zx(e){var t=e.alternate;t!==null&&(e.alternate=null,zx(t)),e.child=null,e.deletions=null,e.sibling=null,e.tag===5&&(t=e.stateNode,t!==null&&(delete t[ls],delete t[io],delete t[ud],delete t[Uy],delete t[Wy])),e.stateNode=null,e.return=null,e.dependencies=null,e.memoizedProps=null,e.memoizedState=null,e.pendingProps=null,e.stateNode=null,e.updateQueue=null}function Vx(e){return e.tag===5||e.tag===3||e.tag===4}function Jm(e){e:for(;;){for(;e.sibling===null;){if(e.return===null||Vx(e.return))return null;e=e.return}for(e.sibling.return=e.return,e=e.sibling;e.tag!==5&&e.tag!==6&&e.tag!==18;){if(e.flags&2||e.child===null||e.tag===4)continue e;e.child.return=e,e=e.child}if(!(e.flags&2))return e.stateNode}}function kd(e,t,s){var r=e.tag;if(r===5||r===6)e=e.stateNode,t?s.nodeType===8?s.parentNode.insertBefore(e,t):s.insertBefore(e,t):(s.nodeType===8?(t=s.parentNode,t.insertBefore(e,s)):(t=s,t.appendChild(e)),s=s._reactRootContainer,s!=null||t.onclick!==null||(t.onclick=Pl));else if(r!==4&&(e=e.child,e!==null))for(kd(e,t,s),e=e.sibling;e!==null;)kd(e,t,s),e=e.sibling}function Ad(e,t,s){var r=e.tag;if(r===5||r===6)e=e.stateNode,t?s.insertBefore(e,t):s.appendChild(e);else if(r!==4&&(e=e.child,e!==null))for(Ad(e,t,s),e=e.sibling;e!==null;)Ad(e,t,s),e=e.sibling}var qt=null,Yn=!1;function Ms(e,t,s){for(s=s.child;s!==null;)Kx(e,t,s),s=s.sibling}function Kx(e,t,s){if(us&&typeof us.onCommitFiberUnmount=="function")try{us.onCommitFiberUnmount(mi,s)}catch{}switch(s.tag){case 5:ln||Kr(s,t);case 6:var r=qt,a=Yn;qt=null,Ms(e,t,s),qt=r,Yn=a,qt!==null&&(Yn?(e=qt,s=s.stateNode,e.nodeType===8?e.parentNode.removeChild(s):e.removeChild(s)):qt.removeChild(s.stateNode));break;case 18:qt!==null&&(Yn?(e=qt,s=s.stateNode,e.nodeType===8?pc(e.parentNode,s):e.nodeType===1&&pc(e,s),so(e)):pc(qt,s.stateNode));break;case 4:r=qt,a=Yn,qt=s.stateNode.containerInfo,Yn=!0,Ms(e,t,s),qt=r,Yn=a;break;case 0:case 11:case 14:case 15:if(!ln&&(r=s.updateQueue,r!==null&&(r=r.lastEffect,r!==null))){a=r=r.next;do{var o=a,l=o.destroy;o=o.tag,l!==void 0&&(o&2||o&4)&&jd(s,t,l),a=a.next}while(a!==r)}Ms(e,t,s);break;case 1:if(!ln&&(Kr(s,t),r=s.stateNode,typeof r.componentWillUnmount=="function"))try{r.props=s.memoizedProps,r.state=s.memoizedState,r.componentWillUnmount()}catch(c){Dt(s,t,c)}Ms(e,t,s);break;case 21:Ms(e,t,s);break;case 22:s.mode&1?(ln=(r=ln)||s.memoizedState!==null,Ms(e,t,s),ln=r):Ms(e,t,s);break;default:Ms(e,t,s)}}function Qm(e){var t=e.updateQueue;if(t!==null){e.updateQueue=null;var s=e.stateNode;s===null&&(s=e.stateNode=new a0),t.forEach(function(r){var a=x0.bind(null,e,r);s.has(r)||(s.add(r),r.then(a,a))})}}function Vn(e,t){var s=t.deletions;if(s!==null)for(var r=0;r<s.length;r++){var a=s[r];try{var o=e,l=t,c=l;e:for(;c!==null;){switch(c.tag){case 5:qt=c.stateNode,Yn=!1;break e;case 3:qt=c.stateNode.containerInfo,Yn=!0;break e;case 4:qt=c.stateNode.containerInfo,Yn=!0;break e}c=c.return}if(qt===null)throw Error(me(160));Kx(o,l,a),qt=null,Yn=!1;var i=a.alternate;i!==null&&(i.return=null),a.return=null}catch(u){Dt(a,t,u)}}if(t.subtreeFlags&12854)for(t=t.child;t!==null;)Yx(t,e),t=t.sibling}function Yx(e,t){var s=e.alternate,r=e.flags;switch(e.tag){case 0:case 11:case 14:case 15:if(Vn(t,e),ss(e),r&4){try{Ka(3,e,e.return),Ni(3,e)}catch(E){Dt(e,e.return,E)}try{Ka(5,e,e.return)}catch(E){Dt(e,e.return,E)}}break;case 1:Vn(t,e),ss(e),r&512&&s!==null&&Kr(s,s.return);break;case 5:if(Vn(t,e),ss(e),r&512&&s!==null&&Kr(s,s.return),e.flags&32){var a=e.stateNode;try{Za(a,"")}catch(E){Dt(e,e.return,E)}}if(r&4&&(a=e.stateNode,a!=null)){var o=e.memoizedProps,l=s!==null?s.memoizedProps:o,c=e.type,i=e.updateQueue;if(e.updateQueue=null,i!==null)try{c==="input"&&o.type==="radio"&&o.name!=null&&xf(a,o),Jc(c,l);var u=Jc(c,o);for(l=0;l<i.length;l+=2){var p=i[l],y=i[l+1];p==="style"?Nf(a,y):p==="dangerouslySetInnerHTML"?yf(a,y):p==="children"?Za(a,y):Vd(a,p,y,u)}switch(c){case"input":Kc(a,o);break;case"textarea":hf(a,o);break;case"select":var N=a._wrapperState.wasMultiple;a._wrapperState.wasMultiple=!!o.multiple;var w=o.value;w!=null?Gr(a,!!o.multiple,w,!1):N!==!!o.multiple&&(o.defaultValue!=null?Gr(a,!!o.multiple,o.defaultValue,!0):Gr(a,!!o.multiple,o.multiple?[]:"",!1))}a[io]=o}catch(E){Dt(e,e.return,E)}}break;case 6:if(Vn(t,e),ss(e),r&4){if(e.stateNode===null)throw Error(me(162));a=e.stateNode,o=e.memoizedProps;try{a.nodeValue=o}catch(E){Dt(e,e.return,E)}}break;case 3:if(Vn(t,e),ss(e),r&4&&s!==null&&s.memoizedState.isDehydrated)try{so(t.containerInfo)}catch(E){Dt(e,e.return,E)}break;case 4:Vn(t,e),ss(e);break;case 13:Vn(t,e),ss(e),a=e.child,a.flags&8192&&(o=a.memoizedState!==null,a.stateNode.isHidden=o,!o||a.alternate!==null&&a.alternate.memoizedState!==null||(ju=_t())),r&4&&Qm(e);break;case 22:if(p=s!==null&&s.memoizedState!==null,e.mode&1?(ln=(u=ln)||p,Vn(t,e),ln=u):Vn(t,e),ss(e),r&8192){if(u=e.memoizedState!==null,(e.stateNode.isHidden=u)&&!p&&e.mode&1)for(ke=e,p=e.child;p!==null;){for(y=ke=p;ke!==null;){switch(N=ke,w=N.child,N.tag){case 0:case 11:case 14:case 15:Ka(4,N,N.return);break;case 1:Kr(N,N.return);var R=N.stateNode;if(typeof R.componentWillUnmount=="function"){r=N,s=N.return;try{t=r,R.props=t.memoizedProps,R.state=t.memoizedState,R.componentWillUnmount()}catch(E){Dt(r,s,E)}}break;case 5:Kr(N,N.return);break;case 22:if(N.memoizedState!==null){ep(y);continue}}w!==null?(w.return=N,ke=w):ep(y)}p=p.sibling}e:for(p=null,y=e;;){if(y.tag===5){if(p===null){p=y;try{a=y.stateNode,u?(o=a.style,typeof o.setProperty=="function"?o.setProperty("display","none","important"):o.display="none"):(c=y.stateNode,i=y.memoizedProps.style,l=i!=null&&i.hasOwnProperty("display")?i.display:null,c.style.display=bf("display",l))}catch(E){Dt(e,e.return,E)}}}else if(y.tag===6){if(p===null)try{y.stateNode.nodeValue=u?"":y.memoizedProps}catch(E){Dt(e,e.return,E)}}else if((y.tag!==22&&y.tag!==23||y.memoizedState===null||y===e)&&y.child!==null){y.child.return=y,y=y.child;continue}if(y===e)break e;for(;y.sibling===null;){if(y.return===null||y.return===e)break e;p===y&&(p=null),y=y.return}p===y&&(p=null),y.sibling.return=y.return,y=y.sibling}}break;case 19:Vn(t,e),ss(e),r&4&&Qm(e);break;case 21:break;default:Vn(t,e),ss(e)}}function ss(e){var t=e.flags;if(t&2){try{e:{for(var s=e.return;s!==null;){if(Vx(s)){var r=s;break e}s=s.return}throw Error(me(160))}switch(r.tag){case 5:var a=r.stateNode;r.flags&32&&(Za(a,""),r.flags&=-33);var o=Jm(e);Ad(e,o,a);break;case 3:case 4:var l=r.stateNode.containerInfo,c=Jm(e);kd(e,c,l);break;default:throw Error(me(161))}}catch(i){Dt(e,e.return,i)}e.flags&=-3}t&4096&&(e.flags&=-4097)}function l0(e,t,s){ke=e,Gx(e)}function Gx(e,t,s){for(var r=(e.mode&1)!==0;ke!==null;){var a=ke,o=a.child;if(a.tag===22&&r){var l=a.memoizedState!==null||ol;if(!l){var c=a.alternate,i=c!==null&&c.memoizedState!==null||ln;c=ol;var u=ln;if(ol=l,(ln=i)&&!u)for(ke=a;ke!==null;)l=ke,i=l.child,l.tag===22&&l.memoizedState!==null?tp(a):i!==null?(i.return=l,ke=i):tp(a);for(;o!==null;)ke=o,Gx(o),o=o.sibling;ke=a,ol=c,ln=u}Zm(e)}else a.subtreeFlags&8772&&o!==null?(o.return=a,ke=o):Zm(e)}}function Zm(e){for(;ke!==null;){var t=ke;if(t.flags&8772){var s=t.alternate;try{if(t.flags&8772)switch(t.tag){case 0:case 11:case 15:ln||Ni(5,t);break;case 1:var r=t.stateNode;if(t.flags&4&&!ln)if(s===null)r.componentDidMount();else{var a=t.elementType===t.type?s.memoizedProps:Kn(t.type,s.memoizedProps);r.componentDidUpdate(a,s.memoizedState,r.__reactInternalSnapshotBeforeUpdate)}var o=t.updateQueue;o!==null&&Pm(t,o,r);break;case 3:var l=t.updateQueue;if(l!==null){if(s=null,t.child!==null)switch(t.child.tag){case 5:s=t.child.stateNode;break;case 1:s=t.child.stateNode}Pm(t,l,s)}break;case 5:var c=t.stateNode;if(s===null&&t.flags&4){s=c;var i=t.memoizedProps;switch(t.type){case"button":case"input":case"select":case"textarea":i.autoFocus&&s.focus();break;case"img":i.src&&(s.src=i.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(t.memoizedState===null){var u=t.alternate;if(u!==null){var p=u.memoizedState;if(p!==null){var y=p.dehydrated;y!==null&&so(y)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(me(163))}ln||t.flags&512&&Ed(t)}catch(N){Dt(t,t.return,N)}}if(t===e){ke=null;break}if(s=t.sibling,s!==null){s.return=t.return,ke=s;break}ke=t.return}}function ep(e){for(;ke!==null;){var t=ke;if(t===e){ke=null;break}var s=t.sibling;if(s!==null){s.return=t.return,ke=s;break}ke=t.return}}function tp(e){for(;ke!==null;){var t=ke;try{switch(t.tag){case 0:case 11:case 15:var s=t.return;try{Ni(4,t)}catch(i){Dt(t,s,i)}break;case 1:var r=t.stateNode;if(typeof r.componentDidMount=="function"){var a=t.return;try{r.componentDidMount()}catch(i){Dt(t,a,i)}}var o=t.return;try{Ed(t)}catch(i){Dt(t,o,i)}break;case 5:var l=t.return;try{Ed(t)}catch(i){Dt(t,l,i)}}}catch(i){Dt(t,t.return,i)}if(t===e){ke=null;break}var c=t.sibling;if(c!==null){c.return=t.return,ke=c;break}ke=t.return}}var i0=Math.ceil,Gl=Rs.ReactCurrentDispatcher,Su=Rs.ReactCurrentOwner,Pn=Rs.ReactCurrentBatchConfig,it=0,Kt=null,Mt=null,Jt=0,jn=0,Yr=rr(0),Ut=0,xo=null,vr=0,vi=0,wu=0,Ya=null,yn=null,ju=0,la=1/0,gs=null,ql=!1,Id=null,Qs=null,ll=!1,Vs=null,Xl=0,Ga=0,Td=null,El=-1,kl=0;function fn(){return it&6?_t():El!==-1?El:El=_t()}function Zs(e){return e.mode&1?it&2&&Jt!==0?Jt&-Jt:Vy.transition!==null?(kl===0&&(kl=Df()),kl):(e=ut,e!==0||(e=window.event,e=e===void 0?16:Bf(e.type)),e):1}function Xn(e,t,s,r){if(50<Ga)throw Ga=0,Td=null,Error(me(185));Ao(e,s,r),(!(it&2)||e!==Kt)&&(e===Kt&&(!(it&2)&&(vi|=s),Ut===4&&Us(e,Jt)),Sn(e,r),s===1&&it===0&&!(t.mode&1)&&(la=_t()+500,gi&&ar()))}function Sn(e,t){var s=e.callbackNode;Vg(e,t);var r=Ll(e,e===Kt?Jt:0);if(r===0)s!==null&&dm(s),e.callbackNode=null,e.callbackPriority=0;else if(t=r&-r,e.callbackPriority!==t){if(s!=null&&dm(s),t===1)e.tag===0?zy(np.bind(null,e)):rx(np.bind(null,e)),$y(function(){!(it&6)&&ar()}),s=null;else{switch(Lf(r)){case 1:s=Xd;break;case 4:s=Rf;break;case 16:s=Dl;break;case 536870912:s=Cf;break;default:s=Dl}s=nh(s,qx.bind(null,e))}e.callbackPriority=t,e.callbackNode=s}}function qx(e,t){if(El=-1,kl=0,it&6)throw Error(me(327));var s=e.callbackNode;if(Zr()&&e.callbackNode!==s)return null;var r=Ll(e,e===Kt?Jt:0);if(r===0)return null;if(r&30||r&e.expiredLanes||t)t=Jl(e,r);else{t=r;var a=it;it|=2;var o=Jx();(Kt!==e||Jt!==t)&&(gs=null,la=_t()+500,xr(e,t));do try{u0();break}catch(c){Xx(e,c)}while(!0);cu(),Gl.current=o,it=a,Mt!==null?t=0:(Kt=null,Jt=0,t=Ut)}if(t!==0){if(t===2&&(a=nd(e),a!==0&&(r=a,t=Rd(e,a))),t===1)throw s=xo,xr(e,0),Us(e,r),Sn(e,_t()),s;if(t===6)Us(e,r);else{if(a=e.current.alternate,!(r&30)&&!c0(a)&&(t=Jl(e,r),t===2&&(o=nd(e),o!==0&&(r=o,t=Rd(e,o))),t===1))throw s=xo,xr(e,0),Us(e,r),Sn(e,_t()),s;switch(e.finishedWork=a,e.finishedLanes=r,t){case 0:case 1:throw Error(me(345));case 2:cr(e,yn,gs);break;case 3:if(Us(e,r),(r&130023424)===r&&(t=ju+500-_t(),10<t)){if(Ll(e,0)!==0)break;if(a=e.suspendedLanes,(a&r)!==r){fn(),e.pingedLanes|=e.suspendedLanes&a;break}e.timeoutHandle=dd(cr.bind(null,e,yn,gs),t);break}cr(e,yn,gs);break;case 4:if(Us(e,r),(r&4194240)===r)break;for(t=e.eventTimes,a=-1;0<r;){var l=31-qn(r);o=1<<l,l=t[l],l>a&&(a=l),r&=~o}if(r=a,r=_t()-r,r=(120>r?120:480>r?480:1080>r?1080:1920>r?1920:3e3>r?3e3:4320>r?4320:1960*i0(r/1960))-r,10<r){e.timeoutHandle=dd(cr.bind(null,e,yn,gs),r);break}cr(e,yn,gs);break;case 5:cr(e,yn,gs);break;default:throw Error(me(329))}}}return Sn(e,_t()),e.callbackNode===s?qx.bind(null,e):null}function Rd(e,t){var s=Ya;return e.current.memoizedState.isDehydrated&&(xr(e,t).flags|=256),e=Jl(e,t),e!==2&&(t=yn,yn=s,t!==null&&Cd(t)),e}function Cd(e){yn===null?yn=e:yn.push.apply(yn,e)}function c0(e){for(var t=e;;){if(t.flags&16384){var s=t.updateQueue;if(s!==null&&(s=s.stores,s!==null))for(var r=0;r<s.length;r++){var a=s[r],o=a.getSnapshot;a=a.value;try{if(!Qn(o(),a))return!1}catch{return!1}}}if(s=t.child,t.subtreeFlags&16384&&s!==null)s.return=t,t=s;else{if(t===e)break;for(;t.sibling===null;){if(t.return===null||t.return===e)return!0;t=t.return}t.sibling.return=t.return,t=t.sibling}}return!0}function Us(e,t){for(t&=~wu,t&=~vi,e.suspendedLanes|=t,e.pingedLanes&=~t,e=e.expirationTimes;0<t;){var s=31-qn(t),r=1<<s;e[s]=-1,t&=~r}}function np(e){if(it&6)throw Error(me(327));Zr();var t=Ll(e,0);if(!(t&1))return Sn(e,_t()),null;var s=Jl(e,t);if(e.tag!==0&&s===2){var r=nd(e);r!==0&&(t=r,s=Rd(e,r))}if(s===1)throw s=xo,xr(e,0),Us(e,t),Sn(e,_t()),s;if(s===6)throw Error(me(345));return e.finishedWork=e.current.alternate,e.finishedLanes=t,cr(e,yn,gs),Sn(e,_t()),null}function Eu(e,t){var s=it;it|=1;try{return e(t)}finally{it=s,it===0&&(la=_t()+500,gi&&ar())}}function Sr(e){Vs!==null&&Vs.tag===0&&!(it&6)&&Zr();var t=it;it|=1;var s=Pn.transition,r=ut;try{if(Pn.transition=null,ut=1,e)return e()}finally{ut=r,Pn.transition=s,it=t,!(it&6)&&ar()}}function ku(){jn=Yr.current,jt(Yr)}function xr(e,t){e.finishedWork=null,e.finishedLanes=0;var s=e.timeoutHandle;if(s!==-1&&(e.timeoutHandle=-1,By(s)),Mt!==null)for(s=Mt.return;s!==null;){var r=s;switch(ou(r),r.tag){case 1:r=r.type.childContextTypes,r!=null&&Fl();break;case 3:aa(),jt(Nn),jt(dn),xu();break;case 5:fu(r);break;case 4:aa();break;case 13:jt(At);break;case 19:jt(At);break;case 10:du(r.type._context);break;case 22:case 23:ku()}s=s.return}if(Kt=e,Mt=e=er(e.current,null),Jt=jn=t,Ut=0,xo=null,wu=vi=vr=0,yn=Ya=null,pr!==null){for(t=0;t<pr.length;t++)if(s=pr[t],r=s.interleaved,r!==null){s.interleaved=null;var a=r.next,o=s.pending;if(o!==null){var l=o.next;o.next=a,r.next=l}s.pending=r}pr=null}return e}function Xx(e,t){do{var s=Mt;try{if(cu(),Sl.current=Yl,Kl){for(var r=It.memoizedState;r!==null;){var a=r.queue;a!==null&&(a.pending=null),r=r.next}Kl=!1}if(Nr=0,Vt=$t=It=null,Va=!1,mo=0,Su.current=null,s===null||s.return===null){Ut=1,xo=t,Mt=null;break}e:{var o=e,l=s.return,c=s,i=t;if(t=Jt,c.flags|=32768,i!==null&&typeof i=="object"&&typeof i.then=="function"){var u=i,p=c,y=p.tag;if(!(p.mode&1)&&(y===0||y===11||y===15)){var N=p.alternate;N?(p.updateQueue=N.updateQueue,p.memoizedState=N.memoizedState,p.lanes=N.lanes):(p.updateQueue=null,p.memoizedState=null)}var w=Wm(l);if(w!==null){w.flags&=-257,zm(w,l,c,o,t),w.mode&1&&Um(o,u,t),t=w,i=u;var R=t.updateQueue;if(R===null){var E=new Set;E.add(i),t.updateQueue=E}else R.add(i);break e}else{if(!(t&1)){Um(o,u,t),Au();break e}i=Error(me(426))}}else if(Et&&c.mode&1){var W=Wm(l);if(W!==null){!(W.flags&65536)&&(W.flags|=256),zm(W,l,c,o,t),lu(oa(i,c));break e}}o=i=oa(i,c),Ut!==4&&(Ut=2),Ya===null?Ya=[o]:Ya.push(o),o=l;do{switch(o.tag){case 3:o.flags|=65536,t&=-t,o.lanes|=t;var b=Lx(o,i,t);Mm(o,b);break e;case 1:c=i;var h=o.type,S=o.stateNode;if(!(o.flags&128)&&(typeof h.getDerivedStateFromError=="function"||S!==null&&typeof S.componentDidCatch=="function"&&(Qs===null||!Qs.has(S)))){o.flags|=65536,t&=-t,o.lanes|=t;var P=_x(o,c,t);Mm(o,P);break e}}o=o.return}while(o!==null)}Zx(s)}catch(U){t=U,Mt===s&&s!==null&&(Mt=s=s.return);continue}break}while(!0)}function Jx(){var e=Gl.current;return Gl.current=Yl,e===null?Yl:e}function Au(){(Ut===0||Ut===3||Ut===2)&&(Ut=4),Kt===null||!(vr&268435455)&&!(vi&268435455)||Us(Kt,Jt)}function Jl(e,t){var s=it;it|=2;var r=Jx();(Kt!==e||Jt!==t)&&(gs=null,xr(e,t));do try{d0();break}catch(a){Xx(e,a)}while(!0);if(cu(),it=s,Gl.current=r,Mt!==null)throw Error(me(261));return Kt=null,Jt=0,Ut}function d0(){for(;Mt!==null;)Qx(Mt)}function u0(){for(;Mt!==null&&!Mg();)Qx(Mt)}function Qx(e){var t=th(e.alternate,e,jn);e.memoizedProps=e.pendingProps,t===null?Zx(e):Mt=t,Su.current=null}function Zx(e){var t=e;do{var s=t.alternate;if(e=t.return,t.flags&32768){if(s=r0(s,t),s!==null){s.flags&=32767,Mt=s;return}if(e!==null)e.flags|=32768,e.subtreeFlags=0,e.deletions=null;else{Ut=6,Mt=null;return}}else if(s=s0(s,t,jn),s!==null){Mt=s;return}if(t=t.sibling,t!==null){Mt=t;return}Mt=t=e}while(t!==null);Ut===0&&(Ut=5)}function cr(e,t,s){var r=ut,a=Pn.transition;try{Pn.transition=null,ut=1,m0(e,t,s,r)}finally{Pn.transition=a,ut=r}return null}function m0(e,t,s,r){do Zr();while(Vs!==null);if(it&6)throw Error(me(327));s=e.finishedWork;var a=e.finishedLanes;if(s===null)return null;if(e.finishedWork=null,e.finishedLanes=0,s===e.current)throw Error(me(177));e.callbackNode=null,e.callbackPriority=0;var o=s.lanes|s.childLanes;if(Kg(e,o),e===Kt&&(Mt=Kt=null,Jt=0),!(s.subtreeFlags&2064)&&!(s.flags&2064)||ll||(ll=!0,nh(Dl,function(){return Zr(),null})),o=(s.flags&15990)!==0,s.subtreeFlags&15990||o){o=Pn.transition,Pn.transition=null;var l=ut;ut=1;var c=it;it|=4,Su.current=null,o0(e,s),Yx(s,e),Dy(id),_l=!!ld,id=ld=null,e.current=s,l0(s),Pg(),it=c,ut=l,Pn.transition=o}else e.current=s;if(ll&&(ll=!1,Vs=e,Xl=a),o=e.pendingLanes,o===0&&(Qs=null),$g(s.stateNode),Sn(e,_t()),t!==null)for(r=e.onRecoverableError,s=0;s<t.length;s++)a=t[s],r(a.value,{componentStack:a.stack,digest:a.digest});if(ql)throw ql=!1,e=Id,Id=null,e;return Xl&1&&e.tag!==0&&Zr(),o=e.pendingLanes,o&1?e===Td?Ga++:(Ga=0,Td=e):Ga=0,ar(),null}function Zr(){if(Vs!==null){var e=Lf(Xl),t=Pn.transition,s=ut;try{if(Pn.transition=null,ut=16>e?16:e,Vs===null)var r=!1;else{if(e=Vs,Vs=null,Xl=0,it&6)throw Error(me(331));var a=it;for(it|=4,ke=e.current;ke!==null;){var o=ke,l=o.child;if(ke.flags&16){var c=o.deletions;if(c!==null){for(var i=0;i<c.length;i++){var u=c[i];for(ke=u;ke!==null;){var p=ke;switch(p.tag){case 0:case 11:case 15:Ka(8,p,o)}var y=p.child;if(y!==null)y.return=p,ke=y;else for(;ke!==null;){p=ke;var N=p.sibling,w=p.return;if(zx(p),p===u){ke=null;break}if(N!==null){N.return=w,ke=N;break}ke=w}}}var R=o.alternate;if(R!==null){var E=R.child;if(E!==null){R.child=null;do{var W=E.sibling;E.sibling=null,E=W}while(E!==null)}}ke=o}}if(o.subtreeFlags&2064&&l!==null)l.return=o,ke=l;else e:for(;ke!==null;){if(o=ke,o.flags&2048)switch(o.tag){case 0:case 11:case 15:Ka(9,o,o.return)}var b=o.sibling;if(b!==null){b.return=o.return,ke=b;break e}ke=o.return}}var h=e.current;for(ke=h;ke!==null;){l=ke;var S=l.child;if(l.subtreeFlags&2064&&S!==null)S.return=l,ke=S;else e:for(l=h;ke!==null;){if(c=ke,c.flags&2048)try{switch(c.tag){case 0:case 11:case 15:Ni(9,c)}}catch(U){Dt(c,c.return,U)}if(c===l){ke=null;break e}var P=c.sibling;if(P!==null){P.return=c.return,ke=P;break e}ke=c.return}}if(it=a,ar(),us&&typeof us.onPostCommitFiberRoot=="function")try{us.onPostCommitFiberRoot(mi,e)}catch{}r=!0}return r}finally{ut=s,Pn.transition=t}}return!1}function sp(e,t,s){t=oa(s,t),t=Lx(e,t,1),e=Js(e,t,1),t=fn(),e!==null&&(Ao(e,1,t),Sn(e,t))}function Dt(e,t,s){if(e.tag===3)sp(e,e,s);else for(;t!==null;){if(t.tag===3){sp(t,e,s);break}else if(t.tag===1){var r=t.stateNode;if(typeof t.type.getDerivedStateFromError=="function"||typeof r.componentDidCatch=="function"&&(Qs===null||!Qs.has(r))){e=oa(s,e),e=_x(t,e,1),t=Js(t,e,1),e=fn(),t!==null&&(Ao(t,1,e),Sn(t,e));break}}t=t.return}}function p0(e,t,s){var r=e.pingCache;r!==null&&r.delete(t),t=fn(),e.pingedLanes|=e.suspendedLanes&s,Kt===e&&(Jt&s)===s&&(Ut===4||Ut===3&&(Jt&130023424)===Jt&&500>_t()-ju?xr(e,0):wu|=s),Sn(e,t)}function eh(e,t){t===0&&(e.mode&1?(t=Jo,Jo<<=1,!(Jo&130023424)&&(Jo=4194304)):t=1);var s=fn();e=Is(e,t),e!==null&&(Ao(e,t,s),Sn(e,s))}function f0(e){var t=e.memoizedState,s=0;t!==null&&(s=t.retryLane),eh(e,s)}function x0(e,t){var s=0;switch(e.tag){case 13:var r=e.stateNode,a=e.memoizedState;a!==null&&(s=a.retryLane);break;case 19:r=e.stateNode;break;default:throw Error(me(314))}r!==null&&r.delete(t),eh(e,s)}var th;th=function(e,t,s){if(e!==null)if(e.memoizedProps!==t.pendingProps||Nn.current)bn=!0;else{if(!(e.lanes&s)&&!(t.flags&128))return bn=!1,n0(e,t,s);bn=!!(e.flags&131072)}else bn=!1,Et&&t.flags&1048576&&ax(t,Hl,t.index);switch(t.lanes=0,t.tag){case 2:var r=t.type;jl(e,t),e=t.pendingProps;var a=na(t,dn.current);Qr(t,s),a=gu(null,t,r,e,a,s);var o=yu();return t.flags|=1,typeof a=="object"&&a!==null&&typeof a.render=="function"&&a.$$typeof===void 0?(t.tag=1,t.memoizedState=null,t.updateQueue=null,vn(r)?(o=!0,Bl(t)):o=!1,t.memoizedState=a.state!==null&&a.state!==void 0?a.state:null,mu(t),a.updater=bi,t.stateNode=a,a._reactInternals=t,gd(t,r,e,s),t=Nd(null,t,r,!0,o,s)):(t.tag=0,Et&&o&&au(t),pn(null,t,a,s),t=t.child),t;case 16:r=t.elementType;e:{switch(jl(e,t),e=t.pendingProps,a=r._init,r=a(r._payload),t.type=r,a=t.tag=g0(r),e=Kn(r,e),a){case 0:t=bd(null,t,r,e,s);break e;case 1:t=Ym(null,t,r,e,s);break e;case 11:t=Vm(null,t,r,e,s);break e;case 14:t=Km(null,t,r,Kn(r.type,e),s);break e}throw Error(me(306,r,""))}return t;case 0:return r=t.type,a=t.pendingProps,a=t.elementType===r?a:Kn(r,a),bd(e,t,r,a,s);case 1:return r=t.type,a=t.pendingProps,a=t.elementType===r?a:Kn(r,a),Ym(e,t,r,a,s);case 3:e:{if(Fx(t),e===null)throw Error(me(387));r=t.pendingProps,o=t.memoizedState,a=o.element,ux(e,t),zl(t,r,null,s);var l=t.memoizedState;if(r=l.element,o.isDehydrated)if(o={element:r,isDehydrated:!1,cache:l.cache,pendingSuspenseBoundaries:l.pendingSuspenseBoundaries,transitions:l.transitions},t.updateQueue.baseState=o,t.memoizedState=o,t.flags&256){a=oa(Error(me(423)),t),t=Gm(e,t,r,s,a);break e}else if(r!==a){a=oa(Error(me(424)),t),t=Gm(e,t,r,s,a);break e}else for(kn=Xs(t.stateNode.containerInfo.firstChild),An=t,Et=!0,Gn=null,s=cx(t,null,r,s),t.child=s;s;)s.flags=s.flags&-3|4096,s=s.sibling;else{if(sa(),r===a){t=Ts(e,t,s);break e}pn(e,t,r,s)}t=t.child}return t;case 5:return mx(t),e===null&&fd(t),r=t.type,a=t.pendingProps,o=e!==null?e.memoizedProps:null,l=a.children,cd(r,a)?l=null:o!==null&&cd(r,o)&&(t.flags|=32),Px(e,t),pn(e,t,l,s),t.child;case 6:return e===null&&fd(t),null;case 13:return Bx(e,t,s);case 4:return pu(t,t.stateNode.containerInfo),r=t.pendingProps,e===null?t.child=ra(t,null,r,s):pn(e,t,r,s),t.child;case 11:return r=t.type,a=t.pendingProps,a=t.elementType===r?a:Kn(r,a),Vm(e,t,r,a,s);case 7:return pn(e,t,t.pendingProps,s),t.child;case 8:return pn(e,t,t.pendingProps.children,s),t.child;case 12:return pn(e,t,t.pendingProps.children,s),t.child;case 10:e:{if(r=t.type._context,a=t.pendingProps,o=t.memoizedProps,l=a.value,bt(Ul,r._currentValue),r._currentValue=l,o!==null)if(Qn(o.value,l)){if(o.children===a.children&&!Nn.current){t=Ts(e,t,s);break e}}else for(o=t.child,o!==null&&(o.return=t);o!==null;){var c=o.dependencies;if(c!==null){l=o.child;for(var i=c.firstContext;i!==null;){if(i.context===r){if(o.tag===1){i=ws(-1,s&-s),i.tag=2;var u=o.updateQueue;if(u!==null){u=u.shared;var p=u.pending;p===null?i.next=i:(i.next=p.next,p.next=i),u.pending=i}}o.lanes|=s,i=o.alternate,i!==null&&(i.lanes|=s),xd(o.return,s,t),c.lanes|=s;break}i=i.next}}else if(o.tag===10)l=o.type===t.type?null:o.child;else if(o.tag===18){if(l=o.return,l===null)throw Error(me(341));l.lanes|=s,c=l.alternate,c!==null&&(c.lanes|=s),xd(l,s,t),l=o.sibling}else l=o.child;if(l!==null)l.return=o;else for(l=o;l!==null;){if(l===t){l=null;break}if(o=l.sibling,o!==null){o.return=l.return,l=o;break}l=l.return}o=l}pn(e,t,a.children,s),t=t.child}return t;case 9:return a=t.type,r=t.pendingProps.children,Qr(t,s),a=Bn(a),r=r(a),t.flags|=1,pn(e,t,r,s),t.child;case 14:return r=t.type,a=Kn(r,t.pendingProps),a=Kn(r.type,a),Km(e,t,r,a,s);case 15:return Ox(e,t,t.type,t.pendingProps,s);case 17:return r=t.type,a=t.pendingProps,a=t.elementType===r?a:Kn(r,a),jl(e,t),t.tag=1,vn(r)?(e=!0,Bl(t)):e=!1,Qr(t,s),Dx(t,r,a),gd(t,r,a,s),Nd(null,t,r,!0,e,s);case 19:return $x(e,t,s);case 22:return Mx(e,t,s)}throw Error(me(156,t.tag))};function nh(e,t){return Tf(e,t)}function h0(e,t,s,r){this.tag=e,this.key=s,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=t,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=r,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Mn(e,t,s,r){return new h0(e,t,s,r)}function Iu(e){return e=e.prototype,!(!e||!e.isReactComponent)}function g0(e){if(typeof e=="function")return Iu(e)?1:0;if(e!=null){if(e=e.$$typeof,e===Yd)return 11;if(e===Gd)return 14}return 2}function er(e,t){var s=e.alternate;return s===null?(s=Mn(e.tag,t,e.key,e.mode),s.elementType=e.elementType,s.type=e.type,s.stateNode=e.stateNode,s.alternate=e,e.alternate=s):(s.pendingProps=t,s.type=e.type,s.flags=0,s.subtreeFlags=0,s.deletions=null),s.flags=e.flags&14680064,s.childLanes=e.childLanes,s.lanes=e.lanes,s.child=e.child,s.memoizedProps=e.memoizedProps,s.memoizedState=e.memoizedState,s.updateQueue=e.updateQueue,t=e.dependencies,s.dependencies=t===null?null:{lanes:t.lanes,firstContext:t.firstContext},s.sibling=e.sibling,s.index=e.index,s.ref=e.ref,s}function Al(e,t,s,r,a,o){var l=2;if(r=e,typeof e=="function")Iu(e)&&(l=1);else if(typeof e=="string")l=5;else e:switch(e){case Pr:return hr(s.children,a,o,t);case Kd:l=8,a|=8;break;case Hc:return e=Mn(12,s,t,a|2),e.elementType=Hc,e.lanes=o,e;case Uc:return e=Mn(13,s,t,a),e.elementType=Uc,e.lanes=o,e;case Wc:return e=Mn(19,s,t,a),e.elementType=Wc,e.lanes=o,e;case mf:return Si(s,a,o,t);default:if(typeof e=="object"&&e!==null)switch(e.$$typeof){case df:l=10;break e;case uf:l=9;break e;case Yd:l=11;break e;case Gd:l=14;break e;case Ps:l=16,r=null;break e}throw Error(me(130,e==null?e:typeof e,""))}return t=Mn(l,s,t,a),t.elementType=e,t.type=r,t.lanes=o,t}function hr(e,t,s,r){return e=Mn(7,e,r,t),e.lanes=s,e}function Si(e,t,s,r){return e=Mn(22,e,r,t),e.elementType=mf,e.lanes=s,e.stateNode={isHidden:!1},e}function vc(e,t,s){return e=Mn(6,e,null,t),e.lanes=s,e}function Sc(e,t,s){return t=Mn(4,e.children!==null?e.children:[],e.key,t),t.lanes=s,t.stateNode={containerInfo:e.containerInfo,pendingChildren:null,implementation:e.implementation},t}function y0(e,t,s,r,a){this.tag=t,this.containerInfo=e,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=nc(0),this.expirationTimes=nc(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=nc(0),this.identifierPrefix=r,this.onRecoverableError=a,this.mutableSourceEagerHydrationData=null}function Tu(e,t,s,r,a,o,l,c,i){return e=new y0(e,t,s,c,i),t===1?(t=1,o===!0&&(t|=8)):t=0,o=Mn(3,null,null,t),e.current=o,o.stateNode=e,o.memoizedState={element:r,isDehydrated:s,cache:null,transitions:null,pendingSuspenseBoundaries:null},mu(o),e}function b0(e,t,s){var r=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:Mr,key:r==null?null:""+r,children:e,containerInfo:t,implementation:s}}function sh(e){if(!e)return nr;e=e._reactInternals;e:{if(Er(e)!==e||e.tag!==1)throw Error(me(170));var t=e;do{switch(t.tag){case 3:t=t.stateNode.context;break e;case 1:if(vn(t.type)){t=t.stateNode.__reactInternalMemoizedMergedChildContext;break e}}t=t.return}while(t!==null);throw Error(me(171))}if(e.tag===1){var s=e.type;if(vn(s))return sx(e,s,t)}return t}function rh(e,t,s,r,a,o,l,c,i){return e=Tu(s,r,!0,e,a,o,l,c,i),e.context=sh(null),s=e.current,r=fn(),a=Zs(s),o=ws(r,a),o.callback=t??null,Js(s,o,a),e.current.lanes=a,Ao(e,a,r),Sn(e,r),e}function wi(e,t,s,r){var a=t.current,o=fn(),l=Zs(a);return s=sh(s),t.context===null?t.context=s:t.pendingContext=s,t=ws(o,l),t.payload={element:e},r=r===void 0?null:r,r!==null&&(t.callback=r),e=Js(a,t,l),e!==null&&(Xn(e,a,l,o),vl(e,a,l)),l}function Ql(e){if(e=e.current,!e.child)return null;switch(e.child.tag){case 5:return e.child.stateNode;default:return e.child.stateNode}}function rp(e,t){if(e=e.memoizedState,e!==null&&e.dehydrated!==null){var s=e.retryLane;e.retryLane=s!==0&&s<t?s:t}}function Ru(e,t){rp(e,t),(e=e.alternate)&&rp(e,t)}function N0(){return null}var ah=typeof reportError=="function"?reportError:function(e){console.error(e)};function Cu(e){this._internalRoot=e}ji.prototype.render=Cu.prototype.render=function(e){var t=this._internalRoot;if(t===null)throw Error(me(409));wi(e,t,null,null)};ji.prototype.unmount=Cu.prototype.unmount=function(){var e=this._internalRoot;if(e!==null){this._internalRoot=null;var t=e.containerInfo;Sr(function(){wi(null,e,null,null)}),t[As]=null}};function ji(e){this._internalRoot=e}ji.prototype.unstable_scheduleHydration=function(e){if(e){var t=Mf();e={blockedOn:null,target:e,priority:t};for(var s=0;s<Hs.length&&t!==0&&t<Hs[s].priority;s++);Hs.splice(s,0,e),s===0&&Ff(e)}};function Du(e){return!(!e||e.nodeType!==1&&e.nodeType!==9&&e.nodeType!==11)}function Ei(e){return!(!e||e.nodeType!==1&&e.nodeType!==9&&e.nodeType!==11&&(e.nodeType!==8||e.nodeValue!==" react-mount-point-unstable "))}function ap(){}function v0(e,t,s,r,a){if(a){if(typeof r=="function"){var o=r;r=function(){var u=Ql(l);o.call(u)}}var l=rh(t,r,e,0,null,!1,!1,"",ap);return e._reactRootContainer=l,e[As]=l.current,oo(e.nodeType===8?e.parentNode:e),Sr(),l}for(;a=e.lastChild;)e.removeChild(a);if(typeof r=="function"){var c=r;r=function(){var u=Ql(i);c.call(u)}}var i=Tu(e,0,!1,null,null,!1,!1,"",ap);return e._reactRootContainer=i,e[As]=i.current,oo(e.nodeType===8?e.parentNode:e),Sr(function(){wi(t,i,s,r)}),i}function ki(e,t,s,r,a){var o=s._reactRootContainer;if(o){var l=o;if(typeof a=="function"){var c=a;a=function(){var i=Ql(l);c.call(i)}}wi(t,l,e,a)}else l=v0(s,t,e,a,r);return Ql(l)}_f=function(e){switch(e.tag){case 3:var t=e.stateNode;if(t.current.memoizedState.isDehydrated){var s=Fa(t.pendingLanes);s!==0&&(Jd(t,s|1),Sn(t,_t()),!(it&6)&&(la=_t()+500,ar()))}break;case 13:Sr(function(){var r=Is(e,1);if(r!==null){var a=fn();Xn(r,e,1,a)}}),Ru(e,1)}};Qd=function(e){if(e.tag===13){var t=Is(e,134217728);if(t!==null){var s=fn();Xn(t,e,134217728,s)}Ru(e,134217728)}};Of=function(e){if(e.tag===13){var t=Zs(e),s=Is(e,t);if(s!==null){var r=fn();Xn(s,e,t,r)}Ru(e,t)}};Mf=function(){return ut};Pf=function(e,t){var s=ut;try{return ut=e,t()}finally{ut=s}};Zc=function(e,t,s){switch(t){case"input":if(Kc(e,s),t=s.name,s.type==="radio"&&t!=null){for(s=e;s.parentNode;)s=s.parentNode;for(s=s.querySelectorAll("input[name="+JSON.stringify(""+t)+'][type="radio"]'),t=0;t<s.length;t++){var r=s[t];if(r!==e&&r.form===e.form){var a=hi(r);if(!a)throw Error(me(90));ff(r),Kc(r,a)}}}break;case"textarea":hf(e,s);break;case"select":t=s.value,t!=null&&Gr(e,!!s.multiple,t,!1)}};wf=Eu;jf=Sr;var S0={usingClientEntryPoint:!1,Events:[To,Hr,hi,vf,Sf,Eu]},Da={findFiberByHostInstance:mr,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},w0={bundleType:Da.bundleType,version:Da.version,rendererPackageName:Da.rendererPackageName,rendererConfig:Da.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:Rs.ReactCurrentDispatcher,findHostInstanceByFiber:function(e){return e=Af(e),e===null?null:e.stateNode},findFiberByHostInstance:Da.findFiberByHostInstance||N0,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var il=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!il.isDisabled&&il.supportsFiber)try{mi=il.inject(w0),us=il}catch{}}Tn.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=S0;Tn.createPortal=function(e,t){var s=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!Du(t))throw Error(me(200));return b0(e,t,null,s)};Tn.createRoot=function(e,t){if(!Du(e))throw Error(me(299));var s=!1,r="",a=ah;return t!=null&&(t.unstable_strictMode===!0&&(s=!0),t.identifierPrefix!==void 0&&(r=t.identifierPrefix),t.onRecoverableError!==void 0&&(a=t.onRecoverableError)),t=Tu(e,1,!1,null,null,s,!1,r,a),e[As]=t.current,oo(e.nodeType===8?e.parentNode:e),new Cu(t)};Tn.findDOMNode=function(e){if(e==null)return null;if(e.nodeType===1)return e;var t=e._reactInternals;if(t===void 0)throw typeof e.render=="function"?Error(me(188)):(e=Object.keys(e).join(","),Error(me(268,e)));return e=Af(t),e=e===null?null:e.stateNode,e};Tn.flushSync=function(e){return Sr(e)};Tn.hydrate=function(e,t,s){if(!Ei(t))throw Error(me(200));return ki(null,e,t,!0,s)};Tn.hydrateRoot=function(e,t,s){if(!Du(e))throw Error(me(405));var r=s!=null&&s.hydratedSources||null,a=!1,o="",l=ah;if(s!=null&&(s.unstable_strictMode===!0&&(a=!0),s.identifierPrefix!==void 0&&(o=s.identifierPrefix),s.onRecoverableError!==void 0&&(l=s.onRecoverableError)),t=rh(t,null,e,1,s??null,a,!1,o,l),e[As]=t.current,oo(e),r)for(e=0;e<r.length;e++)s=r[e],a=s._getVersion,a=a(s._source),t.mutableSourceEagerHydrationData==null?t.mutableSourceEagerHydrationData=[s,a]:t.mutableSourceEagerHydrationData.push(s,a);return new ji(t)};Tn.render=function(e,t,s){if(!Ei(t))throw Error(me(200));return ki(null,e,t,!1,s)};Tn.unmountComponentAtNode=function(e){if(!Ei(e))throw Error(me(40));return e._reactRootContainer?(Sr(function(){ki(null,null,e,!1,function(){e._reactRootContainer=null,e[As]=null})}),!0):!1};Tn.unstable_batchedUpdates=Eu;Tn.unstable_renderSubtreeIntoContainer=function(e,t,s,r){if(!Ei(s))throw Error(me(200));if(e==null||e._reactInternals===void 0)throw Error(me(38));return ki(e,t,s,!1,r)};Tn.version="18.3.1-next-f1338f8080-20240426";function oh(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(oh)}catch(e){console.error(e)}}oh(),af.exports=Tn;var j0=af.exports,op=j0;Bc.createRoot=op.createRoot,Bc.hydrateRoot=op.hydrateRoot;/**
 * @license
 * (c) Copyright 2023 Grammarly, Inc.
 * 
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 * 
 *     http://www.apache.org/licenses/LICENSE-2.0
 * 
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function cl(e,t,s){return t in e?Object.defineProperty(e,t,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[t]=s,e}var lp=new Map;class ho extends Error{constructor(t,s){super(),cl(this,"args",void 0),cl(this,"code",void 0),cl(this,"url",void 0),cl(this,"_c",void 0);var r=new URL("https://developer.grammarly.com/docs/error-explainer");r.searchParams.set("code",t.toString()),s.forEach(a=>r.searchParams.append("args",function(o){if(o instanceof Error)return o.message+`
`+String(o.stack);if(o==null)return"null";if(typeof o=="object")try{return Object.prototype.toString.call(o)}catch{}return String(o)}(a))),this.stack!=null&&r.searchParams.set("trace",this.stack),this.message="Minified error #".concat(t,": See ").concat(r.toString()," for details."),this.args=s,this.code=t,this.url=r.toString()}toUserMessage(){var t=lp.get("".concat(this.code));if(t==null)return[this];var s=new Map(this.args.map((a,o)=>["${".concat(o,"}"),a])),r=t.split(/(\${\d+})/).filter(a=>a!=="");return r.map(a=>{var o;return(o=s.get(a))!==null&&o!==void 0?o:a})}toJSON(){return{name:"InvariantError",message:this.message,description:this._m,code:this.code,args:this.args,stack:this.stack}}static setMessages(t){lp=t}static create(t,s,r,a){a!=null&&s.push(a);var o=new ho(t,s,r);return o.stack=a==null?void 0:a.stack,o._m=r,o}}const ip=new WeakMap;async function E0(e,t){const s=ip.get(e);if(s!=null)return await s;(function(a){a.Grammarly==null&&(a.Grammarly={})})(e);const r=new Promise((a,o)=>{try{let c=function(i,u){return i.document.querySelectorAll(`script[src^="${u.replace(/\?.*$/,"")}"]`)[0]}(e,t);c!=null?l():(c=function(i,u){const p=i.document.createElement("script");return p.src=u,i.document.head.appendChild(p),p}(e,t),c.addEventListener("load",l),c.addEventListener("error",function(){try{throw new ho(23,[])}catch(i){o(i)}}))}catch(c){return o(c)}function l(){try{if(e.Grammarly==null||typeof e.Grammarly.EditorSDK!="function")throw new ho(22,[]);a(e.Grammarly)}catch(c){o(c)}}});return ip.set(e,r),await r}async function cp(e,t,s,r){if(typeof window>"u"&&r===void 0)throw new ho(21,[]);const a=function(c){return c.location.origin!=="null"?c.location.origin:c.origin!=="null"?c.origin:"null"}(r??window);a==="null"&&(r??window).top!==(r??window)&&console.warn("Grammarly is not supported in IFrames with `null` origin. Consider adding `sandbox='allow-same-origin allow-scripts'` to <iframe> element.");const o=new URL("https://js.grammarly.com/grammarly-editor-sdk@2.5",a);t!=null&&o.searchParams.set("clientId",t),o.searchParams.set("packageName",e);const l=await E0(r??window,o.toString());if(t!=null)return new l.EditorSDK(t,s)}const wc={onBeforeSuggestionCardOpen:"before-suggestion-card-open",onSuggestionCardOpen:"suggestion-card-open",onSuggestionCardClose:"suggestion-card-close",onSuggestionCardAction:"suggestion-card-action",onPluginTurnedOff:"plugin-turned-off",onPluginError:"plugin-error",onDocumentStats:"document-stats",onSessionStats:"session-stats"};/**
 * @license
 * (c) Copyright 2023 Grammarly, Inc.
 * 
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 * 
 *     http://www.apache.org/licenses/LICENSE-2.0
 * 
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const k0=ui.createContext({});function A0(e,t,s){const r=g.useCallback(a=>e==null?void 0:e(new CustomEvent("plugin-error",{detail:a})),[e]);g.useEffect(()=>{var a;typeof navigator<"u"&&(t!=null&&((a=s==null?void 0:s.current)===null||a===void 0?void 0:a.ownerDocument.defaultView)!=null&&window!==s.current.ownerDocument.defaultView?cp("@grammarly/editor-sdk-react",t,void 0,s.current.ownerDocument.defaultView).catch(r):cp("@grammarly/editor-sdk-react").catch(r))},s!=null&&t!=null?[s,t]:[])}function dp(e){return typeof e=="function"}const go=e=>{const[t,{clientId:s,config:r,children:a,className:o,...l}]=function(E){const W={},b={...E};return Object.keys(wc).forEach(h=>{W[h]=E[h],h in b&&delete b[h]}),[W,b]}(e),c=g.useContext(k0),i=g.useRef(),u=g.useRef(),p=g.useRef(),y=g.useCallback(E=>{i.current=E,w()},[]),N=function(E){const[W,b]=g.useState({}),h=g.useCallback(()=>{customElements.whenDefined(E).then(()=>b(S=>({...S,[E]:!0}))).catch(()=>{})},[E]);return g.useEffect(h,[h]),!!W[E]}("grammarly-editor-plugin"),w=g.useCallback(()=>{var E;i.current!=null&&u.current!=null&&N&&i.current.connect(u.current,(E=p.current)!==null&&E!==void 0?E:void 0)},[N]),R=g.useMemo(()=>({...c.config,...r}),[c.config,r]);return g.useEffect(()=>{i.current&&(i.current.config=R)},[i,R]),g.useEffect(()=>{if(i.current==null)return;const{current:E}=i,W=[];return Object.keys(wc).forEach(b=>{const h=t[b],S=wc[b];h!=null&&(E.addEventListener(S,h),W.push(()=>E.removeEventListener(S,h)))}),()=>W.forEach(b=>b())},[...Object.values(t),N,i.current]),A0(e.onPluginError,s??c.clientId,i),ui.createElement("grammarly-editor-plugin",{...l,ref:y,clientId:s??c.clientId,autodetect:dp(a)?"off":"on",class:o},dp(a)?a({setEditor:E=>{u.current=E,w()},setViewport:E=>{p.current=E,w()}}):a)};/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */var I0={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const T0=e=>e.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase().trim(),Qe=(e,t)=>{const s=g.forwardRef(({color:r="currentColor",size:a=24,strokeWidth:o=2,absoluteStrokeWidth:l,className:c="",children:i,...u},p)=>g.createElement("svg",{ref:p,...I0,width:a,height:a,stroke:r,strokeWidth:l?Number(o)*24/Number(a):o,className:["lucide",`lucide-${T0(e)}`,c].join(" "),...u},[...t.map(([y,N])=>g.createElement(y,N)),...Array.isArray(i)?i:[i]]));return s.displayName=`${e}`,s};/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const qa=Qe("AlertTriangle",[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3Z",key:"c3ski4"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const lh=Qe("ArrowRight",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"m12 5 7 7-7 7",key:"xquz4c"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Zl=Qe("Bell",[["path",{d:"M6 8a6 6 0 0 1 12 0c0 7 3 9 3 9H3s3-2 3-9",key:"1qo2s2"}],["path",{d:"M10.3 21a1.94 1.94 0 0 0 3.4 0",key:"qgo35s"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const R0=Qe("Calculator",[["rect",{width:"16",height:"20",x:"4",y:"2",rx:"2",key:"1nb95v"}],["line",{x1:"8",x2:"16",y1:"6",y2:"6",key:"x4nwl0"}],["line",{x1:"16",x2:"16",y1:"14",y2:"18",key:"wjye3r"}],["path",{d:"M16 10h.01",key:"1m94wz"}],["path",{d:"M12 10h.01",key:"1nrarc"}],["path",{d:"M8 10h.01",key:"19clt8"}],["path",{d:"M12 14h.01",key:"1etili"}],["path",{d:"M8 14h.01",key:"6423bh"}],["path",{d:"M12 18h.01",key:"mhygvu"}],["path",{d:"M8 18h.01",key:"lrp35t"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const C0=Qe("Calendar",[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ih=Qe("Check",[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const D0=Qe("ChevronDown",[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ei=Qe("ChevronLeft",[["path",{d:"m15 18-6-6 6-6",key:"1wnfg3"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const is=Qe("ChevronRight",[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const L0=Qe("ChevronUp",[["path",{d:"m18 15-6-6-6 6",key:"153udz"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const _0=Qe("Clock",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polyline",{points:"12 6 12 12 16 14",key:"68esgv"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const O0=Qe("FilePlus2",[["path",{d:"M4 22h14a2 2 0 0 0 2-2V7l-5-5H6a2 2 0 0 0-2 2v4",key:"1pf5j1"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M3 15h6",key:"4e2qda"}],["path",{d:"M6 12v6",key:"1u72j0"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const M0=Qe("FileSpreadsheet",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M8 13h2",key:"yr2amv"}],["path",{d:"M14 13h2",key:"un5t4a"}],["path",{d:"M8 17h2",key:"2yhykz"}],["path",{d:"M14 17h2",key:"10kma7"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const yo=Qe("FileText",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M10 9H8",key:"b1mrlr"}],["path",{d:"M16 13H8",key:"t4e002"}],["path",{d:"M16 17H8",key:"z1uh3a"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ch=Qe("FolderOpen",[["path",{d:"m6 14 1.5-2.9A2 2 0 0 1 9.24 10H20a2 2 0 0 1 1.94 2.5l-1.54 6a2 2 0 0 1-1.95 1.5H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h3.9a2 2 0 0 1 1.69.9l.81 1.2a2 2 0 0 0 1.67.9H18a2 2 0 0 1 2 2v2",key:"usdka0"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const P0=Qe("Globe",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 2a14.5 14.5 0 0 0 0 20 14.5 14.5 0 0 0 0-20",key:"13o1zl"}],["path",{d:"M2 12h20",key:"9i4pu4"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Lu=Qe("HelpCircle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3",key:"1u773s"}],["path",{d:"M12 17h.01",key:"p32p05"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const dh=Qe("History",[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}],["path",{d:"M12 7v5l4 2",key:"1fdv2h"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const _u=Qe("Home",[["path",{d:"m3 9 9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z",key:"y5dka4"}],["polyline",{points:"9 22 9 12 15 12 15 22",key:"e2us08"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const F0=Qe("KeyRound",[["path",{d:"M2 18v3c0 .6.4 1 1 1h4v-3h3v-3h2l1.4-1.4a6.5 6.5 0 1 0-4-4Z",key:"167ctg"}],["circle",{cx:"16.5",cy:"7.5",r:".5",fill:"currentColor",key:"w0ekpg"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ia=Qe("Lightbulb",[["path",{d:"M15 14c.2-1 .7-1.7 1.5-2.5 1-.9 1.5-2.2 1.5-3.5A6 6 0 0 0 6 8c0 1 .2 2.2 1.5 3.5.7.7 1.3 1.5 1.5 2.5",key:"1gvzjb"}],["path",{d:"M9 18h6",key:"x1upvd"}],["path",{d:"M10 22h4",key:"ceow96"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const B0=Qe("ListPlus",[["path",{d:"M11 12H3",key:"51ecnj"}],["path",{d:"M16 6H3",key:"1wxfjs"}],["path",{d:"M16 18H3",key:"12xzn7"}],["path",{d:"M18 9v6",key:"1twb98"}],["path",{d:"M21 12h-6",key:"bt1uis"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Bt=Qe("Loader2",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const uh=Qe("LogOut",[["path",{d:"M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4",key:"1uf3rs"}],["polyline",{points:"16 17 21 12 16 7",key:"1gabdz"}],["line",{x1:"21",x2:"9",y1:"12",y2:"12",key:"1uyos4"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ou=Qe("NotebookPen",[["path",{d:"M13.4 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2v-7.4",key:"re6nr2"}],["path",{d:"M2 6h4",key:"aawbzj"}],["path",{d:"M2 10h4",key:"l0bgd4"}],["path",{d:"M2 14h4",key:"1gsvsf"}],["path",{d:"M2 18h4",key:"1bu2t1"}],["path",{d:"M18.4 2.6a2.17 2.17 0 0 1 3 3L16 11l-4 1 1-4Z",key:"1dba1m"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $0=Qe("Paperclip",[["path",{d:"m21.44 11.05-9.19 9.19a6 6 0 0 1-8.49-8.49l8.57-8.57A4 4 0 1 1 18 8.84l-8.59 8.57a2 2 0 0 1-2.83-2.83l8.49-8.48",key:"1u3ebp"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Mu=Qe("Plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const mh=Qe("Receipt",[["path",{d:"M4 2v20l2-1 2 1 2-1 2 1 2-1 2 1 2-1 2 1V2l-2 1-2-1-2 1-2-1-2 1-2-1-2 1Z",key:"q3az6g"}],["path",{d:"M16 8h-6a2 2 0 1 0 0 4h4a2 2 0 1 1 0 4H8",key:"1h4pet"}],["path",{d:"M12 17.5v-11",key:"1jc1ny"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const H0=Qe("Search",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["path",{d:"m21 21-4.3-4.3",key:"1qie3q"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ti=Qe("Send",[["path",{d:"m22 2-7 20-4-9-9-4Z",key:"1q3vgg"}],["path",{d:"M22 2 11 13",key:"nzbqef"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const U0=Qe("ShieldAlert",[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}],["path",{d:"M12 8v4",key:"1got3b"}],["path",{d:"M12 16h.01",key:"1drbdi"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const W0=Qe("Sparkles",[["path",{d:"m12 3-1.912 5.813a2 2 0 0 1-1.275 1.275L3 12l5.813 1.912a2 2 0 0 1 1.275 1.275L12 21l1.912-5.813a2 2 0 0 1 1.275-1.275L21 12l-5.813-1.912a2 2 0 0 1-1.275-1.275L12 3Z",key:"17u4zn"}],["path",{d:"M5 3v4",key:"bklmnn"}],["path",{d:"M19 17v4",key:"iiml17"}],["path",{d:"M3 5h4",key:"nem4j1"}],["path",{d:"M17 19h4",key:"lbex7p"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const z0=Qe("Star",[["polygon",{points:"12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2",key:"8f66p6"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ph=Qe("Table",[["path",{d:"M12 3v18",key:"108xh3"}],["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}],["path",{d:"M3 9h18",key:"1pudct"}],["path",{d:"M3 15h18",key:"5xshup"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ws=Qe("Trash2",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const bo=Qe("Upload",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"17 8 12 3 7 8",key:"t8dd8p"}],["line",{x1:"12",x2:"12",y1:"3",y2:"15",key:"widbto"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const V0=Qe("UserCheck",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["polyline",{points:"16 11 18 13 22 9",key:"1pwet4"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const K0=Qe("User",[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Y0=Qe("Wand2",[["path",{d:"m21.64 3.64-1.28-1.28a1.21 1.21 0 0 0-1.72 0L2.36 18.64a1.21 1.21 0 0 0 0 1.72l1.28 1.28a1.2 1.2 0 0 0 1.72 0L21.64 5.36a1.2 1.2 0 0 0 0-1.72Z",key:"1bcowg"}],["path",{d:"m14 7 3 3",key:"1r5n42"}],["path",{d:"M5 6v4",key:"ilb8ba"}],["path",{d:"M19 14v4",key:"blhpug"}],["path",{d:"M10 2v2",key:"7u0qdc"}],["path",{d:"M7 8H3",key:"zfb6yr"}],["path",{d:"M21 16h-4",key:"1cnmox"}],["path",{d:"M11 3H9",key:"1obp7u"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ht=Qe("X",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]]),fh=["The facts outlined in the statement of claim","Statement of Claim  Factual Summary"],Ks="Factual background  Statement of Claim",xh=["Factual Summary from the Letter of Demand"],Co="Factual background  Letter of Demand",Pu="The plaintiff's expert opinion",Fu="The claimant's expert opinion",js=[{id:"u1",username:"lior",password:"lior123",name:"Lior Perry",email:"lior@lp-law.co.il",role:"ADMIN"},{id:"u2",username:"lidor",password:"lidor123",name:"Lidor Kabilo",email:"Lidor@lp-law.co.il",role:"SUB_ADMIN"},{id:"u3",username:"iris",password:"iris123",name:"Iris Alfman",email:"Iris@lp-law.co.il",role:"FINANCE"},{id:"u4",username:"hava",password:"hava123",name:"Hava Kabilo",email:"Hava@lp-law.co.il",role:"LAWYER"},{id:"u5",username:"may",password:"may123",name:"May Harari",email:"May@lp-law.co.il",role:"LAWYER"},{id:"u6",username:"vlada",password:"vlada123",name:"Vlada Boltach",email:"Vlada@lp-law.co.il",role:"LAWYER"},{id:"u7",username:"orly",password:"orly123",name:"Orly Day",email:"Orly@lp-law.co.il",role:"LAWYER"}],up=["W/R/B Underwriting","QBE Insurance Group","Market Form Underwriting","Dale Underwriting Partners","MedPro & CNA Syndicate","Hardy (Underwriting Agencies) Limited"],Or=[Ks,Co,Pu,Fu,"The insured's expert opinion","Insurance Coverage","Risk Assessment","MPL","Strategy","Expenses breakdown","Expenses & Compensation breakdown","Recommendations","Strategy & Recommendations","Request for Approval of a Settlement Agreement"],hh=["New lawsuit","Letter of demand","New third-party notice","Caution Notice"],No="/api/templates",vo=async e=>{if(!e.ok){const s=await e.text().catch(()=>"");throw new Error(s||`Request failed with status ${e.status}`)}const t=await e.json();return Array.isArray(t)?t:[]},mp=async()=>{const e=await fetch(No);return vo(e)},pp=async(e,t)=>{const s={"Content-Type":"application/json","x-user-role":t};if(!e.id){const a=await fetch(No,{method:"POST",headers:s,body:JSON.stringify(e)});return vo(a)}const r=await fetch(`${No}/${encodeURIComponent(e.id)}`,{method:"PUT",headers:s,body:JSON.stringify(e)});return vo(r)},G0=async(e,t)=>{const s=await fetch(`${No}/${encodeURIComponent(e)}`,{method:"DELETE",headers:{"x-user-role":t}});return vo(s)},q0=async(e,t,s)=>{const r=await fetch(`${No}/${encodeURIComponent(e)}/reorder`,{method:"POST",headers:{"Content-Type":"application/json","x-user-role":s},body:JSON.stringify({direction:t})});return vo(r)},Dd=async e=>{if(!e||!e.trim())return"";try{const t=await fetch("/api/translate",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({text:e})});if(!t.ok)throw new Error(`Server error: ${t.statusText}`);return(await t.json()).translation||""}catch(t){return console.error("Translation error:",t),"Error translation."}},X0=async(e,t)=>{try{const s=await fetch("/api/extract-policy",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({image:e,mimeType:t})});if(!s.ok)throw new Error("Server error");return await s.json()}catch(s){return console.error(s),{}}},J0=async(e,t="SAFE_POLISH")=>{try{const s=await fetch("/api/refine-text",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({text:e,mode:t})}),r=await s.json().catch(()=>({}));if(s.status===422&&r&&r.error&&r.error.code==="FACT_PROTECTION_FAILED")return{text:typeof r.refined=="string"?r.refined:e,factProtectionBlocked:!0};if(!s.ok)throw new Error("Refinement failed");return{text:typeof r.refined=="string"&&r.refined.trim()?r.refined:e,factProtectionBlocked:!1}}catch(s){throw console.error("Hebrew refinement error:",s),s}},gh=async e=>{if(!e||!e.trim())return e;try{const t=await fetch("/api/improve-english",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({text:e})});if(!t.ok)throw new Error("English improvement failed");const s=await t.json(),r=typeof s.improved=="string"?s.improved:"";return r.trim()?r:e}catch(t){throw console.error("English improvement error:",t),t}},Q0=async e=>{if(!e||!e.trim())return"";try{const t=await fetch("/api/hebrew-report-summary",{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({text:e})}),s=await t.json().catch(()=>({}));if(!t.ok){const a=s&&typeof s.error=="string"&&s.error||"Hebrew report summary failed";throw new Error(a)}return typeof s.summary=="string"&&s.summary.trim()?s.summary.trim():""}catch(t){throw console.error("Hebrew report summary error:",t),t instanceof Error?t:new Error("Hebrew report summary error")}},Z0=async(e,t,s="CLAIM",r)=>{const a=await fetch("/api/analyze-medical-complaint",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({fileBase64:e,mimeType:t,analysisType:s,expertCountMode:r==null?void 0:r.expertCountMode,partyRole:r==null?void 0:r.partyRole,sectionKey:r==null?void 0:r.sectionKey,plaintiffName:r==null?void 0:r.plaintiffName,insuredName:r==null?void 0:r.insuredName,insurerName:r==null?void 0:r.insurerName,reportSubject:r==null?void 0:r.reportSubject})}),o=await a.json().catch(()=>({})),l=o.analysis??null,c=typeof o.claimSummary=="string"?o.claimSummary:"";return a.ok?o.success===!1?{analysis:null,claimSummary:"",success:!1,reason:o.reason}:{analysis:l,claimSummary:c,success:!0,lowConfidenceDocument:!!o.lowConfidenceDocument}:(console.error("Medical complaint analysis failed",a.status,o),{analysis:null,claimSummary:"",success:!1,reason:o.reason||"REQUEST_FAILED"})},eb=async(e,t)=>{const s=await fetch("/api/analyze-dental-opinion",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({fileBase64:e,mimeType:t})}),r=await s.json().catch(()=>({})),a=typeof r.result=="string"?r.result:"",o=typeof r.reason=="string"?r.reason:void 0;return s.ok?r.success===!1?{success:!1,text:"",reason:o||"AI_UNAVAILABLE"}:{success:!0,text:a,lowConfidenceDocument:!!r.lowConfidenceDocument}:(console.error("Dental opinion analysis failed",s.status,r),{success:!1,text:"",reason:o||"REQUEST_FAILED"})},tb=async(e,t)=>{try{const s=await fetch("/api/extract-expenses",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({fileBase64:e,mimeType:t})});if(!s.ok)throw new Error("Expenses extraction failed");return await s.json()}catch(s){return console.error(s),{items:[]}}},nb=async e=>{try{const t=await fetch("/api/help-chat",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({question:e})});if(!t.ok)throw new Error("Chat failed");return(await t.json()).answer||"Sorry, I could not answer that."}catch(t){return console.error(t),"System error. Please try again."}},sb=async e=>{try{const t=await fetch("/api/assistant/help",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)}),s=await t.json().catch(()=>({}));t.ok||console.error("Assistant help HTTP error:",t.status,s);const r=typeof s.title=="string"&&s.title.trim()?s.title.trim():"    ",a=Array.isArray(s.bullets)?s.bullets.filter(c=>typeof c=="string"&&c.trim().length>0):["        -AI.","       (, ,  PDF).","  ,      ."],o=typeof s.warning=="string"&&s.warning.trim()?s.warning.trim():void 0,l=typeof s.nextSuggestion=="string"&&s.nextSuggestion.trim()?s.nextSuggestion.trim():void 0;return{title:r,bullets:a,warning:o,nextSuggestion:l}}catch(t){throw console.error("Assistant help error:",t),t}},fp=async e=>{try{if(!(await fetch("/api/send-email",{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify(e)})).ok)throw new Error("Email failed");return!0}catch(t){return console.error(t),!1}},jc=async e=>{try{const t=await fetch("/api/render-report-pdf",{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({report:e})});if(!t.ok){let s="PDF rendering failed";try{const r=await t.json();r&&typeof r.error=="string"&&(s=r.error)}catch{}throw new Error(s)}return await t.blob()}catch(t){throw console.error("PDF render error:",t),t}};async function rb(e,t){try{const s=await fetch("/api/analyze-tone-risk",{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({content:e})});let r=null;try{r=await s.json()}catch{r=null}if(!s.ok){const p=r&&r.error&&typeof r.error.message=="string"?r.error.message:"Tone & Risk analysis failed";throw new Error(p)}const a=!!(r&&r.ok),o=r&&typeof r.runAt=="string"?r.runAt:new Date().toISOString(),l=Array.isArray(r==null?void 0:r.issues)?r.issues:[],c=r&&typeof r.promptVersion=="string"?r.promptVersion:"unknown",i=r&&typeof r.meta=="object"?{sectionsSent:Number(r.meta.sectionsSent)||0,charsBefore:Number(r.meta.charsBefore)||0,charsAfter:Number(r.meta.charsAfter)||0,truncatedSections:Number(r.meta.truncatedSections)||0}:{sectionsSent:0,charsBefore:0,charsAfter:0,truncatedSections:0},u=r&&typeof r.error=="object"?{code:r.error.code,message:r.error.message}:void 0;if(!a){const p=u&&typeof u.message=="string"&&u.message||"Tone & Risk analysis failed",y=new Error(p);throw y.code=(u==null?void 0:u.code)||"LLM_FAILED",y}return{ok:!0,runAt:o,promptVersion:c,issues:l,meta:i,error:void 0}}catch(s){throw console.error("Tone & Risk analysis error:",s),s instanceof Error?s:new Error("Tone & Risk analysis error")}}async function ab(e,t){const s=await fetch("/api/review-hebrew-style",{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({content:e})}),r=await s.json().catch(()=>({})),a=Array.isArray(r.issues)?r.issues:[],o=typeof r.runAt=="string"?r.runAt:new Date().toISOString();return s.ok?r.success===!1?{runAt:o,issues:a,success:!1,reason:r.reason}:{runAt:o,issues:a,success:!0}:(console.error("Hebrew style review failed",s.status,r),{runAt:o,issues:a,success:!1,reason:r.reason||"REQUEST_FAILED"})}const ca="/api/best-practices",da=async e=>{if(!e.ok){const s=await e.text().catch(()=>"");throw new Error(s||`Request failed with status ${e.status}`)}const t=await e.json();return Array.isArray(t)?t:[]},ob=async()=>{const e=await fetch(ca);return da(e)},xp=async(e,t)=>{const s={"Content-Type":"application/json","x-user-role":t};if(!e.id){const a=await fetch(ca,{method:"POST",headers:s,body:JSON.stringify(e)});return da(a)}const r=await fetch(`${ca}/${encodeURIComponent(e.id)}`,{method:"PUT",headers:s,body:JSON.stringify(e)});return da(r)},lb=async(e,t)=>{const s=await fetch(`${ca}/${encodeURIComponent(e)}`,{method:"DELETE",headers:{"x-user-role":t}});return da(s)},ib=async(e,t,s)=>{const r=await fetch(`${ca}/${encodeURIComponent(e)}`,{method:"PUT",headers:{"Content-Type":"application/json","x-user-role":s},body:JSON.stringify({isEnabled:t})});return da(r)},hp=async(e,t,s)=>{const r=await fetch(`${ca}/${encodeURIComponent(e)}/usage`,{method:"POST",headers:{"Content-Type":"application/json","x-user-role":s},body:JSON.stringify({mode:t})});return da(r)},Bu=e=>e===Pu,$u=e=>e===Fu,gp=e=>Bu(e)||$u(e),cb=e=>Bu(e)||e===Ks?"PLAINTIFF":$u(e)||e===Co?"CLAIMANT":null,yp=(e,t="SINGLE")=>`${t==="MULTIPLE"?"Expert opinions":"Expert opinion"}  ${e==="PLAINTIFF"?"Statement of Claim":"Letter of Demand"}`,Ld=(e,t)=>Bu(e)?yp("PLAINTIFF",t):$u(e)?yp("CLAIMANT",t):e,db=({data:e})=>{const[t,s]=g.useState(""),[r,a]=g.useState(!1),[o,l]=g.useState(null);if(g.useEffect(()=>{let i=!1;return(async()=>{a(!0),l(null);try{const p=await fetch("/api/render-report-html",{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({report:e})});if(!p.ok)throw new Error("Failed to load report HTML");const y=await p.text();i||s(y)}catch(p){console.error(p),i||l("   ")}finally{i||a(!1)}})(),()=>{i=!0}},[e]),o)return n.jsx("div",{className:"w-[210mm] min-h-[297mm] bg-panel border border-borderDark shadow-2xl mx-auto flex items-center justify-center text-sm text-red-300",children:o});if(r&&!t)return n.jsx("div",{className:"w-[210mm] min-h-[297mm] bg-panel shadow-2xl mx-auto flex flex-col items-center justify-center text-sm text-textMuted",children:n.jsx("span",{children:"  ..."})});const c=!!e.policyFile&&(e.attachPolicyAsAppendix??!0);return n.jsxs("div",{className:"space-y-2",children:[n.jsx("iframe",{title:"Report Preview",className:"w-[210mm] min-h-[297mm] bg-panel shadow-2xl mx-auto border-none print:shadow-none print:w-full",srcDoc:t}),c&&n.jsx("p",{className:"w-[210mm] mx-auto text-[11px] text-textMuted text-right",children:"The policy file will be attached as Appendix A in the final PDF (not shown in this preview)."})]})},ub=e=>{switch(e){case"HEBREW_SUBMITTED":return" ";case"HEBREW_CHANGES_REQUESTED":return" ";case"HEBREW_APPROVED":return" ";case"HEBREW_REOPENED_EXTERNAL":return"  ()";case"HEBREW_DRAFT":default:return" "}},mb=e=>{switch(e){case"SUBMITTED":return"  ";case"CHANGES_REQUESTED":return"  ";case"APPROVED":return"  ";case"DRAFT":default:return"  (  )"}},Il="report-review-panel",_d="external-feedback-panel",pb=({report:e,currentUser:t,onSubmitToAdmin:s,onApproveHebrew:r,onRequestChanges:a,onMarkIssueDone:o,onAddExternalFeedbackIssues:l,onReopenHebrewDueToExternalFeedback:c})=>{const[i,u]=g.useState(!1),[p,y]=g.useState(""),[N,w]=g.useState(""),[R,E]=g.useState("NORMAL"),[W,b]=g.useState(""),[h,S]=g.useState("INTERNAL"),[P,U]=g.useState("ENGLISH_ONLY"),z=g.useMemo(()=>{const M=e.reportReview;return M||{status:"DRAFT",issues:[]}},[e.reportReview]),q=g.useMemo(()=>{const M={};return z.issues.filter(I=>(I.origin??"INTERNAL")==="INTERNAL").forEach(I=>{const D=I.sectionKey||"GENERAL";M[D]||(M[D]=[]),M[D]=[...M[D],I]}),M},[z.issues]),ee=g.useMemo(()=>{const M={};return z.issues.filter(I=>I.origin==="EXTERNAL").forEach(I=>{const D=I.sectionKey||"GENERAL";M[D]||(M[D]=[]),M[D]=[...M[D],I]}),M},[z.issues]),G=(t==null?void 0:t.role)==="LAWYER",se=(t==null?void 0:t.role)==="ADMIN",j=z.issues.some(M=>(M.origin??"INTERNAL")==="EXTERNAL"&&M.status!=="DONE"&&M.externalAction==="REQUIRES_HEBREW"),F=M=>{S(M),y(""),w(""),E("NORMAL"),b(""),U("ENGLISH_ONLY"),u(!0)},L=()=>{const M=p.trim(),I=N.trim();if(!M||!I)return;const D={title:M,instruction:I,severity:R,type:"OTHER",sectionKey:void 0,externalAction:h==="EXTERNAL"?P:void 0};h==="EXTERNAL"&&l?l([D],W.trim()||void 0):a([D]),u(!1)},O=mb(z.status),H=ub(e.hebrewWorkflowStatus);return n.jsxs("section",{id:Il,className:"mt-4 rounded-xl border border-borderDark bg-navySecondary px-4 py-3",dir:"rtl",lang:"he",children:[n.jsxs("div",{className:"mb-2 flex items-center justify-between gap-3",children:[n.jsxs("div",{children:[n.jsx("div",{className:"text-xs font-semibold text-textMuted500",children:" "}),n.jsx("div",{className:"text-sm font-medium text-textLight",children:O})]}),n.jsx("span",{className:"inline-flex items-center rounded-full bg-navySecondary px-3 py-1 text-xs font-medium text-textMuted700",children:H})]}),G&&n.jsx("div",{className:"mb-3 text-xs text-amber-700",children:e.hebrewWorkflowStatus==="HEBREW_REOPENED_EXTERNAL"?"            .":z.status==="SUBMITTED"?"   .       .":z.status==="CHANGES_REQUESTED"?"   .      .":null}),se&&j&&n.jsx("div",{className:"mb-3 text-xs font-semibold text-red-700",children:"      .    ."}),z.issues.length>0&&n.jsxs("div",{className:"mb-3 space-y-3",children:[Object.keys(q).length>0&&n.jsxs("div",{children:[n.jsx("div",{className:"mb-1 text-xs font-semibold text-textMuted",children:"  ()"}),Object.entries(q).map(([M,I])=>n.jsxs("div",{className:"rounded-lg bg-panel p-2 mb-1",children:[M!=="GENERAL"&&n.jsxs("div",{className:"mb-1 text-[11px] font-semibold text-textMuted500",children:[": ",M]}),n.jsx("ul",{className:"space-y-1",children:I.map(D=>n.jsxs("li",{className:"flex items-start justify-between gap-2 rounded-md border border-borderDark bg-navySecondary px-2 py-1.5",children:[n.jsxs("div",{children:[n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsx("span",{className:`inline-flex items-center rounded-full px-2 py-0.5 text-[10px] font-semibold ${D.severity==="CRITICAL"?"bg-red-100 text-red-700":D.severity==="NORMAL"?"bg-amber-50 text-amber-700":"bg-navySecondary text-textMuted"}`,children:D.severity==="CRITICAL"?"":D.severity==="NORMAL"?"":""}),n.jsx("span",{className:"text-xs font-medium text-textLight",children:D.title})]}),n.jsx("div",{className:"mt-1 text-[11px] text-textMuted700",children:D.instruction})]}),(G||se)&&n.jsx("button",{type:"button",className:"mt-1 inline-flex items-center rounded-full border border-emerald-200 bg-emerald-50 px-2 py-0.5 text-[10px] font-medium text-emerald-700 hover:bg-emerald-100 disabled:opacity-50",disabled:D.status==="DONE",onClick:()=>o(D.id),children:D.status==="DONE"?"":" "})]},D.id))})]},M))]}),Object.keys(ee).length>0&&n.jsxs("div",{id:_d,children:[n.jsx("div",{className:"mb-1 text-xs font-semibold text-textMuted",children:"  "}),Object.entries(ee).map(([M,I])=>n.jsxs("div",{className:"rounded-lg bg-panel p-2 mb-1",children:[M!=="GENERAL"&&n.jsxs("div",{className:"mb-1 text-[11px] font-semibold text-textMuted500",children:[": ",M]}),n.jsx("ul",{className:"space-y-1",children:I.map(D=>n.jsxs("li",{className:"flex items-start justify-between gap-2 rounded-md border border-borderDark bg-navySecondary px-2 py-1.5",children:[n.jsxs("div",{children:[n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsx("span",{className:`inline-flex items-center rounded-full px-2 py-0.5 text-[10px] font-semibold ${D.severity==="CRITICAL"?"bg-red-100 text-red-700":D.severity==="NORMAL"?"bg-amber-50 text-amber-700":"bg-navySecondary text-textMuted"}`,children:D.severity==="CRITICAL"?"":D.severity==="NORMAL"?"":""}),n.jsx("span",{className:"text-xs font-medium text-textLight",children:D.title})]}),n.jsx("div",{className:"mt-1 text-[11px] text-textMuted700",children:D.instruction})]}),(G||se)&&n.jsx("button",{type:"button",className:"mt-1 inline-flex items-center rounded-full border border-emerald-200 bg-emerald-50 px-2 py-0.5 text-[10px] font-medium text-emerald-700 hover:bg-emerald-100 disabled:opacity-50",disabled:D.status==="DONE",onClick:()=>o(D.id),children:D.status==="DONE"?"":" "})]},D.id))})]},M))]})]}),n.jsxs("div",{className:"mt-3 flex flex-wrap items-center gap-2",children:[G&&n.jsx("button",{type:"button",className:"rounded-md bg-sky-700 px-3 py-1.5 text-xs font-semibold text-white hover:bg-sky-800 disabled:opacity-50",onClick:s,disabled:z.status==="SUBMITTED"||z.status==="APPROVED",children:"  "}),se&&n.jsxs(n.Fragment,{children:[n.jsx("button",{type:"button",className:"rounded-md bg-emerald-700 px-3 py-1.5 text-xs font-semibold text-white hover:bg-emerald-800 disabled:opacity-50",onClick:r,children:"  "}),n.jsx("button",{type:"button",className:"rounded-md bg-amber-700 px-3 py-1.5 text-xs font-semibold text-white hover:bg-amber-800",onClick:()=>F("INTERNAL"),children:" "}),l&&n.jsx("button",{type:"button",className:"rounded-md bg-slate-700 px-3 py-1.5 text-xs font-semibold text-white hover:bg-slate-800",onClick:()=>F("EXTERNAL"),children:"   "}),c&&e.status==="SENT"&&n.jsx("button",{type:"button",className:"rounded-md bg-red-700 px-3 py-1.5 text-xs font-semibold text-white hover:bg-red-800",onClick:c,children:"   ( )"}),c&&e.status!=="SENT"&&n.jsx("span",{className:"text-[11px] text-textMuted500",children:"       (SENT)."})]})]}),i&&n.jsx("div",{className:"fixed inset-0 z-[180] flex items-center justify-center bg-black/40",children:n.jsxs("div",{className:"w-full max-w-md rounded-xl bg-panel p-4 shadow-2xl",dir:"rtl",lang:"he",children:[n.jsx("h3",{className:"mb-3 text-sm font-bold text-textLight",children:"   "}),n.jsxs("div",{className:"mb-3 space-y-2",children:[n.jsxs("div",{children:[n.jsx("label",{className:"mb-1 block text-xs font-semibold text-textMuted700",children:"  ()"}),n.jsx("input",{type:"text",className:"w-full rounded-md border border-borderDark px-2 py-1.5 text-sm",value:p,onChange:M=>y(M.target.value)})]}),n.jsxs("div",{children:[n.jsx("label",{className:"mb-1 block text-xs font-semibold text-textMuted700",children:"  ()"}),n.jsx("textarea",{className:"w-full rounded-md border border-borderDark px-2 py-1.5 text-sm",rows:3,value:N,onChange:M=>w(M.target.value)})]}),n.jsxs("div",{children:[n.jsx("label",{className:"mb-1 block text-xs font-semibold text-textMuted700",children:" "}),n.jsxs("select",{className:"w-full rounded-md border border-borderDark px-2 py-1.5 text-xs",value:R,onChange:M=>E(M.target.value),children:[n.jsx("option",{value:"NORMAL",children:""}),n.jsx("option",{value:"CRITICAL",children:""}),n.jsx("option",{value:"STYLE",children:""})]})]}),h==="EXTERNAL"&&n.jsxs("div",{children:[n.jsx("label",{className:"mb-1 block text-xs font-semibold text-textMuted700",children:"    ()"}),n.jsx("input",{type:"text",className:"w-full rounded-md border border-borderDark px-2 py-1.5 text-sm",value:W,onChange:M=>b(M.target.value)}),n.jsx("label",{className:"mb-1 mt-3 block text-xs font-semibold text-textMuted700",children:" "}),n.jsxs("select",{className:"w-full rounded-md border border-borderDark px-2 py-1.5 text-xs",value:P,onChange:M=>U(M.target.value),children:[n.jsx("option",{value:"ENGLISH_ONLY",children:"  "}),n.jsx("option",{value:"REQUIRES_HEBREW",children:"  "})]})]})]}),n.jsxs("div",{className:"mt-4 flex justify-end gap-2",children:[n.jsx("button",{type:"button",className:"rounded-md border border-borderDark px-3 py-1.5 text-xs font-medium text-textMuted700 hover:bg-navySecondary",onClick:()=>u(!1),children:""}),n.jsx("button",{type:"button",className:"rounded-md bg-amber-700 px-3 py-1.5 text-xs font-semibold text-white hover:bg-amber-800 disabled:opacity-50",onClick:L,disabled:!p.trim()||!N.trim(),children:" "})]})]})})]})},So="REPLACE_WITH_GRAMMARLY_CLIENT_ID",Hu={[Ks]:"Statement of Claim",[Co]:"Letter of Demand",[Pu]:"Statement of Claim Expert Opinion",[Fu]:"Letter of Demand Expert Opinion","The plaintiff's expert opinion":"Plaintiff Expert Opinion","The claimant's expert opinion":"Claimant Expert Opinion","The insured's expert opinion":"Insured Expert Opinion","Insurance Coverage":"Insurance Coverage","Risk Assessment":"Risk Assessment",MPL:"MPL",Strategy:"Strategy","Expenses breakdown":"Expenses Breakdown","Expenses & Compensation breakdown":"Expenses & Compensation",Recommendations:"Recommendations","Strategy & Recommendations":"Strategy & Recommendations","Request for Approval of a Settlement Agreement":"Settlement Approval",Update:"Update"};fh.forEach(e=>{Hu[e]="Statement of Claim"});xh.forEach(e=>{Hu[e]="Letter of Demand"});const fb=e=>(Hu[e]||e||"").trim(),yh=e=>e.map(fb).filter(Boolean),Od=e=>{const t=new Set;return e.map(s=>s.trim()).filter(s=>{if(!s)return!1;const r=s.toLowerCase();return t.has(r)?!1:(t.add(r),!0)})},Uu=/[\\/:*?"<>|]/g,Ec=e=>(e||"").trim(),xb=e=>{const t=(e.filenameTag||"").toLowerCase(),s=(e.plaintiffTitle||"").toLowerCase();return t.includes("demand")||s==="claimant"},hb=e=>{var t;return(((t=e.reportHistory)==null?void 0:t.length)||0)+1},gb=120,yb=e=>{if(!e.length)return"";if(e.length===1)return e[0];if(e.length===2)return`${e[0]} & ${e[1]}`;const t=e.slice(0,-1),s=e[e.length-1];return`${t.join(", ")} & ${s}`},ur=e=>{const t=Ec(e.insurerName),s=Ec(e.insuredName),r=Ec(e.plaintiffName),a=hb(e);let o=[];const l=Array.isArray(e.fileNameTitles)?cn(e.fileNameTitles.map(R=>Xt(R))):[];l.length>0?o=Od(l):a===1?o=[xb(e)?"New Letter of demand":"New Lawsuit"]:(o=Od(yh(e.selectedSections||[])),o.length||(o=["Update"]));const c=yb(o),i=`Report ${a}`;let p=[t||void 0,s||void 0,r||void 0,c||void 0].filter(Boolean).join(" - ");if(p=p.replace(Uu," ").replace(/\s+/g," ").replace(/-+/g,"-").trim(),!p){const R=i;return R.toLowerCase().endsWith(".pdf")?R:`${R}.pdf`}const y=` - ${i}`,N=Math.max(0,gb-y.length);if(p.length>N){const R=p.slice(0,N),E=R.lastIndexOf(" ");p=(E>0?R.slice(0,E):R).trim()}let w=`${p}${y}`;return w=w.replace(/\s+/g," ").replace(/-+/g,"-").trim(),w||(w=`Report-${Date.now()}`),w.toLowerCase().endsWith(".pdf")?w:`${w}.pdf`},ni=e=>ur(e).replace(/\.pdf$/i,""),bh=e=>`fileNameTopics:${e||"default"}`,bb=["Update","Expenses","New Lawsuit","New Third Party Notice","New Letter of Demand","Risk Assessment","Strategy","Recommendation","Request for Settlement Approval","Judgment","Request to Reopen a Claim","Dismissal for Inaction"],Xt=e=>{const t=(e||"").trim();return t?t.replace(Uu," ").replace(/\s+/g," ").trim():""},si=e=>Xt(e).trim().toLowerCase(),cn=e=>{const t=new Set,s=[];for(const r of e){const a=Xt(r),o=si(a);o&&(t.has(o)||(t.add(o),s.push(a)))}return s},Nb=e=>{if(typeof window>"u")return[];try{const t=window.localStorage.getItem(bh(e));if(!t)return[];const s=JSON.parse(t);return Array.isArray(s)?cn(s.map(r=>typeof r=="string"?r:"").map(Xt)):[]}catch{return[]}},vb=(e,t)=>{if(!(typeof window>"u"))try{const s=cn(t.map(Xt)).filter(Boolean);window.localStorage.setItem(bh(e),JSON.stringify(s))}catch{}},Sb=(e,t,s=15)=>{const r=Xt(t),a=si(r);if(!a)return cn(e).slice(0,s);const o=(e||[]).filter(c=>si(c)!==a),l=[r,...o];return cn(l).slice(0,s)},Nh=e=>`topicCombos:${e||"default"}`,vh=e=>`insurerDefaultTopics:${e||"default"}`,Sh=e=>{if(!e)return null;try{return JSON.parse(e)}catch{return null}},Md=e=>{if(typeof window>"u")return[];const t=window.localStorage.getItem(Nh(e)),s=Sh(t);return Array.isArray(s)?s.filter(a=>Array.isArray(a)).map(a=>a.map(o=>Xt(o)).filter(Boolean)).filter(a=>a.length>0):[]},bp=(e,t)=>{if(typeof window>"u")return;const s=t.map(r=>cn(r.map(a=>Xt(a))).filter(Boolean)).filter(r=>r.length>0);try{window.localStorage.setItem(Nh(e),JSON.stringify(s))}catch{}},Np=e=>e.map(s=>si(s)).filter(Boolean).sort().join("|"),vp=(e,t,s=6)=>{const r=cn(t.map(c=>Xt(c))).filter(Boolean);if(!r.length)return e;const a=Np(r),o=[],l=new Set;o.push(r),l.add(a);for(const c of e){const i=Np(c);if(!l.has(i)&&(o.push(cn(c.map(u=>Xt(u))).filter(Boolean)),l.add(i),o.length>=s))break}return o.slice(0,s)},Wu=e=>(e||"").trim().toLowerCase(),zu=e=>{if(typeof window>"u")return{};const t=window.localStorage.getItem(vh(e)),s=Sh(t);if(!s||typeof s!="object")return{};const r={};for(const[a,o]of Object.entries(s)){if(!Array.isArray(o))continue;const l=cn(o.map(c=>Xt(c))).filter(Boolean).slice(0,8);l.length&&(r[a]=l)}return r},wh=(e,t)=>{if(typeof window>"u")return;const s={};for(const[r,a]of Object.entries(t)){const o=cn((a||[]).map(l=>Xt(l))).filter(Boolean).slice(0,8);o.length&&(s[r]=o)}try{window.localStorage.setItem(vh(e),JSON.stringify(s))}catch{}},wb=(e,t)=>{const s=zu(e),r=Wu(t);return s[r]||[]},jb=(e,t,s)=>{if(!t)return;const r=Wu(t),a=zu(e),o=cn(s.map(l=>Xt(l))).filter(Boolean).slice(0,8);o.length?a[r]=o:delete a[r],wh(e,a)},Eb=(e,t)=>{if(!t)return;const s=Wu(t),r=zu(e);r[s]&&(delete r[s],wh(e,r))},Sp=[{id:"general_update",label:"General Update",body:`Dear Sir/Madam,

Please find below our general update regarding the above-captioned matter.

Best regards,
Lior Perry, Adv.`},{id:"risk_assessment",label:"Risk Assessment",body:`Dear Sir/Madam,

Kindly review the following risk assessment prepared for the insurer.

Best regards,
Lior Perry, Adv.`},{id:"expert_opinion",label:"Expert Opinion",body:`Dear Sir/Madam,

Please find our expert opinion summary for your review and records.

Best regards,
Lior Perry, Adv.`},{id:"full_report",label:"Full Report Delivery",body:`Dear Sir/Madam,

Attached is the full report for the current update, including all relevant sections.

Best regards,
Lior Perry, Adv.`},{id:"zeev_new_demand",label:"Zeev  New demand letter",body:`Dear Zeev,

I've attached a report regarding a new demand letter.

Sincerely,
Lior`},{id:"zeev_claim_update",label:"Zeev  Claim update",body:`Dear Zeev,

I've attached a report on the claim in question.

Sincerely,
Lior`},{id:"zeev_new_lawsuit",label:"Zeev  New lawsuit",body:`Dear Zeev,

I've attached a report regarding a new lawsuit.

Sincerely,
Lior`},{id:"zeev_lawsuit_update",label:"Zeev  Lawsuit update",body:`Dear Zeev,

I've attached a report on the lawsuit in question.

Sincerely,
Lior`}],wp=e=>`emailTemplates:${e||"default"}`,kb=({isOpen:e,report:t,userId:s,isSending:r=!1,recipientsPreview:a,defaultSubject:o,subjectDraft:l,onSubjectDraftChange:c,selectedTopics:i,onSelectedTopicsChange:u,isResendMode:p,onClose:y,onSend:N})=>{const w=Sp[0],[R,E]=g.useState(w.id),[W,b]=g.useState(w.body),[h,S]=g.useState([]),[P,U]=g.useState([]),[z,q]=g.useState(l),[ee,G]=g.useState(""),[se,j]=g.useState(""),[F,L]=g.useState([]),[O,H]=g.useState([]),M=ne=>{if(typeof window>"u")return[];try{const C=localStorage.getItem(wp(ne));if(!C)return[];const re=JSON.parse(C);return Array.isArray(re)?re.filter(te=>typeof(te==null?void 0:te.id)=="string"&&typeof(te==null?void 0:te.label)=="string"&&typeof(te==null?void 0:te.body)=="string"):[]}catch{return[]}},I=ne=>{typeof window>"u"||localStorage.setItem(wp(s),JSON.stringify(ne))},D=g.useMemo(()=>[...Sp,...h],[h]),J=g.useMemo(()=>D.reduce((ne,C)=>(ne[C.id]=C,ne),{}),[D]);g.useEffect(()=>{if(!e)return;const ne=M(s);S(ne);const C=Nb(s);U(C),L(Md(s)),H(wb(s,t.insurerName)),q(l),j(""),G("")},[e,s,l,t.insurerName]),g.useEffect(()=>{if(!e)return;const ne=t.selectedEmailTemplate&&J[t.selectedEmailTemplate]?t.selectedEmailTemplate:w.id;E(ne),b(t.emailBodyDraft||J[ne].body)},[e,w.id,t.emailBodyDraft,t.selectedEmailTemplate,J]);const ue=ne=>{E(ne);const C=J[ne];C&&b(C.body)},ce=()=>{const ne=window.prompt("  ?");if(!ne)return;const C=ne.trim();if(!C)return;const re={id:`custom_${Date.now()}`,label:C,body:W},te=[...h,re];S(te),I(te),E(re.id)},le=g.useMemo(()=>cn([...P,...bb]),[P]),fe=g.useMemo(()=>{const ne=se.trim().toLowerCase();return ne?le.filter(C=>C.toLowerCase().includes(ne)):le},[le,se]),Ee=g.useMemo(()=>{if(!p)return null;const ne=typeof t.reportNumber=="number"&&t.reportNumber>0?`#${t.reportNumber}`:"",C=t.sentAt?new Date(t.sentAt).toLocaleDateString("en-GB",{day:"2-digit",month:"short",year:"numeric"}):"";return n.jsxs("div",{className:"mb-3 flex items-start gap-2 rounded-md border border-amber-300 bg-amber-50 px-3 py-2 text-[11px] text-amber-900",children:[n.jsx(qa,{className:"w-3 h-3 mt-[2px]"}),n.jsxs("div",{children:[n.jsxs("p",{className:"font-semibold",children:["    ",ne||"",C?`   ${C}`:"","."]}),n.jsx("p",{className:"mt-1",children:"   (resend)   ,    .       ."})]})]})},[p,t.reportNumber,t.sentAt]),ve=ne=>{const C=Xt(ne);if(!C)return;const re=C.toLowerCase(),te=i.some(pe=>pe.trim().toLowerCase()===re)?i.filter(pe=>pe.trim().toLowerCase()!==re):[...i,C];u(cn(te))},$e=()=>{const ne=Xt(ee);if(!ne)return;const C=Sb(P,ne,15);U(C),vb(s,C);const re=cn([...i,ne]);u(re),G("")},Ze=g.useMemo(()=>ur({...t,fileNameTitles:i}),[t,i]),Ye=!a.cc.some(ne=>ne.toLowerCase()!=="reports@lp-law.co.il"),ot=a.to[0]||"",X=a.to.length===1&&ot.toLowerCase()==="lidor@lp-law.co.il";return e?n.jsx("div",{className:"fixed inset-0 bg-black/50 z-[999] flex items-center justify-center p-4",children:n.jsxs("div",{className:"bg-panel rounded-2xl shadow-2xl w-full max-w-3xl max-h-[90vh] overflow-hidden flex flex-col",children:[n.jsxs("div",{className:"flex items-center justify-between border-b px-6 py-4",children:[n.jsxs("div",{className:"flex items-center gap-3",children:[n.jsx("h2",{className:"text-lg font-semibold text-gray-800",children:"Compose Email"}),X&&n.jsx("span",{className:"inline-flex items-center rounded-full bg-blue-50 px-2.5 py-0.5 text-[11px] font-semibold text-blue-800 border border-blue-200",children:"SANDBOX"})]}),n.jsx("button",{onClick:y,className:"text-gray-500 hover:text-gray-700",children:n.jsx(Ht,{className:"w-5 h-5"})})]}),n.jsxs("div",{className:"flex-1 overflow-y-auto px-6 py-4 space-y-4",children:[Ee,Ye&&n.jsxs("div",{className:"flex items-start gap-2 text-xs text-amber-800 bg-amber-50 border border-amber-200 rounded-md px-3 py-2",children:[n.jsx(qa,{className:"w-3.5 h-3.5 mt-[1px]"}),n.jsx("p",{children:"         .       (To)   CC."})]}),X&&n.jsxs("div",{className:"flex items-start gap-2 text-xs text-blue-800 bg-blue-50 border border-blue-200 rounded-md px-3 py-2",children:[n.jsx(qa,{className:"w-3.5 h-3.5 mt-[1px]"}),n.jsx("p",{children:" :         ,    ."})]}),n.jsxs("div",{className:"text-xs text-gray-600 space-y-1 border rounded-md border-gray-200 bg-gray-50 px-3 py-2",children:[n.jsxs("div",{className:"flex items-center justify-between",children:[n.jsx("span",{className:"font-semibold",children:"To:"})," ",n.jsx("span",{children:a.to.join("; ")||""})]}),a.cc.length>0&&n.jsxs("div",{className:"flex items-center justify-between",children:[n.jsx("span",{className:"font-semibold",children:"CC:"})," ",n.jsx("span",{children:a.cc.join("; ")})]}),n.jsxs("p",{className:"text-[11px] text-gray-500 mt-1",children:["To: ",ot||""," (primary), CC: Office + report owner ( )."]}),n.jsxs("div",{children:[n.jsx("span",{className:"font-semibold",children:"Subject:"})," ",z||"(will be generated from case data)"]}),n.jsxs("div",{children:[n.jsx("span",{className:"font-semibold",children:"Attachment:"})," ",Ze]}),n.jsx("p",{className:"text-[11px] text-amber-700 mt-1",children:" :       ,        -PDF ."})]}),n.jsxs("div",{children:[n.jsxs("div",{className:"flex items-center justify-between mb-1",children:[n.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Subject"}),n.jsx("button",{type:"button",onClick:()=>{q(o),c(void 0)},className:"text-[11px] text-blue-700 hover:underline disabled:opacity-50",disabled:r,children:"Reset"})]}),n.jsx("input",{type:"text",value:z,onChange:ne=>{const C=ne.target.value;q(C),c(C)},className:"w-full border rounded-md p-2 text-sm",disabled:r})]}),n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Template"}),n.jsxs("div",{className:"flex gap-3",children:[n.jsx("select",{value:R,onChange:ne=>ue(ne.target.value),className:"flex-1 border rounded-md p-2",children:D.map(ne=>n.jsx("option",{value:ne.id,children:ne.label},ne.id))}),n.jsx("button",{type:"button",onClick:ce,className:"px-3 py-2 bg-panel border rounded-md text-sm font-medium text-gray-700 hover:bg-gray-100",disabled:r,children:"Save Template"})]})]}),n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"PDF Filename Topics"}),F.length>0&&n.jsxs("div",{className:"mb-2",children:[n.jsx("p",{className:"text-[11px] font-semibold text-gray-700 mb-1",children:"Recent combinations"}),n.jsx("div",{className:"flex flex-wrap gap-2",children:F.map((ne,C)=>n.jsx("button",{type:"button",onClick:()=>u(ne),className:"inline-flex items-center gap-1 rounded-full bg-gray-100 px-3 py-1 text-[11px] text-gray-800 border border-gray-300 hover:bg-gray-200",children:ne.join(" + ")},C))})]}),n.jsx("div",{className:"flex flex-wrap gap-2 mb-2",children:i.length===0?n.jsx("span",{className:"text-xs text-gray-400",children:"No topics selected yet. You can choose from the list below or add your own."}):i.map(ne=>n.jsxs("button",{type:"button",onClick:()=>ve(ne),className:"inline-flex items-center gap-1 rounded-full bg-blue-50 px-3 py-1 text-xs text-blue-800 border border-blue-200 hover:bg-blue-100",children:[n.jsx("span",{children:ne}),n.jsx("span",{className:"text-[10px]",children:""})]},ne))}),n.jsx("button",{type:"button",onClick:()=>{u([]),j("")},className:"mb-2 text-[11px] text-blue-700 hover:underline",disabled:r,children:"  "}),n.jsx("div",{className:"flex items-center gap-2 mb-2",children:n.jsx("input",{type:"text",value:se,onChange:ne=>j(ne.target.value),placeholder:"  ...",className:"flex-1 border rounded-md p-1.5 text-[11px]",disabled:r})}),n.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-1 mb-2 max-h-32 overflow-y-auto border rounded-md p-2 bg-panel",children:fe.map(ne=>{const C=`topic-${ne}`,re=ne.toLowerCase(),te=i.some(pe=>pe.trim().toLowerCase()===re);return n.jsxs("label",{htmlFor:C,className:"flex items-center gap-1 text-xs text-gray-700 cursor-pointer",children:[n.jsx("input",{id:C,type:"checkbox",className:"h-3 w-3",checked:te,onChange:()=>ve(ne),disabled:r}),n.jsx("span",{className:"whitespace-normal break-words",children:ne})]},ne)})}),n.jsxs("div",{className:"flex gap-2 mt-1",children:[n.jsx("input",{type:"text",value:ee,onChange:ne=>G(ne.target.value),placeholder:"Add custom topic",className:"flex-1 border rounded-md p-2 text-xs",disabled:r}),n.jsx("button",{type:"button",onClick:$e,className:"px-3 py-1.5 bg-panel border rounded-md text-xs font-medium text-gray-700 hover:bg-gray-100 disabled:opacity-50",disabled:r,children:"Add"})]}),n.jsxs("div",{className:"mt-3 space-y-1 text-[11px] text-gray-700",children:[n.jsxs("div",{className:"flex gap-2 flex-wrap items-center",children:[n.jsx("button",{type:"button",onClick:()=>{const ne=cn(i.map(C=>Xt(C)));ne.length&&(jb(s,t.insurerName,ne),H(ne))},className:"px-2 py-1 rounded-full border border-gray-300 bg-panel hover:bg-gray-100",disabled:r||i.length===0,children:"     "}),O.length>0&&n.jsxs(n.Fragment,{children:[n.jsx("button",{type:"button",onClick:()=>u(O),className:"px-2 py-1 rounded-full border border-blue-300 bg-blue-50 text-blue-800 hover:bg-blue-100 disabled:opacity-50",disabled:r,children:"     "}),n.jsx("button",{type:"button",onClick:()=>{Eb(s,t.insurerName),H([])},className:"text-[11px] text-red-600 hover:underline",disabled:r,children:"    "})]})]}),O.length>0&&i.length===0&&n.jsx("p",{className:"text-[11px] text-gray-500",children:"     .       ."})]})]}),n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Email Body"}),n.jsx(go,{clientId:So,children:n.jsx("textarea",{value:W,onChange:ne=>b(ne.target.value),rows:12,dir:"ltr",className:"w-full border rounded-md p-3 text-sm",style:{direction:"ltr",textAlign:"left",unicodeBidi:"plaintext"}})})]}),n.jsxs("div",{className:"border-t pt-4 text-right",children:[n.jsx("p",{className:"text-sm font-semibold text-gray-600 mb-2",children:"Signature"}),n.jsxs("div",{className:"inline-flex flex-col items-end",children:[n.jsx("img",{src:"/assets/branding/signature.png",alt:"Signature placeholder",className:"h-16 object-contain mb-2 opacity-80",onError:ne=>{ne.currentTarget.style.display="none"}}),n.jsx("span",{className:"text-sm text-gray-700 font-semibold",children:"Adv. Lior Perry"})]})]})]}),n.jsxs("div",{className:"flex justify-end gap-3 border-t px-6 py-4 bg-gray-50",children:[n.jsx("button",{onClick:y,className:"px-4 py-2 rounded-md text-gray-600 hover:bg-gray-200",disabled:r,children:"Cancel"}),n.jsx("button",{onClick:()=>N({body:W,templateId:R,subjectBase:z.trim(),topics:cn(i.map(ne=>Xt(ne)))}),className:"px-5 py-2 rounded-md bg-lpBlue text-white font-semibold hover:bg-blue-900 disabled:opacity-60 disabled:cursor-not-allowed",disabled:r,children:r?"Sending":"Send Email"})]})]})}):null},Ab=({isOpen:e,availableTitles:t,selectedTitles:s,onClose:r,onSave:a})=>{const o=g.useMemo(()=>N=>{const w=new Set,R=[];return N.forEach(E=>{const W=t.find(b=>b.label===E&&!w.has(b.id));W&&(R.push(W.id),w.add(W.id))}),R},[t]),l=g.useCallback(()=>{const N=o(s);return N.length?N:t.map(w=>w.id)},[o,s,t]),[c,i]=g.useState(l);if(g.useEffect(()=>{e&&i(l())},[e,l]),!e)return null;const u=N=>{i(w=>w.includes(N)?w.filter(R=>R!==N):[...w,N])},p=()=>{i(t.map(N=>N.id))},y=()=>{const N=c.map(w=>{var R;return(R=t.find(E=>E.id===w))==null?void 0:R.label}).filter(Boolean);a(N)};return n.jsx("div",{className:"fixed inset-0 bg-black/40 z-[900] flex items-center justify-center p-4",children:n.jsxs("div",{className:"bg-panel rounded-2xl shadow-2xl w-full max-w-md max-h-[90vh] overflow-hidden flex flex-col",children:[n.jsxs("div",{className:"flex items-center justify-between px-5 py-3 border-b bg-navySecondary50",children:[n.jsx("h3",{className:"text-lg font-semibold text-gray-800",children:"Select File Name Titles"}),n.jsx("button",{onClick:r,className:"text-gray-500 hover:text-gray-800",children:n.jsx(Ht,{className:"w-5 h-5"})})]}),n.jsxs("div",{className:"flex-1 overflow-y-auto p-5 space-y-3",children:[t.length===0&&n.jsx("p",{className:"text-sm text-gray-500",children:"No sections available to include."}),t.map(N=>n.jsxs("label",{className:"flex items-center gap-3 border rounded-lg px-3 py-2 text-sm",children:[n.jsx("input",{type:"checkbox",className:"h-4 w-4 text-lpBlue",checked:c.includes(N.id),onChange:()=>u(N.id)}),n.jsx("span",{className:"text-gray-800",children:N.label||"[Untitled Section]"})]},N.id)),t.length>0&&n.jsx("button",{type:"button",className:"text-xs text-lpBlue hover:underline",onClick:p,children:"Select All"})]}),n.jsxs("div",{className:"flex justify-end gap-3 border-t px-5 py-4 bg-navySecondary50",children:[n.jsx("button",{onClick:r,className:"px-4 py-2 text-gray-600 hover:bg-navySecondary200 rounded-md",children:"Cancel"}),n.jsx("button",{onClick:y,className:"px-5 py-2 bg-lpBlue text-white rounded-md font-semibold hover:bg-blue-900",children:"Save"})]})]})})},Se=e=>(e||"").replace(/\u00A0/g," ").replace(/\s+/g,"").trim();var fa=1e9,Ib={precision:20,rounding:4,toExpNeg:-7,toExpPos:21,LN10:"2.302585092994045684017991454684364207601101488628772976033327900967572609677352480235997205089598298341967784042286"},Ku,kt=!0,Hn="[DecimalError] ",gr=Hn+"Invalid argument: ",Vu=Hn+"Exponent out of range: ",xa=Math.floor,dr=Math.pow,Tb=/^(\d+(\.\d*)?|\.\d+)(e[+-]?\d+)?$/i,En,zt=1e7,wt=7,jh=9007199254740991,ri=xa(jh/wt),Ae={};Ae.absoluteValue=Ae.abs=function(){var e=new this.constructor(this);return e.s&&(e.s=1),e};Ae.comparedTo=Ae.cmp=function(e){var t,s,r,a,o=this;if(e=new o.constructor(e),o.s!==e.s)return o.s||-e.s;if(o.e!==e.e)return o.e>e.e^o.s<0?1:-1;for(r=o.d.length,a=e.d.length,t=0,s=r<a?r:a;t<s;++t)if(o.d[t]!==e.d[t])return o.d[t]>e.d[t]^o.s<0?1:-1;return r===a?0:r>a^o.s<0?1:-1};Ae.decimalPlaces=Ae.dp=function(){var e=this,t=e.d.length-1,s=(t-e.e)*wt;if(t=e.d[t],t)for(;t%10==0;t/=10)s--;return s<0?0:s};Ae.dividedBy=Ae.div=function(e){return Es(this,new this.constructor(e))};Ae.dividedToIntegerBy=Ae.idiv=function(e){var t=this,s=t.constructor;return gt(Es(t,new s(e),0,1),s.precision)};Ae.equals=Ae.eq=function(e){return!this.cmp(e)};Ae.exponent=function(){return Pt(this)};Ae.greaterThan=Ae.gt=function(e){return this.cmp(e)>0};Ae.greaterThanOrEqualTo=Ae.gte=function(e){return this.cmp(e)>=0};Ae.isInteger=Ae.isint=function(){return this.e>this.d.length-2};Ae.isNegative=Ae.isneg=function(){return this.s<0};Ae.isPositive=Ae.ispos=function(){return this.s>0};Ae.isZero=function(){return this.s===0};Ae.lessThan=Ae.lt=function(e){return this.cmp(e)<0};Ae.lessThanOrEqualTo=Ae.lte=function(e){return this.cmp(e)<1};Ae.logarithm=Ae.log=function(e){var t,s=this,r=s.constructor,a=r.precision,o=a+5;if(e===void 0)e=new r(10);else if(e=new r(e),e.s<1||e.eq(En))throw Error(Hn+"NaN");if(s.s<1)throw Error(Hn+(s.s?"NaN":"-Infinity"));return s.eq(En)?new r(0):(kt=!1,t=Es(wo(s,o),wo(e,o),o),kt=!0,gt(t,a))};Ae.minus=Ae.sub=function(e){var t=this;return e=new t.constructor(e),t.s==e.s?Ah(t,e):Eh(t,(e.s=-e.s,e))};Ae.modulo=Ae.mod=function(e){var t,s=this,r=s.constructor,a=r.precision;if(e=new r(e),!e.s)throw Error(Hn+"NaN");return s.s?(kt=!1,t=Es(s,e,0,1).times(e),kt=!0,s.minus(t)):gt(new r(s),a)};Ae.naturalExponential=Ae.exp=function(){return kh(this)};Ae.naturalLogarithm=Ae.ln=function(){return wo(this)};Ae.negated=Ae.neg=function(){var e=new this.constructor(this);return e.s=-e.s||0,e};Ae.plus=Ae.add=function(e){var t=this;return e=new t.constructor(e),t.s==e.s?Eh(t,e):Ah(t,(e.s=-e.s,e))};Ae.precision=Ae.sd=function(e){var t,s,r,a=this;if(e!==void 0&&e!==!!e&&e!==1&&e!==0)throw Error(gr+e);if(t=Pt(a)+1,r=a.d.length-1,s=r*wt+1,r=a.d[r],r){for(;r%10==0;r/=10)s--;for(r=a.d[0];r>=10;r/=10)s++}return e&&t>s?t:s};Ae.squareRoot=Ae.sqrt=function(){var e,t,s,r,a,o,l,c=this,i=c.constructor;if(c.s<1){if(!c.s)return new i(0);throw Error(Hn+"NaN")}for(e=Pt(c),kt=!1,a=Math.sqrt(+c),a==0||a==1/0?(t=cs(c.d),(t.length+e)%2==0&&(t+="0"),a=Math.sqrt(t),e=xa((e+1)/2)-(e<0||e%2),a==1/0?t="5e"+e:(t=a.toExponential(),t=t.slice(0,t.indexOf("e")+1)+e),r=new i(t)):r=new i(a.toString()),s=i.precision,a=l=s+3;;)if(o=r,r=o.plus(Es(c,o,l+2)).times(.5),cs(o.d).slice(0,l)===(t=cs(r.d)).slice(0,l)){if(t=t.slice(l-3,l+1),a==l&&t=="4999"){if(gt(o,s+1,0),o.times(o).eq(c)){r=o;break}}else if(t!="9999")break;l+=4}return kt=!0,gt(r,s)};Ae.times=Ae.mul=function(e){var t,s,r,a,o,l,c,i,u,p=this,y=p.constructor,N=p.d,w=(e=new y(e)).d;if(!p.s||!e.s)return new y(0);for(e.s*=p.s,s=p.e+e.e,i=N.length,u=w.length,i<u&&(o=N,N=w,w=o,l=i,i=u,u=l),o=[],l=i+u,r=l;r--;)o.push(0);for(r=u;--r>=0;){for(t=0,a=i+r;a>r;)c=o[a]+w[r]*N[a-r-1]+t,o[a--]=c%zt|0,t=c/zt|0;o[a]=(o[a]+t)%zt|0}for(;!o[--l];)o.pop();return t?++s:o.shift(),e.d=o,e.e=s,kt?gt(e,y.precision):e};Ae.toDecimalPlaces=Ae.todp=function(e,t){var s=this,r=s.constructor;return s=new r(s),e===void 0?s:(ps(e,0,fa),t===void 0?t=r.rounding:ps(t,0,8),gt(s,e+Pt(s)+1,t))};Ae.toExponential=function(e,t){var s,r=this,a=r.constructor;return e===void 0?s=wr(r,!0):(ps(e,0,fa),t===void 0?t=a.rounding:ps(t,0,8),r=gt(new a(r),e+1,t),s=wr(r,!0,e+1)),s};Ae.toFixed=function(e,t){var s,r,a=this,o=a.constructor;return e===void 0?wr(a):(ps(e,0,fa),t===void 0?t=o.rounding:ps(t,0,8),r=gt(new o(a),e+Pt(a)+1,t),s=wr(r.abs(),!1,e+Pt(r)+1),a.isneg()&&!a.isZero()?"-"+s:s)};Ae.toInteger=Ae.toint=function(){var e=this,t=e.constructor;return gt(new t(e),Pt(e)+1,t.rounding)};Ae.toNumber=function(){return+this};Ae.toPower=Ae.pow=function(e){var t,s,r,a,o,l,c=this,i=c.constructor,u=12,p=+(e=new i(e));if(!e.s)return new i(En);if(c=new i(c),!c.s){if(e.s<1)throw Error(Hn+"Infinity");return c}if(c.eq(En))return c;if(r=i.precision,e.eq(En))return gt(c,r);if(t=e.e,s=e.d.length-1,l=t>=s,o=c.s,l){if((s=p<0?-p:p)<=jh){for(a=new i(En),t=Math.ceil(r/wt+4),kt=!1;s%2&&(a=a.times(c),Ep(a.d,t)),s=xa(s/2),s!==0;)c=c.times(c),Ep(c.d,t);return kt=!0,e.s<0?new i(En).div(a):gt(a,r)}}else if(o<0)throw Error(Hn+"NaN");return o=o<0&&e.d[Math.max(t,s)]&1?-1:1,c.s=1,kt=!1,a=e.times(wo(c,r+u)),kt=!0,a=kh(a),a.s=o,a};Ae.toPrecision=function(e,t){var s,r,a=this,o=a.constructor;return e===void 0?(s=Pt(a),r=wr(a,s<=o.toExpNeg||s>=o.toExpPos)):(ps(e,1,fa),t===void 0?t=o.rounding:ps(t,0,8),a=gt(new o(a),e,t),s=Pt(a),r=wr(a,e<=s||s<=o.toExpNeg,e)),r};Ae.toSignificantDigits=Ae.tosd=function(e,t){var s=this,r=s.constructor;return e===void 0?(e=r.precision,t=r.rounding):(ps(e,1,fa),t===void 0?t=r.rounding:ps(t,0,8)),gt(new r(s),e,t)};Ae.toString=Ae.valueOf=Ae.val=Ae.toJSON=Ae[Symbol.for("nodejs.util.inspect.custom")]=function(){var e=this,t=Pt(e),s=e.constructor;return wr(e,t<=s.toExpNeg||t>=s.toExpPos)};function Eh(e,t){var s,r,a,o,l,c,i,u,p=e.constructor,y=p.precision;if(!e.s||!t.s)return t.s||(t=new p(e)),kt?gt(t,y):t;if(i=e.d,u=t.d,l=e.e,a=t.e,i=i.slice(),o=l-a,o){for(o<0?(r=i,o=-o,c=u.length):(r=u,a=l,c=i.length),l=Math.ceil(y/wt),c=l>c?l+1:c+1,o>c&&(o=c,r.length=1),r.reverse();o--;)r.push(0);r.reverse()}for(c=i.length,o=u.length,c-o<0&&(o=c,r=u,u=i,i=r),s=0;o;)s=(i[--o]=i[o]+u[o]+s)/zt|0,i[o]%=zt;for(s&&(i.unshift(s),++a),c=i.length;i[--c]==0;)i.pop();return t.d=i,t.e=a,kt?gt(t,y):t}function ps(e,t,s){if(e!==~~e||e<t||e>s)throw Error(gr+e)}function cs(e){var t,s,r,a=e.length-1,o="",l=e[0];if(a>0){for(o+=l,t=1;t<a;t++)r=e[t]+"",s=wt-r.length,s&&(o+=Bs(s)),o+=r;l=e[t],r=l+"",s=wt-r.length,s&&(o+=Bs(s))}else if(l===0)return"0";for(;l%10===0;)l/=10;return o+l}var Es=function(){function e(r,a){var o,l=0,c=r.length;for(r=r.slice();c--;)o=r[c]*a+l,r[c]=o%zt|0,l=o/zt|0;return l&&r.unshift(l),r}function t(r,a,o,l){var c,i;if(o!=l)i=o>l?1:-1;else for(c=i=0;c<o;c++)if(r[c]!=a[c]){i=r[c]>a[c]?1:-1;break}return i}function s(r,a,o){for(var l=0;o--;)r[o]-=l,l=r[o]<a[o]?1:0,r[o]=l*zt+r[o]-a[o];for(;!r[0]&&r.length>1;)r.shift()}return function(r,a,o,l){var c,i,u,p,y,N,w,R,E,W,b,h,S,P,U,z,q,ee,G=r.constructor,se=r.s==a.s?1:-1,j=r.d,F=a.d;if(!r.s)return new G(r);if(!a.s)throw Error(Hn+"Division by zero");for(i=r.e-a.e,q=F.length,U=j.length,w=new G(se),R=w.d=[],u=0;F[u]==(j[u]||0);)++u;if(F[u]>(j[u]||0)&&--i,o==null?h=o=G.precision:l?h=o+(Pt(r)-Pt(a))+1:h=o,h<0)return new G(0);if(h=h/wt+2|0,u=0,q==1)for(p=0,F=F[0],h++;(u<U||p)&&h--;u++)S=p*zt+(j[u]||0),R[u]=S/F|0,p=S%F|0;else{for(p=zt/(F[0]+1)|0,p>1&&(F=e(F,p),j=e(j,p),q=F.length,U=j.length),P=q,E=j.slice(0,q),W=E.length;W<q;)E[W++]=0;ee=F.slice(),ee.unshift(0),z=F[0],F[1]>=zt/2&&++z;do p=0,c=t(F,E,q,W),c<0?(b=E[0],q!=W&&(b=b*zt+(E[1]||0)),p=b/z|0,p>1?(p>=zt&&(p=zt-1),y=e(F,p),N=y.length,W=E.length,c=t(y,E,N,W),c==1&&(p--,s(y,q<N?ee:F,N))):(p==0&&(c=p=1),y=F.slice()),N=y.length,N<W&&y.unshift(0),s(E,y,W),c==-1&&(W=E.length,c=t(F,E,q,W),c<1&&(p++,s(E,q<W?ee:F,W))),W=E.length):c===0&&(p++,E=[0]),R[u++]=p,c&&E[0]?E[W++]=j[P]||0:(E=[j[P]],W=1);while((P++<U||E[0]!==void 0)&&h--)}return R[0]||R.shift(),w.e=i,gt(w,l?o+Pt(w)+1:o)}}();function kh(e,t){var s,r,a,o,l,c,i=0,u=0,p=e.constructor,y=p.precision;if(Pt(e)>16)throw Error(Vu+Pt(e));if(!e.s)return new p(En);for(kt=!1,c=y,l=new p(.03125);e.abs().gte(.1);)e=e.times(l),u+=5;for(r=Math.log(dr(2,u))/Math.LN10*2+5|0,c+=r,s=a=o=new p(En),p.precision=c;;){if(a=gt(a.times(e),c),s=s.times(++i),l=o.plus(Es(a,s,c)),cs(l.d).slice(0,c)===cs(o.d).slice(0,c)){for(;u--;)o=gt(o.times(o),c);return p.precision=y,t==null?(kt=!0,gt(o,y)):o}o=l}}function Pt(e){for(var t=e.e*wt,s=e.d[0];s>=10;s/=10)t++;return t}function kc(e,t,s){if(t>e.LN10.sd())throw kt=!0,s&&(e.precision=s),Error(Hn+"LN10 precision limit exceeded");return gt(new e(e.LN10),t)}function Bs(e){for(var t="";e--;)t+="0";return t}function wo(e,t){var s,r,a,o,l,c,i,u,p,y=1,N=10,w=e,R=w.d,E=w.constructor,W=E.precision;if(w.s<1)throw Error(Hn+(w.s?"NaN":"-Infinity"));if(w.eq(En))return new E(0);if(t==null?(kt=!1,u=W):u=t,w.eq(10))return t==null&&(kt=!0),kc(E,u);if(u+=N,E.precision=u,s=cs(R),r=s.charAt(0),o=Pt(w),Math.abs(o)<15e14){for(;r<7&&r!=1||r==1&&s.charAt(1)>3;)w=w.times(e),s=cs(w.d),r=s.charAt(0),y++;o=Pt(w),r>1?(w=new E("0."+s),o++):w=new E(r+"."+s.slice(1))}else return i=kc(E,u+2,W).times(o+""),w=wo(new E(r+"."+s.slice(1)),u-N).plus(i),E.precision=W,t==null?(kt=!0,gt(w,W)):w;for(c=l=w=Es(w.minus(En),w.plus(En),u),p=gt(w.times(w),u),a=3;;){if(l=gt(l.times(p),u),i=c.plus(Es(l,new E(a),u)),cs(i.d).slice(0,u)===cs(c.d).slice(0,u))return c=c.times(2),o!==0&&(c=c.plus(kc(E,u+2,W).times(o+""))),c=Es(c,new E(y),u),E.precision=W,t==null?(kt=!0,gt(c,W)):c;c=i,a+=2}}function jp(e,t){var s,r,a;for((s=t.indexOf("."))>-1&&(t=t.replace(".","")),(r=t.search(/e/i))>0?(s<0&&(s=r),s+=+t.slice(r+1),t=t.substring(0,r)):s<0&&(s=t.length),r=0;t.charCodeAt(r)===48;)++r;for(a=t.length;t.charCodeAt(a-1)===48;)--a;if(t=t.slice(r,a),t){if(a-=r,s=s-r-1,e.e=xa(s/wt),e.d=[],r=(s+1)%wt,s<0&&(r+=wt),r<a){for(r&&e.d.push(+t.slice(0,r)),a-=wt;r<a;)e.d.push(+t.slice(r,r+=wt));t=t.slice(r),r=wt-t.length}else r-=a;for(;r--;)t+="0";if(e.d.push(+t),kt&&(e.e>ri||e.e<-ri))throw Error(Vu+s)}else e.s=0,e.e=0,e.d=[0];return e}function gt(e,t,s){var r,a,o,l,c,i,u,p,y=e.d;for(l=1,o=y[0];o>=10;o/=10)l++;if(r=t-l,r<0)r+=wt,a=t,u=y[p=0];else{if(p=Math.ceil((r+1)/wt),o=y.length,p>=o)return e;for(u=o=y[p],l=1;o>=10;o/=10)l++;r%=wt,a=r-wt+l}if(s!==void 0&&(o=dr(10,l-a-1),c=u/o%10|0,i=t<0||y[p+1]!==void 0||u%o,i=s<4?(c||i)&&(s==0||s==(e.s<0?3:2)):c>5||c==5&&(s==4||i||s==6&&(r>0?a>0?u/dr(10,l-a):0:y[p-1])%10&1||s==(e.s<0?8:7))),t<1||!y[0])return i?(o=Pt(e),y.length=1,t=t-o-1,y[0]=dr(10,(wt-t%wt)%wt),e.e=xa(-t/wt)||0):(y.length=1,y[0]=e.e=e.s=0),e;if(r==0?(y.length=p,o=1,p--):(y.length=p+1,o=dr(10,wt-r),y[p]=a>0?(u/dr(10,l-a)%dr(10,a)|0)*o:0),i)for(;;)if(p==0){(y[0]+=o)==zt&&(y[0]=1,++e.e);break}else{if(y[p]+=o,y[p]!=zt)break;y[p--]=0,o=1}for(r=y.length;y[--r]===0;)y.pop();if(kt&&(e.e>ri||e.e<-ri))throw Error(Vu+Pt(e));return e}function Ah(e,t){var s,r,a,o,l,c,i,u,p,y,N=e.constructor,w=N.precision;if(!e.s||!t.s)return t.s?t.s=-t.s:t=new N(e),kt?gt(t,w):t;if(i=e.d,y=t.d,r=t.e,u=e.e,i=i.slice(),l=u-r,l){for(p=l<0,p?(s=i,l=-l,c=y.length):(s=y,r=u,c=i.length),a=Math.max(Math.ceil(w/wt),c)+2,l>a&&(l=a,s.length=1),s.reverse(),a=l;a--;)s.push(0);s.reverse()}else{for(a=i.length,c=y.length,p=a<c,p&&(c=a),a=0;a<c;a++)if(i[a]!=y[a]){p=i[a]<y[a];break}l=0}for(p&&(s=i,i=y,y=s,t.s=-t.s),c=i.length,a=y.length-c;a>0;--a)i[c++]=0;for(a=y.length;a>l;){if(i[--a]<y[a]){for(o=a;o&&i[--o]===0;)i[o]=zt-1;--i[o],i[a]+=zt}i[a]-=y[a]}for(;i[--c]===0;)i.pop();for(;i[0]===0;i.shift())--r;return i[0]?(t.d=i,t.e=r,kt?gt(t,w):t):new N(0)}function wr(e,t,s){var r,a=Pt(e),o=cs(e.d),l=o.length;return t?(s&&(r=s-l)>0?o=o.charAt(0)+"."+o.slice(1)+Bs(r):l>1&&(o=o.charAt(0)+"."+o.slice(1)),o=o+(a<0?"e":"e+")+a):a<0?(o="0."+Bs(-a-1)+o,s&&(r=s-l)>0&&(o+=Bs(r))):a>=l?(o+=Bs(a+1-l),s&&(r=s-a-1)>0&&(o=o+"."+Bs(r))):((r=a+1)<l&&(o=o.slice(0,r)+"."+o.slice(r)),s&&(r=s-l)>0&&(a+1===l&&(o+="."),o+=Bs(r))),e.s<0?"-"+o:o}function Ep(e,t){if(e.length>t)return e.length=t,!0}function Ih(e){var t,s,r;function a(o){var l=this;if(!(l instanceof a))return new a(o);if(l.constructor=a,o instanceof a){l.s=o.s,l.e=o.e,l.d=(o=o.d)?o.slice():o;return}if(typeof o=="number"){if(o*0!==0)throw Error(gr+o);if(o>0)l.s=1;else if(o<0)o=-o,l.s=-1;else{l.s=0,l.e=0,l.d=[0];return}if(o===~~o&&o<1e7){l.e=0,l.d=[o];return}return jp(l,o.toString())}else if(typeof o!="string")throw Error(gr+o);if(o.charCodeAt(0)===45?(o=o.slice(1),l.s=-1):l.s=1,Tb.test(o))jp(l,o);else throw Error(gr+o)}if(a.prototype=Ae,a.ROUND_UP=0,a.ROUND_DOWN=1,a.ROUND_CEIL=2,a.ROUND_FLOOR=3,a.ROUND_HALF_UP=4,a.ROUND_HALF_DOWN=5,a.ROUND_HALF_EVEN=6,a.ROUND_HALF_CEIL=7,a.ROUND_HALF_FLOOR=8,a.clone=Ih,a.config=a.set=Rb,e===void 0&&(e={}),e)for(r=["precision","rounding","toExpNeg","toExpPos","LN10"],t=0;t<r.length;)e.hasOwnProperty(s=r[t++])||(e[s]=this[s]);return a.config(e),a}function Rb(e){if(!e||typeof e!="object")throw Error(Hn+"Object expected");var t,s,r,a=["precision",1,fa,"rounding",0,8,"toExpNeg",-1/0,0,"toExpPos",0,1/0];for(t=0;t<a.length;t+=3)if((r=e[s=a[t]])!==void 0)if(xa(r)===r&&r>=a[t+1]&&r<=a[t+2])this[s]=r;else throw Error(gr+s+": "+r);if((r=e[s="LN10"])!==void 0)if(r==Math.LN10)this[s]=new this(r);else throw Error(gr+s+": "+r);return this}var Ku=Ih(Ib);En=new Ku(1);const bs=Ku;bs.set({precision:20,rounding:bs.ROUND_HALF_UP});const Jn=e=>new bs(e??0),Ns=e=>e.toDecimalPlaces(2).toNumber(),Th=(e,t)=>{const s=Jn(e),r=Jn(t);return Ns(s.mul(r))},Rh=(e,t)=>{const s=Jn(e),r=Jn(t).div(100);return Ns(s.mul(r))},Ch=(e,t)=>{const s=Jn(e),r=Jn(t);return Ns(s.add(r))},Ac=e=>{if(e.lineTotalAmount!=null)return Jn(e.lineTotalAmount);const t=e.lineNetAmount!=null?e.lineNetAmount:Th(e.quantity??0,e.unitPrice??0),s=e.lineVatAmount!=null?e.lineVatAmount:Rh(t,e.vatRate??0);return Jn(Ch(t,s))},Fn=(e,t)=>{const s=t.reduce((w,R)=>w.add(Ac(R)),new bs(0)),r=t.reduce((w,R)=>R.isIncludedInRequestedAmount===!1?w:w.add(Ac(R)),new bs(0)),a=t.reduce((w,R)=>R.lineVatAmount==null?w:w.add(Jn(R.lineVatAmount)),new bs(0)),l=t.filter(w=>(w.kind==="ADJUSTMENT"||w.kind==="COMPENSATION")&&w.isIncludedInRequestedAmount===!1).reduce((w,R)=>w.add(Ac(R)),new bs(0)),c=Jn(e.deductibleAmount??0),i=Jn(e.alreadyPaidAmount??0),u=c.add(i).add(l),p=r.sub(u),y=!!e.infoOnly,N=y?new bs(0):p.greaterThan(0)?p:new bs(0);return{grossExpensesTotal:Ns(s),includedExpensesTotal:Ns(r),vatTotal:Ns(a),adjustmentsTotal:Ns(u),amountBeforeInfoOnly:Ns(p),amountToRequest:Ns(N),infoOnlyApplied:y}},Dh="financial_expenses_store_v1",dl=()=>({sheets:{},lineItems:{},attachments:{},auditEvents:{},insurerRulesets:{},exceptionAnnotations:{},payments:{},officialSheetIdByCaseId:{}}),Cb=e=>{let t=e.officialSheetIdByCaseId;if(t&&Object.keys(t).length>0)return e;t={};const s=Object.values(e.sheets),r=new Map;return s.forEach(a=>{const o=Se(a.caseId);if(!o)return;const l=r.get(o),c=new Date(a.updatedAt||a.createdAt).getTime();(!l||new Date(l.updatedAt||l.createdAt).getTime()<c)&&r.set(o,a)}),r.forEach((a,o)=>{t[o]=a.id}),{...e,officialSheetIdByCaseId:t}},Nt=()=>{if(typeof window>"u")return dl();try{const e=window.localStorage.getItem(Dh);if(!e)return dl();const t=JSON.parse(e);if(!t||typeof t!="object")return dl();let s={sheets:t.sheets||{},lineItems:t.lineItems||{},attachments:t.attachments||{},auditEvents:t.auditEvents||{},insurerRulesets:t.insurerRulesets||{},exceptionAnnotations:t.exceptionAnnotations||{},payments:t.payments||{},officialSheetIdByCaseId:t.officialSheetIdByCaseId||{}};return s=Cb(s),(!t.officialSheetIdByCaseId||Object.keys(t.officialSheetIdByCaseId||{}).length===0)&&Object.keys(s.officialSheetIdByCaseId||{}).length>0&&un(s),s}catch(e){return console.error("Failed to load financial expenses store",e),dl()}},un=e=>{if(!(typeof window>"u"))try{window.localStorage.setItem(Dh,JSON.stringify(e))}catch(t){console.error("Failed to persist financial expenses store",t)}},Db=e=>{let t=0;for(let s=0;s<e.length;s++)t=(t<<5)-t+e.charCodeAt(s),t|=0;return Math.abs(t).toString(16)},Lb=(e,t,s)=>{const r={sheet:e,lineItems:t.map(a=>({id:a.id,sheetId:a.sheetId,kind:a.kind,expenseType:a.expenseType,providerName:a.providerName,description:a.description,date:a.date,quantity:a.quantity,unitPrice:a.unitPrice,vatRate:a.vatRate,isIncludedInRequestedAmount:a.isIncludedInRequestedAmount,lineNetAmount:a.lineNetAmount,lineVatAmount:a.lineVatAmount,lineTotalAmount:a.lineTotalAmount,attachmentId:a.attachmentId})),attachments:s.map(a=>({id:a.id,sheetId:a.sheetId,fileKey:a.fileKey,originalFileName:a.originalFileName,mimeType:a.mimeType,sizeBytes:a.sizeBytes,linkedLineItemId:a.linkedLineItemId}))};return Db(JSON.stringify(r))},wn=()=>new Date().toISOString(),ha=e=>`${e}_${Math.random().toString(36).slice(2,10)}_${Date.now().toString(36)}`,jo=(e,t)=>{const s=Object.values(e.lineItems).filter(a=>a.sheetId===t),r=Object.values(e.attachments).filter(a=>a.sheetId===t);return{lineItems:s,attachments:r}},_b=e=>{const t=Nt(),s=Se(e);return Object.values(t.payments).filter(r=>!r.isDeleted&&Se(r.caseId)===s).sort((r,a)=>{const o=new Date(r.paidAt).getTime(),l=new Date(a.paidAt).getTime();return o-l})},Ob=e=>{let t=Nt();const s=ha("fpay"),r=wn(),a={id:s,caseId:Se(e.caseId),sheetId:e.sheetId??null,amount:e.amount,paidAt:e.paidAt,reference:e.reference??null,note:e.note??null,isDeleted:!1,createdAt:r,updatedAt:r};return t={...t,payments:{...t.payments,[s]:a}},un(t),a},Mb=e=>{let t=Nt();const s=t.payments[e];if(!s)return null;const r={...s,isDeleted:!0,updatedAt:wn()};return t={...t,payments:{...t.payments,[e]:r}},un(t),r},kp=(e,t,s)=>{const r=Nt(),a=Se(e);if(!a)return s??0;const o=t?new Date(t).getTime():Date.now();if(Number.isNaN(o))return s??0;let l=0,c=!1;return Object.values(r.payments).forEach(i=>{if(i.isDeleted||Se(i.caseId)!==a)return;c=!0;const u=new Date(i.paidAt).getTime();if(Number.isNaN(u)||u>o)return;const p=Number(i.amount)||0;p<=0||(l+=p)}),c?l:s??0},Pb=e=>Nt().insurerRulesets[e]||null,Ic=()=>{const e=Nt();return Object.values(e.sheets).sort((t,s)=>{const r=new Date(t.updatedAt||t.createdAt).getTime();return new Date(s.updatedAt||s.createdAt).getTime()-r})},Fb=(e,t,s,r)=>{let a=Nt();a.sheets[e]&&(a=Zn(a,e,t,s,"SHEET_DELETED_BY_ADMIN","SHEET",e,{reason:r.trim()}),un(a))},Bb=(e,t,s,r)=>{let a=Nt();a.sheets[e]&&(a=Zn(a,e,t,s,"ADMIN_EDIT_AFTER_PAID","SHEET",e,{reason:r.trim()}),un(a))},Xa=e=>{var a;const t=Nt(),s=Se(e);if(!s)return null;const r=(a=t.officialSheetIdByCaseId)==null?void 0:a[s];return!r||!t.sheets[r]?null:r},ul=e=>{const t=Nt(),s=t.sheets[e];if(!s)return null;const{lineItems:r,attachments:a}=jo(t,e);return{sheet:s,lineItems:r,attachments:a}},Cs=(e,t)=>{const s=e.sheets[t];if(!s)return e;const{lineItems:r,attachments:a}=jo(e,t),o={...s,sheetVersionNumber:s.sheetVersionNumber+1,sheetVersionHash:Lb(s,r,a),updatedAt:wn()};return{...e,sheets:{...e.sheets,[t]:o}}},Zn=(e,t,s,r,a,o,l,c)=>{const i=e.sheets[t];if(!i)return e;const u=ha("fae"),p={id:u,sheetId:t,actorUserId:s,actorRole:r,eventType:a,eventAt:wn(),entityType:o,entityId:l??null,diffJson:c,sheetVersionNumberAtEvent:i.sheetVersionNumber,sheetVersionHashAtEvent:i.sheetVersionHash};return{...e,auditEvents:{...e.auditEvents,[u]:p}}},$b=e=>{const t=Nt(),s=ha("fes"),r=wn(),a={id:s,caseId:e.caseId,insurerId:e.insurerId??null,insurerName:e.insurerName??null,periodStart:e.periodStart??null,periodEnd:e.periodEnd??null,periodLabel:e.periodLabel??null,versionIndex:e.versionIndex,status:"DRAFT",archivedReason:null,currency:e.currency||"ILS",deductibleAmount:e.deductibleAmount??null,alreadyPaidAmount:e.alreadyPaidAmount??null,infoOnly:!!e.infoOnly,attachedToReportId:null,attachedAt:null,createdByUserId:e.createdByUserId,createdAt:r,updatedAt:r,readyAt:null,sheetVersionNumber:1,sheetVersionHash:"",insurerRulesetId:e.insurerRulesetId??null,insurerRulesetVersion:e.insurerRulesetVersion??null};let o={...t,sheets:{...t.sheets,[s]:a}};const l=Se(e.caseId);return l&&(o={...o,officialSheetIdByCaseId:{...o.officialSheetIdByCaseId||{},[l]:s}}),o=Cs(o,s),o=Zn(o,s,e.createdByUserId,"FINANCE","SHEET_CREATED","SHEET",s,{caseId:e.caseId,insurerId:e.insurerId??null,insurerName:e.insurerName??null}),un(o),o.sheets[s]},Hb=e=>{let t=Nt();const s=t.sheets[e];if(!s)return console.warn("deleteFinancialExpenseSheet: sheet not found",e),t;const r={...t.sheets};delete r[e];const a={};Object.values(t.lineItems).forEach(i=>{i.sheetId!==e&&(a[i.id]=i)});const o={};Object.values(t.attachments).forEach(i=>{i.sheetId!==e&&(o[i.id]=i)});let l={...t.officialSheetIdByCaseId||{}};const c=Se(s.caseId);if(c&&l[c]===e){const i=Object.values(r).filter(u=>Se(u.caseId)===c).sort((u,p)=>{const y=new Date(u.updatedAt||u.createdAt).getTime();return new Date(p.updatedAt||p.createdAt).getTime()-y});i.length>0?l[c]=i[0].id:delete l[c]}return t={...t,sheets:r,lineItems:a,attachments:o,officialSheetIdByCaseId:l},un(t),t},Ub=e=>{let t=Nt();const s=t.sheets[e.sheetId];if(!s)return console.warn("updateFinancialExpenseSheetMeta: sheet not found",e.sheetId),null;const r={...s,...e.patch,updatedAt:wn()};t={...t,sheets:{...t.sheets,[e.sheetId]:r}};const a={};return Object.keys(e.patch).forEach(o=>{const l=s[o],c=r[o];l!==c&&(a[o]={before:l,after:c})}),t=Cs(t,e.sheetId),t=Zn(t,e.sheetId,e.actorUserId,e.actorRole,"SHEET_META_UPDATED","SHEET",e.sheetId,Object.keys(a).length?a:void 0),un(t),t.sheets[e.sheetId]},Wb=e=>{let t=Nt();if(!t.sheets[e.sheetId])return console.warn("addFinancialExpenseLineItem: sheet not found",e.sheetId),null;const s=ha("fli"),r=wn(),a={id:s,sheetId:e.sheetId,kind:e.kind,expenseType:e.expenseType??null,providerName:e.providerName??null,providerId:e.providerId??null,description:e.description,date:e.date??null,quantity:e.quantity??null,unitPrice:e.unitPrice??null,vatRate:e.vatRate??null,isIncludedInRequestedAmount:e.isIncludedInRequestedAmount??!0,lineNetAmount:e.lineNetAmount??null,lineVatAmount:e.lineVatAmount??null,lineTotalAmount:e.lineTotalAmount??null,attachmentId:e.attachmentId??null,createdAt:r,updatedAt:r};return t={...t,lineItems:{...t.lineItems,[s]:a}},t=Cs(t,e.sheetId),t=Zn(t,e.sheetId,e.actorUserId,e.actorRole,"LINE_ITEM_CREATED","LINE_ITEM",s,{kind:e.kind,description:e.description,amount:e.lineTotalAmount??null}),un(t),a},zb=e=>{let t=Nt();const s=t.lineItems[e.lineItemId];if(!s||s.sheetId!==e.sheetId)return console.warn("updateFinancialExpenseLineItem: line item not found",e.lineItemId),null;const r={...s,...e.patch,updatedAt:wn()};t={...t,lineItems:{...t.lineItems,[e.lineItemId]:r}};const a={};return Object.keys(e.patch).forEach(o=>{const l=s[o],c=r[o];l!==c&&(a[o]={before:l,after:c})}),t=Cs(t,e.sheetId),t=Zn(t,e.sheetId,e.actorUserId,e.actorRole,"LINE_ITEM_UPDATED","LINE_ITEM",e.lineItemId,Object.keys(a).length?a:void 0),un(t),t.lineItems[e.lineItemId]},Vb=e=>{let t=Nt();const s=t.lineItems[e.lineItemId];if(!s||s.sheetId!==e.sheetId)return console.warn("deleteFinancialExpenseLineItem: line item not found",e.lineItemId),!1;const{[e.lineItemId]:r,...a}=t.lineItems;return t={...t,lineItems:a},t=Cs(t,e.sheetId),t=Zn(t,e.sheetId,e.actorUserId,e.actorRole,"LINE_ITEM_DELETED","LINE_ITEM",e.lineItemId,{deleted:r}),un(t),!0},Kb=e=>{let t=Nt();if(!t.sheets[e.sheetId])return console.warn("addFinancialExpenseAttachment: sheet not found",e.sheetId),null;const s=ha("fat"),r=wn(),a={id:s,sheetId:e.sheetId,fileKey:e.fileKey,originalFileName:e.originalFileName,mimeType:e.mimeType??null,sizeBytes:e.sizeBytes??null,uploadedByUserId:e.uploadedByUserId,uploadedAt:r,linkedLineItemId:e.linkedLineItemId??null};return t={...t,attachments:{...t.attachments,[s]:a}},t=Cs(t,e.sheetId),t=Zn(t,e.sheetId,e.uploadedByUserId,"FINANCE","ATTACHMENT_ADDED","ATTACHMENT",s,{fileKey:e.fileKey,originalFileName:e.originalFileName}),un(t),a},Yb=e=>{let t=Nt();const s=t.attachments[e.attachmentId];if(!s||s.sheetId!==e.sheetId)return console.warn("linkAttachmentToLineItem: attachment not found",e.attachmentId),null;const r=s.linkedLineItemId??null,a={...s,linkedLineItemId:e.lineItemId};if(t={...t,attachments:{...t.attachments,[e.attachmentId]:a}},e.lineItemId){const o=t.lineItems[e.lineItemId];o&&(t={...t,lineItems:{...t.lineItems,[e.lineItemId]:{...o,attachmentId:e.attachmentId,updatedAt:wn()}}})}else if(r){const o=t.lineItems[r];o&&o.attachmentId===e.attachmentId&&(t={...t,lineItems:{...t.lineItems,[r]:{...o,attachmentId:null,updatedAt:wn()}}})}return t=Cs(t,e.sheetId),t=Zn(t,e.sheetId,e.actorUserId,e.actorRole,"ATTACHMENT_LINKED","ATTACHMENT",e.attachmentId,{before:r,after:e.lineItemId}),un(t),t.attachments[e.attachmentId]},Gb=e=>{let t=Nt();const s=t.sheets[e.sheetId];if(!s)return console.warn("recordSheetReadyAttempt: sheet not found",e.sheetId),null;let r=s;if(e.success){const a=wn();r={...s,status:"READY_FOR_REPORT",readyAt:a,updatedAt:a,insurerRulesetId:e.decisionLog.rulesetId??s.insurerRulesetId??null,insurerRulesetVersion:e.decisionLog.rulesetVersion??s.insurerRulesetVersion??null},t={...t,sheets:{...t.sheets,[e.sheetId]:r}},t=Cs(t,e.sheetId)}return t=Zn(t,e.sheetId,e.actorUserId,e.actorRole,"SHEET_READY_ATTEMPT","SHEET",e.sheetId,{success:e.success,decisionLog:e.decisionLog}),un(t),t.sheets[e.sheetId]},qb=e=>{let t=Nt();const s=t.sheets[e.sheetId];if(!s||s.status!=="READY_FOR_REPORT")return s||null;const r=wn(),a={...s,status:"DRAFT",readyAt:null,updatedAt:r};return t={...t,sheets:{...t.sheets,[e.sheetId]:a}},t=Cs(t,e.sheetId),t=Zn(t,e.sheetId,e.actorUserId,e.actorRole,"SHEET_REVERTED_TO_DRAFT","SHEET",e.sheetId,{from:"READY_FOR_REPORT",to:"DRAFT"}),un(t),t.sheets[e.sheetId]},Xb=(e,t)=>{const s=Nt(),r=Object.values(s.sheets),a=new Map;t.forEach(c=>{a.set(c.id,c)});const o=r.map(c=>{var E,W;const{lineItems:i}=jo(s,c.id),u=Fn(c,i),p=c.attachedToReportId?a.get(c.attachedToReportId):void 0,y=Object.values(s.auditEvents).filter(b=>b.sheetId===c.id&&b.diffJson&&b.diffJson.decisionLog);y.sort((b,h)=>new Date(h.eventAt).getTime()-new Date(b.eventAt).getTime());const N=((W=(E=y[0])==null?void 0:E.diffJson)==null?void 0:W.decisionLog)||null,w=N!=null&&N.blockingIssueCodes&&Array.isArray(N.blockingIssueCodes)?N.blockingIssueCodes:void 0,R=(p==null?void 0:p.expensesSheetId)===c.id?!!p.expensesOutOfSync:!1;return{sheetId:c.id,caseId:c.caseId,insurerName:c.insurerName??null,status:c.status,versionIndex:c.versionIndex,updatedAt:c.updatedAt,readyAt:c.readyAt??null,attachedAt:c.attachedAt??null,sentAt:(p==null?void 0:p.sentAt)||null,amountToRequest:u.amountToRequest,infoOnly:c.infoOnly,expensesOutOfSync:R,blockingIssueCodesLatest:w}}),l=c=>{if(!c)return!1;const i=new Date(c).getTime();return!(Number.isNaN(i)||e.dateFrom&&i<new Date(e.dateFrom).getTime()||e.dateTo&&i>new Date(e.dateTo).getTime())};return o.filter(c=>{var i,u;if(e.status&&c.status!==e.status||e.insurerId&&((i=s.sheets[c.sheetId])==null?void 0:i.insurerId)!==e.insurerId||e.insurerName&&!(c.insurerName||"").toLowerCase().includes(e.insurerName.toLowerCase()))return!1;if(e.caseIdOrSearch){const p=e.caseIdOrSearch.toLowerCase();if(!`${c.caseId} ${c.insurerName||""}`.toLowerCase().includes(p))return!1}return!(e.isInfoOnly!=null&&c.infoOnly!==e.isInfoOnly||e.minAmountToRequest!=null&&c.amountToRequest<e.minAmountToRequest||e.maxAmountToRequest!=null&&c.amountToRequest>e.maxAmountToRequest||(e.dateFrom||e.dateTo)&&!l(c.updatedAt)||e.hasMissingAttachments&&!((u=c.blockingIssueCodesLatest)!=null&&u.includes("MISSING_ATTACHMENT_REQUIRED")))}).sort((c,i)=>new Date(i.updatedAt).getTime()-new Date(c.updatedAt).getTime())},Jb=e=>{const t=Nt(),s=Object.values(t.sheets),r=new Map;e.forEach(i=>{r.set(i.id,i)});let a=0,o=0,l=0,c=0;return s.forEach(i=>{i.status==="READY_FOR_REPORT"&&(a+=1),i.status==="ATTACHED_TO_REPORT"&&(o+=1);const u=i.attachedToReportId?r.get(i.attachedToReportId):void 0;(u==null?void 0:u.status)==="SENT"&&(l+=1);const p=(u==null?void 0:u.expensesSheetId)===i.id&&u.expensesOutOfSync===!0,y=Object.values(t.auditEvents).some(N=>{var w;return N.sheetId===i.id&&N.eventType==="SHEET_READY_ATTEMPT"&&((w=N.diffJson)==null?void 0:w.success)===!1});(p||y)&&(c+=1)}),{readyCount:a,attachedCount:o,sentCount:l,exceptionsCount:c}},Tc=(e,t)=>{if(!e||!t)return null;const s=new Date(e).getTime(),r=new Date(t).getTime();return Number.isNaN(s)||Number.isNaN(r)?null:(r-s)/(1e3*60*60)},Rc=e=>e.length?e.reduce((s,r)=>s+r,0)/e.length:null,Cc=e=>{if(!e.length)return null;const t=[...e].sort((r,a)=>r-a),s=Math.floor(t.length/2);return t.length%2===0?(t[s-1]+t[s])/2:t[s]},ml=(e,t=5)=>({count:e.length,samples:e.slice(0,t)}),Qb=e=>{let t=Nt();const s=ha("fexa"),r=wn(),a={id:s,sheetId:e.sheetId,noteType:"EXCEPTION_STATUS",value:e.value,actorUserId:e.actorUserId,createdAt:r};return t={...t,exceptionAnnotations:{...t.exceptionAnnotations,[s]:a}},un(t),a},Zb=e=>{const t=Nt(),s=Object.values(t.exceptionAnnotations).filter(r=>r.sheetId===e&&r.noteType==="EXCEPTION_STATUS");return s.length?(s.sort((r,a)=>new Date(a.createdAt).getTime()-new Date(r.createdAt).getTime()),s[0].value):null},eN=e=>{const t=Nt(),s=Object.values(t.sheets),r=new Map;e.forEach(G=>{r.set(G.id,G)});const a=[],o=[],l=[];let c=0,i=0;const u=[],p=[],y=[],N=[],w=3,R=3,E=Date.now(),W=new Map;Object.values(t.auditEvents).forEach(G=>{const se=W.get(G.sheetId)||[];se.push(G),W.set(G.sheetId,se)});const b=[];s.forEach(G=>{const{lineItems:se}=jo(t,G.id),j=Fn(G,se);if(c+=j.amountToRequest,G.infoOnly&&(i+=1),G.createdAt&&G.readyAt){const L=Tc(G.createdAt,G.readyAt);L!=null&&a.push(L)}if(G.readyAt&&G.attachedAt){const L=Tc(G.readyAt,G.attachedAt);L!=null&&o.push(L)}const F=G.attachedToReportId?r.get(G.attachedToReportId):void 0;if(G.attachedAt&&(F!=null&&F.sentAt)){const L=Tc(G.attachedAt,F.sentAt);L!=null&&l.push(L)}j.amountToRequest>0&&b.push(j.amountToRequest)});let h=0;if(b.length>=5){const G=[...b].sort((j,F)=>j-F),se=Math.floor(G.length*.95)-1;h=G[Math.max(0,se)]}else b.length>0&&(h=Math.max(...b));s.forEach(G=>{var ue,ce;const{lineItems:se}=jo(t,G.id),j=Fn(G,se),F=G.attachedToReportId?r.get(G.attachedToReportId):void 0,L=W.get(G.id)||[],O=L.filter(le=>le.diffJson&&le.diffJson.decisionLog);O.sort((le,fe)=>new Date(fe.eventAt).getTime()-new Date(le.eventAt).getTime());const H=((ce=(ue=O[0])==null?void 0:ue.diffJson)==null?void 0:ce.decisionLog)||null,M=H!=null&&H.blockingIssueCodes&&Array.isArray(H.blockingIssueCodes)?H.blockingIssueCodes:[];if((F==null?void 0:F.expensesSheetId)===G.id&&F.expensesOutOfSync===!0){const le=new Date(G.updatedAt||G.createdAt).getTime();Number.isNaN(le)||(E-le)/864e5>=w&&u.push({sheetId:G.id,caseId:G.caseId,reason:"DIVERGENCE_OLD",updatedAt:G.updatedAt})}(G.status==="READY_FOR_REPORT"||G.status==="ATTACHED_TO_REPORT")&&M.includes("MISSING_ATTACHMENT_REQUIRED")&&j.amountToRequest>0&&p.push({sheetId:G.id,caseId:G.caseId,reason:"MISSING_ATTACHMENTS",updatedAt:G.updatedAt}),h>0&&j.amountToRequest>=h&&y.push({sheetId:G.id,caseId:G.caseId,reason:"HIGH_AMOUNT",updatedAt:G.updatedAt,amountToRequest:j.amountToRequest});const J=L.filter(le=>{var fe;return le.eventType==="SHEET_READY_ATTEMPT"&&((fe=le.diffJson)==null?void 0:fe.success)===!1}).length;J>=R&&N.push({sheetId:G.id,caseId:G.caseId,reason:"REPEATED_BLOCKS",failedAttempts:J,updatedAt:G.updatedAt})});const S=s.length,P=s.filter(G=>{const se=G.attachedToReportId?r.get(G.attachedToReportId):void 0;return(se==null?void 0:se.status)==="SENT"}).length,U=S>0?Number((i/S).toFixed(3)):null,z={draftToReadyAvgHours:Rc(a),draftToReadyMedianHours:Cc(a),readyToAttachedAvgHours:Rc(o),readyToAttachedMedianHours:Cc(o),attachedToSentAvgHours:Rc(l),attachedToSentMedianHours:Cc(l)},q={totalSheets:S,totalSentReports:P,totalAmountRequested:c,infoOnlyRatio:U},ee={divergenceOld:ml(u),missingAttachments:ml(p),highAmounts:{threshold:h,...ml(y)},repeatedBlocks:{threshold:R,...ml(N)}};return{sla:z,volumes:q,exceptions:ee}},tN=(e,t=10)=>{const s=Nt();return Object.values(s.auditEvents).filter(r=>r.sheetId===e).sort((r,a)=>new Date(a.eventAt).getTime()-new Date(r.eventAt).getTime()).slice(0,t)},nN=5e3,Dc=new Map,La=e=>({actorUserId:e.id,actorRole:e.role}),Xe={async listSheets(){return Ic()},async listPaymentsForCase(e){return _b(e)},getPaidToDateForSheet(e){const t=e.updatedAt||e.createdAt||new Date().toISOString();return kp(e.caseId,t,e.alreadyPaidAmount??0)},async getLatestSheetForCase(e){const t=Xa(e);return t?ul(t):null},async isNewFinancialModel(e){if(!e)return!1;const t=await Ic(),s=Se(e);return t.some(r=>Se(r.caseId)===s)},logIfMixedModel(e){if(!!!e.expensesSheetId)return;(e.expensesItems&&e.expensesItems.length>0||!!e.expenseWorksheet||!!e.expensesSum)&&console.error("[FinancialExpenses] Mixed model detected for report",e.id," expensesSheetId is set but legacy expenses fields are also populated.")},async getSheet(e){return ul(e)},async getRulesetForSheet(e){const t=e.insurerRulesetId||e.insurerId||"default",s=Pb(t);if(s)return s;const r=new Date().toISOString();return{insurerId:t,policyFamily:"FLEXIBLE",requiredAttachmentTypes:[],requireAttachmentPerLine:!1,requireAttachmentForExpenseTypes:[],amountThresholdRequiringAttachment:null,infoOnlyTextVariant:null,notesInternal:null,rulesetVersion:"default",updatedAt:r}},async createSheet(e,t){const s={...t,createdByUserId:e.id};return $b(s)},async createPaymentEvent(e,t){return Ob(t)},async updateSheetMeta(e,t,s){const r={sheetId:t,...La(e),patch:s};return Ub(r)},async addLineItem(e,t,s){const r={...s,sheetId:t,...La(e)};return Wb(r)},async updateLineItem(e,t,s,r){const a={sheetId:t,lineItemId:s,...La(e),patch:r};return zb(a)},async deleteLineItem(e,t,s){const r={sheetId:t,lineItemId:s,...La(e)};return Vb(r)},async softDeletePaymentEvent(e){return Mb(e)},buildCumulativeExpensesSnapshot(e,t){const s=`${e}::${t||"now"}`,r=Dc.get(s),a=Date.now();if(r&&a-r.ts<nN)return r.value;const o=ul(e);if(!o)return Dc.set(s,{ts:a,value:null}),null;const l=o.sheet,c=t||l.updatedAt||l.createdAt||new Date().toISOString(),i=kp(l.caseId,c,l.alreadyPaidAmount??0),u={...l,alreadyPaidAmount:i},p=Ic(),y=Se(l.caseId),N=new Date(c).getTime(),w=p.filter(P=>{if(P.id===l.id||Se(P.caseId)!==y)return!1;const U=new Date(P.updatedAt||P.createdAt).getTime();return Number.isNaN(U)||Number.isNaN(N)?!0:U<=N}),R=[];w.forEach(P=>{const U=ul(P.id);U&&U.lineItems.forEach(z=>{z.kind==="EXPENSE"&&R.push(z)})});const E=o.lineItems,b=[...[...R,...E]].sort((P,U)=>{const z=j=>{const F=j.date?new Date(j.date).getTime():NaN;if(!Number.isNaN(F))return F;const L=j.createdAt?new Date(j.createdAt).getTime():NaN;return Number.isNaN(L)?0:L},q=z(P),ee=z(U);if(q!==ee)return q-ee;const G=`${P.sheetId||""}-${P.id}`,se=`${U.sheetId||""}-${U.id}`;return G.localeCompare(se)}),S={effectiveSheet:u,currentLines:E,historicalLines:R,allLines:b,opts:{isNewLine:P=>P.kind==="EXPENSE"&&P.sheetId===l.id,isHistoricalLine:P=>P.kind==="EXPENSE"&&P.sheetId!==l.id}};return Dc.set(s,{ts:a,value:S}),S},async deleteSheet(e){Hb(e)},async addAttachment(e,t,s){const r={...s,sheetId:t,uploadedByUserId:e.id};return Kb(r)},async linkAttachmentToLineItem(e,t,s,r){const a={sheetId:t,attachmentId:s,lineItemId:r,...La(e)};return Yb(a)},async recordReadyAttempt(e,t){const s={...t,actorUserId:e.id,actorRole:e.role};return Gb(s)},async revertSheetToDraft(e,t){return qb({sheetId:t,actorUserId:e.id,actorRole:e.role})},recordAdminEditAfterPaid(e,t,s){Bb(t,e.id,e.role,s)},recordSheetDeletionByAdmin(e,t,s){Fb(t,e.id,e.role,s)},async listSheetsForLidor(e,t,s){if(e.role!=="ADMIN"&&e.role!=="SUB_ADMIN")throw new Error("Access denied: only ADMIN or SUB_ADMIN can view financial control data.");return Xb(t,s)},async getLidorCounts(e,t){if(e.role!=="ADMIN"&&e.role!=="SUB_ADMIN")throw new Error("Access denied: only ADMIN or SUB_ADMIN can view financial control data.");return Jb(t)},async getLidorKpis(e,t){if(e.role!=="ADMIN"&&e.role!=="SUB_ADMIN")throw new Error("Access denied: only ADMIN or SUB_ADMIN can view financial control data.");return eN(t)},async getExceptionStatusForSheet(e,t){if(e.role!=="ADMIN"&&e.role!=="SUB_ADMIN")throw new Error("Access denied: only ADMIN or SUB_ADMIN can view financial control data.");return Zb(t)},async setExceptionStatusForSheet(e,t,s){if(e.role!=="ADMIN"&&e.role!=="SUB_ADMIN")throw new Error("Access denied: only ADMIN or SUB_ADMIN can view financial control data.");return Qb({sheetId:t,value:s,actorUserId:e.id})},async getSheetAuditForLidor(e,t,s=10){if(e.role!=="ADMIN"&&e.role!=="SUB_ADMIN")throw new Error("Access denied: only ADMIN or SUB_ADMIN can view financial control data.");return tN(t,s)}},sN={dashboardTitle:" ",brandName:"Lior Perry",brandSubtitle:"  ",welcomeBack:" ",roleLawyer:"",gettingStartedTitle:" ",gettingStartedBodyLine1:"  .",gettingStartedBodyLine2:"   .          .",gettingStartedStep1:"  ",gettingStartedStep2:" ",gettingStartedStep3:"  ",gettingStartedCta:"  ",searchSectionLabel:" ",searchLabel:" ",searchPlaceholder:"  , ,     ...",statusLabel:"",sortByLabel:" ",sortByUpdated:" ",sortByReportDate:" ",sortByInsured:"",onlyMyCases:"  ",clearFilters:" ",searchByOdakanit:"    ",searchOdakanitPlaceholder:"    ...",noCaseFolderFound:"       .",statsSectionLabel:"  ",statsActiveCases:" ",statsActionRequired:"  ",statsWaitingOnOthers:" ",statsFinanceTasks:"  ",statsDraftsReady:" /  ",caseListTitle:"   ",caseListHeaderTitle:" ",caseListHeaderReportNo:"REPORT NO",caseListHeaderPlaintiff:"PLAINTIFF / CLAIMANT",caseListHeaderInsured:"INSURED",caseListHeaderInsurer:"INSURER",caseListHeaderOdakanit:"  ",caseListStatusAttention:"  ",caseListStatusOpen:"  ",caseListStatusNone:"  ",caseListEmpty:"   .",caseListHintActiveOnly:"(     )",financeBannerTitle:"    ",financeBannerBody:"      .         .",bucketActionRequiredTitle:"  ",bucketActionRequiredDescription:"    .",bucketWaitingTitle:" ",bucketWaitingDescription:"   ,     .",bucketInProgressTitle:"",bucketInProgressDescription:"   .",bucketSentTitle:" / ",bucketSentDescription:"     .",emptyActionRequiredTitle:"    ",emptyActionRequiredDesc:"    ,   .",emptyWaitingTitle:"   ",emptyWaitingDesc:"      .",emptyInProgressTitle:"  ",emptyInProgressDesc:"    .",emptySentTitle:"   ",emptySentDesc:"  ,     .",emptyInProgressCta:"  ",defaultEmptyTitle:"  ",defaultEmptyDescription:"     .",untitledCase:"  ",labelInsured:"",labelPlaintiff:"",labelInsurer:" ",labelFile:" ",labelUpdated:":",labelNextStep:" :",nextStepReview:"  ",nextStepWaitingInvoices:" ",nextStepReadyToSend:" ",nextStepDraft:"  ",nextStepSent:"",nextStepContinue:" ",openContinue:" / ",preview:" ",viewSections:"  ",deleteDraftConfirm:"   ?     .",deleteDraftAria:" ",deleteTitle:"",pin:" ",unpin:" ",alertTimeBreach:" ",alertResponseDelay:" ",openNotificationsAria:" ",openNotificationsTitle:"",openNewCaseFolderAria:"  ",openNewCaseFolderTitle:"  ",openHelpCenterAria:"  ",openHelpCenterTitle:" ",logoutAria:"",logoutTitle:"",workQueuesAria:"  ",expand:"",collapse:"",statusDraft:"",statusActionRequired:" ",statusWaitingInvoices:" ",statusPendingReview:" ",statusApproved:"",statusReadyToSend:" ",statusSent:"",densityLabel:" :",densityComfortable:"",densityCompact:"",resumeLastCase:"   ",resumeLabel:"",internalFile:" ",workloadTitle:"  ",workloadActionLabel:"  ",workloadWaitingLabel:"   ",workloadDraftLabel:" ",financeReportsTitle:" /    ",financeReportsHint:"           .",financeReportsHeaderOdakanit:" ",financeReportsHeaderInsured:"",financeReportsHeaderPlaintiff:"",financeReportsHeaderStatus:" ",financeReportsHeaderUpdated:" ",financeReportsEmpty:"     .",focusModeLabel:"    ",tagNewCase:" ",tagOngoingCase:" ",notificationTitle:" ",dailySummary:" ",noNotifications:"  .",clearAll:" ",footerArchiveNote:"      "},De=e=>sN[e],Lc=({label:e,value:t,icon:s,accentClass:r,selected:a,onClick:o})=>{const l=n.jsxs("div",{className:["flex items-center justify-between rounded-2xl border px-4 py-3 shadow-sm transition","focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-gold focus-visible:ring-offset-2",a?"border-gold bg-gold/10":"border-borderDark bg-panel hover:bg-navySecondary"].join(" "),children:[n.jsxs("div",{children:[n.jsx("p",{className:["text-[11px] uppercase tracking-wide",a?"font-bold text-textLight":"font-semibold text-textMuted"].join(" "),children:e}),n.jsx("p",{className:"mt-1 text-xl font-bold text-gray-900",children:t})]}),n.jsx("div",{className:["inline-flex h-9 w-9 items-center justify-center rounded-full",r].join(" "),"aria-hidden":"true",children:s})]});return o?n.jsx("button",{type:"button",onClick:o,className:"w-full text-left",children:l}):l},rN=({activeCases:e,actionRequired:t,waitingOnOthers:s,draftsAndReady:r,financeTasks:a,selectedFilter:o,onChangeFilter:l})=>{const c=i=>{l&&l(o===i?null:i)};return n.jsxs("section",{"aria-label":De("statsSectionLabel"),className:"mb-6 grid gap-4 grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-3 xl:grid-cols-3",children:[n.jsx(Lc,{label:De("statsFinanceTasks"),value:a,icon:n.jsx(M0,{className:"h-4 w-4 text-goldLight"}),accentClass:"bg-gold/20",selected:o==="FINANCE",onClick:()=>c("FINANCE")}),n.jsx(Lc,{label:De("statsWaitingOnOthers"),value:s,icon:n.jsx(_0,{className:"h-4 w-4 text-goldLight"}),accentClass:"bg-gold/20",selected:o==="WAITING",onClick:()=>c("WAITING")}),n.jsx(Lc,{label:De("statsDraftsReady"),value:r,icon:n.jsx(ti,{className:"h-4 w-4 text-goldLight"}),accentClass:"bg-gold/20",selected:o==="DRAFTS",onClick:()=>c("DRAFTS")})]})};De("statusDraft"),De("statusActionRequired"),De("statusWaitingInvoices"),De("statusPendingReview"),De("statusApproved"),De("statusReadyToSend"),De("statusSent");const _a=e=>(e||"").trim().toLowerCase(),_c=e=>{const t=(e.odakanitNo||"").trim();if(t)return`odakanit:${t}`;const s=[`umr:${_a(e.marketRef)}`,`line:${_a(e.lineSlipNo)}`,`cert:${_a(e.certificateRef)}`,`insured:${_a(e.insuredName)}`,`plaintiff:${_a(e.plaintiffName)}`].filter(r=>!r.endsWith(":"));return s.length?s.join("|"):`id:${e.id}`},aN=24*60*60*1e3,oN=e=>{const t=e.updatedAt||e.reportDate;if(!t)return null;const s=new Date(t).getTime();return Number.isFinite(s)?s:null},lN=e=>{const t=oN(e);return!t||(Date.now()-t)/aN<=3?null:e.status==="DRAFT"?De("alertResponseDelay"):e.status==="WAITING_FOR_INVOICES"||e.status==="READY_TO_SEND"?De("alertTimeBreach"):null},iN=e=>e.status==="TASK_ASSIGNED"||e.status==="PENDING_REVIEW"||e.status==="READY_TO_SEND",cN=({report:e})=>e.expensesSheetId?e.supersededByReportId?n.jsx("span",{className:"inline-flex items-center rounded-full bg-slate-100 px-1.5 py-0.5 text-[9px] font-semibold text-slate-700 border border-slate-200",title:"        ",children:""}):n.jsx("span",{className:"inline-flex items-center rounded-full bg-emerald-50 px-1.5 py-0.5 text-[9px] font-semibold text-emerald-800 border border-emerald-200",title:"      ",children:" ()"}):null,dN=De("brandName"),uN=De("brandSubtitle"),mN={DRAFT:De("statusDraft"),TASK_ASSIGNED:De("statusActionRequired"),WAITING_FOR_INVOICES:De("statusWaitingInvoices"),PENDING_REVIEW:De("statusPendingReview"),APPROVED:De("statusApproved"),READY_TO_SEND:De("statusReadyToSend"),SENT:De("statusSent")},Ap=e=>e==="TASK_ASSIGNED"||e==="PENDING_REVIEW"?"ACTION_REQUIRED":e==="WAITING_FOR_INVOICES"?"WAITING_ON_OTHERS":e==="READY_TO_SEND"?"IN_PROGRESS":e==="SENT"?"SENT_COMPLETED":"IN_PROGRESS",Oc=e=>`lp_pins:${e}`,pN=e=>`lp_dashboard_density:${e}`,fN="lp_current_report",Ip=e=>`lp_pins_migrated:${e}`,xN=({user:e,reports:t,caseFolders:s,notifications:r,showNotifications:a,setShowNotifications:o,onClearNotifications:l,dailySummaryOptIn:c,setDailySummaryOptIn:i,archiveAfterMs:u,onSelectReport:p,onNewReport:y,onOpenCaseFolder:N,onLogout:w,deleteReportById:R})=>{const[E,W]=g.useState(""),[b,h]=g.useState("ALL"),[S,P]=g.useState(!0),[U,z]=g.useState(null),[q,ee]=g.useState("UPDATED"),[G,se]=g.useState(()=>{if(typeof window>"u")return[];try{const Q=window.localStorage.getItem(Oc(e.id)),be=Q?JSON.parse(Q):[];return Array.isArray(be)?be.filter(xe=>typeof xe=="string"):[]}catch{return[]}}),[j,F]=g.useState(()=>{if(typeof window>"u")return"COMFORTABLE";try{return window.localStorage.getItem(pN(e.id))==="COMPACT"?"COMPACT":"COMFORTABLE"}catch{return"COMFORTABLE"}}),L=Date.now(),O=u??Number.MAX_SAFE_INTEGER,[H,M]=g.useState(!1),[I,D]=g.useState({}),J=g.useMemo(()=>r.filter(be=>!be.targetUserId||be.targetUserId===e.id).filter(be=>{if(!be.reportId)return!0;const xe=t.find(Ne=>Ne.id===be.reportId);return xe?xe.status!=="SENT":!0}),[r,e.id,t]),ue=g.useMemo(()=>J.filter(Q=>{if(!Q.reportId)return!1;const be=t.find(xe=>xe.id===Q.reportId);return!(!be||!be.expensesSheetId||be.status==="SENT")}).length,[J,t]),{mine:ce,buckets:le,filteredReports:fe}=g.useMemo(()=>{const Q=t.filter(Ue=>{if(Ue.deletedAt)return!1;const st=(Ue.odakanitNo||"").trim();if(!st)return!0;const Rt=s[st];return!(Rt&&Rt.closedAt)}),be=Q.filter(Ue=>Ue.createdBy===e.id),xe=S?be:Q,Ne=b==="ALL"?xe:xe.filter(Ue=>Ue.status===b),Fe=U==="FINANCE"?Ne.filter(Ue=>!!Ue.expensesSheetId):Ne,Le=(()=>{const Ue=E.trim().toLowerCase();return Ue?Fe.filter(st=>[st.odakanitNo,st.insuredName,st.plaintiffName,st.insurerName,st.marketRef].filter(Boolean).join(" ").toLowerCase().includes(Ue)):Fe})(),Ke=H?Le.filter(Ue=>iN(Ue)||!!lN(Ue)):Le,dt={ACTION_REQUIRED:[],WAITING_ON_OTHERS:[],IN_PROGRESS:[],SENT_COMPLETED:[]};return Ke.forEach(Ue=>{const st=Ap(Ue.status);dt[st].push(Ue)}),{mine:be,buckets:dt,filteredReports:Ke}},[t,s,e.id,E,b,S,H,L,O,U]),Ee=g.useMemo(()=>{const Q=new Set;let be=0,xe=0,Ne=0,Fe=0;return ce.forEach(Le=>{Le.status!=="SENT"&&(xe+=1,Q.add(_c(Le))),Ap(Le.status)==="ACTION_REQUIRED"&&(be+=1),Le.status==="READY_TO_SEND"&&(Ne+=1),Le.expensesSheetId&&Le.status!=="SENT"&&(Fe+=1)}),{activeCasesCount:Q.size,actionRequiredCount:be,draftsInWorkCount:xe,readyToSendCount:Ne,financeTasksCount:Fe}},[ce]),{activeCasesCount:ve,actionRequiredCount:$e,draftsInWorkCount:Ze,readyToSendCount:Oe,financeTasksCount:Ye}=Ee,ot=g.useMemo(()=>ce.filter(Q=>Q.status==="WAITING_FOR_INVOICES").length,[ce]),X=ce.filter(Q=>!!Q.expensesSheetId&&Q.status!=="SENT");g.useEffect(()=>{const be=Array.from(new Set(X.map(xe=>xe.expensesSheetId).filter(xe=>!!xe))).filter(xe=>!I[xe]);be.length&&be.forEach(xe=>{(async()=>{try{const Ne=await Xe.getSheet(xe);if(!Ne)return;const Fe=Fn(Ne.sheet,Ne.lineItems);D(Le=>({...Le,[xe]:Fe}))}catch{}})()})},[X,I]);const ne=g.useMemo(()=>{const Q=new Map,be=Ne=>{const Fe=ni(Ne);if(!Fe)return"";const Le=Fe.split(" - ");return Le.length<=2?Fe:Le[Le.length-2]||Fe};return ce.forEach(Ne=>{if(!Ne.odakanitNo)return;const Fe=Ne.odakanitNo.trim();if(!Fe)return;const Le=Q.get(Fe)||{odakanitNo:Fe,insuredName:Ne.insuredName||void 0,plaintiffName:Ne.plaintiffName||void 0,insurerName:Ne.insurerName||void 0,latestUpdatedAt:null,latestReportTitle:void 0,latestReportNumber:void 0,nextReportNumber:void 0,hasOpenWork:!1,hasUrgentWork:!1},Ke=Ne.updatedAt||Ne.reportDate,dt=Ke&&new Date(Ke).getTime()||0,Ue=Le.latestUpdatedAt&&new Date(Le.latestUpdatedAt).getTime()||0;dt>=Ue&&(Le.latestUpdatedAt=Ke||Le.latestUpdatedAt||null,Le.insuredName=Ne.insuredName||Le.insuredName,Le.plaintiffName=Ne.plaintiffName||Le.plaintiffName,Le.insurerName=Ne.insurerName||Le.insurerName,Le.latestReportTitle=be(Ne)),Ne.status!=="SENT"&&!Ne.deletedAt&&(Le.hasOpenWork=!0),(Ne.status==="TASK_ASSIGNED"||Ne.status==="WAITING_FOR_INVOICES"||Ne.status==="PENDING_REVIEW"||Ne.status==="READY_TO_SEND")&&(Le.hasUrgentWork=!0),Q.set(Fe,Le)}),Array.from(Q.values()).map(Ne=>{var Ue;const Fe=Ne.odakanitNo.trim(),Le=[],Ke=s[Fe];(Ue=Ke==null?void 0:Ke.sentReports)!=null&&Ue.length&&Ke.sentReports.forEach(st=>{typeof st.reportNo=="number"&&st.reportNo>0&&Le.push(st.reportNo)}),t.forEach(st=>{var Rt;if((st.odakanitNo||"").trim()===Fe&&st.status==="SENT")if(typeof st.reportNumber=="number"&&st.reportNumber>0)Le.push(st.reportNumber);else{const yt=(((Rt=st.reportHistory)==null?void 0:Rt.length)||0)+1;Le.push(yt)}});const dt=Le.length?Math.max(...Le):0;return{...Ne,latestReportNumber:dt||void 0,nextReportNumber:(dt||0)+1}}).sort((Ne,Fe)=>{const Le=Ne.latestUpdatedAt&&new Date(Ne.latestUpdatedAt).getTime()||0;return(Fe.latestUpdatedAt&&new Date(Fe.latestUpdatedAt).getTime()||0)-Le})},[ce]);g.useMemo(()=>new Set(G),[G]);const C=Q=>{p(Q.id)},re=Q=>{const be=U===Q?null:Q;switch(z(be),be){case"ACTION":h("TASK_ASSIGNED");break;case"WAITING":h("WAITING_FOR_INVOICES");break;case"DRAFTS":h("READY_TO_SEND");break;case"FINANCE":h("ALL");break;case"ACTIVE":h("ALL");break;default:h("ALL");break}};b!=="ALL"||E.trim(),g.useEffect(()=>{if(!a)return;const Q=be=>{be.key==="Escape"&&o(!1)};return window.addEventListener("keydown",Q),()=>window.removeEventListener("keydown",Q)},[a,o]),g.useEffect(()=>{if(typeof window>"u"||!t.length)return;const Q=Ip(e.id);if(window.localStorage.getItem(Q)!=="1")try{const xe=window.localStorage.getItem(Oc(e.id));if(!xe){window.localStorage.setItem(Q,"1");return}const Ne=JSON.parse(xe);if(!Array.isArray(Ne)){window.localStorage.setItem(Q,"1");return}const Fe=[],Le=Ke=>{Ke&&(Fe.includes(Ke)||Fe.push(Ke))};Ne.forEach(Ke=>{if(typeof Ke!="string")return;const dt=Ke.trim();if(!dt)return;const Ue=dt.toLowerCase();if(Ue.startsWith("odakanit:")||Ue.startsWith("umr:")||Ue.startsWith("line:")||Ue.startsWith("cert:")||Ue.startsWith("insured:")||Ue.startsWith("plaintiff:")||Ue.startsWith("id:")){Le(dt);return}const Rt=t.find(yt=>_c(yt)===dt?!0:yt.id===dt||yt.odakanitNo&&yt.odakanitNo===dt||yt.marketRef&&yt.marketRef===dt);Le(Rt?_c(Rt):`odakanit:${dt}`)}),se(Fe),window.localStorage.setItem(Oc(e.id),JSON.stringify(Fe)),window.localStorage.setItem(Q,"1")}catch{window.localStorage.setItem(Ip(e.id),"1")}},[t,e.id]),g.useMemo(()=>{if(!ce.length)return null;if(typeof window<"u")try{const be=window.localStorage.getItem(fN),xe=be?ce.find(Ne=>Ne.id===be&&!Ne.deletedAt):null;if(xe)return xe}catch{}return[...ce].sort((be,xe)=>{const Ne=Ke=>{const dt=Ke.updatedAt||Ke.reportDate;return dt&&new Date(dt).getTime()||0},Fe=Ne(be);return Ne(xe)-Fe})[0]||null},[ce]);const te=()=>n.jsxs("div",{className:"relative",children:[n.jsxs("button",{type:"button",onClick:()=>o(!a),className:"relative inline-flex h-9 w-9 items-center justify-center rounded-full bg-gold/10 text-xs font-medium text-blue-700 hover:bg-blue-100 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-lpBlue focus-visible:ring-offset-2","aria-label":De("openNotificationsAria"),title:De("openNotificationsTitle"),children:[n.jsx(Zl,{className:"h-4 w-4","aria-hidden":"true"}),ue>0&&n.jsx("span",{className:"absolute -top-1.5 -right-1.5 inline-flex h-4 min-w-[16px] items-center justify-center rounded-full bg-red-500 px-1 text-[10px] font-bold text-white",children:ue})]}),a&&n.jsxs("div",{className:"absolute right-0 mt-2 w-80 rounded-lg border border-borderDark bg-panel text-xs shadow-xl z-50",children:[n.jsxs("div",{className:"flex items-center justify-between border-b px-3 py-2",children:[n.jsx("span",{className:"font-semibold text-textLight",children:De("notificationTitle")}),n.jsxs("label",{className:"flex items-center gap-1 text-[11px] text-textMuted",children:[n.jsx("input",{type:"checkbox",checked:c,onChange:Q=>i(Q.target.checked),className:"h-3 w-3 rounded border-borderDark text-gold focus:ring-gold"}),De("dailySummary")]})]}),n.jsxs("div",{className:"max-h-64 overflow-auto divide-y",children:[J.length===0&&n.jsx("div",{className:"p-4 text-center text-textMuted",children:De("noNotifications")}),J.map(Q=>n.jsxs("div",{className:"p-3 space-y-1",children:[n.jsx("p",{className:"font-medium text-textLight",children:Q.message}),n.jsx("p",{className:"text-[10px] text-textMuted",children:new Date(Q.createdAt).toLocaleString()}),Q.reportId&&n.jsx("button",{type:"button",className:"mt-1 text-[11px] text-blue-700 hover:underline",onClick:()=>{p(Q.reportId),o(!1)},children:' " '})]},Q.id))]}),n.jsx("div",{className:"px-3 py-2 text-right",children:n.jsx("button",{type:"button",onClick:l,className:"text-[11px] font-medium text-red-500 hover:underline",children:De("clearAll")})})]})]}),[pe,Be]=g.useState(""),[je,Te]=g.useState(!1),[et,Ve]=g.useState(-1),He=g.useMemo(()=>{const Q=pe.trim();if(!Q)return[];const be=Q.toLowerCase(),xe=Object.values(s),Ne=xe.filter(Ke=>Ke.odakanitNo.toLowerCase().startsWith(be)),Fe=xe.filter(Ke=>!Ke.odakanitNo.toLowerCase().startsWith(be)&&Ke.odakanitNo.toLowerCase().includes(be));return[...Ne,...Fe].slice(0,8).map(Ke=>({odakanitNo:Ke.odakanitNo,insuredName:Ke.insuredName,plaintiffName:Ke.plaintiffName}))},[pe,s]);return g.useEffect(()=>{if(!pe.trim()){Te(!1),Ve(-1);return}He.length>0?(Te(!0),Ve(0)):(Te(!1),Ve(-1))},[pe,He.length]),n.jsx("div",{className:"min-h-screen bg-navySecondary px-0 pb-6 text-[15px]",dir:"rtl",lang:"he",children:n.jsxs("div",{className:"w-full px-6 md:px-8 lg:px-10 xl:px-12",children:[n.jsxs("header",{className:"sticky top-0 z-20 mb-4 flex flex-col gap-3 border-b border-borderDark bg-panel/80 pb-3 pt-2 backdrop-blur-sm md:flex-row md:items-center md:justify-between",children:[n.jsxs("div",{children:[n.jsx("h1",{className:"text-2xl font-bold text-gold font-heebo",children:De("dashboardTitle")}),n.jsxs("p",{className:"text-base text-textMuted text-right",children:[n.jsx("span",{className:"font-semibold",children:dN})," ",n.jsx("span",{className:"text-textMuted",children:uN}),n.jsx("span",{className:"text-textMuted",children:"  "}),De("welcomeBack"),","," ",n.jsx("span",{className:"font-semibold",children:e.name})," ",n.jsxs("span",{className:"text-textMuted",children:["(",De("roleLawyer"),")"]})]})]}),n.jsxs("div",{className:"flex flex-wrap items-center justify-start gap-2 md:justify-end",children:[n.jsx("button",{type:"button",onClick:y,className:"inline-flex h-9 w-9 items-center justify-center rounded-full bg-lpBlue text-sm font-semibold text-white shadow-sm hover:bg-blue-900 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-lpBlue focus-visible:ring-offset-2","aria-label":De("openNewCaseFolderAria"),title:De("openNewCaseFolderTitle"),children:n.jsx(Mu,{className:"h-4 w-4","aria-hidden":"true"})}),te(),n.jsx("button",{type:"button",className:"inline-flex h-9 w-9 items-center justify-center rounded-full bg-gold/10 text-sm font-medium text-blue-700 hover:bg-blue-100 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-lpBlue focus-visible:ring-offset-2",onClick:()=>{const Q=new CustomEvent("openUserGuide");window.dispatchEvent(Q)},"aria-label":De("openHelpCenterAria"),title:De("openHelpCenterTitle"),children:n.jsx(Lu,{className:"h-4 w-4","aria-hidden":"true"})}),n.jsx("button",{type:"button",onClick:w,className:"inline-flex h-9 w-9 items-center justify-center rounded-full text-sm font-semibold text-red-600 hover:bg-red-50 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-red-500 focus-visible:ring-offset-2","aria-label":De("logoutAria"),title:De("logoutTitle"),children:n.jsx(uh,{className:"h-4 w-4","aria-hidden":"true"})})]})]}),!1,n.jsxs("section",{className:"mb-3 rounded-2xl border border-borderDark bg-panel px-4 py-3 text-xs text-textLight shadow-sm",children:[n.jsx("h2",{className:"mb-1 text-sm font-semibold text-textLight",children:De("workloadTitle")}),n.jsxs("div",{className:"flex flex-wrap gap-3 text-[11px] text-textLight mb-2",children:[n.jsxs("span",{children:[Ye," ",De("statsFinanceTasks")]}),n.jsxs("span",{children:[ot," ",De("statsWaitingOnOthers")]}),n.jsxs("span",{children:[Oe," ",De("statsDraftsReady")]})]}),n.jsx("div",{className:"max-h-40 overflow-y-auto rounded-xl border border-dashed border-borderDark bg-navySecondary px-3 py-2",children:ce.filter(Q=>Q.status!=="SENT").length===0?n.jsx("p",{className:"text-[11px] text-textMuted",children:De("emptyInProgressTitle")}):n.jsx("ul",{className:"space-y-1 text-[11px]",children:ce.filter(Q=>Q.status!=="SENT").sort((Q,be)=>{const xe=Ne=>{const Fe=Ne.updatedAt||Ne.reportDate;return Fe&&new Date(Fe).getTime()||0};return xe(be)-xe(Q)}).map(Q=>n.jsxs("li",{className:"flex items-center justify-between gap-2 border-b border-borderDark/70 pb-1 last:border-b-0",children:[n.jsxs("button",{type:"button",onClick:()=>C(Q),className:"flex-1 text-right hover:text-gold",children:[n.jsx("span",{className:"font-semibold",children:Q.insuredName||Q.plaintiffName||De("untitledCase")}),Q.odakanitNo&&n.jsxs("span",{className:"text-textMuted",children:["  ",Q.odakanitNo]})]}),n.jsxs("span",{className:"whitespace-nowrap text-[10px] text-textMuted flex items-center gap-1",children:[n.jsx("span",{children:mN[Q.status]}),n.jsx(cN,{report:Q})]})]},Q.id))})})]}),!1,n.jsxs("section",{className:"mb-3 rounded-2xl border border-borderDark bg-panel px-4 py-3 text-xs text-textLight shadow-sm",children:[n.jsxs("div",{className:"flex items-center justify-between mb-2",children:[n.jsx("h2",{className:"text-sm font-semibold text-textLight",children:De("caseListTitle")}),n.jsxs("span",{className:"text-[11px] text-textMuted",children:[ne.length," ",De("statsActiveCases")]})]}),n.jsx("p",{className:"mb-2 text-[11px] text-textMuted",children:De("caseListHintActiveOnly")}),ne.length===0?n.jsx("p",{className:"text-[11px] text-textMuted",children:De("caseListEmpty")}):n.jsx("div",{className:"overflow-x-auto",children:n.jsxs("table",{className:"min-w-full table-fixed text-[11px]",children:[n.jsx("thead",{children:n.jsxs("tr",{className:"border-b border-borderDark bg-navySecondary",children:[n.jsx("th",{className:"px-2 py-1 text-right font-semibold w-32",children:De("caseListHeaderOdakanit")}),n.jsx("th",{className:"px-2 py-1 text-right font-semibold w-40",children:De("caseListHeaderInsurer")}),n.jsx("th",{className:"px-2 py-1 text-right font-semibold w-40",children:De("caseListHeaderInsured")}),n.jsx("th",{className:"px-2 py-1 text-right font-semibold w-40",children:De("caseListHeaderPlaintiff")}),n.jsx("th",{className:"px-2 py-1 text-right font-semibold w-20",children:De("caseListHeaderReportNo")}),n.jsx("th",{className:"px-2 py-1 text-right font-semibold w-20",children:De("caseListHeaderNextReportNo")??"Next report"})]})}),n.jsx("tbody",{children:ne.map((Q,be)=>{const xe=Q.hasUrgentWork,Ne=Q.hasOpenWork,Fe=be%2===0?"bg-panel":"bg-navySecondary",Le=xe?"border-l-4 border-red-400 bg-red-50/80 text-gray-900":Ne?"border-l-4 border-amber-300 bg-amber-50/70 text-gray-900":"border-l border-transparent";return n.jsxs("tr",{className:`cursor-pointer border-b border-borderDark ${Fe} ${Le}`,onClick:()=>N(Q.odakanitNo),children:[n.jsx("td",{className:"px-2 py-1 text-right font-mono text-[11px]",children:n.jsx("button",{type:"button",className:"text-gold hover:underline",onClick:()=>N(Q.odakanitNo),children:Q.odakanitNo})}),n.jsx("td",{className:"px-2 py-1 text-right",children:Q.insurerName||""}),n.jsx("td",{className:"px-2 py-1 text-right",children:Q.insuredName||""}),n.jsx("td",{className:"px-2 py-1 text-right",children:Q.plaintiffName||""}),n.jsx("td",{className:"px-2 py-1 text-right font-mono text-[11px]",children:Q.latestReportNumber??""}),n.jsx("td",{className:"px-2 py-1 text-right font-mono text-[11px]",children:Q.nextReportNumber??(Q.latestReportNumber||0)+1})]},Q.odakanitNo)})})]})})]}),!1,!1,n.jsx(rN,{activeCases:ve,actionRequired:$e,waitingOnOthers:ot,draftsAndReady:Oe,financeTasks:Ye,selectedFilter:U,onChangeFilter:re}),n.jsxs("section",{className:"mb-3 rounded-2xl border border-emerald-100 bg-panel px-4 py-3 text-xs text-textLight shadow-sm",children:[n.jsxs("div",{className:"flex items-center justify-between mb-2",children:[n.jsx("h2",{className:"text-sm font-semibold text-textLight",children:De("financeReportsTitle")}),n.jsx("span",{className:"text-[11px] text-textMuted",children:Ye})]}),n.jsx("p",{className:"mb-2 text-[11px] text-textMuted",children:De("financeReportsHint")}),X.length===0?n.jsx("p",{className:"text-[11px] text-textMuted",children:De("financeReportsEmpty")}):n.jsx("div",{className:"overflow-x-auto",children:n.jsxs("table",{className:"min-w-full table-fixed text-[11px]",children:[n.jsx("thead",{children:n.jsxs("tr",{className:"border-b border-borderDark bg-navySecondary",children:[n.jsx("th",{className:"px-2 py-1 text-right font-semibold w-48",children:De("caseListHeaderTitle")}),n.jsx("th",{className:"px-2 py-1 text-right font-semibold w-20",children:De("caseListHeaderReportNo")}),n.jsx("th",{className:"px-2 py-1 text-right font-semibold w-40",children:De("caseListHeaderPlaintiff")}),n.jsx("th",{className:"px-2 py-1 text-right font-semibold w-40",children:De("caseListHeaderInsured")}),n.jsx("th",{className:"px-2 py-1 text-right font-semibold w-40",children:De("caseListHeaderInsurer")}),n.jsx("th",{className:"px-2 py-1 text-right font-semibold w-32",children:De("caseListHeaderOdakanit")})]})}),n.jsx("tbody",{children:X.slice().sort((Q,be)=>{const xe=Ne=>{const Fe=Ne.updatedAt||Ne.reportDate;return Fe&&new Date(Fe).getTime()||0};return xe(be)-xe(Q)}).map(Q=>{var Le;const be=ni(Q),xe=be.split(" - "),Ne=xe.length>2&&xe[xe.length-2]||be,Fe=(((Le=Q.reportHistory)==null?void 0:Le.length)||0)+1;return n.jsxs("tr",{className:"cursor-pointer border-b border-borderDark hover:bg-emerald-50/60 hover:[&_.text-textLight]:text-gray-800 hover:[&_.text-textMuted]:text-gray-600",onClick:()=>{Q.odakanitNo?N(Q.odakanitNo):C(Q)},children:[n.jsxs("td",{className:"px-2 py-1 text-right",children:[n.jsx("div",{className:"font-semibold text-textLight",children:Ne||""}),Q.updatedAt&&n.jsx("div",{className:"text-[10px] text-textMuted",children:new Date(Q.updatedAt).toLocaleString("he-IL")})]}),n.jsx("td",{className:"px-2 py-1 text-right font-mono text-[11px]",children:Fe}),n.jsx("td",{className:"px-2 py-1 text-right",children:Q.plaintiffName||""}),n.jsx("td",{className:"px-2 py-1 text-right",children:Q.insuredName||""}),n.jsx("td",{className:"px-2 py-1 text-right",children:Q.insurerName||""}),n.jsx("td",{className:"px-2 py-1 text-right font-mono text-[11px]",children:Q.odakanitNo||""})]},Q.id)})})]})})]}),!1]})})},hN="modulepreload",gN=function(e){return"/"+e},Tp={},yN=function(t,s,r){let a=Promise.resolve();if(s&&s.length>0){document.getElementsByTagName("link");const l=document.querySelector("meta[property=csp-nonce]"),c=(l==null?void 0:l.nonce)||(l==null?void 0:l.getAttribute("nonce"));a=Promise.allSettled(s.map(i=>{if(i=gN(i),i in Tp)return;Tp[i]=!0;const u=i.endsWith(".css"),p=u?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${i}"]${p}`))return;const y=document.createElement("link");if(y.rel=u?"stylesheet":hN,u||(y.as="script"),y.crossOrigin="",y.href=i,c&&y.setAttribute("nonce",c),document.head.appendChild(y),u)return new Promise((N,w)=>{y.addEventListener("load",N),y.addEventListener("error",()=>w(new Error(`Unable to preload CSS for ${i}`)))})}))}function o(l){const c=new Event("vite:preloadError",{cancelable:!0});if(c.payload=l,window.dispatchEvent(c),!c.defaultPrevented)throw l}return a.then(l=>{for(const c of l||[])c.status==="rejected"&&o(c.reason);return t().catch(o)})},bN={:"January",:"February",:"March",:"April",:"May",:"June",:"July",:"August",:"September",:"October",:"November",:"December"},NN=e=>{let t=e.trim();return t=t.replace(/Reporl/gi,"Report"),t=t.replace(/Rep0rt/gi,"Report"),t=t.replace(/Repcrt/gi,"Report"),t=t.replace(/\s+/g," "),t},vN=e=>{try{let t=e;Object.entries(bN).forEach(([r,a])=>{const o=new RegExp(r,"gi");t=t.replace(o,a)});const s=new Date(t);return Number.isNaN(s.getTime())?void 0:s.toISOString().slice(0,10)}catch{return}};async function SN(e){var t,s,r;try{const o=await(await yN(()=>import("./index-BrU0kWDr.js").then(E=>E.i),[])).recognize(e,"eng+heb",{logger:()=>{}}),l=((t=o==null?void 0:o.data)==null?void 0:t.lines)||((r=(s=o==null?void 0:o.data)==null?void 0:s.text)==null?void 0:r.split(/\r?\n/).filter(E=>E.trim().length>0).map(E=>({text:E})))||[],c=[],i={},u="(January|February|March|April|May|June|July|August|September|October|November|December||||||||||||)",p=new RegExp(`Report\\s*(\\d+)\\s*-\\s*(.*?),\\s*(${u}\\s+\\d{1,2},\\s*\\d{4})\\.?$`,"i"),y=/^\s*(Line\s*Slip\s*No\.?|LineSlip\s*No\.?)\s*[:\-]?\s*(.+)\s*$/i,N=/^\s*Unique\s+Market\s+Ref\.?\s*[:\-]?\s*(.+)\s*$/i,w=/^\s*Insured\s*[:\-]?\s*(.+)\s*$/i,R=/^\s*(Plaintiff|Claimant)\s*[:\-]?\s*(.+)\s*$/i;return l.forEach(E=>{const W=E.text||"";if(!W.trim())return;const b=NN(W),h=b.match(p);if(h){const q=Number.parseInt(h[1],10),ee=(h[2]||"").trim().replace(/[.,]\s*$/,""),G=h[3]||"",se=vN(G);if(!q||!se||!ee||ee.length<2)return;c.push({reportNo:q,title:ee,sentAt:se,rawLine:W,confidence:typeof E.confidence=="number"?Math.round(E.confidence):void 0});return}const S=b.match(y);S&&!i.lineSlipNo&&(i.lineSlipNo=S[2].trim());const P=b.match(N);P&&!i.marketRef&&(i.marketRef=P[1].trim());const U=b.match(w);U&&!i.insuredName&&(i.insuredName=U[1].trim());const z=b.match(R);z&&!i.plaintiffOrClaimant&&(i.plaintiffOrClaimant=z[2].trim())}),c.sort((E,W)=>(E.reportNo||0)-(W.reportNo||0)),{previousReports:c,identifiers:i}}catch(a){return console.error("OCR failed",a),{previousReports:[],identifiers:{}}}}const Rp="seedShortcutsStickerCollapsed_v1",wN=()=>{const[e,t]=g.useState(()=>{if(typeof window>"u")return!1;try{return window.localStorage.getItem(Rp)==="1"}catch{return!1}});return g.useEffect(()=>{if(!(typeof window>"u"))try{window.localStorage.setItem(Rp,e?"1":"0")}catch{}},[e]),n.jsx("div",{className:"fixed bottom-4 right-4 z-[260] max-w-xs text-[11px] text-slate-800",style:{pointerEvents:"none"},children:n.jsxs("div",{className:"rounded-xl shadow-lg border border-amber-200 bg-amber-50/95 px-3 py-2",style:{pointerEvents:"auto"},children:[n.jsxs("div",{className:"flex items-center justify-between gap-2 mb-1",children:[n.jsxs("div",{className:"font-semibold flex items-center gap-1",children:[n.jsx("span",{children:""}),n.jsx("span",{children:"Shortcuts"})]}),n.jsx("button",{type:"button",className:"text-[10px] text-slate-600 hover:text-slate-900",onClick:()=>t(s=>!s),children:e?"+":""})]}),!e&&n.jsxs("div",{className:"space-y-1",children:[n.jsx("div",{className:"font-semibold text-[10px] text-slate-700",children:"Screenshot"}),n.jsxs("ul",{className:"space-y-0.5",children:[n.jsx("li",{children:"Ctrl /  + V  Paste screenshot"}),n.jsx("li",{children:"Ctrl /  + Shift + O  Run OCR"})]}),n.jsx("div",{className:"font-semibold text-[10px] text-slate-700 mt-1",children:"Reports table"}),n.jsxs("ul",{className:"space-y-0.5",children:[n.jsx("li",{children:"Enter  Next field"}),n.jsx("li",{children:"Shift + Enter  New report row (below)"}),n.jsx("li",{children:"Ctrl /  + Enter  New report row"})]}),n.jsx("div",{className:"font-semibold text-[10px] text-slate-700 mt-1",children:"Apply"}),n.jsx("ul",{className:"space-y-0.5",children:n.jsx("li",{children:"Ctrl /  + S  Approve & Apply"})}),n.jsx("div",{className:"font-semibold text-[10px] text-slate-700 mt-1",children:"Navigation"}),n.jsx("ul",{className:"space-y-0.5",children:n.jsx("li",{children:"Ctrl + Alt +  /   Previous / Next case"})}),n.jsx("div",{className:"text-[9px] text-slate-500 mt-1",children:"Shortcuts work only in this screen."})]})]})})},Yu="seedDraftCases_v1",Lh="seedDraftFinalized_v1",jN=7,EN=e=>e.replace(/^\uFEFF/,"").trim().toLowerCase().replace(/[\s_]+/g,"").replace(/[^a-z0-9]/g,""),Cp=(e,t)=>{const s=[];let r="",a=!1;for(let o=0;o<e.length;o+=1){const l=e[o];if(l==='"'){a&&e[o+1]==='"'?(r+='"',o+=1):a=!a;continue}if(l===t&&!a){s.push(r),r="";continue}r+=l}return s.push(r),s.map(o=>o.trim())},kN=e=>{const s=e.split(/\r?\n/).map(R=>R.trim()).filter(R=>R.length>0);if(!s.length)return{drafts:[],error:" CSV .         ."};const r=s[0].replace(/^\uFEFF/,""),a=(r.match(/,/g)||[]).length,o=(r.match(/;/g)||[]).length,l=r.includes("	"),c=o>a?";":a>0?",":l?"	":",",i=Cp(r,c);if(!i.length)return{drafts:[],error:"  CSV  .    : odakanitNo,assignedLawyer"};const u=i.map(R=>EN(R)),p=u.findIndex(R=>R==="odakanitno"),y=u.findIndex(R=>R==="assignedlawyer");if(p<0||y<0)return{drafts:[],error:`   .       : odakanitNo,assignedLawyer ( ). :
odakanitNo,assignedLawyer`};const N=[],w=new Set;for(let R=1;R<s.length;R+=1){const E=s[R];if(!E)continue;const W=Cp(E,c),b=W[p]||"",h=Se(b);if(!h||w.has(h))continue;w.add(h);const S=(W[y]||"").trim();if(!S)return{drafts:[],error:` ${R+1}  AssignedLawyer   ${h}.    /  .`,delimiter:c};const P=S.toLowerCase();if(!js.find(z=>z.id.toLowerCase()===P||z.username.toLowerCase()===P)){const z=js.map(q=>`${q.username} (id: ${q.id})`).join(", ");return{drafts:[],error:` ${R+1}  AssignedLawyer="${S}"   ${h}     .
       (id)    .
  : ${z}`,delimiter:c}}N.push({odakanitNo:h,assignedLawyer:S,reports:[],status:"MISSING_HISTORY"})}return N.length?{drafts:N,delimiter:c}:{drafts:[],error:"    CSV.       odakanitNo assignedLawyer  .",delimiter:c}},_h=e=>{try{return JSON.stringify(e)}catch{return"[]"}},AN=()=>{if(typeof window>"u")return[];try{const e=window.localStorage.getItem(Yu);if(!e)return[];const t=JSON.parse(e);return Array.isArray(t)?t:[]}catch{return[]}},IN=e=>{if(!(typeof window>"u"))try{window.localStorage.setItem(Yu,_h(e))}catch{}},TN=()=>{if(typeof window>"u")return!1;try{return window.localStorage.getItem(Lh)==="1"}catch{return!1}},RN=()=>{if(!(typeof window>"u"))try{window.localStorage.setItem(Lh,"1")}catch{}},CN=(e,t,s=jN)=>{if(!e)return!1;const{odakanitNo:r,seededAt:a,seedSourceLastReportNo:o,seedSourceLastReportDate:l}=e,c=Se(r);if(!c||!!!(a||o||l))return!1;const u=t.filter(p=>!p.deletedAt&&Se(p.odakanitNo)===c);if(u.length>0){const p=typeof o=="number"?o:0,y=l?new Date(l).getTime():0;let N=0,w=0;if(u.forEach(R=>{typeof R.reportNumber=="number"&&R.reportNumber>N&&(N=R.reportNumber);const E=new Date(R.sentAt||R.reportDate).getTime();!Number.isNaN(E)&&E>w&&(w=E)}),N>p&&p>0||w>y&&y>0)return!0}if(a){const p=new Date(a).getTime();if(!Number.isNaN(p)&&(Date.now()-p)/(1e3*60*60*24)>s)return!0}return!!(a&&(o==null||Number.isNaN(o)))},DN=({caseFolders:e,onUpdateCaseFolders:t,reports:s})=>{const[r,a]=g.useState(()=>AN()),[o,l]=g.useState(""),[c,i]=g.useState(null),[u,p]=g.useState(!1),[y,N]=g.useState(null),[w,R]=g.useState(null);g.useEffect(()=>{IN(r)},[r]);const E=TN(),W=g.useMemo(()=>r.find(j=>j.odakanitNo===c)||null,[r,c]),b=()=>{const j=`odakanitNo,assignedLawyer
`,F=new Blob([j],{type:"text/csv;charset=utf-8;"}),L=URL.createObjectURL(F),O=document.createElement("a");O.href=L,O.download="seed-cases-template.csv",document.body.appendChild(O),O.click(),document.body.removeChild(O),URL.revokeObjectURL(L)},h=()=>{const{drafts:j,error:F,delimiter:L}=kN(o);if(F){N(F),R(null);return}N(null),j.length?R(`Loaded ${j.length} cases. Detected delimiter: "${L||","}".`):R(null),a(j)},S=()=>{const j=_h(r),F=new Blob([j],{type:"application/json;charset=utf-8;"}),L=URL.createObjectURL(F),O=document.createElement("a");O.href=L,O.download="seedDraftCases_v1.json",document.body.appendChild(O),O.click(),document.body.removeChild(O),URL.revokeObjectURL(L)},P=()=>{window.confirm("   -Seed (   CaseFolders)?")&&(a([]),typeof window<"u"&&window.localStorage.removeItem(Yu))},U=()=>{window.confirm(" Finalize    . ?")&&RN()},z=j=>j.status==="APPLIED"?"APPLIED":j.reports&&j.reports.length>0?"READY":"MISSING_HISTORY",q=j=>{j.reports.length&&(t(F=>{var Ze,Oe,Ye,ot;const L=Se(j.odakanitNo);if(!L)return F;const O=F[L],H=new Date().toISOString(),M=O||{odakanitNo:L,reTemplate:(O==null?void 0:O.reTemplate)||"",insuredName:(O==null?void 0:O.insuredName)||"",insurerName:(O==null?void 0:O.insurerName)||"",plaintiffName:(O==null?void 0:O.plaintiffName)||"",marketRef:(O==null?void 0:O.marketRef)||"",lineSlipNo:(O==null?void 0:O.lineSlipNo)||"",certificateRef:(O==null?void 0:O.certificateRef)||"",createdAt:(O==null?void 0:O.createdAt)||H,updatedAt:(O==null?void 0:O.updatedAt)||H,reportIds:(O==null?void 0:O.reportIds)||[],sentReports:(O==null?void 0:O.sentReports)||[]},I=[...M.sentReports];let D=0,J=null;j.reports.forEach(X=>{if(!X.reportNo||!X.title||!X.sentAt)return;const ne=I.findIndex(re=>re.reportNo===X.reportNo),C={odakanitNo:L,reportNumber:X.reportNo,insurerName:M.insurerName,insuredName:j.insuredName||M.insuredName,plaintiffName:j.plaintiffName||M.plaintiffName,reportSubject:X.title,reportDate:X.sentAt};ne>=0?I[ne]={...I[ne],reportNo:X.reportNo,sentAt:X.sentAt,snapshot:{...I[ne].snapshot||{},...C}}:I.push({reportId:`seed-${L.replace(/[^\w-]+/g,"_")}-${X.reportNo}`,reportNo:X.reportNo,sentAt:X.sentAt,fileName:void 0,snapshot:C}),X.reportNo>D&&(D=X.reportNo),X.sentAt&&(!J||X.sentAt>J)&&(J=X.sentAt)}),I.sort((X,ne)=>(X.reportNo||0)-(ne.reportNo||0));const ue=((Ze=j.insuredName)==null?void 0:Ze.trim())||M.insuredName||void 0,ce=((Oe=j.plaintiffName)==null?void 0:Oe.trim())||M.plaintiffName||void 0,le=((Ye=j.lineSlipNo)==null?void 0:Ye.trim())||M.lineSlipNo||void 0,fe=((ot=j.marketRef)==null?void 0:ot.trim())||M.marketRef||void 0,Ee=[];(ue||ce)&&Ee.push(`Re: ${ue||""}${ue&&ce?" / ":""}${ce||""}`.trim()),le&&Ee.push(`LineSlip No. ${le}`),fe&&Ee.push(`Unique Market Ref: ${fe}`);const ve=Ee.join(`
`),$e={...M,insuredName:ue||M.insuredName,plaintiffName:ce||M.plaintiffName,lineSlipNo:le||M.lineSlipNo,marketRef:fe||M.marketRef,assignedLawyer:j.assignedLawyer||(O==null?void 0:O.assignedLawyer),reTemplate:ve||M.reTemplate,seededAt:H,seedSourceLastReportNo:D||M.seedSourceLastReportNo,seedSourceLastReportDate:J||M.seedSourceLastReportDate,updatedAt:H,sentReports:I};return{...F,[L]:$e}}),a(F=>F.map(L=>L.odakanitNo===j.odakanitNo?{...L,status:"APPLIED"}:L)))},ee=r.map(j=>{const F=z(j),L=j.reports.length,O=L>0?j.reports.map(J=>J.sentAt).filter(Boolean).sort().slice(-1)[0]:"",H=e[Se(j.odakanitNo)],M=CN(H,s),I=(H==null?void 0:H.seededAt)||null,D=H!=null&&H.seedSourceLastReportNo&&H.seedSourceLastReportDate?`#${H.seedSourceLastReportNo} (${H.seedSourceLastReportDate})`:"";return{draft:j,status:F,reportsCount:L,lastDate:O,stale:M,lastSeedInfo:I,seedSummary:D}}).filter(j=>u?j.stale:!0),G=r.length,se=r.filter(j=>z(j)==="APPLIED").length;return n.jsxs("div",{className:"mt-6 border border-slate-200 rounded-xl p-4 bg-white",children:[n.jsxs("div",{className:"flex items-center justify-between mb-3",children:[n.jsxs("div",{className:"space-y-0.5",children:[n.jsx("h2",{className:"text-sm font-semibold text-slate-900",children:"Seed Existing Cases (Admin only)"}),n.jsxs("div",{className:"text-[11px] text-slate-600",children:[n.jsxs("span",{className:"font-semibold",children:[se," / ",G||0]})," ","cases completed",G>0&&se===G&&n.jsx("span",{className:"ml-2 text-emerald-600 font-medium",children:" All cases completed"})]})]}),E&&n.jsx("span",{className:"text-[11px] px-2 py-0.5 rounded-full bg-emerald-50 text-emerald-700 border border-emerald-200",children:"Finalized  read only"})]}),n.jsxs("div",{className:"grid md:grid-cols-2 gap-4 text-xs",children:[n.jsxs("div",{className:"space-y-2",children:[n.jsx("h3",{className:"font-semibold text-slate-800",children:"1) Download Template CSV"}),n.jsx("p",{className:"text-slate-600",children:"       CSV   .  : odakanitNo, assignedLawyer."}),n.jsx("button",{type:"button",className:"px-3 py-1.5 rounded bg-slate-800 text-white hover:bg-slate-900",onClick:b,children:"Download Seed Template (CSV)"})]}),n.jsxs("div",{className:"space-y-2",children:[n.jsx("h3",{className:"font-semibold text-slate-800",children:"2) Import Cases CSV"}),n.jsx("p",{className:"text-slate-600",children:"     CSV (  )  Parse.      (localStorage)."}),n.jsx("textarea",{className:"w-full border border-slate-300 rounded p-2 h-24 font-mono",value:o,onChange:j=>l(j.target.value),disabled:E}),y&&n.jsx("div",{className:"mt-1 text-[11px] text-rose-700 bg-rose-50 border border-rose-200 rounded px-2 py-1 whitespace-pre-line",children:y}),w&&!y&&n.jsx("div",{className:"mt-1 text-[11px] text-slate-600",children:w}),n.jsx("button",{type:"button",className:"px-3 py-1.5 rounded bg-blue-600 text-white hover:bg-blue-700 disabled:opacity-50",onClick:h,disabled:E,children:"Parse CSV"})]})]}),n.jsxs("div",{className:"mt-4",children:[n.jsxs("div",{className:"flex items-center justify-between mb-1",children:[n.jsx("h3",{className:"text-xs font-semibold text-slate-800",children:"Imported Cases"}),n.jsxs("label",{className:"flex items-center gap-1 text-[11px] text-slate-600",children:[n.jsx("input",{type:"checkbox",className:"rounded border-slate-300",checked:u,onChange:j=>p(j.target.checked)}),"Show only stale cases"]})]}),ee.length===0?n.jsx("p",{className:"text-xs text-slate-500",children:"   ."}):n.jsx("div",{className:"border border-slate-200 rounded overflow-hidden",children:n.jsxs("table",{className:"min-w-full text-[11px]",children:[n.jsx("thead",{className:"bg-slate-50",children:n.jsxs("tr",{children:[n.jsx("th",{className:"px-2 py-1 text-right",children:"odakanitNo"}),n.jsx("th",{className:"px-2 py-1 text-right",children:"Lawyer"}),n.jsx("th",{className:"px-2 py-1 text-right",children:"Status"}),n.jsx("th",{className:"px-2 py-1 text-right",children:"Fresh / Stale"}),n.jsx("th",{className:"px-2 py-1 text-right",children:"#Reports"}),n.jsx("th",{className:"px-2 py-1 text-right",children:"Last date"}),n.jsx("th",{className:"px-2 py-1 text-right",children:"Actions"})]})}),n.jsx("tbody",{children:ee.map(({draft:j,status:F,reportsCount:L,lastDate:O,stale:H,lastSeedInfo:M,seedSummary:I})=>{var D;return n.jsxs("tr",{className:`border-t border-slate-200 ${H?"bg-amber-50":""}`,children:[n.jsx("td",{className:"px-2 py-1 font-mono",children:j.odakanitNo}),n.jsx("td",{className:"px-2 py-1",children:j.assignedLawyer||((D=js.find(J=>J.id===j.assignedLawyer||J.username===j.assignedLawyer))==null?void 0:D.name)||""}),n.jsx("td",{className:"px-2 py-1",children:F==="APPLIED"?"APPLIED":F==="READY"?"READY":"MISSING_HISTORY"}),n.jsx("td",{className:"px-2 py-1",children:F==="APPLIED"?n.jsxs("div",{className:"space-y-0.5",children:[n.jsx("div",{className:H?"text-amber-700 font-semibold":"text-emerald-700 font-semibold",children:H?"STALE":"FRESH"}),M&&n.jsxs("div",{className:"text-[9px] text-slate-500",children:["Last seeded: ",new Date(M).toLocaleDateString()]}),I&&n.jsxs("div",{className:"text-[9px] text-slate-500",children:["Seed based on ",I]})]}):n.jsx("span",{className:"text-[10px] text-slate-400",children:""})}),n.jsx("td",{className:"px-2 py-1 text-center",children:L}),n.jsx("td",{className:"px-2 py-1",children:O||""}),n.jsxs("td",{className:"px-2 py-1 text-left",children:[n.jsx("button",{type:"button",className:"px-2 py-0.5 rounded border border-slate-300 text-slate-700 hover:bg-slate-50 mr-2",onClick:()=>i(j.odakanitNo),disabled:E,children:H?"Re-seed":"Edit"}),n.jsx("button",{type:"button",className:"px-2 py-0.5 rounded border border-emerald-400 text-emerald-700 hover:bg-emerald-50 disabled:opacity-50",onClick:()=>q(j),disabled:F==="MISSING_HISTORY"||E,children:"Apply"})]})]},j.odakanitNo)})})]})})]}),W&&n.jsx("div",{className:"mt-6 border-t border-slate-200 pt-4",children:n.jsx(LN,{draft:W,index:r.findIndex(j=>j.odakanitNo===W.odakanitNo),total:r.length,finalized:E,onChangeDraft:j=>{a(F=>F.map(L=>L.odakanitNo===j.odakanitNo?j:L))},onApply:q,onNavigateRelative:j=>{const F=r.findIndex(O=>O.odakanitNo===W.odakanitNo);if(F<0)return;const L=F+j;L<0||L>=r.length||i(r[L].odakanitNo)},onResetSeedMeta:()=>{const j=Se(W.odakanitNo);j&&(t(F=>{const L=F[j];if(!L)return F;const{seededAt:O,seedSourceLastReportNo:H,seedSourceLastReportDate:M,...I}=L;return{...F,[j]:I}}),a(F=>F.map(L=>L.odakanitNo===W.odakanitNo?{...L,reports:[],status:"MISSING_HISTORY"}:L)))}})}),n.jsxs("div",{className:"mt-4 flex flex-wrap gap-2 text-xs",children:[n.jsx("button",{type:"button",className:"px-3 py-1.5 rounded border border-slate-300 text-slate-700 hover:bg-slate-50",onClick:S,children:"Export Draft JSON"}),n.jsx("button",{type:"button",className:"px-3 py-1.5 rounded border border-rose-300 text-rose-700 hover:bg-rose-50",onClick:P,disabled:E,children:"Clear Draft Only"}),n.jsx("button",{type:"button",className:"px-3 py-1.5 rounded border border-emerald-400 text-emerald-700 hover:bg-emerald-50 ml-auto disabled:opacity-50",onClick:U,disabled:E,children:"Finalize (readonly)"})]})]})};function LN({draft:e,index:t,total:s,finalized:r,onChangeDraft:a,onApply:o,onNavigateRelative:l,onResetSeedMeta:c}){const[i,u]=g.useState(null),[p,y]=g.useState([]),[N,w]=g.useState([]),[R,E]=g.useState(!1),W=g.useRef([]),b=g.useRef(null);g.useEffect(()=>{u(null),y([]),w([])},[e.odakanitNo]),g.useEffect(()=>{const F=L=>{var D;if(!e||r)return;const O=(D=L.clipboardData)==null?void 0:D.items;if(!O||O.length===0)return;const H=Array.from(O).find(J=>J.type&&J.type.startsWith("image/"));if(!H){u("Clipboard does not contain an image.");return}const M=H.getAsFile();if(!M)return;const I=new FileReader;I.onload=()=>{const J=I.result;a({...e,screenshotDataUrl:J}),u(null)},I.readAsDataURL(M)};return window.addEventListener("paste",F),()=>{window.removeEventListener("paste",F)}},[e,r,a]),g.useEffect(()=>{const F=L=>{const O=L.target,H=O&&(O.tagName==="INPUT"||O.tagName==="TEXTAREA"||O.isContentEditable),I=navigator.platform.toUpperCase().includes("MAC")?L.metaKey:L.ctrlKey;if(!(H&&!I)){if(I&&!L.shiftKey&&!L.altKey&&L.key.toLowerCase()==="s"){if(L.preventDefault(),!r){if(h())return;o(e)}return}if(I&&L.shiftKey&&!L.altKey&&L.key.toLowerCase()==="o"){L.preventDefault(),!r&&e.screenshotDataUrl&&!R&&ee();return}if(I&&!L.shiftKey&&!L.altKey&&L.key==="Enter"){L.preventDefault(),r||S();return}if(I&&L.altKey&&(L.key==="ArrowDown"||L.key==="ArrowUp")){L.preventDefault();const D=L.key==="ArrowDown"?1:-1;if(h(!0)&&!window.confirm("This case has invalid rows. Navigate to another case anyway?"))return;l(D)}if(!I&&!L.altKey&&!L.shiftKey&&L.key==="/"){const D=document.getElementById("seed-cases-search-input");D&&(L.preventDefault(),D.focus())}}};return window.addEventListener("keydown",F),()=>{window.removeEventListener("keydown",F)}},[e,r,o,l,R]);const h=(F=!1)=>{var M;const L=[];let O=!1;if(!e.reports||e.reports.length===0)return u("   ."),!0;const H=new Set;if(e.reports.forEach((I,D)=>{const J={};!Number.isInteger(I.reportNo)||I.reportNo<=0?J.reportNo="     .":H.has(I.reportNo)?J.reportNo="  .":H.add(I.reportNo),I.sentAt?Number.isNaN(new Date(I.sentAt).getTime())&&(J.sentAt="  ."):J.sentAt=" .",(!I.title||I.title.trim().length<2)&&(J.title="  ( 2 )."),(J.reportNo||J.sentAt||J.title)&&(O=!0),L[D]=J}),y(L),u(O?"    .":null),O&&!F){const I=L.findIndex(D=>D.reportNo||D.sentAt||D.title);I>=0&&W.current[I]&&((M=W.current[I])==null||M.focus())}return O},S=()=>{const F=e.reports.length>0?Math.max(...e.reports.map(O=>O.reportNo||0)):0,L={...e,reports:[...e.reports,{reportNo:F+1,sentAt:"",title:""}]};a(L)},P=F=>{const L=e.reports[F],O=e.reports.length>0?Math.max(...e.reports.map(D=>D.reportNo||0)):0,M={reportNo:(L&&Number.isInteger(L.reportNo)&&L.reportNo>0?L.reportNo:O)+1,sentAt:"",title:""},I=[...e.reports];I.splice(F+1,0,M),a({...e,reports:I}),setTimeout(()=>{const D=W.current[F+1];D&&D.focus()},0)},U=(F,L)=>{F.key==="Enter"&&F.shiftKey&&!F.ctrlKey&&!F.metaKey&&!F.altKey&&(F.preventDefault(),r||P(L))},z=(F,L,O)=>{const H=e.reports.map((M,I)=>I===F?{...M,[L]:L==="reportNo"?Number(O.replace(/[^\d]/g,""))||0:O}:M);a({...e,reports:H})},q=F=>{const L=e.reports.filter((O,H)=>H!==F);a({...e,reports:L})},ee=async()=>{if(e.screenshotDataUrl){E(!0);try{const{previousReports:F,identifiers:L}=await SN(e.screenshotDataUrl);w(F);const O={...e,insuredName:L.insuredName||e.insuredName,plaintiffName:L.plaintiffOrClaimant||e.plaintiffName,lineSlipNo:L.lineSlipNo||e.lineSlipNo,marketRef:L.marketRef||e.marketRef};a(O),F.length?u(null):u("   .   .")}catch{u("OCR .   .")}finally{E(!1)}}},G=()=>{if(!N.length)return;const F=N.filter(L=>L.reportNo&&L.sentAt&&L.title).map(L=>({reportNo:L.reportNo,sentAt:L.sentAt,title:L.title}));F.length&&(a({...e,reports:F}),u(null),y([]))},se=F=>{var H;const L=(H=F.target.files)==null?void 0:H[0];if(!L)return;const O=new FileReader;O.onload=()=>{const M=O.result;a({...e,screenshotDataUrl:M}),u(null)},O.readAsDataURL(L)},j=e.screenshotDataUrl;return n.jsxs("div",{className:"mt-2 rounded-lg border border-slate-200 bg-slate-50 p-3 text-[11px] relative",children:[n.jsxs("div",{className:"flex items-center justify-between mb-2",children:[n.jsxs("div",{className:"font-semibold text-slate-800",children:["Case editor  ",e.odakanitNo," ",n.jsxs("span",{className:"text-slate-500",children:["(",t+1,"/",s,")"]})]}),n.jsxs("div",{className:"flex items-center gap-3",children:[n.jsx("button",{type:"button",className:"text-[10px] px-2 py-1 rounded border border-amber-300 text-amber-700 hover:bg-amber-50",onClick:c,disabled:r,children:"Re-seed this case"}),n.jsx("div",{className:"text-[10px] text-slate-500 hidden md:block",children:" : Ctrl+S / S  Apply, Ctrl+Enter   , Ctrl+Shift+O  OCR, Ctrl+Alt+/   "})]})]}),i&&n.jsx("div",{className:"mb-2 rounded bg-amber-50 border border-amber-200 px-2 py-1 text-[11px] text-amber-900",children:i}),n.jsxs("div",{className:"grid md:grid-cols-2 gap-3",children:[n.jsxs("div",{className:"space-y-2",children:[n.jsx("div",{className:"font-semibold text-slate-800",children:"Screenshot / OCR"}),n.jsxs("div",{ref:b,tabIndex:0,className:"border border-dashed border-slate-300 rounded-lg p-2 text-center text-slate-600 bg-white cursor-pointer hover:border-slate-400 focus:outline-none focus:ring-1 focus:ring-slate-400",onClick:()=>{var F;return(F=b.current)==null?void 0:F.focus()},children:[n.jsx("div",{className:"mb-1 font-medium text-slate-800",children:"Click here and press Ctrl+V / V to paste screenshot"}),n.jsx("div",{className:"text-[10px] text-slate-500 mb-2",children:"or choose file from disk"}),n.jsx("input",{type:"file",accept:"image/*",onChange:se,disabled:r,className:"mx-auto block text-[10px]"})]}),j&&n.jsxs("div",{className:"mt-2",children:[n.jsx("div",{className:"text-[10px] text-slate-600 mb-1",children:"Preview:"}),n.jsx("div",{className:"border border-slate-200 rounded overflow-hidden bg-white max-h-64 flex items-center justify-center",children:n.jsx("img",{src:j,alt:"Seed screenshot",className:"max-h-64"})})]}),n.jsx("div",{className:"flex items-center gap-2 mt-2",children:n.jsx("button",{type:"button",onClick:ee,disabled:!j||r||R,className:"px-3 py-1.5 rounded bg-indigo-600 text-white disabled:opacity-50 text-[11px]",children:R?"Running OCR":"Extract Previous Reports from Screenshot"})}),N.length>0&&n.jsxs("div",{className:"mt-2 border border-slate-200 rounded bg-white p-2",children:[n.jsxs("div",{className:"flex items-center justify-between mb-1",children:[n.jsxs("div",{className:"font-semibold text-slate-800 text-[11px]",children:["Proposed extraction (",N.length,")"]}),n.jsx("button",{type:"button",className:"px-2 py-0.5 rounded bg-slate-800 text-white text-[10px]",onClick:G,disabled:r,children:"Apply to table"})]}),n.jsx("div",{className:"max-h-40 overflow-auto text-[10px]",children:n.jsxs("table",{className:"min-w-full border-collapse",children:[n.jsx("thead",{children:n.jsxs("tr",{className:"bg-slate-50",children:[n.jsx("th",{className:"px-1 py-0.5 text-right",children:"#"}),n.jsx("th",{className:"px-1 py-0.5 text-right",children:"Title"}),n.jsx("th",{className:"px-1 py-0.5 text-right",children:"Date"}),n.jsx("th",{className:"px-1 py-0.5 text-right",children:"Conf."})]})}),n.jsx("tbody",{children:N.map((F,L)=>n.jsxs("tr",{className:"border-t border-slate-100",children:[n.jsx("td",{className:"px-1 py-0.5 text-right",children:F.reportNo??""}),n.jsx("td",{className:"px-1 py-0.5 text-right",children:F.title||""}),n.jsx("td",{className:"px-1 py-0.5 text-right",children:F.sentAt||""}),n.jsx("td",{className:"px-1 py-0.5 text-right",children:typeof F.confidence=="number"?`${Math.round(F.confidence)}%`:""})]},L))})]})})]})]}),n.jsxs("div",{className:"space-y-3",children:[n.jsxs("div",{className:"flex items-center justify-between",children:[n.jsx("div",{className:"font-semibold text-slate-800",children:"Previous reports table"}),n.jsx("button",{type:"button",onClick:S,disabled:r,className:"px-2 py-1 rounded border border-slate-300 text-[10px] hover:bg-slate-100",children:"+ Add row (Ctrl+Enter)"})]}),n.jsx("div",{className:"border border-slate-200 rounded bg-white max-h-72 overflow-auto",children:n.jsxs("table",{className:"min-w-full text-[11px]",children:[n.jsx("thead",{className:"bg-slate-50",children:n.jsxs("tr",{children:[n.jsx("th",{className:"px-1 py-1 text-right w-16",children:"Report #"}),n.jsx("th",{className:"px-1 py-1 text-right w-32",children:"Date"}),n.jsx("th",{className:"px-1 py-1 text-right",children:"Title"}),n.jsx("th",{className:"px-1 py-1 text-left w-16"})]})}),n.jsx("tbody",{children:e.reports.length===0?n.jsx("tr",{children:n.jsx("td",{colSpan:4,className:"px-2 py-2 text-center text-slate-400 text-[10px]",children:"  .      OCR ."})}):e.reports.map((F,L)=>{var O,H,M,I,D,J,ue,ce,le;return n.jsxs("tr",{className:"border-t border-slate-100",children:[n.jsxs("td",{className:"px-1 py-1 align-top",children:[n.jsx("input",{ref:fe=>{W.current[L]=fe},type:"number",className:`w-full border rounded px-1 py-0.5 text-[11px] ${(O=p[L])!=null&&O.reportNo?"border-rose-400":"border-slate-300"}`,value:F.reportNo??"",onChange:fe=>z(L,"reportNo",fe.target.value),onKeyDown:fe=>U(fe,L),disabled:r}),((H=p[L])==null?void 0:H.reportNo)&&n.jsx("div",{className:"mt-0.5 text-[9px] text-rose-600",children:(M=p[L])==null?void 0:M.reportNo})]}),n.jsxs("td",{className:"px-1 py-1 align-top",children:[n.jsx("input",{type:"date",className:`w-full border rounded px-1 py-0.5 text-[11px] ${(I=p[L])!=null&&I.sentAt?"border-rose-400":"border-slate-300"}`,value:F.sentAt||"",onChange:fe=>z(L,"sentAt",fe.target.value),onKeyDown:fe=>U(fe,L),disabled:r}),((D=p[L])==null?void 0:D.sentAt)&&n.jsx("div",{className:"mt-0.5 text-[9px] text-rose-600",children:(J=p[L])==null?void 0:J.sentAt})]}),n.jsxs("td",{className:"px-1 py-1 align-top",children:[n.jsx("input",{type:"text",className:`w-full border rounded px-1 py-0.5 text-[11px] ${(ue=p[L])!=null&&ue.title?"border-rose-400":"border-slate-300"}`,value:F.title,onChange:fe=>z(L,"title",fe.target.value),onKeyDown:fe=>U(fe,L),disabled:r}),((ce=p[L])==null?void 0:ce.title)&&n.jsx("div",{className:"mt-0.5 text-[9px] text-rose-600",children:(le=p[L])==null?void 0:le.title})]}),n.jsx("td",{className:"px-1 py-1 align-top text-left",children:n.jsx("button",{type:"button",onClick:()=>q(L),disabled:r,className:"px-1.5 py-0.5 rounded border border-slate-300 text-[10px] text-slate-700 hover:bg-slate-100",children:""})})]},L)})})]})}),n.jsxs("div",{className:"border border-slate-200 rounded bg-white p-2 space-y-2",children:[n.jsx("div",{className:"font-semibold text-slate-800 text-[11px]",children:"Extracted identifiers"}),n.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-2 text-[11px]",children:[n.jsxs("div",{className:"space-y-1",children:[n.jsx("label",{className:"block text-[10px] text-slate-600",children:"Insured"}),n.jsx("input",{type:"text",className:"w-full border rounded px-2 py-0.5 text-[11px] border-slate-300",value:e.insuredName||"",onChange:F=>a({...e,insuredName:F.target.value}),disabled:r})]}),n.jsxs("div",{className:"space-y-1",children:[n.jsx("label",{className:"block text-[10px] text-slate-600",children:"Plaintiff / Claimant"}),n.jsx("input",{type:"text",className:"w-full border rounded px-2 py-0.5 text-[11px] border-slate-300",value:e.plaintiffName||"",onChange:F=>a({...e,plaintiffName:F.target.value}),disabled:r})]}),n.jsxs("div",{className:"space-y-1",children:[n.jsx("label",{className:"block text-[10px] text-slate-600",children:"LineSlip No."}),n.jsx("input",{type:"text",className:"w-full border rounded px-2 py-0.5 text-[11px] border-slate-300",value:e.lineSlipNo||"",onChange:F=>a({...e,lineSlipNo:F.target.value}),disabled:r})]}),n.jsxs("div",{className:"space-y-1",children:[n.jsx("label",{className:"block text-[10px] text-slate-600",children:"Unique Market Ref"}),n.jsx("input",{type:"text",className:"w-full border rounded px-2 py-0.5 text-[11px] border-slate-300",value:e.marketRef||"",onChange:F=>a({...e,marketRef:F.target.value}),disabled:r})]})]})]})]})]}),n.jsx(wN,{})]})}const pl={title:"    ",subtitle:"     ,    ",actions:{openNewReport:"  "},queueItem:{noDate:" "}},Gu=(e,t)=>{console.error(`[LP-CRM] ${e}`,t)},_N=e=>{if(!e)return!1;const t=new Date(e);return Number.isNaN(t.getTime())?!1:t.getTime()>Date.now()},os=e=>{const{messageHe:t,...s}=e;return t?{...s,messageHe:t}:{...s,messageHe:{MISSING_PROVIDER:"    .",MISSING_DESCRIPTION:"  .",INVALID_DATE_FUTURE:"     .",INVALID_QUANTITY:"     -0.",INVALID_UNIT_PRICE:"     .",INVALID_VAT_RATE:"     .",NEGATIVE_AMOUNT:"     .",MISSING_ATTACHMENT_REQUIRED:"      .",SHEET_STATUS_INVALID_FOR_READY:"     -READY_FOR_REPORT.",SHEET_STATUS_INVALID_FOR_ATTACH:"     .",SHEET_STATUS_INVALID_FOR_SEND:"    .",SUMS_INCONSISTENT:"     .",INFO_ONLY_INCONSISTENT:'  " "     0.',SNAPSHOT_HASH_MISMATCH:"-Hash        ."}[s.code]||"  ."}},ON=(e,t,s)=>{const r=s.filter(u=>u.severity==="ERROR").map(u=>u.code),a=s.filter(u=>u.severity==="WARNING").map(u=>u.code),o=!s.some(u=>u.code==="SUMS_INCONSISTENT"),l=!s.some(u=>u.code==="MISSING_ATTACHMENT_REQUIRED"&&u.severity==="ERROR"),c=!s.some(u=>["MISSING_PROVIDER","MISSING_DESCRIPTION"].includes(u.code)),i=!s.some(u=>u.code==="INFO_ONLY_INCONSISTENT");return{evaluatedAt:new Date().toISOString(),insurerId:e.insurerId||void 0,rulesetId:t==null?void 0:t.insurerId,rulesetVersion:t==null?void 0:t.rulesetVersion,checks:{sumsValid:o,attachmentsOk:l,requiredFieldsOk:c,infoOnlyConsistent:i},blockingIssueCodes:r,warningIssueCodes:a}},MN=e=>{const t=[];return e.kind==="EXPENSE"&&!e.providerName&&t.push(os({code:"MISSING_PROVIDER",severity:"ERROR",scope:"LINE_ITEM",entityId:e.id})),e.description||t.push(os({code:"MISSING_DESCRIPTION",severity:"ERROR",scope:"LINE_ITEM",entityId:e.id})),_N(e.date)&&t.push(os({code:"INVALID_DATE_FUTURE",severity:"WARNING",scope:"LINE_ITEM",entityId:e.id})),e.quantity!=null&&e.quantity<=0&&t.push(os({code:"INVALID_QUANTITY",severity:"ERROR",scope:"LINE_ITEM",entityId:e.id})),e.unitPrice!=null&&e.unitPrice<0&&t.push(os({code:"INVALID_UNIT_PRICE",severity:"ERROR",scope:"LINE_ITEM",entityId:e.id})),e.vatRate!=null&&e.vatRate<0&&t.push(os({code:"INVALID_VAT_RATE",severity:"ERROR",scope:"LINE_ITEM",entityId:e.id})),[e.lineNetAmount,e.lineVatAmount,e.lineTotalAmount].filter(r=>r!=null).some(r=>r<0)&&t.push(os({code:"NEGATIVE_AMOUNT",severity:"ERROR",scope:"LINE_ITEM",entityId:e.id})),t},PN=(e,t,s,r)=>{if(!r)return[];const a=[],o={};s.forEach(c=>{o[c.id]=c});const l=r.amountThresholdRequiringAttachment??null;return t.forEach(c=>{const i=c.isIncludedInRequestedAmount!==!1,u=!!(c.attachmentId&&o[c.attachmentId]),p=c.lineTotalAmount??0;let y=!1;if(r.policyFamily==="STRICT")i&&c.kind==="EXPENSE"&&(!l||p>=l)&&(y=!0);else if(r.policyFamily==="PARTIAL"){const N=!!c.expenseType&&r.requireAttachmentForExpenseTypes.includes(c.expenseType),w=!!l&&p>=l;i&&(N||w)&&(y=!0)}else r.policyFamily==="FLEXIBLE"&&i&&c.kind==="EXPENSE"&&(!l||p>=l)&&(y=!0);if(y&&!u){const N=r.policyFamily==="FLEXIBLE"?"WARNING":"ERROR";a.push(os({code:"MISSING_ATTACHMENT_REQUIRED",severity:N,scope:"LINE_ITEM",entityId:c.id,messageHe:N==="ERROR"?"      .":"       ."}))}}),r.requiredAttachmentTypes.length>0&&a.push(os({code:"ATTACHMENT_TYPES_NOT_ENFORCED",severity:"INFO",scope:"SHEET",messageHe:"     ,      ."})),e.infoOnly&&a.length&&r.policyFamily,a},FN=e=>{const{sheet:t,lineItems:s,attachments:r,ruleset:a}=e,o=[];s.forEach(i=>{o.push(...MN(i))});const l=Fn(t,s);t.infoOnly&&l.amountToRequest!==0&&o.push(os({code:"INFO_ONLY_INCONSISTENT",severity:"ERROR",scope:"SHEET"})),o.push(...PN(t,s,r,a));const c=ON(t,a,o);return{issues:o,decisionLog:c}},Dp=e=>FN(e),BN=e=>{if(!e)return"";const t=new Date(e);if(Number.isNaN(t.getTime()))return"";const s=String(t.getDate()).padStart(2,"0"),r=String(t.getMonth()+1).padStart(2,"0"),a=t.getFullYear();return`${s}/${r}/${a}`},as=e=>(e??0).toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2}),ai=e=>{if(e.lineTotalAmount!=null)return e.lineTotalAmount;const t=e.lineNetAmount!=null?e.lineNetAmount:Th(e.quantity??0,e.unitPrice??0),s=e.lineVatAmount!=null?e.lineVatAmount:Rh(t,e.vatRate??0);return Ch(t,s)},Oh=(e,t,s)=>{const r=Fn(e,t),a=[`Expenses Table  Case ${e.caseId}`,"",`Deductible: ${as(e.deductibleAmount??0)}`,`Payments already made: ${as(e.alreadyPaidAmount??0)}`,`Amount to request: ${as(r.amountToRequest)}`,"","Expenses:"],o=[],l=[];let c=0;t.forEach(p=>{var z,q;const y=BN(p.date||null),N=p.providerName||"",w=p.description||"",R=p.kind==="EXPENSE"?"Expense":p.kind==="COMPENSATION"?p.compensationSource==="COURT"?"Compensation pursuant to a judgment":"Compensation pursuant to a settlement":"Adjustment",E=((z=s==null?void 0:s.isNewLine)==null?void 0:z.call(s,p))??!1,W=((q=s==null?void 0:s.isHistoricalLine)==null?void 0:q.call(s,p))??!1,b=as(ai(p)),h=p.vatRate!=null?`, VAT ${p.vatRate}%`:"",S=p.isIncludedInRequestedAmount===!1?" (not included in request)":"",U=` ${y||"-"}  ${E?"[] ":W?"[] ":""}${w}${N?` (${N})`:""}  ${b} (${R}${h})${S}`;if(p.kind==="EXPENSE"){const ee=ai(p);E&&(c+=ee),o.push(U)}else l.push(U)}),o.length||o.push(" No expense items.");const i=s&&typeof s.newExpensesTotal=="number"?s.newExpensesTotal:c;return{text:[...a,...o,"","Adjustments and compensations:",...l.length?l:[" No adjustments or compensations."],"",...i>0?[`Current report expenses only: ${as(i)}`]:[],`Total gross expenses: ${as(r.grossExpensesTotal)}`,`Total deductions (Deductible + Payments already made + adjustments): ${as(r.adjustmentsTotal)}`,`Amount to request: ${as(r.amountToRequest)}`].join(`
`),totals:r}},oi=(e,t,s)=>{const r=Fn(e,t),a=r.amountToRequest<=0,o=[],l=(S,P,U)=>{const z=U!=null&&U.isTotal?"total-balance-row":U!=null&&U.isSummary?"summary-row":"",q=(U==null?void 0:U.rowClass)??"",ee=`${z} ${q}`.trim();o.push(`<tr class="${ee}"><td>${$N(S)}</td><td class="amount-cell">${as(P??0)}</td></tr>`)},c=t.filter(S=>S.kind==="EXPENSE");let i=0;const u=c.reduce((S,P)=>{var L,O;const U=ai(P),z=((L=s==null?void 0:s.isNewLine)==null?void 0:L.call(s,P))??!1,q=((O=s==null?void 0:s.isHistoricalLine)==null?void 0:O.call(s,P))??!1;z&&(i+=U);const ee=P.providerName?` (${P.providerName})`:"",G=P.description?`${P.description}${ee}`:ee||"Expense",j=`${z?"  ":q?"  ":""}${G}`;return l(j,U,{rowClass:z?"expense-row-new":q?"expense-row-history":""}),S+U},0),p=e.deductibleAmount??0;t.filter(S=>S.kind==="COMPENSATION").forEach(S=>{const P=S.compensationSource==="COURT"?"Court-awarded compensation":"Settlement compensation";l(P,ai(S))}),l("Total expenses so far",u,{isSummary:!0});const N=s&&typeof s.newExpensesTotal=="number"?s.newExpensesTotal:i;N>0&&l("Current report expenses only",N,{isSummary:!0}),l("Deductible",p,{isSummary:!0}),l("Payments already made",e.alreadyPaidAmount??0,{isSummary:!0}),l(a?"Total Balance Due (no payment requested)":"Total Balance Due",r.amountToRequest,{isTotal:!0});const w=['<div class="expenses-table-wrapper">','<table class="expenses-table">',"<thead>",'<tr><th>Expenses</th><th class="amount-cell">Amount ()</th></tr>',"</thead>","<tbody>",...o,"</tbody>","</table>","</div>"].join(""),R=t.some(S=>S.kind==="COMPENSATION"&&S.compensationSource!=="COURT"),E=t.some(S=>S.kind==="COMPENSATION"&&S.compensationSource==="COURT"),W=`${as(r.amountToRequest)}`;let b;return E?b='<p class="expenses-payment-note">Pursuant to the judgment rendered in this matter, we kindly request that the Insurer arrange payment of the total amount set out in the attached Expenses Table, in order to bring this claim to a conclusion.<br/><br/><strong>Payment is required within 30 days of receipt of this report.</strong></p>':R?a?b='<p class="expenses-payment-note">Although a settlement has been agreed in principle, the total expenses and compensation fall within the applicable deductible. Accordingly, no payment is required from the Insurer in respect of this claim.</p>':b=`<p class="expenses-payment-note">Should the Insurer approve the settlement, we would be obliged if the Insurer could arrange payment of ${W} to the Brokers bank account in order to bring this claim to a conclusion. This amount represents an all-inclusive settlement, covering both the agreed compensation and the associated expenses. In the event that the settlement is not approved, no payment is required at this stage.</p>`:b=a?'<p class="expenses-payment-note">Given that the deductible exceeds the total expenses incurred in this matter, the Insurer is not required to make any payment in respect of this claim.</p>':`<p class="expenses-payment-note">Accordingly, we would appreciate it if the Insurer could transfer the amount of ${W} to the Brokers bank account.</p>`,{html:w+b+'<p class="expenses-payment-note">All amounts are stated in New Israeli Shekels ().</p>',totals:r}},$N=e=>e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;"),HN=({open:e,title:t,message:s,confirmText:r,cancelText:a,destructive:o=!1,onConfirm:l,onCancel:c})=>{const i=g.useRef(null);if(g.useEffect(()=>{if(!e)return;const y=N=>{N.key==="Escape"&&(N.stopPropagation(),c())};if(typeof window<"u"&&window.addEventListener("keydown",y),i.current)try{i.current.focus()}catch{}return()=>{typeof window<"u"&&window.removeEventListener("keydown",y)}},[e,c]),!e)return null;const u=y=>{y.target===y.currentTarget&&c()},p=o?"bg-danger text-white hover:bg-red-800":"bg-navy text-gold hover:bg-navySecondary";return n.jsx("div",{className:"fixed inset-0 z-[300] flex items-center justify-center bg-black/50",onClick:u,children:n.jsxs("div",{className:"bg-panel border border-borderDark rounded-xl shadow-xl max-w-md w-full mx-4 p-5 space-y-3",dir:"rtl",children:[n.jsx("h2",{className:"text-sm font-bold text-gold text-right",children:t}),s&&n.jsx("p",{className:"text-xs text-textMuted text-right whitespace-pre-line",children:s}),n.jsxs("div",{className:"flex justify-end gap-2 mt-4",children:[n.jsx("button",{type:"button",onClick:c,className:"px-3 py-1.5 rounded-md border border-borderDark text-xs text-textLight bg-navySecondary hover:bg-borderDark",children:a}),n.jsx("button",{type:"button",ref:i,onClick:l,className:`px-3 py-1.5 rounded-md text-xs font-semibold ${p}`,children:r})]})]})})},Mh={DRAFT:"",READY_FOR_REPORT:" ",ATTACHED_TO_REPORT:" ",ARCHIVED:""};function Ph(e,t){if(t){if(t.status==="SENT")return t.isPaid?"":"  ";const r={TASK_ASSIGNED:" ",WAITING_FOR_INVOICES:" ",PENDING_REVIEW:" ",READY_TO_SEND:"   ",SENT:"  "}[t.status];if(r)return r}return Mh[e.status]}function UN(e){return Mh[e]}const WN=[{value:"DRAFT",label:""},{value:"READY_FOR_REPORT",label:" "},{value:"ATTACHED_TO_REPORT",label:" "},{value:"ARCHIVED",label:""}],zN=({user:e,sheet:t,paymentEvents:s,onChangeEvents:r})=>{const[a,o]=g.useState(""),[l,c]=g.useState(()=>new Date().toISOString().slice(0,10)),[i,u]=g.useState(""),[p,y]=g.useState(""),[N,w]=g.useState(!1),[R,E]=g.useState(null),W=async()=>{const S=Number(a);if(!Number.isFinite(S)||S<=0){E("     .");return}if(!l){E("    .");return}const U=new Date(l).getTime();if(Number.isNaN(U)){E("   .");return}const z=Date.now();if(U>z){E("     .");return}E(null),w(!0);try{const q=new Date(l).toISOString(),ee=await Xe.createPaymentEvent(e,{caseId:t.caseId,sheetId:t.id,amount:S,paidAt:q,reference:i||null,note:p||null});r([...s,ee]),o(""),u(""),y(""),E(null)}finally{w(!1)}},b=async S=>{await Xe.softDeletePaymentEvent(S),r(s.filter(P=>P.id!==S))},h=s.filter(S=>!S.isDeleted).sort((S,P)=>{const U=new Date(S.paidAt).getTime();return new Date(P.paidAt).getTime()-U});return n.jsxs("div",{className:"space-y-3",children:[n.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-2 items-end",children:[n.jsxs("div",{children:[n.jsx("label",{className:"block text-[11px] font-medium text-slate-700 mb-1",children:"  ()"}),n.jsx("input",{type:"number",className:"w-full border rounded px-2 py-1 text-xs",value:a,onChange:S=>o(S.target.value),min:0})]}),n.jsxs("div",{children:[n.jsx("label",{className:"block text-[11px] font-medium text-slate-700 mb-1",children:" "}),n.jsx("input",{type:"date",className:"w-full border rounded px-2 py-1 text-xs",value:l,onChange:S=>c(S.target.value)})]}),n.jsxs("div",{children:[n.jsx("label",{className:"block text-[11px] font-medium text-slate-700 mb-1",children:" (  / )"}),n.jsx("input",{type:"text",className:"w-full border rounded px-2 py-1 text-xs",value:i,onChange:S=>u(S.target.value)})]}),n.jsxs("div",{children:[n.jsx("label",{className:"block text-[11px] font-medium text-slate-700 mb-1",children:"  ()"}),n.jsxs("div",{className:"flex gap-2",children:[n.jsx("input",{type:"text",className:"flex-1 border rounded px-2 py-1 text-xs",value:p,onChange:S=>y(S.target.value)}),n.jsx("button",{type:"button",className:"px-3 py-1 text-xs rounded bg-emerald-600 text-white hover:bg-emerald-700 disabled:opacity-50",onClick:W,disabled:N,children:" "})]})]})]}),R&&n.jsx("div",{className:"text-[11px] text-red-600 px-1",children:R}),n.jsx("div",{className:"border-t border-slate-200 pt-2",children:h.length===0?n.jsx("p",{className:"text-[11px] text-slate-500",children:"    .       ."}):n.jsx("div",{className:"space-y-1",children:h.map(S=>n.jsxs("div",{className:"flex flex-wrap items-baseline gap-x-4 gap-y-1 rounded border border-slate-200 bg-white px-2 py-1",children:[n.jsxs("span",{className:"font-medium text-slate-800",children:["",S.amount.toLocaleString("he-IL")]}),n.jsxs("span",{className:"text-slate-600",children:[""," ",new Date(S.paidAt).toLocaleDateString("he-IL",{year:"numeric",month:"2-digit",day:"2-digit"})]}),S.reference&&n.jsxs("span",{className:"text-slate-600",children:[": ",S.reference]}),S.note&&n.jsxs("span",{className:"text-slate-600",children:[": ",S.note]}),n.jsx("button",{type:"button",className:"ml-auto text-xs text-red-600 hover:underline",onClick:()=>b(S.id),children:""})]},S.id))})})]})},Fh=({user:e,sheetWithRelations:t,onSheetUpdated:s,onBack:r,onNotifyLawyer:a,linkedReportForLawyer:o})=>{const[l,c]=g.useState(t.sheet),[i,u]=g.useState(t.lineItems),[p,y]=g.useState(!1),[N,w]=g.useState(null),[R,E]=g.useState(null),[W,b]=g.useState([]),[h,S]=g.useState(t.attachments),[P,U]=g.useState(!1),[z,q]=g.useState(""),[ee,G]=g.useState([]),[se,j]=g.useState([]),[F,L]=g.useState("AUTO"),[O,H]=g.useState([]),[M,I]=g.useState([]),[D,J]=g.useState([]),[ue,ce]=g.useState(null),[le,fe]=g.useState(""),[Ee,ve]=g.useState(!1),$e=(o==null?void 0:o.isPaid)===!0,Ze=e.role==="ADMIN"||e.role==="SUB_ADMIN"||e.role==="FINANCE",Oe=$e&&!Ze,Ye=$e&&(e.role==="ADMIN"||e.role==="SUB_ADMIN"),ot=g.useMemo(()=>Xe.getPaidToDateForSheet(l),[l,M]),X=g.useMemo(()=>({...l,alreadyPaidAmount:ot}),[l,ot]);g.useEffect(()=>{c(t.sheet),u(t.lineItems),S(t.attachments),ve(!1),(async()=>{try{const ie=t.sheet.caseId,_e=Se(ie);if(!_e){H([]),I([]);return}const Me=await Xe.listPaymentsForCase(ie);I(Me);const Ce=(await Xe.listSheets()).filter(Ge=>Ge.id!==t.sheet.id).filter(Ge=>Se(Ge.caseId)===_e);if(!Ce.length){H([]),J([]);return}Ce.sort((Ge,ft)=>{const Yt=new Date(Ge.updatedAt||Ge.createdAt).getTime();return new Date(ft.updatedAt||ft.createdAt).getTime()-Yt});const ae=Ce.slice(0,3),Re=[],rt=[];for(const Ge of ae){const ft=await Xe.getSheet(Ge.id);if(!ft)continue;const Yt=Xe.getPaidToDateForSheet(ft.sheet),en=Fn({...ft.sheet,alreadyPaidAmount:Yt},ft.lineItems),Ds=ft.lineItems.filter(fs=>fs.kind==="EXPENSE");rt.push(...Ds),Re.push({id:ft.sheet.id,versionIndex:ft.sheet.versionIndex,status:ft.sheet.status,createdAt:ft.sheet.createdAt,updatedAt:ft.sheet.updatedAt,deductibleAmount:ft.sheet.deductibleAmount??0,alreadyPaidAmount:Yt,amountToRequest:en.amountToRequest})}Re.sort((Ge,ft)=>{const Yt=new Date(Ge.updatedAt||Ge.createdAt).getTime();return new Date(ft.updatedAt||ft.createdAt).getTime()-Yt}),H(Re),J(rt);const Zt=Xe.buildCumulativeExpensesSnapshot(t.sheet.id,new Date().toISOString());if(Zt){const Ge=Fn(Zt.effectiveSheet,Zt.allLines);ce(Ge)}else ce(null)}catch{H([]),I([]),J([]),ce(null)}})()},[t]);const ne=g.useMemo(()=>Fn(X,i),[X,i]),C=g.useMemo(()=>{const V=new Set;return W.forEach(ie=>{ie.scope==="LINE_ITEM"&&ie.entityId&&V.add(ie.entityId)}),V},[W]),re=()=>{const V=Dp({sheet:l,lineItems:i,attachments:h,ruleset:void 0});b(V.issues)};g.useEffect(()=>{re()},[l,i]),g.useEffect(()=>{if(!(typeof window>"u"))try{const V=window.localStorage.getItem("financeProviderSuggestions"),ie=window.localStorage.getItem("financeDescriptionSuggestions");if(V){const _e=JSON.parse(V);Array.isArray(_e)&&G(_e.filter(Me=>typeof Me=="string"))}if(ie){const _e=JSON.parse(ie);Array.isArray(_e)&&j(_e.filter(Me=>typeof Me=="string"))}}catch{}},[]),g.useEffect(()=>{if(typeof window>"u")return;const V=new Set(ee);let ie=!1;if(i.forEach(he=>{const Ce=(he.providerName||"").trim();Ce&&!V.has(Ce)&&(V.add(Ce),ie=!0)}),ie){const he=Array.from(V).sort((Ce,ae)=>Ce.localeCompare(ae,"he-IL"));G(he);try{window.localStorage.setItem("financeProviderSuggestions",JSON.stringify(he))}catch{}}const _e=new Set(se);let Me=!1;if(i.forEach(he=>{const Ce=(he.description||"").trim();Ce&&!_e.has(Ce)&&(_e.add(Ce),Me=!0)}),Me){const he=Array.from(_e).sort((Ce,ae)=>Ce.localeCompare(ae,"he-IL"));j(he);try{window.localStorage.setItem("financeDescriptionSuggestions",JSON.stringify(he))}catch{}}},[i]);const te=V=>{Oe||(ve(!0),c(ie=>({...ie,...V})))},pe=(V,ie)=>{Oe||(ve(!0),u(_e=>{const Me=[..._e];return Me[V]={...Me[V],...ie,sheetId:l.id},Me}))},Be=()=>{if(Oe)return;ve(!0);const V={id:`tmp-${Date.now()}`,sheetId:l.id,kind:"EXPENSE",expenseType:null,providerName:"",providerId:null,description:"",date:new Date().toISOString().slice(0,10),quantity:1,unitPrice:0,vatRate:18,isIncludedInRequestedAmount:!0,lineNetAmount:null,lineVatAmount:null,lineTotalAmount:null,attachmentId:null,createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()};u(ie=>[...ie,V])},je=V=>{if(Oe)return;ve(!0);const ie=i[V];ie&&(u(_e=>_e.filter((Me,he)=>he!==V)),ie.id.startsWith("tmp-")||Xe.deleteLineItem(e,l.id,ie.id))},Te=async V=>{if(Oe)return;const ie=Array.from(V);if(ie.length)for(let _e=0;_e<ie.length;_e++){const Me=ie[_e],he=new FileReader,Ce=await new Promise((Re,rt)=>{he.onload=()=>Re(String(he.result)),he.onerror=()=>rt(he.error),he.readAsDataURL(Me)}),ae=await Xe.addAttachment(e,l.id,{fileKey:Ce,originalFileName:Me.name,mimeType:Me.type||"application/octet-stream",sizeBytes:Me.size});ae&&(ve(!0),S(Re=>[...Re,ae]))}},et=async V=>{const{files:ie}=V.target;!ie||!ie.length||(await Te(ie),V.target.value="")},Ve=async V=>{V.preventDefault(),V.stopPropagation();const{files:ie}=V.dataTransfer;!ie||!ie.length||await Te(ie)},He=async(V,ie)=>{if(Oe)return;ve(!0);const _e=ie||"";try{const Me=await Xe.linkAttachmentToLineItem(e,l.id,_e,ie?V.id:null);S(he=>he.map(Ce=>Me&&Ce.id===Me.id?Me:!Me&&Ce.id===_e?{...Ce,linkedLineItemId:ie?V.id:null}:Ce)),u(he=>he.map(Ce=>Ce.id===V.id?{...Ce,attachmentId:ie||null}:Ce.id===V.attachmentId&&!ie?{...Ce,attachmentId:null}:Ce)),w(ie?" /     .":"    .")}catch(Me){console.error("Failed to link attachment to line item",Me)}},Q=async()=>{if(Oe)return;if(Ye){const ie=le.trim();if(!ie){w("   (     ).");return}Xe.recordAdminEditAfterPaid(e,l.id,ie)}if(!((e.role==="SUB_ADMIN"||e.role==="ADMIN")&&!Ye&&(l.status==="READY_FOR_REPORT"||l.status==="ATTACHED_TO_REPORT"||l.status==="ARCHIVED")&&!window.confirm(`     (  /   / ).
         .

  ?`))){y(!0);try{const ie=await Xe.updateSheetMeta(e,l.id,{insurerName:l.insurerName,periodLabel:l.periodLabel,deductibleAmount:l.deductibleAmount??0,alreadyPaidAmount:l.alreadyPaidAmount??0,infoOnly:l.infoOnly}),_e=[];for(const he of i)if(he.id.startsWith("tmp-")){const Ce=await Xe.addLineItem(e,l.id,{kind:he.kind,expenseType:he.expenseType,providerName:he.providerName,providerId:he.providerId,description:he.description,date:he.date,quantity:he.quantity,unitPrice:he.unitPrice,vatRate:he.vatRate,isIncludedInRequestedAmount:he.isIncludedInRequestedAmount,lineNetAmount:he.lineNetAmount,lineVatAmount:he.lineVatAmount,lineTotalAmount:he.lineTotalAmount,attachmentId:he.attachmentId});Ce&&_e.push(Ce)}else{const Ce=await Xe.updateLineItem(e,l.id,he.id,{kind:he.kind,expenseType:he.expenseType,providerName:he.providerName,providerId:he.providerId,description:he.description,date:he.date,quantity:he.quantity,unitPrice:he.unitPrice,vatRate:he.vatRate,isIncludedInRequestedAmount:he.isIncludedInRequestedAmount,lineNetAmount:he.lineNetAmount,lineVatAmount:he.lineVatAmount,lineTotalAmount:he.lineTotalAmount,attachmentId:he.attachmentId});Ce&&_e.push(Ce)}const Me=await Xe.getSheet(l.id)||{sheet:ie||l,lineItems:_e,attachments:[]};s(Me),ve(!1),w("  .")}finally{y(!1)}}},be=()=>{Ee&&!window.confirm("   .   ?")||r()};g.useEffect(()=>{if(!Ee)return;const V=ie=>{ie.preventDefault(),ie.returnValue=""};return window.addEventListener("beforeunload",V),()=>window.removeEventListener("beforeunload",V)},[Ee]);const xe=Xa(l.caseId)===l.id,Ne=Ph(l,o),Fe=async()=>{y(!0);try{const V=await Xe.getRulesetForSheet(l),ie=Dp({sheet:l,lineItems:i,attachments:h,ruleset:V}),_e=ie.issues.map(Ce=>Ce.code==="MISSING_ATTACHMENT_REQUIRED"&&Ce.severity==="ERROR"?{...Ce,severity:"WARNING"}:Ce);b(_e);const Me=_e.filter(Ce=>Ce.severity==="ERROR"&&Ce.code!=="MISSING_ATTACHMENT_REQUIRED");if(Me.length){const Ce=Me.map(ae=>` ${ae.messageHe}`).join(`
`);q(Ce),U(!0),w("          .");return}const he=await Xe.recordReadyAttempt(e,{sheetId:l.id,success:!0,decisionLog:ie.decisionLog});if(he){c(he);const Ce=await Xe.getSheet(he.id)||{sheet:he,lineItems:i,attachments:h};s(Ce),a&&a({caseId:he.caseId,sheetId:he.id,lawyerId:F==="AUTO"?void 0:F});const ae=F==="AUTO"?(o==null?void 0:o.ownerName)||"  ":(o==null?void 0:o.ownerName)||" ";w(`       ${ae}   ${he.caseId}.`)}}finally{y(!1)}},Le=()=>{const V=Xe.buildCumulativeExpensesSnapshot(l.id,new Date().toISOString());if(!V)return;const{effectiveSheet:ie,allLines:_e,opts:Me}=V,{html:he}=oi(ie,_e,Me);E(he)},Ke=V=>C.has(V),dt=g.useMemo(()=>{const V=new Set(ee);return i.forEach(ie=>{ie.providerName&&V.add(ie.providerName)}),Array.from(V).sort((ie,_e)=>ie.localeCompare(_e,"he-IL"))},[i,ee]),Ue=g.useMemo(()=>{const V=new Set(se);return i.forEach(ie=>{ie.description&&V.add(ie.description)}),Array.from(V).sort((ie,_e)=>ie.localeCompare(_e,"he-IL"))},[i,se]),st=()=>{const V={sheet:l,lineItems:i,attachments:h,totals:ne},ie=new Blob([JSON.stringify(V,null,2)],{type:"application/json"}),_e=URL.createObjectURL(ie),Me=document.createElement("a");Me.href=_e,Me.download=`expenses-${l.caseId||l.id}.json`,Me.click(),URL.revokeObjectURL(_e)},Rt=()=>{const V=["LineId","Date","Provider","Description","Quantity","UnitPrice","VatRate","IncludedInRequest","LineTotal"],ie=i.map(ae=>[ae.id,ae.date||"",(ae.providerName||"").replace(/"/g,'""'),(ae.description||"").replace(/"/g,'""'),ae.quantity??"",ae.unitPrice??"",ae.vatRate??"",ae.isIncludedInRequestedAmount!==!1?"YES":"NO",ae.lineTotalAmount??""]),_e=[V.join(","),...ie.map(ae=>ae.map(Re=>{const rt=String(Re??"");return/[",\n]/.test(rt)?`"${rt}"`:rt}).join(","))].join(`
`),Me=new Blob(["\uFEFF"+_e],{type:"text/csv;charset=utf-8;"}),he=URL.createObjectURL(Me),Ce=document.createElement("a");Ce.href=he,Ce.download=`expenses-${l.caseId||l.id}.csv`,Ce.click(),URL.revokeObjectURL(he)},yt=g.useMemo(()=>o?[{id:o.createdBy,name:o.ownerName||'" '}]:[],[o]);return n.jsxs("div",{className:"flex flex-col gap-4",children:[$e&&n.jsx("div",{className:"rounded-lg border border-amber-300 bg-amber-50 px-4 py-3 text-sm text-amber-900",children:Oe?n.jsxs("div",{children:[n.jsx("strong",{children:"      ."}),n.jsx("p",{className:"mt-1 text-amber-800",children:"FINANCE, ADMIN  SUB_ADMIN    ."})]}):Ye?n.jsxs("div",{children:[n.jsx("strong",{children:"    (ADMIN)."}),n.jsx("p",{className:"mt-2 text-amber-800",children:"     ."}),n.jsx("input",{type:"text",className:"mt-2 w-full max-w-md border border-amber-300 rounded px-3 py-1.5 text-sm",placeholder:"  ()",value:le,onChange:V=>fe(V.target.value)})]}):n.jsxs("div",{children:[n.jsx("strong",{children:"    (Snapshot )."}),n.jsx("p",{className:"mt-1 text-amber-800",children:"  .   ;    Snapshot     ."})]})}),n.jsxs("div",{className:"flex items-center justify-between",children:[n.jsxs("div",{children:[n.jsxs("h2",{className:"text-xl font-semibold text-gray-900 flex items-center gap-2",children:["  : ",n.jsx("span",{className:"font-mono",children:l.caseId}),xe?n.jsx("span",{className:"inline-flex px-2 py-0.5 rounded-full text-xs font-medium bg-emerald-100 text-emerald-800 border border-emerald-200",children:""}):n.jsx("span",{className:"inline-flex px-2 py-0.5 rounded-full text-xs font-medium bg-gray-100 text-gray-600 border border-gray-200",children:""})]}),n.jsxs("p",{className:"text-sm text-gray-600 mt-1",children:[": ",n.jsx("span",{className:"font-medium",children:Ne})]})]}),n.jsxs("div",{className:"flex gap-3 flex-wrap justify-end items-center",children:[yt.length>0&&n.jsxs("div",{className:"text-xs text-gray-700",children:[n.jsx("label",{className:"block mb-1 font-medium",children:"     "}),n.jsxs("select",{className:"border rounded px-2 py-1 text-xs bg-white",value:F,onChange:V=>L(V.target.value||"AUTO"),children:[n.jsx("option",{value:"AUTO",children:'   "  '}),yt.map(V=>n.jsx("option",{value:V.id,children:V.name},V.id))]})]}),n.jsx("button",{type:"button",className:"px-3 py-1 text-sm rounded border border-gray-300 text-gray-700 hover:bg-gray-50",onClick:be,children:" "}),n.jsx("button",{type:"button",className:"px-3 py-1.5 text-sm rounded border border-blue-300 text-blue-700 hover:bg-blue-50",onClick:Le,children:" "}),!Oe&&n.jsx("button",{type:"button",className:"px-4 py-1.5 text-sm rounded bg-emerald-600 text-white hover:bg-emerald-700 disabled:opacity-50",onClick:Fe,disabled:p,children:"   "}),n.jsx("button",{type:"button",className:"px-4 py-1.5 text-sm rounded bg-blue-600 text-white hover:bg-blue-700 disabled:opacity-50",onClick:Q,disabled:p||Oe,children:p?"":Ee?"  ( )":" "}),e.role==="ADMIN"&&n.jsx("button",{type:"button",className:"px-3 py-1.5 text-xs rounded border border-gray-300 text-gray-700 hover:bg-gray-50",onClick:st,children:" JSON"}),n.jsx("button",{type:"button",className:"px-3 py-1.5 text-xs rounded border border-gray-300 text-gray-700 hover:bg-gray-50",onClick:Rt,children:" Excel (CSV)"})]})]}),N&&n.jsx("div",{className:"mt-2 rounded border border-green-200 bg-green-50 px-3 py-2 text-sm text-green-800",children:N}),R&&n.jsxs("div",{className:"mt-2 rounded border border-gray-300 bg-white px-3 py-3 text-sm text-left",children:[n.jsxs("div",{className:"flex justify-between items-center mb-2",children:[n.jsx("span",{className:"font-semibold text-gray-800",children:"Expenses Table  Preview"}),n.jsx("button",{type:"button",className:"text-sm text-blue-600 hover:underline",onClick:()=>E(null),children:""})]}),n.jsx("div",{className:"overflow-x-auto text-base",dangerouslySetInnerHTML:{__html:R}})]}),n.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 bg-white border rounded-lg p-4 shadow-sm",children:[n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:""}),n.jsx("input",{className:"w-full border rounded px-2 py-1 text-sm disabled:bg-gray-100 disabled:cursor-not-allowed",value:l.insurerName||"",onChange:V=>te({insurerName:V.target.value}),disabled:Oe})]}),n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:" / "}),n.jsx("input",{className:"w-full border rounded px-2 py-1 text-sm disabled:bg-gray-100 disabled:cursor-not-allowed",value:l.periodLabel||"",onChange:V=>te({periodLabel:V.target.value}),disabled:Oe})]}),n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:" "}),n.jsx("input",{type:"number",className:"w-full border rounded px-2 py-1 text-sm disabled:bg-gray-100 disabled:cursor-not-allowed",value:l.deductibleAmount??0,onChange:V=>{const ie=Number(V.target.value),_e=Number.isFinite(ie)?Math.max(0,ie):0;te({deductibleAmount:_e})},disabled:Oe})]}),n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"  "}),n.jsx("input",{type:"number",className:"w-full border rounded px-2 py-1 text-sm bg-gray-50",value:ot,readOnly:!0})]}),n.jsxs("div",{className:"flex items-center gap-2 mt-2",children:[n.jsx("input",{id:"infoOnly",type:"checkbox",checked:l.infoOnly,onChange:V=>te({infoOnly:V.target.checked}),disabled:Oe}),n.jsx("label",{htmlFor:"infoOnly",className:"text-sm text-gray-800",children:"   (  )"})]})]}),n.jsxs("div",{className:"flex flex-col gap-2",children:[n.jsxs("div",{className:"flex items-center justify-between text-xs text-gray-700 px-1",children:[n.jsx("span",{className:"font-semibold",children:"    (  )"}),n.jsx("span",{className:"text-gray-500",children:"   / PDF     ."})]}),n.jsxs("div",{className:"flex flex-wrap gap-4 items-center bg-blue-50 border border-blue-100 rounded-lg p-4 text-sm",children:[n.jsxs("div",{children:[n.jsx("div",{className:"text-gray-600",children:"   "}),n.jsxs("div",{className:"font-semibold",children:[ne.grossExpensesTotal.toLocaleString("he-IL")," "]})]}),n.jsxs("div",{children:[n.jsx("div",{className:"text-gray-600",children:"   (  +  + )"}),n.jsxs("div",{className:"font-semibold",children:[ne.adjustmentsTotal.toLocaleString("he-IL")," "]})]}),n.jsxs("div",{children:[n.jsx("div",{className:"text-gray-600",children:"    (   )"}),n.jsxs("div",{className:"font-semibold",children:[ne.amountBeforeInfoOnly.toLocaleString("he-IL")," "]})]}),n.jsxs("div",{children:[n.jsx("div",{className:"text-gray-600",children:"   "}),n.jsxs("div",{className:"font-semibold text-blue-700",children:[ne.amountToRequest.toLocaleString("he-IL")," "]})]}),ne.infoOnlyApplied&&n.jsx("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-yellow-100 text-yellow-800",children:"  (  )"})]}),n.jsx("div",{className:"px-1 text-[11px] text-gray-500",children:" :         .   (Expenses Table)   -PDF        ."})]}),ue&&n.jsxs("div",{className:"mt-3 flex flex-col gap-2",children:[n.jsx("div",{className:"flex items-center justify-between text-xs text-slate-700 px-1",children:n.jsx("span",{className:"font-semibold",children:"   ( +  )"})}),n.jsxs("div",{className:"flex flex-wrap gap-4 items-center bg-indigo-50 border border-indigo-100 rounded-lg p-4 text-sm",children:[n.jsxs("div",{children:[n.jsx("div",{className:"text-slate-600",children:"   "}),n.jsxs("div",{className:"font-semibold",children:[ue.grossExpensesTotal.toLocaleString("he-IL")," "]})]}),n.jsxs("div",{children:[n.jsx("div",{className:"text-slate-600",children:"  (  +  + )"}),n.jsxs("div",{className:"font-semibold",children:[ue.adjustmentsTotal.toLocaleString("he-IL")," "]})]}),n.jsxs("div",{children:[n.jsx("div",{className:"text-slate-600",children:"   "}),n.jsxs("div",{className:"font-semibold",children:[ot.toLocaleString("he-IL")," "]})]}),n.jsxs("div",{children:[n.jsx("div",{className:"text-slate-600",children:"  /  ()"}),n.jsxs("div",{className:"font-semibold text-indigo-700",children:[ue.amountToRequest.toLocaleString("he-IL")," "]})]})]})]}),n.jsxs("div",{className:"mt-2 text-xs text-gray-500 bg-white border border-dashed border-gray-300 rounded-md p-2",children:[n.jsx("span",{className:"font-semibold mr-1",children:" :"}),"    (, , , ,  ).       ,            ."]}),n.jsxs("div",{className:"bg-white border rounded-lg p-4 shadow-sm flex flex-col gap-2 text-sm",onDragOver:V=>{V.preventDefault(),V.stopPropagation()},onDrop:Ve,children:[n.jsxs("div",{className:"flex items-center justify-between",children:[n.jsx("div",{className:"font-medium text-gray-900",children:""}),n.jsxs("label",{className:"inline-flex items-center gap-2 cursor-pointer text-xs text-blue-700 hover:text-blue-800",children:[n.jsx("span",{className:"px-2 py-1 border border-blue-400 rounded bg-blue-50",children:" "}),n.jsx("input",{type:"file",className:"hidden",multiple:!0,onChange:et})]})]}),n.jsx("p",{className:"text-xs text-gray-500",children:"         ."}),h.length===0?n.jsx("div",{className:"text-gray-500 text-xs",children:"    ."}):n.jsx("ul",{className:"divide-y divide-gray-100",children:h.map(V=>n.jsxs("li",{className:"py-1 flex items-center justify-between gap-4",children:[n.jsxs("div",{className:"flex flex-col",children:[n.jsx("span",{className:"text-gray-900 text-xs",children:V.originalFileName}),n.jsxs("span",{className:"text-gray-500 text-[11px]",children:[": ",V.sizeBytes!=null?`${(V.sizeBytes/1024).toFixed(1)} KB`:" ","  "," ",V.uploadedAt?new Date(V.uploadedAt).toLocaleString("he-IL",{dateStyle:"short",timeStyle:"short"}):""]})]}),n.jsx("button",{type:"button",className:"text-xs text-blue-700 hover:underline",onClick:()=>{V.fileKey.startsWith("data:")&&window.open(V.fileKey,"_blank")},children:" / "})]},V.id))})]}),W.length>0&&n.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-lg p-3 text-sm",children:[n.jsx("div",{className:"font-semibold text-red-800 mb-1",children:"  :"}),n.jsx("ul",{className:"list-disc pr-5 space-y-0.5",children:W.map(V=>n.jsxs("li",{children:[n.jsxs("span",{className:"font-mono text-xs text-gray-500 ml-1",children:["[",V.severity,"]"]}),n.jsxs("span",{className:"text-red-900",children:[" ",V.messageHe]})]},`${V.code}-${V.scope}-${V.entityId||"sheet"}`))})]}),n.jsxs("div",{className:"bg-white border rounded-lg shadow-sm overflow-x-auto",children:[n.jsxs("table",{className:"min-w-full text-sm",children:[n.jsx("thead",{className:"bg-gray-50",children:n.jsxs("tr",{children:[n.jsx("th",{className:"px-2 py-1 border-b text-right",children:""}),n.jsx("th",{className:"px-2 py-1 border-b text-right",children:""}),n.jsx("th",{className:"px-2 py-1 border-b text-right",children:""}),n.jsx("th",{className:"px-2 py-1 border-b text-right",children:""}),n.jsx("th",{className:"px-2 py-1 border-b text-right",children:""}),n.jsx("th",{className:"px-2 py-1 border-b text-right",children:" "}),n.jsx("th",{className:"px-2 py-1 border-b text-right",children:" %"}),n.jsx("th",{className:"px-2 py-1 border-b text-right",children:" "}),n.jsx("th",{className:"px-2 py-1 border-b text-right",children:" "}),n.jsx("th",{className:"px-2 py-1 border-b text-right",children:""}),n.jsx("th",{className:"px-2 py-1 border-b"})]})}),n.jsxs("tbody",{children:[D.length>0&&n.jsx("tr",{children:n.jsx("td",{className:"px-2 py-1 border-b text-xs text-slate-600 bg-slate-50",colSpan:9,children:"  ( )      ."})}),D.map((V,ie)=>{if(V.kind!=="EXPENSE")return null;const _e=V.lineTotalAmount??(V.quantity??0)*(V.unitPrice??0)*(1+(V.vatRate??0)/100);return n.jsxs("tr",{className:"bg-slate-50 text-slate-700",children:[n.jsx("td",{className:"px-2 py-1 border-b text-[11px] text-slate-500",children:""}),n.jsx("td",{className:"px-2 py-1 border-b text-xs",children:V.providerName||""}),n.jsx("td",{className:"px-2 py-1 border-b text-xs",children:V.description||""}),n.jsx("td",{className:"px-2 py-1 border-b text-xs whitespace-nowrap",children:V.date||""}),n.jsx("td",{className:"px-2 py-1 border-b text-xs",children:V.quantity??""}),n.jsx("td",{className:"px-2 py-1 border-b text-xs",children:V.unitPrice??""}),n.jsx("td",{className:"px-2 py-1 border-b text-xs",children:V.vatRate??""}),n.jsx("td",{className:"px-2 py-1 border-b text-xs",children:Number.isFinite(_e)?_e.toLocaleString("he-IL"):""}),n.jsx("td",{className:"px-2 py-1 border-b text-[11px] text-slate-400",children:" "})]},`hist-${V.id}-${ie}`)}),i.map((V,ie)=>{const _e=Ke(V.id),Me=h.find(Re=>Re.id===V.attachmentId),he=V.kind==="COMPENSATION",Ce=V.kind==="EXPENSE",ae=V.kind==="COMPENSATION"?V.compensationSource==="COURT"?"COMPENSATION_COURT":"COMPENSATION_SETTLEMENT":V.kind;return n.jsxs("tr",{className:`${_e?"bg-red-50 text-gray-900":ie%2===0?"bg-white":"bg-gray-50"} ${Ce?"border-l-4 border-emerald-300 bg-emerald-50/60 text-gray-900":""}`,children:[n.jsx("td",{className:"px-2 py-1 border-b",children:n.jsxs("select",{className:"border rounded px-1 py-0.5 text-xs",value:ae,onChange:Re=>{const rt=Re.target.value;rt==="EXPENSE"?pe(ie,{kind:"EXPENSE",compensationSource:null}):rt==="ADJUSTMENT"?pe(ie,{kind:"ADJUSTMENT",compensationSource:null}):rt==="COMPENSATION_SETTLEMENT"?pe(ie,{kind:"COMPENSATION",compensationSource:"SETTLEMENT",providerName:"",expenseType:null,vatRate:0,quantity:1}):rt==="COMPENSATION_COURT"&&pe(ie,{kind:"COMPENSATION",compensationSource:"COURT",providerName:"",expenseType:null,vatRate:0,quantity:1})},children:[n.jsx("option",{value:"EXPENSE",children:"Expense"}),n.jsx("option",{value:"COMPENSATION_SETTLEMENT",children:"Compensation pursuant to a settlement"}),n.jsx("option",{value:"COMPENSATION_COURT",children:"Compensation pursuant to a judgment"}),n.jsx("option",{value:"ADJUSTMENT",children:"Adjustment"})]})}),n.jsx("td",{className:"px-2 py-1 border-b",children:he?n.jsx("span",{className:"text-[11px] text-gray-400 whitespace-nowrap",children:"  "}):n.jsxs("div",{className:"flex items-center gap-1",children:[Ce&&n.jsx("span",{className:"inline-flex items-center rounded-full bg-emerald-100 text-emerald-700 text-[10px] px-2 py-[1px]",children:""}),n.jsx("input",{list:"provider-suggestions",className:"border rounded px-1 py-0.5 w-32 text-xs",placeholder:" ",value:V.providerName||"",onChange:Re=>pe(ie,{providerName:Re.target.value})})]})}),n.jsx("td",{className:"px-2 py-1 border-b",children:n.jsx("input",{className:"border rounded px-1 py-0.5 w-64 text-xs",list:"description-suggestions",value:V.description,onChange:Re=>pe(ie,{description:Re.target.value})})}),n.jsx("td",{className:"px-2 py-1 border-b",children:n.jsx("input",{type:"date",className:"border rounded px-1 py-0.5 text-xs",value:V.date||"",onChange:Re=>pe(ie,{date:Re.target.value||null})})}),n.jsx("td",{className:"px-2 py-1 border-b",children:n.jsx("input",{type:"number",className:"border rounded px-1 py-0.5 w-20 text-xs disabled:bg-gray-100 disabled:text-gray-400",value:V.quantity??1,disabled:he,onChange:Re=>{if(he)return;const rt=Number(Re.target.value),Zt=Number.isFinite(rt)?Math.max(0,rt):0;pe(ie,{quantity:Zt})}})}),n.jsx("td",{className:"px-2 py-1 border-b",children:n.jsx("input",{type:"number",className:"border rounded px-1 py-0.5 w-24 text-xs",value:V.unitPrice??0,onChange:Re=>{const rt=Number(Re.target.value),Zt=Number.isFinite(rt)?Math.max(0,rt):0;pe(ie,{unitPrice:Zt})}})}),n.jsx("td",{className:"px-2 py-1 border-b",children:n.jsx("input",{type:"number",className:"border rounded px-1 py-0.5 w-16 text-xs disabled:bg-gray-100 disabled:text-gray-400",value:V.vatRate??0,disabled:he,onChange:Re=>{if(he)return;const rt=Number(Re.target.value),Zt=Number.isFinite(rt)?Math.max(0,rt):0;pe(ie,{vatRate:Zt})}})}),n.jsx("td",{className:"px-2 py-1 border-b text-center",children:n.jsx("input",{type:"checkbox",checked:V.isIncludedInRequestedAmount!==!1,onChange:Re=>pe(ie,{isIncludedInRequestedAmount:Re.target.checked})})}),n.jsx("td",{className:"px-2 py-1 border-b text-left font-mono text-xs",children:V.lineTotalAmount!=null?V.lineTotalAmount.toLocaleString("he-IL"):""}),n.jsxs("td",{className:"px-2 py-1 border-b text-right",children:[n.jsxs("div",{className:"flex items-center justify-end gap-2",children:[n.jsxs("select",{className:"border rounded px-1 py-0.5 text-xs max-w-[190px]",value:V.attachmentId||"",title:Me?` : ${Me.originalFileName}`:"   ",onChange:Re=>void He(V,Re.target.value?Re.target.value:null),children:[n.jsx("option",{value:"",children:h.length?"   ":"  "}),h.map(Re=>n.jsx("option",{value:Re.id,children:Re.originalFileName},Re.id))]}),V.attachmentId?n.jsxs("span",{className:"inline-flex items-center gap-1 text-[11px] text-emerald-700 font-semibold whitespace-nowrap",children:[n.jsx("span",{className:"text-emerald-600",children:""}),n.jsx("span",{children:" "})]}):n.jsx("span",{className:"inline-flex items-center gap-1 text-[11px] text-gray-500 whitespace-nowrap",children:" "})]}),Me&&n.jsxs("div",{className:"mt-0.5 text-[11px] text-gray-700 text-left",children:[n.jsx("span",{className:"text-gray-500",children:":"})," ",n.jsx("span",{className:"font-mono break-all",children:Me.originalFileName})]})]}),n.jsx("td",{className:"px-2 py-1 border-b text-center",children:n.jsx("button",{type:"button",className:"text-xs text-red-600 hover:underline disabled:opacity-50 disabled:cursor-not-allowed disabled:no-underline",onClick:()=>je(ie),disabled:Oe,children:""})})]},V.id)})]})]}),n.jsx("datalist",{id:"provider-suggestions",children:dt.map(V=>n.jsx("option",{value:V},V))}),n.jsx("datalist",{id:"description-suggestions",children:Ue.map(V=>n.jsx("option",{value:V},V))}),n.jsx("div",{className:"p-2",children:n.jsx("button",{type:"button",className:"px-3 py-1 text-xs rounded border border-dashed border-gray-400 text-gray-700 hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed",onClick:Be,disabled:Oe,children:" "})})]}),n.jsxs("div",{className:"mt-4 rounded-lg border border-slate-200 bg-slate-50 p-3 text-xs",children:[n.jsxs("div",{className:"flex justify-between items-center mb-2",children:[n.jsx("span",{className:"font-semibold text-slate-800",children:" "}),n.jsxs("span",{className:"text-slate-700",children:["    : ",ot.toLocaleString("he-IL")]})]}),n.jsx(zN,{user:e,sheet:l,paymentEvents:M,onChangeEvents:I})]}),O.length>0&&n.jsxs("div",{className:"mt-4 rounded-lg border border-slate-200 bg-slate-50 p-3 text-xs",children:[n.jsxs("div",{className:"flex justify-between items-center mb-2",children:[n.jsx("span",{className:"font-semibold text-slate-800",children:"  "}),n.jsxs("span",{className:"text-slate-500",children:["  ",O.length,"    "]})]}),n.jsx("div",{className:"space-y-2",children:O.map(V=>n.jsxs("div",{className:"rounded border border-slate-200 bg-white px-2 py-1 flex flex-wrap gap-x-4 gap-y-1 items-baseline",children:[n.jsxs("span",{className:"font-semibold text-slate-800",children:[" #",V.versionIndex||1]}),n.jsxs("span",{className:"text-slate-600",children:[": ",UN(V.status)]}),n.jsxs("span",{className:"text-slate-500",children:[":"," ",new Date(V.updatedAt||V.createdAt).toLocaleString("he-IL",{dateStyle:"short",timeStyle:"short"})]}),n.jsxs("span",{className:"text-slate-700",children:[" : ",V.deductibleAmount.toLocaleString("he-IL")]}),n.jsxs("span",{className:"text-slate-700",children:["  : ",V.alreadyPaidAmount.toLocaleString("he-IL")]}),n.jsxs("span",{className:"text-slate-700",children:[" : ",V.amountToRequest.toLocaleString("he-IL")]})]},V.id))})]}),n.jsx(HN,{open:P,title:"    ",message:z?`      :

${z}`:"      .",confirmText:"",cancelText:"",onConfirm:()=>U(!1),onCancel:()=>U(!1)})]})},VN=[{id:"READY",label:" "},{id:"ATTACHED",label:" "},{id:"SENT",label:""},{id:"EXCEPTIONS",label:""}],Lp={DRAFT:"",READY_FOR_REPORT:" ",ATTACHED_TO_REPORT:" ",ARCHIVED:""},KN=({user:e,reports:t,onOpenReport:s})=>{var ot;const[r,a]=g.useState("READY"),[o,l]=g.useState(""),[c,i]=g.useState(""),[u,p]=g.useState(""),[y,N]=g.useState(""),[w,R]=g.useState(""),[E,W]=g.useState([]),[b,h]=g.useState(null),[S,P]=g.useState(null),[U,z]=g.useState(!1),[q,ee]=g.useState(null),[G,se]=g.useState(null),[j,F]=g.useState(null),[L,O]=g.useState(!1),[H,M]=g.useState(null),[I,D]=g.useState(null),[J,ue]=g.useState(!1),[ce,le]=g.useState(!1),[fe,Ee]=g.useState(0);g.useMemo(()=>{if(!b)return 0;switch(r){case"READY":return b.readyCount;case"ATTACHED":return b.attachedCount;case"SENT":return b.sentCount;case"EXCEPTIONS":return b.exceptionsCount;default:return 0}},[b,r]);const ve=X=>{if(X==null)return"";if(X<24)return`${X.toFixed(1)} `;const ne=Math.floor(X/24),C=X%24;return C<1?`${ne} `:`${ne}  ${C.toFixed(1)} `};g.useEffect(()=>{let X=!1;return(async()=>{z(!0),ee(null);try{const[C,re]=await Promise.all([Xe.getLidorCounts(e,t),Xe.getLidorKpis(e,t)]);X||(h(C),P(re));const te={};r==="READY"?te.status="READY_FOR_REPORT":r==="ATTACHED"&&(te.status="ATTACHED_TO_REPORT"),o.trim()&&(te.insurerName=o.trim()),u&&(te.dateFrom=u),y&&(te.dateTo=y),w.trim()&&(te.caseIdOrSearch=w.trim()),c&&(te.status=c);const pe=await Xe.listSheetsForLidor(e,te,t);let Be=pe;r==="SENT"?Be=pe.filter(je=>je.sentAt):r==="EXCEPTIONS"&&(Be=pe.filter(je=>je.expensesOutOfSync||je.blockingIssueCodesLatest&&je.blockingIssueCodesLatest.length>0)),X||(W(Be),se(null),D(null))}catch(C){console.error(C),X||ee("    . /   .")}finally{X||z(!1)}})(),()=>{X=!0}},[e,t,r,o,c,u,y,w,fe]);const $e=async X=>{se(X),D(null),M(null),O(!0);try{const ne=await Xe.getSheet(X.sheetId),C=await Xe.getSheetAuditForLidor(e,X.sheetId,200),re=await Xe.getExceptionStatusForSheet(e,X.sheetId);D(ne?{sheet:ne.sheet,lineItems:ne.lineItems,attachments:ne.attachments,audit:C,exceptionStatus:re}:{sheet:null,lineItems:[],attachments:[],audit:C,exceptionStatus:re})}catch(ne){console.error(ne),M("     .")}finally{O(!1)}},Ze=()=>{if(!I||!I.sheet)return;const X={sheet:I.sheet,lineItems:I.lineItems,attachments:I.attachments};F(X)},Oe=()=>{F(null),Ee(X=>X+1)};if(j)return n.jsxs("div",{className:"bg-white rounded-xl border border-slate-200 shadow-sm p-4 mt-4",dir:"rtl",children:[n.jsxs("header",{className:"flex items-center justify-between mb-4",children:[n.jsxs("div",{children:[n.jsx("h2",{className:"text-xl font-bold text-slate-900",children:"   ()"}),n.jsx("p",{className:"text-sm text-slate-600 mt-1",children:"           ."})]}),n.jsx("button",{type:"button",className:"px-3 py-1.5 rounded border border-slate-300 text-sm text-slate-700 hover:bg-slate-100",onClick:Oe,children:"  "})]}),n.jsx(Fh,{user:e,sheetWithRelations:j,onSheetUpdated:X=>{F(X)},onBack:Oe})]});const Ye=async X=>{if(!(!G||!I))try{await Xe.setExceptionStatusForSheet(e,G.sheetId,X),D({...I,exceptionStatus:X})}catch(ne){Gu("Failed to update financial exception status",ne),M("     .")}};return n.jsxs("div",{className:"bg-white rounded-xl border border-slate-200 shadow-sm p-4 mt-4",dir:"rtl",children:[n.jsx("header",{className:"flex flex-col md:flex-row md:items-center md:justify-between gap-4 mb-4",children:n.jsxs("div",{children:[n.jsx("h2",{className:"text-xl font-bold text-slate-900",children:" "}),n.jsx("p",{className:"text-sm text-slate-600 mt-1",children:"-    ,      ."}),S&&n.jsxs("p",{className:"mt-1 text-xs text-slate-500",children:["  :"," ",S.exceptions.divergenceOld.count+S.exceptions.missingAttachments.count+S.exceptions.repeatedBlocks.count]})]})}),S&&n.jsxs("section",{className:"mb-4 grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 xl:grid-cols-4 gap-3 text-xs",children:[n.jsxs("div",{className:"rounded-xl border border-slate-200 bg-slate-50 px-3 py-2.5",children:[n.jsx("p",{className:"text-slate-500 mb-1",children:"   "}),n.jsx("p",{className:"text-sm font-semibold text-slate-900",children:ve(S.sla.draftToReadyAvgHours)})]}),n.jsxs("div",{className:"rounded-xl border border-slate-200 bg-slate-50 px-3 py-2.5",children:[n.jsx("p",{className:"text-slate-500 mb-1",children:"   "}),n.jsx("p",{className:"text-sm font-semibold text-slate-900",children:ve(S.sla.readyToAttachedAvgHours)})]}),n.jsxs("div",{className:"rounded-xl border border-slate-200 bg-slate-50 px-3 py-2.5",children:[n.jsx("p",{className:"text-slate-500 mb-1",children:"   "}),n.jsx("p",{className:"text-sm font-semibold text-slate-900",children:ve(S.sla.attachedToSentAvgHours)})]}),n.jsxs("div",{className:"rounded-xl border border-blue-100 bg-blue-50 px-3 py-2.5",children:[n.jsx("p",{className:"text-slate-600 mb-1",children:"  "}),n.jsxs("p",{className:"text-sm font-semibold text-blue-800",children:[S.volumes.totalAmountRequested.toLocaleString("he-IL")," "]}),n.jsxs("p",{className:"text-[11px] text-slate-500 mt-0.5",children:[S.volumes.totalSheets||0,"  "," ",S.volumes.totalSentReports||0,"  "]})]})]}),S&&n.jsxs("section",{className:"mb-4",children:[n.jsx("h3",{className:"text-sm font-semibold text-slate-700 mb-1",children:"  "}),n.jsxs("div",{className:"flex flex-wrap gap-2 text-xs",children:[n.jsxs("button",{type:"button",className:"inline-flex items-center gap-1 px-3 py-1.5 rounded-full border border-amber-200 bg-amber-50 text-amber-800 hover:bg-amber-100 transition disabled:opacity-40 disabled:hover:bg-amber-50",disabled:S.exceptions.divergenceOld.count===0,onClick:()=>a("EXCEPTIONS"),children:[n.jsx("span",{children:"    "}),n.jsxs("span",{className:"font-semibold",children:["(",S.exceptions.divergenceOld.count,")"]})]}),n.jsxs("button",{type:"button",className:"inline-flex items-center gap-1 px-3 py-1.5 rounded-full border border-rose-200 bg-rose-50 text-rose-800 hover:bg-rose-100 transition disabled:opacity-40 disabled:hover:bg-rose-50",disabled:S.exceptions.missingAttachments.count===0,onClick:()=>a("EXCEPTIONS"),children:[n.jsx("span",{children:"  "}),n.jsxs("span",{className:"font-semibold",children:["(",S.exceptions.missingAttachments.count,")"]})]}),n.jsxs("button",{type:"button",className:"inline-flex items-center gap-1 px-3 py-1.5 rounded-full border border-purple-200 bg-purple-50 text-purple-800 hover:bg-purple-100 transition disabled:opacity-40 disabled:hover:bg-purple-50",disabled:S.exceptions.repeatedBlocks.count===0,onClick:()=>a("EXCEPTIONS"),children:[n.jsx("span",{children:"   "}),n.jsxs("span",{className:"font-semibold",children:["(",S.exceptions.repeatedBlocks.count,")"]})]})]})]}),n.jsx("div",{className:"flex flex-wrap gap-2 mb-4",children:VN.map(X=>n.jsxs("button",{type:"button",onClick:()=>a(X.id),className:`px-3 py-1.5 text-xs font-semibold rounded-full border transition ${r===X.id?"bg-lpBlue text-white border-lpBlue":"bg-slate-50 text-slate-700 border-slate-200 hover:bg-slate-100"}`,children:[n.jsx("span",{children:X.label}),b&&n.jsxs("span",{className:"ml-2 inline-flex items-center justify-center px-2 py-0.5 rounded-full bg-white/20 text-[10px]",children:[X.id==="READY"&&b.readyCount,X.id==="ATTACHED"&&b.attachedCount,X.id==="SENT"&&b.sentCount,X.id==="EXCEPTIONS"&&b.exceptionsCount]})]},X.id))}),n.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-3 mb-4 text-sm",children:[n.jsxs("div",{children:[n.jsx("label",{className:"block text-xs font-medium text-slate-600 mb-1",children:""}),n.jsx("input",{className:"w-full border border-slate-200 rounded-lg px-2 py-1.5",placeholder:"   ",value:o,onChange:X=>l(X.target.value)})]}),n.jsxs("div",{children:[n.jsx("label",{className:"block text-xs font-medium text-slate-600 mb-1",children:""}),n.jsxs("select",{className:"w-full border border-slate-200 rounded-lg px-2 py-1.5",value:c,onChange:X=>i(X.target.value),children:[n.jsx("option",{value:"",children:""}),n.jsx("option",{value:"DRAFT",children:""}),n.jsx("option",{value:"READY_FOR_REPORT",children:" "}),n.jsx("option",{value:"ATTACHED_TO_REPORT",children:" "}),n.jsx("option",{value:"ARCHIVED",children:""})]})]}),n.jsxs("div",{children:[n.jsx("label",{className:"block text-xs font-medium text-slate-600 mb-1",children:" "}),n.jsxs("div",{className:"flex gap-2",children:[n.jsx("input",{type:"date",className:"w-1/2 border border-slate-200 rounded-lg px-2 py-1.5",value:u,onChange:X=>p(X.target.value)}),n.jsx("input",{type:"date",className:"w-1/2 border border-slate-200 rounded-lg px-2 py-1.5",value:y,onChange:X=>N(X.target.value)})]})]}),n.jsxs("div",{children:[n.jsx("label",{className:"block text-xs font-medium text-slate-600 mb-1",children:"   / ID"}),n.jsx("input",{className:"w-full border border-slate-200 rounded-lg px-2 py-1.5",placeholder:'/  ,    "',value:w,onChange:X=>R(X.target.value)})]})]}),U&&n.jsx("div",{className:"mt-6 text-sm text-slate-500 text-center",children:" "}),q&&!U&&n.jsx("div",{className:"mt-6 text-sm text-red-600 text-center",children:q}),!U&&!q&&E.length===0&&n.jsxs("div",{className:"mt-6 border border-dashed border-slate-300 rounded-xl py-10 flex flex-col items-center justify-center text-center text-sm text-slate-500",children:[n.jsx("p",{className:"mb-1",children:"  "}),n.jsx("p",{className:"text-xs text-slate-400",children:"/       ."})]}),!U&&!q&&E.length>0&&n.jsx("div",{className:"mt-4 overflow-x-auto border border-slate-200 rounded-xl",children:n.jsxs("table",{className:"w-full text-sm",children:[n.jsx("thead",{className:"bg-slate-50 text-slate-700",children:n.jsxs("tr",{children:[n.jsx("th",{className:"px-3 py-2 text-right",children:""}),n.jsx("th",{className:"px-3 py-2 text-right",children:""}),n.jsx("th",{className:"px-3 py-2 text-right",children:""}),n.jsx("th",{className:"px-3 py-2 text-right",children:" #"}),n.jsx("th",{className:"px-3 py-2 text-right",children:" "}),n.jsx("th",{className:"px-3 py-2 text-right",children:" "}),n.jsx("th",{className:"px-3 py-2 text-right",title:"         ",children:"INFO_ONLY"}),n.jsx("th",{className:"px-3 py-2 text-right",title:"       ",children:""}),n.jsx("th",{className:"px-3 py-2 text-left",children:""})]})}),n.jsx("tbody",{children:E.map(X=>{var pe;const ne=(pe=X.blockingIssueCodesLatest)==null?void 0:pe.includes("MISSING_ATTACHMENT_REQUIRED"),C=X.expensesOutOfSync,re=(X.blockingIssueCodesLatest||[]).some(Be=>Be!=="MISSING_ATTACHMENT_REQUIRED");let te="";return C?te=" ":ne?te=" ":re&&(te=""),n.jsxs("tr",{className:"border-t border-slate-100 hover:bg-slate-50",children:[n.jsx("td",{className:"px-3 py-2 text-right font-mono text-xs text-slate-800",children:X.caseId}),n.jsx("td",{className:"px-3 py-2 text-right text-slate-800",children:X.insurerName||""}),n.jsx("td",{className:"px-3 py-2 text-right text-slate-800 text-xs",children:Lp[X.status]||X.status}),n.jsxs("td",{className:"px-3 py-2 text-right text-slate-800 text-xs",children:[" #",X.versionIndex]}),n.jsx("td",{className:"px-3 py-2 text-right text-slate-700 text-xs",children:new Date(X.updatedAt).toLocaleString("he-IL",{dateStyle:"short",timeStyle:"short"})}),n.jsxs("td",{className:"px-3 py-2 text-right text-blue-700 font-semibold text-xs",children:[X.amountToRequest.toLocaleString("he-IL")," "]}),n.jsx("td",{className:"px-3 py-2 text-right text-xs text-slate-700",children:X.infoOnly?"":""}),n.jsx("td",{className:"px-3 py-2 text-right text-xs",children:te?n.jsx("span",{className:"inline-flex px-2 py-0.5 rounded-full bg-amber-100 text-amber-800 border border-amber-200",children:te}):n.jsx("span",{className:"text-slate-400",children:""})}),n.jsxs("td",{className:"px-3 py-2 text-left text-xs space-x-2 space-x-reverse",children:[n.jsx("button",{type:"button",className:"px-2 py-1 rounded border border-slate-300 text-slate-700 hover:bg-slate-100",onClick:()=>$e(X),children:""}),n.jsx("button",{type:"button",className:"px-2 py-1 rounded border border-slate-300 text-slate-600 hover:bg-slate-100",onClick:()=>{var Be;(Be=navigator.clipboard)!=null&&Be.writeText?navigator.clipboard.writeText(X.sheetId).catch(()=>{}):window.prompt(" :",X.sheetId)},children:" "})]})]},X.sheetId)})})]})}),G&&n.jsxs("div",{className:"mt-6 bg-slate-50 border border-slate-200 rounded-xl p-4",children:[n.jsxs("div",{className:"flex flex-col md:flex-row md:items-center md:justify-between gap-2 mb-2",children:[n.jsxs("h3",{className:"text-sm font-bold text-slate-900",children:["   ",G.caseId," (",G.sheetId,")"]}),n.jsxs("div",{className:"flex flex-wrap gap-2 text-[11px]",children:[n.jsx("button",{type:"button",className:"px-2 py-1 rounded border border-slate-300 text-slate-700 hover:bg-slate-100",onClick:()=>{var X;(X=navigator.clipboard)!=null&&X.writeText?navigator.clipboard.writeText(G.sheetId).catch(()=>{}):window.prompt(" :",G.sheetId)},children:"  "}),((ot=I==null?void 0:I.sheet)==null?void 0:ot.attachedToReportId)&&n.jsx("button",{type:"button",className:"px-2 py-1 rounded border border-slate-300 text-slate-700 hover:bg-slate-100",onClick:()=>{var ne;const X=I.sheet.attachedToReportId;(ne=navigator.clipboard)!=null&&ne.writeText?navigator.clipboard.writeText(X).catch(()=>{}):window.prompt(" :",X)},children:"  "}),n.jsx("button",{type:"button",className:"px-2 py-1 rounded border border-slate-300 text-slate-700 hover:bg-slate-100",onClick:()=>{var ne;const X=`${window.location.origin}${window.location.pathname}?financialSheetId=${encodeURIComponent(G.sheetId)}`;(ne=navigator.clipboard)!=null&&ne.writeText?navigator.clipboard.writeText(X).catch(()=>{}):window.prompt("  :",X)},children:"  "})]})]}),L&&n.jsx("p",{className:"text-xs text-slate-500",children:" "}),H&&n.jsx("p",{className:"text-xs text-red-600",children:H}),!L&&I&&I.sheet&&n.jsxs("div",{className:"space-y-3 text-xs text-slate-800",children:[n.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-2",children:[n.jsxs("div",{children:[n.jsx("span",{className:"font-semibold",children:":"})," ",n.jsx("span",{className:"font-mono",children:I.sheet.caseId})]}),n.jsxs("div",{children:[n.jsx("span",{className:"font-semibold",children:":"})," ",n.jsx("span",{children:I.sheet.insurerName||""})]}),n.jsxs("div",{children:[n.jsx("span",{className:"font-semibold",children:":"})," ",n.jsx("span",{children:Lp[I.sheet.status]||I.sheet.status})]}),n.jsxs("div",{children:[n.jsx("span",{className:"font-semibold",children:" #:"})," ",n.jsx("span",{children:I.sheet.versionIndex})]}),n.jsxs("div",{children:[n.jsx("span",{className:"font-semibold",children:":"})," ",n.jsx("span",{children:new Date(I.sheet.updatedAt).toLocaleString("he-IL",{dateStyle:"short",timeStyle:"short"})})]}),n.jsxs("div",{children:[n.jsx("span",{className:"font-semibold",children:" :"})," ",n.jsx("span",{children:I.sheet.readyAt||""})]}),n.jsxs("div",{children:[n.jsx("span",{className:"font-semibold",children:" :"})," ",n.jsx("span",{children:I.sheet.attachedAt||""})]})]}),n.jsxs("div",{className:"mt-3",children:[n.jsx("h4",{className:"font-semibold text-slate-900 mb-1 text-xs",children:"  (  )"}),n.jsx("p",{className:"text-[11px] text-slate-500 mb-1",children:"       ,      ."}),n.jsxs("div",{className:"inline-flex rounded-full bg-slate-100 p-1 text-[11px] font-semibold text-slate-700",children:[n.jsx("button",{type:"button",className:`px-3 py-1 rounded-full transition ${I.exceptionStatus?"text-slate-600 hover:text-slate-900":"bg-white shadow-sm text-slate-900"}`,onClick:()=>Ye("IN_PROGRESS"),children:""}),n.jsx("button",{type:"button",className:`px-3 py-1 rounded-full transition ${I.exceptionStatus==="RESOLVED"?"bg-emerald-500 text-white shadow-sm":"text-slate-600 hover:text-slate-900"}`,onClick:()=>Ye("RESOLVED"),children:""})]})]}),I.audit&&I.audit.length>0&&n.jsxs("div",{className:"mt-2",children:[n.jsxs("div",{className:"flex items-center justify-between mb-1",children:[n.jsx("h4",{className:"font-semibold text-slate-900",children:"Decision Logs"}),n.jsxs("label",{className:"flex items-center gap-1 text-[11px] text-slate-600",children:[n.jsx("input",{type:"checkbox",className:"rounded border-slate-300",checked:ce,onChange:X=>le(X.target.checked)}),n.jsx("span",{children:" Decision Logs "})]})]}),(()=>{const X=I.audit.filter(C=>C.diffJson&&C.diffJson.decisionLog).sort((C,re)=>new Date(re.eventAt).getTime()-new Date(C.eventAt).getTime());if(!X.length)return n.jsx("p",{className:"text-slate-500 text-[11px]",children:"   ."});const ne=ce?X:[X[0]];return n.jsx("div",{className:"space-y-2 text-[11px]",children:ne.map((C,re)=>{const te=C.diffJson.decisionLog;return n.jsxs("div",{className:"border border-slate-200 rounded-lg px-2 py-1.5 bg-white/60",children:[ce&&n.jsxs("div",{className:"flex items-center justify-between mb-0.5 text-[10px] text-slate-500",children:[n.jsx("span",{children:new Date(C.eventAt).toLocaleString("he-IL",{dateStyle:"short",timeStyle:"short"})}),n.jsxs("span",{children:["#",re+1]})]}),n.jsxs("div",{className:"space-y-1",children:[n.jsxs("div",{children:[n.jsx("span",{className:"font-semibold",title:"      ",children:"Ruleset:"})," ",n.jsxs("span",{children:[te.rulesetId||""," ("," ",te.rulesetVersion||"-",")"]})]}),n.jsxs("div",{className:"space-y-0.5",children:[n.jsxs("div",{children:[n.jsx("span",{className:te.checks.requiredFieldsOk?"text-green-600":"text-red-600",children:te.checks.requiredFieldsOk?"":""})," ",n.jsx("span",{children:"   "})]}),n.jsxs("div",{children:[n.jsx("span",{className:te.checks.sumsValid?"text-green-600":"text-red-600",children:te.checks.sumsValid?"":""})," ",n.jsx("span",{children:" "})]}),n.jsxs("div",{children:[n.jsx("span",{className:te.checks.attachmentsOk?"text-green-600":"text-red-600",children:te.checks.attachmentsOk?"":""})," ",n.jsx("span",{children:"    "})]}),n.jsxs("div",{children:[n.jsx("span",{className:te.checks.infoOnlyConsistent?"text-green-600":"text-red-600",children:te.checks.infoOnlyConsistent?"":""})," ",n.jsx("span",{children:" INFO_ONLY"})]})]}),n.jsxs("div",{children:[n.jsx("span",{className:"font-semibold",children:" :"})," ",n.jsx("span",{children:(te.blockingIssueCodes||te.blockingIssueCodesLatest||[]).join(", ")||""})]})]})]},C.id)})})})()]}),I.audit&&I.audit.length>0&&n.jsxs("div",{className:"mt-3",children:[n.jsxs("div",{className:"flex items-center justify-between mb-1",children:[n.jsx("h4",{className:"font-semibold text-slate-900",children:"Audit Log"}),n.jsxs("label",{className:"flex items-center gap-1 text-[11px] text-slate-600",children:[n.jsx("input",{type:"checkbox",className:"rounded border-slate-300",checked:J,onChange:X=>ue(X.target.checked)}),n.jsx("span",{children:" Audit Log "})]})]}),n.jsx("ul",{className:"space-y-0.5 text-[11px] text-slate-700",children:(J?I.audit:I.audit.slice(0,10)).map(X=>n.jsxs("li",{children:[n.jsx("span",{className:"font-mono text-slate-500 mr-1",children:new Date(X.eventAt).toLocaleString("he-IL",{dateStyle:"short",timeStyle:"short"})})," ",n.jsx("span",{className:"font-semibold",children:X.eventType})," "," ",n.jsx("span",{className:"text-slate-500",children:X.actorRole})]},X.id))})]}),I.sheet.attachedToReportId&&n.jsxs("div",{className:"mt-3",children:[n.jsx("button",{type:"button",className:"px-3 py-1.5 rounded border border-slate-300 text-xs text-slate-700 hover:bg-slate-100",onClick:()=>s(I.sheet.attachedToReportId),children:"  "}),n.jsx("button",{type:"button",className:"ml-2 px-3 py-1.5 rounded border border-blue-500 text-xs text-blue-700 hover:bg-blue-50",onClick:Ze,children:"  "})]}),!I.sheet.attachedToReportId&&n.jsx("div",{className:"mt-3",children:n.jsx("button",{type:"button",className:"px-3 py-1.5 rounded border border-blue-500 text-xs text-blue-700 hover:bg-blue-50",onClick:Ze,children:"  "})})]})]})]})},li=e=>{const t=e.updatedAt||e.sentAt||e.reportDate;return t?new Date(t).getTime():0},YN=e=>{var s;return(((s=e.reportReview)==null?void 0:s.issues)??[]).some(r=>(r.origin??"INTERNAL")==="EXTERNAL"&&r.status!=="DONE")},GN=e=>{var s;return(((s=e.reportReview)==null?void 0:s.issues)??[]).some(r=>(r.origin??"INTERNAL")==="EXTERNAL"&&r.status!=="DONE"&&r.externalAction==="REQUIRES_HEBREW")},qN=e=>e.filter(t=>t.deletedAt?!1:t.hebrewWorkflowStatus==="HEBREW_REOPENED_EXTERNAL"?!0:YN(t)).sort((t,s)=>li(s)-li(t)),XN=(e,t)=>e.filter(s=>!(s.deletedAt||s.status!=="SENT"||!t(s)||GN(s))).sort((s,r)=>li(r)-li(s)),JN="adminDashboardUiState:v1",QN=["u6","u5","u7","u4"],fl=QN.map(e=>js.find(t=>t.id===e&&t.role==="LAWYER")).filter(e=>!!e);function ZN(e){var a;if(e.status==="SENT")return"GREEN";const t=(a=e.reportReview)==null?void 0:a.status,s=e.hebrewWorkflowStatus;return(t==="SUBMITTED"||t==="APPROVED"||t==="CHANGES_REQUESTED"||s==="HEBREW_SUBMITTED"||s==="HEBREW_APPROVED"||s==="HEBREW_CHANGES_REQUESTED"||s==="HEBREW_REOPENED_EXTERNAL")&&e.status!=="SENT"?"RED":"YELLOW"}const ev=({user:e,reports:t,onSelectReport:s,onSelectReportWithFocus:r,onMarkExternalIssuesDone:a,onReopenHebrewDueToExternalFeedback:o,onNewReport:l,caseFolders:c,onUpdateCaseFolders:i,canTranslate:u,onLogout:p,onOpenAssistant:y,onOpenCaseFolder:N})=>{var M;const w=g.useMemo(()=>t.filter(I=>!I.deletedAt),[t]),R=g.useMemo(()=>qN(w),[w]),E=g.useMemo(()=>XN(w,u),[w,u]),W=g.useMemo(()=>{const I=new Map;return w.forEach(D=>{if(!D.createdBy)return;const J=I.get(D.createdBy)||[];J.push(D),I.set(D.createdBy,J)}),I},[w]),b=g.useMemo(()=>fl.map(I=>{const J=(W.get(I.id)||[]).filter(fe=>fe.status!=="SENT"),ue=J.filter(fe=>fe.status==="READY_TO_SEND").length,ce=R.filter(fe=>fe.createdBy===I.id).length,le=E.filter(fe=>fe.createdBy===I.id).length;return{lawyer:I,totalOpen:J.length,readyToSendCount:ue,feedbackCount:ce,resendCount:le}}),[R,E,W]),h=I=>{var D;return I.hebrewWorkflowStatus?I.hebrewWorkflowStatus:((D=I.reportReview)==null?void 0:D.status)??"-"},S=I=>{if(!I)return pl.queueItem.noDate;try{const D=new Date(I);return`${D.toLocaleDateString("he-IL")} ${D.toLocaleTimeString("he-IL",{hour:"2-digit",minute:"2-digit"}).replace(":00","")}`}catch{return I}},[P,U]=g.useState("ADMIN"),[z,q]=g.useState(((M=fl[0])==null?void 0:M.id)||""),[ee,G]=g.useState("SUMMARY"),[se,j]=g.useState(null),F=g.useMemo(()=>c?Object.values(c).filter(I=>I.closedAt):[],[c]),L=g.useMemo(()=>fl.find(I=>I.id===z)||fl[0],[z]),O=g.useMemo(()=>{if(!L)return[];const I=W.get(L.id)||[],D=new Map;I.filter(le=>!le.deletedAt).forEach(le=>{const fe=le.odakanitNo&&le.odakanitNo.trim().length>0?le.odakanitNo.trim():"NO_ODAKANIT",Ee=D.get(fe)||[];Ee.push(le),D.set(fe,Ee)});const J=Array.from(D.entries()).map(([le,fe])=>{let Ee=fe[0];fe.forEach(Oe=>{const Ye=new Date(Oe.updatedAt||Oe.reportDate).getTime(),ot=new Date(Ee.updatedAt||Ee.reportDate).getTime();Ye>ot&&(Ee=Oe)});const ve=le==="NO_ODAKANIT"?"":le,$e=ve||"  ",Ze=Ee.updatedAt||Ee.reportDate;return{odakanitNo:ve,displayOdakanit:$e,representative:Ee,lastUpdatedIso:Ze,reportsCount:fe.length}}),ue=[];return c&&Object.values(c).forEach(le=>{var ve;if(!le.odakanitNo||le.assignedLawyer!==L.id)return;const fe=le.odakanitNo.trim();if(!fe||D.has(fe))return;const Ee={id:`seed-folder-${fe}`,createdBy:L.id,ownerName:L.name,ownerEmail:L.email,reportDate:le.updatedAt||le.createdAt,status:"DRAFT",reportSubject:le.reTemplate||"",recipientId:"1",insurerName:le.insurerName||"",lineSlipNo:le.lineSlipNo||"",marketRef:le.marketRef||"",certificateRef:le.certificateRef||"",insuredName:le.insuredName||"",plaintiffName:le.plaintiffName||"",plaintiffTitle:"Plaintiff",sentAt:void 0,reportHistory:[],selectedTimeline:"standard",filenameTag:"New lawsuit",selectedSections:["Update","Recommendations"],content:{},translatedContent:{},invoiceFiles:[],isWaitingForInvoices:!1,requiresExpenses:!1,isTranslated:!1,expensesItems:[],expenseWorksheet:void 0,reportNotes:[],complaintAnalysis:void 0};ue.push({odakanitNo:le.odakanitNo,displayOdakanit:le.odakanitNo||"  ",representative:Ee,lastUpdatedIso:le.updatedAt||le.createdAt,reportsCount:((ve=le.sentReports)==null?void 0:ve.length)||0})}),[...J,...ue].sort((le,fe)=>{const Ee=le.lastUpdatedIso?new Date(le.lastUpdatedIso).getTime():0;return(fe.lastUpdatedIso?new Date(fe.lastUpdatedIso).getTime():0)-Ee})},[W,L,c]),H=g.useMemo(()=>{if(!L||!se)return[];const I=W.get(L.id)||[],D=se.trim();return I.filter(J=>!J.deletedAt).filter(J=>(J.odakanitNo||"").trim()===D)},[W,L,se]);return n.jsx("div",{className:"min-h-screen bg-navySecondary",dir:"rtl",children:n.jsxs("div",{className:"w-full px-6 md:px-8 lg:px-10 xl:px-12 py-6",children:[n.jsxs("header",{className:"flex flex-col md:flex-row items-start md:items-center justify-between gap-4 mb-6",children:[n.jsxs("div",{children:[n.jsx("h1",{className:"text-2xl font-bold text-textLight",children:pl.title}),n.jsx("p",{className:"text-sm text-textMuted mt-1",children:pl.subtitle}),n.jsxs("p",{className:"text-xs text-textMuted mt-1",children:["/ ",n.jsx("span",{className:"font-semibold",children:e.name})," ",n.jsxs("span",{className:"ml-1 text-textMuted",children:["(",e.role==="SUB_ADMIN"?"SUB_ADMIN":"ADMIN",")"]})]})]}),n.jsxs("div",{className:"flex flex-col items-stretch md:flex-row md:items-center gap-3",children:[n.jsxs("div",{className:"inline-flex rounded-full bg-slate-100 p-1 text-xs font-semibold text-textMuted",children:[n.jsx("button",{type:"button",onClick:()=>U("ADMIN"),className:`px-3 py-1 rounded-full transition ${P==="ADMIN"?"bg-panel text-textLight shadow-sm":"text-textMuted hover:text-textLight"}`,children:" "}),n.jsx("button",{type:"button",onClick:()=>U("FINANCIAL_CONTROL"),className:`px-3 py-1 rounded-full transition ${P==="FINANCIAL_CONTROL"?"bg-panel text-textLight shadow-sm":"text-textMuted hover:text-textLight"}`,children:" "})]}),y&&n.jsx("button",{type:"button",onClick:()=>y(),className:"inline-flex items-center justify-center px-3 py-2 rounded-lg border border-indigo-200 bg-panel text-xs font-semibold text-indigo-800 hover:bg-indigo-50 transition",children:" "}),n.jsx("button",{type:"button",onClick:p,className:"inline-flex items-center justify-center px-3 py-2 rounded-lg border border-red-200 bg-panel text-sm font-semibold text-red-700 hover:bg-red-50 transition",children:""}),n.jsx("button",{onClick:l,className:"inline-flex items-center justify-center px-4 py-2 rounded-lg bg-lpBlue text-white text-sm font-semibold shadow-sm hover:bg-blue-800 transition",children:pl.actions.openNewReport})]})]}),P==="FINANCIAL_CONTROL"?n.jsx(KN,{user:e,reports:t,onOpenReport:s}):n.jsxs(n.Fragment,{children:[n.jsxs("section",{className:"mb-6",children:[n.jsx("h2",{className:"text-sm font-semibold text-textLight mb-2",children:"   "}),n.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 xl:grid-cols-5 gap-3 text-xs",children:b.map(I=>{const D=(L==null?void 0:L.id)===I.lawyer.id;return n.jsxs("button",{type:"button",onClick:()=>{q(I.lawyer.id),j(null),G("LAWYER_CASES")},className:`flex flex-col items-stretch rounded-2xl border px-3 py-3 text-right shadow-sm transition ${D?"border-gold bg-blue-50/80":"border-borderDark bg-panel hover:bg-navySecondary"}`,children:[n.jsxs("div",{className:"flex items-center justify-between mb-1",children:[n.jsx("span",{className:"text-[11px] font-semibold text-slate-700",children:I.lawyer.name}),n.jsxs("span",{className:"inline-flex items-center rounded-full bg-slate-100 px-2 py-0.5 text-[10px] text-textMuted",children:[I.totalOpen," "]})]}),n.jsxs("div",{className:"flex flex-col gap-0.5 text-[11px] text-textMuted",children:[n.jsxs("span",{children:[" :",n.jsx("span",{className:"font-semibold text-emerald-700",children:I.readyToSendCount})]}),n.jsxs("span",{children:["  :",n.jsx("span",{className:"font-semibold text-purple-700",children:I.feedbackCount})]})]})]},I.lawyer.id)})})]}),e.role==="ADMIN"&&c&&i&&n.jsx(DN,{caseFolders:c,onUpdateCaseFolders:i,reports:t}),e.role==="ADMIN"&&F.length>0&&n.jsxs("section",{className:"mb-6 bg-panel rounded-2xl border border-borderDark shadow-sm p-4",children:[n.jsx("div",{className:"flex items-center justify-between mb-3",children:n.jsxs("div",{children:[n.jsx("h2",{className:"text-sm font-semibold text-textLight",children:" "}),n.jsx("p",{className:"text-[11px] text-textMuted",children:"      .   ,   (  )   ."})]})}),n.jsx("div",{className:"overflow-x-auto",children:n.jsxs("table",{className:"min-w-full text-[11px]",children:[n.jsx("thead",{children:n.jsxs("tr",{className:"border-b border-borderDark bg-navySecondary",children:[n.jsx("th",{className:"px-2 py-1 text-right font-semibold",children:"  "}),n.jsx("th",{className:"px-2 py-1 text-right font-semibold",children:""}),n.jsx("th",{className:"px-2 py-1 text-right font-semibold",children:""}),n.jsx("th",{className:"px-2 py-1 text-right font-semibold",children:" "}),n.jsx("th",{className:"px-2 py-1 text-right font-semibold",children:""})]})}),n.jsx("tbody",{children:F.map(I=>{const D=I.closedAt?new Date(I.closedAt).toLocaleDateString("he-IL"):"";return n.jsxs("tr",{className:"border-b border-borderDark",children:[n.jsx("td",{className:"px-2 py-1 text-right font-semibold text-textLight",children:I.odakanitNo}),n.jsx("td",{className:"px-2 py-1 text-right text-slate-700",children:I.insuredName||""}),n.jsx("td",{className:"px-2 py-1 text-right text-slate-700",children:I.plaintiffName||""}),n.jsx("td",{className:"px-2 py-1 text-right text-textMuted",children:D}),n.jsx("td",{className:"px-2 py-1 text-left",children:N&&n.jsx("button",{type:"button",onClick:()=>N(I.odakanitNo),className:"inline-flex items-center rounded-full bg-panel px-3 py-1 text-[11px] font-semibold text-gold border border-gold hover:bg-navySecondary",children:" "})})]},I.odakanitNo)})})]})})]}),ee==="LAWYER_CASES"&&L&&n.jsxs("section",{className:"mb-6 bg-panel rounded-2xl border border-borderDark shadow-sm p-4",children:[n.jsxs("div",{className:"flex items-center justify-between mb-3",children:[n.jsxs("div",{children:[n.jsxs("h2",{className:"text-sm font-semibold text-textLight",children:["     ",L.name]}),n.jsx("p",{className:"text-[11px] text-textMuted",children:"        ."})]}),n.jsx("button",{type:"button",onClick:()=>{G("SUMMARY"),j(null)},className:"text-[11px] px-3 py-1.5 rounded-full border border-borderDark text-slate-700 hover:bg-navySecondary",children:" "})]}),O.length===0?n.jsx("p",{className:"text-xs text-textMuted",children:"       ."}):n.jsx("div",{className:"overflow-x-auto",children:n.jsxs("table",{className:"min-w-full text-[11px]",children:[n.jsx("thead",{children:n.jsxs("tr",{className:"border-b border-borderDark bg-navySecondary",children:[n.jsx("th",{className:"px-2 py-1 text-right font-semibold",children:" "}),n.jsx("th",{className:"px-2 py-1 text-right font-semibold w-20",children:"REPORT NO."}),n.jsx("th",{className:"px-2 py-1 text-right font-semibold w-40",children:"PLAINTIFF/CLAIMANT"}),n.jsx("th",{className:"px-2 py-1 text-right font-semibold w-40",children:"INSURED"}),n.jsx("th",{className:"px-2 py-1 text-right font-semibold w-40",children:"INSURER"}),n.jsx("th",{className:"px-2 py-1 text-right font-semibold w-28",children:"'  "})]})}),n.jsx("tbody",{children:O.map(I=>{var Ze;const{representative:D}=I,J=!!I.odakanitNo,ue=ni(D),ce=ue?ue.split(" - "):[],le=ce.length<=2?ue:ce[ce.length-2]||ue,fe=typeof D.reportNumber=="number"&&D.reportNumber>0?D.reportNumber:(((Ze=D.reportHistory)==null?void 0:Ze.length)||0)+1,Ee=D.plaintiffName||"",ve=D.insuredName||"",$e=D.insurerName||"";return n.jsxs("tr",{className:`border-b border-borderDark ${J?"hover:bg-navySecondary cursor-pointer":"bg-navySecondary/40 text-textMuted"}`,onClick:()=>{J&&(j(I.odakanitNo),G("CASE_REPORTS"))},children:[n.jsxs("td",{className:"px-2 py-1 text-right",children:[n.jsx("div",{className:"text-textLight",children:le||""}),n.jsx("div",{className:"text-[10px] text-textMuted",children:S(I.lastUpdatedIso)})]}),n.jsx("td",{className:"px-2 py-1 text-right text-slate-700 font-mono text-[11px]",children:fe}),n.jsx("td",{className:"px-2 py-1 text-right text-slate-700",children:Ee}),n.jsx("td",{className:"px-2 py-1 text-right text-slate-700",children:ve}),n.jsx("td",{className:"px-2 py-1 text-right text-slate-700",children:$e}),n.jsx("td",{className:"px-2 py-1 text-right font-mono text-[11px]",children:I.displayOdakanit})]},I.displayOdakanit)})})]})})]}),ee==="CASE_REPORTS"&&L&&se&&n.jsxs("section",{className:"mb-6 bg-panel rounded-2xl border border-borderDark shadow-sm p-4",children:[n.jsxs("div",{className:"flex items-center justify-between mb-3",children:[n.jsxs("div",{children:[n.jsxs("h2",{className:"text-sm font-semibold text-textLight",children:["  ",se,"  ",L.name]}),n.jsx("p",{className:"text-[11px] text-textMuted",children:"  ,     ."})]}),n.jsx("button",{type:"button",onClick:()=>G("LAWYER_CASES"),className:"text-[11px] px-3 py-1.5 rounded-full border border-borderDark text-slate-700 hover:bg-navySecondary",children:" "})]}),H.length===0?n.jsx("p",{className:"text-xs text-textMuted",children:"     ."}):n.jsx("div",{className:"overflow-x-auto",children:n.jsxs("table",{className:"min-w-full text-[11px]",children:[n.jsx("thead",{children:n.jsxs("tr",{className:"border-b border-borderDark bg-navySecondary",children:[n.jsx("th",{className:"px-2 py-1 text-right font-semibold w-64",children:" /  / "}),n.jsx("th",{className:"px-2 py-1 text-right font-semibold w-24",children:' \\"'}),n.jsx("th",{className:"px-2 py-1 text-right font-semibold w-32",children:""}),n.jsx("th",{className:"px-2 py-1 text-right font-semibold w-32",children:" "}),n.jsx("th",{className:"px-2 py-1 text-right font-semibold w-28"})]})}),n.jsx("tbody",{children:H.map(I=>{var fe;const D=ZN(I),J=D==="GREEN"?"bg-emerald-50":D==="RED"?"bg-red-50":"bg-yellow-50",ue=!!I.expensesSheetId,ce=I.reportSubject||I.insuredName||I.plaintiffName||"",le=typeof I.reportNumber=="number"&&I.reportNumber>0?I.reportNumber:(((fe=I.reportHistory)==null?void 0:fe.length)||0)+1;return n.jsxs("tr",{className:`border-b border-borderDark hover:bg-slate-100 cursor-pointer ${J}`,onClick:()=>s(I.id),children:[n.jsxs("td",{className:"px-2 py-1 text-right",children:[n.jsxs("div",{className:"text-textLight flex flex-wrap items-center gap-1 justify-end",children:[n.jsx("span",{children:ce}),ue&&n.jsx("span",{className:"inline-flex items-center rounded-full bg-purple-100 px-2 py-0.5 text-[10px] font-medium text-purple-700",children:" /  "})]}),(I.insuredName||I.plaintiffName)&&n.jsx("div",{className:"text-[10px] text-textMuted",children:[I.insuredName,I.plaintiffName].filter(Boolean).join(" / ")})]}),n.jsx("td",{className:"px-2 py-1 text-right text-slate-700",children:le}),n.jsxs("td",{className:"px-2 py-1 text-right text-slate-700",children:[h(I)," (",I.status,")"]}),n.jsx("td",{className:"px-2 py-1 text-right text-textMuted whitespace-nowrap",children:S(I.updatedAt||I.reportDate)}),n.jsx("td",{className:"px-2 py-1 text-left",children:n.jsx("button",{type:"button",onClick:Ee=>{Ee.stopPropagation(),s(I.id)},className:"inline-flex items-center rounded-full bg-lpBlue px-3 py-1 text-[11px] font-semibold text-white shadow-sm hover:bg-blue-900",children:' \\"'})})]},I.id)})})]})})]})]})]})})},tv=({user:e,reports:t,onLogout:s,onNotifyLawyer:r,onMarkReportPaid:a,onSheetDeleted:o,onOpenAssistant:l,caseFolders:c})=>{const[i,u]=g.useState([]),[p,y]=g.useState(null),[N,w]=g.useState(!1),[R,E]=g.useState("ALL"),[W,b]=g.useState(""),[h,S]=g.useState(null),[P,U]=g.useState(null),[z,q]=g.useState({}),ee=async()=>{w(!0);try{const H=await Xe.listSheets();u(H)}finally{w(!1)}};g.useEffect(()=>{ee()},[]);const G=g.useMemo(()=>{const H=new Map;return t.forEach(M=>{if(!M.expensesSheetId)return;const I=H.get(M.expensesSheetId);if(!I){H.set(M.expensesSheetId,M);return}const D=I.updatedAt&&new Date(I.updatedAt).getTime()||0;(M.updatedAt&&new Date(M.updatedAt).getTime()||0)>D&&H.set(M.expensesSheetId,M)}),H},[t]),se=g.useMemo(()=>[...i.filter(M=>{if(R!=="ALL"&&M.status!==R)return!1;const I=W.trim().toLowerCase();return!(I&&!(M.insurerName||"").toLowerCase().includes(I))})].sort((M,I)=>{const D=Xa(M.caseId)===M.id?1:0,J=Xa(I.caseId)===I.id?1:0;if(J!==D)return J-D;const ue=new Date(M.updatedAt||M.createdAt).getTime();return new Date(I.updatedAt||I.createdAt).getTime()-ue}),[i,R,W]);g.useEffect(()=>{const H=se.map(M=>M.id).filter(M=>!z[M]);H.length&&H.forEach(M=>{(async()=>{try{const I=await Xe.getSheet(M);if(!I)return;const D=Fn(I.sheet,I.lineItems);q(J=>({...J,[M]:D}))}catch{}})()})},[se,z]);const j=async H=>{const M=await Xe.getSheet(H);M&&(S(H),U(M))},F=async()=>{const M=(window.prompt("  / :")||"").trim();if(!M)return;const I=Se(M),D=t.filter(Ee=>Se(Ee.odakanitNo||"")===I);let J=null;D.length>0&&(J=D.reduce((ve,$e)=>{const Ze=ve.updatedAt?new Date(ve.updatedAt).getTime()||0:new Date(ve.reportDate||"").getTime()||0;return($e.updatedAt?new Date($e.updatedAt).getTime()||0:new Date($e.reportDate||"").getTime()||0)>Ze?$e:ve}).insurerName||null);let ue=1,ce=0,le=0;try{const ve=(await Xe.listSheets()).filter($e=>Se($e.caseId)===I);if(ve.length>0){ve.sort((Oe,Ye)=>{const ot=new Date(Oe.updatedAt||Oe.createdAt).getTime();return new Date(Ye.updatedAt||Ye.createdAt).getTime()-ot});const $e=ve[0];ce=$e.deductibleAmount??0,le=$e.alreadyPaidAmount??0,ue=ve.reduce((Oe,Ye)=>Ye.versionIndex&&Ye.versionIndex>Oe?Ye.versionIndex:Oe,1)+1}}catch{}const fe=await Xe.createSheet(e,{caseId:M,insurerId:null,insurerName:J,periodLabel:"",versionIndex:ue,currency:"ILS",deductibleAmount:ce,alreadyPaidAmount:le,infoOnly:!1});await ee(),await j(fe.id)},L=H=>{U(H),u(M=>M.map(I=>I.id===H.sheet.id?H.sheet:I));try{const M=Fn(H.sheet,H.lineItems);q(I=>({...I,[H.sheet.id]:M}))}catch{}},O=()=>{S(null),U(null)};if(h&&P){const H=G.get(P.sheet.id)||null;return n.jsx("div",{className:"w-full px-6 md:px-8 lg:px-10 xl:px-12 py-6",children:n.jsx(Fh,{user:e,sheetWithRelations:P,onSheetUpdated:L,onBack:O,onNotifyLawyer:r,linkedReportForLawyer:H})})}return n.jsxs("div",{className:"w-full px-6 md:px-8 lg:px-10 xl:px-12 py-6",children:[n.jsxs("div",{className:"flex items-center justify-between mb-5",children:[n.jsxs("div",{children:[n.jsx("h1",{className:"text-3xl font-semibold text-gray-900",children:" "}),n.jsx("p",{className:"text-base text-gray-600 mt-1",children:"        ()."})]}),n.jsxs("div",{className:"flex gap-2 items-center",children:[l&&n.jsx("button",{type:"button",className:"px-3 py-1.5 text-base rounded border border-indigo-200 text-indigo-800 bg-indigo-50 hover:bg-indigo-100",onClick:l,children:" "}),n.jsx("button",{type:"button",className:"px-3 py-1.5 text-base rounded border border-gray-300 text-gray-700 hover:bg-gray-50",onClick:s,children:""}),n.jsx("button",{type:"button",className:"px-4 py-1.5 text-base rounded bg-blue-600 text-white hover:bg-blue-700",onClick:F,children:"   "})]})]}),n.jsxs("div",{className:"flex flex-wrap gap-4 mb-4 items-end",children:[n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"  "}),n.jsxs("select",{className:"border rounded px-2 py-1 text-base",value:R,onChange:H=>E(H.target.value==="ALL"?"ALL":H.target.value),children:[n.jsx("option",{value:"ALL",children:""}),WN.map(H=>n.jsx("option",{value:H.value,children:H.label},H.value))]})]}),n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:""}),n.jsx("input",{className:"border rounded px-2 py-1 text-base",placeholder:"   ",value:W,onChange:H=>b(H.target.value)})]})]}),n.jsx("div",{className:"bg-white border rounded-lg shadow-sm overflow-x-auto text-base",children:n.jsxs("table",{className:"min-w-full",children:[n.jsx("thead",{className:"bg-gray-50",children:n.jsxs("tr",{children:[n.jsx("th",{className:"px-3 py-2 border-b text-right",children:""}),n.jsx("th",{className:"px-3 py-2 border-b text-right",children:""}),n.jsx("th",{className:"px-3 py-2 border-b text-right",children:"  / "}),n.jsx("th",{className:"px-3 py-2 border-b text-right",children:""}),n.jsx("th",{className:"px-3 py-2 border-b text-right",children:""}),n.jsx("th",{className:"px-3 py-2 border-b text-right",children:" "}),n.jsx("th",{className:"px-3 py-2 border-b text-right",children:" "}),n.jsx("th",{className:"px-3 py-2 border-b text-right",children:""})]})}),n.jsxs("tbody",{children:[N&&n.jsx("tr",{children:n.jsx("td",{colSpan:8,className:"px-3 py-4 text-center text-gray-500",children:" "})}),!N&&se.length===0&&n.jsx("tr",{children:n.jsx("td",{colSpan:8,className:"px-3 py-4 text-center text-gray-500",children:"    ."})}),!N&&se.map(H=>{const M=G.get(H.id),I=z[H.id];M?M.status==="TASK_ASSIGNED"?" ":M.status==="WAITING_FOR_INVOICES"?" ":M.status==="READY_TO_SEND"?"   ":M.status==="SENT"?"  ":"  ":"";const D=Ph(H,M),J=Xa(H.caseId)===H.id,ue=(()=>{const ce=Se(H.caseId),le=c==null?void 0:c[ce];return le&&le.closedAt?"":!le&&!t.some(Ee=>Se(Ee.odakanitNo)===ce)?"  ":""})();return n.jsxs("tr",{className:"hover:bg-gray-50",children:[n.jsx("td",{className:"px-3 py-2 border-b font-mono text-sm text-gray-800",children:n.jsxs("div",{className:"flex flex-col items-start gap-0.5",children:[n.jsx("span",{children:H.caseId}),n.jsx("span",{className:"inline-flex px-2 py-0.5 rounded-full text-[11px] bg-gray-100 text-gray-700 border border-gray-200",children:ue===""?" ":ue==="  "?"  ":" "})]})}),n.jsx("td",{className:"px-3 py-2 border-b text-gray-800",children:H.insurerName||""}),n.jsx("td",{className:"px-3 py-2 border-b text-gray-800",children:(M==null?void 0:M.plaintiffName)||""}),n.jsxs("td",{className:"px-3 py-2 border-b text-gray-800",children:["  #",H.versionIndex]}),n.jsx("td",{className:"px-3 py-2 border-b",children:n.jsxs("div",{className:"flex flex-wrap items-center gap-1",children:[J?n.jsx("span",{className:"inline-flex px-2 py-0.5 rounded-full text-xs font-medium bg-emerald-100 text-emerald-800 border border-emerald-200",children:""}):n.jsx("span",{className:"inline-flex px-2 py-0.5 rounded-full text-xs font-medium bg-gray-100 text-gray-600 border border-gray-200",children:""}),n.jsx("span",{className:"inline-flex px-2 py-0.5 rounded-full text-sm bg-gray-100 text-gray-700 border border-gray-200",children:D})]})}),n.jsx("td",{className:"px-3 py-2 border-b text-gray-700",children:H.updatedAt?new Date(H.updatedAt).toLocaleString("he-IL",{dateStyle:"short",timeStyle:"short"}):""}),n.jsx("td",{className:"px-3 py-2 border-b text-blue-700 font-semibold",children:I?`${I.amountToRequest.toLocaleString("he-IL")} `:""}),n.jsx("td",{className:"px-3 py-2 border-b text-left",children:n.jsxs("div",{className:"flex items-center gap-2 justify-start",children:[n.jsx("button",{type:"button",className:"px-3 py-1 text-sm rounded border border-blue-500 text-blue-700 hover:bg-blue-50",onClick:()=>void j(H.id),children:""}),M&&M.status==="SENT"&&!M.isPaid&&a&&n.jsx("button",{type:"button",className:"px-3 py-1 text-sm rounded border border-green-500 text-green-700 hover:bg-green-50",onClick:()=>a(M.id),children:""}),(()=>{const ce=t.some(Oe=>Oe.expensesSheetId===H.id),le=t.find(Oe=>Oe.expensesSheetId===H.id),fe=!!(le!=null&&le.isPaid),Ee=!ce||!fe,ve=fe&&e.role==="ADMIN";if(!(Ee||ve))return n.jsx("span",{className:"text-xs text-gray-500 max-w-[180px]",children:"      ."});const Ze=()=>{if(ve)y({sheet:H,reason:""});else{if(!window.confirm("    ?   ."))return;(async()=>(await Xe.deleteSheet(H.id),o==null||o(H.id),await ee()))()}};return n.jsx("button",{type:"button",className:"px-2 py-1 text-sm rounded border border-red-400 text-red-600 hover:bg-red-50",onClick:Ze,children:""})})()]})})]},H.id)})]})]})}),p&&n.jsx("div",{className:"fixed inset-0 bg-black/50 z-[200] flex items-center justify-center p-4",dir:"rtl",children:n.jsxs("div",{className:"bg-white rounded-xl shadow-xl max-w-md w-full p-6",children:[n.jsx("h3",{className:"text-lg font-bold text-gray-900 mb-2",children:"    "}),n.jsx("p",{className:"text-sm text-gray-700 mb-4",children:"    ()."}),n.jsx("input",{type:"text",className:"w-full border rounded px-3 py-2 text-sm mb-4",placeholder:" ",value:p.reason,onChange:H=>y(M=>M?{...M,reason:H.target.value}:null)}),n.jsxs("div",{className:"flex gap-2 justify-end",children:[n.jsx("button",{type:"button",className:"px-3 py-1.5 rounded border border-gray-300 text-gray-700",onClick:()=>y(null),children:""}),n.jsx("button",{type:"button",className:"px-3 py-1.5 rounded bg-red-600 text-white disabled:opacity-50",disabled:!p.reason.trim(),onClick:()=>{p.reason.trim()&&(Xe.recordSheetDeletionByAdmin(e,p.sheet.id,p.reason.trim()),(async()=>(await Xe.deleteSheet(p.sheet.id),o==null||o(p.sheet.id),y(null),await ee()))())},children:"  "})]})]})})]})},nv=g.createContext(void 0);let sv=0;const rv=({children:e})=>{const[t,s]=g.useState([]),r=g.useCallback(l=>{s(c=>c.filter(i=>i.id!==l))},[]),a=g.useCallback(({message:l,type:c="info"})=>{const i=++sv;s(u=>[...u,{id:i,message:l,type:c}]),window.setTimeout(()=>{r(i)},3e3)},[r]),o=l=>l==="success"?"border-l-gold text-goldLight":l==="error"?"border-l-danger text-red-300":"border-l-gold text-textLight";return n.jsxs(nv.Provider,{value:{showToast:a},children:[e,n.jsx("div",{className:"fixed top-4 right-4 z-[260] flex flex-col gap-2 items-end pointer-events-none",dir:"rtl",children:t.map(l=>n.jsxs("div",{className:`pointer-events-auto max-w-xs bg-panel border border-borderDark rounded-lg shadow-lg px-3 py-2 border-l-4 text-xs flex items-center gap-2 text-textLight ${o(l.type)}`,children:[n.jsx("span",{className:"whitespace-pre-line",children:l.message}),n.jsx("button",{type:"button",onClick:()=>r(l.id),className:"ml-1 p-1 rounded hover:bg-navySecondary text-textMuted",children:n.jsx(Ht,{className:"w-3 h-3"})})]},l.id))})]})},av=({folder:e,reports:t,onBack:s,onUpdateReTemplate:r,onCreateReportInCase:a,onOpenReport:o,currentUserRole:l,onCloseCase:c,onReopenCase:i,onDeleteCase:u})=>{const[p,y]=g.useState(e.reTemplate||""),N=()=>{const h=p.trim();h!==e.reTemplate&&r(h)},E=t.filter(h=>h.odakanitNo&&h.odakanitNo.trim()===e.odakanitNo).filter(h=>h.status!=="SENT"&&!h.deletedAt)[0]||null,W=!!e.closedAt,b=g.useMemo(()=>{const h=new Map;return e.sentReports.forEach(S=>{if(!S||!S.reportId)return;const P=h.get(S.reportId);if(!P){h.set(S.reportId,S);return}const U=new Date(P.sentAt).getTime()||0;(new Date(S.sentAt).getTime()||0)>=U&&h.set(S.reportId,S)}),Array.from(h.values()).sort((S,P)=>{const U=new Date(S.sentAt).getTime()||0,z=new Date(P.sentAt).getTime()||0;return U-z})},[e.sentReports]);return n.jsx("div",{className:"min-h-screen bg-bgDark px-0 pb-8",children:n.jsxs("div",{className:"w-full px-6 md:px-8 lg:px-10 xl:px-12 pt-4",children:[n.jsx("button",{type:"button",onClick:s,className:"mb-4 inline-flex items-center rounded-full bg-panel border border-borderDark px-3 py-1.5 text-xs font-medium text-textLight shadow-sm hover:bg-navySecondary focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-gold focus-visible:ring-offset-2",children:"  "}),n.jsxs("header",{className:"mb-4 rounded-2xl bg-panel px-5 py-4 shadow-sm border border-borderDark flex flex-col gap-2 md:flex-row md:items-center md:justify-between",children:[n.jsxs("div",{children:[n.jsxs("h1",{className:"text-xl font-serif font-bold text-navy",children:["   ",e.odakanitNo]}),n.jsx("p",{className:"mt-1 text-xs text-textMuted",children:"       ."}),W&&n.jsx("p",{className:"mt-1 text-[11px] font-semibold text-amber-700",children:" :    .        ."})]}),n.jsxs("div",{className:"flex flex-wrap items-center gap-2 text-xs",children:[l==="ADMIN"&&!W&&c&&n.jsx("button",{type:"button",onClick:c,className:"inline-flex items-center rounded-full bg-red-50 px-3 py-1.5 font-semibold text-red-700 border border-red-200 hover:bg-red-100",children:" "}),l==="ADMIN"&&W&&n.jsxs(n.Fragment,{children:[i&&n.jsx("button",{type:"button",onClick:i,className:"inline-flex items-center rounded-full bg-green-50 px-3 py-1.5 font-semibold text-green-700 border border-green-200 hover:bg-green-100",children:"  "}),u&&n.jsx("button",{type:"button",onClick:u,className:"inline-flex items-center rounded-full bg-panel px-3 py-1.5 font-semibold text-textLight border border-borderDark hover:bg-navySecondary",children:" "})]})]})]}),n.jsxs("section",{className:"mb-4 grid gap-4 md:grid-cols-2",children:[n.jsxs("div",{className:"rounded-2xl bg-panel p-4 shadow-sm border border-borderDark",children:[n.jsx("h2",{className:"mb-2 text-xs font-semibold uppercase tracking-wide text-textMuted",children:" "}),n.jsxs("dl",{className:"space-y-1 text-xs text-textLight",children:[n.jsxs("div",{children:[n.jsx("dt",{className:"font-semibold text-textMuted",children:""}),n.jsx("dd",{children:e.insuredName||""})]}),n.jsxs("div",{children:[n.jsx("dt",{className:"font-semibold text-textMuted",children:""}),n.jsx("dd",{children:e.plaintiffName||""})]}),n.jsxs("div",{children:[n.jsx("dt",{className:"font-semibold text-textMuted",children:""}),n.jsx("dd",{children:e.insurerName||""})]}),n.jsxs("div",{children:[n.jsx("dt",{className:"font-semibold text-textMuted",children:"UMR /  "}),n.jsx("dd",{children:e.marketRef||""})]}),n.jsxs("div",{children:[n.jsx("dt",{className:"font-semibold text-textMuted",children:"Line Slip"}),n.jsx("dd",{children:e.lineSlipNo||""})]}),n.jsxs("div",{children:[n.jsx("dt",{className:"font-semibold text-textMuted",children:" "}),n.jsx("dd",{children:e.certificateRef||""})]}),n.jsxs("div",{children:[n.jsx("dt",{className:"font-semibold text-textMuted",children:"  "}),n.jsx("dd",{children:e.reportIds.length})]}),W&&n.jsxs("div",{children:[n.jsx("dt",{className:"font-semibold text-textMuted",children:" "}),n.jsx("dd",{className:"text-amber-700",children:""})]})]})]}),n.jsxs("div",{className:"rounded-2xl bg-panel p-4 shadow-sm border border-borderDark",children:[n.jsx("h2",{className:"mb-2 text-xs font-semibold uppercase tracking-wide text-textMuted",children:"  (RE)"}),n.jsx("textarea",{className:"w-full rounded-lg border border-borderDark p-2 text-xs text-textLight placeholder:text-textMuted focus:border-navy focus:outline-none focus:ring-1 focus:ring-navy",rows:4,value:p,onChange:h=>y(h.target.value),onBlur:N,placeholder:"Example: John Doe v. XYZ Medical Center - Claim Update"}),n.jsx("div",{className:"mt-3 flex justify-end",children:n.jsx("button",{type:"button",onClick:a,className:"inline-flex items-center rounded-full bg-navy px-4 py-1.5 text-[11px] font-semibold text-white shadow-sm hover:bg-blue-900 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-navy focus-visible:ring-offset-2",children:"    "})})]})]}),n.jsxs("section",{className:"mb-4 rounded-2xl bg-panel p-4 shadow-sm border border-borderDark",children:[n.jsxs("div",{className:"mb-3 flex items-center justify-between gap-3",children:[n.jsxs("div",{children:[n.jsx("h2",{className:"text-sm font-semibold text-textLight",children:"   "}),n.jsx("p",{className:"text-xs text-textMuted",children:"     SENT   ( )."})]}),n.jsxs("div",{className:"flex items-center gap-2",children:[E&&n.jsx("button",{type:"button",onClick:()=>o(E.id),className:"rounded-full bg-amber-50 px-3 py-1 text-[11px] font-semibold text-amber-800 border border-amber-200 hover:bg-amber-100",children:"     "}),!W&&n.jsx(n.Fragment,{children:l==="LAWYER"?!E&&n.jsx("button",{type:"button",onClick:a,className:"inline-flex items-center rounded-full bg-navy px-4 py-1.5 text-xs font-semibold text-white shadow-sm hover:bg-blue-900 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-navy focus-visible:ring-offset-2",children:"    "}):n.jsx("button",{type:"button",onClick:a,className:"inline-flex items-center rounded-full bg-navy px-4 py-1.5 text-xs font-semibold text-white shadow-sm hover:bg-blue-900 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-navy focus-visible:ring-offset-2",children:E?"   ()":"    "})})]})]}),n.jsx("div",{className:"overflow-x-auto",children:n.jsxs("table",{className:"min-w-full text-xs text-left text-textLight",children:[n.jsx("thead",{className:"bg-navySecondary text-[11px] uppercase tracking-wide text-textMuted",children:n.jsxs("tr",{children:[n.jsx("th",{className:"px-3 py-2",children:"' "}),n.jsx("th",{className:"px-3 py-2",children:""}),n.jsx("th",{className:"px-3 py-2",children:" "}),n.jsx("th",{className:"px-3 py-2",children:"  / "}),n.jsx("th",{className:"px-3 py-2",children:""})]})}),n.jsxs("tbody",{className:"divide-y divide-gray-100",children:[b.length===0&&n.jsx("tr",{children:n.jsx("td",{colSpan:4,className:"px-3 py-4 text-center text-textMuted",children:"No sent reports recorded for this case yet."})}),b.map(h=>{const S=h.sentAt?new Date(h.sentAt).toLocaleDateString("en-GB",{day:"2-digit",month:"short",year:"numeric"}):"",P=h.snapshot&&h.snapshot.reportSubject||"",U=h.fileName||P||"";return n.jsxs("tr",{children:[n.jsx("td",{className:"px-3 py-2",children:h.reportNo?`#${h.reportNo}`:""}),n.jsx("td",{className:"px-3 py-2",children:h.isResend?n.jsx("span",{className:"inline-flex items-center rounded-full bg-amber-50 px-2 py-0.5 text-[10px] font-semibold text-amber-800 border border-amber-200",children:" "}):n.jsx("span",{className:"inline-flex items-center rounded-full bg-navySecondary px-2 py-0.5 text-[10px] font-semibold text-textMuted border border-borderDark",children:" "})}),n.jsx("td",{className:"px-3 py-2",children:S}),n.jsx("td",{className:"px-3 py-2",children:U}),n.jsx("td",{className:"px-3 py-2",children:n.jsx("button",{type:"button",onClick:()=>o(h.reportId),className:"inline-flex items-center rounded-full bg-panel px-3 py-1 text-[11px] font-semibold text-navy ring-1 ring-navy hover:bg-blue-50 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-navy focus-visible:ring-offset-2","aria-label":` " ${h.reportId}`,children:""})})]},`${h.reportId}-${h.sentAt}`)})]})]})})]})]})})},Bh="lp_case_folders",$h="lp_case_folders_migrated",ov=()=>{if(typeof window>"u")return{};try{const e=window.localStorage.getItem(Bh),t=e?JSON.parse(e):{};return!t||typeof t!="object"?{}:t}catch(e){return console.error("Failed to load case folders",e),{}}},Dn=e=>{if(!(typeof window>"u"))try{window.localStorage.setItem(Bh,JSON.stringify(e))}catch(t){console.error("Failed to persist case folders",t)}},lv=e=>{if(!e||typeof e!="object")return{};const t={};let s=!1;return Object.entries(e).forEach(([r,a])=>{const o=a.odakanitNo||r,l=Se(o);if(!l){s=!0;return}const c=t[l];if(!c){t[l]={...a,odakanitNo:l},l!==r&&(s=!0);return}s=!0;const i=(N,w)=>{if(!N)return w;if(!w)return N;const R=new Date(N.updatedAt||N.createdAt||"").getTime()||0;return(new Date(w.updatedAt||w.createdAt||"").getTime()||0)>R?w:N};let u=c,p=a;(!c.closedAt&&a.closedAt||i(c,a)===a)&&(u=a,p=c);const y={...u,odakanitNo:l,reTemplate:u.reTemplate||p.reTemplate||"",insuredName:u.insuredName||p.insuredName||"",insurerName:u.insurerName||p.insurerName||"",plaintiffName:u.plaintiffName||p.plaintiffName||"",marketRef:u.marketRef||p.marketRef||"",lineSlipNo:u.lineSlipNo||p.lineSlipNo||"",certificateRef:u.certificateRef||p.certificateRef||"",createdAt:u.createdAt||p.createdAt,updatedAt:u.updatedAt||p.updatedAt,closedAt:u.closedAt||p.closedAt||null,closedByUserId:u.closedByUserId||p.closedByUserId||null,reportIds:Array.from(new Set([...u.reportIds||[],...p.reportIds||[]])),sentReports:[...u.sentReports||[],...p.sentReports||[]]};t[l]=y}),s?t:e},Pd=(e,t,s)=>{if(!t.odakanitNo)return e;const r=Se(t.odakanitNo);if(!r)return e;const a=s||new Date().toISOString(),o=e[r],l=o||{odakanitNo:r,reTemplate:"",insuredName:"",insurerName:"",plaintiffName:"",marketRef:"",lineSlipNo:"",certificateRef:"",createdAt:(o==null?void 0:o.createdAt)||a,updatedAt:(o==null?void 0:o.updatedAt)||a,reportIds:[],sentReports:(o==null?void 0:o.sentReports)||[]},c={...l,insuredName:t.insuredName||l.insuredName,insurerName:t.insurerName||l.insurerName,plaintiffName:t.plaintiffName||l.plaintiffName,marketRef:t.marketRef||l.marketRef,lineSlipNo:t.lineSlipNo||l.lineSlipNo,certificateRef:t.certificateRef||l.certificateRef,updatedAt:a,reportIds:l.reportIds.includes(t.id)?l.reportIds:[...l.reportIds,t.id],sentReports:l.sentReports},i=(t.reportSubject||"").trim();return i&&(!l.reTemplate||i!==l.reTemplate)&&(c.reTemplate=i),{...e,[r]:c}},Hh=(e,t,s,r,a)=>{var N;if(!t.odakanitNo)return e;const o=Se(t.odakanitNo);if(!o)return e;const l=s||new Date().toISOString(),c=e[o];if(!c)return e;const i=typeof t.reportNumber=="number"&&t.reportNumber>0?t.reportNumber:(((N=t.reportHistory)==null?void 0:N.length)||0)+1,u={id:t.id,odakanitNo:t.odakanitNo,insuredName:t.insuredName,plaintiffName:t.plaintiffName,insurerName:t.insurerName,marketRef:t.marketRef,lineSlipNo:t.lineSlipNo,certificateRef:t.certificateRef,reportDate:t.reportDate,status:"SENT",reportSubject:t.reportSubject},p={reportId:t.id,sentAt:l,reportNo:i,fileName:r,snapshot:u,isResend:!!a,resendIndex:i},y={...c,updatedAt:l,sentReports:[...c.sentReports,p]};return{...e,[o]:y}},Mc=(e,t)=>{let s={...e};return t.forEach(r=>{if(r.odakanitNo&&(s=Pd(s,r,r.updatedAt||r.reportDate),r.status==="SENT")){const a=r.sentAt||r.reportDate||new Date().toISOString();s=Hh(s,r,a)}}),s},iv=()=>{if(!(typeof window>"u"))try{window.localStorage.setItem($h,"1")}catch{}},cv=()=>{if(typeof window>"u")return!0;try{return window.localStorage.getItem($h)==="1"}catch{return!0}},dv=(e,t)=>{const s=e.split(/\s+/).filter(Boolean),r=t.split(/\s+/).filter(Boolean),a=s.length,o=r.length;if(!a&&!o)return[];const l=Array.from({length:a+1},()=>Array(o+1).fill(0));for(let p=a-1;p>=0;p-=1)for(let y=o-1;y>=0;y-=1)s[p]===r[y]?l[p][y]=l[p+1][y+1]+1:l[p][y]=Math.max(l[p+1][y],l[p][y+1]);const c=[];let i=0,u=0;for(;i<a&&u<o;)s[i]===r[u]?(c.push({type:"same",text:s[i]}),i+=1,u+=1):l[i+1][u]>=l[i][u+1]?(c.push({type:"remove",text:s[i]}),i+=1):(c.push({type:"add",text:r[u]}),u+=1);for(;i<a;)c.push({type:"remove",text:s[i]}),i+=1;for(;u<o;)c.push({type:"add",text:r[u]}),u+=1;return c},uv=e=>e==="STEP2"?2:e==="PREVIEW"?3:1,mv=e=>{switch(e){case"STEP1":return"Setup";case"STEP2":return"Draft";case"PREVIEW":return"Preview";case"CASE_FOLDER":return"Case Folder";default:return"Dashboard"}},pv=e=>e?e.role:"Guest",fv=e=>e===1?[{intent:"explain_current_screen",label:"   ?"},{intent:"explain_buttons_in_step",label:"    "},{intent:"common_mistakes_here",label:"   1"}]:e===2?[{intent:"explain_current_screen",label:"    2"},{intent:"when_to_use_ai_tools",label:"   -AI "},{intent:"explain_hebrew_rewrite",label:"    "},{intent:"explain_tone_risk",label:"  Tone & Risk"},{intent:"common_mistakes_here",label:"   2"}]:[{intent:"pre_send_checks",label:"    "},{intent:"explain_tone_risk",label:"   Tone & Risk?"},{intent:"common_mistakes_here",label:"   "}],xv=({isOpen:e,onClose:t,view:s,currentUser:r,currentReport:a,loading:o,error:l,response:c,onRunIntent:i})=>{if(!e)return null;const u=uv(s),p=mv(s),y=pv(r),N=fv(u),w=!!a;return n.jsxs(n.Fragment,{children:[n.jsx("div",{className:"fixed inset-0 bg-black/10 z-[180]",onClick:t}),n.jsxs("div",{className:"fixed inset-y-0 right-0 z-[190] w-full max-w-md bg-panel border-l border-borderDark200 shadow-2xl flex flex-col",children:[n.jsxs("div",{className:"px-4 py-3 border-b border-borderDark200 flex items-center justify-between bg-navySecondary",children:[n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsx("div",{className:"h-8 w-8 rounded-full bg-indigo-600 flex items-center justify-center text-white",children:n.jsx(ia,{className:"w-4 h-4"})}),n.jsxs("div",{className:"flex flex-col",children:[n.jsx("span",{className:"text-sm font-semibold text-textLight",children:" "}),n.jsxs("span",{className:"text-[11px] text-textMuted",children:["Step ",u,"  ",p,"  ",y]})]})]}),n.jsx("button",{type:"button",onClick:t,className:"p-1 rounded hover:bg-navySecondary text-textMuted",children:n.jsx(Ht,{className:"w-4 h-4"})})]}),n.jsxs("div",{className:"px-4 py-3 border-b border-borderDark bg-panel",children:[n.jsxs("div",{className:"flex items-center justify-between mb-2",children:[n.jsx("span",{className:"text-[11px] font-semibold text-textMuted600",children:"   "}),!w&&n.jsx("span",{className:"text-[10px] text-textMuted",children:'     ".'})]}),n.jsx("div",{className:"flex flex-wrap gap-2",children:N.map(R=>n.jsx("button",{type:"button",disabled:o||!w,onClick:()=>i(R.intent),className:`text-[11px] px-3 py-1.5 rounded-full border transition ${o||!w?"border-borderDark200 text-textMuted bg-navySecondary cursor-not-allowed":"border-indigo-200 text-indigo-800 bg-indigo-50 hover:bg-indigo-100"}`,children:R.label},R.intent))})]}),n.jsxs("div",{className:"flex-1 overflow-auto px-4 py-3 space-y-3",dir:"rtl",children:[o&&n.jsxs("div",{className:"flex items-center gap-2 text-[12px] text-textMuted600",children:[n.jsx(Bt,{className:"w-4 h-4 animate-spin"}),n.jsx("span",{children:"      "})]}),!o&&l&&n.jsxs("div",{className:"rounded-md border border-red-200 bg-red-50 px-3 py-2 text-[12px] text-red-800",children:[n.jsx("div",{className:"font-semibold mb-1",children:"    "}),n.jsx("div",{children:"      .   ,   ."})]}),!o&&!l&&c&&n.jsxs("div",{className:"space-y-2",children:[n.jsx("div",{className:"text-sm font-semibold text-textLight",children:c.title}),n.jsx("ul",{className:"list-disc pr-4 space-y-1 text-[12px] text-textLight",children:c.bullets.map((R,E)=>n.jsx("li",{children:R},E))}),c.warning&&n.jsxs("div",{className:"mt-2 rounded-md border border-amber-200 bg-amber-50 px-3 py-2 text-[11px] text-amber-900",children:[n.jsx("span",{className:"font-semibold",children:" : "}),c.warning]}),c.nextSuggestion&&n.jsxs("div",{className:"mt-1 text-[11px] text-textMuted600",children:[n.jsx("span",{className:"font-semibold",children:" : "}),c.nextSuggestion]})]}),!o&&!l&&!c&&n.jsxs("div",{className:"text-[12px] text-textMuted space-y-1",children:[n.jsx("div",{children:'         ,    " .'}),n.jsx("div",{children:"         ."})]})]}),n.jsxs("div",{className:"px-4 py-3 border-t border-borderDark bg-navySecondary",children:[n.jsx("div",{className:"text-[10px] text-textMuted mb-1",children:"   '        ."}),n.jsx("input",{type:"text",disabled:!0,className:"w-full text-[11px] px-2 py-1.5 rounded border border-dashed border-borderDark200 bg-navySecondary text-textMuted",placeholder:"          ."})]})]})]})},_p=24*60*60*1e3;function vt(e,t,s=new Date){const r={isLocked:!1,lockType:"NONE",lockAt:null,autoLockAt:null,remainingDays:null,reasonSummary:null},a=s.getTime();if(t!=null&&t.closedAt){const o=t.closedAt;return{...r,isLocked:!0,lockType:"MANUAL",lockAt:o,autoLockAt:null,remainingDays:null,reasonSummary:"      ."}}if(e.manualLockedAt)return{...r,isLocked:!0,lockType:"MANUAL",lockAt:e.manualLockedAt,autoLockAt:null,remainingDays:null,reasonSummary:e.manualLockReason?` : ${e.manualLockReason}`:"   ."};if(e.firstSentAt){const l=new Date(e.firstSentAt).getTime();if(!Number.isFinite(l))return r;const i=35+((e.lockExtensions||[]).reduce((E,W)=>{const b=typeof W.days=="number"&&!Number.isNaN(W.days)?W.days:0;return E+b},0)||0),u=l+i*_p,p=new Date(u),y=p.toISOString();if(a>=u)return{...r,isLocked:!0,lockType:"AUTO",lockAt:y,autoLockAt:y,remainingDays:null,reasonSummary:"    35    ."};const w=(u-a)/_p,R=w>0?Math.ceil(w):0;return{...r,isLocked:!1,lockType:"NONE",lockAt:null,autoLockAt:y,remainingDays:R,reasonSummary:`    -${R}  (-${p.toLocaleDateString("he-IL")}).`}}return r}const Op=new Map,hv=60*1e3;function xl(e){const t=`${e.reason}::${e.reportId??"unknown"}`,s=Date.now(),r=Op.get(t)??0;s-r<hv||(Op.set(t,s),console.info("[blocked-edit]",e))}const gv="personal_snippets",Uh=e=>`${gv}:${e}`,yv=(e,t)=>{if(!e)return[];try{const s=JSON.parse(e);if(!Array.isArray(s))return[];const r=new Date().toISOString();return s.map((a,o)=>{const l=a||{},c=typeof l.id=="string"&&l.id?l.id:`ps-${Date.now()}-${o}-${Math.random().toString(36).slice(2,6)}`,i=typeof l.title=="string"&&l.title.trim()?l.title:"Untitled snippet",u=typeof l.body=="string"?l.body:"",p=typeof l.createdAt=="string"&&l.createdAt?l.createdAt:r,y=typeof l.updatedAt=="string"&&l.updatedAt?l.updatedAt:p,N=typeof l.createdByUserId=="string"&&l.createdByUserId?l.createdByUserId:t,w=typeof l.usageCount=="number"&&Number.isFinite(l.usageCount)&&l.usageCount>=0?l.usageCount:0,R=typeof l.lastUsedAt=="string"&&l.lastUsedAt.trim()?l.lastUsedAt:null,E=typeof l.sectionKey=="string"&&l.sectionKey?l.sectionKey:void 0,W=Array.isArray(l.tags)?l.tags.filter(h=>typeof h=="string"&&h.trim()).map(h=>h.trim()):void 0;return{id:c,title:i,body:u,sectionKey:E,tags:W,createdByUserId:N,createdAt:p,updatedAt:y,usageCount:w,lastUsedAt:R}})}catch{return[]}},Eo=e=>{if(typeof window>"u")return[];if(!e)return[];const t=window.localStorage.getItem(Uh(e));return yv(t,e)},qu=(e,t)=>{if(!(typeof window>"u")&&e)try{window.localStorage.setItem(Uh(e),JSON.stringify(t))}catch{}},bv=(e,t)=>{const s=new Date().toISOString(),r=Eo(e);let a;if(t.id)a=r.map(o=>o.id===t.id?{...o,title:t.title,body:t.body,sectionKey:t.sectionKey,tags:t.tags,updatedAt:s}:o);else{const l={id:`ps-${Date.now()}-${Math.random().toString(36).slice(2,8)}`,title:t.title,body:t.body,sectionKey:t.sectionKey,tags:t.tags,createdByUserId:e,createdAt:s,updatedAt:s,usageCount:0,lastUsedAt:null};a=[...r,l]}return qu(e,a),a},Mp=(e,t)=>{const r=Eo(e).filter(a=>a.id!==t);return qu(e,r),r},Nv=(e,t)=>{const s=Eo(e),r=new Date().toISOString(),a=s.map(o=>o.id===t?{...o,usageCount:(o.usageCount||0)+1,lastUsedAt:r}:o);return qu(e,a),a},Pp=`    .
      .

  ,   OCR Adobe Acrobat    .`,Lr=`     .
      .`,Pc=`    .
  ,      .`,vv={title:"Final Preview",toggleHide:"Hide Preview",toggleShow:"Show Preview",downloadPdf:"Download PDF",editFileNames:"Edit file name titles",finalize:"Finalize & Close",backToEditing:"Back to Editing",backToStep2:"Back to Step 2",backToDashboard:"Back to dashboard",helperScroll:"Scroll to review entire document",collapsedHint:'Click "Show Preview" to review the document before sending.'},Sv={title:" ",toggleHide:" ",toggleShow:" ",downloadPdf:" PDF",editFileNames:"  ",finalize:" ",backToEditing:" ",backToStep2:"  2",backToDashboard:"  ",helperScroll:"    ",collapsedHint:'  " "     .'},wv=e=>e==="LAWYER"?Sv:vv,Fp={SOC:["   ___________     ____________ ____________   ,   ____________________.","","        ____________________.","","      ,       ________________________."].join(`
`),LOD:["   ___________      .","","        ____________________.","",",    Claimant    ,      ______________________."].join(`
`)},jv=({message:e,type:t,onClose:s})=>{const r="fixed top-4 right-4 z-[100] p-4 rounded-lg shadow-xl border-l-4 flex items-center gap-3 animate-slide-in bg-panel border-borderDark text-textLight",a=t==="success"?"border-l-gold text-goldLight":t==="error"?"border-l-danger text-red-300":t==="warning"?"border-l-gold text-goldLight":"border-l-gold text-textLight";return n.jsxs("div",{className:`${r} ${a}`,children:[n.jsx("span",{children:e}),n.jsx("button",{onClick:s,className:"hover:bg-navySecondary p-1 rounded text-textMuted",children:n.jsx(Ht,{className:"w-4 h-4"})})]})},Ev=({onSubmit:e,onCancel:t,initialTitle:s})=>{const[r,a]=g.useState(s||""),[o,l]=g.useState("BEST_PRACTICE"),[c,i]=g.useState(""),[u,p]=g.useState("INSERTABLE"),y=N=>{N.preventDefault();const w=r.trim();if(!w)return;const R=c.split(",").map(E=>E.trim()).filter(Boolean);e({title:w,label:o,tags:R,behavior:u})};return n.jsxs("form",{onSubmit:y,className:"px-4 py-3 space-y-3 text-xs",children:[n.jsxs("div",{className:"space-y-1",children:[n.jsx("label",{className:"block font-semibold text-textLight",children:"Title"}),n.jsx("input",{type:"text",className:"w-full border border-borderDark rounded px-2 py-1 text-xs",value:r,onChange:N=>a(N.target.value),required:!0})]}),n.jsxs("div",{className:"space-y-1",children:[n.jsx("label",{className:"block font-semibold text-textLight",children:"Label / Type"}),n.jsxs("select",{className:"w-full border border-borderDark rounded px-2 py-1 text-xs",value:o,onChange:N=>l(N.target.value==="LLOYDS_RECOMMENDED"?"LLOYDS_RECOMMENDED":"BEST_PRACTICE"),children:[n.jsx("option",{value:"BEST_PRACTICE",children:"Best practice"}),n.jsx("option",{value:"LLOYDS_RECOMMENDED",children:"Lloyds recommended"})]})]}),n.jsxs("div",{className:"space-y-1",children:[n.jsx("label",{className:"block font-semibold text-textLight",children:"Tags (optional)"}),n.jsx("input",{type:"text",className:"w-full border border-borderDark rounded px-2 py-1 text-xs",placeholder:"e.g. lloyds, settlement, high exposure",value:c,onChange:N=>i(N.target.value)})]}),n.jsxs("div",{className:"space-y-1",children:[n.jsx("label",{className:"block font-semibold text-textLight",children:"Behavior"}),n.jsxs("div",{className:"flex items-center gap-3",children:[n.jsxs("label",{className:"flex items-center gap-1",children:[n.jsx("input",{type:"radio",name:"bp-behavior",checked:u==="INSERTABLE",onChange:()=>p("INSERTABLE")}),n.jsx("span",{children:"Insertable (insert into body)"})]}),n.jsxs("label",{className:"flex items-center gap-1",children:[n.jsx("input",{type:"radio",name:"bp-behavior",checked:u==="COPY_ONLY",onChange:()=>p("COPY_ONLY")}),n.jsx("span",{children:"Copy only"})]})]})]}),n.jsxs("div",{className:"flex items-center justify-end gap-2 pt-2 border-t border-borderDark mt-2",children:[n.jsx("button",{type:"button",onClick:t,className:"px-3 py-1.5 rounded border border-borderDark text-[11px] text-textLight hover:bg-slate-100",children:""}),n.jsx("button",{type:"submit",className:"px-3 py-1.5 rounded bg-emerald-600 text-white text-[11px] hover:bg-emerald-700",children:" Best Practice"})]})]})},Bp=({value:e,onChange:t,placeholder:s,disabled:r,readOnly:a,dir:o="ltr",className:l,style:c={},textareaRef:i})=>{const u=g.useRef(null),p=i||u;return g.useEffect(()=>{const y=p&&"current"in p?p.current:u.current;y&&(y.style.height="auto",y.style.height=y.scrollHeight+"px")},[e,p]),n.jsx(go,{clientId:So,children:n.jsx("textarea",{ref:p,className:l,dir:o,value:e,onChange:a?void 0:t,placeholder:s,disabled:r||a,rows:3,style:{...c,overflow:"hidden",resize:"none"}})})},kv=({onClose:e})=>{const[t,s]=g.useState("MANUAL"),[r,a]=g.useState(""),[o,l]=g.useState([]),[c,i]=g.useState(!1),u=async()=>{if(!r.trim())return;i(!0);const p=await nb(r);l(y=>[...y,{q:r,a:p}]),a(""),i(!1)};return n.jsx("div",{className:"fixed inset-0 bg-black/50 z-[200] flex items-center justify-center p-4",children:n.jsxs("div",{className:"bg-panel w-full max-w-3xl h-[600px] rounded-xl shadow-2xl flex flex-col overflow-hidden animate-scale-in",children:[n.jsxs("div",{className:"bg-navy p-4 text-gold flex justify-between items-center",children:[n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsx(Lu,{className:"w-6 h-6"}),n.jsx("h2",{className:"font-bold text-lg",children:"  "})]}),n.jsx("button",{onClick:e,className:"hover:bg-panel/20 rounded p-1",children:n.jsx(Ht,{className:"w-5 h-5"})})]}),n.jsxs("div",{className:"flex border-b",children:[n.jsx("button",{onClick:()=>s("MANUAL"),className:`flex-1 p-3 font-bold ${t==="MANUAL"?"text-lpBlue border-b-2 border-lpBlue":"text-textMuted"}`,children:" "}),n.jsx("button",{onClick:()=>s("CHAT"),className:`flex-1 p-3 font-bold ${t==="CHAT"?"text-lpBlue border-b-2 border-lpBlue":"text-textMuted"}`,children:"   "})]}),n.jsx("div",{className:"flex-1 overflow-auto p-6 bg-navySecondary",dir:"rtl",children:t==="MANUAL"?n.jsxs("div",{className:"space-y-4",children:[n.jsxs("details",{className:"bg-panel p-4 rounded shadow-sm group",children:[n.jsxs("summary",{className:"font-bold text-textLight cursor-pointer list-none flex justify-between",children:["   ",n.jsx(is,{className:"group-open:rotate-90 transition"})]}),n.jsxs("div",{className:"mt-2 text-textMuted text-sm space-y-1",children:[n.jsx("p",{children:"1.       (CRM / Finance /    )."}),n.jsx("p",{children:"2.       +  Notifications   ."}),n.jsx("p",{children:`3.  ""     ' .`})]})]}),n.jsxs("details",{className:"bg-panel p-4 rounded shadow-sm group",children:[n.jsxs("summary",{className:"font-bold text-textLight cursor-pointer list-none flex justify-between",children:['    " ',n.jsx(is,{className:"group-open:rotate-90 transition"})]}),n.jsxs("div",{className:"mt-2 text-textMuted text-sm space-y-1",children:[n.jsxs("p",{children:["1.   ",n.jsx("strong",{children:"Open New Case Folder"}),",      ."]}),n.jsx("p",{children:"2.  ,   4  (Word/PDF)    ."}),n.jsx("p",{children:"3.   FINANCE FINALIZE     ."})]})]}),n.jsxs("details",{className:"bg-panel p-4 rounded shadow-sm group",children:[n.jsxs("summary",{className:"font-bold text-textLight cursor-pointer list-none flex justify-between",children:["   ",n.jsx(is,{className:"group-open:rotate-90 transition"})]}),n.jsxs("div",{className:"mt-2 text-textMuted text-sm space-y-1",children:[n.jsx("p",{children:'   View Worksheet  , ,   " .'}),n.jsx("p",{children:" /     ( ADD),    ."}),n.jsx("p",{children:'  ,      "     Expenses.'})]})]}),n.jsxs("details",{className:"bg-panel p-4 rounded shadow-sm group",children:[n.jsxs("summary",{className:"font-bold text-textLight cursor-pointer list-none flex justify-between",children:["    ",n.jsx(is,{className:"group-open:rotate-90 transition"})]}),n.jsxs("div",{className:"mt-2 text-textMuted text-sm space-y-1",children:[n.jsx("p",{children:"  Manage Favorite Providers     ."}),n.jsx("p",{children:"        ."}),n.jsx("p",{children:'    4   (PDF/Word)  "    .'})]})]}),n.jsxs("details",{className:"bg-panel p-4 rounded shadow-sm group",children:[n.jsxs("summary",{className:"font-bold text-textLight cursor-pointer list-none flex justify-between",children:[' "     ',n.jsx(is,{className:"group-open:rotate-90 transition"})]}),n.jsxs("div",{className:"mt-2 text-textMuted text-sm space-y-1",children:[n.jsx("p",{children:"       -FINANCE   FINALIZE."}),n.jsx("p",{children:' FINALIZE  "     (READY TO SEND)   .'}),n.jsx("p",{children:"     (48   , 30   )     ."})]})]})]}):n.jsxs("div",{className:"flex flex-col h-full",children:[n.jsxs("div",{className:"flex-1 space-y-4 mb-4 overflow-auto",children:[o.length===0&&n.jsx("div",{className:"text-center text-gray-400 mt-10",children:"     !"}),o.map((p,y)=>n.jsxs("div",{className:"space-y-1",children:[n.jsx("div",{className:"bg-blue-100 text-blue-900 p-2 rounded-lg rounded-tr-none self-end w-fit ml-auto max-w-[80%]",children:p.q}),n.jsx("div",{className:"bg-panel border text-textLight p-2 rounded-lg rounded-tl-none self-start w-fit mr-auto max-w-[80%]",children:p.a})]},y))]}),n.jsxs("div",{className:"flex gap-2",dir:"ltr",children:[n.jsx("input",{className:"flex-1 border p-2 rounded",placeholder:"/   ...",value:r,onChange:p=>a(p.target.value),onKeyDown:p=>p.key==="Enter"&&u()}),n.jsx("button",{onClick:u,disabled:c,className:"bg-navy text-gold px-4 rounded hover:bg-navySecondary",children:c?n.jsx(Bt,{className:"w-5 h-5 animate-spin"}):n.jsx(ti,{className:"w-5 h-5"})})]})]})})]})})},Av=({reports:e,currentUser:t,onMarkPaid:s})=>{const r=e.filter(l=>l.expensesSum&&!l.isPaid),a=r.reduce((l,c)=>{var u;const i=parseFloat(((u=c.expensesSum)==null?void 0:u.replace(/,/g,""))||"0");return l+(isNaN(i)?0:i)},0),o=t.role==="SUB_ADMIN";return r.length?n.jsxs("div",{className:"mb-8 bg-panel rounded-xl shadow-sm border border-indigo-100 overflow-hidden",children:[n.jsxs("div",{className:"bg-gradient-to-r from-indigo-600 to-indigo-800 p-4 text-white flex justify-between items-center",children:[n.jsxs("h3",{className:"font-bold text-lg flex items-center",children:[n.jsx(R0,{className:"w-6 h-6 mr-2"})," Financial Control - Outstanding Expenses"]}),n.jsxs("div",{className:"text-xl font-bold bg-panel/20 px-4 py-1 rounded",children:["Total: ",a.toLocaleString()]})]}),n.jsx("div",{className:"overflow-x-auto",children:n.jsxs("table",{className:"w-full text-left text-sm",children:[n.jsx("thead",{className:"bg-indigo-50 text-indigo-800",children:n.jsxs("tr",{children:[n.jsx("th",{className:"p-3",children:"Report Date"}),n.jsx("th",{className:"p-3",children:"Insured / File"}),n.jsx("th",{className:"p-3",children:"Amount Requested"}),n.jsx("th",{className:"p-3",children:"Action"})]})}),n.jsx("tbody",{className:"divide-y divide-gray-100",children:r.map(l=>n.jsxs("tr",{className:"hover:bg-navySecondary",children:[n.jsx("td",{className:"p-3",children:new Date(l.reportDate).toLocaleDateString()}),n.jsxs("td",{className:"p-3 font-medium",children:[l.insuredName," (",l.marketRef,")"]}),n.jsxs("td",{className:"p-3 font-bold text-indigo-700",children:["",l.expensesSum]}),n.jsx("td",{className:"p-3",children:o?n.jsx("button",{onClick:()=>s(l.id),className:"text-red-400 hover:text-red-600 hover:bg-red-50 p-1.5 rounded transition",title:"Mark as Paid",children:n.jsx(Ws,{className:"w-4 h-4"})}):n.jsx("span",{className:"text-gray-400 cursor-not-allowed",children:n.jsx(Ws,{className:"w-4 h-4"})})})]},l.id))})]})})]}):null};new URL("/assets/statement%20of%20claim-BbEIHM0L.jpg",import.meta.url).href,new URL("/assets/statement%20of%20defence-BIigMwUC.jpg",import.meta.url).href,new URL("/assets/preliminary%20proceedings-BoY9iCcP.jpg",import.meta.url).href,new URL("/assets/evidence%20submission-CZIKo1E1.jpg",import.meta.url).href,new URL("/assets/evidentiary%20hearing-BibkA_Ru.jpg",import.meta.url).href,new URL("/assets/summaries-BEUvavav.jpg",import.meta.url).href,new URL("/assets/judgment-cIMuyU1R.jpg",import.meta.url).href;const Iv=[{value:"LETTER_OF_DEMAND",label:"Letter of Demand"},{value:"FIRST_INSTANCE",label:"First Instance Proceedings"},{value:"APPEAL",label:"Appeal Proceedings"}],Oa={LETTER_OF_DEMAND:[{id:"LOD_ISSUED",label:"Letter of Demand Issued"},{id:"LOD_INTERNAL_REVIEW",label:"Internal Review & Coverage Assessment"},{id:"LOD_RESPONSE",label:"Response to Letter of Demand"},{id:"LOD_PRE_LITIGATION",label:"Pre-Litigation Negotiations"},{id:"LOD_OUTCOME_ESCALATION",label:"Outcome / Escalation Decision"},{id:"LOD_CLAIM_SETTLED",label:"Claim Settled"},{id:"LOD_DEMAND_REJECTED",label:"Demand Rejected"}],FIRST_INSTANCE:[{id:"FI_STATEMENT_OF_CLAIM",label:"Statement of Claim Filed"},{id:"FI_STATEMENT_OF_DEFENCE",label:"Statement of Defence Filed"},{id:"FI_DISCOVERY_DISCLOSURE",label:"Discovery & Disclosure"},{id:"FI_COURT_APPOINTED_EXPERT",label:"Court-Appointed Expert",isDynamic:!0},{id:"FI_RD_DOCS_DAMAGE_SUBMISSIONS",label:"R & D Docs  Damage Assessment Submissions",isDynamic:!0},{id:"FI_EVIDENTIARY_HEARINGS",label:"Evidentiary Hearings"},{id:"FI_SUMMATIONS",label:"Summations"},{id:"FI_JUDGMENT",label:"Judgment"}],APPEAL:[{id:"AP_DECISION_TO_APPEAL",label:"Decision to Appeal"},{id:"AP_NOTICE_OF_APPEAL",label:"Notice of Appeal Filed"},{id:"AP_RESPONSE_TO_APPEAL",label:"Response to Appeal"},{id:"AP_APPEAL_HEARINGS",label:"Appeal Hearings"},{id:"AP_APPEAL_JUDGMENT",label:"Appeal Judgment"}]},ds=[{value:"EXPERT_OUR",label:"Expert fees on our behalf",type:"EXPENSE"},{value:"EXPERT_COURT",label:"Expert fees on behalf of the court",type:"EXPENSE"},{value:"INVESTIGATION",label:"Private Investigation fees",type:"EXPENSE"},{value:"SECONDARY_FEE",label:"Payment of secondary procedure fee",type:"EXPENSE"},{value:"COURT_FEES",label:"Court fees",type:"EXPENSE"},{value:"PHOTOCOPY",label:"Photocopying and binding of documents",type:"EXPENSE"},{value:"MEDICAL_RECORDS",label:"Medical Records Collection",type:"EXPENSE"},{value:"ATTORNEY_PHASE_1",label:"Attorney fees for phase 1",type:"EXPENSE"},{value:"ATTORNEY_PHASE_2",label:"Attorney fees for phase 2",type:"EXPENSE"},{value:"ATTORNEY_PHASE_3",label:"Attorney fees for phase 3",type:"EXPENSE"},{value:"ATTORNEY_PHASE_4",label:"Attorney fees for phase 4",type:"EXPENSE"},{value:"ATTORNEY_PHASE_5",label:"Attorney fees for phase 5",type:"EXPENSE"},{value:"ATTORNEY_EXTRA_HEARING",label:"Attorney fees for extra court hearing",type:"EXPENSE"},{value:"ATTORNEY_THIRD_PARTY",label:"Attorney fees for third party notice",type:"EXPENSE"},{value:"OTHER",label:"Other",type:"EXPENSE"},{value:"COMPENSATION_JUDGMENT",label:"Compensation by Judgment",type:"ADJUSTMENT"},{value:"COMPENSATION_SETTLEMENT",label:"Compensation under Settlement",type:"ADJUSTMENT"},{value:"DEDUCTIBLE",label:"Deductible paid by the insured",type:"ADJUSTMENT"},{value:"PAID_BY_INSURER",label:"Expenses already paid by the insurer",type:"ADJUSTMENT"}],$s=()=>({status:"DRAFT",rows:[],history:[],notes:[],favorites:[],totals:{totalExpenses:0,totalAdjustments:0,totalBalance:0}}),Tv=1e3*60*60*48,Wh=1e3*60*60*24*30,zh=7*24*60*60*1e3,$p={lineSlip:"UNIQUE MARKET REF",certificate:"CERTIFICATE REF"},ht={REPORTS:"lp_reports",USER:"lp_current_user",VIEW:"lp_view",CURRENT_REPORT:"lp_current_report",CASE_FOLDERS:"lp_case_folders",NOTIFICATIONS:"lp_notifications"},Rv="financial_expenses_store_v1",Hp=(e,t,s)=>{if(!(typeof window>"u"))try{const r=[...e];if(t){const i=r.findIndex(p=>p.id===t.id),u=i>=0?{...r[i],...t}:t;i>=0?r[i]=u:r.push(u)}const a={version:1,exportedAt:new Date().toISOString(),reports:r,caseFolders:s,notifications:(()=>{try{const i=localStorage.getItem(ht.NOTIFICATIONS);return i?JSON.parse(i):[]}catch{return[]}})(),financialStore:(()=>{try{const i=localStorage.getItem(Rv);return i?JSON.parse(i):{}}catch{return{}}})(),caseTemplates:(()=>{try{const i=localStorage.getItem("caseTemplates");return i?JSON.parse(i):[]}catch{return[]}})(),favoriteProviders:(()=>{try{const i=localStorage.getItem("favoriteProviders");return i?JSON.parse(i):{}}catch{return{}}})()},o=new Blob([JSON.stringify(a,null,2)],{type:"application/json"}),l=URL.createObjectURL(o),c=document.createElement("a");c.href=l,c.download=`report-crm-backup-${new Date().toISOString().slice(0,10)}.json`,c.click(),URL.revokeObjectURL(l)}catch(r){console.error("Backup download failed",r)}},Ja="Expenses breakdown",ea=e=>e?e===Ja?!0:/\bexpenses\b/i.test(e):!1,Cv=()=>{},Up=(e,t,s)=>{if(!e)return e;let r=!1;const a={...e};if(a.content&&t.forEach(o=>{var c;const l=(c=a.content)==null?void 0:c[o];l!==void 0&&(a.content={...a.content},!a.content[s]&&l&&(a.content[s]=l),delete a.content[o],r=!0)}),a.translatedContent&&t.forEach(o=>{var c;const l=(c=a.translatedContent)==null?void 0:c[o];l!==void 0&&(a.translatedContent={...a.translatedContent},!a.translatedContent[s]&&l&&(a.translatedContent[s]=l),delete a.translatedContent[o],r=!0)}),Array.isArray(a.selectedSections)&&a.selectedSections.some(l=>t.includes(l))){const l=a.selectedSections.map(c=>t.includes(c)?s:c);a.selectedSections=Array.from(new Set(l)),r=!0}return a.expertSummaryMode&&t.forEach(o=>{var c;const l=(c=a.expertSummaryMode)==null?void 0:c[o];l&&(a.expertSummaryMode={...a.expertSummaryMode,[s]:l},delete a.expertSummaryMode[o],r=!0)}),r?a:e},Dv=e=>{let t=Up(e,fh,Ks);return t=Up(t,xh,Co),t},Lv=e=>{const t={...e};return t.reportReview||(t.reportReview={status:"DRAFT",issues:[]}),t.hebrewWorkflowStatus||(t.hebrewWorkflowStatus="HEBREW_DRAFT"),Array.isArray(t.reportReview.issues)&&t.reportReview.issues.length>0&&(t.reportReview={...t.reportReview,issues:t.reportReview.issues.map(s=>{const r=s.origin??"INTERNAL";let a=s.externalAction;return r==="EXTERNAL"&&!a&&(a="ENGLISH_ONLY"),{...s,origin:r,externalAction:a}})}),t},_v=()=>{if(typeof window>"u")return[];try{Cv();const e=localStorage.getItem(ht.REPORTS);return(e?JSON.parse(e):[]).map(Dv).map(Lv)}catch(e){return console.error("Failed to load stored reports",e),[]}},Ov=()=>{if(typeof window>"u")return"DASHBOARD";const e=localStorage.getItem(ht.VIEW);return e&&(e==="STEP1"||e==="STEP2"||e==="PREVIEW"||e==="DASHBOARD"||e==="CASE_FOLDER")?e:"DASHBOARD"},ii=e=>{const t=e.filter(r=>r.type==="EXPENSE").reduce((r,a)=>r+(a.amount||0),0),s=e.filter(r=>r.type==="ADJUSTMENT").reduce((r,a)=>r+(a.amount||0),0);return{totalExpenses:t,totalAdjustments:s,totalBalance:t-s}},Wp=e=>{var t,s;if((t=e.expenseWorksheet)!=null&&t.totals)return e.expenseWorksheet.totals.totalBalance;if(e.expensesSum){const r=parseFloat(e.expensesSum.replace(/,/g,""));if(!isNaN(r))return r}return(s=e.expensesItems)!=null&&s.length?e.expensesItems.reduce((r,a)=>r+(a.amount||0),0):0},zp=e=>{var t,s,r;return(((s=(t=e.expenseWorksheet)==null?void 0:t.rows)==null?void 0:s.length)??0)>0||(((r=e.expensesItems)==null?void 0:r.length)??0)>0||!!(e.expensesSum&&e.expensesSum!=="0")},Ln=()=>Math.random().toString(36).slice(2,10),_r=e=>e==null?e:JSON.parse(JSON.stringify(e)),Vp=e=>new Promise((t,s)=>{const r=new FileReader;r.onloadend=()=>{const a=r.result,o=a.includes(",")?a.split(",")[1]:a;t(o)},r.onerror=()=>s(new Error("Failed to convert blob")),r.readAsDataURL(e)}),ci=e=>e?e.replace(/\r\n/g,`
`).replace(/\t/g," ").split(`
`).map(r=>r.replace(/\s+$/g,"").replace(/ {2,}/g," ")).join(`
`).trim().replace(/\n{3,}/g,`

`):"",Vh=e=>{if(!e)return e;let t=e;const s=[{pattern:/\bprosecutor\b/gi,replacement:"plaintiff"},{pattern:/\ba specialist\b/gi,replacement:"an expert"},{pattern:/\bthe specialist\b/gi,replacement:"the expert"},{pattern:/\bProf\.(?=\s|$)/gi,replacement:"prof"},{pattern:/\bNational Insurance Institute\b/gi,replacement:"NII"},{pattern:/\boperation\b/gi,replacement:"surgery"},{pattern:/\bdamage calculations\b/gi,replacement:"R & D Docs"},{pattern:/\bdemander\b/gi,replacement:"claimant"},{pattern:/\bapplicant\b/gi,replacement:"claimant"},{pattern:/\bbranch\b/gi,replacement:"clinic"},{pattern:/\bverdict\b/gi,replacement:"judgment"},{pattern:/\binterrogation\b/gi,replacement:"cross-examination"},{pattern:/\bDr\.(?=\s|$)/gi,replacement:"Dr"},{pattern:/\bversion\b/gi,replacement:"position"},{pattern:/\bpolicyholder\b/gi,replacement:"insured"}];for(const{pattern:r,replacement:a}of s)t=t.replace(r,a);return t=t.replace(/\bopinion\b/gi,(r,a,o)=>{const l=Math.max(0,a-20),c=o.slice(l,a).toLowerCase();return/\bexpert\s*$/.test(c)?r:"expert opinion"}),t},Fc=e=>{const t=e||{};return Object.keys(t).reduce((s,r)=>(s[r]=ci(t[r]),s),{})},Mv=e=>e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),Kh=e=>{if(!e)return{protectedText:e,map:{}};let t=e;const s={};let r=0;const a=(l,c)=>{t=t.replace(l,i=>{const u=`${c}_${++r}`;return s[u]||(s[u]=i),u})};a(/(?:|\$||)\s*\d[\d,]*(?:\.\d+)?/g,"MONEY"),a(/\b(?:USD|NIS|ILS|EUR|GBP)\s*\d[\d,]*(?:\.\d+)?\b/gi,"MONEY"),a(/\d[\d,]*(?:\.\d+)?\s*(?:NIS|ILS|USD|EUR|GBP)\b/gi,"MONEY"),a(/\d[\d,]*(?:\.\d+)?%/g,"PCT"),a(/\b\d{1,2}[\/\.]\d{1,2}[\/\.]\d{4}\b/g,"DATE");const o="(January|February|March|April|May|June|July|August|September|October|November|December|Jan|Feb|Mar|Apr|Jun|Jul|Aug|Sep|Oct|Nov|Dec)";return a(new RegExp(`\\b\\d{1,2}\\s+${o}\\s+\\d{4}\\b`,"g"),"DATE"),a(new RegExp(`\\b${o}\\s+\\d{1,2},\\s+\\d{4}\\b`,"g"),"DATE"),a(/\b(?:Policy\s+No\.?|Claim\s+#?|File|Case)\s+[A-Za-z0-9\/\-]+\b/gi,"ID"),a(/\b[A-Za-z0-9]{3,}[A-Za-z0-9\-\/]{3,}\b/g,"ID"),a(/\b\d{1,3}(?:,\d{3})*(?:\.\d+)?\b/g,"NUM"),{protectedText:t,map:s}},Yh=(e,t)=>{if(!e||!t||!Object.keys(t).length)return e;let s=e;for(const[r,a]of Object.entries(t)){const o=new RegExp(Mv(r),"g");s=s.replace(o,a)}return s},Pv=`
               . ,   ,          .

          , ,  ,            .

      -  ,     .

   ,     ,                .

      .
`.trim(),Fv=["The policy period is from [policyStartDate] to [policyEndDate].","","The retroactive date is [retroactiveDate].","","    _______________, ,   .","","      ,     ____________  ____________.","",",         ."].join(`
`),Gh=(e,t,s,r,a)=>{const o=Fv,l=P=>`${P}`,c=t||"",i=s||"",u=r||a||"",p=l(`The policy period is from ${c} to ${i}.`),y=l(`The retroactive date is ${u}.`),N=["    _______________, ,   .","","      ,     ____________  ____________.","",",         ."].join(`
`),w=P=>P.replace(/\[policyStartDate\]/gi,c).replace(/\[policyEndDate\]/gi,i).replace(/\[retroactiveDate\]/gi,u),R=`${p}

${y}

${N}`,E=o?w(o):"";if(!E&&!e)return R;let b=e&&e.trim().length?e:E||R;(/\[policyStartDate\]/i.test(b)||/\[policyEndDate\]/i.test(b)||/\[retroactiveDate\]/i.test(b))&&(b=w(b));const h=/The policy period is[^\n]*/i;h.test(b)?b=b.replace(h,p):(!e||!e.trim())&&(b=`${p}

${b}`);const S=/The retroactive date is[^\n]*/i;return S.test(b)?b=b.replace(S,y):(!e||!e.trim())&&(b=b.includes(p)?b.replace(p,`${p}

${y}`):`${y}

${b}`),b.includes("   ")||(b=`${b.trim()}

${N}`),b},Fd=(e,t)=>e.map(s=>{var l;const r=ds.find(c=>c.value===s.category),a=(r==null?void 0:r.type)||"EXPENSE",o=s.category==="OTHER"?((l=s.customLabel)==null?void 0:l.trim())||"Other expense":(r==null?void 0:r.label)||"Expense";return{id:s.id||Ln(),type:a,category:s.category,label:o,serviceProvider:a==="EXPENSE"?s.serviceProvider:void 0,amount:Number(s.amount)||0,locked:!1,createdBy:t==null?void 0:t.id,createdAt:new Date().toISOString(),updatedBy:t==null?void 0:t.id,updatedAt:new Date().toISOString()}}),Bv=e=>e.filter(t=>t.type==="EXPENSE").map(t=>({id:t.id,date:new Date().toISOString().split("T")[0],description:`${t.label}${t.serviceProvider?` (${t.serviceProvider})`:""}`,amount:t.amount,currency:"NIS"})),Kp=e=>/[\u0590-\u05FF]/.test(e||""),$v=({data:e,updateData:t,onNext:s,currentUser:r,timelineGallery:a,onAddTimelineImages:o,onRemoveTimelineImage:l,onSaveAndExit:c,readOnly:i})=>{var Ye,ot,X,ne;const[u,p]=g.useState(""),[y,N]=g.useState(!1),w=e.insurerName===""||up.includes(e.insurerName),[R,E]=g.useState(!w),[W,b]=g.useState(!1),[h,S]=g.useState(!1);g.useRef(null);const P=g.useRef(e.insuredName),U=g.useRef(e.plaintiffName);g.useEffect(()=>{P.current=e.insuredName},[e.insuredName]),g.useEffect(()=>{U.current=e.plaintiffName},[e.plaintiffName]);const[z,q]=g.useState(()=>({})),ee=C=>C?new Date(C).toISOString().split("T")[0]:new Date().toISOString().split("T")[0],G=C=>C.trim().replace(/\s+/g," "),se=C=>{const re=e,te="plaintiffName"in C?C.plaintiffName??re.plaintiffName:re.plaintiffName,pe="insuredName"in C?C.insuredName??re.insuredName:re.insuredName;if(!(!!te&&!!pe))return C;const je=G(te),Te=G(pe),et=`${je} v. ${Te}`,Ve="reportSubject"in C?C.reportSubject??re.reportSubject:re.reportSubject,He="isSubjectAuto"in C?C.isSubjectAuto??re.isSubjectAuto:re.isSubjectAuto;return!Ve||!Ve.trim()||He?{...C,reportSubject:et,isSubjectAuto:!0}:C},j=C=>{i||(C==="OTHER"?(E(!0),t(se({insurerName:""}))):(E(!1),t(se({insurerName:C}))))},F=()=>{if(!e.odakanitNo||!Se(e.odakanitNo)){alert("     (Odakanit)    .");return}s()},L=C=>{i||((e.expensesSheetId||e.expensesHtml)&&ea(C)&&(C=Ja),e.selectedSections.includes(C)||t({selectedSections:[...e.selectedSections,C]}),N(!1))},O=C=>{if(i||C==="Update")return;if(!!(e.expensesSheetId||e.expensesHtml)&&ea(C)){window.alert("           .");return}t({selectedSections:e.selectedSections.filter(te=>te!==C)})},H=()=>{i||u.trim()&&!e.selectedSections.includes(u)&&(t({selectedSections:[...e.selectedSections,u]}),p(""))},M=(C,re)=>{const te=re==="UP"?C-1:C+1;if(te<0||te>=e.selectedSections.length)return;const pe=[...e.selectedSections];[pe[C],pe[te]]=[pe[te],pe[C]],t({selectedSections:pe})},I=()=>{const C=e.proceduralTimeline;return C&&C.procedureType?C:{procedureType:"FIRST_INSTANCE",currentStageId:"FI_STATEMENT_OF_CLAIM",stages:[]}},D=typeof e.selectedTimeline=="string"?e.selectedTimeline.trim().length>0:!!e.selectedTimelineImage;g.useEffect(()=>{if(e.proceduralTimeline||D)return;const C=I();t({proceduralTimeline:C})},[e.proceduralTimeline,D]),g.useEffect(()=>{const C=e.proceduralTimeline;if(!C)return;const re=Oa[C.procedureType];if(!re||!re.length)return;const te=[];if(re.forEach(Be=>{var et;const je=((et=C.stages)==null?void 0:et.find(Ve=>Ve.id===Be.id))||void 0;(Be.isDynamic?!!(je!=null&&je.include):(je==null?void 0:je.include)!==!1)&&te.push(Be.id)}),!te.length||te.includes(C.currentStageId))return;const pe=te[0];pe&&pe!==C.currentStageId&&t({proceduralTimeline:{...C,currentStageId:pe}})},[e.proceduralTimeline,t]);const J=C=>{var je;const re=I(),pe=(je=Oa[C][0])==null?void 0:je.id,Be={...re,procedureType:C,currentStageId:pe||re.currentStageId,stages:re.stages.filter(Te=>Oa[re.procedureType].some(et=>et.id===Te.id)).map(Te=>({...Te}))};t({proceduralTimeline:Be}),q({})},ue=C=>{const te={...I(),currentStageId:C};t({proceduralTimeline:te})},ce=(C,re)=>{const te=I(),pe=Array.isArray(te.stages)?[...te.stages]:[],Be=pe.findIndex(et=>et.id===C);Be>=0?pe[Be]={...pe[Be],include:re}:pe.push({id:C,label:"",include:re,isDynamic:!0,monthYear:null});let je=te.currentStageId;if(!re&&C===te.currentStageId){const et=Oa[te.procedureType];if(et&&et.length){const Ve=[];if(et.forEach(He=>{const Q=pe.find(xe=>xe.id===He.id)||void 0;(He.isDynamic?!!(Q!=null&&Q.include):(Q==null?void 0:Q.include)!==!1)&&Ve.push(He.id)}),Ve.length){const He=et.findIndex(be=>be.id===C);let Q=null;if(He>0)for(let be=He-1;be>=0;be-=1){const xe=et[be].id;if(Ve.includes(xe)){Q=xe;break}}Q||(Q=Ve[0]),je=Q}}}const Te={...te,currentStageId:je,stages:pe};t({proceduralTimeline:Te})},le=(C,re,te)=>{q(Ve=>{const He={...Ve};return!!!re&&!!!te?delete He[C]:He[C]={month:re,year:te},He});const pe=I(),Be=Array.isArray(pe.stages)?[...pe.stages]:[],je=Be.findIndex(Ve=>Ve.id===C);let Te=null;if(re&&te){const Ve=re.padStart(2,"0");Te=`${te}-${Ve}`}je>=0?Be[je]={...Be[je],monthYear:Te}:Be.push({id:C,label:"",include:!0,isDynamic:!1,monthYear:Te});const et={...pe,stages:Be};t({proceduralTimeline:et})},fe=async C=>{var te;if(i){C.preventDefault();return}const re=(te=C.target.files)==null?void 0:te[0];if(re){b(!0);try{const pe=new FileReader;pe.onload=async()=>{var Ve;const Be=pe.result.split(",")[1],je=await X0(Be,re.type);let Te={};if(je.insuredName){const He={...Te,insuredName:je.insuredName},Q=e.isSubjectAuto!==!1;Te=se(Q?{...He,isSubjectAuto:!0}:He),Q&&(!e.reportSubject||!e.reportSubject.trim())&&(Te.reportSubject=je.insuredName,Te.isSubjectAuto=!0)}je.marketRef?(Te.marketRef=je.marketRef,Te.lineSlipNo=je.marketRef):je.lineSlipNo&&!Te.lineSlipNo&&(Te.lineSlipNo=je.lineSlipNo),je.certificateRef&&(Te.certificateRef=je.certificateRef),typeof je.policyPeriodStart=="string"&&(Te.policyPeriodStart=je.policyPeriodStart),typeof je.policyPeriodEnd=="string"&&(Te.policyPeriodEnd=je.policyPeriodEnd),typeof je.retroStart=="string"&&(Te.retroStart=je.retroStart),typeof je.retroEnd=="string"&&(Te.retroEnd=je.retroEnd),Te.policyFile={id:"policy-doc",name:re.name,data:Be,type:re.type};const et=Gh((Ve=e.content)==null?void 0:Ve["Insurance Coverage"],Te.policyPeriodStart||e.policyPeriodStart,Te.policyPeriodEnd||e.policyPeriodEnd,Te.retroStart||e.retroStart,Te.retroEnd||e.retroEnd);et&&(Te.content={...e.content,"Insurance Coverage":et}),t(Te),b(!1)},pe.readAsDataURL(re)}catch(pe){console.error("Error reading file",pe),b(!1)}}},Ee=10,ve=10,$e=async C=>{if(i){C.preventDefault(),C.target.value="";return}const re=C.target.files;if(!re||!re.length)return;const te=e.lawyerAppendixFiles??[];if(te.length>=Ee){alert(`You can attach up to ${Ee} appendices.`),C.target.value="";return}const pe=Ee-te.length,Be=Array.from(re).slice(0,pe),je=[];for(const Te of Be){if(Te.size/1048576>ve){alert(`${Te.name} is larger than ${ve}MB and will not be attached.`);continue}let Ve=Te.type;Ve||(/\.(tif|tiff)$/i.test(Te.name)?Ve="image/tiff":Ve="application/octet-stream");const He=new FileReader,Q=await new Promise((be,xe)=>{He.onload=()=>{const Fe=String(He.result||"").split(",");be(Fe[1]||"")},He.onerror=()=>xe(He.error),He.readAsDataURL(Te)});je.push({id:`lawyer-appx-${Date.now()}-${Math.random().toString(36).slice(2,8)}`,name:Te.name,data:Q,type:Ve})}je.length&&t({lawyerAppendixFiles:[...te,...je]}),C.target.value=""},Ze=C=>{if(i)return;const te=(e.lawyerAppendixFiles??[]).filter(pe=>pe.id!==C);t({lawyerAppendixFiles:te})},Oe=(C,re,te,pe)=>n.jsxs("div",{className:"relative group",children:[n.jsx("input",{className:"w-full border border-borderDark p-2 rounded focus:ring-2 focus:ring-lpBlue outline-none pr-8",placeholder:te,value:C,onChange:i?void 0:Be=>re(Be.target.value),onBlur:i?void 0:pe?()=>pe(C):void 0,disabled:i}),C&&n.jsx("button",{type:"button",onClick:i?void 0:()=>re(""),className:`absolute right-2 top-1/2 -translate-y-1/2 text-gray-300 transition-colors ${i?"cursor-not-allowed opacity-50":"hover:text-red-500"}`,disabled:i,children:n.jsx(Ws,{className:"w-4 h-4"})})]});return n.jsxs("div",{className:"space-y-8",children:[n.jsx("div",{className:"flex justify-end",children:n.jsxs("button",{type:"button",onClick:i?void 0:c,disabled:i,className:`flex items-center text-sm bg-blue-50 px-3 py-1.5 rounded-full ${i?"text-gray-400 cursor-not-allowed":"text-lpBlue hover:text-blue-900"}`,title:i?"  .":void 0,children:[n.jsx(_u,{className:"w-4 h-4 mr-1"}),"  "]})}),n.jsx("h2",{className:"text-3xl font-bold text-lpBlue font-serif border-b pb-2",children:"1. Case Setup & Structure"}),e.odakanitNo&&n.jsx("div",{className:"bg-indigo-50 border-l-4 border-indigo-600 p-4 mb-6",children:n.jsx("div",{className:"flex justify-between items-center",children:n.jsxs("div",{children:[n.jsxs("h3",{className:"font-bold text-indigo-900 flex items-center",children:[n.jsx(ch,{className:"w-5 h-5 mr-2"})," Odakanit Case #",e.odakanitNo]}),n.jsx("p",{className:"text-sm text-indigo-700",children:"This report folder was initiated by Finance."})]})})}),n.jsxs("div",{className:"bg-panel p-6 rounded-lg shadow-sm border border-borderDark relative overflow-hidden",children:[n.jsx("div",{className:"absolute top-0 left-0 w-1 h-full bg-lpGold"}),n.jsxs("h3",{className:"font-bold text-lg mb-4 text-textLight flex items-center",children:[n.jsx(yo,{className:"w-5 h-5 mr-2 text-lpGold"}),"Re: Case Details (Mandatory Fields - English)"]}),n.jsx("div",{className:"mb-6 bg-blue-50 border-2 border-dashed border-blue-200 rounded-lg p-4 text-center relative group",children:W?n.jsxs("div",{className:"flex flex-col items-center justify-center py-2",children:[n.jsx(Bt,{className:"w-8 h-8 text-lpBlue animate-spin mb-2"}),n.jsx("span",{className:"text-sm font-bold text-lpBlue",children:"Analyzing Policy Document..."})]}):n.jsx(n.Fragment,{children:e.policyFile?n.jsxs("div",{className:"flex flex-col items-center justify-center gap-3",children:[n.jsxs("div",{className:"flex items-center justify-center gap-3",children:[n.jsxs("div",{className:"flex flex-col items-center text-green-700 font-bold text-center",children:[n.jsxs("div",{className:"flex items-center",children:[n.jsx(ih,{className:"w-6 h-6 mr-2"}),"Policy Document Attached"]}),n.jsxs("span",{className:"text-xs font-normal text-green-800",children:["Original file: ",e.policyFile.name]})]}),n.jsx("button",{className:"text-xs text-red-500 hover:underline disabled:text-gray-400 disabled:cursor-not-allowed",onClick:i?void 0:()=>t({policyFile:void 0}),disabled:i,children:"Remove"})]}),n.jsxs("div",{className:"flex items-center justify-center gap-2 text-xs text-textLight bg-panel/70 px-3 py-1 rounded-full border border-borderDark",children:[n.jsx("input",{id:"attach-policy-appendix",type:"checkbox",className:"h-3 w-3 accent-lpBlue",checked:e.attachPolicyAsAppendix??!0,onChange:i?void 0:C=>t({attachPolicyAsAppendix:C.target.checked}),disabled:i}),n.jsx("label",{htmlFor:"attach-policy-appendix",className:"cursor-pointer",children:"Attach policy as Appendix A to final PDF"})]})]}):n.jsxs(n.Fragment,{children:[n.jsxs("div",{className:`flex flex-col items-center justify-center text-center px-4 ${i?"cursor-not-allowed opacity-60":"cursor-pointer"}`,children:[n.jsx(bo,{className:"w-8 h-8 text-lpBlue mb-2 group-hover:scale-110 transition-transform"}),n.jsx("span",{className:"text-sm font-bold text-textLight",children:"Upload Policy Document"}),n.jsx("span",{className:"text-xs text-textMuted mt-1",children:"Any file uploaded here (PDF/DOCX/scan) is treated as the official policy for this case."})]}),n.jsx("input",{type:"file",className:"absolute inset-0 opacity-0 cursor-pointer",accept:"application/pdf,application/vnd.openxmlformats-officedocument.wordprocessingml.document,text/plain,image/*",onChange:fe,disabled:i})]})})}),n.jsxs("div",{className:"mb-6 mt-4 bg-slate-50 border border-dashed border-borderDark rounded-lg p-4",children:[n.jsxs("h4",{className:"text-sm font-semibold text-textLight mb-2 flex items-center justify-between",children:[n.jsx("span",{children:"Additional Appendices (Lawyer)"}),n.jsxs("span",{className:"text-[11px] text-textMuted",children:[((Ye=e.lawyerAppendixFiles)==null?void 0:Ye.length)||0,"/",Ee]})]}),n.jsx("div",{className:"flex flex-col md:flex-row gap-3 md:items-center",children:n.jsx("div",{className:"flex-1",children:n.jsxs("label",{htmlFor:"lawyer-appendix-input",className:`flex flex-col items-center justify-center px-3 py-3 border-2 border-dashed border-borderDark rounded-lg text-xs text-textMuted bg-panel transition-colors ${i?"cursor-not-allowed opacity-60":"cursor-pointer hover:border-lpBlue hover:text-lpBlue"}`,children:[n.jsx(bo,{className:"w-5 h-5 mb-1"}),n.jsx("span",{className:"font-semibold",children:"Upload / drag legal appendices"}),n.jsxs("span",{className:"mt-1 text-[11px] text-textMuted",children:["Supported: PDF, PNG, JPG, TIFF (up to ",ve,"MB per file)"]}),n.jsx("input",{id:"lawyer-appendix-input",type:"file",multiple:!0,className:"hidden",accept:"application/pdf,image/png,image/jpeg,image/jpg,image/tiff,image/x-tiff",onChange:$e,disabled:i})]})})}),(((ot=e.lawyerAppendixFiles)==null?void 0:ot.length)||0)>0&&n.jsx("div",{className:"mt-3 border-t border-borderDark pt-2 space-y-1 max-h-40 overflow-y-auto text-xs text-textLight text-left",children:(X=e.lawyerAppendixFiles)==null?void 0:X.map(C=>n.jsxs("div",{className:"flex items-center justify-between gap-2 rounded bg-panel px-2 py-1 border border-borderDark",children:[n.jsxs("div",{className:"flex-1 min-w-0",children:[n.jsx("div",{className:"truncate font-medium",children:C.name}),n.jsx("div",{className:"text-[11px] text-textMuted truncate",children:C.type||"Unknown type"})]}),n.jsx("button",{type:"button",onClick:i?void 0:()=>Ze(C.id),className:"text-[11px] text-red-500 hover:text-red-700 disabled:text-gray-400 disabled:cursor-not-allowed",disabled:i,children:"Remove"})]},C.id))})]}),n.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-5",children:[n.jsxs("div",{className:"space-y-1",children:[n.jsxs("label",{className:"text-xs font-bold text-textMuted uppercase flex items-center",children:[n.jsx(C0,{className:"w-3 h-3 mr-1"})," Report Date"]}),n.jsx("input",{type:"date",className:"w-full border border-borderDark p-2 rounded disabled:bg-navySecondary disabled:text-textMuted",value:ee(e.reportDate),onChange:i?void 0:C=>t({reportDate:new Date(C.target.value).toISOString()}),disabled:i})]}),n.jsxs("div",{className:"space-y-1",children:[n.jsx("label",{className:"text-xs font-bold text-textMuted uppercase",children:"RE (Subject)"}),n.jsx("input",{type:"text",className:"w-full border border-borderDark p-2 rounded text-sm disabled:bg-navySecondary disabled:text-textMuted",placeholder:"e.g. John Doe v. XYZ Medical Center  Claim Update",value:e.reportSubject||"",onChange:i?void 0:C=>t({reportSubject:C.target.value,isSubjectAuto:!1}),disabled:i})]}),n.jsxs("div",{className:"space-y-1",children:[n.jsx("label",{className:"text-xs font-bold text-textMuted uppercase",children:"Odakanit Case Number (Internal File)"}),Oe(e.odakanitNo||"",C=>t({odakanitNo:C}),"e.g., 1/123")]}),n.jsxs("div",{className:"space-y-1",children:[n.jsx("label",{className:"text-xs font-bold text-textMuted uppercase",children:"Insurer Name"}),n.jsxs("select",{className:"w-full border border-borderDark p-2 rounded disabled:bg-navySecondary disabled:text-textMuted",value:R?"OTHER":e.insurerName,onChange:i?void 0:C=>j(C.target.value),disabled:i,children:[n.jsx("option",{value:"",disabled:!0,children:"-- Select Insurer --"}),up.map(C=>n.jsx("option",{value:C,children:C},C)),n.jsx("option",{value:"OTHER",children:"Other (Enter Manually)"})]}),R&&n.jsx("div",{className:"mt-2 animate-fade-in",children:Oe(e.insurerName,C=>t({insurerName:C}),"Type custom insurer name...")})]}),n.jsxs("div",{className:"space-y-1",children:[n.jsx("label",{className:"text-xs font-bold text-textMuted uppercase",children:$p.lineSlip}),Oe(e.lineSlipNo,C=>t({lineSlipNo:C,marketRef:C}),"e.g., B0180PD2391439")]}),n.jsxs("div",{className:"space-y-1",children:[n.jsx("label",{className:"text-xs font-bold text-textMuted uppercase",children:$p.certificate}),Oe(e.certificateRef||"",C=>t({certificateRef:C}),"e.g., 516902624")]}),n.jsxs("div",{className:"space-y-1",children:[n.jsx("label",{className:"text-xs font-bold text-textMuted uppercase",children:"Insured Name"}),Oe(e.insuredName,C=>t(se({insuredName:C})),"e.g., Dr. Cohen",C=>{const re=(C||"").trim();!re||!Kp(re)||Dd(re).then(te=>{!te||te.trim()===""||te==="Error translation."||P.current===re&&t(se({insuredName:te.trim()}))}).catch(()=>{})})]}),n.jsxs("div",{className:"space-y-1 md:col-span-2",children:[n.jsxs("div",{className:"flex justify-between items-end mb-1",children:[n.jsx("label",{className:"text-xs font-bold text-textMuted uppercase",children:"Party Name"}),n.jsxs("div",{className:"flex bg-navySecondary rounded p-0.5 text-xs",children:[n.jsx("button",{className:`px-3 py-1 rounded-sm transition-all ${e.plaintiffTitle==="Plaintiff"?"bg-panel shadow text-lpBlue font-bold":"text-textMuted"}`,onClick:()=>t({plaintiffTitle:"Plaintiff"}),children:"Plaintiff"}),n.jsx("button",{className:`px-3 py-1 rounded-sm transition-all ${e.plaintiffTitle==="Claimant"?"bg-panel shadow text-lpBlue font-bold":"text-textMuted"}`,onClick:()=>t({plaintiffTitle:"Claimant"}),children:"Claimant"})]})]}),Oe(e.plaintiffName,C=>t(se({plaintiffName:C})),"e.g., Mr. Levi",C=>{const re=(C||"").trim();!re||!Kp(re)||Dd(re).then(te=>{!te||te.trim()===""||te==="Error translation."||U.current===re&&t(se({plaintiffName:te.trim()}))}).catch(()=>{})})]})]})]}),n.jsxs("div",{className:"bg-panel p-6 rounded-lg shadow-sm border border-borderDark",children:[n.jsx("div",{className:"flex justify-between items-center mb-4",children:n.jsxs("div",{children:[n.jsxs("h3",{className:"font-bold text-lg text-textLight flex items-center",children:[n.jsx(dh,{className:"w-5 h-5 mr-2 text-lpBlue"}),"Procedural Timeline"]}),n.jsx("p",{className:"text-sm text-textMuted",children:'   ,    Month/Year    ".'})]})}),n.jsxs("div",{className:"mb-4",children:[n.jsx("label",{className:"block text-xs font-semibold text-textMuted mb-1",children:"Procedure Type"}),n.jsx("select",{className:"border border-borderDark rounded px-3 py-1 text-sm",value:((ne=e.proceduralTimeline)==null?void 0:ne.procedureType)||"FIRST_INSTANCE",onChange:C=>J(C.target.value),children:Iv.map(C=>n.jsx("option",{value:C.value,children:C.label},C.value))})]}),!e.proceduralTimeline&&D&&n.jsxs("div",{className:"border border-dashed border-borderDark rounded-md p-3 bg-navySecondary text-xs text-textLight",children:[n.jsx("p",{className:"mb-2",children:"This report uses the legacy timeline. You can enable the new Procedural Timeline (recommended for new reports)."}),n.jsx("button",{type:"button",className:"inline-flex items-center px-3 py-1 rounded-full bg-navy text-gold text-[11px] font-semibold hover:bg-navySecondary",onClick:()=>t({proceduralTimeline:I()}),children:"Enable Procedural Timeline"})]}),e.proceduralTimeline&&n.jsx("div",{className:"space-y-3",children:Oa[e.proceduralTimeline.procedureType].map(C=>{var He,Q,be;const re=((Q=(He=e.proceduralTimeline)==null?void 0:He.stages)==null?void 0:Q.find(xe=>xe.id===C.id))||void 0,te=z[C.id],pe=!!C.isDynamic,Be=pe?!!(re!=null&&re.include):!0,je=(re==null?void 0:re.monthYear)||"";let Te="",et="";if(te)Te=te.month||"",et=te.year||"";else if(typeof je=="string"&&je.includes("-")){const[xe,Ne]=je.split("-");xe&&Ne&&(et=xe,Te=Ne)}const Ve=((be=e.proceduralTimeline)==null?void 0:be.currentStageId)===C.id;return n.jsxs("div",{className:"flex items-start justify-between border border-borderDark rounded-lg px-3 py-2 bg-panel",children:[n.jsxs("div",{className:"flex items-start gap-3",children:[n.jsx("input",{type:"radio",name:"currentStage",className:"mt-1",checked:Ve,disabled:!Be,onChange:()=>Be&&ue(C.id)}),n.jsxs("div",{children:[n.jsxs("div",{className:"font-semibold text-sm text-textLight flex items-center gap-2",children:[n.jsx("span",{children:C.label}),pe&&n.jsx("span",{className:"text-[10px] px-2 py-0.5 rounded-full bg-navySecondary text-textMuted",children:"Dynamic"})]}),n.jsxs("div",{className:"mt-1 flex items-center gap-2 text-xs text-textMuted flex-wrap",children:[n.jsx("span",{children:"Month / Year:"}),n.jsxs("select",{className:"border border-borderDark rounded px-2 py-0.5 text-xs",value:Te,disabled:!Be,onChange:xe=>le(C.id,xe.target.value,et),children:[n.jsx("option",{value:"",children:""}),n.jsx("option",{value:"01",children:"January"}),n.jsx("option",{value:"02",children:"February"}),n.jsx("option",{value:"03",children:"March"}),n.jsx("option",{value:"04",children:"April"}),n.jsx("option",{value:"05",children:"May"}),n.jsx("option",{value:"06",children:"June"}),n.jsx("option",{value:"07",children:"July"}),n.jsx("option",{value:"08",children:"August"}),n.jsx("option",{value:"09",children:"September"}),n.jsx("option",{value:"10",children:"October"}),n.jsx("option",{value:"11",children:"November"}),n.jsx("option",{value:"12",children:"December"})]}),n.jsx("input",{type:"number",className:"w-20 border border-borderDark rounded px-2 py-0.5 text-xs",placeholder:"Year",value:et,disabled:!Be,onChange:xe=>le(C.id,Te,xe.target.value),min:1900,max:2100})]})]})]}),pe&&n.jsxs("div",{className:"flex items-center gap-1 text-xs text-textMuted",children:[n.jsx("span",{children:"Include"}),n.jsx("input",{type:"checkbox",checked:Be,onChange:xe=>ce(C.id,xe.target.checked)})]})]},C.id)})})]}),n.jsxs("div",{className:"bg-panel p-6 rounded-lg shadow-sm border border-borderDark",children:[n.jsxs("h3",{className:"font-bold text-lg mb-4 text-textLight flex items-center",children:[n.jsx(B0,{className:"w-5 h-5 mr-2 text-green-600"}),"Current Report Sections"]}),n.jsx("div",{className:"space-y-2 mb-6",children:e.selectedSections.map((C,re)=>{const te=re>0,pe=re<e.selectedSections.length-1,je=!!(e.expensesSheetId||e.expensesHtml)&&ea(C),Te=C==="Update"||je;return n.jsxs("div",{className:"flex items-center justify-between p-3 bg-panel border border-borderDark rounded shadow-sm",children:[n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsx("span",{className:"w-6 h-6 rounded-full bg-navySecondary text-textMuted flex items-center justify-center text-xs font-bold",children:re+1}),n.jsx("span",{className:"font-medium text-textLight",children:C}),C==="Update"&&n.jsx("span",{className:"text-xs bg-blue-100 text-blue-800 px-2 py-0.5 rounded",children:"Fixed"}),je&&n.jsx("span",{className:"text-xs bg-amber-100 text-amber-800 px-2 py-0.5 rounded",children:"   "})]}),n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsxs("div",{className:"flex flex-col gap-1",children:[n.jsx("button",{onClick:()=>M(re,"UP"),disabled:!te,className:`p-1 rounded border ${te?"text-textMuted hover:bg-navySecondary":"text-gray-300 cursor-not-allowed"}`,title:" ",children:n.jsx(L0,{className:"w-4 h-4"})}),n.jsx("button",{onClick:()=>M(re,"DOWN"),disabled:!pe,className:`p-1 rounded border ${pe?"text-textMuted hover:bg-navySecondary":"text-gray-300 cursor-not-allowed"}`,title:" ",children:n.jsx(D0,{className:"w-4 h-4"})})]}),!Te&&n.jsx("button",{onClick:()=>O(C),className:"p-2 rounded-md text-textMuted hover:text-red-400 hover:bg-red-500/10 border border-transparent hover:border-red-400/40 transition",title:" ",children:n.jsx(Ht,{className:"w-4 h-4"})})]})]},`${C}-${re}`)})}),y?n.jsxs("div",{className:"bg-navySecondary p-4 rounded border animate-fade-in",children:[n.jsxs("div",{className:"flex gap-2",children:[n.jsxs("select",{className:"flex-1 border p-2 rounded",onChange:C=>L(C.target.value),defaultValue:"",children:[n.jsx("option",{value:"",disabled:!0,children:"-- Select a Header --"}),Or.filter(C=>!e.selectedSections.includes(C)).map(C=>n.jsx("option",{value:C,children:C},C))]}),n.jsx("button",{onClick:()=>N(!1),className:"px-4 py-2 bg-borderDark text-textMuted rounded hover:bg-borderDark",children:"Cancel"})]}),n.jsx("div",{className:"mt-4 pt-4 border-t border-borderDark",children:n.jsxs("div",{className:"flex gap-2",children:[n.jsx("input",{className:"flex-1 border p-2 rounded",placeholder:"Type custom header name...",value:u,onChange:C=>p(C.target.value)}),n.jsx("button",{onClick:()=>{H(),N(!1)},className:"px-4 py-2 bg-purple-600 text-white rounded hover:bg-purple-700",children:"Add Custom"})]})})]}):n.jsxs("button",{onClick:()=>N(!0),className:"w-full py-2 border-2 border-dashed border-borderDark text-textMuted rounded hover:border-green-500 hover:text-green-600 transition flex items-center justify-center font-medium",children:[n.jsx(Mu,{className:"w-4 h-4 mr-2"})," Add Report Section"]})]}),n.jsxs("div",{className:"flex flex-wrap justify-between gap-2",children:[n.jsxs("button",{onClick:c,className:"flex items-center text-textMuted px-4 py-2 border rounded hover:bg-navySecondary transition",children:[n.jsx(ei,{className:"mr-2 w-4 h-4"})," Back to Dashboard"]}),n.jsxs("button",{onClick:F,className:"flex items-center bg-navy text-gold px-6 py-2 rounded hover:bg-navySecondary transition shadow-md",children:["Next Step ",n.jsx(is,{className:"ml-2 w-4 h-4"})]})]})]})},Yp=e=>{if(!e)return null;try{const t=JSON.stringify(e);let s=0;for(let r=0;r<t.length;r+=1){const a=t.charCodeAt(r);s=(s<<5)-s+a,s|=0}return String(s)}catch{return null}},Hv=({data:e,updateData:t,onBack:s,onNext:r,currentUser:a,onSaveAndExit:o,onSaveDraft:l,onTranslate:c,onImproveEnglish:i,onFormatContent:u,onSubmitHebrewForReview:p,onApproveHebrewForTranslation:y,onAddReviewIssues:N,onMarkReviewIssueDone:w,onAddExternalFeedbackIssues:R,onReopenHebrewDueToExternalFeedback:E,step1Focus:W,onStep1FocusConsumed:b,isTranslating:h,isImprovingEnglish:S,onOpenAssistant:P,onActiveSectionChange:U,readOnly:z})=>{var Wo;const q=Ks,ee=Co,[G,se]=g.useState(null),[j,F]=g.useState(!1),[L,O]=g.useState(null),[H,M]=g.useState([]),[I,D]=g.useState(""),[J,ue]=g.useState(!1),[ce,le]=g.useState(()=>Or[0]||"Update"),[fe,Ee]=g.useState([]),[ve,$e]=g.useState(!1),[Ze,Oe]=g.useState(null),[Ye,ot]=g.useState(null),[X,ne]=g.useState(null),[C,re]=g.useState([]),[te,pe]=g.useState(!1),[Be,je]=g.useState(null),[Te,et]=g.useState("SAFE_POLISH"),[Ve,He]=g.useState(null),[Q,be]=g.useState([]),[xe,Ne]=g.useState("TEMPLATES"),[Fe,Le]=g.useState(""),[Ke,dt]=g.useState(!1),[Ue,st]=g.useState(()=>Or[0]||"Update"),[Rt,yt]=g.useState(null),[V,ie]=g.useState(()=>Eo(a.id)),[_e,Me]=g.useState(""),[he,Ce]=g.useState(!1),[ae,Re]=g.useState(null),[rt,Zt]=g.useState("DUAL"),[Ge,ft]=g.useState(null),[Yt,en]=g.useState(null),[Ds,fs]=g.useState(null),[Cn,or]=g.useState(null),[es,Un]=g.useState(null),xs=g.useRef(null),Wn=g.useRef(null),A=g.useRef({}),[ge,Pe]=g.useState({date:new Date().toISOString().split("T")[0],description:"",amount:0,currency:"NIS"}),Ie=a.role==="FINANCE"||a.role==="SUB_ADMIN"&&!0,mt=e.selectedSections.some(f=>f.toLowerCase().includes("expenses")),lt=a.role==="LAWYER"&&e.requiresExpenses===!0&&mt,tn=a.role==="ADMIN"&&e.isTranslated,Ls=a.role==="LAWYER"||a.role==="ADMIN",nn=a.role==="FINANCE"||a.role==="SUB_ADMIN"||a.role==="ADMIN",Lt=((Wo=e.reportReview)==null?void 0:Wo.status)==="APPROVED"||e.hebrewWorkflowStatus==="HEBREW_APPROVED",Do=e.translatedContent||{},ga=Object.keys(Do).some(f=>{if(f.toLowerCase().includes("expenses"))return!1;const T=Do[f];return typeof T=="string"&&T.trim().length>0});g.useEffect(()=>{ie(Eo(a.id))},[a.id]);const kr=async f=>{var K,Z;if(z||!tn||!e.isTranslated||f.toLowerCase().includes("expenses"))return;const T=((K=e.translatedContent)==null?void 0:K[f])||"";if(T.trim()){Un(f);try{const{protectedText:de,map:d}=Kh(T),m=await gh(de),x=Yh(m||de,d),k=Vh(x),v={...e.translatedContent||{},[f]:ci(k)};t({translatedContent:v}),typeof l=="function"&&l()}catch(de){console.error("Improve English (single section) failed",de);const d=Ld(f,(Z=e.expertSummaryMode)==null?void 0:Z[f]);window.alert(`   "${d}" .      .`)}finally{Un(de=>de===f?null:de)}}},Ai=f=>typeof f.reportNumber=="number"&&f.reportNumber===1,Ii=f=>gp(f)?"EXPERT":f===ee?"DEMAND":"CLAIM";g.useEffect(()=>{if(!W)return;const f=()=>{let T=null;W==="EXTERNAL_FEEDBACK"?T=_d:W==="REVIEW"&&(T=Il);let K=null;if(T&&(K=document.getElementById(T)),K||(K=document.getElementById(Il)),K)try{K.scrollIntoView({behavior:"smooth",block:"start"})}catch{}b&&b()};typeof window<"u"?window.requestAnimationFrame(()=>{const T=W==="EXTERNAL_FEEDBACK"&&document.getElementById(_d)||document.getElementById(Il);if(T){try{T.scrollIntoView({behavior:"smooth",block:"start"})}catch{}b&&b()}else setTimeout(f,0)}):f()},[W,b]);const Ti=()=>{if(z||!nn||!ge.description||!ge.amount)return;const f={id:Date.now().toString(),date:ge.date||"",description:ge.description,amount:Number(ge.amount),currency:ge.currency||"NIS"},T=[...e.expensesItems,f],K=T.reduce((Z,de)=>Z+de.amount,0);t({expensesItems:T,expensesSum:K.toLocaleString()}),Pe({date:new Date().toISOString().split("T")[0],description:"",amount:0,currency:"NIS"})},Ri=f=>{if(z)return;const T=e.expensesItems.filter(Z=>Z.id!==f),K=T.reduce((Z,de)=>Z+de.amount,0);t({expensesItems:T,expensesSum:K.toLocaleString()})},Gt=async f=>{if(z)return;const T=f.target.files;if(!T)return;const K=e.invoiceFiles.length;if(K>=4){O({msg:"   4   (PDF  Word).",type:"info"}),f.target.value="";return}const Z=Array.from(T).slice(0,4-K),de=[];for(let v=0;v<Z.length;v++){const _=Z[v],$=new FileReader;await new Promise(B=>{$.onload=Y=>{var oe;de.push({id:`inv-${Date.now()}-${v}`,name:_.name,data:((oe=Y.target)==null?void 0:oe.result).split(",")[1],type:_.type}),B()},$.readAsDataURL(_)})}const d=[...e.invoiceFiles,...de],m=d.length>0,k=nn&&e.status==="WAITING_FOR_INVOICES"&&m?"TASK_ASSIGNED":e.status;t({invoiceFiles:d,isWaitingForInvoices:!m,status:k}),O({msg:"   ( 4 ).",type:"success"})},mn=f=>{const T=e.invoiceFiles.filter(d=>d.id!==f),K=T.length>0,de=nn&&!K&&e.status==="TASK_ASSIGNED"?"WAITING_FOR_INVOICES":e.status;t({invoiceFiles:T,isWaitingForInvoices:!K,status:de})},sn=(f,T)=>{Ie||t({content:{...e.content,[f]:T}})},Ci=f=>f.replace(/{plaintiff}/g,e.plaintiffName||"").replace(/{insured}/g,e.insuredName||"").replace(/\[DATE\]/g,new Date().toLocaleDateString("he-IL"));g.useEffect(()=>{let f=!1;return(async()=>{try{const K=await mp();f||M(K)}catch(K){console.error("Failed to load templates",K)}try{const K=await ob();f||be(K)}catch(K){console.error("Failed to load best practices",K)}})(),()=>{f=!0}},[]);const Di=(f,T)=>{tn&&t({translatedContent:{...e.translatedContent,[f]:T}})},Ar=f=>H.filter(T=>T.sectionKey===f&&T.isEnabled!==!1).sort((T,K)=>(T.orderIndex||0)-(K.orderIndex||0)||T.createdAt.localeCompare(K.createdAt)),hs=(f,T)=>{if(Ie)return;let K=T.body.replace(/{plaintiff}/g,e.plaintiffName||"the claimant").replace(/{insured}/g,e.insuredName||"the insured").replace(/\[DATE\]/g,new Date().toLocaleDateString("he-IL"));const Z=e.content[f]||"";sn(f,Z?`${Z}

${K}`:K),se(null)},Li=async f=>{try{const T=await mp();M(T)}catch(T){console.error("Failed to refresh templates",T)}D(""),Le(""),se(T=>T===f?null:f)},_i=async f=>{if(a.role!=="ADMIN")return;const T=A.current[f],K=T==null?void 0:T.current;if(!K){O({msg:"     .",type:"error"});return}const Z=K.selectionStart??0,de=K.selectionEnd??0;if(Z===de){O({msg:"     .",type:"info"});return}let m=(e.content[f]||"").slice(Z,de).trim();if(!m){O({msg:"    .",type:"info"});return}if(m.length<15&&!window.confirm("   .    ?"))return;const x=m.split(/\s+/).slice(0,6).join(" "),v=(window.prompt(" :",x)||"").trim();if(!v){O({msg:"   ( ).",type:"info"});return}const _=new Date().toISOString(),$={id:"",sectionKey:f,title:v,body:m,createdByUserId:a.id,createdAt:_,updatedAt:_,isEnabled:!0};try{const B=await pp($,a.role);M(B),O({msg:"  .",type:"success"})}catch(B){console.error("Failed to save template",B),O({msg:"  .",type:"error"})}},Ir=async(f,T)=>{if(a.role!=="ADMIN")return;const K=H.find(de=>de.id===f);if(!K)return;const Z={...K,...T,updatedAt:new Date().toISOString()};try{const de=await pp(Z,a.role);M(de)}catch(de){console.error("Failed to update template",de),O({msg:"  .",type:"error"})}},ya=async f=>{if(a.role==="ADMIN")try{const T=await G0(f,a.role);M(T)}catch(T){console.error("Failed to delete template",T),O({msg:"  .",type:"error"})}},ba=async(f,T)=>{if(a.role==="ADMIN")try{const K=await q0(f,T,a.role);M(K)}catch(K){console.error("Failed to reorder template",K),O({msg:"   .",type:"error"})}},Lo=(f,T)=>{if(!f||!T||f===T)return"  ";const K=f.split(/\s+/).filter(Boolean),Z=T.split(/\s+/).filter(Boolean);if(!K.length||!Z.length)return"  ";const de=Math.max(K.length,Z.length)||1;let d=0;const m=Math.min(K.length,Z.length);for(let k=0;k<m;k+=1)K[k]!==Z[k]&&(d+=1);d+=Math.abs(K.length-Z.length);const x=d/de;return x<.05?"  ":x<.15?" ":x<.35?" ":" "},Oi=async f=>{if(Ie)return;const T=e.content[f];if(T){fs(f),F(!0);try{const K=await J0(T,Te);if(K.factProtectionBlocked){O({msg:"    ( ).    .",type:"info"});return}const Z=K.text,de=Lo(T,Z),d=dv(T,Z),m=d.filter(x=>x.type==="add"||x.type==="remove").length;if(m>0){const x=Date.now()+2e4;He({sectionKey:f,tokens:d,changedWords:m,expiresAt:x,open:!1}),setTimeout(()=>{He(k=>k&&k.sectionKey===f&&k.expiresAt===x?null:k)},2e4)}else He(null);O({msg:`  (${Te==="SAFE_POLISH"?"SAFE_POLISH":"REWRITE"}): ${de}`,type:"success"}),sn(f,Z)}catch(K){console.error("Refine text failed",K),O({msg:"  .   .",type:"error"})}finally{F(!1),fs(null)}}},Mi=async(f,T,K)=>{var Z;F(!0);try{const de=await tb(T,K);if((Z=de.items)!=null&&Z.length){const d=[...e.expensesItems,...de.items],m=d.reduce((x,k)=>x+(k.amount||0),0);t({expensesItems:d,expensesSum:m.toLocaleString()}),O({msg:`  "${f}"  .`,type:"success"})}else O({msg:"    .",type:"info"})}catch(de){console.error("Expenses extraction failed",de),O({msg:" .   PDF/Word .",type:"error"})}finally{F(!1)}},Pi=f=>new Promise((T,K)=>{const Z=new FileReader;Z.onload=()=>T(Z.result.split(",")[1]),Z.onerror=()=>K(new Error("Failed to read file")),Z.readAsDataURL(f)}),_o=f=>{var k,v,_,$,B,Y,oe,we;if(!f)return;const T=[...e.selectedSections],K=ye=>{T.includes(ye)||T.push(ye)},Z=ye=>ye&&ye.length?ye.map(ze=>` ${ze}`).join(`
`):"",de=(k=f.timeline)!=null&&k.length?f.timeline.map(ye=>` ${(ye==null?void 0:ye.date)||"  "}  ${(ye==null?void 0:ye.event)||""}`).join(`
`):"",d={...e.content};if(f.briefSummary||de||(v=f.injuries)!=null&&v.length){K("Update");const ye=Z(f.injuries),ze=Z(f.requestedRelief),Je=[f.briefSummary||"",ye?`
 :
${ye}`:"",ze?`
 :
${ze}`:"",de?`
 :
${de}`:""].filter(Boolean);d.Update=Je.join(`
`).trim()}if((_=f.facts)!=null&&_.length){const ye=Ks;K(ye),d[ye]=Z(f.facts)}const m=[];if(($=f.allegations)!=null&&$.length&&m.push(` :
${Z(f.allegations)}`),(B=f.negligenceTheory)!=null&&B.length&&m.push(` :
${Z(f.negligenceTheory)}`),(Y=f.medicalFindings)!=null&&Y.length&&m.push(` :
${Z(f.medicalFindings)}`),m.length){const ye=e.selectedSections.includes("Strategy & Recommendations")?"Strategy & Recommendations":"Strategy";K(ye),d[ye]=m.join(`

`)}f.riskAssessment&&(K("Risk Assessment"),d["Risk Assessment"]=f.riskAssessment);const x=[];(oe=f.recommendedActions)!=null&&oe.length&&x.push(Z(f.recommendedActions)),(we=f.requestedRelief)!=null&&we.length&&x.push(` :
${Z(f.requestedRelief)}`),x.length&&(K("Recommendations"),d.Recommendations=x.join(`

`)),t({content:d,selectedSections:T,complaintAnalysis:f}),O({msg:"     .",type:"success"})},Fi=(f,T)=>{var Wt,Ft,Ot;if(!f)return"";const K=(T==null?void 0:T.analysisType)==="DEMAND"||(T==null?void 0:T.section)===ee?"DEMAND":"CLAIM",Z=K==="DEMAND"?"":"",de=K==="DEMAND"?"   ":"  ",d=(Ft=(Wt=f.entities)==null?void 0:Wt.plaintiff)==null?void 0:Ft.trim(),m=(f.defendants||[]).filter(Boolean).join(", "),x=[];x.push(d?`${Z}, ${d}`:Z),m&&x.push(`${de} ${m}`);const k=`${x.join(" ")}.`.replace(/\s+/g," ").trim(),v=(We,zn,gn,ts=!1)=>{const ct=zn.map(pt=>(pt||"").trim()).filter(Boolean);if(!ct.length&&ts)return"";const Ct=ct.length?ct:gn?[gn]:[];if(!Ct.length)return"";const rn=Ct.map((pt,ns)=>`${ns+1}. ${pt}`.trim()).join(`
`);return`${We}
${rn}`.trim()},_=(f.timeline||[]).map(We=>{var ns,Sa,lr,wa,zo,Vo;if(!(We!=null&&We.event)&&!(We!=null&&We.date))return"";const zn=((We==null?void 0:We.date)||"").toString().trim(),gn=zn||" ",ts=((We==null?void 0:We.actor)||"").toString().trim()||(((ns=f.entities)==null?void 0:ns.plaintiff)||"").toString().trim()||Z,ct=((We==null?void 0:We.location)||"").toString().trim()||((Vo=(wa=(lr=(Sa=f.entities)==null?void 0:Sa.institution)==null?void 0:lr.toString)==null?void 0:(zo=wa.call(lr)).trim)==null?void 0:Vo.call(zo))||"",Ct=((We==null?void 0:We.event)||"").toString().trim(),rn=((We==null?void 0:We.result)||"").toString().trim(),pt=[];return pt.push(gn),pt.push(` ${ts}`),Ct&&pt.push(` ${Ct}`),ct&&pt.push(` ${ct}`),rn&&pt.push(` ${rn}`),pt.join(" ").replace(/\s+/g," ").trim()}).filter(Boolean)||[],$=(f.facts||[]).filter(Boolean),B=_.length?_:$,oe=v(K==="DEMAND"?"  ,  :":"  ,  :",B,"    ."),we=[];(Ot=f.entities)!=null&&Ot.plaintiff&&we.push(String(f.entities.plaintiff).trim()),Array.isArray(f.defendants)&&we.push(...f.defendants.map(String).map(We=>We.trim())),Array.isArray(f.providers)&&we.push(...f.providers.map(String).map(We=>We.trim()));const ye=Array.from(new Set(we.filter(Boolean))),ze=ye.length?`      : ${ye.join(", ")}.`:"",qe=(Array.isArray(f.gaps)&&f.gaps||Array.isArray(f.missingDetails)&&f.missingDetails||[]).filter(Boolean).map(We=>String(We).trim()).filter(Boolean),at=qe.length?qe:["   ,        ."],nt=v("  :",at),xt=(()=>{const We=(f.injuries||[]).find(gn=>gn&&String(gn).trim())||(f.medicalFindings||[]).find(gn=>gn&&String(gn).trim());return We?` ${K==="DEMAND"?"":""},         : ${String(We).trim()}.`:""})();return[k,oe,ze,nt,xt].filter(We=>We&&String(We).trim()).join(`

`).trim()},Oo=()=>{sn("Strategy",Pv),O({msg:' " "  .',type:"success"})},Bi=(f,T)=>{var de;const K=(de=f.target.files)==null?void 0:de[0];if(!K)return;if(!T.includes("Expenses")){f.target.value="";return}const Z=new FileReader;Z.onload=async d=>{var x;const m=((x=d.target)==null?void 0:x.result).split(",")[1];await Mi(K.name,m,K.type)},Z.readAsDataURL(K),f.target.value=""},Tr=f=>{or(null),ft(f),setTimeout(()=>{var T;(T=xs.current)==null||T.click()},0)},Mo=async f=>{var Z,de,d;const T=(Z=f.target.files)==null?void 0:Z[0];if(!T||!Ge){ft(null),f.target.value="";return}F(!0);const K=Ge.section||Ge.mode;en(K);try{const m=await Pi(T),x=Ge.mode==="SECTION"&&Ge.section||Ks;if(Ge.domain==="dental"&&Ge.mode==="SECTION"){try{const oe=await eb(m,T.type||"application/octet-stream"),we=((de=oe.text)==null?void 0:de.trim())??"";if(!oe.success||!we){const ye=oe.reason==="INVALID_DOCUMENT"?Pp:Lr;O({msg:ye,type:"info"})}else{const ye=we,ze=Ge.section||q,Je=e.content[ze]||"",qe=Je?`${Je}

${ye}`:ye,at={content:{...e.content,[ze]:qe},selectedSections:e.selectedSections.includes(ze)?e.selectedSections:[...e.selectedSections,ze]};if(Ge.analysisType==="EXPERT"&&Ge.section){const xt=!!Je.trim()?"MULTIPLE":"SINGLE";at.expertSummaryMode={...e.expertSummaryMode||{},[ze]:xt}}t(at),O({msg:"  ()    .",type:"success"}),oe.lowConfidenceDocument&&setTimeout(()=>O({msg:Pc,type:"info"}),800)}}catch(oe){console.error("Dental opinion analysis failed",oe),O({msg:Lr,type:"info"})}finally{F(!1),en(null),ft(null),f.target.value=""}return}const v=x===q||x===ee,_=gp(x),$={expertCountMode:Ge.analysisType==="EXPERT"?((d=e.expertSummaryMode)==null?void 0:d[x])||"SINGLE":void 0,partyRole:cb(x)||void 0};(v||_)&&($.sectionKey=x,$.plaintiffName=e.plaintiffName||"",$.insuredName=e.insuredName||"",$.insurerName=e.insurerName||"",$.reportSubject=e.reportSubject||"");const B=await Z0(m,T.type||"application/octet-stream",Ge.analysisType||"CLAIM",$);if(B.success===!1){const oe=B.reason==="INVALID_DOCUMENT"?Pp:Lr;O({msg:oe,type:"info"});return}const Y=(B==null?void 0:B.analysis)||null;if(Ge.mode==="SECTION"){const oe=((B==null?void 0:B.claimSummary)||"").trim()||Fi(Y,{analysisType:Ge.analysisType,section:Ge.section});if(!oe)O({msg:Lr,type:"info"});else{const we=Ge.section||q,ye=e.content[we]||"",ze=ye?`${ye}

${oe}`:oe,Je={content:{...e.content,[we]:ze},selectedSections:e.selectedSections.includes(we)?e.selectedSections:[...e.selectedSections,we]};if(Ge.analysisType==="EXPERT"&&Ge.section){const at=!!ye.trim()?"MULTIPLE":"SINGLE";Je.expertSummaryMode={...e.expertSummaryMode||{},[we]:at}}Y&&(Je.complaintAnalysis=Y),t(Je),O({msg:"     .",type:"success"}),B.lowConfidenceDocument&&setTimeout(()=>O({msg:Pc,type:"info"}),800)}}else Y?(_o(Y),Ge.mode==="POLICY"&&t({policyFile:{id:`policy-${Date.now()}`,name:T.name,data:m,type:T.type}}),B.lowConfidenceDocument&&O({msg:Pc,type:"info"})):O({msg:Lr,type:"info"})}catch(m){console.error(m),O({msg:Lr,type:"info"})}finally{F(!1),en(null),ft(null),f.target.value=""}},$i=()=>{const{policyPeriodStart:f,policyPeriodEnd:T,retroStart:K,retroEnd:Z}=e;if(!f&&!T&&!K&&!Z){O({msg:"    .  POLCY .",type:"info"});return}const de=Gh(e.content["Insurance Coverage"],f,T,K,Z);sn("Insurance Coverage",de),O({msg:"   .",type:"success"})},Hi=!!(e.policyPeriodStart||e.policyPeriodEnd||e.retroStart||e.retroEnd),Ui=async f=>{if(e.odakanitNo)try{const Z=await Xe.getLatestSheetForCase(e.odakanitNo);if(Z&&Z.lineItems&&Z.lineItems.length>0){const de=Xe.buildCumulativeExpensesSnapshot(Z.sheet.id,new Date().toISOString());if(!de)return;const{effectiveSheet:d,allLines:m,opts:x}=de,{text:k}=Oh(d,m,x),{html:v}=oi(d,m,x);if(sn(f,k),Z.attachments&&Z.attachments.length){const $=e.invoiceFiles||[],B=Math.max(0,4-$.length);if(B>0){const Y=Z.attachments.slice(0,B).map((oe,we)=>{const[ye,ze]=oe.fileKey.split(",");let Je=oe.mimeType||"application/octet-stream";if(ye&&ye.startsWith("data:")){const at=ye.match(/^data:(.*?);base64$/);at&&at[1]&&(Je=at[1])}const qe=ze||oe.fileKey;return{id:`fes-inv-${oe.id}-${we}`,name:oe.originalFileName,data:qe,type:Je}});if(Y.length){const oe=[...$,...Y],we=oe.length>0,ze=nn&&e.status==="WAITING_FOR_INVOICES"&&we?"TASK_ASSIGNED":e.status;t({invoiceFiles:oe,isWaitingForInvoices:!we,status:ze,expensesSheetId:Z.sheet.id,expensesSnapshotAt:Z.sheet.updatedAt||new Date().toISOString(),expensesHtml:v||e.expensesHtml})}}}O({msg:"Expenses Table was inserted into the EXPENSES section.",type:"success"});return}}catch(Z){Gu("Failed to load Expenses Table for report",Z)}const T=e.expenseWorksheet;if(!T||!T.rows||T.rows.length===0){O({msg:"    .",type:"info"});return}if(T.status!=="LOCKED"){O({msg:'       ".',type:"info"});return}const K=Xi(T);sn(f,K),O({msg:'   ".',type:"success"})},Wi=()=>{u&&(u(),O({msg:"    .",type:"success"}))},zi=async()=>{if(!Ie){$e(!0);try{const f=await rb(e.content||{},a.role),T=f.issues||[];Ee(T);const K=f.runAt||new Date().toISOString();Oe(K),t({toneRiskLastRunAt:K}),ot(f.meta||null),T.length?O({msg:"     .",type:"info"}):O({msg:"   Tone & Risk .",type:"success"})}catch(f){console.error("Tone & Risk check failed",f),O({msg:" Tone & Risk        .",type:"error"})}finally{$e(!1)}}},Vi=()=>{Ee([]),Oe(null),ot(null),ne(null)},Ki=(f,T)=>{if(!f||!T)return!1;const K=/(\d{1,2}\/\d{1,2}\/\d{2,4}|\d+(?:\.\d+)?%?)/g,Z=[];let de;for(;(de=K.exec(f))!==null;)de[0]&&Z.push(de[0]);return Z.length?Z.some(d=>!T.includes(d)):!1},Yi=f=>{var de,d;if(!f.suggestion)return;const T=f.sectionKey,K=e.content[T]||"";if(!K||!f.excerpt||!K.includes(f.excerpt)){(de=navigator.clipboard)==null||de.writeText(f.suggestion).catch(()=>{}),O({msg:"    .   .",type:"info"});return}if(Ki(f.excerpt,f.suggestion)){(d=navigator.clipboard)==null||d.writeText(f.suggestion).catch(()=>{}),O({msg:"    /      .",type:"info"});return}ne({sectionKey:T,prevText:K});const Z=K.replace(f.excerpt,f.suggestion);sn(T,Z)},Gi=()=>{if(!X)return;const{sectionKey:f,prevText:T}=X;sn(f,T),ne(null),O({msg:"  .",type:"info"})},qi=async()=>{if(!Ie){pe(!0);try{const f=await ab(e.content||{},a.role),T=f.issues||[];if(re(T),je(f.runAt||new Date().toISOString()),f.success===!1){O({msg:"    .    .",type:"info"});return}T.length?O({msg:"       .",type:"info"}):O({msg:"     .",type:"success"})}catch(f){console.error("Hebrew style review failed",f),O({msg:"    .    .",type:"info"})}finally{pe(!1)}}},Po=(f,T)=>{if(Ie||z)return;const K=Ci(T.body),Z=e.content[f]||"";sn(f,Z?`${Z}

${K}`:K),se(null);const de=Nv(a.id,T.id);ie(de)},Rr=async f=>{try{await navigator.clipboard.writeText(f.body),O({msg:"  .",type:"info"})}catch{O({msg:"     ",type:"warning"})}},_s=f=>{var m;if(!f.suggestion)return;const T=f.sectionKey,K=e.content[T]||"",Z=f.excerpt;if(!(Z&&K.includes(Z))){(m=navigator.clipboard)==null||m.writeText(f.suggestion).catch(()=>{}),O({msg:"    .   .",type:"info"});return}const d=K.replace(Z,f.suggestion);sn(T,d)},Os=f=>Q.filter(T=>T.sectionKey===f&&T.isEnabled!==!1).sort((T,K)=>{const Z=T.label==="LLOYDS_RECOMMENDED"?0:1,de=K.label==="LLOYDS_RECOMMENDED"?0:1;if(Z!==de)return Z-de;const d=T.usageCount||0;return(K.usageCount||0)-d}),Fo=f=>{if(a.role!=="ADMIN")return;const T=A.current[f],K=T==null?void 0:T.current;if(!K){O({msg:"     .",type:"error"});return}const Z=K.selectionStart??0,de=K.selectionEnd??0;if(Z===de){O({msg:"     -Best Practice.",type:"info"});return}const m=(e.content[f]||"").slice(Z,de).trim();if(!m){O({msg:"    .",type:"info"});return}yt({sectionKey:f,body:m})},Bo=async({title:f,label:T,tags:K,behavior:Z})=>{if(!Rt)return;const de=new Date().toISOString(),d={id:"",sectionKey:Rt.sectionKey,title:f,body:Rt.body,label:T,tags:K.length?K:void 0,isEnabled:!0,createdByUserId:a.id,createdAt:de,updatedAt:de,usageCount:0,lastUsedAt:null,behavior:Z};try{const m=await xp(d,a.role);be(m),O({msg:"Best Practice  .",type:"success"})}catch(m){console.error("Failed to save best practice",m),O({msg:" -Best Practice .",type:"error"})}yt(null)},Na=()=>{yt(null)},$o=async(f,T)=>{if(Ie)return;const K=e.content[f]||"",Z=K?`${K}

${T.body}`:T.body;sn(f,Z);try{const de=await hp(T.id,"INSERT",a.role);be(de)}catch(de){console.error("Failed to record best practice usage (insert)",de)}},va=async f=>{var T;(T=navigator.clipboard)==null||T.writeText(f.body).catch(()=>{});try{const K=await hp(f.id,"COPY",a.role);be(K)}catch(K){console.error("Failed to record best practice usage (copy)",K)}O({msg:"  .",type:"info"})},Cr=async(f,T)=>{const K=Q.find(de=>de.id===f);if(!K)return;const Z={...K,...T,updatedAt:new Date().toISOString()};try{const de=await xp(Z,a.role);be(de)}catch(de){console.error("Failed to update best practice",de),O({msg:" -Best Practice .",type:"error"})}},Ho=async f=>{try{const T=await lb(f,a.role);be(T)}catch(T){console.error("Failed to delete best practice",T),O({msg:" -Best Practice .",type:"error"})}},Uo=async(f,T)=>{try{const K=await ib(f,T,a.role);be(K)}catch(K){console.error("Failed to toggle best practice enabled",K),O({msg:"  -Best Practice .",type:"error"})}},Xi=f=>{const T=f.rows.filter(d=>d.type==="EXPENSE"),K=f.rows.filter(d=>d.type==="ADJUSTMENT"),Z=T.map(d=>` ${d.label}${d.serviceProvider?` (${d.serviceProvider})`:""}  ${d.amount.toLocaleString()}`),de=K.map(d=>` ${d.label}  ${d.amount.toLocaleString()}`);return["     ","",":",Z.length?Z.join(`
`):"   ",""," / :",de.length?de.join(`
`):"  ","",`" : ${f.totals.totalExpenses.toLocaleString()}`,`" : ${f.totals.totalAdjustments.toLocaleString()}`,` : ${f.totals.totalBalance.toLocaleString()}`].join(`
`)};return n.jsxs(n.Fragment,{children:[n.jsx("input",{type:"file",ref:xs,className:"hidden",accept:".pdf,.doc,.docx,.txt,.jpg,.jpeg,.png,application/pdf,application/msword,application/vnd.openxmlformats-officedocument.wordprocessingml.document,text/plain,image/*",onChange:Mo}),n.jsxs("div",{className:"space-y-6",children:[n.jsxs("div",{className:"flex flex-wrap justify-between items-center gap-2",children:[n.jsxs("button",{onClick:s,className:"flex items-center text-sm text-textMuted bg-navySecondary px-3 py-1.5 rounded-full hover:bg-borderDark",children:[n.jsx(ei,{className:"w-4 h-4 mr-1"}),"   1"]}),n.jsxs("div",{className:"flex items-center gap-3",children:[a.role==="ADMIN"&&(c||i)&&n.jsxs("div",{className:"flex flex-col items-end gap-1",children:[c&&n.jsx("button",{onClick:c,disabled:!Lt||h,className:`flex items-center text-sm px-3 py-1.5 rounded-full transition ${Lt&&!h?"text-indigo-700 bg-indigo-50 hover:bg-indigo-100":"text-slate-400 bg-slate-100 cursor-not-allowed"}`,children:h?n.jsxs(n.Fragment,{children:[n.jsx(Bt,{className:"w-4 h-4 mr-1 animate-spin"})," ..."]}):n.jsxs(n.Fragment,{children:[n.jsx(P0,{className:"w-4 h-4 mr-1"})," Auto-Translate"]})}),i&&n.jsx("button",{onClick:i,disabled:!e.isTranslated||!ga||!!S,className:`flex items-center text-sm px-3 py-1.5 rounded-full transition ${e.isTranslated&&ga&&!S?"text-emerald-700 bg-emerald-50 hover:bg-emerald-100":"text-slate-400 bg-slate-100 cursor-not-allowed"}`,children:S?n.jsxs(n.Fragment,{children:[n.jsx(Bt,{className:"w-4 h-4 mr-1 animate-spin"})," Improving..."]}):n.jsx(n.Fragment,{children:"Improve English"})}),c&&!Lt&&!h&&n.jsx("p",{className:"text-[11px] text-textMuted",children:"      ."}),e.translationStale&&n.jsx("p",{className:"text-[11px] text-amber-700 max-w-xs text-right",children:" :      ,      ."}),h&&n.jsx("p",{className:"text-[11px] text-indigo-600",children:"      ."})]}),a.role==="ADMIN"&&tn&&n.jsxs("div",{className:"flex flex-col items-end gap-1 text-[11px] text-textLight",children:[n.jsx("span",{className:"font-semibold",children:"  "}),n.jsxs("div",{className:"inline-flex rounded-full border border-borderDark overflow-hidden bg-panel",children:[n.jsx("button",{type:"button",onClick:()=>Zt("DUAL"),className:`px-3 py-1 ${rt==="DUAL"?"bg-slate-800 text-white":"bg-panel text-textLight hover:bg-slate-100"} text-[11px]`,children:" + "}),n.jsx("button",{type:"button",onClick:()=>Zt("ENGLISH_ONLY"),className:`px-3 py-1 border-r border-borderDark ${rt==="ENGLISH_ONLY"?"bg-slate-800 text-white":"bg-panel text-textLight hover:bg-slate-100"} text-[11px]`,children:" "})]})]}),a.role==="ADMIN"&&u&&n.jsxs("button",{onClick:Wi,className:"flex items-center text-sm text-purple-700 bg-purple-50 px-3 py-1.5 rounded-full hover:bg-purple-100",children:[n.jsx(Ou,{className:"w-4 h-4 mr-1"})," Format Text"]}),n.jsxs("button",{onClick:o,className:"flex items-center text-sm text-lpBlue bg-blue-50 px-3 py-1.5 rounded-full hover:bg-blue-100",children:[n.jsx(_u,{className:"w-4 h-4 mr-1"}),"  "]})]})]}),j&&n.jsxs("div",{className:"flex items-center justify-end gap-2 text-[11px] text-indigo-600",children:[n.jsx(Bt,{className:"w-3 h-3 animate-spin"}),n.jsx("span",{children:"   ,     "})]}),L&&n.jsx(jv,{message:L.msg,type:L.type,onClose:()=>O(null)}),n.jsxs("div",{className:"flex items-center justify-between gap-2",children:[n.jsx("h2",{className:"text-2xl font-bold text-lpBlue font-serif",children:"2. Draft Content"}),!Ie&&P&&n.jsxs("button",{type:"button",onClick:()=>P(),className:"flex items-center text-[11px] px-3 py-1.5 rounded-full bg-indigo-50 text-indigo-800 border border-indigo-200 hover:bg-indigo-100",title:"         (  ).",children:[n.jsx(ia,{className:"w-3 h-3 ml-1"})," "]})]}),!Ie&&n.jsxs("div",{className:"mb-3 mt-1 space-y-1",children:[n.jsxs("div",{className:"flex items-center justify-between gap-2",children:[n.jsx("div",{className:"flex items-center gap-2",children:n.jsx("span",{className:"text-[11px] font-semibold text-textMuted",children:"  "})}),Ze&&n.jsxs("div",{className:"text-[11px] text-textMuted",children:[" Tone & Risk :"," ",new Date(Ze).toLocaleString("he-IL",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"})]})]}),n.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[n.jsx("button",{type:"button",onClick:qi,disabled:te,title:"        .        .",className:`flex items-center text-sm font-semibold px-4 py-2 rounded-lg border ${te?"bg-slate-100 text-slate-400 border-borderDark cursor-not-allowed":"bg-blue-500/20 text-blue-200 border-blue-400/60 hover:bg-blue-500/30"}`,children:te?n.jsxs(n.Fragment,{children:[n.jsx(Bt,{className:"w-4 h-4 mr-1.5 animate-spin"}),"   ..."]}):n.jsx(n.Fragment,{children:"  ( )"})}),C.length>0&&n.jsxs("button",{type:"button",onClick:()=>{const f=document.getElementById("hebrew-style-panel");f&&f.scrollIntoView({behavior:"smooth",block:"start"})},className:"inline-flex items-center text-xs font-medium px-2.5 py-1 rounded-full bg-blue-500/20 text-blue-200 border border-blue-400/60 hover:bg-blue-500/30",children:[" ",C.length>1&&` (${C.length})`]}),n.jsx("button",{type:"button",onClick:zi,disabled:ve,title:"         .        .",className:`flex items-center text-sm font-semibold px-4 py-2 rounded-lg border ${ve?"bg-slate-100 text-slate-400 border-borderDark cursor-not-allowed":"bg-amber-500/20 text-amber-200 border-amber-400/60 hover:bg-amber-500/30"}`,children:ve?n.jsxs(n.Fragment,{children:[n.jsx(Bt,{className:"w-4 h-4 mr-1.5 animate-spin"}),"  Tone & Risk..."]}):n.jsx(n.Fragment,{children:" Tone & Risk ()"})}),fe.length>0&&n.jsx("button",{type:"button",onClick:Vi,className:"text-[11px] text-textMuted hover:text-textLight underline",children:"  Tone & Risk"})]}),n.jsxs("div",{className:"flex flex-wrap items-center gap-4 text-[11px] text-textMuted",children:[Be&&!C.length&&!te&&n.jsx("span",{children:"  ."}),Ze&&!fe.length&&!ve&&n.jsx("span",{children:"  Tone & Risk."})]})]}),!Ie&&fe.length>0&&n.jsxs("div",{id:"tone-risk-panel",className:"mb-4 border border-amber-200 bg-amber-50 rounded-md p-3 text-xs space-y-2",children:[n.jsxs("div",{className:"flex items-center justify-between gap-2 mb-1",children:[n.jsxs("div",{className:"font-semibold text-amber-900",children:[" ",fe.length,"  Tone & Risk"]}),X&&n.jsx("button",{type:"button",onClick:Gi,className:"text-[11px] text-textMuted hover:text-textLight underline",children:"  "})]}),Ye&&n.jsxs("div",{className:"text-[11px] text-textMuted",children:[" ",Ye.sectionsSent,"  |  : ",Ye.charsBefore," |  : ",Ye.charsAfter,Ye.truncatedSections>0&&n.jsxs("span",{className:"ml-2 text-amber-700",children:["      (",Ye.truncatedSections,")"]})]}),n.jsx("div",{className:"space-y-2 max-h-60 overflow-y-auto",children:fe.map(f=>n.jsxs("div",{className:"bg-panel border border-amber-200 rounded px-2 py-2 space-y-1",children:[n.jsx("div",{className:"flex items-center justify-between gap-2",children:n.jsxs("div",{className:"flex items-center gap-1",children:[n.jsx("span",{className:"inline-flex items-center rounded-full px-2 py-0.5 text-[10px] font-semibold bg-slate-100 text-textLight",children:f.sectionKey||"Unknown section"}),n.jsx("span",{className:`inline-flex items-center rounded-full px-2 py-0.5 text-[10px] font-semibold ${f.severity==="CRITICAL"?"bg-red-100 text-red-700":f.severity==="WARNING"?"bg-amber-100 text-amber-700":"bg-slate-100 text-textMuted"}`,children:f.severity}),n.jsx("span",{className:"inline-flex items-center rounded-full px-2 py-0.5 text-[10px] bg-indigo-50 text-indigo-700 font-mono",children:f.kind})]})}),n.jsxs("div",{className:"text-[11px] text-textLight",children:[n.jsx("span",{className:"font-semibold",children:":"})," ",n.jsxs("span",{className:"italic",children:['"',f.excerpt,'"']})]}),n.jsxs("div",{className:"text-[11px] text-textLight",children:[n.jsx("span",{className:"font-semibold",children:":"})," ",f.message]}),f.suggestion&&n.jsxs("div",{className:"text-[11px] text-textLight",children:[n.jsx("span",{className:"font-semibold",children:" :"})," ",n.jsx("span",{className:"whitespace-pre-wrap",children:f.suggestion})]}),n.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[f.suggestion&&n.jsxs(n.Fragment,{children:[n.jsx("button",{type:"button",onClick:()=>{var T;return(T=navigator.clipboard)==null?void 0:T.writeText(f.suggestion||"").catch(()=>{})},className:"px-2 py-0.5 rounded border border-borderDark text-[11px] text-textLight hover:bg-slate-100",children:"  "}),n.jsx("button",{type:"button",onClick:()=>Yi(f),className:"px-2 py-0.5 rounded border border-emerald-300 text-[11px] text-emerald-700 hover:bg-emerald-50",children:" "})]}),n.jsx("button",{type:"button",onClick:()=>re(T=>T.filter(K=>K.id!==f.id)),className:"px-2 py-0.5 rounded border border-borderDark text-[11px] text-textMuted hover:bg-slate-100 ml-auto",children:""})]})]},f.id))})]}),!Ie&&C.length>0&&n.jsxs("div",{id:"hebrew-style-panel",className:"mb-4 border border-blue-200 bg-blue-50 rounded-md p-3 text-xs space-y-2",children:[n.jsxs("div",{className:"flex items-center justify-between gap-2 mb-1",children:[n.jsxs("div",{className:"font-semibold text-blue-900",children:[" ",C.length,"   "]}),Be&&n.jsxs("div",{className:"text-[11px] text-textMuted",children:[" :"," ",new Date(Be).toLocaleString("he-IL",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"})]})]}),n.jsx("div",{className:"space-y-2 max-h-60 overflow-y-auto",children:C.map(f=>{const T=e.content[f.sectionKey]||"",K=!!f.suggestion&&!!f.excerpt&&T.includes(f.excerpt);return n.jsxs("div",{className:"bg-panel border border-blue-200 rounded px-2 py-2 space-y-1",children:[n.jsx("div",{className:"flex items-center justify-between gap-2",children:n.jsxs("div",{className:"flex items-center gap-1",children:[n.jsx("span",{className:"inline-flex items-center rounded-full px-2 py-0.5 text-[10px] font-semibold bg-slate-100 text-textLight",children:f.sectionKey||"Unknown section"}),n.jsx("span",{className:`inline-flex items-center rounded-full px-2 py-0.5 text-[10px] font-semibold ${f.severity==="CRITICAL"?"bg-red-100 text-red-700":f.severity==="WARNING"?"bg-amber-100 text-amber-700":"bg-slate-100 text-textMuted"}`,children:f.severity}),n.jsx("span",{className:"inline-flex items-center rounded-full px-2 py-0.5 text-[10px] bg-blue-50 text-blue-700 font-mono",children:f.category})]})}),n.jsxs("div",{className:"text-[11px] text-textLight",children:[n.jsx("span",{className:"font-semibold",children:":"})," ",n.jsxs("span",{className:"italic",children:['"',f.excerpt,'"']})]}),n.jsxs("div",{className:"text-[11px] text-textLight",children:[n.jsx("span",{className:"font-semibold",children:":"})," ",f.message]}),f.suggestion&&n.jsxs("div",{className:"text-[11px] text-textLight",children:[n.jsx("span",{className:"font-semibold",children:" :"})," ",n.jsx("span",{className:"whitespace-pre-wrap",children:f.suggestion})]}),f.suggestion&&n.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[n.jsx("button",{type:"button",onClick:()=>{var Z;return(Z=navigator.clipboard)==null?void 0:Z.writeText(f.suggestion||"").catch(()=>{})},className:"px-2 py-0.5 rounded border border-borderDark text-[11px] text-textLight hover:bg-slate-100",children:" "}),K&&n.jsx("button",{type:"button",onClick:()=>_s(f),className:"px-2 py-0.5 rounded border border-emerald-300 text-[11px] text-emerald-700 hover:bg-emerald-50",children:" "})]})]},f.id)})})]}),Ie&&n.jsxs("div",{className:"bg-orange-100 border-l-4 border-orange-500 p-4 text-orange-800",children:[n.jsxs("p",{className:"font-bold flex items-center",children:[n.jsx(U0,{className:"w-5 h-5 mr-2"})," Restricted Access Mode"]}),n.jsxs("p",{className:"text-sm",children:["You are logged in as ",a.role,". You can only modify the Invoice Attachments in the Expenses section."]})]}),e.financeInstructions&&n.jsx("div",{className:"bg-red-50 border-l-4 border-red-600 p-4 shadow-md rounded-r-lg animate-pulse-slow",children:n.jsxs("div",{className:"flex items-start",children:[n.jsx("div",{className:"flex-shrink-0",children:n.jsx(qa,{className:"h-5 w-5 text-red-600"})}),n.jsxs("div",{className:"ml-3 w-full",children:[n.jsx("h3",{className:"text-sm font-bold text-red-800",children:"Instruction from Finance"}),n.jsx("div",{className:"mt-2 text-sm text-red-700 whitespace-pre-wrap",children:e.financeInstructions}),e.expensesSourceFile&&n.jsxs("div",{className:"mt-4 pt-2 border-t border-red-200",children:[n.jsx("p",{className:"text-xs font-bold text-red-800 mb-1",children:"Attached Expenses Source File (Word/Excel):"}),n.jsxs("div",{className:"flex items-center bg-panel p-2 rounded border border-red-200 max-w-md",children:[n.jsx(yo,{className:"w-4 h-4 text-blue-600 mr-2"}),n.jsx("span",{className:"text-sm text-textLight flex-1",children:e.expensesSourceFile.name}),n.jsx("a",{href:`data:${e.expensesSourceFile.type};base64,${e.expensesSourceFile.data}`,download:e.expensesSourceFile.name,className:"text-xs bg-blue-100 text-blue-700 px-2 py-1 rounded hover:bg-blue-200 font-bold",children:"Download"})]})]})]})]})}),lt&&n.jsxs("div",{className:"bg-amber-50 border-l-4 border-amber-500 p-4 shadow rounded-r-lg flex gap-3 items-start",children:[n.jsx(qa,{className:"w-5 h-5 text-amber-600 mt-1"}),n.jsxs("div",{children:[n.jsx("p",{className:"font-bold text-amber-900",children:"    "}),n.jsx("p",{className:"text-sm text-amber-800",children:"  /   .              ."})]})]}),n.jsx(pb,{report:e,currentUser:a,onSubmitToAdmin:()=>p&&p(),onApproveHebrew:()=>y&&y(),onRequestChanges:f=>N&&N(f),onMarkIssueDone:f=>w&&w(f),onAddExternalFeedbackIssues:(f,T)=>R&&R(f,T),onReopenHebrewDueToExternalFeedback:()=>E&&E()}),n.jsx("div",{className:"space-y-8",children:e.selectedSections.map(f=>{var d,m,x,k;const T=Ld(f,(d=e.expertSummaryMode)==null?void 0:d[f]),K=/expert/i.test(T),Z=fe.filter(v=>v.sectionKey===f).length,de=C.filter(v=>v.sectionKey===f).length;return n.jsxs("div",{className:`bg-panel p-6 rounded-lg shadow-sm border transition-all ${Ie&&!f.includes("Expenses")?"opacity-60 pointer-events-none border-gray-100":"border-borderDark"}`,onClick:v=>{if(!U||typeof f!="string"||!f.trim())return;const _=v.target;!_||_.closest('button, a, input, textarea, select, svg, [role="button"]')||U(f)},children:[n.jsxs("div",{className:"flex justify-between items-center mb-3 pb-3 border-b border-gold/30",children:[n.jsxs("div",{className:"flex flex-col gap-1",children:[n.jsx("h3",{className:"font-bold text-xl text-gold uppercase tracking-wider border-r-2 border-gold/50 pr-2",children:T}),f.includes("Expenses")&&e.expensesSnapshotAt&&n.jsxs("p",{className:"text-[11px] text-textMuted",children:["Based on the latest Expenses Table as of"," ",new Date(e.expensesSnapshotAt).toLocaleString("en-GB",{day:"2-digit",month:"short",year:"numeric",hour:"2-digit",minute:"2-digit"}),"."]}),!f.includes("Expenses")&&(de>0||Z>0)&&n.jsxs("div",{className:"flex flex-wrap gap-1 text-[10px]",children:[de>0&&n.jsxs("button",{type:"button",onClick:()=>{const v=document.getElementById("hebrew-style-panel");v&&v.scrollIntoView({behavior:"smooth",block:"start"})},className:"inline-flex items-center rounded-full px-2 py-0.5 bg-blue-50 text-blue-800 border border-blue-200 hover:bg-blue-100",children:[" ",de>1&&` (${de})`]}),Z>0&&n.jsxs("button",{type:"button",onClick:()=>{const v=document.getElementById("tone-risk-panel");v&&v.scrollIntoView({behavior:"smooth",block:"start"})},className:"inline-flex items-center rounded-full px-2 py-0.5 bg-amber-50 text-amber-800 border border-amber-200 hover:bg-amber-100",children:[" Tone & Risk",Z>1&&` (${Z})`]})]})]}),!Ie&&n.jsxs("div",{className:"flex items-center gap-2",children:[!f.includes("Expenses")&&n.jsx("button",{className:"inline-flex items-center px-2.5 py-2 rounded-lg border border-borderDark hover:border-gold/50 hover:bg-gold/10 text-textMuted hover:text-goldLight transition",disabled:j,onClick:()=>{Tr({mode:"SECTION",section:f,analysisType:Ii(f)})},title:"   ",children:Yt===f?n.jsx(Bt,{className:"w-4 h-4 animate-spin"}):n.jsx($0,{className:"w-4 h-4"})}),K&&n.jsx("button",{className:"inline-flex items-center px-2.5 py-2 rounded-lg border border-borderDark hover:border-gold/50 hover:bg-gold/10 text-textMuted hover:text-goldLight transition",disabled:j,onClick:()=>{Tr({mode:"SECTION",section:f,analysisType:"EXPERT",domain:"dental"})},title:"     ",children:Yt===f&&(Ge==null?void 0:Ge.domain)==="dental"?n.jsx(Bt,{className:"w-4 h-4 animate-spin"}):n.jsx("span",{className:"text-lg leading-none",children:""})}),f.includes("Expenses")&&Ls&&n.jsx("button",{onClick:()=>Ui(f),className:"p-1.5 hover:bg-green-50 rounded text-textMuted hover:text-green-600",title:"   ",children:n.jsx(ph,{className:"w-4 h-4"})}),!f.includes("Expenses")&&n.jsxs(n.Fragment,{children:[f==="Strategy"&&!Ie&&n.jsx("button",{onClick:Oo,className:"px-3 py-1 text-xs font-semibold text-blue-700 bg-blue-50 border border-blue-200 rounded-full hover:bg-blue-100",children:" "}),n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsxs("button",{onClick:()=>Oi(f),className:"inline-flex items-center px-4 py-2 rounded-lg text-sm font-semibold text-white bg-purple-600 hover:bg-purple-500 border border-purple-500/50 transition",title:"      ,     .     .",children:[Ds===f?n.jsx(Bt,{className:"w-4 h-4 mr-1.5 animate-spin"}):n.jsx(W0,{className:"w-4 h-4 mr-1.5"}),"  "]}),n.jsxs("div",{className:"flex rounded-full border border-purple-200 overflow-hidden text-[10px] bg-panel",title:"    ",children:[n.jsx("button",{type:"button",onClick:()=>et("SAFE_POLISH"),className:`px-2 py-0.5 ${Te==="SAFE_POLISH"?"bg-purple-100 text-purple-800":"text-purple-500 hover:bg-purple-50"}`,children:" "}),n.jsx("button",{type:"button",onClick:()=>et("REWRITE"),className:`px-2 py-0.5 border-l border-purple-100 ${Te==="REWRITE"?"bg-purple-100 text-purple-800":"text-purple-500 hover:bg-purple-50"}`,children:" "})]})]}),f==="Insurance Coverage"&&Hi&&n.jsx("button",{onClick:$i,className:"p-1.5 hover:bg-blue-50 rounded text-textMuted hover:text-blue-600",title:"Auto-fill policy data",children:n.jsx(Y0,{className:"w-4 h-4"})})]}),Ve&&Ve.sectionKey===f&&Ve.changedWords>0&&Ve.expiresAt>Date.now()&&n.jsxs("div",{className:"mt-1 text-[11px] text-textMuted bg-purple-50/40 border border-purple-100 rounded px-2 py-1",children:[n.jsxs("div",{className:"flex items-center justify-between gap-2",children:[n.jsxs("span",{children:["  ",Ve.changedWords,"   ."]}),n.jsx("button",{type:"button",className:"underline text-purple-700 hover:text-purple-900",onClick:()=>He(v=>v&&v.sectionKey===f?{...v,open:!v.open}:v),children:Ve.open?" ":" "})]}),Ve.open&&n.jsx("div",{className:"mt-1 text-[11px] text-textLight whitespace-pre-wrap leading-relaxed",children:Ve.tokens.map((v,_)=>v.type==="same"?` ${v.text}`:v.type==="add"?` [+${v.text}+]`:` [-${v.text}-]`)})]}),Ar(f).length>0&&n.jsxs("button",{onClick:()=>Li(f),className:"flex items-center gap-1 px-2 py-1 rounded text-xs font-bold bg-navySecondary text-textMuted border hover:bg-yellow-50",children:[n.jsx(ia,{className:"w-3 h-3"})," Ideas"]}),a.role==="ADMIN"&&n.jsxs("div",{className:"flex items-center gap-1",children:[n.jsx("button",{type:"button",onClick:()=>_i(f),className:"px-2 py-1 rounded text-[11px] border border-dashed border-borderDark text-textMuted hover:bg-slate-50",children:"Save selection as template"}),n.jsx("button",{type:"button",onClick:()=>Fo(f),className:"px-2 py-1 rounded text-[11px] border border-dashed border-emerald-300 text-emerald-700 hover:bg-emerald-50",children:"Save selection as Best Practice"})]})]})]}),f==="Update"&&Ai(e)&&n.jsxs("div",{className:"mb-3 text-xs text-textLight",children:[n.jsx("span",{className:"block mb-1 font-semibold",children:"    ()"}),n.jsxs("div",{className:"flex flex-wrap gap-2",children:[n.jsx("button",{type:"button",className:"px-3 py-1 rounded-full border border-borderDark bg-navySecondary hover:bg-navySecondary text-[11px] font-semibold text-textLight",onClick:()=>{const v=Fp.SOC,_=e.content.Update||"",$=v.split(`
`)[0];if(_.trimStart().startsWith($))return;const Y=_.trim().length>0?`${v}

${_.trimStart()}`:v;sn("Update",Y)},children:"  (Statement of Claim)"}),n.jsx("button",{type:"button",className:"px-3 py-1 rounded-full border border-borderDark bg-navySecondary hover:bg-navySecondary text-[11px] font-semibold text-textLight",onClick:()=>{const v=Fp.LOD,_=e.content.Update||"",$=v.split(`
`)[0];if(_.trimStart().startsWith($))return;const Y=_.trim().length>0?`${v}

${_.trimStart()}`:v;sn("Update",Y)},children:"  (Letter of Demand)"})]})]}),G===f&&!Ie&&n.jsxs("div",{className:"mb-4 p-3 bg-yellow-50 rounded border border-yellow-200",children:[n.jsxs("div",{className:"flex items-center justify-between gap-2 mb-2",children:[n.jsxs("div",{className:"flex items-center gap-2 text-[11px]",children:[n.jsx("button",{type:"button",className:`px-2 py-1 rounded-full border ${xe==="TEMPLATES"?"bg-panel border-yellow-400 text-yellow-800 font-semibold":"bg-yellow-100/60 border-yellow-200 text-yellow-700"}`,onClick:()=>Ne("TEMPLATES"),children:"Templates"}),n.jsx("button",{type:"button",className:`px-2 py-1 rounded-full border ${xe==="BEST_PRACTICES"?"bg-panel border-emerald-400 text-emerald-800 font-semibold":"bg-emerald-50/70 border-emerald-200 text-emerald-700"}`,onClick:()=>Ne("BEST_PRACTICES"),children:"Best Practices"}),n.jsx("button",{type:"button",className:`px-2 py-1 rounded-full border ${xe==="MY_SNIPPETS"?"bg-panel border-sky-400 text-sky-800 font-semibold":"bg-sky-50/70 border-sky-200 text-sky-700"}`,onClick:()=>Ne("MY_SNIPPETS"),children:" "})]}),xe==="TEMPLATES"&&n.jsx("input",{type:"text",className:"flex-1 border border-yellow-300 rounded px-2 py-1 text-xs",placeholder:"Search templates",value:I,onChange:v=>D(v.target.value)}),xe==="BEST_PRACTICES"&&n.jsx("input",{type:"text",className:"flex-1 border border-emerald-300 rounded px-2 py-1 text-xs",placeholder:"Search best practices",value:Fe,onChange:v=>Le(v.target.value)}),xe==="MY_SNIPPETS"&&n.jsx("input",{type:"text",className:"flex-1 border border-sky-300 rounded px-2 py-1 text-xs",placeholder:"  ",value:_e,onChange:v=>Me(v.target.value)}),a.role==="ADMIN"&&xe==="TEMPLATES"&&n.jsx("button",{type:"button",onClick:()=>{le(f),ue(!0)},className:"text-[11px] px-2 py-1 rounded bg-panel text-textLight border border-borderDark hover:bg-slate-50",children:"Manage templates"}),a.role==="ADMIN"&&xe==="BEST_PRACTICES"&&n.jsx("button",{type:"button",onClick:()=>{st(f),dt(!0)},className:"text-[11px] px-2 py-1 rounded bg-panel text-textLight border border-borderDark hover:bg-slate-50",children:"Manage best practices"}),xe==="MY_SNIPPETS"&&n.jsx("button",{type:"button",onClick:()=>{Ce(!0),Re(null)},className:"text-[11px] px-2 py-1 rounded bg-panel text-textLight border border-borderDark hover:bg-slate-50",children:" "})]}),n.jsx("div",{className:"grid grid-cols-1 gap-2 max-h-60 overflow-y-auto text-xs",children:xe==="TEMPLATES"?(()=>{const v=Ar(f),_=I.trim().toLowerCase(),$=_?v.filter(B=>B.title.toLowerCase().includes(_)||B.body.toLowerCase().includes(_)):v;return $.length?$.map(B=>{const Y=B.body.length>160?`${B.body.slice(0,160)}`:B.body;return n.jsxs("div",{className:"flex items-center gap-2 bg-panel border border-yellow-100 rounded px-2 py-2 hover:bg-yellow-100 cursor-pointer",onClick:()=>hs(f,B),children:[n.jsxs("div",{className:"flex-1 min-w-0 text-right",children:[n.jsx("div",{className:"font-semibold text-textLight truncate",children:B.title}),n.jsx("div",{className:"text-[11px] text-textMuted max-h-10 overflow-hidden whitespace-pre-wrap",children:Y})]}),n.jsx("button",{type:"button",className:"text-[11px] px-2 py-1 rounded bg-yellow-50 text-yellow-800 border border-yellow-200 hover:bg-yellow-100",children:"Insert"})]},B.id)}):n.jsx("p",{className:"text-[11px] text-textMuted",children:"No templates found for this section."})})():xe==="BEST_PRACTICES"?(()=>{const v=Os(f),_=Fe.trim().toLowerCase(),$=_?v.filter(B=>{const Y=(B.tags||[]).join(" ").toLowerCase();return B.title.toLowerCase().includes(_)||B.body.toLowerCase().includes(_)||Y.includes(_)}):v;return $.length?$.map(B=>{const Y=B.body.length>160?`${B.body.slice(0,160)}`:B.body,oe=B.behavior!=="COPY_ONLY";return n.jsxs("div",{className:"flex items-center gap-2 bg-panel border border-emerald-100 rounded px-2 py-2 hover:bg-emerald-50 cursor-default",children:[n.jsxs("div",{className:"flex-1 min-w-0 text-right",children:[n.jsxs("div",{className:"flex flex-wrap items-center justify-end gap-1 mb-0.5",children:[n.jsx("span",{className:"font-semibold text-textLight truncate",children:B.title}),n.jsx("span",{className:`inline-flex items-center rounded-full px-2 py-0.5 text-[9px] font-semibold ${B.label==="LLOYDS_RECOMMENDED"?"bg-purple-100 text-purple-700":"bg-emerald-100 text-emerald-700"}`,children:B.label==="LLOYDS_RECOMMENDED"?"Lloyds recommended":"Best practice"}),B.tags&&B.tags.length>0&&n.jsx("span",{className:"inline-flex items-center rounded-full px-2 py-0.5 text-[9px] bg-slate-100 text-textLight",children:B.tags.join(", ")})]}),n.jsx("div",{className:"text-[11px] text-textMuted max-h-10 overflow-hidden whitespace-pre-wrap",children:Y})]}),n.jsxs("div",{className:"flex flex-col items-stretch gap-1",children:[oe&&n.jsx("button",{type:"button",onClick:()=>$o(f,B),className:"text-[11px] px-2 py-0.5 rounded bg-emerald-50 text-emerald-800 border border-emerald-200 hover:bg-emerald-100",children:"Insert"}),n.jsx("button",{type:"button",onClick:()=>va(B),className:"text-[11px] px-2 py-0.5 rounded bg-slate-50 text-textLight border border-borderDark hover:bg-slate-100",children:"Copy"})]})]},B.id)}):n.jsx("p",{className:"text-[11px] text-textMuted",children:"No best practices found for this section."})})():(()=>{const v=_e.trim().toLowerCase(),$=V.filter(B=>!B.sectionKey||B.sectionKey===f).filter(B=>{if(!v)return!0;const Y=(B.tags||[]).join(" ").toLowerCase();return B.title.toLowerCase().includes(v)||B.body.toLowerCase().includes(v)||Y.includes(v)}).slice().sort((B,Y)=>{const oe=B.lastUsedAt||"",we=Y.lastUsedAt||"";if(oe&&we&&oe!==we)return we.localeCompare(oe);if(oe&&!we)return-1;if(!oe&&we)return 1;const ye=B.updatedAt||B.createdAt;return(Y.updatedAt||Y.createdAt).localeCompare(ye)});return $.length?$.map(B=>{const Y=B.body.length>160?`${B.body.slice(0,160)}`:B.body;return n.jsxs("div",{className:"flex items-center gap-2 bg-panel border border-sky-100 rounded px-2 py-2 hover:bg-sky-50 cursor-default",children:[n.jsxs("div",{className:"flex-1 min-w-0 text-right",children:[n.jsxs("div",{className:"flex flex-wrap items-center justify-end gap-1 mb-0.5",children:[n.jsx("span",{className:"font-semibold text-textLight truncate",children:B.title}),B.tags&&B.tags.length>0&&n.jsx("span",{className:"inline-flex items-center rounded-full px-2 py-0.5 text-[9px] bg-slate-100 text-textLight",children:B.tags.join(", ")})]}),n.jsx("div",{className:"text-[11px] text-textMuted max-h-10 overflow-hidden whitespace-pre-wrap",children:Y})]}),n.jsxs("div",{className:"flex flex-col items-stretch gap-1",children:[n.jsx("button",{type:"button",onClick:()=>Po(f,B),className:"text-[11px] px-2 py-0.5 rounded bg-sky-50 text-sky-800 border border-sky-200 hover:bg-sky-100 disabled:opacity-50 disabled:cursor-not-allowed",disabled:z,title:z?"       .":void 0,children:""}),n.jsx("button",{type:"button",onClick:()=>Rr(B),className:"text-[11px] px-2 py-0.5 rounded bg-slate-50 text-textLight border border-borderDark hover:bg-slate-100",children:""}),n.jsx("button",{type:"button",onClick:()=>{Ce(!0),Re({id:B.id,title:B.title,sectionKey:B.sectionKey||"",tagsInput:(B.tags||[]).join(", "),body:B.body})},className:"text-[11px] px-2 py-0.5 rounded bg-slate-50 text-textLight border border-borderDark hover:bg-slate-100",children:""}),n.jsx("button",{type:"button",onClick:()=>{if(window.confirm("    ?")){const oe=Mp(a.id,B.id);ie(oe)}},className:"text-[11px] px-2 py-0.5 rounded bg-red-50 text-red-700 border border-red-200 hover:bg-red-100",children:""})]})]},B.id)}):n.jsx("p",{className:"text-[11px] text-textMuted",children:"   ."})})()})]}),f.includes("Expenses")?n.jsxs("div",{className:"space-y-4",children:[nn&&n.jsxs("div",{className:"bg-blue-50 p-4 rounded border border-blue-100 mb-4",children:[n.jsx("h4",{className:"text-sm font-bold text-blue-800 mb-2",children:"Add Expense Item"}),n.jsxs("div",{className:"flex gap-2 flex-wrap",children:[n.jsx("input",{type:"date",className:"border p-2 rounded text-sm",value:ge.date,onChange:v=>Pe({...ge,date:v.target.value})}),n.jsx("input",{type:"text",className:"border p-2 rounded text-sm flex-1",placeholder:"Description (e.g. Court Fee)",value:ge.description,onChange:v=>Pe({...ge,description:v.target.value})}),n.jsx("input",{type:"number",className:"border p-2 rounded text-sm w-24",placeholder:"Amount",value:ge.amount,onChange:v=>Pe({...ge,amount:Number(v.target.value)})}),n.jsx("button",{onClick:Ti,className:"bg-blue-600 text-white px-4 py-2 rounded text-sm font-bold hover:bg-blue-700",children:"Add"})]})]}),nn&&n.jsxs("div",{className:"flex items-center justify-between mb-2",children:[n.jsxs("div",{className:"relative text-xs",children:[n.jsxs("button",{className:"flex items-center text-indigo-600 bg-panel px-2 py-1 rounded hover:bg-indigo-50",onClick:()=>or(Cn===f?null:f),children:[n.jsx(bo,{className:"w-3 h-3 mr-1"})," Auto-extract"]}),Cn===f&&n.jsxs("div",{className:"absolute right-0 mt-2 w-44 bg-panel border border-borderDark rounded-lg shadow-lg z-20",children:[n.jsxs("label",{className:"w-full block px-3 py-2 hover:bg-navySecondary cursor-pointer text-right",children:["  ",n.jsx("input",{type:"file",className:"hidden",onChange:v=>{or(null),Bi(v,f)},accept:".pdf,.jpg,.png"})]}),n.jsx("button",{className:"w-full text-right px-3 py-2 hover:bg-navySecondary",onClick:()=>Tr({mode:"EXPENSES",section:f}),children:"  OCR"})]})]}),j&&n.jsxs("span",{className:"text-xs text-indigo-500 flex items-center",children:[n.jsx(Bt,{className:"w-3 h-3 animate-spin mr-1"}),"   ,     "]})]}),n.jsxs("div",{className:"space-y-2",children:[n.jsxs("div",{className:"flex justify-between items-center bg-indigo-50 p-2 rounded border border-indigo-200",children:[n.jsxs("span",{className:"text-sm font-bold text-indigo-900",children:["Total Extracted: ",e.expensesSum||"0"]}),nn&&n.jsx("button",{onClick:()=>t({expensesItems:[],expensesSum:"0"}),className:"text-xs text-red-500 hover:underline",children:"Clear All"})]}),n.jsx("div",{className:"overflow-x-auto border rounded",children:n.jsxs("table",{className:"w-full text-sm border-collapse border-borderDark",children:[n.jsx("thead",{className:"bg-navySecondary",children:n.jsxs("tr",{children:[n.jsx("th",{className:"p-2 text-left text-textMuted",children:"Date"}),n.jsx("th",{className:"p-2 text-left text-textMuted",children:"Description"}),n.jsx("th",{className:"p-2 text-right text-textMuted",children:"Amount"}),!Ie&&n.jsx("th",{className:"p-2 w-8"})]})}),n.jsxs("tbody",{children:[e.expensesItems.length===0&&n.jsx("tr",{children:n.jsx("td",{colSpan:4,className:"p-4 text-center text-gray-400 italic",children:"No expenses added."})}),e.expensesItems.map((v,_)=>n.jsxs("tr",{className:"border-t",children:[n.jsx("td",{className:"p-2",children:v.date}),n.jsx("td",{className:"p-2",children:v.description}),n.jsxs("td",{className:"p-2 text-right",children:[v.amount," ",v.currency]}),nn&&n.jsx("td",{className:"p-2 text-center",children:n.jsx("button",{onClick:()=>Ri(v.id),className:"text-red-400 hover:text-red-600",children:n.jsx(Ht,{className:"w-3 h-3"})})})]},_))]})]})}),nn&&n.jsx("div",{className:"bg-indigo-50 p-3 rounded border",children:n.jsxs("select",{className:"w-full text-sm border p-2 rounded",value:e.paymentRecommendation||"",onChange:v=>t({paymentRecommendation:v.target.value}),children:[n.jsx("option",{value:"",children:"-- Select Recommendation --"}),n.jsx("option",{value:"The expenses are lower than the Deductible...",children:"Option A: Lower than Deductible"}),n.jsxs("option",{value:`It would be appreciated... transfer ${e.expensesSum||"..."}`,children:["Option B: Transfer Funds (",e.expensesSum," )"]})]})})]}),n.jsxs("div",{className:`border-t-2 pt-4 mt-6 ${Ie?"bg-green-50 p-4 rounded border-green-200":""}`,children:[n.jsxs("h4",{className:"font-bold text-sm text-textLight mb-2 flex items-center",children:[n.jsx(mh,{className:"w-4 h-4 mr-2"})," Tax Invoices (Appendices)"]}),(nn||!e.isWaitingForInvoices)&&n.jsxs("div",{className:"flex flex-wrap items-center gap-2 mb-2",children:[n.jsxs("button",{onClick:()=>{var v;return(v=Wn.current)==null?void 0:v.click()},className:"px-3 py-1.5 text-xs bg-navySecondary text-textLight rounded hover:bg-borderDark flex items-center gap-1",children:[n.jsx(bo,{className:"w-3 h-3"})," "]}),n.jsx("button",{onClick:()=>Tr({mode:"INVOICE"}),className:"px-3 py-1.5 text-xs bg-red-100 text-red-700 rounded hover:bg-red-200 flex items-center gap-1",children:Yt==="INVOICE"?n.jsx(Bt,{className:"w-3 h-3 animate-spin"}):" "}),n.jsx("input",{ref:Wn,type:"file",className:"hidden",multiple:!0,accept:".pdf,.doc,.docx,application/msword,application/vnd.openxmlformats-officedocument.wordprocessingml.document,application/pdf",onChange:Gt})]}),n.jsx("div",{className:"mt-2 space-y-2",children:e.invoiceFiles.map(v=>n.jsxs("div",{className:"flex items-center justify-between bg-panel p-2 rounded border shadow-sm text-xs",children:[n.jsxs("span",{className:"flex items-center",children:[n.jsx(yo,{className:"w-3 h-3 mr-2 text-blue-500"})," ",v.name]}),n.jsx("button",{onClick:()=>mn(v.id),className:"text-red-400 hover:text-red-600",children:n.jsx(Ht,{className:"w-3 h-3"})})]},v.id))})]})]}):n.jsxs("div",{className:"relative",children:[!(tn&&rt==="ENGLISH_ONLY")&&n.jsx(Bp,{className:"w-full border border-borderDark rounded-md p-4 min-h-[100px] text-right font-sans focus:ring-1 focus:ring-lpBlue outline-none transition-all",dir:"rtl",value:e.content[f]||"",onChange:v=>sn(f,v.target.value),disabled:Ie,readOnly:z,placeholder:"Type Hebrew content here...",style:{lineHeight:"1.6",textAlign:"justify"},textareaRef:(A.current[f]||(A.current[f]=ui.createRef()),A.current[f])}),tn&&n.jsxs("div",{className:rt==="ENGLISH_ONLY"?"":"mt-4 border-t pt-4",children:[n.jsxs("div",{className:"flex items-center justify-between mb-2",children:[n.jsx("label",{className:"text-xs font-bold text-textMuted uppercase block",children:"English Output (Editable)"}),a.role==="ADMIN"&&e.isTranslated&&!f.toLowerCase().includes("expenses")&&n.jsx("button",{type:"button",onClick:()=>kr(f),disabled:!!es&&es===f||!(((m=e.translatedContent)==null?void 0:m[f])||"").trim(),className:`text-[11px] px-2 py-1 rounded-full border transition ${es===f?"border-emerald-400 text-emerald-600 bg-emerald-50 cursor-wait":(((x=e.translatedContent)==null?void 0:x[f])||"").trim()?"border-emerald-500 text-emerald-700 hover:bg-emerald-50":"border-borderDark text-slate-400 cursor-not-allowed"}`,children:es===f?n.jsxs("span",{className:"inline-flex items-center gap-1",children:[n.jsx(Bt,{className:"w-3 h-3 animate-spin"}),"Improving..."]}):"Improve this section"})]}),n.jsx(Bp,{className:"w-full border border-indigo-200 rounded-md p-4 min-h-[100px] font-serif focus:ring-1 focus:ring-indigo-300 outline-none transition-all",dir:"ltr",value:((k=e.translatedContent)==null?void 0:k[f])||"",onChange:v=>Di(f,v.target.value),placeholder:"Translated text will appear here after Auto-Translate...",readOnly:z,style:{lineHeight:"1.6",textAlign:"justify"}})]})]})]},f)})}),a.role==="ADMIN"&&J&&n.jsx("div",{className:"fixed inset-0 z-[120] flex items-center justify-center bg-black/40",children:n.jsxs("div",{className:"bg-panel rounded-lg shadow-xl w-full max-w-3xl max-h-[80vh] overflow-hidden flex flex-col",children:[n.jsxs("div",{className:"px-4 py-2 border-b flex items-center justify-between",children:[n.jsx("h3",{className:"text-sm font-semibold text-textLight",children:"Manage Templates"}),n.jsx("button",{type:"button",onClick:()=>ue(!1),className:"text-textMuted hover:text-textLight",children:n.jsx(Ht,{className:"w-4 h-4"})})]}),n.jsx("div",{className:"px-4 py-3 border-b flex items-center gap-3 text-xs",children:n.jsxs("label",{className:"font-semibold text-textLight",children:["Section:",n.jsx("select",{className:"ml-2 border border-borderDark rounded px-2 py-1 text-xs",value:ce,onChange:f=>le(f.target.value),children:Or.map(f=>n.jsx("option",{value:f,children:f},f))})]})}),n.jsx("div",{className:"flex-1 overflow-y-auto px-4 py-3 space-y-3 text-xs",children:(()=>{const f=H.filter(T=>T.sectionKey===ce).sort((T,K)=>(T.orderIndex||0)-(K.orderIndex||0)||T.createdAt.localeCompare(K.createdAt));return f.length?f.map((T,K)=>n.jsxs("div",{className:"border border-borderDark rounded-md p-2 bg-slate-50 space-y-1",children:[n.jsxs("div",{className:"flex items-center justify-between gap-2",children:[n.jsx("input",{type:"text",className:"flex-1 border border-borderDark rounded px-2 py-1 text-xs",value:T.title,onChange:Z=>Ir(T.id,{title:Z.target.value})}),n.jsxs("label",{className:"flex items-center gap-1 text-[11px] text-textLight",children:[n.jsx("input",{type:"checkbox",checked:T.isEnabled!==!1,onChange:Z=>Ir(T.id,{isEnabled:Z.target.checked})}),"Enabled"]})]}),n.jsx("textarea",{className:"w-full border border-borderDark rounded px-2 py-1 text-xs mt-1",rows:3,value:T.body,onChange:Z=>Ir(T.id,{body:Z.target.value})}),n.jsxs("div",{className:"flex items-center justify-between mt-1",children:[n.jsxs("div",{className:"flex items-center gap-1",children:[n.jsx("button",{type:"button",className:"px-2 py-0.5 rounded border border-borderDark text-[11px] text-textLight hover:bg-slate-100",onClick:()=>ba(T.id,"UP"),disabled:K===0,children:""}),n.jsx("button",{type:"button",className:"px-2 py-0.5 rounded border border-borderDark text-[11px] text-textLight hover:bg-slate-100",onClick:()=>ba(T.id,"DOWN"),disabled:K===f.length-1,children:""})]}),n.jsx("button",{type:"button",className:"px-2 py-0.5 rounded border border-red-200 text-[11px] text-red-700 hover:bg-red-50",onClick:()=>{window.confirm("Delete this template?")&&ya(T.id)},children:"Delete"})]})]},T.id)):n.jsx("p",{className:"text-[11px] text-textMuted",children:"No templates defined yet for this section."})})()})]})}),a.role==="ADMIN"&&Ke&&n.jsx("div",{className:"fixed inset-0 z-[120] flex items-center justify-center bg-black/40",children:n.jsxs("div",{className:"bg-panel rounded-lg shadow-xl w-full max-w-3xl max-h-[80vh] overflow-hidden flex flex-col",children:[n.jsxs("div",{className:"px-4 py-2 border-b flex items-center justify-between",children:[n.jsx("h3",{className:"text-sm font-semibold text-textLight",children:"Manage Best Practices"}),n.jsx("button",{type:"button",onClick:()=>dt(!1),className:"text-textMuted hover:text-textLight",children:n.jsx(Ht,{className:"w-4 h-4"})})]}),n.jsx("div",{className:"px-4 py-3 border-b flex items-center gap-3 text-xs",children:n.jsxs("label",{className:"font-semibold text-textLight",children:["Section:",n.jsx("select",{className:"ml-2 border border-borderDark rounded px-2 py-1 text-xs",value:Ue,onChange:f=>st(f.target.value),children:Or.map(f=>n.jsx("option",{value:f,children:f},f))})]})}),n.jsx("div",{className:"flex-1 overflow-y-auto px-4 py-3 space-y-3 text-xs",children:(()=>{const f=Q.filter(T=>T.sectionKey===Ue).sort((T,K)=>{const Z=T.label==="LLOYDS_RECOMMENDED"?0:1,de=K.label==="LLOYDS_RECOMMENDED"?0:1;if(Z!==de)return Z-de;const d=T.usageCount||0;return(K.usageCount||0)-d});return f.length?f.map(T=>n.jsxs("div",{className:"border border-borderDark rounded-md p-2 bg-slate-50 space-y-1",children:[n.jsxs("div",{className:"flex items-center justify-between gap-2",children:[n.jsx("input",{type:"text",className:"flex-1 border border-borderDark rounded px-2 py-1 text-xs",value:T.title,onChange:K=>Cr(T.id,{title:K.target.value})}),n.jsxs("select",{className:"border border-borderDark rounded px-2 py-1 text-[11px]",value:T.label,onChange:K=>Cr(T.id,{label:K.target.value==="LLOYDS_RECOMMENDED"?"LLOYDS_RECOMMENDED":"BEST_PRACTICE"}),children:[n.jsx("option",{value:"BEST_PRACTICE",children:"Best practice"}),n.jsx("option",{value:"LLOYDS_RECOMMENDED",children:"Lloyds recommended"})]}),n.jsxs("label",{className:"flex items-center gap-1 text-[11px] text-textLight",children:[n.jsx("input",{type:"checkbox",checked:T.isEnabled!==!1,onChange:K=>Uo(T.id,K.target.checked)}),"Enabled"]})]}),n.jsx("textarea",{className:"w-full border border-borderDark rounded px-2 py-1 text-xs mt-1",rows:3,value:T.body,onChange:K=>Cr(T.id,{body:K.target.value})}),n.jsx("input",{type:"text",className:"w-full border border-borderDark rounded px-2 py-1 text-[11px] mt-1",placeholder:"Tags (comma separated)",value:(T.tags||[]).join(", "),onChange:K=>Cr(T.id,{tags:K.target.value.split(",").map(Z=>Z.trim()).filter(Boolean)})}),n.jsxs("div",{className:"flex items-center justify-between mt-1",children:[n.jsxs("div",{className:"flex items-center gap-2 text-[10px] text-textMuted",children:[n.jsxs("span",{children:["Usage: ",T.usageCount||0]}),T.lastUsedAt&&n.jsxs("span",{children:["Last used:"," ",new Date(T.lastUsedAt).toLocaleString("he-IL",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"})]})]}),n.jsx("button",{type:"button",className:"px-2 py-0.5 rounded border border-red-200 text-[11px] text-red-700 hover:bg-red-50",onClick:()=>{window.confirm("Delete this best practice?")&&Ho(T.id)},children:"Delete"})]})]},T.id)):n.jsx("p",{className:"text-[11px] text-textMuted",children:"No best practices defined yet for this section."})})()})]})}),he&&n.jsx("div",{className:"fixed inset-0 z-[120] flex items-center justify-center bg-black/40",children:n.jsxs("div",{className:"bg-panel rounded-lg shadow-xl w-full max-w-3xl max-h-[80vh] overflow-hidden flex flex-col",children:[n.jsxs("div",{className:"px-4 py-2 border-b flex items-center justify-between",children:[n.jsx("h3",{className:"text-sm font-semibold text-textLight",children:" "}),n.jsx("button",{type:"button",onClick:()=>{Ce(!1),Re(null)},className:"text-textMuted hover:text-textLight",children:n.jsx(Ht,{className:"w-4 h-4"})})]}),n.jsxs("div",{className:"flex-1 overflow-y-auto px-4 py-3 space-y-4 text-xs",children:[n.jsxs("div",{className:"flex items-center justify-between gap-2",children:[n.jsx("p",{className:"text-[11px] text-textMuted",children:"          ."}),n.jsx("button",{type:"button",className:"px-3 py-1.5 rounded bg-sky-600 text-white text-[11px] font-semibold hover:bg-sky-700",onClick:()=>Re({id:void 0,title:"",sectionKey:"",tagsInput:"",body:""}),children:" "})]}),V.length===0&&n.jsx("p",{className:"text-[11px] text-textMuted",children:'    .     " ".'}),V.length>0&&n.jsxs("div",{className:"space-y-2",children:[n.jsx("h4",{className:"text-[11px] font-semibold text-textLight",children:" "}),n.jsx("div",{className:"space-y-1",children:V.slice().sort((f,T)=>(T.updatedAt||T.createdAt).localeCompare(f.updatedAt||f.createdAt)).map(f=>n.jsxs("div",{className:"flex items-center justify-between gap-2 border border-borderDark rounded-md px-2 py-1 bg-slate-50",children:[n.jsx("div",{className:"flex-1 min-w-0 text-right",children:n.jsxs("div",{className:"flex flex-wrap items-center justify-end gap-1",children:[n.jsx("span",{className:"font-semibold text-textLight truncate",children:f.title}),f.sectionKey&&n.jsx("span",{className:"inline-flex items-center rounded-full px-2 py-0.5 text-[9px] bg-slate-100 text-textLight",children:f.sectionKey}),f.tags&&f.tags.length>0&&n.jsx("span",{className:"inline-flex items-center rounded-full px-2 py-0.5 text-[9px] bg-slate-100 text-textLight",children:f.tags.join(", ")})]})}),n.jsxs("div",{className:"flex items-center gap-1",children:[n.jsx("button",{type:"button",className:"px-2 py-0.5 rounded border border-borderDark text-[11px] text-textLight hover:bg-slate-100",onClick:()=>Re({id:f.id,title:f.title,sectionKey:f.sectionKey||"",tagsInput:(f.tags||[]).join(", "),body:f.body}),children:""}),n.jsx("button",{type:"button",className:"px-2 py-0.5 rounded border border-red-200 text-[11px] text-red-700 hover:bg-red-50",onClick:()=>{if(window.confirm("Delete this personal snippet?")){const T=Mp(a.id,f.id);ie(T),ae&&ae.id===f.id&&Re(null)}},children:""})]})]},f.id))})]}),ae&&n.jsxs("form",{className:"border-t border-borderDark pt-3 space-y-3",onSubmit:f=>{f.preventDefault();const T=ae.title.trim(),K=ae.body.trim();if(!T||!K)return;const Z=ae.tagsInput.split(",").map(d=>d.trim()).filter(Boolean)||[],de=bv(a.id,{id:ae.id,title:T,body:K,sectionKey:ae.sectionKey||void 0,tags:Z});ie(de),Re(null)},children:[n.jsx("h4",{className:"text-[11px] font-semibold text-textLight",children:ae.id?" ":" "}),n.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-2",children:[n.jsxs("div",{className:"space-y-1",children:[n.jsx("label",{className:"block font-semibold text-textLight",children:""}),n.jsx("input",{type:"text",className:"w-full border border-borderDark rounded px-2 py-1 text-xs",value:ae.title,onChange:f=>Re(T=>T&&{...T,title:f.target.value}),required:!0})]}),n.jsxs("div",{className:"space-y-1",children:[n.jsx("label",{className:"block font-semibold text-textLight",children:" ()"}),n.jsxs("select",{className:"w-full border border-borderDark rounded px-2 py-1 text-xs",value:ae.sectionKey,onChange:f=>Re(T=>T&&{...T,sectionKey:f.target.value}),children:[n.jsx("option",{value:"",children:" "}),Or.map(f=>n.jsx("option",{value:f,children:f},f))]})]})]}),n.jsxs("div",{className:"space-y-1",children:[n.jsx("label",{className:"block font-semibold text-textLight",children:" (,  )"}),n.jsx("input",{type:"text",className:"w-full border border-borderDark rounded px-2 py-1 text-xs",value:ae.tagsInput,onChange:f=>Re(T=>T&&{...T,tagsInput:f.target.value})})]}),n.jsxs("div",{className:"space-y-1",children:[n.jsx("label",{className:"block font-semibold text-textLight",children:" "}),n.jsx("textarea",{className:"w-full border border-borderDark rounded px-2 py-1 text-xs",rows:5,value:ae.body,onChange:f=>Re(T=>T&&{...T,body:f.target.value})})]}),n.jsxs("div",{className:"flex items-center justify-end gap-2 pt-2 border-t border-borderDark",children:[n.jsx("button",{type:"button",className:"px-3 py-1.5 rounded border border-borderDark text-[11px] text-textLight hover:bg-slate-100",onClick:()=>Re(null),children:""}),n.jsx("button",{type:"submit",className:"px-3 py-1.5 rounded bg-sky-600 text-white text-[11px] font-semibold hover:bg-sky-700",children:""})]})]})]})]})}),a.role==="ADMIN"&&Rt&&n.jsx("div",{className:"fixed inset-0 z-[130] flex items-center justify-center bg-black/40",children:n.jsxs("div",{className:"bg-panel rounded-lg shadow-xl w-full max-w-md max-h-[80vh] overflow-hidden flex flex-col",children:[n.jsxs("div",{className:"px-4 py-2 border-b flex items-center justify-between",children:[n.jsx("h3",{className:"text-sm font-semibold text-textLight",children:"Save Best Practice"}),n.jsx("button",{type:"button",onClick:Na,className:"text-textMuted hover:text-textLight",children:n.jsx(Ht,{className:"w-4 h-4"})})]}),n.jsx(Ev,{onSubmit:Bo,onCancel:Na,initialTitle:Rt.body.split(/\s+/).slice(0,6).join(" ")})]})}),n.jsxs("div",{className:"flex justify-between pt-4",children:[n.jsxs("button",{onClick:s,className:"flex items-center text-textMuted px-4 py-2 hover:bg-navySecondary rounded",children:[n.jsx(ei,{className:"mr-2 w-4 h-4"})," Back"]}),n.jsxs("button",{onClick:r,className:"flex items-center bg-navy text-white px-6 py-2 rounded hover:bg-navySecondary transition",children:["Next Step ",n.jsx(is,{className:"ml-2 w-4 h-4"})]})]})]})]})},Uv=({onClose:e,onSubmit:t,currentUser:s,favoriteProviders:r=[],onSaveFavorite:a})=>{const o=s.role==="LAWYER",[l,c]=g.useState(o?s.id:""),[i,u]=g.useState(""),[p,y]=g.useState(""),[N,w]=g.useState(null),[R,E]=g.useState([{id:Ln(),category:"EXPERT_OUR",serviceProvider:"",amount:""}]),[W,b]=g.useState([]),h=4,S=async()=>{if(!l||!p)return;let j=null;const F=L=>t({lawyerId:l,instructions:i,odakanitNo:p,file:L,worksheet:R,invoiceFiles:W});if(N){const L=new FileReader;L.onload=O=>{var H;j={name:N.name,type:N.type,data:((H=O.target)==null?void 0:H.result).split(",")[1]},F(j)},L.readAsDataURL(N)}else F()},P=async j=>{const F=j.target.files;if(!F)return;if(W.length>=h){alert("   4 ."),j.target.value="";return}const L=Array.from(F).slice(0,h-W.length),O=await Promise.all(L.map(H=>new Promise(M=>{const I=new FileReader;I.onload=D=>{var J;return M({id:`inv-${Date.now()}-${Math.random().toString(36).slice(2,6)}`,name:H.name,data:((J=D.target)==null?void 0:J.result).split(",")[1],type:H.type})},I.readAsDataURL(H)})));b(H=>[...H,...O]),j.target.value=""},U=j=>{b(F=>F.filter(L=>L.id!==j))},z=(j,F,L)=>{E(O=>O.map(H=>H.id===j?{...H,[F]:L}:H))},q=j=>{const F=ds.find(L=>L.type===j)||ds[0];E(L=>[...L,{id:Ln(),category:F.value,serviceProvider:"",amount:"",customLabel:""}])},ee=j=>{E(F=>F.length===1?F:F.filter(L=>L.id!==j))},G=Fd(R,s),se=ii(G);return n.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-[200]",children:n.jsxs("div",{className:"bg-panel p-6 rounded-lg shadow-xl w-96 animate-scale-in",children:[n.jsx("h3",{className:"font-bold text-lg mb-4 text-textLight",children:o?"  ":"Open New Finance Case"}),n.jsxs("div",{className:"space-y-3",children:[n.jsxs("div",{children:[n.jsx("label",{className:"block text-xs font-bold text-textMuted",children:"Internal Case # (Odakanit)"}),n.jsx("input",{className:"w-full border p-2 rounded",value:p,onChange:j=>y(j.target.value),placeholder:"e.g. 55492"})]}),!o&&n.jsxs(n.Fragment,{children:[n.jsxs("div",{children:[n.jsx("label",{className:"block text-xs font-bold text-textMuted",children:"Assign Lawyer"}),n.jsxs("select",{className:"w-full border p-2 rounded",value:l,onChange:j=>c(j.target.value),children:[n.jsx("option",{value:"",children:"-- Select --"}),js.filter(j=>j.role==="LAWYER").map(j=>n.jsx("option",{value:j.id,children:j.name},j.id))]})]}),n.jsxs("div",{children:[n.jsx("label",{className:"block text-xs font-bold text-textMuted",children:"Instructions"}),n.jsx(go,{clientId:So,children:n.jsx("textarea",{className:"w-full border p-2 rounded",rows:3,value:i,onChange:j=>u(j.target.value),placeholder:"Notes for lawyer..."})})]}),n.jsxs("div",{children:[n.jsx("label",{className:"block text-xs font-bold text-textMuted",children:"Attach Expenses File"}),n.jsx("input",{type:"file",onChange:j=>{var F;return w(((F=j.target.files)==null?void 0:F[0])||null)},className:"text-xs"})]}),n.jsxs("div",{className:"border rounded-lg p-3 bg-amber-50",children:[n.jsxs("div",{className:"flex justify-between items-center mb-2",children:[n.jsx("label",{className:"block text-xs font-bold text-amber-700",children:"Expense Worksheet"}),n.jsxs("div",{className:"flex gap-2 text-xs text-amber-700 font-semibold",children:[n.jsx("button",{type:"button",onClick:()=>q("EXPENSE"),className:"hover:underline",children:"+ Expense"}),n.jsx("button",{type:"button",onClick:()=>q("ADJUSTMENT"),className:"hover:underline",children:"+ Adjustment"})]})]}),n.jsx("div",{className:"space-y-2 max-h-48 overflow-auto pr-1",children:R.map(j=>{const F=ds.find(M=>M.value===j.category),L=(F==null?void 0:F.type)!=="ADJUSTMENT",O=r.filter(M=>M.category===j.category||M.category==="OTHER"),H=Fd([j],s)[0];return n.jsxs("div",{className:"border border-amber-100 bg-panel rounded-lg p-2 space-y-2",children:[n.jsxs("div",{children:[n.jsx("label",{className:"block text-[10px] font-bold text-textMuted",children:"Expense Details"}),n.jsx("select",{value:j.category,onChange:M=>z(j.id,"category",M.target.value),className:"w-full border rounded text-xs p-2",children:ds.map(M=>n.jsx("option",{value:M.value,children:M.label},M.value))})]}),j.category==="OTHER"&&n.jsxs("div",{children:[n.jsx("label",{className:"block text-[10px] font-bold text-textMuted",children:"Custom Label"}),n.jsx("input",{className:"w-full border rounded text-xs p-2",placeholder:"Describe expense",value:j.customLabel||"",onChange:M=>z(j.id,"customLabel",M.target.value)})]}),L&&n.jsxs("div",{children:[n.jsx("label",{className:"block text-[10px] font-bold text-textMuted",children:"Service Provider"}),n.jsx("input",{list:`provider-${j.id}`,className:"w-full border rounded text-xs p-2",placeholder:"Provider name",value:j.serviceProvider,onChange:M=>z(j.id,"serviceProvider",M.target.value)}),n.jsx("datalist",{id:`provider-${j.id}`,children:O.map(M=>n.jsx("option",{value:M.serviceProvider,children:M.label},M.id))}),n.jsx("button",{type:"button",onClick:()=>a&&j.serviceProvider.trim()&&a({id:Ln(),category:j.category,label:(H==null?void 0:H.label)||"Expense",serviceProvider:j.serviceProvider.trim()}),className:"text-[10px] text-amber-600 hover:underline mt-1",children:"Save to favorites"})]}),n.jsxs("div",{children:[n.jsx("label",{className:"block text-[10px] font-bold text-textMuted",children:"Cost ()"}),n.jsx("input",{type:"number",min:"0",className:"w-full border rounded text-xs p-2",placeholder:"",value:j.amount,onChange:M=>z(j.id,"amount",M.target.value)})]}),n.jsx("div",{className:"text-right",children:n.jsx("button",{type:"button",onClick:()=>ee(j.id),className:"text-[10px] text-red-500 hover:underline",children:"Remove"})})]},j.id)})}),n.jsxs("div",{className:"text-right text-xs font-bold text-amber-800 mt-2",children:["Total balance preview: ",se.totalBalance.toLocaleString()]})]}),n.jsxs("div",{className:"border rounded-lg p-3 bg-panel",children:[n.jsxs("div",{className:"flex justify-between items-center mb-2",children:[n.jsx("label",{className:"block text-xs font-bold text-textLight",children:"Tax Invoices (PDF / Word)"}),n.jsxs("span",{className:"text-[11px] text-textMuted",children:[W.length,"/",h]})]}),n.jsxs("label",{className:"flex flex-col items-center justify-center w-full h-24 border-2 border-borderDark border-dashed rounded-lg cursor-pointer bg-panel hover:bg-navySecondary",children:[n.jsxs("div",{className:"flex flex-col items-center justify-center pt-5 pb-6",children:[n.jsx(bo,{className:"w-6 h-6 text-gray-400 mb-2"}),n.jsx("p",{className:"text-xs text-textMuted",children:"   ( 4 )"})]}),n.jsx("input",{type:"file",className:"hidden",multiple:!0,accept:".pdf,.doc,.docx,application/msword,application/vnd.openxmlformats-officedocument.wordprocessingml.document,application/pdf",onChange:P})]}),n.jsxs("div",{className:"mt-2 space-y-2 max-h-32 overflow-auto",children:[W.map(j=>n.jsxs("div",{className:"flex items-center justify-between bg-navySecondary p-2 rounded border text-xs",children:[n.jsxs("span",{className:"flex items-center gap-2 text-textLight",children:[n.jsx(yo,{className:"w-3 h-3 text-blue-500"}),j.name]}),n.jsx("button",{type:"button",onClick:()=>U(j.id),className:"text-red-400 hover:text-red-600",children:n.jsx(Ht,{className:"w-3 h-3"})})]},j.id)),W.length===0&&n.jsx("p",{className:"text-xs text-gray-400 text-center",children:"   ."})]})]})]}),o&&n.jsx("p",{className:"text-xs text-textMuted",children:"    .    ."}),n.jsx("button",{onClick:S,className:"w-full bg-indigo-600 text-white py-2 rounded font-bold mt-2 hover:bg-indigo-700",children:o?"Create Personal Folder":"Create Folder"}),n.jsx("button",{onClick:e,className:"w-full text-textMuted text-sm hover:underline mt-1",children:"Cancel"})]})]})})},Wv=({user:e,reports:t,onSelectReport:s,onNewReport:r,onLogout:a,onUpdateReport:o,onDeleteReport:l,onFinanceTaskCreate:c,onNotifyLawyerFromFinance:i,onSheetDeleted:u,caseTemplates:p=[],onStartTemplate:y,onStartNextReport:N,archiveAfterMs:w,favoriteProviders:R={},onSaveFavorite:E,onDeleteFavorite:W,onOpenWorksheet:b,onRequestReminder:h,onRequestNote:S,onSoftDeleteReport:P,onRestoreReport:U,notifications:z=[],showNotifications:q,setShowNotifications:ee,onClearNotifications:G,dailySummaryOptIn:se,setDailySummaryOptIn:j,caseFolders:F,onOpenCaseFolder:L,onOpenAssistant:O})=>{const H=e.role==="ADMIN"||e.role==="SUB_ADMIN"||e.role==="FINANCE",M=e.role==="LAWYER"||e.role==="SUB_ADMIN"||e.role==="FINANCE",[I,D]=g.useState(!1),[J,ue]=g.useState(!1),[ce,le]=g.useState(!1),[fe,Ee]=g.useState(!1),[ve,$e]=g.useState({category:"EXPERT_OUR",label:"",provider:""}),[Ze,Oe]=g.useState(""),[Ye,ot]=g.useState(null),X=e.role==="ADMIN",ne=e.role==="SUB_ADMIN"||e.role==="FINANCE";if(e.role==="FINANCE"){const A=ge=>{o(ge,{isPaid:!0})};return n.jsx(tv,{user:e,reports:t,onLogout:a,onNotifyLawyer:i,onMarkReportPaid:A,onSheetDeleted:u,onOpenAssistant:()=>O&&O(),caseFolders:F})}if(!H&&e.role==="LAWYER")return n.jsx(xN,{user:e,reports:t,caseFolders:F||{},notifications:z,showNotifications:q,setShowNotifications:ee,onClearNotifications:G,dailySummaryOptIn:se,setDailySummaryOptIn:j,archiveAfterMs:w,onSelectReport:s,onNewReport:r,onOpenCaseFolder:L,onLogout:a,deleteReportById:l});const C=Date.now(),re=w??Number.MAX_SAFE_INTEGER,te=A=>A.status==="SENT"&&A.sentAt&&C-new Date(A.sentAt).getTime()>=re,pe=H?t:t.filter(A=>A.createdBy===e.id),Be=pe.filter(te),je=pe.filter(A=>!te(A)&&!A.deletedAt),Te=pe.filter(A=>A.deletedAt&&C-new Date(A.deletedAt).getTime()<zh),et=pe.filter(A=>!A.deletedAt),Ve=X?je:M?et:pe,He=X?Be:M?Te:[],Q=H?[]:t.filter(A=>A.status==="READY_TO_SEND"&&A.createdBy===e.id&&!A.deletedAt),be=H?[]:t.filter(A=>["TASK_ASSIGNED","WAITING_FOR_INVOICES"].includes(A.status)&&A.createdBy===e.id&&!A.deletedAt),xe=A=>{var ge;if((ge=A.reportHistory)!=null&&ge.length)return A.reportHistory;if(A.status==="SENT"){const Pe=A.sentAt||A.reportDate||new Date().toISOString();return[{id:`${A.id}-legacy`,reportNumber:1,subject:`${A.insurerName||"Report"}${A.insuredName?` - ${A.insuredName}`:""}`,date:Pe,sent:!0}]}return[]},Ne=H?[]:t.filter(A=>A.createdBy===e.id&&!A.deletedAt).flatMap(A=>{const ge=xe(A);return ge.length?ge.map((Pe,Ie)=>{var mt;return{parent:A,entry:Pe,reportNumber:Pe.reportNumber||Ie+1,sentAt:Pe.date||((mt=Pe.snapshot)==null?void 0:mt.createdAt)||A.sentAt,isLatest:Ie===ge.length-1}}):[]}).sort((A,ge)=>{const Pe=A.sentAt?new Date(A.sentAt).getTime():0;return(ge.sentAt?new Date(ge.sentAt).getTime():0)-Pe}),Fe=A=>{const ge=xe(A),Pe=ge[ge.length-1],Ie=(Pe==null?void 0:Pe.date)||A.sentAt;return Ie?new Date(Ie).getTime():0},Le=H?[]:t.filter(A=>A.createdBy!==e.id||A.deletedAt||A.status!=="SENT"?!1:xe(A).length>0).sort((A,ge)=>Fe(ge)-Fe(A)),Ke=H?[]:[{id:"ready",title:"  ",subtitle:"    ",items:Q,empty:"   .",actionLabel:" ",action:A=>s(A.id),tone:"border-red-100"},{id:"finance",title:"   ",subtitle:"  /   ",items:be,empty:"   .",actionLabel:" ",action:A=>s(A.id),tone:"border-amber-100"},{id:"followup",title:'"  ',subtitle:' "    "   ',items:Le,empty:' "   .',actionLabel:'" ',action:N?A=>N(A.id):void 0,tone:"border-blue-100"},{id:"sent",title:" ",subtitle:'      "   ',items:Ne,empty:"     .",tone:"border-green-100"}],dt=H?t.filter(A=>A.odakanitNo&&!A.deletedAt):[],Ue=(R==null?void 0:R[e.id])||[],st=()=>{if(!ve.provider.trim())return;const A=ds.find(Pe=>Pe.value===ve.category),ge=ve.label.trim()||(A==null?void 0:A.label)||"Favorite provider";E&&E(e.id,{id:Ln(),category:ve.category,label:ge,serviceProvider:ve.provider.trim()}),$e({category:ve.category,label:"",provider:""})},Rt=A=>{W&&W(e.id,A)};p.filter(A=>A.ownerId===e.id);const yt=t.filter(A=>zp(A)&&!A.deletedAt),V=e.role==="FINANCE"||e.role==="SUB_ADMIN",ie=X||M,_e=X?`Items move here ${w/(1e3*60*60)}h after sending and are deleted after ${Wh/(1e3*60*60*24)} days.`:M?"     7    .":"",Me=yt.filter(A=>!["READY_TO_SEND","SENT"].includes(A.status)),he=yt.filter(A=>A.status==="READY_TO_SEND"),Ce=yt.filter(A=>A.status==="SENT"),ae=Ce.reduce((A,ge)=>A+Wp(ge),0),Re=A=>A==="SENT"?"bg-gold/20 text-goldLight border-gold":A==="READY_TO_SEND"?"bg-danger/30 text-red-300 border-danger":"bg-navySecondary text-textMuted border-borderDark",rt=A=>A==="READY_TO_SEND"?"READY TO SEND":A.replace(/_/g," "),Zt=A=>{o(A,{isPaid:!0})},Ge=ce?He:Ve,ft=A=>{const ge=A.createdBy||"unknown",Pe=A.odakanitNo||A.marketRef||A.id||"unknown",Ie=(A.plaintiffName||"unknown").toLowerCase();return`${ge}::${Pe}::${Ie}`},Yt=V?Ge.filter(zp):Ge,en=new Set((V?[]:Ge).map(A=>ft(A))),Ds=!H&&!V?p.filter(A=>A.ownerId===e.id&&!en.has(A.caseKey)).map(A=>({id:`template-${A.caseKey}`,createdBy:A.ownerId,ownerName:A.ownerName,reportDate:A.lastUpdated,status:"TASK_ASSIGNED",recipientId:"1",insurerName:A.insurerName||"",lineSlipNo:A.lineSlipNo||"",marketRef:A.marketRef||"",insuredName:A.insuredName||"",plaintiffName:A.plaintiffName||"",plaintiffTitle:A.plaintiffTitle||"Plaintiff",odakanitNo:A.odakanitNo,selectedTimeline:"standard",filenameTag:hh[0],selectedSections:["Update"],content:{},translatedContent:{},expertSummaryMode:{},invoiceFiles:[],isWaitingForInvoices:!1,isTranslated:!1,expensesItems:[],expenseWorksheet:$s(),reportNotes:[],__templateKey:A.caseKey})):[],fs=V?Yt:[...Yt,...Ds],Cn=Ze.trim().toLowerCase(),or=A=>Cn?`${A.odakanitNo||""} ${A.insuredName||""} ${A.plaintiffName||""} ${A.ownerName||""}`.toLowerCase().includes(Cn):!0,es=Cn?fs.filter(or):fs,Un=V?[]:(()=>{const A=new Map;return es.forEach(ge=>{if(ge.__templateKey)return;const Pe=ge.odakanitNo||ge.marketRef||ge.insuredName||ge.id,Ie=ge.reportDate?new Date(ge.reportDate).getTime():0,mt=A.get(Pe);mt?(mt.reports.push(ge),Ie>mt.latestDate&&(mt.latestDate=Ie),!mt.caseLabel&&(ge.insuredName||ge.plaintiffName)&&(mt.caseLabel=ge.insuredName||ge.plaintiffName||mt.caseLabel),!mt.insuredName&&ge.insuredName&&(mt.insuredName=ge.insuredName),!mt.plaintiffName&&ge.plaintiffName&&(mt.plaintiffName=ge.plaintiffName)):A.set(Pe,{key:Pe,odakanitNo:ge.odakanitNo||"",caseLabel:ge.insuredName||ge.plaintiffName||ge.marketRef||"",insuredName:ge.insuredName||"",plaintiffName:ge.plaintiffName||"",reports:[ge],latestDate:Ie})}),Array.from(A.values()).sort((ge,Pe)=>Pe.latestDate-ge.latestDate)})(),xs=A=>!["READY_TO_SEND","SENT"].includes(A.status),Wn=A=>{if(!xs(A)){alert("      -READY TO SEND  .");return}const ge=A.insuredName||A.plaintiffName||A.odakanitNo||A.id;window.confirm(`  " "${ge}"?    .`)&&l&&l(A.id)};return g.useEffect(()=>{Ye&&(Un.some(A=>A.key===Ye)||ot(null))},[Ye,Un]),n.jsxs("div",{className:"min-h-screen bg-bgDark p-6 relative",children:[J&&n.jsx(kv,{onClose:()=>ue(!1)}),I&&n.jsx(Uv,{currentUser:e,onClose:()=>D(!1),onSubmit:A=>{c(A),D(!1)},favoriteProviders:R[e.id]||[],onSaveFavorite:A=>E&&E(e.id,A)}),fe&&n.jsx("div",{className:"fixed inset-0 bg-black/40 flex items-center justify-center z-[200] p-4",children:n.jsxs("div",{className:"bg-panel rounded-2xl shadow-2xl w-full max-w-2xl p-6 space-y-4",children:[n.jsxs("div",{className:"flex items-center justify-between",children:[n.jsxs("h3",{className:"text-lg font-bold text-textLight flex items-center gap-2",children:[n.jsx(z0,{className:"w-4 h-4 text-amber-500"}),"   "]}),n.jsx("button",{onClick:()=>Ee(!1),className:"text-textMuted hover:text-textLight",children:n.jsx(Ht,{className:"w-5 h-5"})})]}),n.jsxs("div",{className:"grid md:grid-cols-3 gap-3",children:[n.jsxs("div",{children:[n.jsx("label",{className:"block text-xs font-bold text-textMuted mb-1",children:""}),n.jsx("select",{value:ve.category,onChange:A=>$e({...ve,category:A.target.value}),className:"w-full border rounded text-sm p-2",children:ds.filter(A=>A.type==="EXPENSE").map(A=>n.jsx("option",{value:A.value,children:A.label},A.value))})]}),n.jsxs("div",{children:[n.jsx("label",{className:"block text-xs font-bold text-textMuted mb-1",children:" "}),n.jsx("input",{className:"w-full border rounded text-sm p-2",value:ve.label,onChange:A=>$e({...ve,label:A.target.value}),placeholder:":  "})]}),n.jsxs("div",{children:[n.jsx("label",{className:"block text-xs font-bold text-textMuted mb-1",children:" "}),n.jsx("input",{className:"w-full border rounded text-sm p-2",value:ve.provider,onChange:A=>$e({...ve,provider:A.target.value}),placeholder:'"  '})]})]}),n.jsx("div",{className:"text-right",children:n.jsx("button",{onClick:st,className:"bg-amber-500 text-white px-4 py-2 rounded font-bold hover:bg-amber-600",children:" "})}),n.jsxs("div",{className:"max-h-64 overflow-y-auto border rounded-lg divide-y",children:[Ue.length===0&&n.jsx("p",{className:"text-sm text-gray-400 text-center py-6",children:"   ."}),Ue.map(A=>n.jsxs("div",{className:"p-3 flex items-center justify-between",children:[n.jsxs("div",{children:[n.jsx("p",{className:"text-sm font-bold text-textLight",children:A.label}),n.jsx("p",{className:"text-xs text-textMuted",children:A.serviceProvider})]}),n.jsx("button",{onClick:()=>Rt(A.id),className:"text-xs text-red-500 hover:underline",children:""})]},A.id))]})]})}),n.jsxs("div",{className:"w-full px-6 md:px-8 lg:px-10 xl:px-12",children:[n.jsxs("div",{className:"flex justify-between items-center mb-8",children:[n.jsxs("div",{children:[n.jsx("h1",{className:"text-3xl font-serif font-bold text-lpBlue",children:"Lior Perry Law Office"}),n.jsxs("p",{className:"text-textMuted",children:["Welcome back, ",n.jsx("span",{className:"font-bold",children:e.name})," (",e.role,")"]})]}),n.jsxs("div",{className:"flex items-center gap-3 flex-wrap justify-end",children:[ie&&n.jsxs("button",{onClick:()=>le(A=>!A),className:`flex items-center px-4 py-2 rounded shadow text-sm font-bold ${ce?"bg-gray-300 text-textLight":"bg-borderDark text-textLight"} hover:bg-borderDark`,children:[n.jsx(Ws,{className:"w-4 h-4 mr-2"})," ",ce?"Back to Reports":`Recycle Bin (${He.length})`]}),n.jsxs("button",{onClick:()=>D(!0),className:"flex items-center bg-indigo-600 text-white px-4 py-2 rounded shadow hover:bg-indigo-700 font-bold",children:[n.jsx(Mu,{className:"w-4 h-4 mr-2"})," Open New Case Folder"]}),n.jsxs("button",{type:"button",onClick:()=>O&&O(),className:"flex items-center text-indigo-700 bg-indigo-50 px-3 py-2 rounded hover:bg-indigo-100",children:[n.jsx(ia,{className:"w-4 h-4 mr-2"}),"  "]}),n.jsxs("div",{className:"relative",children:[n.jsxs("button",{onClick:()=>ee(A=>!A),className:"flex items-center text-blue-600 bg-blue-50 px-3 py-2 rounded hover:bg-blue-100 relative",children:[n.jsx(Zl,{className:"w-4 h-4 mr-2"})," Notifications",z.length>0&&n.jsx("span",{className:"absolute -top-2 -right-2 bg-red-500 text-white text-[10px] rounded-full px-1",children:z.length})]}),q&&n.jsxs("div",{className:"absolute right-0 mt-2 w-80 bg-panel border border-borderDark shadow-xl rounded-lg z-50",children:[n.jsxs("div",{className:"flex items-center justify-between px-3 py-2 border-b",children:[n.jsx("span",{className:"text-sm font-bold text-textLight",children:"Smart Notifications"}),n.jsxs("label",{className:"text-xs text-textMuted flex items-center gap-1",children:[n.jsx("input",{type:"checkbox",checked:se,onChange:A=>j(A.target.checked)}),"Daily summary"]})]}),n.jsxs("div",{className:"max-h-64 overflow-auto divide-y",children:[z.length===0&&n.jsx("div",{className:"p-4 text-xs text-gray-400 text-center",children:"No notifications yet."}),z.map(A=>n.jsxs("div",{className:"p-3 text-sm",children:[n.jsx("p",{className:"font-medium text-textLight",children:A.message}),n.jsx("p",{className:"text-[10px] text-gray-400",children:new Date(A.createdAt).toLocaleString()})]},A.id))]}),n.jsx("div",{className:"px-3 py-2 text-right text-xs",children:n.jsx("button",{onClick:G,className:"text-red-500 hover:underline",children:"Clear all"})})]})]}),n.jsxs("button",{onClick:()=>ue(!0),className:"flex items-center text-blue-600 bg-blue-50 px-3 py-2 rounded hover:bg-blue-100",children:[n.jsx(Lu,{className:"w-4 h-4 mr-2"})," "]}),!1,n.jsxs("button",{onClick:a,className:"flex items-center text-red-600 hover:bg-red-50 px-4 py-2 rounded",children:[n.jsx(uh,{className:"w-4 h-4 mr-2"})," Logout"]})]})]}),H&&n.jsx(Av,{reports:t,currentUser:e,onMarkPaid:Zt}),ne&&n.jsxs("div",{className:"mb-8 bg-panel border border-amber-200 rounded-2xl shadow p-6 space-y-4",children:[n.jsxs("div",{className:"flex items-center justify-between flex-wrap gap-3",children:[n.jsxs("div",{children:[n.jsxs("h3",{className:"text-lg font-bold text-amber-700 flex items-center gap-2",children:[n.jsx(mh,{className:"w-5 h-5"})," Expenses Overview"]}),n.jsx("p",{className:"text-sm text-textMuted",children:"Tracking all reports that include expense tables."})]}),n.jsxs("div",{className:"flex items-center gap-4 text-sm",children:[n.jsx("button",{onClick:()=>Ee(!0),className:"text-xs text-amber-700 underline hover:text-amber-900",children:"Manage Favorite Providers"}),n.jsxs("div",{className:"text-center",children:[n.jsx("p",{className:"text-xs uppercase text-gray-400",children:"Assigned to Lawyers"}),n.jsx("p",{className:"text-xl font-bold text-amber-700",children:Me.length})]}),n.jsxs("div",{className:"text-center",children:[n.jsx("p",{className:"text-xs uppercase text-gray-400",children:"Waiting for Lior"}),n.jsx("p",{className:"text-xl font-bold text-blue-600",children:he.length})]}),n.jsxs("div",{className:"text-center",children:[n.jsx("p",{className:"text-xs uppercase text-gray-400",children:"Sent to Insurer"}),n.jsx("p",{className:"text-xl font-bold text-green-600",children:Ce.length})]}),n.jsxs("div",{className:"text-center",children:[n.jsx("p",{className:"text-xs uppercase text-gray-400",children:"Total Sent Balance"}),n.jsxs("p",{className:"text-xl font-bold text-green-700",children:["",ae.toLocaleString()]})]})]})]}),n.jsx("div",{className:"overflow-x-auto",children:n.jsxs("table",{className:"w-full text-sm",children:[n.jsx("thead",{className:"bg-amber-50 text-amber-800",children:n.jsxs("tr",{children:[n.jsx("th",{className:"p-2 text-left",children:"Case / Lawyer"}),n.jsx("th",{className:"p-2 text-left",children:"Status"}),n.jsx("th",{className:"p-2 text-right",children:"Total Balance ()"}),n.jsx("th",{className:"p-2 text-right",children:"Action"})]})}),n.jsxs("tbody",{className:"divide-y",children:[yt.length===0&&n.jsx("tr",{children:n.jsx("td",{colSpan:4,className:"p-4 text-center text-gray-400",children:"No expense reports yet."})}),yt.map(A=>n.jsxs("tr",{className:"hover:bg-amber-50 transition",children:[n.jsxs("td",{className:"p-2",children:[n.jsx("div",{className:"font-semibold text-textLight",children:A.insuredName||"Unnamed Case"}),n.jsxs("div",{className:"text-xs text-textMuted",children:["Lawyer: ",A.ownerName]})]}),n.jsx("td",{className:"p-2",children:n.jsx("span",{className:`px-2 py-1 rounded-full text-[10px] font-bold uppercase tracking-wide shadow-sm border ${Re(A.status)}`,children:rt(A.status)})}),n.jsxs("td",{className:"p-2 text-right font-bold",children:["",Wp(A).toLocaleString()]}),n.jsx("td",{className:"p-2 text-right",children:n.jsx("button",{onClick:()=>s(A.id),className:"text-lpBlue hover:underline text-xs font-bold",children:"Open"})})]},`expense-${A.id}`))]})]})})]}),!H&&Ke.length>0&&n.jsx("div",{className:"space-y-6 mb-8",children:Ke.map(A=>n.jsxs("div",{className:"bg-panel border rounded-2xl shadow-sm",children:[n.jsx("div",{className:"flex flex-wrap justify-between items-center gap-3 px-4 py-3 border-b",children:n.jsxs("div",{children:[n.jsx("h3",{className:"font-bold text-textLight",children:A.title}),n.jsx("p",{className:"text-sm text-textMuted",children:A.subtitle})]})}),A.items.length===0?n.jsx("div",{className:"p-6 text-center text-gray-400 text-sm",children:A.empty}):n.jsx("div",{className:"p-4 space-y-3",children:A.items.map(ge=>{var mt;if(A.id==="sent"){const lt=ge,tn=lt.sentAt?new Date(lt.sentAt).toLocaleDateString("he-IL"):"",Ls=lt.isLatest&&lt.parent.status==="SENT"&&typeof N=="function",nn=lt.isLatest&&lt.parent.status!=="SENT";return n.jsxs("div",{className:`border ${A.tone} rounded-xl p-4`,children:[n.jsxs("div",{className:"grid md:grid-cols-4 gap-4 text-sm text-textMuted",children:[n.jsxs("div",{children:[n.jsx("p",{className:"text-xs uppercase text-gray-400",children:" "}),n.jsx("p",{className:"font-bold text-textLight",children:lt.parent.odakanitNo||""})]}),n.jsxs("div",{children:[n.jsx("p",{className:"text-xs uppercase text-gray-400",children:" "}),n.jsx("p",{className:"font-bold text-textLight",children:lt.parent.insuredName||""})]}),n.jsxs("div",{children:[n.jsx("p",{className:"text-xs uppercase text-gray-400",children:lt.parent.plaintiffTitle}),n.jsx("p",{className:"font-bold text-textLight",children:lt.parent.plaintiffName||""})]}),n.jsxs("div",{children:[n.jsxs("p",{className:"text-xs uppercase text-gray-400",children:[" #",lt.reportNumber]}),n.jsx("p",{className:"font-bold text-textLight",children:tn})]})]}),n.jsxs("div",{className:"mt-2 text-sm text-textMuted space-y-1",children:[n.jsxs("p",{children:[n.jsx("span",{className:"font-semibold text-textLight",children:":"})," ",lt.entry.subject||""]}),lt.entry.fileName&&n.jsxs("p",{className:"text-xs text-textMuted",children:[" : ",lt.entry.fileName]})]}),n.jsxs("div",{className:"mt-3 flex flex-wrap gap-2 justify-end",children:[Ls&&N&&n.jsx("button",{onClick:()=>N(lt.parent.id),className:"px-4 py-2 rounded-full bg-navy text-white text-sm font-semibold hover:bg-navySecondary",children:'" '}),nn&&n.jsx("span",{className:"text-xs text-textMuted font-semibold px-3 py-1 rounded-full bg-navySecondary",children:'"  '})]})]},`${lt.parent.id}-${lt.entry.id}`)}const Pe=ge,Ie=typeof Pe.reportNumber=="number"&&Pe.reportNumber>0?Pe.reportNumber:(((mt=Pe.reportHistory)==null?void 0:mt.length)||0)+1;return n.jsxs("div",{className:`border ${A.tone} rounded-xl p-4`,children:[n.jsxs("div",{className:"grid md:grid-cols-4 gap-4 text-sm text-textMuted",children:[n.jsxs("div",{children:[n.jsx("p",{className:"text-xs uppercase text-gray-400",children:" "}),n.jsx("p",{className:"font-bold text-textLight",children:Pe.odakanitNo||""})]}),n.jsxs("div",{children:[n.jsx("p",{className:"text-xs uppercase text-gray-400",children:" "}),n.jsx("p",{className:"font-bold text-textLight",children:Pe.plaintiffName||""})]}),n.jsxs("div",{children:[n.jsx("p",{className:"text-xs uppercase text-gray-400",children:" "}),n.jsx("p",{className:"font-bold text-textLight",children:Pe.insuredName||""})]}),n.jsxs("div",{children:[n.jsx("p",{className:"text-xs uppercase text-gray-400",children:" "}),n.jsxs("p",{className:"font-bold text-textLight",children:["#",Ie]})]})]}),A.id==="followup"&&n.jsx("div",{className:"mt-2 text-xs text-textMuted",children:(()=>{var Ls;const lt=(Ls=Pe.reportHistory)==null?void 0:Ls[Pe.reportHistory.length-1],tn=lt!=null&&lt.date?new Date(lt.date).toLocaleDateString("he-IL"):Pe.sentAt?new Date(Pe.sentAt).toLocaleDateString("he-IL"):"";return`"  : #${(lt==null?void 0:lt.reportNumber)||Ie-1}  ${tn}`})()}),n.jsxs("div",{className:"mt-3 flex flex-wrap gap-2 justify-end",children:[A.id==="finance"&&xs(Pe)&&n.jsxs("button",{onClick:()=>Wn(Pe),className:"px-3 py-2 rounded-full border border-red-200 text-red-600 text-sm font-semibold flex items-center gap-1 hover:bg-red-50",title:"  ",children:[n.jsx(Ws,{className:"w-4 h-4"}),""]}),A.action&&n.jsx("button",{onClick:()=>A.action&&A.action(Pe),className:"px-4 py-2 rounded-full bg-navy text-white text-sm font-semibold hover:bg-navySecondary",children:A.actionLabel})]})]},Pe.id)})})]},A.id))}),H&&n.jsxs("div",{className:"mb-8",children:[n.jsx("div",{className:"flex justify-between items-end mb-4",children:n.jsxs("h3",{className:"text-lg font-bold text-textLight flex items-center",children:[n.jsx(ch,{className:"w-6 h-6 mr-2 text-indigo-600"})," Active Case Folders"]})}),n.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[dt.length===0&&n.jsx("p",{className:"text-gray-400 italic col-span-3 text-center py-4",children:"No active finance folders."}),dt.map(A=>{var Ie;const ge=(()=>{switch(A.status){case"WAITING_FOR_INVOICES":return{badge:"bg-yellow-50 text-yellow-700",text:"Awaiting Finance Finalize",icon:n.jsx(Bt,{className:"text-yellow-500 w-5 h-5 animate-spin"})};case"TASK_ASSIGNED":return{badge:"bg-blue-50 text-blue-700",text:"Pending Lawyer Action",icon:n.jsx(lh,{className:"text-blue-500 w-5 h-5"})};case"READY_TO_SEND":return{badge:"bg-orange-50 text-orange-700",text:"Waiting for Lior",icon:n.jsx(Bt,{className:"text-orange-500 w-5 h-5 animate-spin"})};case"SENT":return{badge:"bg-green-50 text-green-700",text:"Completed",icon:n.jsx(ih,{className:"text-green-500 w-6 h-6"})};default:return{badge:"bg-navySecondary text-textMuted",text:A.status,icon:n.jsx(Bt,{className:"text-gray-400 w-5 h-5 animate-spin"})}}})(),Pe=(Ie=js.find(mt=>mt.id===A.createdBy))==null?void 0:Ie.name;return n.jsxs("div",{className:"bg-panel p-4 rounded-lg shadow border-t-4 relative border-indigo-100",children:[n.jsxs("div",{className:"flex justify-between items-start mb-2",children:[n.jsxs("h4",{className:"font-bold text-lg",children:["Case #",A.odakanitNo]}),ge.icon]}),n.jsxs("div",{className:"text-sm text-textMuted mb-1 flex items-center",children:[n.jsx(V0,{className:"w-4 h-4 mr-1"})," Assigned to: ",Pe]}),n.jsx("div",{className:"text-xs text-textMuted mb-4",children:new Date(A.reportDate).toLocaleDateString()}),n.jsx("div",{className:"flex justify-end gap-2 mt-2",children:A.status==="SENT"?n.jsxs("button",{onClick:()=>l(A.id),className:"text-red-500 hover:bg-red-50 px-3 py-1 rounded text-sm flex items-center",children:[n.jsx(Ws,{className:"w-4 h-4 mr-1"})," Delete Folder"]}):n.jsx("span",{className:`text-xs font-bold px-2 py-1 rounded ${ge.badge}`,children:ge.text})})]},A.id)})]})]}),(H||V)&&n.jsxs("div",{className:"bg-panel rounded-xl shadow-sm border border-borderDark overflow-hidden",children:[n.jsxs("div",{className:"p-4 border-b border-gray-100 bg-navySecondary/50 flex flex-wrap gap-3 items-center justify-between",children:[n.jsxs("h3",{className:"font-bold text-textLight flex items-center",children:[n.jsx(dh,{className:"w-4 h-4 mr-2 text-gray-400"})," ",ce?"Recycle Bin":"All Reports"]}),n.jsxs("div",{className:"flex items-center gap-3 flex-wrap justify-end",children:[ce&&_e&&n.jsx("span",{className:"text-xs text-textMuted",children:_e}),n.jsxs("div",{className:"relative w-full sm:w-72",children:[n.jsx(H0,{className:"w-4 h-4 text-gray-400 absolute left-3 top-1/2 -translate-y-1/2"}),n.jsx("input",{value:Ze,onChange:A=>Oe(A.target.value),placeholder:"     ",className:"w-full border border-borderDark rounded-full pl-9 pr-10 py-1.5 text-sm focus:ring-2 focus:ring-blue-200 outline-none"}),Ze&&n.jsx("button",{onClick:()=>Oe(""),className:"absolute right-3 top-1/2 -translate-y-1/2 text-gray-400 hover:text-red-500",children:n.jsx(Ht,{className:"w-4 h-4"})})]})]})]}),V?n.jsxs("table",{className:"w-full text-left",children:[n.jsx("thead",{className:"bg-navySecondary text-textMuted text-xs uppercase tracking-wider font-semibold",children:n.jsxs("tr",{children:[n.jsx("th",{className:"p-4",children:"Insurer / Subject"}),H&&n.jsx("th",{className:"p-4",children:"Lawyer"}),n.jsx("th",{className:"p-4",children:"Status"}),n.jsx("th",{className:"p-4 text-right",children:"Action"})]})}),n.jsxs("tbody",{className:"divide-y divide-gray-100",children:[es.length===0&&n.jsx("tr",{children:n.jsx("td",{colSpan:H?4:3,className:"p-6 text-center text-gray-400 text-sm",children:Cn?"    .":"  ."})}),es.map(A=>{const ge=A.status==="READY_TO_SEND",Pe=A.status==="SENT",Ie=!!A.__templateKey;return n.jsxs("tr",{className:`transition cursor-default ${ge?"bg-red-50 [&_.text-textLight]:text-gray-800 [&_.text-textMuted]:text-gray-600":Pe?"bg-green-50/50 [&_.text-textLight]:text-gray-800 [&_.text-textMuted]:text-gray-600":"hover:bg-blue-50/30"}`,children:[n.jsxs("td",{className:"p-4",children:[n.jsx("div",{className:"font-bold text-textLight",children:A.insurerName||"Untitled"}),n.jsxs("div",{className:"text-xs text-textMuted",children:[A.marketRef," ",A.insuredName?` - ${A.insuredName}`:""]})]}),H&&n.jsx("td",{className:"p-4 text-sm text-textMuted font-medium",children:A.ownerName}),n.jsx("td",{className:"p-4",children:n.jsx("span",{className:`px-2.5 py-1 rounded-full text-[10px] font-bold uppercase tracking-wide shadow-sm border ${Re(A.status)}`,children:rt(A.status)})}),n.jsx("td",{className:"p-4 text-right",children:n.jsxs("div",{className:"flex justify-end gap-2 flex-wrap",children:[n.jsxs(n.Fragment,{children:[n.jsxs("button",{onClick:()=>b(A.id),className:"text-xs bg-navySecondary hover:bg-borderDark px-3 py-1.5 rounded flex items-center gap-1",children:[n.jsx(ph,{className:"w-3 h-3"})," View Expenses"]}),n.jsxs("button",{onClick:()=>h(A),className:"text-xs bg-blue-50 text-blue-700 hover:bg-blue-100 px-3 py-1.5 rounded flex items-center gap-1",children:[n.jsx(Zl,{className:"w-3 h-3"})," Reminder"]}),n.jsxs("button",{onClick:()=>S(A),className:"text-xs bg-purple-50 text-purple-700 hover:bg-purple-100 px-3 py-1.5 rounded flex items-center gap-1",children:[n.jsx(Ou,{className:"w-3 h-3"})," Add Note"]})]}),M&&!X&&!ce&&n.jsxs("button",{onClick:()=>!Ie&&P(A.id),disabled:Ie,className:`text-xs px-3 py-1.5 rounded flex items-center gap-1 ${Ie?"bg-navySecondary text-gray-400 cursor-not-allowed":"bg-red-50 text-red-700 hover:bg-red-100"}`,children:[n.jsx(Ws,{className:"w-3 h-3"})," Delete"]}),ce&&n.jsxs(n.Fragment,{children:[X&&n.jsx("button",{onClick:()=>o(A.id,{sentAt:new Date().toISOString()}),className:"text-green-600 hover:bg-green-50 px-3 py-1.5 rounded text-sm font-bold",children:"Restore"}),!X&&M&&n.jsx("button",{onClick:()=>U(A.id),className:"text-green-600 hover:bg-green-50 px-3 py-1.5 rounded text-sm font-bold",children:"Restore"})]})]})})]},A.id)})]})]}):n.jsx("div",{children:Un.length===0?n.jsx("div",{className:"p-6 text-center text-gray-400 text-sm",children:Cn?"    .":"  ."}):n.jsx("div",{className:"divide-y divide-gray-100",children:Un.map(A=>{const ge=A.latestDate?new Date(A.latestDate).toLocaleDateString("he-IL"):"-",Pe=[...A.reports].sort((Ie,mt)=>{const lt=Ie.reportDate?new Date(Ie.reportDate).getTime():0;return(mt.reportDate?new Date(mt.reportDate).getTime():0)-lt});return n.jsxs("div",{className:"p-4",children:[n.jsxs("div",{className:"flex flex-wrap justify-between gap-3",children:[n.jsxs("div",{children:[n.jsx("p",{className:"text-xs uppercase text-gray-400",children:" "}),n.jsx("p",{className:"text-xl font-bold text-textLight",children:A.odakanitNo||""}),n.jsxs("p",{className:"text-xs text-textMuted",children:[" : ",n.jsx("span",{className:"font-semibold",children:A.plaintiffName||""}),"   : ",n.jsx("span",{className:"font-semibold",children:A.insuredName||""})]}),n.jsxs("p",{className:"text-xs text-gray-400",children:[" : ",ge]})]}),n.jsxs("div",{className:"text-right",children:[n.jsx("p",{className:"text-xs text-textMuted",children:'" '}),n.jsx("p",{className:"text-2xl font-bold text-textLight",children:A.reports.length}),n.jsx("button",{onClick:()=>ot(Ie=>Ie===A.key?null:A.key),className:"mt-2 px-4 py-1.5 text-sm font-semibold rounded-full border border-borderDark text-textLight hover:bg-navySecondary",children:Ye===A.key?" ":" "})]})]}),Ye===A.key&&n.jsx("div",{className:"mt-4 bg-navySecondary border border-borderDark rounded-xl overflow-hidden",children:n.jsxs("table",{className:"w-full text-sm",children:[n.jsx("thead",{className:"bg-navySecondary text-textMuted text-xs uppercase tracking-wide",children:n.jsxs("tr",{children:[n.jsx("th",{className:"p-3 text-left",children:" "}),n.jsx("th",{className:"p-3 text-left",children:" "}),n.jsx("th",{className:"p-3 text-left",children:" "}),n.jsx("th",{className:"p-3 text-left",children:""}),n.jsx("th",{className:"p-3 text-right",children:""})]})}),n.jsx("tbody",{className:"divide-y divide-gray-200",children:Pe.map(Ie=>{const mt=Ie.status==="READY_TO_SEND",lt=Ie.status==="SENT",tn=!!Ie.__templateKey;return n.jsxs("tr",{className:`bg-panel ${mt?"bg-red-50 text-gray-900":lt?"bg-green-50/60 text-gray-900":""}`,children:[n.jsx("td",{className:"p-3",children:Ie.reportDate?new Date(Ie.reportDate).toLocaleDateString("he-IL"):""}),n.jsx("td",{className:"p-3",children:Ie.plaintiffName||""}),n.jsx("td",{className:"p-3",children:Ie.insuredName||""}),n.jsx("td",{className:"p-3",children:n.jsx("span",{className:`px-2.5 py-1 rounded-full text-[10px] font-bold uppercase tracking-wide shadow-sm border ${Re(Ie.status)}`,children:rt(Ie.status)})}),n.jsx("td",{className:"p-3 text-right",children:n.jsxs("div",{className:"flex justify-end gap-2 flex-wrap",children:[n.jsxs("button",{onClick:()=>s(Ie.id),className:"text-lpBlue hover:bg-blue-50 px-3 py-1.5 rounded transition font-bold text-xs flex items-center",children:["Open ",n.jsx(is,{className:"w-3 h-3 ml-1"})]}),M&&!X&&!ce&&n.jsxs("button",{onClick:()=>!tn&&P(Ie.id),disabled:tn,className:`text-xs px-3 py-1.5 rounded flex items-center gap-1 ${tn?"bg-navySecondary text-gray-400 cursor-not-allowed":"bg-red-50 text-red-700 hover:bg-red-100"}`,children:[n.jsx(Ws,{className:"w-3 h-3"})," Delete"]}),ce&&n.jsxs(n.Fragment,{children:[X&&n.jsx("button",{onClick:()=>o(Ie.id,{sentAt:new Date().toISOString()}),className:"text-green-600 hover:bg-green-50 px-3 py-1.5 rounded text-xs font-bold",children:"Restore"}),!X&&M&&n.jsx("button",{onClick:()=>U(Ie.id),className:"text-green-600 hover:bg-green-50 px-3 py-1.5 rounded text-xs font-bold",children:"Restore"})]})]})})]},Ie.id)})})]})})]},A.key)})})})]}),!H&&n.jsx("div",{className:"fixed bottom-8 right-8",children:n.jsx("button",{onClick:r,className:"bg-navy text-white p-4 rounded-full shadow-xl hover:bg-navySecondary transition transform hover:scale-110",children:n.jsx(O0,{className:"w-6 h-6"})})})]})]})},zv=({onLogin:e})=>{const[t,s]=g.useState(""),[r,a]=g.useState(""),[o,l]=g.useState(!1),c=async()=>{if(!t||!r){alert("    .");return}l(!0);try{const i=await fetch("/api/login",{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({username:t,password:r})});if(!i.ok){const p=await i.json().catch(()=>({})),y=(p==null?void 0:p.error)||"    .";alert(y);return}const u=await i.json();u&&u.user?e(u.user):alert("Login response was invalid.")}catch(i){console.error("Login failed",i),alert("  (  ?).  .")}finally{l(!1)}};return n.jsx("div",{className:"min-h-screen flex items-center justify-center px-4 bg-bgDark",children:n.jsxs("div",{className:"w-full max-w-sm bg-panel border border-borderDark rounded-2xl p-10 text-center shadow-2xl",children:[n.jsx("div",{className:"mx-auto mb-6 h-20 w-20 rounded-full bg-gold/20 border border-gold flex items-center justify-center text-4xl font-bold text-gold shadow-lg",children:"LP"}),n.jsx("div",{className:"text-sm tracking-[0.5em] text-gold uppercase mb-2",children:"Lloyd's"}),n.jsx("div",{className:"text-3xl font-serif text-textLight mb-1",children:"REPORT"}),n.jsx("div",{className:"text-xs text-textMuted uppercase tracking-[0.4em] mb-8",children:"Builder System"}),n.jsxs("div",{className:"space-y-4 text-left",children:[n.jsx("label",{className:"text-xs uppercase text-textMuted tracking-[0.2em]",children:"Username"}),n.jsxs("div",{className:"relative",children:[n.jsx(K0,{className:"w-4 h-4 text-gold absolute left-3 top-1/2 -translate-y-1/2"}),n.jsx("input",{className:"w-full bg-navy border border-borderDark rounded-full py-3 pl-10 pr-4 text-textLight placeholder-textMuted focus:outline-none focus:ring-2 focus:ring-gold/50",placeholder:"Username",value:t,onChange:i=>s(i.target.value)})]}),n.jsx("label",{className:"text-xs uppercase text-textMuted tracking-[0.2em]",children:"Password"}),n.jsxs("div",{className:"relative",children:[n.jsx(F0,{className:"w-4 h-4 text-gold absolute left-3 top-1/2 -translate-y-1/2"}),n.jsx("input",{type:"password",className:"w-full bg-navy border border-borderDark rounded-full py-3 pl-10 pr-4 text-textLight placeholder-textMuted focus:outline-none focus:ring-2 focus:ring-gold/50",placeholder:"Password",value:r,onChange:i=>a(i.target.value)})]})]}),n.jsxs("button",{onClick:c,disabled:o,className:"mt-8 w-full bg-navy text-gold border border-gold py-3 rounded-full font-semibold tracking-wide flex items-center justify-center gap-2 hover:bg-navySecondary transition-colors disabled:opacity-60 disabled:cursor-not-allowed",children:[o?"Signing in":"Sign In"," ",n.jsx(lh,{className:"w-4 h-4"})]}),n.jsx("div",{className:"mt-6 text-[11px] text-textMuted tracking-[0.3em] uppercase",children:"Lior Perry Law Office & Notary  2024"})]})})},Vv=()=>{var Z,de;const[e,t]=g.useState(null),[s,r]=g.useState(!1),[a,o]=g.useState(()=>Ov()),[l,c]=g.useState(()=>_v()),[i,u]=g.useState(null),p=g.useRef(l),y=g.useRef(i),[N,w]=g.useState(null);console.log("AppInner render",{currentUser:e,view:a,reportsCount:l.length});const R=g.useRef(!1),[E,W]=g.useState(null),[b,h]=g.useState([]),[S,P]=g.useState(!1);e==null||e.role;const[U,z]=g.useState(()=>{if(typeof window>"u")return[];try{const d=window.localStorage.getItem(ht.NOTIFICATIONS),m=d?JSON.parse(d):[];return Array.isArray(m)?m.filter(x=>x&&typeof x.id=="string"&&typeof x.message=="string"&&typeof x.createdAt=="string"):[]}catch{return[]}}),[q,ee]=g.useState(!1),[G,se]=g.useState(!1),[j,F]=g.useState([]),[L,O]=g.useState(null),[H,M]=g.useState(()=>{if(typeof window>"u")return{};try{const d=localStorage.getItem("favoriteProviders");return d?JSON.parse(d):{}}catch(d){return console.error("Failed to load favorite providers",d),{}}});g.useEffect(()=>{let d=!1;return fetch("/api/me",{credentials:"include"}).then(m=>m.ok?m.json():null).then(m=>{!d&&(m!=null&&m.user)&&t(m.user)}).catch(()=>{}).finally(()=>{d||r(!0)}),()=>{d=!0}},[]),g.useEffect(()=>{if(!(typeof window>"u"))try{window.localStorage.setItem(ht.NOTIFICATIONS,JSON.stringify(U))}catch{}},[U]);const[I,D]=g.useState(null),[J,ue]=g.useState(""),[ce,le]=g.useState(null),[fe,Ee]=g.useState(""),[ve,$e]=g.useState("LAWYER"),[Ze,Oe]=g.useState(!1),[Ye,ot]=g.useState(!1),[X,ne]=g.useState(!1),[C,re]=g.useState(!1),[te,pe]=g.useState(!1),[Be,je]=g.useState(!1),[Te,et]=g.useState(!1),[Ve,He]=g.useState(!1),[Q,be]=g.useState(!1),[xe,Ne]=g.useState(null),[Fe,Le]=g.useState(null),[Ke,dt]=g.useState(()=>{if(typeof window>"u")return[];try{const d=localStorage.getItem("caseTemplates");return d?JSON.parse(d):[]}catch(d){return console.error("Failed to load case templates",d),[]}}),[Ue,st]=g.useState(null),[Rt,yt]=g.useState(""),[V,ie]=g.useState(!1),[_e,Me]=g.useState(null),[he,Ce]=g.useState(void 0);g.useEffect(()=>{if(!i&&N!==null){w(null);return}i&&N&&i.id!==N&&w(null)},[i,N]),g.useEffect(()=>{typeof window>"u"||cv()||l.length&&Re(d=>{const m=Mc(d,l);return Dn(m),iv(),m})},[l]);const[ae,Re]=g.useState(()=>{const d=ov(),m=lv(d);return m!==d&&Dn(m),m}),rt=g.useRef(ae);g.useEffect(()=>{p.current=l,y.current=i,rt.current=ae},[l,i,ae]),g.useEffect(()=>{if(typeof window>"u"||!e)return;const d=m=>{const x=p.current,k=y.current;if(rt.current,x&&k){const v=[...x],_=v.findIndex(B=>B.id===k.id),$=_>=0?{...v[_],...k}:k;_>=0?v[_]=$:v.push($);try{localStorage.setItem(ht.REPORTS,JSON.stringify(v))}catch(B){console.error("beforeunload save failed",B)}}(x!=null&&x.length||k)&&(m.preventDefault(),m.returnValue="")};return window.addEventListener("beforeunload",d),()=>window.removeEventListener("beforeunload",d)},[e]),g.useEffect(()=>{a!=="PREVIEW"&&P(!1)},[a]);const Zt=d=>d?d==="SUB_ADMIN"?"OPS":d==="FINANCE"||d==="LAWYER"||d==="ADMIN"?d:"LAWYER":"LAWYER",Ge=d=>d.deletedAt?Date.now()-new Date(d.deletedAt).getTime()>=zh:d.status==="SENT"&&d.sentAt?Date.now()-new Date(d.sentAt).getTime()>=Wh:!1;g.useEffect(()=>{const d=()=>{c(x=>x.filter(k=>!Ge(k)))};d();const m=setInterval(d,60*60*1e3);return()=>clearInterval(m)},[]),g.useEffect(()=>{if(!G)return;const d=setInterval(()=>{if(!l.length)return;const m=l.filter(v=>v.status==="READY_TO_SEND").length,x=l.filter(v=>v.status==="SENT").length,k=`Daily summary: ${m} ready to send, ${x} sent reports.`;z(v=>[{id:`daily-${Date.now()}`,message:k,createdAt:new Date().toISOString(),severity:"info"},...v])},1e3*60*60*12);return()=>clearInterval(d)},[G,l]),g.useEffect(()=>{try{localStorage.setItem("caseTemplates",JSON.stringify(Ke))}catch(d){console.error("Failed to persist case templates",d)}},[Ke]),g.useEffect(()=>{try{localStorage.setItem("favoriteProviders",JSON.stringify(H))}catch(d){console.error("Failed to persist favorites",d)}},[H]);const ft=async d=>{if(!e||!i){He(!0),Ne(null),Le({title:"   ",bullets:["           .","  ,         .","  ,          ."]});return}const m=a==="STEP2"?2:a==="PREVIEW"?3:1,x=a==="STEP1"?"Step1":a==="STEP2"?"Step2Draft":a==="PREVIEW"?"Step3Preview":"Dashboard",k={step:m,role:Zt(e.role),screen:x,section:m===2&&he?he:void 0},v={hebrewApproved:i.hebrewWorkflowStatus==="HEBREW_APPROVED",hasTranslation:!!i.isTranslated,translationOutdated:!!i.translationStale,toneRiskRun:!!i.toneRiskLastRunAt,expensesLastUpdatedAt:i.expensesSnapshotAt||void 0};He(!0),be(!0),Ne(null);try{const _=await sb({intent:d,context:k,reportMeta:v});Le(_)}catch(_){console.error("Smart assistant request failed",_),Ne("REQUEST_FAILED"),Le(null)}finally{be(!1)}},Yt=(d,m)=>{if(!d||!m)return[];const x=[];d.translationStale&&x.push({id:"translation-outdated",kind:"TRANSLATION_OUTDATED",label:"       (translationStale=true).     .",intent:"pre_send_checks"});const k=m.role;return(k==="LAWYER"||k==="ADMIN")&&!d.toneRiskLastRunAt&&x.push({id:"tone-risk-not-run",kind:"TONE_RISK_NOT_RUN",label:"   Tone & Risk  .       .",intent:"explain_tone_risk"}),x};g.useEffect(()=>{let d=!1;return(async()=>{var _;if(typeof window>"u")return;const x=l.filter($=>!!$.expensesSheetId&&!$.expensesHtml&&!$.expensesHtmlMissing&&$.status!=="SENT");if(!x.length)return;let k=!1;const v=[...l];for(const $ of x)try{const B=await Xe.getSheet($.expensesSheetId);if(B&&B.sheet&&((_=B.lineItems)!=null&&_.length)){const Y=Xe.buildCumulativeExpensesSnapshot(B.sheet.id,new Date().toISOString());if(!Y)continue;const{effectiveSheet:oe,allLines:we,opts:ye}=Y,{html:ze}=oi(oe,we,ye);if(ze){const Je=v.findIndex(qe=>qe.id===$.id);Je!==-1&&(v[Je]={...v[Je],expensesHtml:ze},k=!0)}}else{const Y=v.findIndex(oe=>oe.id===$.id);Y!==-1&&(v[Y]={...v[Y],expensesHtmlMissing:!0},k=!0)}}catch(B){console.error("Failed to migrate expensesHtml for report",$.id,B);const Y=v.findIndex(oe=>oe.id===$.id);Y!==-1&&(v[Y]={...v[Y],expensesHtmlMissing:!0},k=!0)}!d&&k&&c(v)})(),()=>{d=!0}},[l]),g.useEffect(()=>{if(!(typeof window>"u"))try{localStorage.setItem(ht.REPORTS,JSON.stringify(l))}catch(d){console.error("Failed to persist reports",d)}},[l]),g.useEffect(()=>{typeof window>"u"||(e?localStorage.setItem(ht.USER,e.username):localStorage.removeItem(ht.USER))},[e]),g.useEffect(()=>{typeof window>"u"||localStorage.setItem(ht.VIEW,a)},[a]),g.useEffect(()=>{typeof window>"u"||(i?localStorage.setItem(ht.CURRENT_REPORT,i.id):localStorage.removeItem(ht.CURRENT_REPORT))},[i]),g.useEffect(()=>{if(typeof window>"u"||R.current)return;const d=localStorage.getItem(ht.CURRENT_REPORT);if(!d){R.current=!0;return}const m=l.find(x=>x.id===d);if(m){const x=!!(m.expensesSheetId||m.expensesHtml);let k=m;if(x&&Array.isArray(m.selectedSections)&&!m.selectedSections.some(v=>ea(v))){const v=[...m.selectedSections],_=v.includes("Update"),$=v.includes("Recommendations"),B=_?Math.min(v.indexOf("Update")+1,$?v.indexOf("Recommendations"):v.length):0;v.splice(B,0,Ja),k={...m,selectedSections:Array.from(new Set(v))}}u(k)}R.current=!0},[l,e]),g.useEffect(()=>{a==="DASHBOARD"||a==="CASE_FOLDER"||i||(o("DASHBOARD"),typeof window<"u"&&(localStorage.setItem(ht.VIEW,"DASHBOARD"),localStorage.removeItem(ht.CURRENT_REPORT)))},[i,a]);const en=()=>({id:Date.now().toString(),createdBy:e.id,ownerName:e.name,ownerEmail:e.email,reportNumber:1,reportDate:new Date().toISOString(),updatedAt:new Date().toISOString(),status:"DRAFT",reportSubject:"",recipientId:"1",insurerName:"",lineSlipNo:"",marketRef:"",certificateRef:"",insuredName:"",plaintiffName:"",plaintiffTitle:"Plaintiff",policyPeriodStart:"",policyPeriodEnd:"",retroStart:"",retroEnd:"",sentAt:void 0,reportHistory:[],selectedTimeline:"standard",filenameTag:hh[0],selectedSections:["Update","Recommendations"],content:{},translatedContent:{},invoiceFiles:[],isWaitingForInvoices:!1,requiresExpenses:!1,isTranslated:!1,expensesItems:[],expenseWorksheet:$s(),reportNotes:[],complaintAnalysis:void 0,attachPolicyAsAppendix:!0}),Ds=({odakanitNo:d,reports:m,caseFolder:x})=>{var $;const k=Se(d);if(!k)return 1;const v=[];return($=x==null?void 0:x.sentReports)!=null&&$.length&&x.sentReports.forEach(B=>{typeof B.reportNo=="number"&&B.reportNo>0&&v.push(B.reportNo)}),m.forEach(B=>{var Y;if(Se(B.odakanitNo)===k&&B.status==="SENT")if(typeof B.reportNumber=="number"&&B.reportNumber>0)v.push(B.reportNumber);else{const oe=(((Y=B.reportHistory)==null?void 0:Y.length)||0)+1;v.push(oe)}}),(v.length?Math.max(...v):0)+1},fs=d=>{const m=d.createdBy||"unknown",x=d.odakanitNo||d.marketRef||d.id,k=(d.plaintiffName||"unknown").toLowerCase();return`${m}::${x}::${k}`},Cn=d=>{const m=fs(d),x={caseKey:m,ownerId:d.createdBy,ownerName:d.ownerName,odakanitNo:d.odakanitNo,plaintiffName:d.plaintiffName,plaintiffTitle:d.plaintiffTitle,insurerName:d.insurerName,lineSlipNo:d.lineSlipNo,marketRef:d.marketRef,certificateRef:d.certificateRef,insuredName:d.insuredName,policyPeriodStart:d.policyPeriodStart,policyPeriodEnd:d.policyPeriodEnd,retroStart:d.retroStart,retroEnd:d.retroEnd,lastUpdated:new Date().toISOString()};dt(k=>k.find(_=>_.caseKey===m)?k.map(_=>_.caseKey===m?x:_):[...k,x])},or=d=>{if(!e)return;const m=Ke.find(k=>k.caseKey===d&&k.ownerId===e.id);if(!m)return;const x={...en(),odakanitNo:m.odakanitNo||"",insurerName:m.insurerName||"",lineSlipNo:m.lineSlipNo||"",marketRef:m.marketRef||"",certificateRef:m.certificateRef||"",insuredName:m.insuredName||"",plaintiffName:m.plaintiffName||"",plaintiffTitle:m.plaintiffTitle||"Plaintiff",policyPeriodStart:m.policyPeriodStart||"",policyPeriodEnd:m.policyPeriodEnd||"",retroStart:m.retroStart||"",retroEnd:m.retroEnd||""};u(x),o("STEP1")},es=d=>{var oe;if(!e)return;const m=Un(d);if(!m||m.createdBy!==e.id||(((oe=m.reportHistory)==null?void 0:oe.length)||0)===0||m.status!=="SENT")return;const x=m.reportHistory[m.reportHistory.length-1];if(!x)return;const v=x.snapshot||m,_=v.selectedSections&&v.selectedSections.length?[...v.selectedSections]:[...m.selectedSections||[]],$=_.length?_:["Update","Recommendations"],B=new Date().toISOString(),Y={...m,reportDate:B,updatedAt:B,status:"DRAFT",sentAt:void 0,reportNotes:[],content:{},translatedContent:{},executiveSummary:void 0,complaintAnalysis:void 0,expensesItems:[],expensesSum:void 0,paymentRecommendation:void 0,expenseWorksheet:$s(),invoiceFiles:[],expensesSourceFile:void 0,requiresExpenses:!1,isWaitingForInvoices:!1,isTranslated:!1,selectedEmailTemplate:void 0,emailBodyDraft:void 0,fileNameTitles:[],deletedAt:void 0,deletedBy:void 0,selectedSections:$,reportHistory:[...m.reportHistory||[]]};Y.insurerName=v.insurerName||"",Y.lineSlipNo=v.lineSlipNo||"",Y.marketRef=v.marketRef||"",Y.certificateRef=v.certificateRef||"",Y.insuredName=v.insuredName||"",Y.plaintiffName=v.plaintiffName||"",Y.plaintiffTitle=v.plaintiffTitle||m.plaintiffTitle,Y.policyPeriodStart=v.policyPeriodStart||"",Y.policyPeriodEnd=v.policyPeriodEnd||"",Y.retroStart=v.retroStart||"",Y.retroEnd=v.retroEnd||"",Y.filenameTag=v.filenameTag||Y.filenameTag,Y.fileNameTitles=[],Y.selectedTimeline=v.selectedTimeline||Y.selectedTimeline,Y.selectedTimelineImage=v.selectedTimelineImage,Y.odakanitNo=v.odakanitNo||m.odakanitNo,Y.recipientId=v.recipientId||m.recipientId,c(we=>we.map(ye=>ye.id===m.id?Y:ye)),u(Y),Cn(Y),o("STEP1")},Un=d=>l.find(m=>m.id===d),xs=(d,m)=>{if(d.status!==m.status||d.hebrewWorkflowStatus!==m.hebrewWorkflowStatus||d.insuredName!==m.insuredName||d.plaintiffName!==m.plaintiffName||d.insurerName!==m.insurerName||d.odakanitNo!==m.odakanitNo||d.marketRef!==m.marketRef||d.lineSlipNo!==m.lineSlipNo||d.certificateRef!==m.certificateRef||d.policyPeriodStart!==m.policyPeriodStart||d.policyPeriodEnd!==m.policyPeriodEnd||d.retroStart!==m.retroStart||d.retroEnd!==m.retroEnd||d.reportSubject!==m.reportSubject||d.executiveSummary!==m.executiveSummary)return!0;const x=(k,v)=>JSON.stringify(k)===JSON.stringify(v);return!x(d.content,m.content)||!x(d.translatedContent,m.translatedContent)||!x(d.expenseWorksheet,m.expenseWorksheet)||!x(d.expensesItems,m.expensesItems)||d.expensesSum!==m.expensesSum||d.paymentRecommendation!==m.paymentRecommendation||!x(d.complaintAnalysis,m.complaintAnalysis)||!x(d.reportReview,m.reportReview)},Wn=(d,m)=>{d.odakanitNo&&Re(x=>{const k=Pd(x,d,m);return Dn(k),k})},A=(d,m,x,k)=>{d.odakanitNo&&Re(v=>{const _=Hh(v,d,m,x,k);return Dn(_),_})},ge=d=>{var x;return(x=d==null?void 0:d.sentReports)!=null&&x.length?d.sentReports.map((k,v)=>{var Y,oe;const _=typeof k.reportNo=="number"&&k.reportNo>0?k.reportNo:v+1,$=k.sentAt||((Y=k.snapshot)==null?void 0:Y.reportDate)||"",B=((oe=k.snapshot)==null?void 0:oe.reportSubject)||k.fileName||"";return!B||!$?null:{id:k.reportId,reportNumber:_,subject:B,date:$,sent:!0,fileName:k.fileName,snapshot:k.snapshot}}).filter(k=>!!k).sort((k,v)=>k.reportNumber-v.reportNumber):[]},Pe=(d,m)=>{const x=d.reportReview??{status:"DRAFT",issues:[]};return{...d,reportReview:m(x)}},Ie=d=>{Lt(d,m=>{const x=(e==null?void 0:e.id)||"unknown",k=new Date().toISOString();return{...Pe(m,_=>({..._,status:"SUBMITTED",submittedAt:k,submittedByUserId:_.submittedByUserId||x})),hebrewWorkflowStatus:"HEBREW_SUBMITTED"}})},mt=d=>{(e==null?void 0:e.role)==="ADMIN"&&Lt(d,m=>{const x=(e==null?void 0:e.id)||"unknown",k=new Date().toISOString();return{...Pe(m,_=>({..._,status:"APPROVED",reviewedAt:k,reviewedByUserId:x})),hebrewWorkflowStatus:"HEBREW_APPROVED"}})},lt=(d,m)=>{m.length&&Lt(d,x=>{const k=(e==null?void 0:e.id)||"unknown",v=new Date().toISOString();return{...Pe(x,$=>({...$,status:"CHANGES_REQUESTED",reviewedAt:v,reviewedByUserId:k,issues:[...$.issues,...m.map(B=>({id:`issue-${Date.now()}-${Math.random().toString(36).slice(2)}`,createdAt:v,createdByUserId:k,sectionKey:B.sectionKey,severity:B.severity,type:B.type,title:B.title,instruction:B.instruction,status:"OPEN"}))]})),hebrewWorkflowStatus:"HEBREW_CHANGES_REQUESTED"}})},tn=(d,m)=>{Lt(d,x=>{const k=new Date().toISOString();return Pe(x,v=>({...v,issues:v.issues.map(_=>_.id===m&&_.status!=="DONE"?{..._,status:"DONE",doneAt:k}:_)}))})},Ls=d=>{(e==null?void 0:e.role)==="ADMIN"&&Lt(d,m=>{const x=new Date().toISOString();return Pe(m,k=>({...k,issues:k.issues.map(v=>(v.origin??"INTERNAL")==="EXTERNAL"&&v.status!=="DONE"?{...v,status:"DONE",doneAt:x}:v)}))})},nn=d=>{var x;return d?((x=d.reportReview)==null?void 0:x.status)==="APPROVED"||d.hebrewWorkflowStatus==="HEBREW_APPROVED":!1},Lt=(d,m)=>{const x=new Date().toISOString();let k=null,v=null;if(c(_=>_.map($=>{var at;if($.id!==d)return $;const B=Se($.odakanitNo),Y=B&&ae?ae[B]:void 0,oe=vt($,Y||void 0),we=!!(Y!=null&&Y.closedAt),ye=(e==null?void 0:e.role)==="ADMIN"&&N===$.id&&!we;if((e==null?void 0:e.role)==="LAWYER"&&$.status==="SENT"&&!ye)return xl({reason:"LAWYER_SENT_BLOCK",reportId:$.id,odakanitNo:$.odakanitNo,role:e==null?void 0:e.role,status:$.status,lockType:oe.lockType}),$;if(!ye&&oe.isLocked)return xl({reason:ae&&((at=ae[B])!=null&&at.closedAt)?"CASE_CLOSED_BLOCK":"LOCKSTATE_BLOCK",reportId:$.id,odakanitNo:$.odakanitNo,role:e==null?void 0:e.role,status:$.status,lockType:oe.lockType}),$;const Je=m($);return k=$,v=Je,xs($,Je)?{...Je,updatedAt:x}:Je})),k&&v&&k.odakanitNo&&v.odakanitNo){const _=k.odakanitNo.trim(),$=v.odakanitNo.trim();_&&$&&_!==$&&Re(B=>{let Y={...B};const oe=Y[_];if(oe){const we=oe.reportIds.filter(ye=>ye!==v.id);Y[_]={...oe,reportIds:we}}return Y=Pd(Y,v,x),Dn(Y),Y})}u(_=>{if(!_||_.id!==d)return _;const $=m(_);return xs(_,$)?{...$,updatedAt:x}:$})},Do=(d,m,x)=>{m.length&&(e==null?void 0:e.role)==="ADMIN"&&Lt(d,k=>{const v=(e==null?void 0:e.id)||"unknown",_=new Date().toISOString();return{...Pe(k,B=>({...B,status:"CHANGES_REQUESTED",reviewedAt:_,reviewedByUserId:v,issues:[...B.issues,...m.map(Y=>({id:`issue-${Date.now()}-${Math.random().toString(36).slice(2)}`,createdAt:_,createdByUserId:v,sectionKey:Y.sectionKey,severity:Y.severity,type:Y.type,title:Y.title,instruction:Y.instruction,status:"OPEN",origin:"EXTERNAL",externalRefId:x,externalAction:Y.externalAction??"ENGLISH_ONLY"}))]})),postSendFeedbackMeta:{...k.postSendFeedbackMeta||{},lastFeedbackAt:_}}})},ga=d=>{(e==null?void 0:e.role)==="ADMIN"&&Lt(d,m=>{const x=new Date().toISOString(),k=m.reportReview??{status:"DRAFT",issues:[]};return{...m,hebrewWorkflowStatus:"HEBREW_REOPENED_EXTERNAL",reportReview:{...k,status:k.status==="CHANGES_REQUESTED"?k.status:"CHANGES_REQUESTED"},postSendFeedbackMeta:{...m.postSendFeedbackMeta||{},reopenedDueToFeedbackAt:x}}})},kr=d=>{z(m=>[d,...m])},Ai=d=>{F(m=>m.some(x=>x.reportId===d)?m:[...m,{reportId:d}]),O(d)},Ii=d=>{F(m=>m.filter(x=>x.reportId!==d)),O(m=>m===d?null:m)},Ti=(d,m)=>{M(x=>{const k=x[d]||[];return k.some(v=>v.serviceProvider.toLowerCase()===m.serviceProvider.toLowerCase()&&v.category===m.category)?x:{...x,[d]:[m,...k]}})},Ri=(d,m)=>{M(x=>{const k=x[d]||[];return{...x,[d]:k.filter(v=>v.id!==m)}})},Gt=d=>{var m;if(i){const x=Se(i.odakanitNo),k=x&&ae?ae[x]:void 0,v=vt(i,k||void 0),_=!!(k!=null&&k.closedAt),$=(e==null?void 0:e.role)==="ADMIN"&&N===i.id&&!_;if((e==null?void 0:e.role)==="LAWYER"&&i.status==="SENT"&&!$){xl({reason:"LAWYER_SENT_BLOCK",reportId:i.id,odakanitNo:i.odakanitNo,role:e==null?void 0:e.role,status:i.status,lockType:v.lockType});return}if(!$&&v.isLocked){xl({reason:ae&&x&&((m=ae[x])!=null&&m.closedAt)?"CASE_CLOSED_BLOCK":"LOCKSTATE_BLOCK",reportId:i.id,odakanitNo:i.odakanitNo,role:e==null?void 0:e.role,status:i.status,lockType:v.lockType});return}const Y=i;let oe={...i,...d};if(Y.translationBaseHash&&d.content){const ye=Y.translationBaseHash,ze=Yp(d.content);ze&&ze!==ye&&(oe={...oe,translationStale:!0})}Y.updateAutoSummarySourceReportId&&d.content&&d.content.Update!==void 0&&(oe={...oe,updateAutoSummaryEdited:!0});const we=xs(Y,oe);u(we?{...oe,updatedAt:new Date().toISOString()}:oe)}},mn=()=>{i&&c(d=>{const x=d.find(k=>k.id===i.id)?d.map(k=>k.id===i.id?i:k):[...d,i];return Wn(i),x})},sn=()=>{if(!i)return;const d=Fc(i.content),m=Fc(i.translatedContent);Gt({content:d,translatedContent:m})},Ci=async()=>{if(i){if(!nn(i)){window.alert("       .");return}ot(!0);try{const d=Fc(i.content),m={};for(const k of Object.keys(d)){const v=d[k];if(v){const _=await Dd(v);m[k]=ci(_)}}const x=Yp(d);Gt({content:d,translatedContent:m,isTranslated:!0,translationBaseHash:x,translationStale:!1}),window.alert("  .")}catch(d){console.error("Translate failed",d),window.alert(" .    .")}finally{ot(!1)}}},Di=async()=>{if(!i)return;if(!i.isTranslated){window.alert("    (Auto-Translate)   .");return}const d=i.translatedContent||{},m=Object.keys(d).filter(x=>!x.toLowerCase().includes("expenses")&&typeof d[x]=="string"&&d[x].trim().length>0);if(!m.length){window.alert("   .");return}ne(!0);try{const x={...d},k=[];for(const v of m){const _=d[v];if(!(!_||!_.trim()))try{const{protectedText:$,map:B}=Kh(_),Y=await gh($),oe=Yh(Y||$,B),we=Vh(oe);x[v]=ci(we)}catch($){console.error(`Improve English failed for section "${v}"`,$),k.push(v),x[v]=_}}if(Gt({translatedContent:x}),mn(),!k.length)window.alert("   .");else{const v=k.map(_=>{var $;return Ld(_,($=i.expertSummaryMode)==null?void 0:$[_])});window.alert(`   .
  : ${v.join(", ")}.
   .`)}}catch(x){console.error("Improve English failed",x),window.alert("  .    .")}finally{ne(!1)}},Ar=d=>{const m=new Set(["lidor@lp-law.co.il"]),x=new Set(["reports@lp-law.co.il"]);if(d.ownerEmail)x.add(d.ownerEmail);else{const k=js.find(v=>v.id===d.createdBy);k!=null&&k.email&&x.add(k.email)}return{to:Array.from(m),cc:Array.from(x)}},hs=d=>ni(d),Li=d=>({...d,invoiceFiles:[],policyFile:void 0,expensesSourceFile:void 0}),_i=(d,m)=>{var v,_,$;const x=d.content?_r(d.content):{},k=d.translatedContent?_r(d.translatedContent):{};return{createdAt:m,reportDate:d.reportDate,subject:((v=d.emailSubjectDraft)==null?void 0:v.trim())||hs(d),status:"SENT",odakanitNo:d.odakanitNo,recipientId:d.recipientId,insurerName:d.insurerName,lineSlipNo:d.lineSlipNo,marketRef:d.marketRef,insuredName:d.insuredName,plaintiffName:d.plaintiffName,plaintiffTitle:d.plaintiffTitle,policyPeriodStart:d.policyPeriodStart,policyPeriodEnd:d.policyPeriodEnd,retroStart:d.retroStart,retroEnd:d.retroEnd,filenameTag:d.filenameTag,fileNameTitles:d.fileNameTitles?[...d.fileNameTitles]:void 0,selectedSections:[...d.selectedSections||[]],content:x,translatedContent:k,executiveSummary:d.executiveSummary,complaintAnalysis:d.complaintAnalysis?_r(d.complaintAnalysis):void 0,requiresExpenses:!!d.requiresExpenses,isWaitingForInvoices:!!d.isWaitingForInvoices,isTranslated:!!d.isTranslated,selectedTimeline:d.selectedTimeline,selectedTimelineImage:d.selectedTimelineImage,expensesItems:(_=d.expensesItems)!=null&&_.length?_r(d.expensesItems):void 0,expenseWorksheet:d.expenseWorksheet?_r(d.expenseWorksheet):void 0,expensesSum:d.expensesSum,paymentRecommendation:d.paymentRecommendation,reportNotes:($=d.reportNotes)!=null&&$.length?_r(d.reportNotes):void 0,ownerName:d.ownerName,ownerEmail:d.ownerEmail}},Ir=(d,m,x)=>{var $,B;const k=(($=d.emailSubjectDraft)==null?void 0:$.trim())||hs(d),v=((B=d.reportHistory)==null?void 0:B.length)||0,_=typeof d.reportNumber=="number"&&d.reportNumber>0?d.reportNumber:v+1;return{id:Ln(),reportNumber:_,subject:k,date:x,sent:!0,fileName:m,snapshot:_i(d,x)}},ya=d=>{if(!d)return d;const m="",x="";return d.startsWith(m)?d:`${m}${d}${x}`},ba=(d,m,x)=>{if(typeof window>"u")return;const k=d.to.join(";"),v=B=>encodeURIComponent(B),_=[];d.cc.length&&_.push(`cc=${v(d.cc.join(";"))}`),_.push(`subject=${v(m)}`),_.push(`body=${v(ya(x))}`);const $=`mailto:${k}?${_.join("&")}`;window.location.href=$},Lo=async()=>{if(i){Oe(!0);try{const d=await jc(i),m=ur(i),x=URL.createObjectURL(d),k=document.createElement("a");k.href=x,k.download=m,document.body.appendChild(k),k.click(),k.remove(),URL.revokeObjectURL(x)}catch(d){console.error("PDF download failed",d);const m=d instanceof Error?d.message:" -PDF .  .";alert(m)}finally{Oe(!1)}}},Oi=async()=>{const d=Yt(i,e);if(!d.length){await Lo();return}Me({issues:d,onContinue:()=>{Me(null),Lo()}})},Mi=()=>{i&&((e==null?void 0:e.role)==="ADMIN"?(je(!1),re(!0)):Mo())},Pi=()=>{var x,k;if(!i||(e==null?void 0:e.role)!=="ADMIN")return;if(i.status!=="SENT"){setShowToast({msg:"       (SENT).",type:"error"});return}if(!nn(i)){setShowToast({msg:"   /   .       .",type:"error"});return}if(((k=(x=i.reportReview)==null?void 0:x.issues)==null?void 0:k.some(v=>(v.origin??"INTERNAL")==="EXTERNAL"&&v.status!=="DONE"&&v.externalAction==="REQUIRES_HEBREW"))??!1){setShowToast({msg:"      .    /      .",type:"error"});return}if(!(i.isTranslated&&i.translatedContent&&Object.values(i.translatedContent).some(v=>v&&v.trim().length>0))){setShowToast({msg:"    .      .",type:"error"});return}je(!0),re(!0)},_o=async({body:d,templateId:m,subjectBase:x,topics:k},v)=>{const _=v??i;if(!_||_.translationStale&&!window.confirm("     .      .    ?"))return;const $={..._,selectedEmailTemplate:m,emailBodyDraft:d,emailSubjectDraft:x.trim()?x.trim():void 0,fileNameTitles:k};if(Gt({selectedEmailTemplate:m,emailBodyDraft:d,emailSubjectDraft:$.emailSubjectDraft,fileNameTitles:k}),e){const qe=Md(e.id),at=vp(qe,k,6);bp(e.id,at)}const B=ya(d);pe(!0);let Y=null,oe="";const we=x.trim()||hs($);let ye="",ze=null,Je=!1;try{ze=await jc($);const qe=await Vp(ze);ye=ur($),Y=Ar($),oe=we,Je=await fp({to:Y.to,cc:Y.cc,subject:oe,body:B,attachmentBase64:qe,attachmentName:ye}),Je?setShowToast({msg:"  .",type:"success"}):setShowToast({msg:"          ( PDF  ,    ).",type:"error"})}catch(qe){console.error("Email send failed",qe);const at=qe instanceof Error?qe.message:"";setShowToast({msg:at&&at.includes("")?at:"          ( PDF  ,    ).",type:"error"})}finally{if(Y){if(!Je){if(ze){const qe=ye||ur($),at=URL.createObjectURL(ze),nt=document.createElement("a");nt.href=at,nt.download=qe,document.body.appendChild(nt),nt.click(),document.body.removeChild(nt),URL.revokeObjectURL(at)}ba(Y,oe||we,B)}Mo(ye||void 0),re(!1)}pe(!1)}},Fi=async d=>{if(!i)return;let m=i;if(m.odakanitNo){const _=Se(m.odakanitNo);if(_){const B=l.filter(oe=>Se(oe.odakanitNo)===_).reduce((oe,we)=>{const ye=typeof we.reportNumber=="number"&&we.reportNumber>0?we.reportNumber:oe;return ye>oe?ye:oe},0);if((typeof m.reportNumber=="number"&&m.reportNumber>0?m.reportNumber:B)<B){window.alert("       .       .       .");return}}}const x=!!i.expensesSheetId||!!i.expensesHtml,k=Array.isArray(i.selectedSections)&&i.selectedSections.some(_=>ea(_));if(x&&!k){if(!window.confirm(`       ,        .

       ?`))return;const $=[...i.selectedSections||[]],B=$.includes("Update"),Y=$.includes("Recommendations"),oe=B?Math.min($.indexOf("Update")+1,Y?$.indexOf("Recommendations"):$.length):0;$.splice(oe,0,Ja);const we=Array.from(new Set($)),ye={...i,selectedSections:we};Gt({selectedSections:we}),m=ye}const v=Yt(m,e);if(!v.length){await _o(d,m);return}Me({issues:v,onContinue:()=>{Me(null),_o(d,m)}})},Oo=async({body:d,templateId:m,subjectBase:x,topics:k},v)=>{var Je,qe,at;const _=v??i;if(!_||(e==null?void 0:e.role)!=="ADMIN"||_.translationStale&&!window.confirm("     .      .     ?"))return;const $={..._,selectedEmailTemplate:m,emailBodyDraft:d,emailSubjectDraft:x.trim()?x.trim():void 0,fileNameTitles:k};if(Gt({selectedEmailTemplate:m,emailBodyDraft:d,emailSubjectDraft:$.emailSubjectDraft,fileNameTitles:k}),e&&k.length){const nt=Md(e.id),xt=vp(nt,k,6);bp(e.id,xt)}const B=ya(d);pe(!0);let Y=null,oe="",we="";const ye=x.trim()||hs($);let ze=!1;try{const nt=await jc($),xt=await Vp(nt);we=ur($),Y=Ar($),oe=`Resend  ${ye}`,ze=await fp({to:Y.to,cc:Y.cc,subject:oe,body:B,attachmentBase64:xt,attachmentName:we}),ze?setShowToast({msg:"   ( ).",type:"success"}):setShowToast({msg:"         .",type:"error"});const Wt=new Date().toISOString(),Ft=Ir({..._,status:"SENT",sentAt:Wt},we,Wt),Ot=typeof _.reportNumber=="number"&&_.reportNumber>0?_.reportNumber:(((Je=_.reportHistory)==null?void 0:Je.length)||0)+1,We=Se(_.odakanitNo),zn=We&&ae?ae[We]:void 0,ts=!vt(_,zn||void 0).isLocked,ct={...Ft,subject:ts?`Corrected resend #${Ot}  ${Ft.subject}`:`Resent #${Ot}  ${Ft.subject}`,isCorrection:ts,revisionIndex:ts?(((at=(qe=_.reportHistory)==null?void 0:qe.filter(rn=>rn.isCorrection))==null?void 0:at.length)||0)+1:void 0},Ct={..._,status:"SENT",sentAt:Wt,reportHistory:[..._.reportHistory||[],ct],selectedEmailTemplate:void 0,emailBodyDraft:void 0};Cn(Ct),Wn(Ct,Wt),A(Ct,Wt,ct.fileName||we,!0),u(Ct),c(rn=>rn.map(pt=>pt.id===Ct.id?Ct:pt))}catch(nt){console.error("Resend email failed",nt);const xt=nt instanceof Error?nt.message:"";setShowToast({msg:xt&&xt.includes("")?xt:"         .",type:"error"})}finally{if(Y){const nt=ye||hs(_),xt=oe||`UPDATED: ${nt}`;ze||ba(Y,xt,B),re(!1)}je(!1),pe(!1)}},Bi=async d=>{if(!i)return;let m=i;const x=!!i.expensesSheetId||!!i.expensesHtml,k=Array.isArray(i.selectedSections)&&i.selectedSections.some(_=>ea(_));if(x&&!k){if(!window.confirm(`        ,        .

        ?`))return;const $=[...i.selectedSections||[]],B=$.includes("Update"),Y=$.includes("Recommendations"),oe=B?Math.min($.indexOf("Update")+1,Y?$.indexOf("Recommendations"):$.length):0;$.splice(oe,0,Ja);const we=Array.from(new Set($)),ye={...i,selectedSections:we};Gt({selectedSections:we}),m=ye}const v=Yt(m,e);if(!v.length){await Oo(d,m);return}Me({issues:v,onContinue:()=>{Me(null),Oo(d,m)}})},Tr=d=>{if(!d)return;let m=d.trim();if(!(!m||(m=m.replace(Uu," ").replace(/\s+/g," ").trim(),!m)||(m.toLowerCase().endsWith(".pdf.pdf")&&(m=m.slice(0,-4)),m.toLowerCase().endsWith(".pdf")||(m=`${m}.pdf`),m.length>255)))return m},Mo=d=>{var _;if(!i)return;let m="READY_TO_SEND",x=i.sentAt,k=i;if((e==null?void 0:e.role)==="ADMIN"){m="SENT";const $=new Date().toISOString();x=$;const Y=Tr(d)||ur(Li(i)),oe=Ir({...i},Y,x);k={...i,reportHistory:[...i.reportHistory||[],oe],selectedEmailTemplate:void 0,emailBodyDraft:void 0,firstSentAt:i.firstSentAt||$}}else((e==null?void 0:e.role)==="FINANCE"||(e==null?void 0:e.role)==="SUB_ADMIN")&&(m="TASK_ASSIGNED");const v={...k,status:m,sentAt:x};if(Cn(v),Wn(v,x||new Date().toISOString()),m==="SENT"&&x){const $=(_=v.reportHistory)==null?void 0:_[v.reportHistory.length-1];A(v,x,$==null?void 0:$.fileName,!1)}u(v),c($=>$.find(Y=>Y.id===v.id)?$.map(Y=>Y.id===v.id?v:Y):[...$,v]),o("DASHBOARD")},$i=(d,m)=>{e&&(Lt(d,x=>{const k=[{id:Ln(),authorId:e.id,authorName:e.name,message:m,createdAt:new Date().toISOString()},...x.reportNotes||[]];return{...x,reportNotes:k}}),kr({id:`note-${Date.now()}`,message:`${e.name} added a note: "${m}"`,createdAt:new Date().toISOString()}))},Hi=(d,m)=>{Lt(d,x=>{const k=x.expenseWorksheet||$s(),v={id:Ln(),timestamp:new Date().toISOString(),userId:(e==null?void 0:e.id)||"system",userName:(e==null?void 0:e.name)||"System",action:m.action||"UPDATE",details:m.details};return{...x,expenseWorksheet:{...k,history:[v,...k.history||[]]}}})},Ui=(d,m,x)=>{e&&(Lt(d,k=>{const v=k.expenseWorksheet||$s(),_={id:Ln(),rowId:m,authorId:e.id,authorName:e.name,message:x,createdAt:new Date().toISOString()};return{...k,expenseWorksheet:{...v,notes:[_,...v.notes||[]]}}}),Hi(d,{action:"NOTE_ADDED",details:x}))},Wi=d=>{const m=new Date().toISOString();Lt(d,x=>({...x,deletedAt:m,deletedBy:e==null?void 0:e.id}))},zi=d=>{Lt(d,m=>{const x={...m};return delete x.deletedAt,delete x.deletedBy,x})},Vi=(d,m)=>{Lt(d,x=>{const k=x.expenseWorksheet||$s();return{...x,expenseWorksheet:{...k,notes:k.notes.map(v=>v.id===m?{...v,resolved:!0,resolvedAt:new Date().toISOString()}:v)}}})},Ki=(d,m)=>{!m.amount||m.amount<=0||Lt(d,x=>{var ze,Je;const k=x.expenseWorksheet||$s(),v=ds.find(qe=>qe.value===m.category),_=(v==null?void 0:v.type)||"EXPENSE",$=m.category==="OTHER"?((ze=m.customLabel)==null?void 0:ze.trim())||"Other expense":(v==null?void 0:v.label)||"Expense",B={id:Ln(),type:_,category:m.category,label:$,serviceProvider:_==="EXPENSE"?(Je=m.serviceProvider)==null?void 0:Je.trim():void 0,amount:m.amount,createdBy:e==null?void 0:e.id,createdAt:new Date().toISOString()},Y=[...k.rows||[],B],oe=ii(Y),we=Bv(Y),ye={id:Ln(),timestamp:new Date().toISOString(),userId:(e==null?void 0:e.id)||"system",userName:(e==null?void 0:e.name)||"System",action:"ROW_ADDED",details:`${$} ${B.amount.toLocaleString()}`};return{...x,expenseWorksheet:{...k,rows:Y,totals:oe,history:[ye,...k.history||[]]},expensesItems:we,expensesSum:oe.totalExpenses.toLocaleString()}})},Yi=d=>{const m=js.find(Y=>Y.id===d.lawyerId);if(!m)return;const x=Fd(d.worksheet||[],e||void 0),k=ii(x),v=d.invoiceFiles||[],_=v.length===0,$={...en(),createdBy:m.id,ownerName:m.name,ownerEmail:m.email,status:_?"WAITING_FOR_INVOICES":"TASK_ASSIGNED",odakanitNo:d.odakanitNo,financeInstructions:d.instructions,expensesSourceFile:d.file,selectedSections:["Update","Expenses breakdown"],isWaitingForInvoices:_,requiresExpenses:!0},B={...$,expensesItems:x.filter(Y=>Y.type==="EXPENSE").map(Y=>({id:Y.id,date:new Date().toISOString().split("T")[0],description:`${Y.label}${Y.serviceProvider?` (${Y.serviceProvider})`:""}`,amount:Y.amount,currency:"NIS"})),expensesSum:x.length?k.totalExpenses.toLocaleString():$.expensesSum,invoiceFiles:v,expenseWorksheet:{status:"DRAFT",rows:x,history:[{id:Ln(),timestamp:new Date().toISOString(),userId:(e==null?void 0:e.id)||"system",userName:(e==null?void 0:e.name)||"System",action:"WORKSHEET_CREATED",details:`${x.length} rows added via finance request`}],notes:[],favorites:H[d.lawyerId]||[],totals:k}};c(Y=>[...Y,B]),kr({id:`worksheet-${Date.now()}`,message:`New expense worksheet created for case ${d.odakanitNo||B.id}`,createdAt:new Date().toISOString(),reportId:B.id,severity:"info"})},Gi=async({caseId:d,sheetId:m,lawyerId:x})=>{var Ot,We,zn,gn,ts;const k=Se(d),v=ae==null?void 0:ae[k],_=l.filter(ct=>Se(ct.odakanitNo)===k);if(v&&v.closedAt){window.alert("        .   ,     .");return}if(!_.length&&!v){window.alert("     ( ).       .");return}if(!_.length)return;const $=(ct,Ct)=>{const rn=ct.updatedAt?new Date(ct.updatedAt).getTime():0;return(Ct.updatedAt?new Date(Ct.updatedAt).getTime():0)-rn};let B=_.filter(ct=>!x||ct.createdBy===x).sort($)[0];if(B||(B=_.sort($)[0]),!B)return;const Y=x||B.createdBy;if(!Y)return;const oe=B.odakanitNo||d,we=B.insuredName||B.plaintiffName||"case",ye=`New financial update (Expenses breakdown) is available for Odakanit case ${oe} (${we}).`;let ze=null,Je,qe=null,at=[];try{const ct=await Xe.getSheet(m);if(ct&&ct.sheet&&((Ot=ct.lineItems)!=null&&Ot.length)){const Ct=Xe.buildCumulativeExpensesSnapshot(ct.sheet.id,new Date().toISOString());if(!Ct)return;const{effectiveSheet:rn,allLines:pt,opts:ns}=Ct,{text:Sa,totals:lr}=Oh(rn,pt,ns),wa=((We=ct.attachments)==null?void 0:We.length)??0,zo=lr.amountToRequest.toLocaleString("he-IL",{minimumFractionDigits:2,maximumFractionDigits:2}),Vo="This expenses breakdown was prepared by the finance department and is attached for your review.",qh=`Summary: total amount to request ${zo}${wa>0?` (invoices attached: ${wa})`:""}.`;ze=`${Vo}

${qh}`;const{html:Xh}=oi(rn,pt,ns);if(qe=Xh,Je=ct.sheet.updatedAt||new Date().toISOString(),ct.attachments&&ct.attachments.length){const Ju=ct.attachments.slice(0,4).map((ja,Jh)=>({id:`fes-inv-${ja.id}-${Jh}`,name:ja.originalFileName,data:ja.fileKey.split(",").pop()||ja.fileKey,type:ja.mimeType||"application/pdf"}));Ju.length&&(at=Ju)}}}catch(ct){Gu("Failed to build Expenses Breakdown text for finance notification",ct)}const nt=new Date().toISOString(),xt=ze||"An expenses table has been prepared by the finance department for this case. Please review the attached sheet or coordinate with Finance as needed.",Wt=typeof B.reportNumber=="number"&&B.reportNumber>0?B.reportNumber+1:(((zn=B.reportHistory)==null?void 0:zn.length)||0)+1;let Ft={...B,id:`${Date.now()}-finance`,createdBy:Y,status:"TASK_ASSIGNED",reportDate:nt,updatedAt:nt,expensesSheetId:m,expensesSnapshotAt:Je||nt,invoiceFiles:at,reportNumber:Wt,reportHistory:B.reportHistory||[],attachPolicyAsAppendix:!1,expensesHtml:qe||void 0,content:{...B.content,Update:((gn=B.content)==null?void 0:gn.Update)||"","Expenses breakdown":xt,Recommendations:((ts=B.content)==null?void 0:ts.Recommendations)||""},selectedSections:["Update","Expenses breakdown","Recommendations"],supersededByReportId:null,supersedesReportId:null};c(ct=>{const Ct=[...ct].filter(pt=>pt.expensesSheetId===m&&!pt.deletedAt&&pt.id!==Ft.id).sort((pt,ns)=>{const Sa=new Date(pt.updatedAt||pt.reportDate||"").getTime()||0;return(new Date(ns.updatedAt||ns.reportDate||"").getTime()||0)-Sa})[0];let rn=ct;return Ct&&(rn=ct.map(pt=>pt.id===Ct.id?{...pt,supersededByReportId:Ft.id}:pt),Ft={...Ft,supersedesReportId:Ct.id}),[...rn,Ft]}),kr({id:`${Date.now()}`,message:ye,createdAt:new Date().toISOString(),reportId:Ft.id,severity:"info",targetUserId:Y})},qi=d=>{t(d),o("DASHBOARD"),u(null),w(null),R.current=!1,typeof window<"u"&&(localStorage.setItem(ht.USER,d.username),localStorage.setItem(ht.VIEW,"DASHBOARD"),localStorage.removeItem(ht.CURRENT_REPORT))},[Po,Rr]=g.useState(!1),[_s,Os]=g.useState(!1),Fo=()=>{if(!(l.length>0||i)){Na();return}Os(!1),Rr(!0)},Bo=()=>{Rr(!1),Os(!1),Na()},Na=async()=>{try{await fetch("/api/logout",{method:"POST",credentials:"include",headers:{"Content-Type":"application/json"}})}catch(d){console.warn("Logout API call failed, clearing client state anyway",d)}if(t(null),u(null),w(null),R.current=!1,o("DASHBOARD"),W(null),P(!1),re(!1),pe(!1),je(!1),et(!1),D(null),ue(""),le(null),Ee(""),$e("LAWYER"),F([]),O(null),ee(!1),st(null),h([]),typeof window<"u")try{localStorage.removeItem(ht.USER),localStorage.removeItem(ht.CURRENT_REPORT),localStorage.setItem(ht.VIEW,"DASHBOARD"),localStorage.removeItem(JN)}catch(d){console.error("Failed to clear session storage on logout",d)}};if(!s)return n.jsx("div",{className:"min-h-screen flex items-center justify-center bg-bgDark",children:n.jsxs("div",{className:"text-textMuted text-sm flex items-center gap-2",children:[n.jsx(Bt,{className:"w-5 h-5 animate-spin","aria-hidden":!0}),n.jsx("span",{children:"..."})]})});if(!e)return n.jsx(zv,{onLogin:qi});if(a==="CASE_FOLDER"&&Ue){const d=ae[Ue]||null,m=()=>{o("DASHBOARD")};return d?n.jsx(av,{folder:d,reports:l,currentUserRole:e.role,onBack:m,onUpdateReTemplate:x=>{Re(k=>{const v=k[Ue];if(!v)return k;const _={...v,reTemplate:x,updatedAt:new Date().toISOString()},$={...k,[Ue]:_};return Dn($),$})},onCloseCase:e.role==="ADMIN"?()=>{const x=Ue;if(!x)return;const k=Se(x);if(l.some($=>Se($.odakanitNo)===k&&$.status!=="SENT"&&!$.deletedAt)){window.alert("         .        .");return}if(!window.confirm("        .   ?"))return;const _=new Date().toISOString();Re($=>{const B=$[x];if(!B)return $;const Y={...B,closedAt:_,closedByUserId:e.id,updatedAt:_},oe={...$,[x]:Y};return Dn(oe),oe})}:void 0,onReopenCase:e.role==="ADMIN"?()=>{const x=Ue;x&&window.confirm("         .   ?")&&Re(k=>{const v=k[x];if(!v)return k;const _={...v,closedAt:null,closedByUserId:null,updatedAt:new Date().toISOString()},$={...k,[x]:_};return Dn($),$})}:void 0,onDeleteCase:e.role==="ADMIN"?()=>{const x=Ue;if(!x)return;const k=Se(x);if(l.some(_=>Se(_.odakanitNo)===k&&_.status!=="SENT"&&!_.deletedAt)){window.alert("       .        .");return}window.confirm("           (  ).   ?")&&window.confirm(" :      ?     .")&&(Re(_=>{const $={..._};return delete $[x],Dn($),$}),c(_=>_.filter($=>Se($.odakanitNo)!==k)),st(null),o("DASHBOARD"))}:void 0,onCreateReportInCase:()=>{const x=ae[Ue];if(!x||!e)return;if(x.closedAt){window.alert("  .      .");return}const k=l.find(qe=>qe.odakanitNo&&Se(qe.odakanitNo)===Se(x.odakanitNo)&&qe.status!=="SENT"&&!qe.deletedAt);if(k&&e.role==="LAWYER"){window.alert("     .     .      .");return}if(k&&e.role==="ADMIN"&&!window.confirm("     .       ( ,    )?"))return;const v=new Date().toISOString(),_=en(),$=ge(x),B=Ds({odakanitNo:x.odakanitNo,reports:l,caseFolder:x}),Y=Array.isArray(x.sentReports)?x.sentReports:[];let oe=null,we="";if(Y.length>0){oe=[...Y].sort((Ft,Ot)=>{const We=new Date(Ft.sentAt||"").getTime()||0;return(new Date(Ot.sentAt||"").getTime()||0)-We})[0];const qe=(oe==null?void 0:oe.snapshot)||{},at=qe.content||{},nt=Array.isArray(qe.selectedSections)?qe.selectedSections:[],xt=nt.length>0?nt:Object.keys(at),Wt=[];xt.forEach(Ft=>{const Ot=at[Ft];typeof Ot=="string"&&Ot.trim()&&Wt.push(Ot.trim())}),we=Wt.join(`

`).trim()}const ye=!!(oe&&we),ze="    ",Je={..._,odakanitNo:x.odakanitNo,reportSubject:x.reTemplate||"",insuredName:x.insuredName||"",plaintiffName:x.plaintiffName||"",insurerName:x.insurerName||"",marketRef:x.marketRef||"",lineSlipNo:x.lineSlipNo||"",certificateRef:x.certificateRef||"",reportDate:v,updatedAt:v,reportHistory:$,reportNumber:B,content:ye?{..._.content||{},Update:ze}:_.content,updateAutoSummarySourceReportId:ye?oe.reportId:null,updateAutoSummaryGeneratedAt:ye?v:null,updateAutoSummaryEdited:!1};if(u(Je),w(null),o("STEP1"),typeof window<"u")try{localStorage.setItem(ht.CURRENT_REPORT,Je.id)}catch{}if(Wn(Je,v),ye){const qe=we,at=oe.reportId;(async()=>{try{let nt=await Q0(qe);nt=(nt||"").trim(),nt||(nt=`,     ${qe.trim().slice(0,600)}`),nt.startsWith(",  ")||(nt=`,     ${nt}`),Lt(Je.id,xt=>{var Wt;return xt.updateAutoSummaryEdited||((Wt=xt.content)==null?void 0:Wt.Update)!==ze?xt:{...xt,content:{...xt.content||{},Update:nt},updateAutoSummarySourceReportId:at,updateAutoSummaryGeneratedAt:new Date().toISOString()}})}catch(nt){console.error("Auto summary generation failed, falling back to snippet.",nt);const xt=qe.trim();if(!xt)return;const Ft=`,     ${xt.slice(0,600)}`;Lt(Je.id,Ot=>{var We;return Ot.updateAutoSummaryEdited||((We=Ot.content)==null?void 0:We.Update)!==ze?Ot:{...Ot,content:{...Ot.content||{},Update:Ft},updateAutoSummarySourceReportId:at,updateAutoSummaryGeneratedAt:new Date().toISOString()}})}})()}},onOpenReport:x=>{const k=l.find(v=>v.id===x);if(k&&(u(k),w(null),o("STEP1"),typeof window<"u"))try{localStorage.setItem(ht.CURRENT_REPORT,k.id)}catch{}}}):n.jsx("div",{className:"min-h-screen flex items-center justify-center bg-bgDark px-4",children:n.jsxs("div",{className:"max-w-md rounded-2xl bg-panel p-6 text-center text-sm text-textLight shadow-sm border border-borderDark",children:[n.jsx("p",{className:"mb-3 font-semibold text-gold",children:"Case folder not found"}),n.jsx("p",{className:"mb-4 text-xs text-textMuted",children:"The requested case folder is no longer available. You can return to the dashboard and select another case."}),n.jsx("button",{type:"button",onClick:m,className:"inline-flex items-center rounded-full bg-navy px-4 py-1.5 text-xs font-semibold text-gold shadow-sm hover:bg-navySecondary focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-gold focus-visible:ring-offset-2",children:"Back to dashboard"})]})})}const $o=()=>{if((e==null?void 0:e.role)==="LAWYER"){yt(""),ie(!0);return}const d=en();if(u(d),w(null),o("STEP1"),typeof window<"u")try{localStorage.setItem(ht.CURRENT_REPORT,d.id)}catch{}},va=(d,m)=>{const x=l.find(k=>k.id===d);if(x&&(u(x),w(null),o("STEP1"),W(m||null),typeof window<"u"))try{localStorage.setItem(ht.CURRENT_REPORT,x.id)}catch{}};if(a==="DASHBOARD")return(e==null?void 0:e.role)==="ADMIN"||(e==null?void 0:e.role)==="SUB_ADMIN"?n.jsx(ev,{user:e,reports:l,caseFolders:ae,onUpdateCaseFolders:d=>{Re(m=>{const x=d(m);return Dn(x),x})},onNewReport:$o,onSelectReport:va,onSelectReportWithFocus:(d,m)=>va(d,m),onMarkExternalIssuesDone:Ls,onReopenHebrewDueToExternalFeedback:d=>ga(d),canTranslate:nn,onLogout:Fo,onOpenAssistant:()=>He(!0),onOpenCaseFolder:d=>{const m=Se(d);m&&(Re(x=>{const k=Mc(x,l);return Dn(k),k}),st(m),o("CASE_FOLDER"))}}):n.jsxs(n.Fragment,{children:[n.jsx(Wv,{user:e,reports:l,onNewReport:$o,onSelectReport:va,onLogout:Fo,onUpdateReport:(d,m)=>{Lt(d,x=>({...x,...m}))},onDeleteReport:d=>c(m=>m.filter(x=>x.id!==d)),onFinanceTaskCreate:Yi,onNotifyLawyerFromFinance:Gi,onSheetDeleted:d=>{c(m=>m.map(x=>x.expensesSheetId===d?{...x,expensesSheetId:void 0,expensesHtml:void 0,expensesSnapshotAt:void 0}:x))},caseTemplates:Ke,onStartTemplate:or,onStartNextReport:es,archiveAfterMs:Tv,favoriteProviders:H,onSaveFavorite:Ti,onDeleteFavorite:Ri,onOpenWorksheet:Ai,onRequestReminder:d=>{le(d),Ee(`Reminder for ${d.insuredName||"case"}`)},onRequestNote:d=>{D(d),ue("")},onSoftDeleteReport:Wi,onRestoreReport:zi,notifications:U.filter(d=>!d.targetUserId||d.targetUserId===(e==null?void 0:e.id)),showNotifications:q,setShowNotifications:ee,onClearNotifications:()=>z([]),dailySummaryOptIn:G,setDailySummaryOptIn:se,caseFolders:ae,onOpenCaseFolder:d=>{const m=Se(d);m&&(Re(x=>{const k=Mc(x,l);return Dn(k),k}),st(m),o("CASE_FOLDER"))},onOpenAssistant:()=>He(!0)}),Po&&n.jsx("div",{className:"fixed inset-0 bg-black/50 z-[250] flex items-center justify-center p-4",dir:"rtl",children:n.jsxs("div",{className:"bg-panel rounded-2xl shadow-2xl w-full max-w-md p-6 space-y-4",children:[n.jsx("h3",{className:"text-lg font-bold text-gold",children:"  "}),n.jsx("p",{className:"text-sm text-textLight",children:"     .        ."}),n.jsxs("div",{className:"flex flex-wrap gap-2 justify-end",children:[n.jsx("button",{type:"button",onClick:()=>{Hp(l,i,ae),Os(!0)},className:"px-4 py-2 rounded-lg bg-navy text-gold text-sm font-semibold hover:bg-navySecondary",children:" "}),n.jsx("button",{type:"button",onClick:Bo,disabled:!_s,title:_s?"":"    ",className:"px-4 py-2 rounded-lg bg-red-600 text-white text-sm font-semibold hover:bg-red-700 disabled:opacity-50 disabled:cursor-not-allowed",children:""}),n.jsx("button",{type:"button",onClick:()=>{Rr(!1),Os(!1)},className:"px-4 py-2 rounded-lg border border-borderDark text-textLight text-sm hover:bg-navySecondary",children:""})]}),_s&&n.jsx("p",{className:"text-xs text-green-600",children:" .   ."})]})}),(e==null?void 0:e.role)==="LAWYER"&&V&&n.jsx("div",{className:"fixed inset-0 z-[250] flex items-center justify-center bg-black/40",children:n.jsxs("div",{className:"bg-panel rounded-2xl shadow-xl max-w-sm w-full mx-4 p-5 space-y-3",dir:"rtl",children:[n.jsx("h2",{className:"text-sm font-bold text-textLight text-right",children:"    "}),n.jsx("p",{className:"text-xs text-textMuted text-right",children:'/   .         / " .          .'}),n.jsx("input",{type:"text",className:"w-full border border-borderDark rounded px-3 py-1.5 text-sm text-textLight",placeholder:": 1/123",value:Rt,onChange:d=>yt(d.target.value)}),n.jsxs("div",{className:"flex justify-end gap-2 mt-2",children:[n.jsx("button",{type:"button",className:"px-3 py-1.5 rounded-md border border-borderDark text-xs text-textLight bg-panel hover:bg-slate-50",onClick:()=>{ie(!1),yt("")},children:""}),n.jsx("button",{type:"button",className:"px-3 py-1.5 rounded-md bg-navy text-xs font-semibold text-gold hover:bg-navySecondary",onClick:()=>{const d=Rt.trim();if(!d){alert("    .");return}const m=d,x=ae[m],k=new Date().toISOString();if(x){const v=en(),_=ge(x),$=Ds({odakanitNo:x.odakanitNo,reports:l,caseFolder:x}),B={...v,odakanitNo:x.odakanitNo,reportSubject:x.reTemplate||"",insuredName:x.insuredName||"",plaintiffName:x.plaintiffName||"",insurerName:x.insurerName||"",marketRef:x.marketRef||"",lineSlipNo:x.lineSlipNo||"",certificateRef:x.certificateRef||"",reportDate:k,updatedAt:k,reportHistory:_,reportNumber:$};if(u(B),o("STEP1"),typeof window<"u")try{localStorage.setItem(ht.CURRENT_REPORT,B.id)}catch{}Wn(B,k)}else{const _={...en(),odakanitNo:m};if(u(_),o("STEP1"),typeof window<"u")try{localStorage.setItem(ht.CURRENT_REPORT,_.id)}catch{}Wn(_,k)}ie(!1),yt("")},children:""})]})]})})]});if(!i)return null;const Cr=typeof i.reportNumber=="number"&&i.reportNumber>0?i.reportNumber:(((Z=i.reportHistory)==null?void 0:Z.length)||0)+1,Ho=yh(i.selectedSections||[]),Uo=Ho.map((d,m)=>({id:`${m}-${d.replace(/\s+/g,"-")||"title"}`,label:d})).filter(d=>!!d.label),Xi=Od(Ho),Wo=i.fileNameTitles&&i.fileNameTitles.length?i.fileNameTitles:Xi,f=Cr!==1&&Uo.length>0,T=j.map(d=>{const m=Un(d.reportId);return m?{...d,report:m,title:`${m.insuredName||"Case"} (${m.ownerName})`}:null}).filter(Boolean),K=L?Un(L):null;return n.jsxs(n.Fragment,{children:[n.jsx("div",{className:"min-h-screen bg-navySecondary pb-12",children:n.jsxs("div",{className:"w-full pt-6 px-6 md:px-8 lg:px-10 xl:px-12",children:[n.jsxs("div",{className:"flex justify-between items-center mb-8",children:[n.jsxs("div",{className:"flex items-center bg-panel p-2 rounded-full shadow-sm",children:[n.jsx("div",{className:`px-4 py-1 rounded-full ${a==="STEP1"?"bg-navy text-white font-bold":"text-textMuted"}`,children:"1. Setup"}),n.jsx(is,{className:"w-4 h-4 text-gray-300 mx-2"}),n.jsx("div",{className:`px-4 py-1 rounded-full ${a==="STEP2"?"bg-navy text-white font-bold":"text-textMuted"}`,children:"2. Draft"}),n.jsx(is,{className:"w-4 h-4 text-gray-300 mx-2"}),n.jsx("div",{className:`px-4 py-1 rounded-full ${a==="PREVIEW"?"bg-navy text-white font-bold":"text-textMuted"}`,children:"3. Preview"})]}),n.jsxs("button",{type:"button",onClick:()=>He(!0),className:"flex items-center text-[11px] px-3 py-1.5 rounded-full bg-indigo-50 text-indigo-800 border border-indigo-200 hover:bg-indigo-100",title:"     ,     .",children:[n.jsx(ia,{className:"w-3 h-3 ml-1"})," "]})]}),i&&(()=>{const d=Se(i.odakanitNo),m=d&&ae?ae[d]:void 0,x=vt(i,m||void 0),k=!!(m!=null&&m.closedAt),v=(e==null?void 0:e.role)==="ADMIN"&&N===i.id;return(x.isLocked||k)&&!(v&&!k)})()&&n.jsxs("div",{className:"mb-4 rounded-2xl border border-amber-300 bg-amber-50 px-4 py-3 text-xs text-amber-900 flex items-start justify-between gap-3",children:[n.jsxs("div",{children:[n.jsx("p",{className:"font-semibold text-[13px]",children:(()=>{const d=Se(i.odakanitNo),m=d&&ae?ae[d]:void 0,x=vt(i,m||void 0);return m!=null&&m.closedAt?"      .":x.lockType==="MANUAL"?"   .":x.lockType==="AUTO"&&x.lockAt?`    ${new Date(x.lockAt).toLocaleDateString("he-IL")}.`:"  ."})()}),n.jsx("p",{className:"mt-1 text-[11px]",children:'  ,    PDF,      "     .'})]}),(e==null?void 0:e.role)==="ADMIN"&&n.jsxs("div",{className:"flex flex-col items-end gap-2",children:[(()=>{const d=Se(i.odakanitNo),m=d&&ae?ae[d]:void 0,x=vt(i,m||void 0);return i.status==="SENT"&&!x.isLocked})()&&n.jsx("button",{type:"button",className:"shrink-0 inline-flex items-center rounded-full bg-panel px-3 py-1.5 text-[11px] font-semibold text-amber-900 border border-amber-300 hover:bg-amber-100",onClick:()=>{const d=window.prompt(`      .
 /     (  ):`);if(!d||!d.trim())return;w(i.id);const m=new Date().toISOString(),x=e.id,k=e.name;Gt({lastAdminOverrideAt:m,lastAdminOverrideById:x,lastAdminOverrideByName:k,lastAdminOverrideReason:d.trim()})},children:"  ()"}),(()=>{const d=Se(i.odakanitNo),m=d&&ae?ae[d]:void 0,x=vt(i,m||void 0),k=!x.isLocked&&!!i.firstSentAt&&!(m!=null&&m.closedAt),v=!(m!=null&&m.closedAt)&&!i.manualLockedAt&&!x.isLocked;return n.jsxs("div",{className:"flex flex-wrap gap-2 justify-end",children:[k&&n.jsx("button",{type:"button",className:"inline-flex items-center rounded-full bg-amber-100 px-3 py-1.5 text-[10px] font-semibold text-amber-900 border border-amber-300 hover:bg-amber-200",onClick:()=>{const _=window.prompt(`   -35  .
 /   (  ):`);if(!_||!_.trim())return;const $=new Date().toISOString(),B=i.lockExtensions||[];Gt({lockExtensions:[...B,{extendedAt:$,extendedById:e.id,extendedByName:e.name,days:35,reason:_.trim()}]})},children:"   (+35 )"}),v&&n.jsx("button",{type:"button",className:"inline-flex items-center rounded-full bg-amber-100 px-3 py-1.5 text-[10px] font-semibold text-amber-900 border border-amber-300 hover:bg-amber-200",onClick:()=>{const _=window.prompt(`     .
 /     (  ):`);if(!_||!_.trim())return;const $=new Date().toISOString();Gt({manualLockedAt:$,manualLockedById:e.id,manualLockedByName:e.name,manualLockReason:_.trim()})},children:"  "})]})})()]})]}),a==="STEP1"&&n.jsx($v,{data:i,updateData:Gt,onNext:()=>{if(i){const d=Se(i.odakanitNo),m=d&&ae?ae[d]:void 0;vt(i,m||void 0).isLocked||mn()}o("STEP2")},onBack:()=>{if(i){const d=Se(i.odakanitNo),m=d&&ae?ae[d]:void 0;vt(i,m||void 0).isLocked||mn()}o("DASHBOARD")},currentUser:e,timelineGallery:b,onAddTimelineImages:d=>h(m=>[...m,...d.map(x=>({...x,id:Date.now().toString()}))]),onRemoveTimelineImage:d=>h(m=>m.filter(x=>x.id!==d)),onSaveAndExit:()=>{if(i){const d=Se(i.odakanitNo),m=d&&ae?ae[d]:void 0;vt(i,m||void 0).isLocked||mn()}o("DASHBOARD")},readOnly:!!i&&(()=>{const d=Se(i.odakanitNo),m=d&&ae?ae[d]:void 0,x=vt(i,m||void 0),k=!!(m!=null&&m.closedAt),v=(e==null?void 0:e.role)==="ADMIN"&&N===i.id&&!k,_=(e==null?void 0:e.role)==="LAWYER"&&i.status==="SENT";return v?!1:_||k?!0:x.isLocked})()}),a==="STEP2"&&n.jsx(Hv,{data:i,updateData:Gt,onNext:()=>{if(i){const d=Se(i.odakanitNo),m=d&&ae?ae[d]:void 0;vt(i,m||void 0).isLocked||mn()}o("PREVIEW")},onBack:()=>{if(i){const d=Se(i.odakanitNo),m=d&&ae?ae[d]:void 0;vt(i,m||void 0).isLocked||mn()}o("STEP1")},currentUser:e,timelineGallery:b,onAddTimelineImages:d=>{},onSaveAndExit:()=>{if(i){const d=Se(i.odakanitNo),m=d&&ae?ae[d]:void 0;vt(i,m||void 0).isLocked||mn()}o("DASHBOARD")},onSaveDraft:i&&(()=>{const d=Se(i.odakanitNo),m=d&&ae?ae[d]:void 0,x=vt(i,m||void 0);if(!((e==null?void 0:e.role)==="LAWYER"&&i.status==="SENT"||x.isLocked))return mn})(),onTranslate:i&&(()=>{const d=Se(i.odakanitNo),m=d&&ae?ae[d]:void 0,x=vt(i,m||void 0);if(!((e==null?void 0:e.role)==="LAWYER"&&i.status==="SENT"||x.isLocked))return Ci})(),onFormatContent:i&&(()=>{const d=Se(i.odakanitNo),m=d&&ae?ae[d]:void 0,x=vt(i,m||void 0);if(!((e==null?void 0:e.role)==="LAWYER"&&i.status==="SENT"||x.isLocked))return sn})(),onSubmitHebrewForReview:i&&(()=>{const d=Se(i.odakanitNo),m=d&&ae?ae[d]:void 0,x=vt(i,m||void 0);if(!((e==null?void 0:e.role)==="LAWYER"&&i.status==="SENT"||x.isLocked))return()=>Ie(i.id)})(),onApproveHebrewForTranslation:i&&(()=>{const d=Se(i.odakanitNo),m=d&&ae?ae[d]:void 0,x=vt(i,m||void 0);if(!((e==null?void 0:e.role)==="LAWYER"&&i.status==="SENT"||x.isLocked))return()=>mt(i.id)})(),onAddReviewIssues:i&&(()=>{const d=Se(i.odakanitNo),m=d&&ae?ae[d]:void 0,x=vt(i,m||void 0);if(!((e==null?void 0:e.role)==="LAWYER"&&i.status==="SENT"||x.isLocked))return v=>lt(i.id,v)})(),onMarkReviewIssueDone:i&&(()=>{const d=Se(i.odakanitNo),m=d&&ae?ae[d]:void 0,x=vt(i,m||void 0);if(!((e==null?void 0:e.role)==="LAWYER"&&i.status==="SENT"||x.isLocked))return v=>tn(i.id,v)})(),onAddExternalFeedbackIssues:i&&(()=>{const d=Se(i.odakanitNo),m=d&&ae?ae[d]:void 0,x=vt(i,m||void 0);if(!((e==null?void 0:e.role)==="LAWYER"&&i.status==="SENT"||x.isLocked))return(v,_)=>Do(i.id,v,_)})(),onReopenHebrewDueToExternalFeedback:i&&(()=>{const d=Se(i.odakanitNo),m=d&&ae?ae[d]:void 0,x=vt(i,m||void 0);if(!((e==null?void 0:e.role)==="LAWYER"&&i.status==="SENT"||x.isLocked))return()=>ga(i.id)})(),step1Focus:E,onStep1FocusConsumed:()=>W(null),isTranslating:Ye,isImprovingEnglish:X,onImproveEnglish:i&&(()=>{const d=Se(i.odakanitNo),m=d&&ae?ae[d]:void 0,x=vt(i,m||void 0);if(!((e==null?void 0:e.role)==="LAWYER"&&i.status==="SENT"||x.isLocked))return Di})(),onOpenAssistant:()=>He(!0),onActiveSectionChange:d=>Ce(d),readOnly:!!i&&(()=>{const d=(e==null?void 0:e.role)==="ADMIN"&&N===i.id;if(!i)return!1;const m=Se(i.odakanitNo),x=m&&ae?ae[m]:void 0,k=vt(i,x||void 0);return!d&&k.isLocked})()}),a==="PREVIEW"&&(()=>{const d=wv(e==null?void 0:e.role),m=(e==null?void 0:e.role)==="LAWYER";return n.jsxs("div",{className:"space-y-6 animate-fade-in",dir:m?"rtl":void 0,lang:m?"he":void 0,children:[n.jsxs("div",{className:"flex justify-between items-center flex-wrap gap-2",children:[n.jsxs("button",{onClick:()=>{mn(),o("STEP2")},className:"flex items-center text-sm text-textMuted bg-navySecondary px-3 py-1.5 rounded-full hover:bg-borderDark",children:[n.jsx(ei,{className:"w-4 h-4 mr-1"}),d.backToStep2]}),n.jsxs("button",{onClick:()=>{mn(),o("DASHBOARD")},className:"flex items-center text-sm text-lpBlue bg-blue-50 px-3 py-1.5 rounded-full hover:bg-blue-100",children:[n.jsx(_u,{className:"w-4 h-4 mr-1"}),d.backToDashboard]})]}),n.jsxs("div",{className:"flex justify-between items-center bg-panel p-4 rounded shadow mb-4",children:[n.jsxs("div",{children:[n.jsx("h2",{className:"text-xl font-bold text-lpBlue",children:d.title}),n.jsx("p",{className:"mt-1 text-xs text-textMuted",children:"Export options let you back up the current report data (JSON/CSV) in addition to the PDF."})]}),n.jsxs("div",{className:"flex gap-2 flex-wrap justify-end items-center",children:[n.jsxs("button",{type:"button",onClick:()=>He(!0),className:"flex items-center text-[11px] px-3 py-1.5 rounded-full bg-indigo-50 text-indigo-800 border border-indigo-200 hover:bg-indigo-100",title:"         PDF.",children:[n.jsx(ia,{className:"w-3 h-3 mr-1"})," "]}),n.jsx("button",{onClick:()=>P(x=>!x),className:"flex items-center bg-borderDark text-textLight px-4 py-2 rounded hover:bg-borderDark",children:S?d.toggleHide:d.toggleShow}),n.jsxs("button",{onClick:Oi,disabled:Ze,className:"flex items-center bg-panel text-textLight border border-borderDark px-4 py-2 rounded hover:bg-navySecondary disabled:opacity-50",children:[Ze?n.jsx(Bt,{className:"w-4 h-4 mr-2 animate-spin"}):n.jsx(yo,{className:"w-4 h-4 mr-2"}),d.downloadPdf]}),n.jsx("button",{onClick:()=>et(!0),disabled:!f,className:"flex items-center bg-panel text-textLight border border-borderDark px-4 py-2 rounded hover:bg-navySecondary disabled:opacity-40",children:d.editFileNames}),n.jsx("button",{onClick:()=>{const x={report:i},k=new Blob([JSON.stringify(x,null,2)],{type:"application/json"}),v=URL.createObjectURL(k),_=document.createElement("a");_.href=v,_.download=`report-${i.odakanitNo||i.id}.json`,_.click(),URL.revokeObjectURL(v)},className:"flex items-center bg-panel text-textLight border border-borderDark px-3 py-2 rounded hover:bg-navySecondary text-xs",children:"JSON Export"}),n.jsx("button",{onClick:()=>{const x=["OdakanitNo","InsuredName","PlaintiffName","InsurerName","MarketRef","LineSlipNo","CertificateRef","ReportDate","Status"],k=[i.odakanitNo||"",i.insuredName||"",i.plaintiffName||"",i.insurerName||"",i.marketRef||"",i.lineSlipNo||"",i.certificateRef||"",i.reportDate||"",i.status||""],v=oe=>{const we=String(oe??"");return/[",\n]/.test(we)?`"${we.replace(/"/g,'""')}"`:we},_=[x.join(","),k.map(v).join(",")].join(`
`),$=new Blob(["\uFEFF"+_],{type:"text/csv;charset=utf-8;"}),B=URL.createObjectURL($),Y=document.createElement("a");Y.href=B,Y.download=`report-${i.odakanitNo||i.id}.csv`,Y.click(),URL.revokeObjectURL(B)},className:"flex items-center bg-panel text-textLight border border-borderDark px-3 py-2 rounded hover:bg-navySecondary text-xs",children:"CSV Export"}),n.jsxs("button",{onClick:Mi,className:"flex items-center bg-green-600 text-white px-4 py-2 rounded hover:bg-green-700",children:[n.jsx(ti,{className:"w-4 h-4 mr-2"}),d.finalize]}),e.role==="ADMIN"&&n.jsxs("button",{onClick:Pi,className:"flex items-center bg-orange-600 text-white px-4 py-2 rounded hover:bg-orange-700",children:[n.jsx(ti,{className:"w-4 h-4 mr-2"}),"   "]})]})]}),S?n.jsxs("div",{className:"bg-panel rounded-2xl shadow p-4 space-y-4",children:[n.jsx("div",{className:"flex items-center justify-end flex-wrap gap-3",children:n.jsx("span",{className:"text-xs text-textMuted",children:d.helperScroll})}),n.jsx("div",{className:"border rounded-2xl bg-navySecondary p-4 pr-6 max-h-[900px] overflow-auto shadow-inner",children:n.jsx("div",{className:"scale-[0.85] origin-top flex justify-center overflow-visible",children:n.jsx(db,{data:i})})})]}):n.jsx("div",{className:"text-center text-textMuted border border-dashed border-borderDark rounded-2xl p-6 bg-navySecondary",children:d.collapsedHint}),n.jsx("div",{className:"flex justify-start mt-4",children:n.jsx("button",{onClick:()=>o("STEP2"),className:"px-6 py-2 bg-borderDark text-textLight rounded hover:bg-borderDark",children:d.backToEditing})})]})})()]})}),i&&n.jsx(kb,{isOpen:C,isSending:te,report:i,userId:e==null?void 0:e.id,recipientsPreview:Ar(i),defaultSubject:hs(i),subjectDraft:((de=i.emailSubjectDraft)==null?void 0:de.trim())||hs(i),onSubjectDraftChange:d=>Gt({emailSubjectDraft:d&&d.trim()?d.trim():void 0}),selectedTopics:i.fileNameTitles||[],onSelectedTopicsChange:d=>Gt({fileNameTitles:d}),isResendMode:Be,onClose:()=>{te||(je(!1),re(!1))},onSend:Be?Bi:Fi}),i&&n.jsx(Ab,{isOpen:Te,availableTitles:Uo,selectedTitles:Wo,onClose:()=>et(!1),onSave:d=>{const m=d.map(x=>x.trim()).filter(Boolean);Gt({fileNameTitles:m}),et(!1)}}),n.jsx(xv,{isOpen:Ve,onClose:()=>{He(!1)},view:a,currentUser:e,currentReport:i,loading:Q,error:xe,response:Fe,onRunIntent:ft}),I&&n.jsx("div",{className:"fixed inset-0 bg-black/40 z-[200] flex items-center justify-center p-4",children:n.jsxs("div",{className:"bg-panel rounded-xl shadow-xl w-full max-w-md p-6 space-y-4",children:[n.jsxs("h3",{className:"text-lg font-bold text-textLight flex items-center gap-2",children:[n.jsx(Ou,{className:"w-4 h-4"})," Add Note"]}),n.jsxs("p",{className:"text-sm text-textMuted",children:["Case: ",I.insuredName||I.odakanitNo||I.id]}),n.jsx(go,{clientId:So,children:n.jsx("textarea",{className:"w-full border rounded p-3 text-sm",rows:4,value:J,onChange:d=>ue(d.target.value),placeholder:"Write your note..."})}),n.jsxs("div",{className:"flex justify-end gap-2",children:[n.jsx("button",{onClick:()=>{D(null),ue("")},className:"px-4 py-2 text-textMuted hover:bg-navySecondary rounded",children:"Cancel"}),n.jsx("button",{onClick:()=>{I&&J.trim()&&($i(I.id,J.trim()),D(null),ue(""))},className:"px-4 py-2 bg-navy text-white rounded hover:bg-navySecondary",children:"Save"})]})]})}),ce&&n.jsx("div",{className:"fixed inset-0 bg-black/40 z-[200] flex items-center justify-center p-4",children:n.jsxs("div",{className:"bg-panel rounded-xl shadow-xl w-full max-w-md p-6 space-y-4",children:[n.jsxs("h3",{className:"text-lg font-bold text-textLight flex items-center gap-2",children:[n.jsx(Zl,{className:"w-4 h-4"})," Send Reminder"]}),n.jsxs("p",{className:"text-sm text-textMuted",children:["Case: ",ce.insuredName||ce.odakanitNo||ce.id]}),n.jsx("label",{className:"text-xs font-bold text-textMuted",children:"Recipients"}),n.jsxs("select",{className:"w-full border rounded p-2 text-sm",value:ve,onChange:d=>$e(d.target.value),children:[n.jsx("option",{value:"LAWYER",children:"Lawyer"}),n.jsx("option",{value:"SUB_ADMIN",children:"Sub-Admin"}),n.jsx("option",{value:"BOTH",children:"Both"})]}),n.jsx("label",{className:"text-xs font-bold text-textMuted",children:"Message"}),n.jsx(go,{clientId:So,children:n.jsx("textarea",{className:"w-full border rounded p-3 text-sm",rows:4,value:fe,onChange:d=>Ee(d.target.value),placeholder:"Reminder details..."})}),n.jsxs("div",{className:"flex justify-end gap-2",children:[n.jsx("button",{onClick:()=>{le(null),Ee("")},className:"px-4 py-2 text-textMuted hover:bg-navySecondary rounded",children:"Cancel"}),n.jsx("button",{onClick:()=>{if(ce&&fe.trim()){const d=[];(ve==="LAWYER"||ve==="BOTH")&&d.push(ce.ownerName),(ve==="SUB_ADMIN"||ve==="BOTH")&&d.push(...js.filter(m=>m.role==="SUB_ADMIN").map(m=>m.name)),kr({id:`reminder-${Date.now()}`,message:`Reminder to ${d.join(", ")}: ${fe.trim()}`,createdAt:new Date().toISOString(),reportId:ce.id}),le(null),Ee("")}},className:"px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700",children:"Send"})]})]})}),Po&&n.jsx("div",{className:"fixed inset-0 bg-black/50 z-[250] flex items-center justify-center p-4",dir:"rtl",children:n.jsxs("div",{className:"bg-panel rounded-2xl shadow-2xl w-full max-w-md p-6 space-y-4",children:[n.jsx("h3",{className:"text-lg font-bold text-gold",children:"  "}),n.jsx("p",{className:"text-sm text-textLight",children:"     .        ."}),n.jsxs("div",{className:"flex flex-wrap gap-2 justify-end",children:[n.jsx("button",{type:"button",onClick:()=>{Hp(l,i,ae),Os(!0)},className:"px-4 py-2 rounded-lg bg-navy text-gold text-sm font-semibold hover:bg-navySecondary",children:" "}),n.jsx("button",{type:"button",onClick:Bo,disabled:!_s,title:_s?"":"    ",className:"px-4 py-2 rounded-lg bg-red-600 text-white text-sm font-semibold hover:bg-red-700 disabled:opacity-50 disabled:cursor-not-allowed",children:""}),n.jsx("button",{type:"button",onClick:()=>{Rr(!1),Os(!1)},className:"px-4 py-2 rounded-lg border border-borderDark text-textLight text-sm hover:bg-navySecondary",children:""})]}),_s&&n.jsx("p",{className:"text-xs text-green-600",children:" .   ."})]})}),_e&&_e.issues.length>0&&n.jsx("div",{className:"fixed inset-0 bg-black/40 z-[210] flex items-center justify-center p-4",children:n.jsxs("div",{className:"bg-panel rounded-2xl shadow-2xl w-full max-w-lg p-6 space-y-4",dir:"rtl",children:[n.jsxs("div",{className:"flex items-center justify-between gap-2",children:[n.jsx("h3",{className:"text-lg font-bold text-textLight",children:"  "}),n.jsx("button",{type:"button",onClick:()=>Me(null),className:"p-1 rounded hover:bg-slate-100 text-textMuted",children:n.jsx(Ht,{className:"w-4 h-4"})})]}),n.jsx("p",{className:"text-xs text-textMuted",children:"       PDF    .       ."}),n.jsx("ul",{className:"space-y-2 text-sm text-textLight",children:_e.issues.map(d=>n.jsxs("li",{className:"flex items-start justify-between gap-3 border border-slate-100 rounded-md px-3 py-2 bg-slate-50",children:[n.jsx("span",{className:"flex-1",children:d.label}),n.jsxs("div",{className:"flex flex-col items-end gap-1",children:[n.jsx("button",{type:"button",className:"text-[11px] text-indigo-700 hover:text-indigo-900 underline whitespace-nowrap",onClick:()=>{He(!0),ft(d.intent)},children:"  ?"}),n.jsx("button",{type:"button",className:"text-[11px] text-textLight hover:text-textLight underline whitespace-nowrap",onClick:()=>{Me(null),(d.kind==="TRANSLATION_OUTDATED"||d.kind==="TONE_RISK_NOT_RUN"||d.kind==="EXPENSES_OLD")&&(mn(),o("STEP2"))},children:d.kind==="TRANSLATION_OUTDATED"?" ":d.kind==="TONE_RISK_NOT_RUN"?" Tone & Risk":d.kind==="EXPENSES_OLD"?"  ":" "})]})]},d.id))}),n.jsx("div",{className:"flex items-center justify-between pt-3 border-t border-slate-100 gap-3",children:n.jsx("button",{type:"button",className:"px-4 py-1.5 rounded-md bg-green-600 text-xs text-white hover:bg-green-700",onClick:()=>{const d=_e;Me(null),d!=null&&d.onContinue&&d.onContinue()},children:"  "})})]})}),K&&n.jsx(Kv,{report:K,sessions:T,onSwitch:O,onClose:Ii,currentUser:e,onAddRowNote:Ui,onResolveRowNote:Vi,onAddWorksheetRow:Ki,previousReport:l.filter(d=>d.id!==K.id&&d.odakanitNo&&d.odakanitNo===K.odakanitNo).sort((d,m)=>new Date(m.reportDate).getTime()-new Date(d.reportDate).getTime())[0]})]})},Kv=({report:e,sessions:t,onSwitch:s,onClose:r,currentUser:a,onAddRowNote:o,onResolveRowNote:l,onAddWorksheetRow:c,previousReport:i})=>{const[u,p]=g.useState("table"),[y,N]=g.useState(""),[w,R]=g.useState(null),[E,W]=g.useState({category:"EXPERT_OUR",serviceProvider:"",amount:"",customLabel:""}),b=e.expenseWorksheet||$s(),h=b.rows.filter(j=>j.type==="EXPENSE"),S=b.rows.filter(j=>j.type==="ADJUSTMENT"),P=b.notes.filter(j=>!j.resolved),U=b.totals||ii(b.rows),z=(a==null?void 0:a.role)==="FINANCE"||(a==null?void 0:a.role)==="SUB_ADMIN",q=ds.find(j=>j.value===E.category),ee=(q==null?void 0:q.type)!=="ADJUSTMENT",G=j=>{y.trim()&&(o(e.id,j,y.trim()),N(""),R(null))},se=()=>{const j=parseFloat(E.amount);isNaN(j)||j<=0||(c(e.id,{category:E.category,serviceProvider:ee?E.serviceProvider:void 0,amount:j,customLabel:E.customLabel}),W({category:"EXPERT_OUR",serviceProvider:"",amount:"",customLabel:""}))};return n.jsx("div",{className:"fixed inset-0 bg-black/40 z-[220] flex items-center justify-center p-4",children:n.jsxs("div",{className:"bg-panel rounded-2xl shadow-2xl w-full max-w-5xl max-h-[90vh] overflow-hidden flex flex-col",children:[n.jsxs("div",{className:"flex justify-between items-center px-5 py-3 border-b bg-navySecondary",children:[n.jsxs("div",{children:[n.jsx("p",{className:"text-xs text-textMuted uppercase",children:"Expense Worksheet"}),n.jsxs("h2",{className:"text-lg font-bold text-textLight",children:[e.insuredName||e.odakanitNo||"Case","  ",e.ownerName]})]}),n.jsx("button",{onClick:()=>r(e.id),className:"text-textMuted hover:text-textLight",children:n.jsx(Ht,{className:"w-5 h-5"})})]}),n.jsx("div",{className:"flex border-b bg-panel px-4 overflow-x-auto",children:t.map(j=>n.jsxs("button",{onClick:()=>s(j.reportId),className:`flex items-center gap-2 px-3 py-2 text-sm border-b-2 ${j.reportId===e.id?"border-lpBlue text-lpBlue font-bold":"border-transparent text-gray-400"}`,children:[j.title,n.jsx("span",{onClick:F=>{F.stopPropagation(),r(j.reportId)},className:"text-gray-400 hover:text-red-500",children:n.jsx(Ht,{className:"w-3 h-3"})})]},j.reportId))}),n.jsx("div",{className:"flex gap-2 px-5 pt-4 text-sm font-semibold",children:["table","history","notes","compare"].map(j=>n.jsx("button",{onClick:()=>p(j),className:`px-3 py-1 rounded-full ${u===j?"bg-navy text-white":"bg-navySecondary text-textMuted"}`,children:j==="table"?"Worksheet":j==="history"?"History":j==="notes"?`Notes (${P.length})`:"Compare"},j))}),n.jsxs("div",{className:"flex-1 overflow-auto p-5 space-y-4",children:[u==="table"&&n.jsxs(n.Fragment,{children:[n.jsxs("div",{className:"grid grid-cols-3 gap-4 text-center bg-navySecondary rounded-lg py-3",children:[n.jsxs("div",{children:[n.jsx("p",{className:"text-xs uppercase text-gray-400",children:"Total Expenses"}),n.jsxs("p",{className:"text-lg font-bold text-textLight",children:["",U.totalExpenses.toLocaleString()]})]}),n.jsxs("div",{children:[n.jsx("p",{className:"text-xs uppercase text-gray-400",children:"Adjustments"}),n.jsxs("p",{className:"text-lg font-bold text-yellow-700",children:["",U.totalAdjustments.toLocaleString()]})]}),n.jsxs("div",{children:[n.jsx("p",{className:"text-xs uppercase text-gray-400",children:"Balance Due"}),n.jsxs("p",{className:"text-lg font-bold text-green-700",children:["",U.totalBalance.toLocaleString()]})]})]}),z&&n.jsxs("div",{className:"border rounded-lg p-3 bg-amber-50 space-y-2",children:[n.jsx("p",{className:"text-xs font-bold text-amber-700",children:"  "}),n.jsxs("div",{className:"grid md:grid-cols-3 gap-2",children:[n.jsx("select",{value:E.category,onChange:j=>W({...E,category:j.target.value}),className:"border rounded text-xs p-2",children:ds.map(j=>n.jsx("option",{value:j.value,children:j.label},j.value))}),E.category==="OTHER"&&n.jsx("input",{className:"border rounded text-xs p-2",placeholder:" ",value:E.customLabel,onChange:j=>W({...E,customLabel:j.target.value})}),ee&&n.jsx("input",{className:"border rounded text-xs p-2",placeholder:" ",value:E.serviceProvider,onChange:j=>W({...E,serviceProvider:j.target.value})}),n.jsx("input",{className:"border rounded text-xs p-2",placeholder:" ",type:"number",min:"0",value:E.amount,onChange:j=>W({...E,amount:j.target.value})}),n.jsx("button",{onClick:se,className:"bg-amber-500 text-white rounded text-xs font-bold px-3 py-2 hover:bg-amber-600",children:"Add"})]})]}),n.jsxs("div",{className:"grid md:grid-cols-2 gap-6",children:[n.jsxs("div",{children:[n.jsx("h4",{className:"text-sm font-bold text-textMuted mb-2",children:"Service Expenses"}),n.jsxs("div",{className:"space-y-2",children:[h.length===0&&n.jsx("p",{className:"text-xs text-gray-400",children:"No expenses recorded."}),h.map(j=>{const F=b.notes.filter(L=>L.rowId===j.id&&!L.resolved).length;return n.jsxs("div",{className:"border rounded-lg p-3 bg-panel shadow-sm",children:[n.jsxs("div",{className:"flex justify-between",children:[n.jsxs("div",{children:[n.jsx("p",{className:"font-semibold text-sm",children:j.label}),j.serviceProvider&&n.jsx("p",{className:"text-xs text-textMuted",children:j.serviceProvider})]}),n.jsxs("div",{className:"text-right",children:[n.jsxs("p",{className:"font-bold text-lpBlue",children:["",j.amount.toLocaleString()]}),n.jsxs("button",{className:"text-[10px] text-gray-400",onClick:()=>R(w===j.id?null:j.id),children:[" Notes (",F,")"]})]})]}),w===j.id&&n.jsxs("div",{className:"mt-2 flex gap-2",children:[n.jsx("input",{className:"flex-1 border rounded text-xs p-2",value:y,onChange:L=>N(L.target.value),placeholder:"Add note..."}),n.jsx("button",{onClick:()=>G(j.id),className:"px-3 py-1 text-xs bg-navy text-white rounded",children:"Save"})]})]},j.id)})]})]}),n.jsxs("div",{children:[n.jsx("h4",{className:"text-sm font-bold text-textMuted mb-2",children:"Adjustments"}),n.jsxs("div",{className:"space-y-2",children:[S.length===0&&n.jsx("p",{className:"text-xs text-gray-400",children:"No adjustments yet."}),S.map(j=>n.jsx("div",{className:"border rounded-lg p-3 bg-navySecondary",children:n.jsxs("div",{className:"flex justify-between",children:[n.jsx("p",{className:"font-semibold text-sm",children:j.label}),n.jsxs("p",{className:"font-bold text-red-600",children:["",j.amount.toLocaleString()]})]})},j.id))]})]})]}),n.jsxs("div",{className:"border rounded-lg p-3 bg-navySecondary",children:[n.jsx("label",{className:"block text-xs font-bold text-textMuted mb-1",children:"General Note"}),n.jsxs("div",{className:"flex gap-2",children:[n.jsx("input",{className:"flex-1 border rounded text-xs p-2",value:y,onChange:j=>N(j.target.value),placeholder:"Add note for worksheet..."}),n.jsx("button",{onClick:()=>G(void 0),className:"px-3 py-1 text-xs bg-navy text-white rounded",children:"Save"})]})]})]}),u==="history"&&n.jsxs("div",{className:"space-y-2",children:[b.history.length===0&&n.jsx("p",{className:"text-xs text-gray-400",children:"No history recorded yet."}),b.history.map(j=>n.jsxs("div",{className:"border rounded-lg p-3 bg-panel flex justify-between",children:[n.jsxs("div",{children:[n.jsx("p",{className:"text-sm font-semibold",children:j.action}),j.details&&n.jsx("p",{className:"text-xs text-textMuted",children:j.details})]}),n.jsxs("div",{className:"text-right text-[10px] text-gray-400",children:[n.jsx("p",{children:j.userName}),n.jsx("p",{children:new Date(j.timestamp).toLocaleString()})]})]},j.id))]}),u==="notes"&&n.jsxs("div",{className:"space-y-2",children:[b.notes.length===0&&n.jsx("p",{className:"text-xs text-gray-400",children:"No notes yet."}),b.notes.map(j=>n.jsx("div",{className:`border rounded-lg p-3 ${j.resolved?"bg-green-50":"bg-panel"}`,children:n.jsxs("div",{className:"flex justify-between",children:[n.jsxs("div",{children:[n.jsx("p",{className:"text-sm font-semibold",children:j.authorName}),n.jsx("p",{className:"text-xs text-textMuted",children:j.message})]}),n.jsxs("div",{className:"text-right text-[10px] text-gray-400",children:[n.jsx("p",{children:new Date(j.createdAt).toLocaleString()}),!j.resolved&&n.jsx("button",{onClick:()=>l(e.id,j.id),className:"text-xs text-green-600 hover:underline",children:"Resolve"})]})]})},j.id))]}),u==="compare"&&n.jsx("div",{children:i!=null&&i.expenseWorksheet?n.jsxs("div",{className:"grid md:grid-cols-2 gap-4",children:[n.jsxs("div",{className:"border rounded-lg p-3",children:[n.jsx("h4",{className:"text-sm font-bold text-textMuted mb-2",children:"Previous Report"}),n.jsx("p",{className:"text-xs text-gray-400 mb-2",children:new Date(i.reportDate).toLocaleDateString()}),n.jsxs("p",{className:"text-lg font-bold text-textLight",children:["",i.expenseWorksheet.totals.totalBalance.toLocaleString()]})]}),n.jsxs("div",{className:"border rounded-lg p-3",children:[n.jsx("h4",{className:"text-sm font-bold text-textMuted mb-2",children:"Current Report"}),n.jsx("p",{className:"text-xs text-gray-400 mb-2",children:new Date(e.reportDate).toLocaleDateString()}),n.jsxs("p",{className:"text-lg font-bold text-textLight",children:["",U.totalBalance.toLocaleString()]})]})]}):n.jsx("p",{className:"text-xs text-gray-400",children:"No previous worksheet available for comparison."})})]})]})})},Yv=()=>n.jsx(rv,{children:n.jsx(Vv,{})}),Xu=document.getElementById("root");console.log("Bootstrapping LP app, rootElement exists?",!!Xu);if(!Xu)throw new Error("Could not find root element to mount to");const Gv=Bc.createRoot(Xu);Gv.render(n.jsx(ui.StrictMode,{children:n.jsx(Yv,{})}));export{Qh as g};
