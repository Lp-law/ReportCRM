(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))r(a);new MutationObserver(a=>{for(const o of a)if(o.type==="childList")for(const l of o.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&r(l)}).observe(document,{childList:!0,subtree:!0});function s(a){const o={};return a.integrity&&(o.integrity=a.integrity),a.referrerPolicy&&(o.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?o.credentials="include":a.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function r(a){if(a.ep)return;a.ep=!0;const o=s(a);fetch(a.href,o)}})();function Xh(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var Kp={exports:{}},ii={},Yp={exports:{}},tt={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var ko=Symbol.for("react.element"),Jh=Symbol.for("react.portal"),Qh=Symbol.for("react.fragment"),Zh=Symbol.for("react.strict_mode"),eg=Symbol.for("react.profiler"),tg=Symbol.for("react.provider"),ng=Symbol.for("react.context"),sg=Symbol.for("react.forward_ref"),rg=Symbol.for("react.suspense"),ag=Symbol.for("react.memo"),og=Symbol.for("react.lazy"),Ju=Symbol.iterator;function lg(e){return e===null||typeof e!="object"?null:(e=Ju&&e[Ju]||e["@@iterator"],typeof e=="function"?e:null)}var Gp={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},qp=Object.assign,Xp={};function ca(e,t,s){this.props=e,this.context=t,this.refs=Xp,this.updater=s||Gp}ca.prototype.isReactComponent={};ca.prototype.setState=function(e,t){if(typeof e!="object"&&typeof e!="function"&&e!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,e,t,"setState")};ca.prototype.forceUpdate=function(e){this.updater.enqueueForceUpdate(this,e,"forceUpdate")};function Jp(){}Jp.prototype=ca.prototype;function Fd(e,t,s){this.props=e,this.context=t,this.refs=Xp,this.updater=s||Gp}var Bd=Fd.prototype=new Jp;Bd.constructor=Fd;qp(Bd,ca.prototype);Bd.isPureReactComponent=!0;var Qu=Array.isArray,Qp=Object.prototype.hasOwnProperty,$d={current:null},Zp={key:!0,ref:!0,__self:!0,__source:!0};function ef(e,t,s){var r,a={},o=null,l=null;if(t!=null)for(r in t.ref!==void 0&&(l=t.ref),t.key!==void 0&&(o=""+t.key),t)Qp.call(t,r)&&!Zp.hasOwnProperty(r)&&(a[r]=t[r]);var c=arguments.length-2;if(c===1)a.children=s;else if(1<c){for(var i=Array(c),u=0;u<c;u++)i[u]=arguments[u+2];a.children=i}if(e&&e.defaultProps)for(r in c=e.defaultProps,c)a[r]===void 0&&(a[r]=c[r]);return{$$typeof:ko,type:e,key:o,ref:l,props:a,_owner:$d.current}}function ig(e,t){return{$$typeof:ko,type:e.type,key:t,ref:e.ref,props:e.props,_owner:e._owner}}function Hd(e){return typeof e=="object"&&e!==null&&e.$$typeof===ko}function cg(e){var t={"=":"=0",":":"=2"};return"$"+e.replace(/[=:]/g,function(s){return t[s]})}var Zu=/\/+/g;function Ji(e,t){return typeof e=="object"&&e!==null&&e.key!=null?cg(""+e.key):t.toString(36)}function fl(e,t,s,r,a){var o=typeof e;(o==="undefined"||o==="boolean")&&(e=null);var l=!1;if(e===null)l=!0;else switch(o){case"string":case"number":l=!0;break;case"object":switch(e.$$typeof){case ko:case Jh:l=!0}}if(l)return l=e,a=a(l),e=r===""?"."+Ji(l,0):r,Qu(a)?(s="",e!=null&&(s=e.replace(Zu,"$&/")+"/"),fl(a,t,s,"",function(u){return u})):a!=null&&(Hd(a)&&(a=ig(a,s+(!a.key||l&&l.key===a.key?"":(""+a.key).replace(Zu,"$&/")+"/")+e)),t.push(a)),1;if(l=0,r=r===""?".":r+":",Qu(e))for(var c=0;c<e.length;c++){o=e[c];var i=r+Ji(o,c);l+=fl(o,t,s,i,a)}else if(i=lg(e),typeof i=="function")for(e=i.call(e),c=0;!(o=e.next()).done;)o=o.value,i=r+Ji(o,c++),l+=fl(o,t,s,i,a);else if(o==="object")throw t=String(e),Error("Objects are not valid as a React child (found: "+(t==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":t)+"). If you meant to render a collection of children, use an array instead.");return l}function zo(e,t,s){if(e==null)return e;var r=[],a=0;return fl(e,r,"","",function(o){return t.call(s,o,a++)}),r}function dg(e){if(e._status===-1){var t=e._result;t=t(),t.then(function(s){(e._status===0||e._status===-1)&&(e._status=1,e._result=s)},function(s){(e._status===0||e._status===-1)&&(e._status=2,e._result=s)}),e._status===-1&&(e._status=0,e._result=t)}if(e._status===1)return e._result.default;throw e._result}var pn={current:null},xl={transition:null},ug={ReactCurrentDispatcher:pn,ReactCurrentBatchConfig:xl,ReactCurrentOwner:$d};function tf(){throw Error("act(...) is not supported in production builds of React.")}tt.Children={map:zo,forEach:function(e,t,s){zo(e,function(){t.apply(this,arguments)},s)},count:function(e){var t=0;return zo(e,function(){t++}),t},toArray:function(e){return zo(e,function(t){return t})||[]},only:function(e){if(!Hd(e))throw Error("React.Children.only expected to receive a single React element child.");return e}};tt.Component=ca;tt.Fragment=Qh;tt.Profiler=eg;tt.PureComponent=Fd;tt.StrictMode=Zh;tt.Suspense=rg;tt.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=ug;tt.act=tf;tt.cloneElement=function(e,t,s){if(e==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+e+".");var r=qp({},e.props),a=e.key,o=e.ref,l=e._owner;if(t!=null){if(t.ref!==void 0&&(o=t.ref,l=$d.current),t.key!==void 0&&(a=""+t.key),e.type&&e.type.defaultProps)var c=e.type.defaultProps;for(i in t)Qp.call(t,i)&&!Zp.hasOwnProperty(i)&&(r[i]=t[i]===void 0&&c!==void 0?c[i]:t[i])}var i=arguments.length-2;if(i===1)r.children=s;else if(1<i){c=Array(i);for(var u=0;u<i;u++)c[u]=arguments[u+2];r.children=c}return{$$typeof:ko,type:e.type,key:a,ref:o,props:r,_owner:l}};tt.createContext=function(e){return e={$$typeof:ng,_currentValue:e,_currentValue2:e,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},e.Provider={$$typeof:tg,_context:e},e.Consumer=e};tt.createElement=ef;tt.createFactory=function(e){var t=ef.bind(null,e);return t.type=e,t};tt.createRef=function(){return{current:null}};tt.forwardRef=function(e){return{$$typeof:sg,render:e}};tt.isValidElement=Hd;tt.lazy=function(e){return{$$typeof:og,_payload:{_status:-1,_result:e},_init:dg}};tt.memo=function(e,t){return{$$typeof:ag,type:e,compare:t===void 0?null:t}};tt.startTransition=function(e){var t=xl.transition;xl.transition={};try{e()}finally{xl.transition=t}};tt.unstable_act=tf;tt.useCallback=function(e,t){return pn.current.useCallback(e,t)};tt.useContext=function(e){return pn.current.useContext(e)};tt.useDebugValue=function(){};tt.useDeferredValue=function(e){return pn.current.useDeferredValue(e)};tt.useEffect=function(e,t){return pn.current.useEffect(e,t)};tt.useId=function(){return pn.current.useId()};tt.useImperativeHandle=function(e,t,s){return pn.current.useImperativeHandle(e,t,s)};tt.useInsertionEffect=function(e,t){return pn.current.useInsertionEffect(e,t)};tt.useLayoutEffect=function(e,t){return pn.current.useLayoutEffect(e,t)};tt.useMemo=function(e,t){return pn.current.useMemo(e,t)};tt.useReducer=function(e,t,s){return pn.current.useReducer(e,t,s)};tt.useRef=function(e){return pn.current.useRef(e)};tt.useState=function(e){return pn.current.useState(e)};tt.useSyncExternalStore=function(e,t,s){return pn.current.useSyncExternalStore(e,t,s)};tt.useTransition=function(){return pn.current.useTransition()};tt.version="18.3.1";Yp.exports=tt;var g=Yp.exports;const ci=Xh(g);/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var mg=g,pg=Symbol.for("react.element"),fg=Symbol.for("react.fragment"),xg=Object.prototype.hasOwnProperty,hg=mg.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,gg={key:!0,ref:!0,__self:!0,__source:!0};function nf(e,t,s){var r,a={},o=null,l=null;s!==void 0&&(o=""+s),t.key!==void 0&&(o=""+t.key),t.ref!==void 0&&(l=t.ref);for(r in t)xg.call(t,r)&&!gg.hasOwnProperty(r)&&(a[r]=t[r]);if(e&&e.defaultProps)for(r in t=e.defaultProps,t)a[r]===void 0&&(a[r]=t[r]);return{$$typeof:pg,type:e,key:o,ref:l,props:a,_owner:hg.current}}ii.Fragment=fg;ii.jsx=nf;ii.jsxs=nf;Kp.exports=ii;var n=Kp.exports,Fc={},sf={exports:{}},Tn={},rf={exports:{}},af={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(e){function t(D,J){var ue=D.length;D.push(J);e:for(;0<ue;){var ce=ue-1>>>1,le=D[ce];if(0<a(le,J))D[ce]=J,D[ue]=le,ue=ce;else break e}}function s(D){return D.length===0?null:D[0]}function r(D){if(D.length===0)return null;var J=D[0],ue=D.pop();if(ue!==J){D[0]=ue;e:for(var ce=0,le=D.length,fe=le>>>1;ce<fe;){var Ee=2*(ce+1)-1,ve=D[Ee],$e=Ee+1,Pe=D[$e];if(0>a(ve,ue))$e<le&&0>a(Pe,ve)?(D[ce]=Pe,D[$e]=ue,ce=$e):(D[ce]=ve,D[Ee]=ue,ce=Ee);else if($e<le&&0>a(Pe,ue))D[ce]=Pe,D[$e]=ue,ce=$e;else break e}}return J}function a(D,J){var ue=D.sortIndex-J.sortIndex;return ue!==0?ue:D.id-J.id}if(typeof performance=="object"&&typeof performance.now=="function"){var o=performance;e.unstable_now=function(){return o.now()}}else{var l=Date,c=l.now();e.unstable_now=function(){return l.now()-c}}var i=[],u=[],p=1,y=null,b=3,w=!1,R=!1,E=!1,W=typeof setTimeout=="function"?setTimeout:null,N=typeof clearTimeout=="function"?clearTimeout:null,h=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function S(D){for(var J=s(u);J!==null;){if(J.callback===null)r(u);else if(J.startTime<=D)r(u),J.sortIndex=J.expirationTime,t(i,J);else break;J=s(u)}}function P(D){if(E=!1,S(D),!R)if(s(i)!==null)R=!0,M(U);else{var J=s(u);J!==null&&I(P,J.startTime-D)}}function U(D,J){R=!1,E&&(E=!1,N(te),te=-1),w=!0;var ue=b;try{for(S(J),y=s(i);y!==null&&(!(y.expirationTime>J)||D&&!j());){var ce=y.callback;if(typeof ce=="function"){y.callback=null,b=y.priorityLevel;var le=ce(y.expirationTime<=J);J=e.unstable_now(),typeof le=="function"?y.callback=le:y===s(i)&&r(i),S(J)}else r(i);y=s(i)}if(y!==null)var fe=!0;else{var Ee=s(u);Ee!==null&&I(P,Ee.startTime-J),fe=!1}return fe}finally{y=null,b=ue,w=!1}}var V=!1,X=null,te=-1,G=5,ae=-1;function j(){return!(e.unstable_now()-ae<G)}function F(){if(X!==null){var D=e.unstable_now();ae=D;var J=!0;try{J=X(!0,D)}finally{J?L():(V=!1,X=null)}}else V=!1}var L;if(typeof h=="function")L=function(){h(F)};else if(typeof MessageChannel<"u"){var O=new MessageChannel,H=O.port2;O.port1.onmessage=F,L=function(){H.postMessage(null)}}else L=function(){W(F,0)};function M(D){X=D,V||(V=!0,L())}function I(D,J){te=W(function(){D(e.unstable_now())},J)}e.unstable_IdlePriority=5,e.unstable_ImmediatePriority=1,e.unstable_LowPriority=4,e.unstable_NormalPriority=3,e.unstable_Profiling=null,e.unstable_UserBlockingPriority=2,e.unstable_cancelCallback=function(D){D.callback=null},e.unstable_continueExecution=function(){R||w||(R=!0,M(U))},e.unstable_forceFrameRate=function(D){0>D||125<D?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):G=0<D?Math.floor(1e3/D):5},e.unstable_getCurrentPriorityLevel=function(){return b},e.unstable_getFirstCallbackNode=function(){return s(i)},e.unstable_next=function(D){switch(b){case 1:case 2:case 3:var J=3;break;default:J=b}var ue=b;b=J;try{return D()}finally{b=ue}},e.unstable_pauseExecution=function(){},e.unstable_requestPaint=function(){},e.unstable_runWithPriority=function(D,J){switch(D){case 1:case 2:case 3:case 4:case 5:break;default:D=3}var ue=b;b=D;try{return J()}finally{b=ue}},e.unstable_scheduleCallback=function(D,J,ue){var ce=e.unstable_now();switch(typeof ue=="object"&&ue!==null?(ue=ue.delay,ue=typeof ue=="number"&&0<ue?ce+ue:ce):ue=ce,D){case 1:var le=-1;break;case 2:le=250;break;case 5:le=1073741823;break;case 4:le=1e4;break;default:le=5e3}return le=ue+le,D={id:p++,callback:J,priorityLevel:D,startTime:ue,expirationTime:le,sortIndex:-1},ue>ce?(D.sortIndex=ue,t(u,D),s(i)===null&&D===s(u)&&(E?(N(te),te=-1):E=!0,I(P,ue-ce))):(D.sortIndex=le,t(i,D),R||w||(R=!0,M(U))),D},e.unstable_shouldYield=j,e.unstable_wrapCallback=function(D){var J=b;return function(){var ue=b;b=J;try{return D.apply(this,arguments)}finally{b=ue}}}})(af);rf.exports=af;var yg=rf.exports;/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Ng=g,In=yg;function me(e){for(var t="https://reactjs.org/docs/error-decoder.html?invariant="+e,s=1;s<arguments.length;s++)t+="&args[]="+encodeURIComponent(arguments[s]);return"Minified React error #"+e+"; visit "+t+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var of=new Set,Qa={};function Sr(e,t){Zr(e,t),Zr(e+"Capture",t)}function Zr(e,t){for(Qa[e]=t,e=0;e<t.length;e++)of.add(t[e])}var Es=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),Bc=Object.prototype.hasOwnProperty,bg=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,em={},tm={};function vg(e){return Bc.call(tm,e)?!0:Bc.call(em,e)?!1:bg.test(e)?tm[e]=!0:(em[e]=!0,!1)}function Sg(e,t,s,r){if(s!==null&&s.type===0)return!1;switch(typeof t){case"function":case"symbol":return!0;case"boolean":return r?!1:s!==null?!s.acceptsBooleans:(e=e.toLowerCase().slice(0,5),e!=="data-"&&e!=="aria-");default:return!1}}function wg(e,t,s,r){if(t===null||typeof t>"u"||Sg(e,t,s,r))return!0;if(r)return!1;if(s!==null)switch(s.type){case 3:return!t;case 4:return t===!1;case 5:return isNaN(t);case 6:return isNaN(t)||1>t}return!1}function fn(e,t,s,r,a,o,l){this.acceptsBooleans=t===2||t===3||t===4,this.attributeName=r,this.attributeNamespace=a,this.mustUseProperty=s,this.propertyName=e,this.type=t,this.sanitizeURL=o,this.removeEmptyString=l}var Jt={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(e){Jt[e]=new fn(e,0,!1,e,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(e){var t=e[0];Jt[t]=new fn(t,1,!1,e[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(e){Jt[e]=new fn(e,2,!1,e.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(e){Jt[e]=new fn(e,2,!1,e,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(e){Jt[e]=new fn(e,3,!1,e.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(e){Jt[e]=new fn(e,3,!0,e,null,!1,!1)});["capture","download"].forEach(function(e){Jt[e]=new fn(e,4,!1,e,null,!1,!1)});["cols","rows","size","span"].forEach(function(e){Jt[e]=new fn(e,6,!1,e,null,!1,!1)});["rowSpan","start"].forEach(function(e){Jt[e]=new fn(e,5,!1,e.toLowerCase(),null,!1,!1)});var Ud=/[\-:]([a-z])/g;function Wd(e){return e[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(e){var t=e.replace(Ud,Wd);Jt[t]=new fn(t,1,!1,e,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(e){var t=e.replace(Ud,Wd);Jt[t]=new fn(t,1,!1,e,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(e){var t=e.replace(Ud,Wd);Jt[t]=new fn(t,1,!1,e,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(e){Jt[e]=new fn(e,1,!1,e.toLowerCase(),null,!1,!1)});Jt.xlinkHref=new fn("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(e){Jt[e]=new fn(e,1,!1,e.toLowerCase(),null,!0,!0)});function zd(e,t,s,r){var a=Jt.hasOwnProperty(t)?Jt[t]:null;(a!==null?a.type!==0:r||!(2<t.length)||t[0]!=="o"&&t[0]!=="O"||t[1]!=="n"&&t[1]!=="N")&&(wg(t,s,a,r)&&(s=null),r||a===null?vg(t)&&(s===null?e.removeAttribute(t):e.setAttribute(t,""+s)):a.mustUseProperty?e[a.propertyName]=s===null?a.type===3?!1:"":s:(t=a.attributeName,r=a.attributeNamespace,s===null?e.removeAttribute(t):(a=a.type,s=a===3||a===4&&s===!0?"":""+s,r?e.setAttributeNS(r,t,s):e.setAttribute(t,s))))}var Ts=Ng.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,Vo=Symbol.for("react.element"),_r=Symbol.for("react.portal"),Or=Symbol.for("react.fragment"),Vd=Symbol.for("react.strict_mode"),$c=Symbol.for("react.profiler"),lf=Symbol.for("react.provider"),cf=Symbol.for("react.context"),Kd=Symbol.for("react.forward_ref"),Hc=Symbol.for("react.suspense"),Uc=Symbol.for("react.suspense_list"),Yd=Symbol.for("react.memo"),_s=Symbol.for("react.lazy"),df=Symbol.for("react.offscreen"),nm=Symbol.iterator;function Ea(e){return e===null||typeof e!="object"?null:(e=nm&&e[nm]||e["@@iterator"],typeof e=="function"?e:null)}var It=Object.assign,Qi;function Ma(e){if(Qi===void 0)try{throw Error()}catch(s){var t=s.stack.trim().match(/\n( *(at )?)/);Qi=t&&t[1]||""}return`
`+Qi+e}var Zi=!1;function ec(e,t){if(!e||Zi)return"";Zi=!0;var s=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(t)if(t=function(){throw Error()},Object.defineProperty(t.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(t,[])}catch(u){var r=u}Reflect.construct(e,[],t)}else{try{t.call()}catch(u){r=u}e.call(t.prototype)}else{try{throw Error()}catch(u){r=u}e()}}catch(u){if(u&&r&&typeof u.stack=="string"){for(var a=u.stack.split(`
`),o=r.stack.split(`
`),l=a.length-1,c=o.length-1;1<=l&&0<=c&&a[l]!==o[c];)c--;for(;1<=l&&0<=c;l--,c--)if(a[l]!==o[c]){if(l!==1||c!==1)do if(l--,c--,0>c||a[l]!==o[c]){var i=`
`+a[l].replace(" at new "," at ");return e.displayName&&i.includes("<anonymous>")&&(i=i.replace("<anonymous>",e.displayName)),i}while(1<=l&&0<=c);break}}}finally{Zi=!1,Error.prepareStackTrace=s}return(e=e?e.displayName||e.name:"")?Ma(e):""}function jg(e){switch(e.tag){case 5:return Ma(e.type);case 16:return Ma("Lazy");case 13:return Ma("Suspense");case 19:return Ma("SuspenseList");case 0:case 2:case 15:return e=ec(e.type,!1),e;case 11:return e=ec(e.type.render,!1),e;case 1:return e=ec(e.type,!0),e;default:return""}}function Wc(e){if(e==null)return null;if(typeof e=="function")return e.displayName||e.name||null;if(typeof e=="string")return e;switch(e){case Or:return"Fragment";case _r:return"Portal";case $c:return"Profiler";case Vd:return"StrictMode";case Hc:return"Suspense";case Uc:return"SuspenseList"}if(typeof e=="object")switch(e.$$typeof){case cf:return(e.displayName||"Context")+".Consumer";case lf:return(e._context.displayName||"Context")+".Provider";case Kd:var t=e.render;return e=e.displayName,e||(e=t.displayName||t.name||"",e=e!==""?"ForwardRef("+e+")":"ForwardRef"),e;case Yd:return t=e.displayName||null,t!==null?t:Wc(e.type)||"Memo";case _s:t=e._payload,e=e._init;try{return Wc(e(t))}catch{}}return null}function Eg(e){var t=e.type;switch(e.tag){case 24:return"Cache";case 9:return(t.displayName||"Context")+".Consumer";case 10:return(t._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return e=t.render,e=e.displayName||e.name||"",t.displayName||(e!==""?"ForwardRef("+e+")":"ForwardRef");case 7:return"Fragment";case 5:return t;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return Wc(t);case 8:return t===Vd?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof t=="function")return t.displayName||t.name||null;if(typeof t=="string")return t}return null}function Qs(e){switch(typeof e){case"boolean":case"number":case"string":case"undefined":return e;case"object":return e;default:return""}}function uf(e){var t=e.type;return(e=e.nodeName)&&e.toLowerCase()==="input"&&(t==="checkbox"||t==="radio")}function kg(e){var t=uf(e)?"checked":"value",s=Object.getOwnPropertyDescriptor(e.constructor.prototype,t),r=""+e[t];if(!e.hasOwnProperty(t)&&typeof s<"u"&&typeof s.get=="function"&&typeof s.set=="function"){var a=s.get,o=s.set;return Object.defineProperty(e,t,{configurable:!0,get:function(){return a.call(this)},set:function(l){r=""+l,o.call(this,l)}}),Object.defineProperty(e,t,{enumerable:s.enumerable}),{getValue:function(){return r},setValue:function(l){r=""+l},stopTracking:function(){e._valueTracker=null,delete e[t]}}}}function Ko(e){e._valueTracker||(e._valueTracker=kg(e))}function mf(e){if(!e)return!1;var t=e._valueTracker;if(!t)return!0;var s=t.getValue(),r="";return e&&(r=uf(e)?e.checked?"true":"false":e.value),e=r,e!==s?(t.setValue(e),!0):!1}function Al(e){if(e=e||(typeof document<"u"?document:void 0),typeof e>"u")return null;try{return e.activeElement||e.body}catch{return e.body}}function zc(e,t){var s=t.checked;return It({},t,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:s??e._wrapperState.initialChecked})}function sm(e,t){var s=t.defaultValue==null?"":t.defaultValue,r=t.checked!=null?t.checked:t.defaultChecked;s=Qs(t.value!=null?t.value:s),e._wrapperState={initialChecked:r,initialValue:s,controlled:t.type==="checkbox"||t.type==="radio"?t.checked!=null:t.value!=null}}function pf(e,t){t=t.checked,t!=null&&zd(e,"checked",t,!1)}function Vc(e,t){pf(e,t);var s=Qs(t.value),r=t.type;if(s!=null)r==="number"?(s===0&&e.value===""||e.value!=s)&&(e.value=""+s):e.value!==""+s&&(e.value=""+s);else if(r==="submit"||r==="reset"){e.removeAttribute("value");return}t.hasOwnProperty("value")?Kc(e,t.type,s):t.hasOwnProperty("defaultValue")&&Kc(e,t.type,Qs(t.defaultValue)),t.checked==null&&t.defaultChecked!=null&&(e.defaultChecked=!!t.defaultChecked)}function rm(e,t,s){if(t.hasOwnProperty("value")||t.hasOwnProperty("defaultValue")){var r=t.type;if(!(r!=="submit"&&r!=="reset"||t.value!==void 0&&t.value!==null))return;t=""+e._wrapperState.initialValue,s||t===e.value||(e.value=t),e.defaultValue=t}s=e.name,s!==""&&(e.name=""),e.defaultChecked=!!e._wrapperState.initialChecked,s!==""&&(e.name=s)}function Kc(e,t,s){(t!=="number"||Al(e.ownerDocument)!==e)&&(s==null?e.defaultValue=""+e._wrapperState.initialValue:e.defaultValue!==""+s&&(e.defaultValue=""+s))}var Pa=Array.isArray;function Kr(e,t,s,r){if(e=e.options,t){t={};for(var a=0;a<s.length;a++)t["$"+s[a]]=!0;for(s=0;s<e.length;s++)a=t.hasOwnProperty("$"+e[s].value),e[s].selected!==a&&(e[s].selected=a),a&&r&&(e[s].defaultSelected=!0)}else{for(s=""+Qs(s),t=null,a=0;a<e.length;a++){if(e[a].value===s){e[a].selected=!0,r&&(e[a].defaultSelected=!0);return}t!==null||e[a].disabled||(t=e[a])}t!==null&&(t.selected=!0)}}function Yc(e,t){if(t.dangerouslySetInnerHTML!=null)throw Error(me(91));return It({},t,{value:void 0,defaultValue:void 0,children:""+e._wrapperState.initialValue})}function am(e,t){var s=t.value;if(s==null){if(s=t.children,t=t.defaultValue,s!=null){if(t!=null)throw Error(me(92));if(Pa(s)){if(1<s.length)throw Error(me(93));s=s[0]}t=s}t==null&&(t=""),s=t}e._wrapperState={initialValue:Qs(s)}}function ff(e,t){var s=Qs(t.value),r=Qs(t.defaultValue);s!=null&&(s=""+s,s!==e.value&&(e.value=s),t.defaultValue==null&&e.defaultValue!==s&&(e.defaultValue=s)),r!=null&&(e.defaultValue=""+r)}function om(e){var t=e.textContent;t===e._wrapperState.initialValue&&t!==""&&t!==null&&(e.value=t)}function xf(e){switch(e){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function Gc(e,t){return e==null||e==="http://www.w3.org/1999/xhtml"?xf(t):e==="http://www.w3.org/2000/svg"&&t==="foreignObject"?"http://www.w3.org/1999/xhtml":e}var Yo,hf=function(e){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(t,s,r,a){MSApp.execUnsafeLocalFunction(function(){return e(t,s,r,a)})}:e}(function(e,t){if(e.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in e)e.innerHTML=t;else{for(Yo=Yo||document.createElement("div"),Yo.innerHTML="<svg>"+t.valueOf().toString()+"</svg>",t=Yo.firstChild;e.firstChild;)e.removeChild(e.firstChild);for(;t.firstChild;)e.appendChild(t.firstChild)}});function Za(e,t){if(t){var s=e.firstChild;if(s&&s===e.lastChild&&s.nodeType===3){s.nodeValue=t;return}}e.textContent=t}var $a={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},Ag=["Webkit","ms","Moz","O"];Object.keys($a).forEach(function(e){Ag.forEach(function(t){t=t+e.charAt(0).toUpperCase()+e.substring(1),$a[t]=$a[e]})});function gf(e,t,s){return t==null||typeof t=="boolean"||t===""?"":s||typeof t!="number"||t===0||$a.hasOwnProperty(e)&&$a[e]?(""+t).trim():t+"px"}function yf(e,t){e=e.style;for(var s in t)if(t.hasOwnProperty(s)){var r=s.indexOf("--")===0,a=gf(s,t[s],r);s==="float"&&(s="cssFloat"),r?e.setProperty(s,a):e[s]=a}}var Ig=It({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function qc(e,t){if(t){if(Ig[e]&&(t.children!=null||t.dangerouslySetInnerHTML!=null))throw Error(me(137,e));if(t.dangerouslySetInnerHTML!=null){if(t.children!=null)throw Error(me(60));if(typeof t.dangerouslySetInnerHTML!="object"||!("__html"in t.dangerouslySetInnerHTML))throw Error(me(61))}if(t.style!=null&&typeof t.style!="object")throw Error(me(62))}}function Xc(e,t){if(e.indexOf("-")===-1)return typeof t.is=="string";switch(e){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var Jc=null;function Gd(e){return e=e.target||e.srcElement||window,e.correspondingUseElement&&(e=e.correspondingUseElement),e.nodeType===3?e.parentNode:e}var Qc=null,Yr=null,Gr=null;function lm(e){if(e=To(e)){if(typeof Qc!="function")throw Error(me(280));var t=e.stateNode;t&&(t=fi(t),Qc(e.stateNode,e.type,t))}}function Nf(e){Yr?Gr?Gr.push(e):Gr=[e]:Yr=e}function bf(){if(Yr){var e=Yr,t=Gr;if(Gr=Yr=null,lm(e),t)for(e=0;e<t.length;e++)lm(t[e])}}function vf(e,t){return e(t)}function Sf(){}var tc=!1;function wf(e,t,s){if(tc)return e(t,s);tc=!0;try{return vf(e,t,s)}finally{tc=!1,(Yr!==null||Gr!==null)&&(Sf(),bf())}}function eo(e,t){var s=e.stateNode;if(s===null)return null;var r=fi(s);if(r===null)return null;s=r[t];e:switch(t){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(r=!r.disabled)||(e=e.type,r=!(e==="button"||e==="input"||e==="select"||e==="textarea")),e=!r;break e;default:e=!1}if(e)return null;if(s&&typeof s!="function")throw Error(me(231,t,typeof s));return s}var Zc=!1;if(Es)try{var ka={};Object.defineProperty(ka,"passive",{get:function(){Zc=!0}}),window.addEventListener("test",ka,ka),window.removeEventListener("test",ka,ka)}catch{Zc=!1}function Tg(e,t,s,r,a,o,l,c,i){var u=Array.prototype.slice.call(arguments,3);try{t.apply(s,u)}catch(p){this.onError(p)}}var Ha=!1,Il=null,Tl=!1,ed=null,Rg={onError:function(e){Ha=!0,Il=e}};function Cg(e,t,s,r,a,o,l,c,i){Ha=!1,Il=null,Tg.apply(Rg,arguments)}function Dg(e,t,s,r,a,o,l,c,i){if(Cg.apply(this,arguments),Ha){if(Ha){var u=Il;Ha=!1,Il=null}else throw Error(me(198));Tl||(Tl=!0,ed=u)}}function wr(e){var t=e,s=e;if(e.alternate)for(;t.return;)t=t.return;else{e=t;do t=e,t.flags&4098&&(s=t.return),e=t.return;while(e)}return t.tag===3?s:null}function jf(e){if(e.tag===13){var t=e.memoizedState;if(t===null&&(e=e.alternate,e!==null&&(t=e.memoizedState)),t!==null)return t.dehydrated}return null}function im(e){if(wr(e)!==e)throw Error(me(188))}function Lg(e){var t=e.alternate;if(!t){if(t=wr(e),t===null)throw Error(me(188));return t!==e?null:e}for(var s=e,r=t;;){var a=s.return;if(a===null)break;var o=a.alternate;if(o===null){if(r=a.return,r!==null){s=r;continue}break}if(a.child===o.child){for(o=a.child;o;){if(o===s)return im(a),e;if(o===r)return im(a),t;o=o.sibling}throw Error(me(188))}if(s.return!==r.return)s=a,r=o;else{for(var l=!1,c=a.child;c;){if(c===s){l=!0,s=a,r=o;break}if(c===r){l=!0,r=a,s=o;break}c=c.sibling}if(!l){for(c=o.child;c;){if(c===s){l=!0,s=o,r=a;break}if(c===r){l=!0,r=o,s=a;break}c=c.sibling}if(!l)throw Error(me(189))}}if(s.alternate!==r)throw Error(me(190))}if(s.tag!==3)throw Error(me(188));return s.stateNode.current===s?e:t}function Ef(e){return e=Lg(e),e!==null?kf(e):null}function kf(e){if(e.tag===5||e.tag===6)return e;for(e=e.child;e!==null;){var t=kf(e);if(t!==null)return t;e=e.sibling}return null}var Af=In.unstable_scheduleCallback,cm=In.unstable_cancelCallback,_g=In.unstable_shouldYield,Og=In.unstable_requestPaint,Lt=In.unstable_now,Mg=In.unstable_getCurrentPriorityLevel,qd=In.unstable_ImmediatePriority,If=In.unstable_UserBlockingPriority,Rl=In.unstable_NormalPriority,Pg=In.unstable_LowPriority,Tf=In.unstable_IdlePriority,di=null,us=null;function Fg(e){if(us&&typeof us.onCommitFiberRoot=="function")try{us.onCommitFiberRoot(di,e,void 0,(e.current.flags&128)===128)}catch{}}var qn=Math.clz32?Math.clz32:Hg,Bg=Math.log,$g=Math.LN2;function Hg(e){return e>>>=0,e===0?32:31-(Bg(e)/$g|0)|0}var Go=64,qo=4194304;function Fa(e){switch(e&-e){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return e&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return e&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return e}}function Cl(e,t){var s=e.pendingLanes;if(s===0)return 0;var r=0,a=e.suspendedLanes,o=e.pingedLanes,l=s&268435455;if(l!==0){var c=l&~a;c!==0?r=Fa(c):(o&=l,o!==0&&(r=Fa(o)))}else l=s&~a,l!==0?r=Fa(l):o!==0&&(r=Fa(o));if(r===0)return 0;if(t!==0&&t!==r&&!(t&a)&&(a=r&-r,o=t&-t,a>=o||a===16&&(o&4194240)!==0))return t;if(r&4&&(r|=s&16),t=e.entangledLanes,t!==0)for(e=e.entanglements,t&=r;0<t;)s=31-qn(t),a=1<<s,r|=e[s],t&=~a;return r}function Ug(e,t){switch(e){case 1:case 2:case 4:return t+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function Wg(e,t){for(var s=e.suspendedLanes,r=e.pingedLanes,a=e.expirationTimes,o=e.pendingLanes;0<o;){var l=31-qn(o),c=1<<l,i=a[l];i===-1?(!(c&s)||c&r)&&(a[l]=Ug(c,t)):i<=t&&(e.expiredLanes|=c),o&=~c}}function td(e){return e=e.pendingLanes&-1073741825,e!==0?e:e&1073741824?1073741824:0}function Rf(){var e=Go;return Go<<=1,!(Go&4194240)&&(Go=64),e}function nc(e){for(var t=[],s=0;31>s;s++)t.push(e);return t}function Ao(e,t,s){e.pendingLanes|=t,t!==536870912&&(e.suspendedLanes=0,e.pingedLanes=0),e=e.eventTimes,t=31-qn(t),e[t]=s}function zg(e,t){var s=e.pendingLanes&~t;e.pendingLanes=t,e.suspendedLanes=0,e.pingedLanes=0,e.expiredLanes&=t,e.mutableReadLanes&=t,e.entangledLanes&=t,t=e.entanglements;var r=e.eventTimes;for(e=e.expirationTimes;0<s;){var a=31-qn(s),o=1<<a;t[a]=0,r[a]=-1,e[a]=-1,s&=~o}}function Xd(e,t){var s=e.entangledLanes|=t;for(e=e.entanglements;s;){var r=31-qn(s),a=1<<r;a&t|e[r]&t&&(e[r]|=t),s&=~a}}var ut=0;function Cf(e){return e&=-e,1<e?4<e?e&268435455?16:536870912:4:1}var Df,Jd,Lf,_f,Of,nd=!1,Xo=[],zs=null,Vs=null,Ks=null,to=new Map,no=new Map,Fs=[],Vg="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function dm(e,t){switch(e){case"focusin":case"focusout":zs=null;break;case"dragenter":case"dragleave":Vs=null;break;case"mouseover":case"mouseout":Ks=null;break;case"pointerover":case"pointerout":to.delete(t.pointerId);break;case"gotpointercapture":case"lostpointercapture":no.delete(t.pointerId)}}function Aa(e,t,s,r,a,o){return e===null||e.nativeEvent!==o?(e={blockedOn:t,domEventName:s,eventSystemFlags:r,nativeEvent:o,targetContainers:[a]},t!==null&&(t=To(t),t!==null&&Jd(t)),e):(e.eventSystemFlags|=r,t=e.targetContainers,a!==null&&t.indexOf(a)===-1&&t.push(a),e)}function Kg(e,t,s,r,a){switch(t){case"focusin":return zs=Aa(zs,e,t,s,r,a),!0;case"dragenter":return Vs=Aa(Vs,e,t,s,r,a),!0;case"mouseover":return Ks=Aa(Ks,e,t,s,r,a),!0;case"pointerover":var o=a.pointerId;return to.set(o,Aa(to.get(o)||null,e,t,s,r,a)),!0;case"gotpointercapture":return o=a.pointerId,no.set(o,Aa(no.get(o)||null,e,t,s,r,a)),!0}return!1}function Mf(e){var t=dr(e.target);if(t!==null){var s=wr(t);if(s!==null){if(t=s.tag,t===13){if(t=jf(s),t!==null){e.blockedOn=t,Of(e.priority,function(){Lf(s)});return}}else if(t===3&&s.stateNode.current.memoizedState.isDehydrated){e.blockedOn=s.tag===3?s.stateNode.containerInfo:null;return}}}e.blockedOn=null}function hl(e){if(e.blockedOn!==null)return!1;for(var t=e.targetContainers;0<t.length;){var s=sd(e.domEventName,e.eventSystemFlags,t[0],e.nativeEvent);if(s===null){s=e.nativeEvent;var r=new s.constructor(s.type,s);Jc=r,s.target.dispatchEvent(r),Jc=null}else return t=To(s),t!==null&&Jd(t),e.blockedOn=s,!1;t.shift()}return!0}function um(e,t,s){hl(e)&&s.delete(t)}function Yg(){nd=!1,zs!==null&&hl(zs)&&(zs=null),Vs!==null&&hl(Vs)&&(Vs=null),Ks!==null&&hl(Ks)&&(Ks=null),to.forEach(um),no.forEach(um)}function Ia(e,t){e.blockedOn===t&&(e.blockedOn=null,nd||(nd=!0,In.unstable_scheduleCallback(In.unstable_NormalPriority,Yg)))}function so(e){function t(a){return Ia(a,e)}if(0<Xo.length){Ia(Xo[0],e);for(var s=1;s<Xo.length;s++){var r=Xo[s];r.blockedOn===e&&(r.blockedOn=null)}}for(zs!==null&&Ia(zs,e),Vs!==null&&Ia(Vs,e),Ks!==null&&Ia(Ks,e),to.forEach(t),no.forEach(t),s=0;s<Fs.length;s++)r=Fs[s],r.blockedOn===e&&(r.blockedOn=null);for(;0<Fs.length&&(s=Fs[0],s.blockedOn===null);)Mf(s),s.blockedOn===null&&Fs.shift()}var qr=Ts.ReactCurrentBatchConfig,Dl=!0;function Gg(e,t,s,r){var a=ut,o=qr.transition;qr.transition=null;try{ut=1,Qd(e,t,s,r)}finally{ut=a,qr.transition=o}}function qg(e,t,s,r){var a=ut,o=qr.transition;qr.transition=null;try{ut=4,Qd(e,t,s,r)}finally{ut=a,qr.transition=o}}function Qd(e,t,s,r){if(Dl){var a=sd(e,t,s,r);if(a===null)mc(e,t,r,Ll,s),dm(e,r);else if(Kg(a,e,t,s,r))r.stopPropagation();else if(dm(e,r),t&4&&-1<Vg.indexOf(e)){for(;a!==null;){var o=To(a);if(o!==null&&Df(o),o=sd(e,t,s,r),o===null&&mc(e,t,r,Ll,s),o===a)break;a=o}a!==null&&r.stopPropagation()}else mc(e,t,r,null,s)}}var Ll=null;function sd(e,t,s,r){if(Ll=null,e=Gd(r),e=dr(e),e!==null)if(t=wr(e),t===null)e=null;else if(s=t.tag,s===13){if(e=jf(t),e!==null)return e;e=null}else if(s===3){if(t.stateNode.current.memoizedState.isDehydrated)return t.tag===3?t.stateNode.containerInfo:null;e=null}else t!==e&&(e=null);return Ll=e,null}function Pf(e){switch(e){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(Mg()){case qd:return 1;case If:return 4;case Rl:case Pg:return 16;case Tf:return 536870912;default:return 16}default:return 16}}var Hs=null,Zd=null,gl=null;function Ff(){if(gl)return gl;var e,t=Zd,s=t.length,r,a="value"in Hs?Hs.value:Hs.textContent,o=a.length;for(e=0;e<s&&t[e]===a[e];e++);var l=s-e;for(r=1;r<=l&&t[s-r]===a[o-r];r++);return gl=a.slice(e,1<r?1-r:void 0)}function yl(e){var t=e.keyCode;return"charCode"in e?(e=e.charCode,e===0&&t===13&&(e=13)):e=t,e===10&&(e=13),32<=e||e===13?e:0}function Jo(){return!0}function mm(){return!1}function Rn(e){function t(s,r,a,o,l){this._reactName=s,this._targetInst=a,this.type=r,this.nativeEvent=o,this.target=l,this.currentTarget=null;for(var c in e)e.hasOwnProperty(c)&&(s=e[c],this[c]=s?s(o):o[c]);return this.isDefaultPrevented=(o.defaultPrevented!=null?o.defaultPrevented:o.returnValue===!1)?Jo:mm,this.isPropagationStopped=mm,this}return It(t.prototype,{preventDefault:function(){this.defaultPrevented=!0;var s=this.nativeEvent;s&&(s.preventDefault?s.preventDefault():typeof s.returnValue!="unknown"&&(s.returnValue=!1),this.isDefaultPrevented=Jo)},stopPropagation:function(){var s=this.nativeEvent;s&&(s.stopPropagation?s.stopPropagation():typeof s.cancelBubble!="unknown"&&(s.cancelBubble=!0),this.isPropagationStopped=Jo)},persist:function(){},isPersistent:Jo}),t}var da={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(e){return e.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},eu=Rn(da),Io=It({},da,{view:0,detail:0}),Xg=Rn(Io),sc,rc,Ta,ui=It({},Io,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:tu,button:0,buttons:0,relatedTarget:function(e){return e.relatedTarget===void 0?e.fromElement===e.srcElement?e.toElement:e.fromElement:e.relatedTarget},movementX:function(e){return"movementX"in e?e.movementX:(e!==Ta&&(Ta&&e.type==="mousemove"?(sc=e.screenX-Ta.screenX,rc=e.screenY-Ta.screenY):rc=sc=0,Ta=e),sc)},movementY:function(e){return"movementY"in e?e.movementY:rc}}),pm=Rn(ui),Jg=It({},ui,{dataTransfer:0}),Qg=Rn(Jg),Zg=It({},Io,{relatedTarget:0}),ac=Rn(Zg),ey=It({},da,{animationName:0,elapsedTime:0,pseudoElement:0}),ty=Rn(ey),ny=It({},da,{clipboardData:function(e){return"clipboardData"in e?e.clipboardData:window.clipboardData}}),sy=Rn(ny),ry=It({},da,{data:0}),fm=Rn(ry),ay={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},oy={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},ly={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function iy(e){var t=this.nativeEvent;return t.getModifierState?t.getModifierState(e):(e=ly[e])?!!t[e]:!1}function tu(){return iy}var cy=It({},Io,{key:function(e){if(e.key){var t=ay[e.key]||e.key;if(t!=="Unidentified")return t}return e.type==="keypress"?(e=yl(e),e===13?"Enter":String.fromCharCode(e)):e.type==="keydown"||e.type==="keyup"?oy[e.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:tu,charCode:function(e){return e.type==="keypress"?yl(e):0},keyCode:function(e){return e.type==="keydown"||e.type==="keyup"?e.keyCode:0},which:function(e){return e.type==="keypress"?yl(e):e.type==="keydown"||e.type==="keyup"?e.keyCode:0}}),dy=Rn(cy),uy=It({},ui,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),xm=Rn(uy),my=It({},Io,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:tu}),py=Rn(my),fy=It({},da,{propertyName:0,elapsedTime:0,pseudoElement:0}),xy=Rn(fy),hy=It({},ui,{deltaX:function(e){return"deltaX"in e?e.deltaX:"wheelDeltaX"in e?-e.wheelDeltaX:0},deltaY:function(e){return"deltaY"in e?e.deltaY:"wheelDeltaY"in e?-e.wheelDeltaY:"wheelDelta"in e?-e.wheelDelta:0},deltaZ:0,deltaMode:0}),gy=Rn(hy),yy=[9,13,27,32],nu=Es&&"CompositionEvent"in window,Ua=null;Es&&"documentMode"in document&&(Ua=document.documentMode);var Ny=Es&&"TextEvent"in window&&!Ua,Bf=Es&&(!nu||Ua&&8<Ua&&11>=Ua),hm=" ",gm=!1;function $f(e,t){switch(e){case"keyup":return yy.indexOf(t.keyCode)!==-1;case"keydown":return t.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function Hf(e){return e=e.detail,typeof e=="object"&&"data"in e?e.data:null}var Mr=!1;function by(e,t){switch(e){case"compositionend":return Hf(t);case"keypress":return t.which!==32?null:(gm=!0,hm);case"textInput":return e=t.data,e===hm&&gm?null:e;default:return null}}function vy(e,t){if(Mr)return e==="compositionend"||!nu&&$f(e,t)?(e=Ff(),gl=Zd=Hs=null,Mr=!1,e):null;switch(e){case"paste":return null;case"keypress":if(!(t.ctrlKey||t.altKey||t.metaKey)||t.ctrlKey&&t.altKey){if(t.char&&1<t.char.length)return t.char;if(t.which)return String.fromCharCode(t.which)}return null;case"compositionend":return Bf&&t.locale!=="ko"?null:t.data;default:return null}}var Sy={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function ym(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t==="input"?!!Sy[e.type]:t==="textarea"}function Uf(e,t,s,r){Nf(r),t=_l(t,"onChange"),0<t.length&&(s=new eu("onChange","change",null,s,r),e.push({event:s,listeners:t}))}var Wa=null,ro=null;function wy(e){Zf(e,0)}function mi(e){var t=Br(e);if(mf(t))return e}function jy(e,t){if(e==="change")return t}var Wf=!1;if(Es){var oc;if(Es){var lc="oninput"in document;if(!lc){var Nm=document.createElement("div");Nm.setAttribute("oninput","return;"),lc=typeof Nm.oninput=="function"}oc=lc}else oc=!1;Wf=oc&&(!document.documentMode||9<document.documentMode)}function bm(){Wa&&(Wa.detachEvent("onpropertychange",zf),ro=Wa=null)}function zf(e){if(e.propertyName==="value"&&mi(ro)){var t=[];Uf(t,ro,e,Gd(e)),wf(wy,t)}}function Ey(e,t,s){e==="focusin"?(bm(),Wa=t,ro=s,Wa.attachEvent("onpropertychange",zf)):e==="focusout"&&bm()}function ky(e){if(e==="selectionchange"||e==="keyup"||e==="keydown")return mi(ro)}function Ay(e,t){if(e==="click")return mi(t)}function Iy(e,t){if(e==="input"||e==="change")return mi(t)}function Ty(e,t){return e===t&&(e!==0||1/e===1/t)||e!==e&&t!==t}var Qn=typeof Object.is=="function"?Object.is:Ty;function ao(e,t){if(Qn(e,t))return!0;if(typeof e!="object"||e===null||typeof t!="object"||t===null)return!1;var s=Object.keys(e),r=Object.keys(t);if(s.length!==r.length)return!1;for(r=0;r<s.length;r++){var a=s[r];if(!Bc.call(t,a)||!Qn(e[a],t[a]))return!1}return!0}function vm(e){for(;e&&e.firstChild;)e=e.firstChild;return e}function Sm(e,t){var s=vm(e);e=0;for(var r;s;){if(s.nodeType===3){if(r=e+s.textContent.length,e<=t&&r>=t)return{node:s,offset:t-e};e=r}e:{for(;s;){if(s.nextSibling){s=s.nextSibling;break e}s=s.parentNode}s=void 0}s=vm(s)}}function Vf(e,t){return e&&t?e===t?!0:e&&e.nodeType===3?!1:t&&t.nodeType===3?Vf(e,t.parentNode):"contains"in e?e.contains(t):e.compareDocumentPosition?!!(e.compareDocumentPosition(t)&16):!1:!1}function Kf(){for(var e=window,t=Al();t instanceof e.HTMLIFrameElement;){try{var s=typeof t.contentWindow.location.href=="string"}catch{s=!1}if(s)e=t.contentWindow;else break;t=Al(e.document)}return t}function su(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t&&(t==="input"&&(e.type==="text"||e.type==="search"||e.type==="tel"||e.type==="url"||e.type==="password")||t==="textarea"||e.contentEditable==="true")}function Ry(e){var t=Kf(),s=e.focusedElem,r=e.selectionRange;if(t!==s&&s&&s.ownerDocument&&Vf(s.ownerDocument.documentElement,s)){if(r!==null&&su(s)){if(t=r.start,e=r.end,e===void 0&&(e=t),"selectionStart"in s)s.selectionStart=t,s.selectionEnd=Math.min(e,s.value.length);else if(e=(t=s.ownerDocument||document)&&t.defaultView||window,e.getSelection){e=e.getSelection();var a=s.textContent.length,o=Math.min(r.start,a);r=r.end===void 0?o:Math.min(r.end,a),!e.extend&&o>r&&(a=r,r=o,o=a),a=Sm(s,o);var l=Sm(s,r);a&&l&&(e.rangeCount!==1||e.anchorNode!==a.node||e.anchorOffset!==a.offset||e.focusNode!==l.node||e.focusOffset!==l.offset)&&(t=t.createRange(),t.setStart(a.node,a.offset),e.removeAllRanges(),o>r?(e.addRange(t),e.extend(l.node,l.offset)):(t.setEnd(l.node,l.offset),e.addRange(t)))}}for(t=[],e=s;e=e.parentNode;)e.nodeType===1&&t.push({element:e,left:e.scrollLeft,top:e.scrollTop});for(typeof s.focus=="function"&&s.focus(),s=0;s<t.length;s++)e=t[s],e.element.scrollLeft=e.left,e.element.scrollTop=e.top}}var Cy=Es&&"documentMode"in document&&11>=document.documentMode,Pr=null,rd=null,za=null,ad=!1;function wm(e,t,s){var r=s.window===s?s.document:s.nodeType===9?s:s.ownerDocument;ad||Pr==null||Pr!==Al(r)||(r=Pr,"selectionStart"in r&&su(r)?r={start:r.selectionStart,end:r.selectionEnd}:(r=(r.ownerDocument&&r.ownerDocument.defaultView||window).getSelection(),r={anchorNode:r.anchorNode,anchorOffset:r.anchorOffset,focusNode:r.focusNode,focusOffset:r.focusOffset}),za&&ao(za,r)||(za=r,r=_l(rd,"onSelect"),0<r.length&&(t=new eu("onSelect","select",null,t,s),e.push({event:t,listeners:r}),t.target=Pr)))}function Qo(e,t){var s={};return s[e.toLowerCase()]=t.toLowerCase(),s["Webkit"+e]="webkit"+t,s["Moz"+e]="moz"+t,s}var Fr={animationend:Qo("Animation","AnimationEnd"),animationiteration:Qo("Animation","AnimationIteration"),animationstart:Qo("Animation","AnimationStart"),transitionend:Qo("Transition","TransitionEnd")},ic={},Yf={};Es&&(Yf=document.createElement("div").style,"AnimationEvent"in window||(delete Fr.animationend.animation,delete Fr.animationiteration.animation,delete Fr.animationstart.animation),"TransitionEvent"in window||delete Fr.transitionend.transition);function pi(e){if(ic[e])return ic[e];if(!Fr[e])return e;var t=Fr[e],s;for(s in t)if(t.hasOwnProperty(s)&&s in Yf)return ic[e]=t[s];return e}var Gf=pi("animationend"),qf=pi("animationiteration"),Xf=pi("animationstart"),Jf=pi("transitionend"),Qf=new Map,jm="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function er(e,t){Qf.set(e,t),Sr(t,[e])}for(var cc=0;cc<jm.length;cc++){var dc=jm[cc],Dy=dc.toLowerCase(),Ly=dc[0].toUpperCase()+dc.slice(1);er(Dy,"on"+Ly)}er(Gf,"onAnimationEnd");er(qf,"onAnimationIteration");er(Xf,"onAnimationStart");er("dblclick","onDoubleClick");er("focusin","onFocus");er("focusout","onBlur");er(Jf,"onTransitionEnd");Zr("onMouseEnter",["mouseout","mouseover"]);Zr("onMouseLeave",["mouseout","mouseover"]);Zr("onPointerEnter",["pointerout","pointerover"]);Zr("onPointerLeave",["pointerout","pointerover"]);Sr("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));Sr("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));Sr("onBeforeInput",["compositionend","keypress","textInput","paste"]);Sr("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));Sr("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));Sr("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Ba="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),_y=new Set("cancel close invalid load scroll toggle".split(" ").concat(Ba));function Em(e,t,s){var r=e.type||"unknown-event";e.currentTarget=s,Dg(r,t,void 0,e),e.currentTarget=null}function Zf(e,t){t=(t&4)!==0;for(var s=0;s<e.length;s++){var r=e[s],a=r.event;r=r.listeners;e:{var o=void 0;if(t)for(var l=r.length-1;0<=l;l--){var c=r[l],i=c.instance,u=c.currentTarget;if(c=c.listener,i!==o&&a.isPropagationStopped())break e;Em(a,c,u),o=i}else for(l=0;l<r.length;l++){if(c=r[l],i=c.instance,u=c.currentTarget,c=c.listener,i!==o&&a.isPropagationStopped())break e;Em(a,c,u),o=i}}}if(Tl)throw e=ed,Tl=!1,ed=null,e}function Nt(e,t){var s=t[dd];s===void 0&&(s=t[dd]=new Set);var r=e+"__bubble";s.has(r)||(ex(t,e,2,!1),s.add(r))}function uc(e,t,s){var r=0;t&&(r|=4),ex(s,e,r,t)}var Zo="_reactListening"+Math.random().toString(36).slice(2);function oo(e){if(!e[Zo]){e[Zo]=!0,of.forEach(function(s){s!=="selectionchange"&&(_y.has(s)||uc(s,!1,e),uc(s,!0,e))});var t=e.nodeType===9?e:e.ownerDocument;t===null||t[Zo]||(t[Zo]=!0,uc("selectionchange",!1,t))}}function ex(e,t,s,r){switch(Pf(t)){case 1:var a=Gg;break;case 4:a=qg;break;default:a=Qd}s=a.bind(null,t,s,e),a=void 0,!Zc||t!=="touchstart"&&t!=="touchmove"&&t!=="wheel"||(a=!0),r?a!==void 0?e.addEventListener(t,s,{capture:!0,passive:a}):e.addEventListener(t,s,!0):a!==void 0?e.addEventListener(t,s,{passive:a}):e.addEventListener(t,s,!1)}function mc(e,t,s,r,a){var o=r;if(!(t&1)&&!(t&2)&&r!==null)e:for(;;){if(r===null)return;var l=r.tag;if(l===3||l===4){var c=r.stateNode.containerInfo;if(c===a||c.nodeType===8&&c.parentNode===a)break;if(l===4)for(l=r.return;l!==null;){var i=l.tag;if((i===3||i===4)&&(i=l.stateNode.containerInfo,i===a||i.nodeType===8&&i.parentNode===a))return;l=l.return}for(;c!==null;){if(l=dr(c),l===null)return;if(i=l.tag,i===5||i===6){r=o=l;continue e}c=c.parentNode}}r=r.return}wf(function(){var u=o,p=Gd(s),y=[];e:{var b=Qf.get(e);if(b!==void 0){var w=eu,R=e;switch(e){case"keypress":if(yl(s)===0)break e;case"keydown":case"keyup":w=dy;break;case"focusin":R="focus",w=ac;break;case"focusout":R="blur",w=ac;break;case"beforeblur":case"afterblur":w=ac;break;case"click":if(s.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":w=pm;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":w=Qg;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":w=py;break;case Gf:case qf:case Xf:w=ty;break;case Jf:w=xy;break;case"scroll":w=Xg;break;case"wheel":w=gy;break;case"copy":case"cut":case"paste":w=sy;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":w=xm}var E=(t&4)!==0,W=!E&&e==="scroll",N=E?b!==null?b+"Capture":null:b;E=[];for(var h=u,S;h!==null;){S=h;var P=S.stateNode;if(S.tag===5&&P!==null&&(S=P,N!==null&&(P=eo(h,N),P!=null&&E.push(lo(h,P,S)))),W)break;h=h.return}0<E.length&&(b=new w(b,R,null,s,p),y.push({event:b,listeners:E}))}}if(!(t&7)){e:{if(b=e==="mouseover"||e==="pointerover",w=e==="mouseout"||e==="pointerout",b&&s!==Jc&&(R=s.relatedTarget||s.fromElement)&&(dr(R)||R[ks]))break e;if((w||b)&&(b=p.window===p?p:(b=p.ownerDocument)?b.defaultView||b.parentWindow:window,w?(R=s.relatedTarget||s.toElement,w=u,R=R?dr(R):null,R!==null&&(W=wr(R),R!==W||R.tag!==5&&R.tag!==6)&&(R=null)):(w=null,R=u),w!==R)){if(E=pm,P="onMouseLeave",N="onMouseEnter",h="mouse",(e==="pointerout"||e==="pointerover")&&(E=xm,P="onPointerLeave",N="onPointerEnter",h="pointer"),W=w==null?b:Br(w),S=R==null?b:Br(R),b=new E(P,h+"leave",w,s,p),b.target=W,b.relatedTarget=S,P=null,dr(p)===u&&(E=new E(N,h+"enter",R,s,p),E.target=S,E.relatedTarget=W,P=E),W=P,w&&R)t:{for(E=w,N=R,h=0,S=E;S;S=Rr(S))h++;for(S=0,P=N;P;P=Rr(P))S++;for(;0<h-S;)E=Rr(E),h--;for(;0<S-h;)N=Rr(N),S--;for(;h--;){if(E===N||N!==null&&E===N.alternate)break t;E=Rr(E),N=Rr(N)}E=null}else E=null;w!==null&&km(y,b,w,E,!1),R!==null&&W!==null&&km(y,W,R,E,!0)}}e:{if(b=u?Br(u):window,w=b.nodeName&&b.nodeName.toLowerCase(),w==="select"||w==="input"&&b.type==="file")var U=jy;else if(ym(b))if(Wf)U=Iy;else{U=ky;var V=Ey}else(w=b.nodeName)&&w.toLowerCase()==="input"&&(b.type==="checkbox"||b.type==="radio")&&(U=Ay);if(U&&(U=U(e,u))){Uf(y,U,s,p);break e}V&&V(e,b,u),e==="focusout"&&(V=b._wrapperState)&&V.controlled&&b.type==="number"&&Kc(b,"number",b.value)}switch(V=u?Br(u):window,e){case"focusin":(ym(V)||V.contentEditable==="true")&&(Pr=V,rd=u,za=null);break;case"focusout":za=rd=Pr=null;break;case"mousedown":ad=!0;break;case"contextmenu":case"mouseup":case"dragend":ad=!1,wm(y,s,p);break;case"selectionchange":if(Cy)break;case"keydown":case"keyup":wm(y,s,p)}var X;if(nu)e:{switch(e){case"compositionstart":var te="onCompositionStart";break e;case"compositionend":te="onCompositionEnd";break e;case"compositionupdate":te="onCompositionUpdate";break e}te=void 0}else Mr?$f(e,s)&&(te="onCompositionEnd"):e==="keydown"&&s.keyCode===229&&(te="onCompositionStart");te&&(Bf&&s.locale!=="ko"&&(Mr||te!=="onCompositionStart"?te==="onCompositionEnd"&&Mr&&(X=Ff()):(Hs=p,Zd="value"in Hs?Hs.value:Hs.textContent,Mr=!0)),V=_l(u,te),0<V.length&&(te=new fm(te,e,null,s,p),y.push({event:te,listeners:V}),X?te.data=X:(X=Hf(s),X!==null&&(te.data=X)))),(X=Ny?by(e,s):vy(e,s))&&(u=_l(u,"onBeforeInput"),0<u.length&&(p=new fm("onBeforeInput","beforeinput",null,s,p),y.push({event:p,listeners:u}),p.data=X))}Zf(y,t)})}function lo(e,t,s){return{instance:e,listener:t,currentTarget:s}}function _l(e,t){for(var s=t+"Capture",r=[];e!==null;){var a=e,o=a.stateNode;a.tag===5&&o!==null&&(a=o,o=eo(e,s),o!=null&&r.unshift(lo(e,o,a)),o=eo(e,t),o!=null&&r.push(lo(e,o,a))),e=e.return}return r}function Rr(e){if(e===null)return null;do e=e.return;while(e&&e.tag!==5);return e||null}function km(e,t,s,r,a){for(var o=t._reactName,l=[];s!==null&&s!==r;){var c=s,i=c.alternate,u=c.stateNode;if(i!==null&&i===r)break;c.tag===5&&u!==null&&(c=u,a?(i=eo(s,o),i!=null&&l.unshift(lo(s,i,c))):a||(i=eo(s,o),i!=null&&l.push(lo(s,i,c)))),s=s.return}l.length!==0&&e.push({event:t,listeners:l})}var Oy=/\r\n?/g,My=/\u0000|\uFFFD/g;function Am(e){return(typeof e=="string"?e:""+e).replace(Oy,`
`).replace(My,"")}function el(e,t,s){if(t=Am(t),Am(e)!==t&&s)throw Error(me(425))}function Ol(){}var od=null,ld=null;function id(e,t){return e==="textarea"||e==="noscript"||typeof t.children=="string"||typeof t.children=="number"||typeof t.dangerouslySetInnerHTML=="object"&&t.dangerouslySetInnerHTML!==null&&t.dangerouslySetInnerHTML.__html!=null}var cd=typeof setTimeout=="function"?setTimeout:void 0,Py=typeof clearTimeout=="function"?clearTimeout:void 0,Im=typeof Promise=="function"?Promise:void 0,Fy=typeof queueMicrotask=="function"?queueMicrotask:typeof Im<"u"?function(e){return Im.resolve(null).then(e).catch(By)}:cd;function By(e){setTimeout(function(){throw e})}function pc(e,t){var s=t,r=0;do{var a=s.nextSibling;if(e.removeChild(s),a&&a.nodeType===8)if(s=a.data,s==="/$"){if(r===0){e.removeChild(a),so(t);return}r--}else s!=="$"&&s!=="$?"&&s!=="$!"||r++;s=a}while(s);so(t)}function Ys(e){for(;e!=null;e=e.nextSibling){var t=e.nodeType;if(t===1||t===3)break;if(t===8){if(t=e.data,t==="$"||t==="$!"||t==="$?")break;if(t==="/$")return null}}return e}function Tm(e){e=e.previousSibling;for(var t=0;e;){if(e.nodeType===8){var s=e.data;if(s==="$"||s==="$!"||s==="$?"){if(t===0)return e;t--}else s==="/$"&&t++}e=e.previousSibling}return null}var ua=Math.random().toString(36).slice(2),ls="__reactFiber$"+ua,io="__reactProps$"+ua,ks="__reactContainer$"+ua,dd="__reactEvents$"+ua,$y="__reactListeners$"+ua,Hy="__reactHandles$"+ua;function dr(e){var t=e[ls];if(t)return t;for(var s=e.parentNode;s;){if(t=s[ks]||s[ls]){if(s=t.alternate,t.child!==null||s!==null&&s.child!==null)for(e=Tm(e);e!==null;){if(s=e[ls])return s;e=Tm(e)}return t}e=s,s=e.parentNode}return null}function To(e){return e=e[ls]||e[ks],!e||e.tag!==5&&e.tag!==6&&e.tag!==13&&e.tag!==3?null:e}function Br(e){if(e.tag===5||e.tag===6)return e.stateNode;throw Error(me(33))}function fi(e){return e[io]||null}var ud=[],$r=-1;function tr(e){return{current:e}}function vt(e){0>$r||(e.current=ud[$r],ud[$r]=null,$r--)}function ht(e,t){$r++,ud[$r]=e.current,e.current=t}var Zs={},ln=tr(Zs),bn=tr(!1),hr=Zs;function ea(e,t){var s=e.type.contextTypes;if(!s)return Zs;var r=e.stateNode;if(r&&r.__reactInternalMemoizedUnmaskedChildContext===t)return r.__reactInternalMemoizedMaskedChildContext;var a={},o;for(o in s)a[o]=t[o];return r&&(e=e.stateNode,e.__reactInternalMemoizedUnmaskedChildContext=t,e.__reactInternalMemoizedMaskedChildContext=a),a}function vn(e){return e=e.childContextTypes,e!=null}function Ml(){vt(bn),vt(ln)}function Rm(e,t,s){if(ln.current!==Zs)throw Error(me(168));ht(ln,t),ht(bn,s)}function tx(e,t,s){var r=e.stateNode;if(t=t.childContextTypes,typeof r.getChildContext!="function")return s;r=r.getChildContext();for(var a in r)if(!(a in t))throw Error(me(108,Eg(e)||"Unknown",a));return It({},s,r)}function Pl(e){return e=(e=e.stateNode)&&e.__reactInternalMemoizedMergedChildContext||Zs,hr=ln.current,ht(ln,e),ht(bn,bn.current),!0}function Cm(e,t,s){var r=e.stateNode;if(!r)throw Error(me(169));s?(e=tx(e,t,hr),r.__reactInternalMemoizedMergedChildContext=e,vt(bn),vt(ln),ht(ln,e)):vt(bn),ht(bn,s)}var gs=null,xi=!1,fc=!1;function nx(e){gs===null?gs=[e]:gs.push(e)}function Uy(e){xi=!0,nx(e)}function nr(){if(!fc&&gs!==null){fc=!0;var e=0,t=ut;try{var s=gs;for(ut=1;e<s.length;e++){var r=s[e];do r=r(!0);while(r!==null)}gs=null,xi=!1}catch(a){throw gs!==null&&(gs=gs.slice(e+1)),Af(qd,nr),a}finally{ut=t,fc=!1}}return null}var Hr=[],Ur=0,Fl=null,Bl=0,_n=[],On=0,gr=null,bs=1,vs="";function or(e,t){Hr[Ur++]=Bl,Hr[Ur++]=Fl,Fl=e,Bl=t}function sx(e,t,s){_n[On++]=bs,_n[On++]=vs,_n[On++]=gr,gr=e;var r=bs;e=vs;var a=32-qn(r)-1;r&=~(1<<a),s+=1;var o=32-qn(t)+a;if(30<o){var l=a-a%5;o=(r&(1<<l)-1).toString(32),r>>=l,a-=l,bs=1<<32-qn(t)+a|s<<a|r,vs=o+e}else bs=1<<o|s<<a|r,vs=e}function ru(e){e.return!==null&&(or(e,1),sx(e,1,0))}function au(e){for(;e===Fl;)Fl=Hr[--Ur],Hr[Ur]=null,Bl=Hr[--Ur],Hr[Ur]=null;for(;e===gr;)gr=_n[--On],_n[On]=null,vs=_n[--On],_n[On]=null,bs=_n[--On],_n[On]=null}var An=null,kn=null,St=!1,Gn=null;function rx(e,t){var s=Mn(5,null,null,0);s.elementType="DELETED",s.stateNode=t,s.return=e,t=e.deletions,t===null?(e.deletions=[s],e.flags|=16):t.push(s)}function Dm(e,t){switch(e.tag){case 5:var s=e.type;return t=t.nodeType!==1||s.toLowerCase()!==t.nodeName.toLowerCase()?null:t,t!==null?(e.stateNode=t,An=e,kn=Ys(t.firstChild),!0):!1;case 6:return t=e.pendingProps===""||t.nodeType!==3?null:t,t!==null?(e.stateNode=t,An=e,kn=null,!0):!1;case 13:return t=t.nodeType!==8?null:t,t!==null?(s=gr!==null?{id:bs,overflow:vs}:null,e.memoizedState={dehydrated:t,treeContext:s,retryLane:1073741824},s=Mn(18,null,null,0),s.stateNode=t,s.return=e,e.child=s,An=e,kn=null,!0):!1;default:return!1}}function md(e){return(e.mode&1)!==0&&(e.flags&128)===0}function pd(e){if(St){var t=kn;if(t){var s=t;if(!Dm(e,t)){if(md(e))throw Error(me(418));t=Ys(s.nextSibling);var r=An;t&&Dm(e,t)?rx(r,s):(e.flags=e.flags&-4097|2,St=!1,An=e)}}else{if(md(e))throw Error(me(418));e.flags=e.flags&-4097|2,St=!1,An=e}}}function Lm(e){for(e=e.return;e!==null&&e.tag!==5&&e.tag!==3&&e.tag!==13;)e=e.return;An=e}function tl(e){if(e!==An)return!1;if(!St)return Lm(e),St=!0,!1;var t;if((t=e.tag!==3)&&!(t=e.tag!==5)&&(t=e.type,t=t!=="head"&&t!=="body"&&!id(e.type,e.memoizedProps)),t&&(t=kn)){if(md(e))throw ax(),Error(me(418));for(;t;)rx(e,t),t=Ys(t.nextSibling)}if(Lm(e),e.tag===13){if(e=e.memoizedState,e=e!==null?e.dehydrated:null,!e)throw Error(me(317));e:{for(e=e.nextSibling,t=0;e;){if(e.nodeType===8){var s=e.data;if(s==="/$"){if(t===0){kn=Ys(e.nextSibling);break e}t--}else s!=="$"&&s!=="$!"&&s!=="$?"||t++}e=e.nextSibling}kn=null}}else kn=An?Ys(e.stateNode.nextSibling):null;return!0}function ax(){for(var e=kn;e;)e=Ys(e.nextSibling)}function ta(){kn=An=null,St=!1}function ou(e){Gn===null?Gn=[e]:Gn.push(e)}var Wy=Ts.ReactCurrentBatchConfig;function Ra(e,t,s){if(e=s.ref,e!==null&&typeof e!="function"&&typeof e!="object"){if(s._owner){if(s=s._owner,s){if(s.tag!==1)throw Error(me(309));var r=s.stateNode}if(!r)throw Error(me(147,e));var a=r,o=""+e;return t!==null&&t.ref!==null&&typeof t.ref=="function"&&t.ref._stringRef===o?t.ref:(t=function(l){var c=a.refs;l===null?delete c[o]:c[o]=l},t._stringRef=o,t)}if(typeof e!="string")throw Error(me(284));if(!s._owner)throw Error(me(290,e))}return e}function nl(e,t){throw e=Object.prototype.toString.call(t),Error(me(31,e==="[object Object]"?"object with keys {"+Object.keys(t).join(", ")+"}":e))}function _m(e){var t=e._init;return t(e._payload)}function ox(e){function t(N,h){if(e){var S=N.deletions;S===null?(N.deletions=[h],N.flags|=16):S.push(h)}}function s(N,h){if(!e)return null;for(;h!==null;)t(N,h),h=h.sibling;return null}function r(N,h){for(N=new Map;h!==null;)h.key!==null?N.set(h.key,h):N.set(h.index,h),h=h.sibling;return N}function a(N,h){return N=Js(N,h),N.index=0,N.sibling=null,N}function o(N,h,S){return N.index=S,e?(S=N.alternate,S!==null?(S=S.index,S<h?(N.flags|=2,h):S):(N.flags|=2,h)):(N.flags|=1048576,h)}function l(N){return e&&N.alternate===null&&(N.flags|=2),N}function c(N,h,S,P){return h===null||h.tag!==6?(h=vc(S,N.mode,P),h.return=N,h):(h=a(h,S),h.return=N,h)}function i(N,h,S,P){var U=S.type;return U===Or?p(N,h,S.props.children,P,S.key):h!==null&&(h.elementType===U||typeof U=="object"&&U!==null&&U.$$typeof===_s&&_m(U)===h.type)?(P=a(h,S.props),P.ref=Ra(N,h,S),P.return=N,P):(P=El(S.type,S.key,S.props,null,N.mode,P),P.ref=Ra(N,h,S),P.return=N,P)}function u(N,h,S,P){return h===null||h.tag!==4||h.stateNode.containerInfo!==S.containerInfo||h.stateNode.implementation!==S.implementation?(h=Sc(S,N.mode,P),h.return=N,h):(h=a(h,S.children||[]),h.return=N,h)}function p(N,h,S,P,U){return h===null||h.tag!==7?(h=fr(S,N.mode,P,U),h.return=N,h):(h=a(h,S),h.return=N,h)}function y(N,h,S){if(typeof h=="string"&&h!==""||typeof h=="number")return h=vc(""+h,N.mode,S),h.return=N,h;if(typeof h=="object"&&h!==null){switch(h.$$typeof){case Vo:return S=El(h.type,h.key,h.props,null,N.mode,S),S.ref=Ra(N,null,h),S.return=N,S;case _r:return h=Sc(h,N.mode,S),h.return=N,h;case _s:var P=h._init;return y(N,P(h._payload),S)}if(Pa(h)||Ea(h))return h=fr(h,N.mode,S,null),h.return=N,h;nl(N,h)}return null}function b(N,h,S,P){var U=h!==null?h.key:null;if(typeof S=="string"&&S!==""||typeof S=="number")return U!==null?null:c(N,h,""+S,P);if(typeof S=="object"&&S!==null){switch(S.$$typeof){case Vo:return S.key===U?i(N,h,S,P):null;case _r:return S.key===U?u(N,h,S,P):null;case _s:return U=S._init,b(N,h,U(S._payload),P)}if(Pa(S)||Ea(S))return U!==null?null:p(N,h,S,P,null);nl(N,S)}return null}function w(N,h,S,P,U){if(typeof P=="string"&&P!==""||typeof P=="number")return N=N.get(S)||null,c(h,N,""+P,U);if(typeof P=="object"&&P!==null){switch(P.$$typeof){case Vo:return N=N.get(P.key===null?S:P.key)||null,i(h,N,P,U);case _r:return N=N.get(P.key===null?S:P.key)||null,u(h,N,P,U);case _s:var V=P._init;return w(N,h,S,V(P._payload),U)}if(Pa(P)||Ea(P))return N=N.get(S)||null,p(h,N,P,U,null);nl(h,P)}return null}function R(N,h,S,P){for(var U=null,V=null,X=h,te=h=0,G=null;X!==null&&te<S.length;te++){X.index>te?(G=X,X=null):G=X.sibling;var ae=b(N,X,S[te],P);if(ae===null){X===null&&(X=G);break}e&&X&&ae.alternate===null&&t(N,X),h=o(ae,h,te),V===null?U=ae:V.sibling=ae,V=ae,X=G}if(te===S.length)return s(N,X),St&&or(N,te),U;if(X===null){for(;te<S.length;te++)X=y(N,S[te],P),X!==null&&(h=o(X,h,te),V===null?U=X:V.sibling=X,V=X);return St&&or(N,te),U}for(X=r(N,X);te<S.length;te++)G=w(X,N,te,S[te],P),G!==null&&(e&&G.alternate!==null&&X.delete(G.key===null?te:G.key),h=o(G,h,te),V===null?U=G:V.sibling=G,V=G);return e&&X.forEach(function(j){return t(N,j)}),St&&or(N,te),U}function E(N,h,S,P){var U=Ea(S);if(typeof U!="function")throw Error(me(150));if(S=U.call(S),S==null)throw Error(me(151));for(var V=U=null,X=h,te=h=0,G=null,ae=S.next();X!==null&&!ae.done;te++,ae=S.next()){X.index>te?(G=X,X=null):G=X.sibling;var j=b(N,X,ae.value,P);if(j===null){X===null&&(X=G);break}e&&X&&j.alternate===null&&t(N,X),h=o(j,h,te),V===null?U=j:V.sibling=j,V=j,X=G}if(ae.done)return s(N,X),St&&or(N,te),U;if(X===null){for(;!ae.done;te++,ae=S.next())ae=y(N,ae.value,P),ae!==null&&(h=o(ae,h,te),V===null?U=ae:V.sibling=ae,V=ae);return St&&or(N,te),U}for(X=r(N,X);!ae.done;te++,ae=S.next())ae=w(X,N,te,ae.value,P),ae!==null&&(e&&ae.alternate!==null&&X.delete(ae.key===null?te:ae.key),h=o(ae,h,te),V===null?U=ae:V.sibling=ae,V=ae);return e&&X.forEach(function(F){return t(N,F)}),St&&or(N,te),U}function W(N,h,S,P){if(typeof S=="object"&&S!==null&&S.type===Or&&S.key===null&&(S=S.props.children),typeof S=="object"&&S!==null){switch(S.$$typeof){case Vo:e:{for(var U=S.key,V=h;V!==null;){if(V.key===U){if(U=S.type,U===Or){if(V.tag===7){s(N,V.sibling),h=a(V,S.props.children),h.return=N,N=h;break e}}else if(V.elementType===U||typeof U=="object"&&U!==null&&U.$$typeof===_s&&_m(U)===V.type){s(N,V.sibling),h=a(V,S.props),h.ref=Ra(N,V,S),h.return=N,N=h;break e}s(N,V);break}else t(N,V);V=V.sibling}S.type===Or?(h=fr(S.props.children,N.mode,P,S.key),h.return=N,N=h):(P=El(S.type,S.key,S.props,null,N.mode,P),P.ref=Ra(N,h,S),P.return=N,N=P)}return l(N);case _r:e:{for(V=S.key;h!==null;){if(h.key===V)if(h.tag===4&&h.stateNode.containerInfo===S.containerInfo&&h.stateNode.implementation===S.implementation){s(N,h.sibling),h=a(h,S.children||[]),h.return=N,N=h;break e}else{s(N,h);break}else t(N,h);h=h.sibling}h=Sc(S,N.mode,P),h.return=N,N=h}return l(N);case _s:return V=S._init,W(N,h,V(S._payload),P)}if(Pa(S))return R(N,h,S,P);if(Ea(S))return E(N,h,S,P);nl(N,S)}return typeof S=="string"&&S!==""||typeof S=="number"?(S=""+S,h!==null&&h.tag===6?(s(N,h.sibling),h=a(h,S),h.return=N,N=h):(s(N,h),h=vc(S,N.mode,P),h.return=N,N=h),l(N)):s(N,h)}return W}var na=ox(!0),lx=ox(!1),$l=tr(null),Hl=null,Wr=null,lu=null;function iu(){lu=Wr=Hl=null}function cu(e){var t=$l.current;vt($l),e._currentValue=t}function fd(e,t,s){for(;e!==null;){var r=e.alternate;if((e.childLanes&t)!==t?(e.childLanes|=t,r!==null&&(r.childLanes|=t)):r!==null&&(r.childLanes&t)!==t&&(r.childLanes|=t),e===s)break;e=e.return}}function Xr(e,t){Hl=e,lu=Wr=null,e=e.dependencies,e!==null&&e.firstContext!==null&&(e.lanes&t&&(Nn=!0),e.firstContext=null)}function Bn(e){var t=e._currentValue;if(lu!==e)if(e={context:e,memoizedValue:t,next:null},Wr===null){if(Hl===null)throw Error(me(308));Wr=e,Hl.dependencies={lanes:0,firstContext:e}}else Wr=Wr.next=e;return t}var ur=null;function du(e){ur===null?ur=[e]:ur.push(e)}function ix(e,t,s,r){var a=t.interleaved;return a===null?(s.next=s,du(t)):(s.next=a.next,a.next=s),t.interleaved=s,As(e,r)}function As(e,t){e.lanes|=t;var s=e.alternate;for(s!==null&&(s.lanes|=t),s=e,e=e.return;e!==null;)e.childLanes|=t,s=e.alternate,s!==null&&(s.childLanes|=t),s=e,e=e.return;return s.tag===3?s.stateNode:null}var Os=!1;function uu(e){e.updateQueue={baseState:e.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function cx(e,t){e=e.updateQueue,t.updateQueue===e&&(t.updateQueue={baseState:e.baseState,firstBaseUpdate:e.firstBaseUpdate,lastBaseUpdate:e.lastBaseUpdate,shared:e.shared,effects:e.effects})}function Ss(e,t){return{eventTime:e,lane:t,tag:0,payload:null,callback:null,next:null}}function Gs(e,t,s){var r=e.updateQueue;if(r===null)return null;if(r=r.shared,ot&2){var a=r.pending;return a===null?t.next=t:(t.next=a.next,a.next=t),r.pending=t,As(e,s)}return a=r.interleaved,a===null?(t.next=t,du(r)):(t.next=a.next,a.next=t),r.interleaved=t,As(e,s)}function Nl(e,t,s){if(t=t.updateQueue,t!==null&&(t=t.shared,(s&4194240)!==0)){var r=t.lanes;r&=e.pendingLanes,s|=r,t.lanes=s,Xd(e,s)}}function Om(e,t){var s=e.updateQueue,r=e.alternate;if(r!==null&&(r=r.updateQueue,s===r)){var a=null,o=null;if(s=s.firstBaseUpdate,s!==null){do{var l={eventTime:s.eventTime,lane:s.lane,tag:s.tag,payload:s.payload,callback:s.callback,next:null};o===null?a=o=l:o=o.next=l,s=s.next}while(s!==null);o===null?a=o=t:o=o.next=t}else a=o=t;s={baseState:r.baseState,firstBaseUpdate:a,lastBaseUpdate:o,shared:r.shared,effects:r.effects},e.updateQueue=s;return}e=s.lastBaseUpdate,e===null?s.firstBaseUpdate=t:e.next=t,s.lastBaseUpdate=t}function Ul(e,t,s,r){var a=e.updateQueue;Os=!1;var o=a.firstBaseUpdate,l=a.lastBaseUpdate,c=a.shared.pending;if(c!==null){a.shared.pending=null;var i=c,u=i.next;i.next=null,l===null?o=u:l.next=u,l=i;var p=e.alternate;p!==null&&(p=p.updateQueue,c=p.lastBaseUpdate,c!==l&&(c===null?p.firstBaseUpdate=u:c.next=u,p.lastBaseUpdate=i))}if(o!==null){var y=a.baseState;l=0,p=u=i=null,c=o;do{var b=c.lane,w=c.eventTime;if((r&b)===b){p!==null&&(p=p.next={eventTime:w,lane:0,tag:c.tag,payload:c.payload,callback:c.callback,next:null});e:{var R=e,E=c;switch(b=t,w=s,E.tag){case 1:if(R=E.payload,typeof R=="function"){y=R.call(w,y,b);break e}y=R;break e;case 3:R.flags=R.flags&-65537|128;case 0:if(R=E.payload,b=typeof R=="function"?R.call(w,y,b):R,b==null)break e;y=It({},y,b);break e;case 2:Os=!0}}c.callback!==null&&c.lane!==0&&(e.flags|=64,b=a.effects,b===null?a.effects=[c]:b.push(c))}else w={eventTime:w,lane:b,tag:c.tag,payload:c.payload,callback:c.callback,next:null},p===null?(u=p=w,i=y):p=p.next=w,l|=b;if(c=c.next,c===null){if(c=a.shared.pending,c===null)break;b=c,c=b.next,b.next=null,a.lastBaseUpdate=b,a.shared.pending=null}}while(!0);if(p===null&&(i=y),a.baseState=i,a.firstBaseUpdate=u,a.lastBaseUpdate=p,t=a.shared.interleaved,t!==null){a=t;do l|=a.lane,a=a.next;while(a!==t)}else o===null&&(a.shared.lanes=0);Nr|=l,e.lanes=l,e.memoizedState=y}}function Mm(e,t,s){if(e=t.effects,t.effects=null,e!==null)for(t=0;t<e.length;t++){var r=e[t],a=r.callback;if(a!==null){if(r.callback=null,r=s,typeof a!="function")throw Error(me(191,a));a.call(r)}}}var Ro={},ms=tr(Ro),co=tr(Ro),uo=tr(Ro);function mr(e){if(e===Ro)throw Error(me(174));return e}function mu(e,t){switch(ht(uo,t),ht(co,e),ht(ms,Ro),e=t.nodeType,e){case 9:case 11:t=(t=t.documentElement)?t.namespaceURI:Gc(null,"");break;default:e=e===8?t.parentNode:t,t=e.namespaceURI||null,e=e.tagName,t=Gc(t,e)}vt(ms),ht(ms,t)}function sa(){vt(ms),vt(co),vt(uo)}function dx(e){mr(uo.current);var t=mr(ms.current),s=Gc(t,e.type);t!==s&&(ht(co,e),ht(ms,s))}function pu(e){co.current===e&&(vt(ms),vt(co))}var kt=tr(0);function Wl(e){for(var t=e;t!==null;){if(t.tag===13){var s=t.memoizedState;if(s!==null&&(s=s.dehydrated,s===null||s.data==="$?"||s.data==="$!"))return t}else if(t.tag===19&&t.memoizedProps.revealOrder!==void 0){if(t.flags&128)return t}else if(t.child!==null){t.child.return=t,t=t.child;continue}if(t===e)break;for(;t.sibling===null;){if(t.return===null||t.return===e)return null;t=t.return}t.sibling.return=t.return,t=t.sibling}return null}var xc=[];function fu(){for(var e=0;e<xc.length;e++)xc[e]._workInProgressVersionPrimary=null;xc.length=0}var bl=Ts.ReactCurrentDispatcher,hc=Ts.ReactCurrentBatchConfig,yr=0,At=null,$t=null,Vt=null,zl=!1,Va=!1,mo=0,zy=0;function sn(){throw Error(me(321))}function xu(e,t){if(t===null)return!1;for(var s=0;s<t.length&&s<e.length;s++)if(!Qn(e[s],t[s]))return!1;return!0}function hu(e,t,s,r,a,o){if(yr=o,At=t,t.memoizedState=null,t.updateQueue=null,t.lanes=0,bl.current=e===null||e.memoizedState===null?Gy:qy,e=s(r,a),Va){o=0;do{if(Va=!1,mo=0,25<=o)throw Error(me(301));o+=1,Vt=$t=null,t.updateQueue=null,bl.current=Xy,e=s(r,a)}while(Va)}if(bl.current=Vl,t=$t!==null&&$t.next!==null,yr=0,Vt=$t=At=null,zl=!1,t)throw Error(me(300));return e}function gu(){var e=mo!==0;return mo=0,e}function rs(){var e={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Vt===null?At.memoizedState=Vt=e:Vt=Vt.next=e,Vt}function $n(){if($t===null){var e=At.alternate;e=e!==null?e.memoizedState:null}else e=$t.next;var t=Vt===null?At.memoizedState:Vt.next;if(t!==null)Vt=t,$t=e;else{if(e===null)throw Error(me(310));$t=e,e={memoizedState:$t.memoizedState,baseState:$t.baseState,baseQueue:$t.baseQueue,queue:$t.queue,next:null},Vt===null?At.memoizedState=Vt=e:Vt=Vt.next=e}return Vt}function po(e,t){return typeof t=="function"?t(e):t}function gc(e){var t=$n(),s=t.queue;if(s===null)throw Error(me(311));s.lastRenderedReducer=e;var r=$t,a=r.baseQueue,o=s.pending;if(o!==null){if(a!==null){var l=a.next;a.next=o.next,o.next=l}r.baseQueue=a=o,s.pending=null}if(a!==null){o=a.next,r=r.baseState;var c=l=null,i=null,u=o;do{var p=u.lane;if((yr&p)===p)i!==null&&(i=i.next={lane:0,action:u.action,hasEagerState:u.hasEagerState,eagerState:u.eagerState,next:null}),r=u.hasEagerState?u.eagerState:e(r,u.action);else{var y={lane:p,action:u.action,hasEagerState:u.hasEagerState,eagerState:u.eagerState,next:null};i===null?(c=i=y,l=r):i=i.next=y,At.lanes|=p,Nr|=p}u=u.next}while(u!==null&&u!==o);i===null?l=r:i.next=c,Qn(r,t.memoizedState)||(Nn=!0),t.memoizedState=r,t.baseState=l,t.baseQueue=i,s.lastRenderedState=r}if(e=s.interleaved,e!==null){a=e;do o=a.lane,At.lanes|=o,Nr|=o,a=a.next;while(a!==e)}else a===null&&(s.lanes=0);return[t.memoizedState,s.dispatch]}function yc(e){var t=$n(),s=t.queue;if(s===null)throw Error(me(311));s.lastRenderedReducer=e;var r=s.dispatch,a=s.pending,o=t.memoizedState;if(a!==null){s.pending=null;var l=a=a.next;do o=e(o,l.action),l=l.next;while(l!==a);Qn(o,t.memoizedState)||(Nn=!0),t.memoizedState=o,t.baseQueue===null&&(t.baseState=o),s.lastRenderedState=o}return[o,r]}function ux(){}function mx(e,t){var s=At,r=$n(),a=t(),o=!Qn(r.memoizedState,a);if(o&&(r.memoizedState=a,Nn=!0),r=r.queue,yu(xx.bind(null,s,r,e),[e]),r.getSnapshot!==t||o||Vt!==null&&Vt.memoizedState.tag&1){if(s.flags|=2048,fo(9,fx.bind(null,s,r,a,t),void 0,null),Kt===null)throw Error(me(349));yr&30||px(s,t,a)}return a}function px(e,t,s){e.flags|=16384,e={getSnapshot:t,value:s},t=At.updateQueue,t===null?(t={lastEffect:null,stores:null},At.updateQueue=t,t.stores=[e]):(s=t.stores,s===null?t.stores=[e]:s.push(e))}function fx(e,t,s,r){t.value=s,t.getSnapshot=r,hx(t)&&gx(e)}function xx(e,t,s){return s(function(){hx(t)&&gx(e)})}function hx(e){var t=e.getSnapshot;e=e.value;try{var s=t();return!Qn(e,s)}catch{return!0}}function gx(e){var t=As(e,1);t!==null&&Xn(t,e,1,-1)}function Pm(e){var t=rs();return typeof e=="function"&&(e=e()),t.memoizedState=t.baseState=e,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:po,lastRenderedState:e},t.queue=e,e=e.dispatch=Yy.bind(null,At,e),[t.memoizedState,e]}function fo(e,t,s,r){return e={tag:e,create:t,destroy:s,deps:r,next:null},t=At.updateQueue,t===null?(t={lastEffect:null,stores:null},At.updateQueue=t,t.lastEffect=e.next=e):(s=t.lastEffect,s===null?t.lastEffect=e.next=e:(r=s.next,s.next=e,e.next=r,t.lastEffect=e)),e}function yx(){return $n().memoizedState}function vl(e,t,s,r){var a=rs();At.flags|=e,a.memoizedState=fo(1|t,s,void 0,r===void 0?null:r)}function hi(e,t,s,r){var a=$n();r=r===void 0?null:r;var o=void 0;if($t!==null){var l=$t.memoizedState;if(o=l.destroy,r!==null&&xu(r,l.deps)){a.memoizedState=fo(t,s,o,r);return}}At.flags|=e,a.memoizedState=fo(1|t,s,o,r)}function Fm(e,t){return vl(8390656,8,e,t)}function yu(e,t){return hi(2048,8,e,t)}function Nx(e,t){return hi(4,2,e,t)}function bx(e,t){return hi(4,4,e,t)}function vx(e,t){if(typeof t=="function")return e=e(),t(e),function(){t(null)};if(t!=null)return e=e(),t.current=e,function(){t.current=null}}function Sx(e,t,s){return s=s!=null?s.concat([e]):null,hi(4,4,vx.bind(null,t,e),s)}function Nu(){}function wx(e,t){var s=$n();t=t===void 0?null:t;var r=s.memoizedState;return r!==null&&t!==null&&xu(t,r[1])?r[0]:(s.memoizedState=[e,t],e)}function jx(e,t){var s=$n();t=t===void 0?null:t;var r=s.memoizedState;return r!==null&&t!==null&&xu(t,r[1])?r[0]:(e=e(),s.memoizedState=[e,t],e)}function Ex(e,t,s){return yr&21?(Qn(s,t)||(s=Rf(),At.lanes|=s,Nr|=s,e.baseState=!0),t):(e.baseState&&(e.baseState=!1,Nn=!0),e.memoizedState=s)}function Vy(e,t){var s=ut;ut=s!==0&&4>s?s:4,e(!0);var r=hc.transition;hc.transition={};try{e(!1),t()}finally{ut=s,hc.transition=r}}function kx(){return $n().memoizedState}function Ky(e,t,s){var r=Xs(e);if(s={lane:r,action:s,hasEagerState:!1,eagerState:null,next:null},Ax(e))Ix(t,s);else if(s=ix(e,t,s,r),s!==null){var a=mn();Xn(s,e,r,a),Tx(s,t,r)}}function Yy(e,t,s){var r=Xs(e),a={lane:r,action:s,hasEagerState:!1,eagerState:null,next:null};if(Ax(e))Ix(t,a);else{var o=e.alternate;if(e.lanes===0&&(o===null||o.lanes===0)&&(o=t.lastRenderedReducer,o!==null))try{var l=t.lastRenderedState,c=o(l,s);if(a.hasEagerState=!0,a.eagerState=c,Qn(c,l)){var i=t.interleaved;i===null?(a.next=a,du(t)):(a.next=i.next,i.next=a),t.interleaved=a;return}}catch{}finally{}s=ix(e,t,a,r),s!==null&&(a=mn(),Xn(s,e,r,a),Tx(s,t,r))}}function Ax(e){var t=e.alternate;return e===At||t!==null&&t===At}function Ix(e,t){Va=zl=!0;var s=e.pending;s===null?t.next=t:(t.next=s.next,s.next=t),e.pending=t}function Tx(e,t,s){if(s&4194240){var r=t.lanes;r&=e.pendingLanes,s|=r,t.lanes=s,Xd(e,s)}}var Vl={readContext:Bn,useCallback:sn,useContext:sn,useEffect:sn,useImperativeHandle:sn,useInsertionEffect:sn,useLayoutEffect:sn,useMemo:sn,useReducer:sn,useRef:sn,useState:sn,useDebugValue:sn,useDeferredValue:sn,useTransition:sn,useMutableSource:sn,useSyncExternalStore:sn,useId:sn,unstable_isNewReconciler:!1},Gy={readContext:Bn,useCallback:function(e,t){return rs().memoizedState=[e,t===void 0?null:t],e},useContext:Bn,useEffect:Fm,useImperativeHandle:function(e,t,s){return s=s!=null?s.concat([e]):null,vl(4194308,4,vx.bind(null,t,e),s)},useLayoutEffect:function(e,t){return vl(4194308,4,e,t)},useInsertionEffect:function(e,t){return vl(4,2,e,t)},useMemo:function(e,t){var s=rs();return t=t===void 0?null:t,e=e(),s.memoizedState=[e,t],e},useReducer:function(e,t,s){var r=rs();return t=s!==void 0?s(t):t,r.memoizedState=r.baseState=t,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:e,lastRenderedState:t},r.queue=e,e=e.dispatch=Ky.bind(null,At,e),[r.memoizedState,e]},useRef:function(e){var t=rs();return e={current:e},t.memoizedState=e},useState:Pm,useDebugValue:Nu,useDeferredValue:function(e){return rs().memoizedState=e},useTransition:function(){var e=Pm(!1),t=e[0];return e=Vy.bind(null,e[1]),rs().memoizedState=e,[t,e]},useMutableSource:function(){},useSyncExternalStore:function(e,t,s){var r=At,a=rs();if(St){if(s===void 0)throw Error(me(407));s=s()}else{if(s=t(),Kt===null)throw Error(me(349));yr&30||px(r,t,s)}a.memoizedState=s;var o={value:s,getSnapshot:t};return a.queue=o,Fm(xx.bind(null,r,o,e),[e]),r.flags|=2048,fo(9,fx.bind(null,r,o,s,t),void 0,null),s},useId:function(){var e=rs(),t=Kt.identifierPrefix;if(St){var s=vs,r=bs;s=(r&~(1<<32-qn(r)-1)).toString(32)+s,t=":"+t+"R"+s,s=mo++,0<s&&(t+="H"+s.toString(32)),t+=":"}else s=zy++,t=":"+t+"r"+s.toString(32)+":";return e.memoizedState=t},unstable_isNewReconciler:!1},qy={readContext:Bn,useCallback:wx,useContext:Bn,useEffect:yu,useImperativeHandle:Sx,useInsertionEffect:Nx,useLayoutEffect:bx,useMemo:jx,useReducer:gc,useRef:yx,useState:function(){return gc(po)},useDebugValue:Nu,useDeferredValue:function(e){var t=$n();return Ex(t,$t.memoizedState,e)},useTransition:function(){var e=gc(po)[0],t=$n().memoizedState;return[e,t]},useMutableSource:ux,useSyncExternalStore:mx,useId:kx,unstable_isNewReconciler:!1},Xy={readContext:Bn,useCallback:wx,useContext:Bn,useEffect:yu,useImperativeHandle:Sx,useInsertionEffect:Nx,useLayoutEffect:bx,useMemo:jx,useReducer:yc,useRef:yx,useState:function(){return yc(po)},useDebugValue:Nu,useDeferredValue:function(e){var t=$n();return $t===null?t.memoizedState=e:Ex(t,$t.memoizedState,e)},useTransition:function(){var e=yc(po)[0],t=$n().memoizedState;return[e,t]},useMutableSource:ux,useSyncExternalStore:mx,useId:kx,unstable_isNewReconciler:!1};function Kn(e,t){if(e&&e.defaultProps){t=It({},t),e=e.defaultProps;for(var s in e)t[s]===void 0&&(t[s]=e[s]);return t}return t}function xd(e,t,s,r){t=e.memoizedState,s=s(r,t),s=s==null?t:It({},t,s),e.memoizedState=s,e.lanes===0&&(e.updateQueue.baseState=s)}var gi={isMounted:function(e){return(e=e._reactInternals)?wr(e)===e:!1},enqueueSetState:function(e,t,s){e=e._reactInternals;var r=mn(),a=Xs(e),o=Ss(r,a);o.payload=t,s!=null&&(o.callback=s),t=Gs(e,o,a),t!==null&&(Xn(t,e,a,r),Nl(t,e,a))},enqueueReplaceState:function(e,t,s){e=e._reactInternals;var r=mn(),a=Xs(e),o=Ss(r,a);o.tag=1,o.payload=t,s!=null&&(o.callback=s),t=Gs(e,o,a),t!==null&&(Xn(t,e,a,r),Nl(t,e,a))},enqueueForceUpdate:function(e,t){e=e._reactInternals;var s=mn(),r=Xs(e),a=Ss(s,r);a.tag=2,t!=null&&(a.callback=t),t=Gs(e,a,r),t!==null&&(Xn(t,e,r,s),Nl(t,e,r))}};function Bm(e,t,s,r,a,o,l){return e=e.stateNode,typeof e.shouldComponentUpdate=="function"?e.shouldComponentUpdate(r,o,l):t.prototype&&t.prototype.isPureReactComponent?!ao(s,r)||!ao(a,o):!0}function Rx(e,t,s){var r=!1,a=Zs,o=t.contextType;return typeof o=="object"&&o!==null?o=Bn(o):(a=vn(t)?hr:ln.current,r=t.contextTypes,o=(r=r!=null)?ea(e,a):Zs),t=new t(s,o),e.memoizedState=t.state!==null&&t.state!==void 0?t.state:null,t.updater=gi,e.stateNode=t,t._reactInternals=e,r&&(e=e.stateNode,e.__reactInternalMemoizedUnmaskedChildContext=a,e.__reactInternalMemoizedMaskedChildContext=o),t}function $m(e,t,s,r){e=t.state,typeof t.componentWillReceiveProps=="function"&&t.componentWillReceiveProps(s,r),typeof t.UNSAFE_componentWillReceiveProps=="function"&&t.UNSAFE_componentWillReceiveProps(s,r),t.state!==e&&gi.enqueueReplaceState(t,t.state,null)}function hd(e,t,s,r){var a=e.stateNode;a.props=s,a.state=e.memoizedState,a.refs={},uu(e);var o=t.contextType;typeof o=="object"&&o!==null?a.context=Bn(o):(o=vn(t)?hr:ln.current,a.context=ea(e,o)),a.state=e.memoizedState,o=t.getDerivedStateFromProps,typeof o=="function"&&(xd(e,t,o,s),a.state=e.memoizedState),typeof t.getDerivedStateFromProps=="function"||typeof a.getSnapshotBeforeUpdate=="function"||typeof a.UNSAFE_componentWillMount!="function"&&typeof a.componentWillMount!="function"||(t=a.state,typeof a.componentWillMount=="function"&&a.componentWillMount(),typeof a.UNSAFE_componentWillMount=="function"&&a.UNSAFE_componentWillMount(),t!==a.state&&gi.enqueueReplaceState(a,a.state,null),Ul(e,s,a,r),a.state=e.memoizedState),typeof a.componentDidMount=="function"&&(e.flags|=4194308)}function ra(e,t){try{var s="",r=t;do s+=jg(r),r=r.return;while(r);var a=s}catch(o){a=`
Error generating stack: `+o.message+`
`+o.stack}return{value:e,source:t,stack:a,digest:null}}function Nc(e,t,s){return{value:e,source:null,stack:s??null,digest:t??null}}function gd(e,t){try{console.error(t.value)}catch(s){setTimeout(function(){throw s})}}var Jy=typeof WeakMap=="function"?WeakMap:Map;function Cx(e,t,s){s=Ss(-1,s),s.tag=3,s.payload={element:null};var r=t.value;return s.callback=function(){Yl||(Yl=!0,Ad=r),gd(e,t)},s}function Dx(e,t,s){s=Ss(-1,s),s.tag=3;var r=e.type.getDerivedStateFromError;if(typeof r=="function"){var a=t.value;s.payload=function(){return r(a)},s.callback=function(){gd(e,t)}}var o=e.stateNode;return o!==null&&typeof o.componentDidCatch=="function"&&(s.callback=function(){gd(e,t),typeof r!="function"&&(qs===null?qs=new Set([this]):qs.add(this));var l=t.stack;this.componentDidCatch(t.value,{componentStack:l!==null?l:""})}),s}function Hm(e,t,s){var r=e.pingCache;if(r===null){r=e.pingCache=new Jy;var a=new Set;r.set(t,a)}else a=r.get(t),a===void 0&&(a=new Set,r.set(t,a));a.has(s)||(a.add(s),e=u0.bind(null,e,t,s),t.then(e,e))}function Um(e){do{var t;if((t=e.tag===13)&&(t=e.memoizedState,t=t!==null?t.dehydrated!==null:!0),t)return e;e=e.return}while(e!==null);return null}function Wm(e,t,s,r,a){return e.mode&1?(e.flags|=65536,e.lanes=a,e):(e===t?e.flags|=65536:(e.flags|=128,s.flags|=131072,s.flags&=-52805,s.tag===1&&(s.alternate===null?s.tag=17:(t=Ss(-1,1),t.tag=2,Gs(s,t,1))),s.lanes|=1),e)}var Qy=Ts.ReactCurrentOwner,Nn=!1;function un(e,t,s,r){t.child=e===null?lx(t,null,s,r):na(t,e.child,s,r)}function zm(e,t,s,r,a){s=s.render;var o=t.ref;return Xr(t,a),r=hu(e,t,s,r,o,a),s=gu(),e!==null&&!Nn?(t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~a,Is(e,t,a)):(St&&s&&ru(t),t.flags|=1,un(e,t,r,a),t.child)}function Vm(e,t,s,r,a){if(e===null){var o=s.type;return typeof o=="function"&&!Au(o)&&o.defaultProps===void 0&&s.compare===null&&s.defaultProps===void 0?(t.tag=15,t.type=o,Lx(e,t,o,r,a)):(e=El(s.type,null,r,t,t.mode,a),e.ref=t.ref,e.return=t,t.child=e)}if(o=e.child,!(e.lanes&a)){var l=o.memoizedProps;if(s=s.compare,s=s!==null?s:ao,s(l,r)&&e.ref===t.ref)return Is(e,t,a)}return t.flags|=1,e=Js(o,r),e.ref=t.ref,e.return=t,t.child=e}function Lx(e,t,s,r,a){if(e!==null){var o=e.memoizedProps;if(ao(o,r)&&e.ref===t.ref)if(Nn=!1,t.pendingProps=r=o,(e.lanes&a)!==0)e.flags&131072&&(Nn=!0);else return t.lanes=e.lanes,Is(e,t,a)}return yd(e,t,s,r,a)}function _x(e,t,s){var r=t.pendingProps,a=r.children,o=e!==null?e.memoizedState:null;if(r.mode==="hidden")if(!(t.mode&1))t.memoizedState={baseLanes:0,cachePool:null,transitions:null},ht(Vr,jn),jn|=s;else{if(!(s&1073741824))return e=o!==null?o.baseLanes|s:s,t.lanes=t.childLanes=1073741824,t.memoizedState={baseLanes:e,cachePool:null,transitions:null},t.updateQueue=null,ht(Vr,jn),jn|=e,null;t.memoizedState={baseLanes:0,cachePool:null,transitions:null},r=o!==null?o.baseLanes:s,ht(Vr,jn),jn|=r}else o!==null?(r=o.baseLanes|s,t.memoizedState=null):r=s,ht(Vr,jn),jn|=r;return un(e,t,a,s),t.child}function Ox(e,t){var s=t.ref;(e===null&&s!==null||e!==null&&e.ref!==s)&&(t.flags|=512,t.flags|=2097152)}function yd(e,t,s,r,a){var o=vn(s)?hr:ln.current;return o=ea(t,o),Xr(t,a),s=hu(e,t,s,r,o,a),r=gu(),e!==null&&!Nn?(t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~a,Is(e,t,a)):(St&&r&&ru(t),t.flags|=1,un(e,t,s,a),t.child)}function Km(e,t,s,r,a){if(vn(s)){var o=!0;Pl(t)}else o=!1;if(Xr(t,a),t.stateNode===null)Sl(e,t),Rx(t,s,r),hd(t,s,r,a),r=!0;else if(e===null){var l=t.stateNode,c=t.memoizedProps;l.props=c;var i=l.context,u=s.contextType;typeof u=="object"&&u!==null?u=Bn(u):(u=vn(s)?hr:ln.current,u=ea(t,u));var p=s.getDerivedStateFromProps,y=typeof p=="function"||typeof l.getSnapshotBeforeUpdate=="function";y||typeof l.UNSAFE_componentWillReceiveProps!="function"&&typeof l.componentWillReceiveProps!="function"||(c!==r||i!==u)&&$m(t,l,r,u),Os=!1;var b=t.memoizedState;l.state=b,Ul(t,r,l,a),i=t.memoizedState,c!==r||b!==i||bn.current||Os?(typeof p=="function"&&(xd(t,s,p,r),i=t.memoizedState),(c=Os||Bm(t,s,c,r,b,i,u))?(y||typeof l.UNSAFE_componentWillMount!="function"&&typeof l.componentWillMount!="function"||(typeof l.componentWillMount=="function"&&l.componentWillMount(),typeof l.UNSAFE_componentWillMount=="function"&&l.UNSAFE_componentWillMount()),typeof l.componentDidMount=="function"&&(t.flags|=4194308)):(typeof l.componentDidMount=="function"&&(t.flags|=4194308),t.memoizedProps=r,t.memoizedState=i),l.props=r,l.state=i,l.context=u,r=c):(typeof l.componentDidMount=="function"&&(t.flags|=4194308),r=!1)}else{l=t.stateNode,cx(e,t),c=t.memoizedProps,u=t.type===t.elementType?c:Kn(t.type,c),l.props=u,y=t.pendingProps,b=l.context,i=s.contextType,typeof i=="object"&&i!==null?i=Bn(i):(i=vn(s)?hr:ln.current,i=ea(t,i));var w=s.getDerivedStateFromProps;(p=typeof w=="function"||typeof l.getSnapshotBeforeUpdate=="function")||typeof l.UNSAFE_componentWillReceiveProps!="function"&&typeof l.componentWillReceiveProps!="function"||(c!==y||b!==i)&&$m(t,l,r,i),Os=!1,b=t.memoizedState,l.state=b,Ul(t,r,l,a);var R=t.memoizedState;c!==y||b!==R||bn.current||Os?(typeof w=="function"&&(xd(t,s,w,r),R=t.memoizedState),(u=Os||Bm(t,s,u,r,b,R,i)||!1)?(p||typeof l.UNSAFE_componentWillUpdate!="function"&&typeof l.componentWillUpdate!="function"||(typeof l.componentWillUpdate=="function"&&l.componentWillUpdate(r,R,i),typeof l.UNSAFE_componentWillUpdate=="function"&&l.UNSAFE_componentWillUpdate(r,R,i)),typeof l.componentDidUpdate=="function"&&(t.flags|=4),typeof l.getSnapshotBeforeUpdate=="function"&&(t.flags|=1024)):(typeof l.componentDidUpdate!="function"||c===e.memoizedProps&&b===e.memoizedState||(t.flags|=4),typeof l.getSnapshotBeforeUpdate!="function"||c===e.memoizedProps&&b===e.memoizedState||(t.flags|=1024),t.memoizedProps=r,t.memoizedState=R),l.props=r,l.state=R,l.context=i,r=u):(typeof l.componentDidUpdate!="function"||c===e.memoizedProps&&b===e.memoizedState||(t.flags|=4),typeof l.getSnapshotBeforeUpdate!="function"||c===e.memoizedProps&&b===e.memoizedState||(t.flags|=1024),r=!1)}return Nd(e,t,s,r,o,a)}function Nd(e,t,s,r,a,o){Ox(e,t);var l=(t.flags&128)!==0;if(!r&&!l)return a&&Cm(t,s,!1),Is(e,t,o);r=t.stateNode,Qy.current=t;var c=l&&typeof s.getDerivedStateFromError!="function"?null:r.render();return t.flags|=1,e!==null&&l?(t.child=na(t,e.child,null,o),t.child=na(t,null,c,o)):un(e,t,c,o),t.memoizedState=r.state,a&&Cm(t,s,!0),t.child}function Mx(e){var t=e.stateNode;t.pendingContext?Rm(e,t.pendingContext,t.pendingContext!==t.context):t.context&&Rm(e,t.context,!1),mu(e,t.containerInfo)}function Ym(e,t,s,r,a){return ta(),ou(a),t.flags|=256,un(e,t,s,r),t.child}var bd={dehydrated:null,treeContext:null,retryLane:0};function vd(e){return{baseLanes:e,cachePool:null,transitions:null}}function Px(e,t,s){var r=t.pendingProps,a=kt.current,o=!1,l=(t.flags&128)!==0,c;if((c=l)||(c=e!==null&&e.memoizedState===null?!1:(a&2)!==0),c?(o=!0,t.flags&=-129):(e===null||e.memoizedState!==null)&&(a|=1),ht(kt,a&1),e===null)return pd(t),e=t.memoizedState,e!==null&&(e=e.dehydrated,e!==null)?(t.mode&1?e.data==="$!"?t.lanes=8:t.lanes=1073741824:t.lanes=1,null):(l=r.children,e=r.fallback,o?(r=t.mode,o=t.child,l={mode:"hidden",children:l},!(r&1)&&o!==null?(o.childLanes=0,o.pendingProps=l):o=bi(l,r,0,null),e=fr(e,r,s,null),o.return=t,e.return=t,o.sibling=e,t.child=o,t.child.memoizedState=vd(s),t.memoizedState=bd,e):bu(t,l));if(a=e.memoizedState,a!==null&&(c=a.dehydrated,c!==null))return Zy(e,t,l,r,c,a,s);if(o){o=r.fallback,l=t.mode,a=e.child,c=a.sibling;var i={mode:"hidden",children:r.children};return!(l&1)&&t.child!==a?(r=t.child,r.childLanes=0,r.pendingProps=i,t.deletions=null):(r=Js(a,i),r.subtreeFlags=a.subtreeFlags&14680064),c!==null?o=Js(c,o):(o=fr(o,l,s,null),o.flags|=2),o.return=t,r.return=t,r.sibling=o,t.child=r,r=o,o=t.child,l=e.child.memoizedState,l=l===null?vd(s):{baseLanes:l.baseLanes|s,cachePool:null,transitions:l.transitions},o.memoizedState=l,o.childLanes=e.childLanes&~s,t.memoizedState=bd,r}return o=e.child,e=o.sibling,r=Js(o,{mode:"visible",children:r.children}),!(t.mode&1)&&(r.lanes=s),r.return=t,r.sibling=null,e!==null&&(s=t.deletions,s===null?(t.deletions=[e],t.flags|=16):s.push(e)),t.child=r,t.memoizedState=null,r}function bu(e,t){return t=bi({mode:"visible",children:t},e.mode,0,null),t.return=e,e.child=t}function sl(e,t,s,r){return r!==null&&ou(r),na(t,e.child,null,s),e=bu(t,t.pendingProps.children),e.flags|=2,t.memoizedState=null,e}function Zy(e,t,s,r,a,o,l){if(s)return t.flags&256?(t.flags&=-257,r=Nc(Error(me(422))),sl(e,t,l,r)):t.memoizedState!==null?(t.child=e.child,t.flags|=128,null):(o=r.fallback,a=t.mode,r=bi({mode:"visible",children:r.children},a,0,null),o=fr(o,a,l,null),o.flags|=2,r.return=t,o.return=t,r.sibling=o,t.child=r,t.mode&1&&na(t,e.child,null,l),t.child.memoizedState=vd(l),t.memoizedState=bd,o);if(!(t.mode&1))return sl(e,t,l,null);if(a.data==="$!"){if(r=a.nextSibling&&a.nextSibling.dataset,r)var c=r.dgst;return r=c,o=Error(me(419)),r=Nc(o,r,void 0),sl(e,t,l,r)}if(c=(l&e.childLanes)!==0,Nn||c){if(r=Kt,r!==null){switch(l&-l){case 4:a=2;break;case 16:a=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:a=32;break;case 536870912:a=268435456;break;default:a=0}a=a&(r.suspendedLanes|l)?0:a,a!==0&&a!==o.retryLane&&(o.retryLane=a,As(e,a),Xn(r,e,a,-1))}return ku(),r=Nc(Error(me(421))),sl(e,t,l,r)}return a.data==="$?"?(t.flags|=128,t.child=e.child,t=m0.bind(null,e),a._reactRetry=t,null):(e=o.treeContext,kn=Ys(a.nextSibling),An=t,St=!0,Gn=null,e!==null&&(_n[On++]=bs,_n[On++]=vs,_n[On++]=gr,bs=e.id,vs=e.overflow,gr=t),t=bu(t,r.children),t.flags|=4096,t)}function Gm(e,t,s){e.lanes|=t;var r=e.alternate;r!==null&&(r.lanes|=t),fd(e.return,t,s)}function bc(e,t,s,r,a){var o=e.memoizedState;o===null?e.memoizedState={isBackwards:t,rendering:null,renderingStartTime:0,last:r,tail:s,tailMode:a}:(o.isBackwards=t,o.rendering=null,o.renderingStartTime=0,o.last=r,o.tail=s,o.tailMode=a)}function Fx(e,t,s){var r=t.pendingProps,a=r.revealOrder,o=r.tail;if(un(e,t,r.children,s),r=kt.current,r&2)r=r&1|2,t.flags|=128;else{if(e!==null&&e.flags&128)e:for(e=t.child;e!==null;){if(e.tag===13)e.memoizedState!==null&&Gm(e,s,t);else if(e.tag===19)Gm(e,s,t);else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===t)break e;for(;e.sibling===null;){if(e.return===null||e.return===t)break e;e=e.return}e.sibling.return=e.return,e=e.sibling}r&=1}if(ht(kt,r),!(t.mode&1))t.memoizedState=null;else switch(a){case"forwards":for(s=t.child,a=null;s!==null;)e=s.alternate,e!==null&&Wl(e)===null&&(a=s),s=s.sibling;s=a,s===null?(a=t.child,t.child=null):(a=s.sibling,s.sibling=null),bc(t,!1,a,s,o);break;case"backwards":for(s=null,a=t.child,t.child=null;a!==null;){if(e=a.alternate,e!==null&&Wl(e)===null){t.child=a;break}e=a.sibling,a.sibling=s,s=a,a=e}bc(t,!0,s,null,o);break;case"together":bc(t,!1,null,null,void 0);break;default:t.memoizedState=null}return t.child}function Sl(e,t){!(t.mode&1)&&e!==null&&(e.alternate=null,t.alternate=null,t.flags|=2)}function Is(e,t,s){if(e!==null&&(t.dependencies=e.dependencies),Nr|=t.lanes,!(s&t.childLanes))return null;if(e!==null&&t.child!==e.child)throw Error(me(153));if(t.child!==null){for(e=t.child,s=Js(e,e.pendingProps),t.child=s,s.return=t;e.sibling!==null;)e=e.sibling,s=s.sibling=Js(e,e.pendingProps),s.return=t;s.sibling=null}return t.child}function e0(e,t,s){switch(t.tag){case 3:Mx(t),ta();break;case 5:dx(t);break;case 1:vn(t.type)&&Pl(t);break;case 4:mu(t,t.stateNode.containerInfo);break;case 10:var r=t.type._context,a=t.memoizedProps.value;ht($l,r._currentValue),r._currentValue=a;break;case 13:if(r=t.memoizedState,r!==null)return r.dehydrated!==null?(ht(kt,kt.current&1),t.flags|=128,null):s&t.child.childLanes?Px(e,t,s):(ht(kt,kt.current&1),e=Is(e,t,s),e!==null?e.sibling:null);ht(kt,kt.current&1);break;case 19:if(r=(s&t.childLanes)!==0,e.flags&128){if(r)return Fx(e,t,s);t.flags|=128}if(a=t.memoizedState,a!==null&&(a.rendering=null,a.tail=null,a.lastEffect=null),ht(kt,kt.current),r)break;return null;case 22:case 23:return t.lanes=0,_x(e,t,s)}return Is(e,t,s)}var Bx,Sd,$x,Hx;Bx=function(e,t){for(var s=t.child;s!==null;){if(s.tag===5||s.tag===6)e.appendChild(s.stateNode);else if(s.tag!==4&&s.child!==null){s.child.return=s,s=s.child;continue}if(s===t)break;for(;s.sibling===null;){if(s.return===null||s.return===t)return;s=s.return}s.sibling.return=s.return,s=s.sibling}};Sd=function(){};$x=function(e,t,s,r){var a=e.memoizedProps;if(a!==r){e=t.stateNode,mr(ms.current);var o=null;switch(s){case"input":a=zc(e,a),r=zc(e,r),o=[];break;case"select":a=It({},a,{value:void 0}),r=It({},r,{value:void 0}),o=[];break;case"textarea":a=Yc(e,a),r=Yc(e,r),o=[];break;default:typeof a.onClick!="function"&&typeof r.onClick=="function"&&(e.onclick=Ol)}qc(s,r);var l;s=null;for(u in a)if(!r.hasOwnProperty(u)&&a.hasOwnProperty(u)&&a[u]!=null)if(u==="style"){var c=a[u];for(l in c)c.hasOwnProperty(l)&&(s||(s={}),s[l]="")}else u!=="dangerouslySetInnerHTML"&&u!=="children"&&u!=="suppressContentEditableWarning"&&u!=="suppressHydrationWarning"&&u!=="autoFocus"&&(Qa.hasOwnProperty(u)?o||(o=[]):(o=o||[]).push(u,null));for(u in r){var i=r[u];if(c=a!=null?a[u]:void 0,r.hasOwnProperty(u)&&i!==c&&(i!=null||c!=null))if(u==="style")if(c){for(l in c)!c.hasOwnProperty(l)||i&&i.hasOwnProperty(l)||(s||(s={}),s[l]="");for(l in i)i.hasOwnProperty(l)&&c[l]!==i[l]&&(s||(s={}),s[l]=i[l])}else s||(o||(o=[]),o.push(u,s)),s=i;else u==="dangerouslySetInnerHTML"?(i=i?i.__html:void 0,c=c?c.__html:void 0,i!=null&&c!==i&&(o=o||[]).push(u,i)):u==="children"?typeof i!="string"&&typeof i!="number"||(o=o||[]).push(u,""+i):u!=="suppressContentEditableWarning"&&u!=="suppressHydrationWarning"&&(Qa.hasOwnProperty(u)?(i!=null&&u==="onScroll"&&Nt("scroll",e),o||c===i||(o=[])):(o=o||[]).push(u,i))}s&&(o=o||[]).push("style",s);var u=o;(t.updateQueue=u)&&(t.flags|=4)}};Hx=function(e,t,s,r){s!==r&&(t.flags|=4)};function Ca(e,t){if(!St)switch(e.tailMode){case"hidden":t=e.tail;for(var s=null;t!==null;)t.alternate!==null&&(s=t),t=t.sibling;s===null?e.tail=null:s.sibling=null;break;case"collapsed":s=e.tail;for(var r=null;s!==null;)s.alternate!==null&&(r=s),s=s.sibling;r===null?t||e.tail===null?e.tail=null:e.tail.sibling=null:r.sibling=null}}function rn(e){var t=e.alternate!==null&&e.alternate.child===e.child,s=0,r=0;if(t)for(var a=e.child;a!==null;)s|=a.lanes|a.childLanes,r|=a.subtreeFlags&14680064,r|=a.flags&14680064,a.return=e,a=a.sibling;else for(a=e.child;a!==null;)s|=a.lanes|a.childLanes,r|=a.subtreeFlags,r|=a.flags,a.return=e,a=a.sibling;return e.subtreeFlags|=r,e.childLanes=s,t}function t0(e,t,s){var r=t.pendingProps;switch(au(t),t.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return rn(t),null;case 1:return vn(t.type)&&Ml(),rn(t),null;case 3:return r=t.stateNode,sa(),vt(bn),vt(ln),fu(),r.pendingContext&&(r.context=r.pendingContext,r.pendingContext=null),(e===null||e.child===null)&&(tl(t)?t.flags|=4:e===null||e.memoizedState.isDehydrated&&!(t.flags&256)||(t.flags|=1024,Gn!==null&&(Rd(Gn),Gn=null))),Sd(e,t),rn(t),null;case 5:pu(t);var a=mr(uo.current);if(s=t.type,e!==null&&t.stateNode!=null)$x(e,t,s,r,a),e.ref!==t.ref&&(t.flags|=512,t.flags|=2097152);else{if(!r){if(t.stateNode===null)throw Error(me(166));return rn(t),null}if(e=mr(ms.current),tl(t)){r=t.stateNode,s=t.type;var o=t.memoizedProps;switch(r[ls]=t,r[io]=o,e=(t.mode&1)!==0,s){case"dialog":Nt("cancel",r),Nt("close",r);break;case"iframe":case"object":case"embed":Nt("load",r);break;case"video":case"audio":for(a=0;a<Ba.length;a++)Nt(Ba[a],r);break;case"source":Nt("error",r);break;case"img":case"image":case"link":Nt("error",r),Nt("load",r);break;case"details":Nt("toggle",r);break;case"input":sm(r,o),Nt("invalid",r);break;case"select":r._wrapperState={wasMultiple:!!o.multiple},Nt("invalid",r);break;case"textarea":am(r,o),Nt("invalid",r)}qc(s,o),a=null;for(var l in o)if(o.hasOwnProperty(l)){var c=o[l];l==="children"?typeof c=="string"?r.textContent!==c&&(o.suppressHydrationWarning!==!0&&el(r.textContent,c,e),a=["children",c]):typeof c=="number"&&r.textContent!==""+c&&(o.suppressHydrationWarning!==!0&&el(r.textContent,c,e),a=["children",""+c]):Qa.hasOwnProperty(l)&&c!=null&&l==="onScroll"&&Nt("scroll",r)}switch(s){case"input":Ko(r),rm(r,o,!0);break;case"textarea":Ko(r),om(r);break;case"select":case"option":break;default:typeof o.onClick=="function"&&(r.onclick=Ol)}r=a,t.updateQueue=r,r!==null&&(t.flags|=4)}else{l=a.nodeType===9?a:a.ownerDocument,e==="http://www.w3.org/1999/xhtml"&&(e=xf(s)),e==="http://www.w3.org/1999/xhtml"?s==="script"?(e=l.createElement("div"),e.innerHTML="<script><\/script>",e=e.removeChild(e.firstChild)):typeof r.is=="string"?e=l.createElement(s,{is:r.is}):(e=l.createElement(s),s==="select"&&(l=e,r.multiple?l.multiple=!0:r.size&&(l.size=r.size))):e=l.createElementNS(e,s),e[ls]=t,e[io]=r,Bx(e,t,!1,!1),t.stateNode=e;e:{switch(l=Xc(s,r),s){case"dialog":Nt("cancel",e),Nt("close",e),a=r;break;case"iframe":case"object":case"embed":Nt("load",e),a=r;break;case"video":case"audio":for(a=0;a<Ba.length;a++)Nt(Ba[a],e);a=r;break;case"source":Nt("error",e),a=r;break;case"img":case"image":case"link":Nt("error",e),Nt("load",e),a=r;break;case"details":Nt("toggle",e),a=r;break;case"input":sm(e,r),a=zc(e,r),Nt("invalid",e);break;case"option":a=r;break;case"select":e._wrapperState={wasMultiple:!!r.multiple},a=It({},r,{value:void 0}),Nt("invalid",e);break;case"textarea":am(e,r),a=Yc(e,r),Nt("invalid",e);break;default:a=r}qc(s,a),c=a;for(o in c)if(c.hasOwnProperty(o)){var i=c[o];o==="style"?yf(e,i):o==="dangerouslySetInnerHTML"?(i=i?i.__html:void 0,i!=null&&hf(e,i)):o==="children"?typeof i=="string"?(s!=="textarea"||i!=="")&&Za(e,i):typeof i=="number"&&Za(e,""+i):o!=="suppressContentEditableWarning"&&o!=="suppressHydrationWarning"&&o!=="autoFocus"&&(Qa.hasOwnProperty(o)?i!=null&&o==="onScroll"&&Nt("scroll",e):i!=null&&zd(e,o,i,l))}switch(s){case"input":Ko(e),rm(e,r,!1);break;case"textarea":Ko(e),om(e);break;case"option":r.value!=null&&e.setAttribute("value",""+Qs(r.value));break;case"select":e.multiple=!!r.multiple,o=r.value,o!=null?Kr(e,!!r.multiple,o,!1):r.defaultValue!=null&&Kr(e,!!r.multiple,r.defaultValue,!0);break;default:typeof a.onClick=="function"&&(e.onclick=Ol)}switch(s){case"button":case"input":case"select":case"textarea":r=!!r.autoFocus;break e;case"img":r=!0;break e;default:r=!1}}r&&(t.flags|=4)}t.ref!==null&&(t.flags|=512,t.flags|=2097152)}return rn(t),null;case 6:if(e&&t.stateNode!=null)Hx(e,t,e.memoizedProps,r);else{if(typeof r!="string"&&t.stateNode===null)throw Error(me(166));if(s=mr(uo.current),mr(ms.current),tl(t)){if(r=t.stateNode,s=t.memoizedProps,r[ls]=t,(o=r.nodeValue!==s)&&(e=An,e!==null))switch(e.tag){case 3:el(r.nodeValue,s,(e.mode&1)!==0);break;case 5:e.memoizedProps.suppressHydrationWarning!==!0&&el(r.nodeValue,s,(e.mode&1)!==0)}o&&(t.flags|=4)}else r=(s.nodeType===9?s:s.ownerDocument).createTextNode(r),r[ls]=t,t.stateNode=r}return rn(t),null;case 13:if(vt(kt),r=t.memoizedState,e===null||e.memoizedState!==null&&e.memoizedState.dehydrated!==null){if(St&&kn!==null&&t.mode&1&&!(t.flags&128))ax(),ta(),t.flags|=98560,o=!1;else if(o=tl(t),r!==null&&r.dehydrated!==null){if(e===null){if(!o)throw Error(me(318));if(o=t.memoizedState,o=o!==null?o.dehydrated:null,!o)throw Error(me(317));o[ls]=t}else ta(),!(t.flags&128)&&(t.memoizedState=null),t.flags|=4;rn(t),o=!1}else Gn!==null&&(Rd(Gn),Gn=null),o=!0;if(!o)return t.flags&65536?t:null}return t.flags&128?(t.lanes=s,t):(r=r!==null,r!==(e!==null&&e.memoizedState!==null)&&r&&(t.child.flags|=8192,t.mode&1&&(e===null||kt.current&1?Ut===0&&(Ut=3):ku())),t.updateQueue!==null&&(t.flags|=4),rn(t),null);case 4:return sa(),Sd(e,t),e===null&&oo(t.stateNode.containerInfo),rn(t),null;case 10:return cu(t.type._context),rn(t),null;case 17:return vn(t.type)&&Ml(),rn(t),null;case 19:if(vt(kt),o=t.memoizedState,o===null)return rn(t),null;if(r=(t.flags&128)!==0,l=o.rendering,l===null)if(r)Ca(o,!1);else{if(Ut!==0||e!==null&&e.flags&128)for(e=t.child;e!==null;){if(l=Wl(e),l!==null){for(t.flags|=128,Ca(o,!1),r=l.updateQueue,r!==null&&(t.updateQueue=r,t.flags|=4),t.subtreeFlags=0,r=s,s=t.child;s!==null;)o=s,e=r,o.flags&=14680066,l=o.alternate,l===null?(o.childLanes=0,o.lanes=e,o.child=null,o.subtreeFlags=0,o.memoizedProps=null,o.memoizedState=null,o.updateQueue=null,o.dependencies=null,o.stateNode=null):(o.childLanes=l.childLanes,o.lanes=l.lanes,o.child=l.child,o.subtreeFlags=0,o.deletions=null,o.memoizedProps=l.memoizedProps,o.memoizedState=l.memoizedState,o.updateQueue=l.updateQueue,o.type=l.type,e=l.dependencies,o.dependencies=e===null?null:{lanes:e.lanes,firstContext:e.firstContext}),s=s.sibling;return ht(kt,kt.current&1|2),t.child}e=e.sibling}o.tail!==null&&Lt()>aa&&(t.flags|=128,r=!0,Ca(o,!1),t.lanes=4194304)}else{if(!r)if(e=Wl(l),e!==null){if(t.flags|=128,r=!0,s=e.updateQueue,s!==null&&(t.updateQueue=s,t.flags|=4),Ca(o,!0),o.tail===null&&o.tailMode==="hidden"&&!l.alternate&&!St)return rn(t),null}else 2*Lt()-o.renderingStartTime>aa&&s!==1073741824&&(t.flags|=128,r=!0,Ca(o,!1),t.lanes=4194304);o.isBackwards?(l.sibling=t.child,t.child=l):(s=o.last,s!==null?s.sibling=l:t.child=l,o.last=l)}return o.tail!==null?(t=o.tail,o.rendering=t,o.tail=t.sibling,o.renderingStartTime=Lt(),t.sibling=null,s=kt.current,ht(kt,r?s&1|2:s&1),t):(rn(t),null);case 22:case 23:return Eu(),r=t.memoizedState!==null,e!==null&&e.memoizedState!==null!==r&&(t.flags|=8192),r&&t.mode&1?jn&1073741824&&(rn(t),t.subtreeFlags&6&&(t.flags|=8192)):rn(t),null;case 24:return null;case 25:return null}throw Error(me(156,t.tag))}function n0(e,t){switch(au(t),t.tag){case 1:return vn(t.type)&&Ml(),e=t.flags,e&65536?(t.flags=e&-65537|128,t):null;case 3:return sa(),vt(bn),vt(ln),fu(),e=t.flags,e&65536&&!(e&128)?(t.flags=e&-65537|128,t):null;case 5:return pu(t),null;case 13:if(vt(kt),e=t.memoizedState,e!==null&&e.dehydrated!==null){if(t.alternate===null)throw Error(me(340));ta()}return e=t.flags,e&65536?(t.flags=e&-65537|128,t):null;case 19:return vt(kt),null;case 4:return sa(),null;case 10:return cu(t.type._context),null;case 22:case 23:return Eu(),null;case 24:return null;default:return null}}var rl=!1,an=!1,s0=typeof WeakSet=="function"?WeakSet:Set,ke=null;function zr(e,t){var s=e.ref;if(s!==null)if(typeof s=="function")try{s(null)}catch(r){Rt(e,t,r)}else s.current=null}function wd(e,t,s){try{s()}catch(r){Rt(e,t,r)}}var qm=!1;function r0(e,t){if(od=Dl,e=Kf(),su(e)){if("selectionStart"in e)var s={start:e.selectionStart,end:e.selectionEnd};else e:{s=(s=e.ownerDocument)&&s.defaultView||window;var r=s.getSelection&&s.getSelection();if(r&&r.rangeCount!==0){s=r.anchorNode;var a=r.anchorOffset,o=r.focusNode;r=r.focusOffset;try{s.nodeType,o.nodeType}catch{s=null;break e}var l=0,c=-1,i=-1,u=0,p=0,y=e,b=null;t:for(;;){for(var w;y!==s||a!==0&&y.nodeType!==3||(c=l+a),y!==o||r!==0&&y.nodeType!==3||(i=l+r),y.nodeType===3&&(l+=y.nodeValue.length),(w=y.firstChild)!==null;)b=y,y=w;for(;;){if(y===e)break t;if(b===s&&++u===a&&(c=l),b===o&&++p===r&&(i=l),(w=y.nextSibling)!==null)break;y=b,b=y.parentNode}y=w}s=c===-1||i===-1?null:{start:c,end:i}}else s=null}s=s||{start:0,end:0}}else s=null;for(ld={focusedElem:e,selectionRange:s},Dl=!1,ke=t;ke!==null;)if(t=ke,e=t.child,(t.subtreeFlags&1028)!==0&&e!==null)e.return=t,ke=e;else for(;ke!==null;){t=ke;try{var R=t.alternate;if(t.flags&1024)switch(t.tag){case 0:case 11:case 15:break;case 1:if(R!==null){var E=R.memoizedProps,W=R.memoizedState,N=t.stateNode,h=N.getSnapshotBeforeUpdate(t.elementType===t.type?E:Kn(t.type,E),W);N.__reactInternalSnapshotBeforeUpdate=h}break;case 3:var S=t.stateNode.containerInfo;S.nodeType===1?S.textContent="":S.nodeType===9&&S.documentElement&&S.removeChild(S.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(me(163))}}catch(P){Rt(t,t.return,P)}if(e=t.sibling,e!==null){e.return=t.return,ke=e;break}ke=t.return}return R=qm,qm=!1,R}function Ka(e,t,s){var r=t.updateQueue;if(r=r!==null?r.lastEffect:null,r!==null){var a=r=r.next;do{if((a.tag&e)===e){var o=a.destroy;a.destroy=void 0,o!==void 0&&wd(t,s,o)}a=a.next}while(a!==r)}}function yi(e,t){if(t=t.updateQueue,t=t!==null?t.lastEffect:null,t!==null){var s=t=t.next;do{if((s.tag&e)===e){var r=s.create;s.destroy=r()}s=s.next}while(s!==t)}}function jd(e){var t=e.ref;if(t!==null){var s=e.stateNode;switch(e.tag){case 5:e=s;break;default:e=s}typeof t=="function"?t(e):t.current=e}}function Ux(e){var t=e.alternate;t!==null&&(e.alternate=null,Ux(t)),e.child=null,e.deletions=null,e.sibling=null,e.tag===5&&(t=e.stateNode,t!==null&&(delete t[ls],delete t[io],delete t[dd],delete t[$y],delete t[Hy])),e.stateNode=null,e.return=null,e.dependencies=null,e.memoizedProps=null,e.memoizedState=null,e.pendingProps=null,e.stateNode=null,e.updateQueue=null}function Wx(e){return e.tag===5||e.tag===3||e.tag===4}function Xm(e){e:for(;;){for(;e.sibling===null;){if(e.return===null||Wx(e.return))return null;e=e.return}for(e.sibling.return=e.return,e=e.sibling;e.tag!==5&&e.tag!==6&&e.tag!==18;){if(e.flags&2||e.child===null||e.tag===4)continue e;e.child.return=e,e=e.child}if(!(e.flags&2))return e.stateNode}}function Ed(e,t,s){var r=e.tag;if(r===5||r===6)e=e.stateNode,t?s.nodeType===8?s.parentNode.insertBefore(e,t):s.insertBefore(e,t):(s.nodeType===8?(t=s.parentNode,t.insertBefore(e,s)):(t=s,t.appendChild(e)),s=s._reactRootContainer,s!=null||t.onclick!==null||(t.onclick=Ol));else if(r!==4&&(e=e.child,e!==null))for(Ed(e,t,s),e=e.sibling;e!==null;)Ed(e,t,s),e=e.sibling}function kd(e,t,s){var r=e.tag;if(r===5||r===6)e=e.stateNode,t?s.insertBefore(e,t):s.appendChild(e);else if(r!==4&&(e=e.child,e!==null))for(kd(e,t,s),e=e.sibling;e!==null;)kd(e,t,s),e=e.sibling}var Gt=null,Yn=!1;function Ls(e,t,s){for(s=s.child;s!==null;)zx(e,t,s),s=s.sibling}function zx(e,t,s){if(us&&typeof us.onCommitFiberUnmount=="function")try{us.onCommitFiberUnmount(di,s)}catch{}switch(s.tag){case 5:an||zr(s,t);case 6:var r=Gt,a=Yn;Gt=null,Ls(e,t,s),Gt=r,Yn=a,Gt!==null&&(Yn?(e=Gt,s=s.stateNode,e.nodeType===8?e.parentNode.removeChild(s):e.removeChild(s)):Gt.removeChild(s.stateNode));break;case 18:Gt!==null&&(Yn?(e=Gt,s=s.stateNode,e.nodeType===8?pc(e.parentNode,s):e.nodeType===1&&pc(e,s),so(e)):pc(Gt,s.stateNode));break;case 4:r=Gt,a=Yn,Gt=s.stateNode.containerInfo,Yn=!0,Ls(e,t,s),Gt=r,Yn=a;break;case 0:case 11:case 14:case 15:if(!an&&(r=s.updateQueue,r!==null&&(r=r.lastEffect,r!==null))){a=r=r.next;do{var o=a,l=o.destroy;o=o.tag,l!==void 0&&(o&2||o&4)&&wd(s,t,l),a=a.next}while(a!==r)}Ls(e,t,s);break;case 1:if(!an&&(zr(s,t),r=s.stateNode,typeof r.componentWillUnmount=="function"))try{r.props=s.memoizedProps,r.state=s.memoizedState,r.componentWillUnmount()}catch(c){Rt(s,t,c)}Ls(e,t,s);break;case 21:Ls(e,t,s);break;case 22:s.mode&1?(an=(r=an)||s.memoizedState!==null,Ls(e,t,s),an=r):Ls(e,t,s);break;default:Ls(e,t,s)}}function Jm(e){var t=e.updateQueue;if(t!==null){e.updateQueue=null;var s=e.stateNode;s===null&&(s=e.stateNode=new s0),t.forEach(function(r){var a=p0.bind(null,e,r);s.has(r)||(s.add(r),r.then(a,a))})}}function Vn(e,t){var s=t.deletions;if(s!==null)for(var r=0;r<s.length;r++){var a=s[r];try{var o=e,l=t,c=l;e:for(;c!==null;){switch(c.tag){case 5:Gt=c.stateNode,Yn=!1;break e;case 3:Gt=c.stateNode.containerInfo,Yn=!0;break e;case 4:Gt=c.stateNode.containerInfo,Yn=!0;break e}c=c.return}if(Gt===null)throw Error(me(160));zx(o,l,a),Gt=null,Yn=!1;var i=a.alternate;i!==null&&(i.return=null),a.return=null}catch(u){Rt(a,t,u)}}if(t.subtreeFlags&12854)for(t=t.child;t!==null;)Vx(t,e),t=t.sibling}function Vx(e,t){var s=e.alternate,r=e.flags;switch(e.tag){case 0:case 11:case 14:case 15:if(Vn(t,e),ss(e),r&4){try{Ka(3,e,e.return),yi(3,e)}catch(E){Rt(e,e.return,E)}try{Ka(5,e,e.return)}catch(E){Rt(e,e.return,E)}}break;case 1:Vn(t,e),ss(e),r&512&&s!==null&&zr(s,s.return);break;case 5:if(Vn(t,e),ss(e),r&512&&s!==null&&zr(s,s.return),e.flags&32){var a=e.stateNode;try{Za(a,"")}catch(E){Rt(e,e.return,E)}}if(r&4&&(a=e.stateNode,a!=null)){var o=e.memoizedProps,l=s!==null?s.memoizedProps:o,c=e.type,i=e.updateQueue;if(e.updateQueue=null,i!==null)try{c==="input"&&o.type==="radio"&&o.name!=null&&pf(a,o),Xc(c,l);var u=Xc(c,o);for(l=0;l<i.length;l+=2){var p=i[l],y=i[l+1];p==="style"?yf(a,y):p==="dangerouslySetInnerHTML"?hf(a,y):p==="children"?Za(a,y):zd(a,p,y,u)}switch(c){case"input":Vc(a,o);break;case"textarea":ff(a,o);break;case"select":var b=a._wrapperState.wasMultiple;a._wrapperState.wasMultiple=!!o.multiple;var w=o.value;w!=null?Kr(a,!!o.multiple,w,!1):b!==!!o.multiple&&(o.defaultValue!=null?Kr(a,!!o.multiple,o.defaultValue,!0):Kr(a,!!o.multiple,o.multiple?[]:"",!1))}a[io]=o}catch(E){Rt(e,e.return,E)}}break;case 6:if(Vn(t,e),ss(e),r&4){if(e.stateNode===null)throw Error(me(162));a=e.stateNode,o=e.memoizedProps;try{a.nodeValue=o}catch(E){Rt(e,e.return,E)}}break;case 3:if(Vn(t,e),ss(e),r&4&&s!==null&&s.memoizedState.isDehydrated)try{so(t.containerInfo)}catch(E){Rt(e,e.return,E)}break;case 4:Vn(t,e),ss(e);break;case 13:Vn(t,e),ss(e),a=e.child,a.flags&8192&&(o=a.memoizedState!==null,a.stateNode.isHidden=o,!o||a.alternate!==null&&a.alternate.memoizedState!==null||(wu=Lt())),r&4&&Jm(e);break;case 22:if(p=s!==null&&s.memoizedState!==null,e.mode&1?(an=(u=an)||p,Vn(t,e),an=u):Vn(t,e),ss(e),r&8192){if(u=e.memoizedState!==null,(e.stateNode.isHidden=u)&&!p&&e.mode&1)for(ke=e,p=e.child;p!==null;){for(y=ke=p;ke!==null;){switch(b=ke,w=b.child,b.tag){case 0:case 11:case 14:case 15:Ka(4,b,b.return);break;case 1:zr(b,b.return);var R=b.stateNode;if(typeof R.componentWillUnmount=="function"){r=b,s=b.return;try{t=r,R.props=t.memoizedProps,R.state=t.memoizedState,R.componentWillUnmount()}catch(E){Rt(r,s,E)}}break;case 5:zr(b,b.return);break;case 22:if(b.memoizedState!==null){Zm(y);continue}}w!==null?(w.return=b,ke=w):Zm(y)}p=p.sibling}e:for(p=null,y=e;;){if(y.tag===5){if(p===null){p=y;try{a=y.stateNode,u?(o=a.style,typeof o.setProperty=="function"?o.setProperty("display","none","important"):o.display="none"):(c=y.stateNode,i=y.memoizedProps.style,l=i!=null&&i.hasOwnProperty("display")?i.display:null,c.style.display=gf("display",l))}catch(E){Rt(e,e.return,E)}}}else if(y.tag===6){if(p===null)try{y.stateNode.nodeValue=u?"":y.memoizedProps}catch(E){Rt(e,e.return,E)}}else if((y.tag!==22&&y.tag!==23||y.memoizedState===null||y===e)&&y.child!==null){y.child.return=y,y=y.child;continue}if(y===e)break e;for(;y.sibling===null;){if(y.return===null||y.return===e)break e;p===y&&(p=null),y=y.return}p===y&&(p=null),y.sibling.return=y.return,y=y.sibling}}break;case 19:Vn(t,e),ss(e),r&4&&Jm(e);break;case 21:break;default:Vn(t,e),ss(e)}}function ss(e){var t=e.flags;if(t&2){try{e:{for(var s=e.return;s!==null;){if(Wx(s)){var r=s;break e}s=s.return}throw Error(me(160))}switch(r.tag){case 5:var a=r.stateNode;r.flags&32&&(Za(a,""),r.flags&=-33);var o=Xm(e);kd(e,o,a);break;case 3:case 4:var l=r.stateNode.containerInfo,c=Xm(e);Ed(e,c,l);break;default:throw Error(me(161))}}catch(i){Rt(e,e.return,i)}e.flags&=-3}t&4096&&(e.flags&=-4097)}function a0(e,t,s){ke=e,Kx(e)}function Kx(e,t,s){for(var r=(e.mode&1)!==0;ke!==null;){var a=ke,o=a.child;if(a.tag===22&&r){var l=a.memoizedState!==null||rl;if(!l){var c=a.alternate,i=c!==null&&c.memoizedState!==null||an;c=rl;var u=an;if(rl=l,(an=i)&&!u)for(ke=a;ke!==null;)l=ke,i=l.child,l.tag===22&&l.memoizedState!==null?ep(a):i!==null?(i.return=l,ke=i):ep(a);for(;o!==null;)ke=o,Kx(o),o=o.sibling;ke=a,rl=c,an=u}Qm(e)}else a.subtreeFlags&8772&&o!==null?(o.return=a,ke=o):Qm(e)}}function Qm(e){for(;ke!==null;){var t=ke;if(t.flags&8772){var s=t.alternate;try{if(t.flags&8772)switch(t.tag){case 0:case 11:case 15:an||yi(5,t);break;case 1:var r=t.stateNode;if(t.flags&4&&!an)if(s===null)r.componentDidMount();else{var a=t.elementType===t.type?s.memoizedProps:Kn(t.type,s.memoizedProps);r.componentDidUpdate(a,s.memoizedState,r.__reactInternalSnapshotBeforeUpdate)}var o=t.updateQueue;o!==null&&Mm(t,o,r);break;case 3:var l=t.updateQueue;if(l!==null){if(s=null,t.child!==null)switch(t.child.tag){case 5:s=t.child.stateNode;break;case 1:s=t.child.stateNode}Mm(t,l,s)}break;case 5:var c=t.stateNode;if(s===null&&t.flags&4){s=c;var i=t.memoizedProps;switch(t.type){case"button":case"input":case"select":case"textarea":i.autoFocus&&s.focus();break;case"img":i.src&&(s.src=i.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(t.memoizedState===null){var u=t.alternate;if(u!==null){var p=u.memoizedState;if(p!==null){var y=p.dehydrated;y!==null&&so(y)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(me(163))}an||t.flags&512&&jd(t)}catch(b){Rt(t,t.return,b)}}if(t===e){ke=null;break}if(s=t.sibling,s!==null){s.return=t.return,ke=s;break}ke=t.return}}function Zm(e){for(;ke!==null;){var t=ke;if(t===e){ke=null;break}var s=t.sibling;if(s!==null){s.return=t.return,ke=s;break}ke=t.return}}function ep(e){for(;ke!==null;){var t=ke;try{switch(t.tag){case 0:case 11:case 15:var s=t.return;try{yi(4,t)}catch(i){Rt(t,s,i)}break;case 1:var r=t.stateNode;if(typeof r.componentDidMount=="function"){var a=t.return;try{r.componentDidMount()}catch(i){Rt(t,a,i)}}var o=t.return;try{jd(t)}catch(i){Rt(t,o,i)}break;case 5:var l=t.return;try{jd(t)}catch(i){Rt(t,l,i)}}}catch(i){Rt(t,t.return,i)}if(t===e){ke=null;break}var c=t.sibling;if(c!==null){c.return=t.return,ke=c;break}ke=t.return}}var o0=Math.ceil,Kl=Ts.ReactCurrentDispatcher,vu=Ts.ReactCurrentOwner,Pn=Ts.ReactCurrentBatchConfig,ot=0,Kt=null,Mt=null,Xt=0,jn=0,Vr=tr(0),Ut=0,xo=null,Nr=0,Ni=0,Su=0,Ya=null,yn=null,wu=0,aa=1/0,hs=null,Yl=!1,Ad=null,qs=null,al=!1,Us=null,Gl=0,Ga=0,Id=null,wl=-1,jl=0;function mn(){return ot&6?Lt():wl!==-1?wl:wl=Lt()}function Xs(e){return e.mode&1?ot&2&&Xt!==0?Xt&-Xt:Wy.transition!==null?(jl===0&&(jl=Rf()),jl):(e=ut,e!==0||(e=window.event,e=e===void 0?16:Pf(e.type)),e):1}function Xn(e,t,s,r){if(50<Ga)throw Ga=0,Id=null,Error(me(185));Ao(e,s,r),(!(ot&2)||e!==Kt)&&(e===Kt&&(!(ot&2)&&(Ni|=s),Ut===4&&Bs(e,Xt)),Sn(e,r),s===1&&ot===0&&!(t.mode&1)&&(aa=Lt()+500,xi&&nr()))}function Sn(e,t){var s=e.callbackNode;Wg(e,t);var r=Cl(e,e===Kt?Xt:0);if(r===0)s!==null&&cm(s),e.callbackNode=null,e.callbackPriority=0;else if(t=r&-r,e.callbackPriority!==t){if(s!=null&&cm(s),t===1)e.tag===0?Uy(tp.bind(null,e)):nx(tp.bind(null,e)),Fy(function(){!(ot&6)&&nr()}),s=null;else{switch(Cf(r)){case 1:s=qd;break;case 4:s=If;break;case 16:s=Rl;break;case 536870912:s=Tf;break;default:s=Rl}s=eh(s,Yx.bind(null,e))}e.callbackPriority=t,e.callbackNode=s}}function Yx(e,t){if(wl=-1,jl=0,ot&6)throw Error(me(327));var s=e.callbackNode;if(Jr()&&e.callbackNode!==s)return null;var r=Cl(e,e===Kt?Xt:0);if(r===0)return null;if(r&30||r&e.expiredLanes||t)t=ql(e,r);else{t=r;var a=ot;ot|=2;var o=qx();(Kt!==e||Xt!==t)&&(hs=null,aa=Lt()+500,pr(e,t));do try{c0();break}catch(c){Gx(e,c)}while(!0);iu(),Kl.current=o,ot=a,Mt!==null?t=0:(Kt=null,Xt=0,t=Ut)}if(t!==0){if(t===2&&(a=td(e),a!==0&&(r=a,t=Td(e,a))),t===1)throw s=xo,pr(e,0),Bs(e,r),Sn(e,Lt()),s;if(t===6)Bs(e,r);else{if(a=e.current.alternate,!(r&30)&&!l0(a)&&(t=ql(e,r),t===2&&(o=td(e),o!==0&&(r=o,t=Td(e,o))),t===1))throw s=xo,pr(e,0),Bs(e,r),Sn(e,Lt()),s;switch(e.finishedWork=a,e.finishedLanes=r,t){case 0:case 1:throw Error(me(345));case 2:lr(e,yn,hs);break;case 3:if(Bs(e,r),(r&130023424)===r&&(t=wu+500-Lt(),10<t)){if(Cl(e,0)!==0)break;if(a=e.suspendedLanes,(a&r)!==r){mn(),e.pingedLanes|=e.suspendedLanes&a;break}e.timeoutHandle=cd(lr.bind(null,e,yn,hs),t);break}lr(e,yn,hs);break;case 4:if(Bs(e,r),(r&4194240)===r)break;for(t=e.eventTimes,a=-1;0<r;){var l=31-qn(r);o=1<<l,l=t[l],l>a&&(a=l),r&=~o}if(r=a,r=Lt()-r,r=(120>r?120:480>r?480:1080>r?1080:1920>r?1920:3e3>r?3e3:4320>r?4320:1960*o0(r/1960))-r,10<r){e.timeoutHandle=cd(lr.bind(null,e,yn,hs),r);break}lr(e,yn,hs);break;case 5:lr(e,yn,hs);break;default:throw Error(me(329))}}}return Sn(e,Lt()),e.callbackNode===s?Yx.bind(null,e):null}function Td(e,t){var s=Ya;return e.current.memoizedState.isDehydrated&&(pr(e,t).flags|=256),e=ql(e,t),e!==2&&(t=yn,yn=s,t!==null&&Rd(t)),e}function Rd(e){yn===null?yn=e:yn.push.apply(yn,e)}function l0(e){for(var t=e;;){if(t.flags&16384){var s=t.updateQueue;if(s!==null&&(s=s.stores,s!==null))for(var r=0;r<s.length;r++){var a=s[r],o=a.getSnapshot;a=a.value;try{if(!Qn(o(),a))return!1}catch{return!1}}}if(s=t.child,t.subtreeFlags&16384&&s!==null)s.return=t,t=s;else{if(t===e)break;for(;t.sibling===null;){if(t.return===null||t.return===e)return!0;t=t.return}t.sibling.return=t.return,t=t.sibling}}return!0}function Bs(e,t){for(t&=~Su,t&=~Ni,e.suspendedLanes|=t,e.pingedLanes&=~t,e=e.expirationTimes;0<t;){var s=31-qn(t),r=1<<s;e[s]=-1,t&=~r}}function tp(e){if(ot&6)throw Error(me(327));Jr();var t=Cl(e,0);if(!(t&1))return Sn(e,Lt()),null;var s=ql(e,t);if(e.tag!==0&&s===2){var r=td(e);r!==0&&(t=r,s=Td(e,r))}if(s===1)throw s=xo,pr(e,0),Bs(e,t),Sn(e,Lt()),s;if(s===6)throw Error(me(345));return e.finishedWork=e.current.alternate,e.finishedLanes=t,lr(e,yn,hs),Sn(e,Lt()),null}function ju(e,t){var s=ot;ot|=1;try{return e(t)}finally{ot=s,ot===0&&(aa=Lt()+500,xi&&nr())}}function br(e){Us!==null&&Us.tag===0&&!(ot&6)&&Jr();var t=ot;ot|=1;var s=Pn.transition,r=ut;try{if(Pn.transition=null,ut=1,e)return e()}finally{ut=r,Pn.transition=s,ot=t,!(ot&6)&&nr()}}function Eu(){jn=Vr.current,vt(Vr)}function pr(e,t){e.finishedWork=null,e.finishedLanes=0;var s=e.timeoutHandle;if(s!==-1&&(e.timeoutHandle=-1,Py(s)),Mt!==null)for(s=Mt.return;s!==null;){var r=s;switch(au(r),r.tag){case 1:r=r.type.childContextTypes,r!=null&&Ml();break;case 3:sa(),vt(bn),vt(ln),fu();break;case 5:pu(r);break;case 4:sa();break;case 13:vt(kt);break;case 19:vt(kt);break;case 10:cu(r.type._context);break;case 22:case 23:Eu()}s=s.return}if(Kt=e,Mt=e=Js(e.current,null),Xt=jn=t,Ut=0,xo=null,Su=Ni=Nr=0,yn=Ya=null,ur!==null){for(t=0;t<ur.length;t++)if(s=ur[t],r=s.interleaved,r!==null){s.interleaved=null;var a=r.next,o=s.pending;if(o!==null){var l=o.next;o.next=a,r.next=l}s.pending=r}ur=null}return e}function Gx(e,t){do{var s=Mt;try{if(iu(),bl.current=Vl,zl){for(var r=At.memoizedState;r!==null;){var a=r.queue;a!==null&&(a.pending=null),r=r.next}zl=!1}if(yr=0,Vt=$t=At=null,Va=!1,mo=0,vu.current=null,s===null||s.return===null){Ut=1,xo=t,Mt=null;break}e:{var o=e,l=s.return,c=s,i=t;if(t=Xt,c.flags|=32768,i!==null&&typeof i=="object"&&typeof i.then=="function"){var u=i,p=c,y=p.tag;if(!(p.mode&1)&&(y===0||y===11||y===15)){var b=p.alternate;b?(p.updateQueue=b.updateQueue,p.memoizedState=b.memoizedState,p.lanes=b.lanes):(p.updateQueue=null,p.memoizedState=null)}var w=Um(l);if(w!==null){w.flags&=-257,Wm(w,l,c,o,t),w.mode&1&&Hm(o,u,t),t=w,i=u;var R=t.updateQueue;if(R===null){var E=new Set;E.add(i),t.updateQueue=E}else R.add(i);break e}else{if(!(t&1)){Hm(o,u,t),ku();break e}i=Error(me(426))}}else if(St&&c.mode&1){var W=Um(l);if(W!==null){!(W.flags&65536)&&(W.flags|=256),Wm(W,l,c,o,t),ou(ra(i,c));break e}}o=i=ra(i,c),Ut!==4&&(Ut=2),Ya===null?Ya=[o]:Ya.push(o),o=l;do{switch(o.tag){case 3:o.flags|=65536,t&=-t,o.lanes|=t;var N=Cx(o,i,t);Om(o,N);break e;case 1:c=i;var h=o.type,S=o.stateNode;if(!(o.flags&128)&&(typeof h.getDerivedStateFromError=="function"||S!==null&&typeof S.componentDidCatch=="function"&&(qs===null||!qs.has(S)))){o.flags|=65536,t&=-t,o.lanes|=t;var P=Dx(o,c,t);Om(o,P);break e}}o=o.return}while(o!==null)}Jx(s)}catch(U){t=U,Mt===s&&s!==null&&(Mt=s=s.return);continue}break}while(!0)}function qx(){var e=Kl.current;return Kl.current=Vl,e===null?Vl:e}function ku(){(Ut===0||Ut===3||Ut===2)&&(Ut=4),Kt===null||!(Nr&268435455)&&!(Ni&268435455)||Bs(Kt,Xt)}function ql(e,t){var s=ot;ot|=2;var r=qx();(Kt!==e||Xt!==t)&&(hs=null,pr(e,t));do try{i0();break}catch(a){Gx(e,a)}while(!0);if(iu(),ot=s,Kl.current=r,Mt!==null)throw Error(me(261));return Kt=null,Xt=0,Ut}function i0(){for(;Mt!==null;)Xx(Mt)}function c0(){for(;Mt!==null&&!_g();)Xx(Mt)}function Xx(e){var t=Zx(e.alternate,e,jn);e.memoizedProps=e.pendingProps,t===null?Jx(e):Mt=t,vu.current=null}function Jx(e){var t=e;do{var s=t.alternate;if(e=t.return,t.flags&32768){if(s=n0(s,t),s!==null){s.flags&=32767,Mt=s;return}if(e!==null)e.flags|=32768,e.subtreeFlags=0,e.deletions=null;else{Ut=6,Mt=null;return}}else if(s=t0(s,t,jn),s!==null){Mt=s;return}if(t=t.sibling,t!==null){Mt=t;return}Mt=t=e}while(t!==null);Ut===0&&(Ut=5)}function lr(e,t,s){var r=ut,a=Pn.transition;try{Pn.transition=null,ut=1,d0(e,t,s,r)}finally{Pn.transition=a,ut=r}return null}function d0(e,t,s,r){do Jr();while(Us!==null);if(ot&6)throw Error(me(327));s=e.finishedWork;var a=e.finishedLanes;if(s===null)return null;if(e.finishedWork=null,e.finishedLanes=0,s===e.current)throw Error(me(177));e.callbackNode=null,e.callbackPriority=0;var o=s.lanes|s.childLanes;if(zg(e,o),e===Kt&&(Mt=Kt=null,Xt=0),!(s.subtreeFlags&2064)&&!(s.flags&2064)||al||(al=!0,eh(Rl,function(){return Jr(),null})),o=(s.flags&15990)!==0,s.subtreeFlags&15990||o){o=Pn.transition,Pn.transition=null;var l=ut;ut=1;var c=ot;ot|=4,vu.current=null,r0(e,s),Vx(s,e),Ry(ld),Dl=!!od,ld=od=null,e.current=s,a0(s),Og(),ot=c,ut=l,Pn.transition=o}else e.current=s;if(al&&(al=!1,Us=e,Gl=a),o=e.pendingLanes,o===0&&(qs=null),Fg(s.stateNode),Sn(e,Lt()),t!==null)for(r=e.onRecoverableError,s=0;s<t.length;s++)a=t[s],r(a.value,{componentStack:a.stack,digest:a.digest});if(Yl)throw Yl=!1,e=Ad,Ad=null,e;return Gl&1&&e.tag!==0&&Jr(),o=e.pendingLanes,o&1?e===Id?Ga++:(Ga=0,Id=e):Ga=0,nr(),null}function Jr(){if(Us!==null){var e=Cf(Gl),t=Pn.transition,s=ut;try{if(Pn.transition=null,ut=16>e?16:e,Us===null)var r=!1;else{if(e=Us,Us=null,Gl=0,ot&6)throw Error(me(331));var a=ot;for(ot|=4,ke=e.current;ke!==null;){var o=ke,l=o.child;if(ke.flags&16){var c=o.deletions;if(c!==null){for(var i=0;i<c.length;i++){var u=c[i];for(ke=u;ke!==null;){var p=ke;switch(p.tag){case 0:case 11:case 15:Ka(8,p,o)}var y=p.child;if(y!==null)y.return=p,ke=y;else for(;ke!==null;){p=ke;var b=p.sibling,w=p.return;if(Ux(p),p===u){ke=null;break}if(b!==null){b.return=w,ke=b;break}ke=w}}}var R=o.alternate;if(R!==null){var E=R.child;if(E!==null){R.child=null;do{var W=E.sibling;E.sibling=null,E=W}while(E!==null)}}ke=o}}if(o.subtreeFlags&2064&&l!==null)l.return=o,ke=l;else e:for(;ke!==null;){if(o=ke,o.flags&2048)switch(o.tag){case 0:case 11:case 15:Ka(9,o,o.return)}var N=o.sibling;if(N!==null){N.return=o.return,ke=N;break e}ke=o.return}}var h=e.current;for(ke=h;ke!==null;){l=ke;var S=l.child;if(l.subtreeFlags&2064&&S!==null)S.return=l,ke=S;else e:for(l=h;ke!==null;){if(c=ke,c.flags&2048)try{switch(c.tag){case 0:case 11:case 15:yi(9,c)}}catch(U){Rt(c,c.return,U)}if(c===l){ke=null;break e}var P=c.sibling;if(P!==null){P.return=c.return,ke=P;break e}ke=c.return}}if(ot=a,nr(),us&&typeof us.onPostCommitFiberRoot=="function")try{us.onPostCommitFiberRoot(di,e)}catch{}r=!0}return r}finally{ut=s,Pn.transition=t}}return!1}function np(e,t,s){t=ra(s,t),t=Cx(e,t,1),e=Gs(e,t,1),t=mn(),e!==null&&(Ao(e,1,t),Sn(e,t))}function Rt(e,t,s){if(e.tag===3)np(e,e,s);else for(;t!==null;){if(t.tag===3){np(t,e,s);break}else if(t.tag===1){var r=t.stateNode;if(typeof t.type.getDerivedStateFromError=="function"||typeof r.componentDidCatch=="function"&&(qs===null||!qs.has(r))){e=ra(s,e),e=Dx(t,e,1),t=Gs(t,e,1),e=mn(),t!==null&&(Ao(t,1,e),Sn(t,e));break}}t=t.return}}function u0(e,t,s){var r=e.pingCache;r!==null&&r.delete(t),t=mn(),e.pingedLanes|=e.suspendedLanes&s,Kt===e&&(Xt&s)===s&&(Ut===4||Ut===3&&(Xt&130023424)===Xt&&500>Lt()-wu?pr(e,0):Su|=s),Sn(e,t)}function Qx(e,t){t===0&&(e.mode&1?(t=qo,qo<<=1,!(qo&130023424)&&(qo=4194304)):t=1);var s=mn();e=As(e,t),e!==null&&(Ao(e,t,s),Sn(e,s))}function m0(e){var t=e.memoizedState,s=0;t!==null&&(s=t.retryLane),Qx(e,s)}function p0(e,t){var s=0;switch(e.tag){case 13:var r=e.stateNode,a=e.memoizedState;a!==null&&(s=a.retryLane);break;case 19:r=e.stateNode;break;default:throw Error(me(314))}r!==null&&r.delete(t),Qx(e,s)}var Zx;Zx=function(e,t,s){if(e!==null)if(e.memoizedProps!==t.pendingProps||bn.current)Nn=!0;else{if(!(e.lanes&s)&&!(t.flags&128))return Nn=!1,e0(e,t,s);Nn=!!(e.flags&131072)}else Nn=!1,St&&t.flags&1048576&&sx(t,Bl,t.index);switch(t.lanes=0,t.tag){case 2:var r=t.type;Sl(e,t),e=t.pendingProps;var a=ea(t,ln.current);Xr(t,s),a=hu(null,t,r,e,a,s);var o=gu();return t.flags|=1,typeof a=="object"&&a!==null&&typeof a.render=="function"&&a.$$typeof===void 0?(t.tag=1,t.memoizedState=null,t.updateQueue=null,vn(r)?(o=!0,Pl(t)):o=!1,t.memoizedState=a.state!==null&&a.state!==void 0?a.state:null,uu(t),a.updater=gi,t.stateNode=a,a._reactInternals=t,hd(t,r,e,s),t=Nd(null,t,r,!0,o,s)):(t.tag=0,St&&o&&ru(t),un(null,t,a,s),t=t.child),t;case 16:r=t.elementType;e:{switch(Sl(e,t),e=t.pendingProps,a=r._init,r=a(r._payload),t.type=r,a=t.tag=x0(r),e=Kn(r,e),a){case 0:t=yd(null,t,r,e,s);break e;case 1:t=Km(null,t,r,e,s);break e;case 11:t=zm(null,t,r,e,s);break e;case 14:t=Vm(null,t,r,Kn(r.type,e),s);break e}throw Error(me(306,r,""))}return t;case 0:return r=t.type,a=t.pendingProps,a=t.elementType===r?a:Kn(r,a),yd(e,t,r,a,s);case 1:return r=t.type,a=t.pendingProps,a=t.elementType===r?a:Kn(r,a),Km(e,t,r,a,s);case 3:e:{if(Mx(t),e===null)throw Error(me(387));r=t.pendingProps,o=t.memoizedState,a=o.element,cx(e,t),Ul(t,r,null,s);var l=t.memoizedState;if(r=l.element,o.isDehydrated)if(o={element:r,isDehydrated:!1,cache:l.cache,pendingSuspenseBoundaries:l.pendingSuspenseBoundaries,transitions:l.transitions},t.updateQueue.baseState=o,t.memoizedState=o,t.flags&256){a=ra(Error(me(423)),t),t=Ym(e,t,r,s,a);break e}else if(r!==a){a=ra(Error(me(424)),t),t=Ym(e,t,r,s,a);break e}else for(kn=Ys(t.stateNode.containerInfo.firstChild),An=t,St=!0,Gn=null,s=lx(t,null,r,s),t.child=s;s;)s.flags=s.flags&-3|4096,s=s.sibling;else{if(ta(),r===a){t=Is(e,t,s);break e}un(e,t,r,s)}t=t.child}return t;case 5:return dx(t),e===null&&pd(t),r=t.type,a=t.pendingProps,o=e!==null?e.memoizedProps:null,l=a.children,id(r,a)?l=null:o!==null&&id(r,o)&&(t.flags|=32),Ox(e,t),un(e,t,l,s),t.child;case 6:return e===null&&pd(t),null;case 13:return Px(e,t,s);case 4:return mu(t,t.stateNode.containerInfo),r=t.pendingProps,e===null?t.child=na(t,null,r,s):un(e,t,r,s),t.child;case 11:return r=t.type,a=t.pendingProps,a=t.elementType===r?a:Kn(r,a),zm(e,t,r,a,s);case 7:return un(e,t,t.pendingProps,s),t.child;case 8:return un(e,t,t.pendingProps.children,s),t.child;case 12:return un(e,t,t.pendingProps.children,s),t.child;case 10:e:{if(r=t.type._context,a=t.pendingProps,o=t.memoizedProps,l=a.value,ht($l,r._currentValue),r._currentValue=l,o!==null)if(Qn(o.value,l)){if(o.children===a.children&&!bn.current){t=Is(e,t,s);break e}}else for(o=t.child,o!==null&&(o.return=t);o!==null;){var c=o.dependencies;if(c!==null){l=o.child;for(var i=c.firstContext;i!==null;){if(i.context===r){if(o.tag===1){i=Ss(-1,s&-s),i.tag=2;var u=o.updateQueue;if(u!==null){u=u.shared;var p=u.pending;p===null?i.next=i:(i.next=p.next,p.next=i),u.pending=i}}o.lanes|=s,i=o.alternate,i!==null&&(i.lanes|=s),fd(o.return,s,t),c.lanes|=s;break}i=i.next}}else if(o.tag===10)l=o.type===t.type?null:o.child;else if(o.tag===18){if(l=o.return,l===null)throw Error(me(341));l.lanes|=s,c=l.alternate,c!==null&&(c.lanes|=s),fd(l,s,t),l=o.sibling}else l=o.child;if(l!==null)l.return=o;else for(l=o;l!==null;){if(l===t){l=null;break}if(o=l.sibling,o!==null){o.return=l.return,l=o;break}l=l.return}o=l}un(e,t,a.children,s),t=t.child}return t;case 9:return a=t.type,r=t.pendingProps.children,Xr(t,s),a=Bn(a),r=r(a),t.flags|=1,un(e,t,r,s),t.child;case 14:return r=t.type,a=Kn(r,t.pendingProps),a=Kn(r.type,a),Vm(e,t,r,a,s);case 15:return Lx(e,t,t.type,t.pendingProps,s);case 17:return r=t.type,a=t.pendingProps,a=t.elementType===r?a:Kn(r,a),Sl(e,t),t.tag=1,vn(r)?(e=!0,Pl(t)):e=!1,Xr(t,s),Rx(t,r,a),hd(t,r,a,s),Nd(null,t,r,!0,e,s);case 19:return Fx(e,t,s);case 22:return _x(e,t,s)}throw Error(me(156,t.tag))};function eh(e,t){return Af(e,t)}function f0(e,t,s,r){this.tag=e,this.key=s,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=t,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=r,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Mn(e,t,s,r){return new f0(e,t,s,r)}function Au(e){return e=e.prototype,!(!e||!e.isReactComponent)}function x0(e){if(typeof e=="function")return Au(e)?1:0;if(e!=null){if(e=e.$$typeof,e===Kd)return 11;if(e===Yd)return 14}return 2}function Js(e,t){var s=e.alternate;return s===null?(s=Mn(e.tag,t,e.key,e.mode),s.elementType=e.elementType,s.type=e.type,s.stateNode=e.stateNode,s.alternate=e,e.alternate=s):(s.pendingProps=t,s.type=e.type,s.flags=0,s.subtreeFlags=0,s.deletions=null),s.flags=e.flags&14680064,s.childLanes=e.childLanes,s.lanes=e.lanes,s.child=e.child,s.memoizedProps=e.memoizedProps,s.memoizedState=e.memoizedState,s.updateQueue=e.updateQueue,t=e.dependencies,s.dependencies=t===null?null:{lanes:t.lanes,firstContext:t.firstContext},s.sibling=e.sibling,s.index=e.index,s.ref=e.ref,s}function El(e,t,s,r,a,o){var l=2;if(r=e,typeof e=="function")Au(e)&&(l=1);else if(typeof e=="string")l=5;else e:switch(e){case Or:return fr(s.children,a,o,t);case Vd:l=8,a|=8;break;case $c:return e=Mn(12,s,t,a|2),e.elementType=$c,e.lanes=o,e;case Hc:return e=Mn(13,s,t,a),e.elementType=Hc,e.lanes=o,e;case Uc:return e=Mn(19,s,t,a),e.elementType=Uc,e.lanes=o,e;case df:return bi(s,a,o,t);default:if(typeof e=="object"&&e!==null)switch(e.$$typeof){case lf:l=10;break e;case cf:l=9;break e;case Kd:l=11;break e;case Yd:l=14;break e;case _s:l=16,r=null;break e}throw Error(me(130,e==null?e:typeof e,""))}return t=Mn(l,s,t,a),t.elementType=e,t.type=r,t.lanes=o,t}function fr(e,t,s,r){return e=Mn(7,e,r,t),e.lanes=s,e}function bi(e,t,s,r){return e=Mn(22,e,r,t),e.elementType=df,e.lanes=s,e.stateNode={isHidden:!1},e}function vc(e,t,s){return e=Mn(6,e,null,t),e.lanes=s,e}function Sc(e,t,s){return t=Mn(4,e.children!==null?e.children:[],e.key,t),t.lanes=s,t.stateNode={containerInfo:e.containerInfo,pendingChildren:null,implementation:e.implementation},t}function h0(e,t,s,r,a){this.tag=t,this.containerInfo=e,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=nc(0),this.expirationTimes=nc(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=nc(0),this.identifierPrefix=r,this.onRecoverableError=a,this.mutableSourceEagerHydrationData=null}function Iu(e,t,s,r,a,o,l,c,i){return e=new h0(e,t,s,c,i),t===1?(t=1,o===!0&&(t|=8)):t=0,o=Mn(3,null,null,t),e.current=o,o.stateNode=e,o.memoizedState={element:r,isDehydrated:s,cache:null,transitions:null,pendingSuspenseBoundaries:null},uu(o),e}function g0(e,t,s){var r=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:_r,key:r==null?null:""+r,children:e,containerInfo:t,implementation:s}}function th(e){if(!e)return Zs;e=e._reactInternals;e:{if(wr(e)!==e||e.tag!==1)throw Error(me(170));var t=e;do{switch(t.tag){case 3:t=t.stateNode.context;break e;case 1:if(vn(t.type)){t=t.stateNode.__reactInternalMemoizedMergedChildContext;break e}}t=t.return}while(t!==null);throw Error(me(171))}if(e.tag===1){var s=e.type;if(vn(s))return tx(e,s,t)}return t}function nh(e,t,s,r,a,o,l,c,i){return e=Iu(s,r,!0,e,a,o,l,c,i),e.context=th(null),s=e.current,r=mn(),a=Xs(s),o=Ss(r,a),o.callback=t??null,Gs(s,o,a),e.current.lanes=a,Ao(e,a,r),Sn(e,r),e}function vi(e,t,s,r){var a=t.current,o=mn(),l=Xs(a);return s=th(s),t.context===null?t.context=s:t.pendingContext=s,t=Ss(o,l),t.payload={element:e},r=r===void 0?null:r,r!==null&&(t.callback=r),e=Gs(a,t,l),e!==null&&(Xn(e,a,l,o),Nl(e,a,l)),l}function Xl(e){if(e=e.current,!e.child)return null;switch(e.child.tag){case 5:return e.child.stateNode;default:return e.child.stateNode}}function sp(e,t){if(e=e.memoizedState,e!==null&&e.dehydrated!==null){var s=e.retryLane;e.retryLane=s!==0&&s<t?s:t}}function Tu(e,t){sp(e,t),(e=e.alternate)&&sp(e,t)}function y0(){return null}var sh=typeof reportError=="function"?reportError:function(e){console.error(e)};function Ru(e){this._internalRoot=e}Si.prototype.render=Ru.prototype.render=function(e){var t=this._internalRoot;if(t===null)throw Error(me(409));vi(e,t,null,null)};Si.prototype.unmount=Ru.prototype.unmount=function(){var e=this._internalRoot;if(e!==null){this._internalRoot=null;var t=e.containerInfo;br(function(){vi(null,e,null,null)}),t[ks]=null}};function Si(e){this._internalRoot=e}Si.prototype.unstable_scheduleHydration=function(e){if(e){var t=_f();e={blockedOn:null,target:e,priority:t};for(var s=0;s<Fs.length&&t!==0&&t<Fs[s].priority;s++);Fs.splice(s,0,e),s===0&&Mf(e)}};function Cu(e){return!(!e||e.nodeType!==1&&e.nodeType!==9&&e.nodeType!==11)}function wi(e){return!(!e||e.nodeType!==1&&e.nodeType!==9&&e.nodeType!==11&&(e.nodeType!==8||e.nodeValue!==" react-mount-point-unstable "))}function rp(){}function N0(e,t,s,r,a){if(a){if(typeof r=="function"){var o=r;r=function(){var u=Xl(l);o.call(u)}}var l=nh(t,r,e,0,null,!1,!1,"",rp);return e._reactRootContainer=l,e[ks]=l.current,oo(e.nodeType===8?e.parentNode:e),br(),l}for(;a=e.lastChild;)e.removeChild(a);if(typeof r=="function"){var c=r;r=function(){var u=Xl(i);c.call(u)}}var i=Iu(e,0,!1,null,null,!1,!1,"",rp);return e._reactRootContainer=i,e[ks]=i.current,oo(e.nodeType===8?e.parentNode:e),br(function(){vi(t,i,s,r)}),i}function ji(e,t,s,r,a){var o=s._reactRootContainer;if(o){var l=o;if(typeof a=="function"){var c=a;a=function(){var i=Xl(l);c.call(i)}}vi(t,l,e,a)}else l=N0(s,t,e,a,r);return Xl(l)}Df=function(e){switch(e.tag){case 3:var t=e.stateNode;if(t.current.memoizedState.isDehydrated){var s=Fa(t.pendingLanes);s!==0&&(Xd(t,s|1),Sn(t,Lt()),!(ot&6)&&(aa=Lt()+500,nr()))}break;case 13:br(function(){var r=As(e,1);if(r!==null){var a=mn();Xn(r,e,1,a)}}),Tu(e,1)}};Jd=function(e){if(e.tag===13){var t=As(e,134217728);if(t!==null){var s=mn();Xn(t,e,134217728,s)}Tu(e,134217728)}};Lf=function(e){if(e.tag===13){var t=Xs(e),s=As(e,t);if(s!==null){var r=mn();Xn(s,e,t,r)}Tu(e,t)}};_f=function(){return ut};Of=function(e,t){var s=ut;try{return ut=e,t()}finally{ut=s}};Qc=function(e,t,s){switch(t){case"input":if(Vc(e,s),t=s.name,s.type==="radio"&&t!=null){for(s=e;s.parentNode;)s=s.parentNode;for(s=s.querySelectorAll("input[name="+JSON.stringify(""+t)+'][type="radio"]'),t=0;t<s.length;t++){var r=s[t];if(r!==e&&r.form===e.form){var a=fi(r);if(!a)throw Error(me(90));mf(r),Vc(r,a)}}}break;case"textarea":ff(e,s);break;case"select":t=s.value,t!=null&&Kr(e,!!s.multiple,t,!1)}};vf=ju;Sf=br;var b0={usingClientEntryPoint:!1,Events:[To,Br,fi,Nf,bf,ju]},Da={findFiberByHostInstance:dr,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},v0={bundleType:Da.bundleType,version:Da.version,rendererPackageName:Da.rendererPackageName,rendererConfig:Da.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:Ts.ReactCurrentDispatcher,findHostInstanceByFiber:function(e){return e=Ef(e),e===null?null:e.stateNode},findFiberByHostInstance:Da.findFiberByHostInstance||y0,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var ol=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!ol.isDisabled&&ol.supportsFiber)try{di=ol.inject(v0),us=ol}catch{}}Tn.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=b0;Tn.createPortal=function(e,t){var s=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!Cu(t))throw Error(me(200));return g0(e,t,null,s)};Tn.createRoot=function(e,t){if(!Cu(e))throw Error(me(299));var s=!1,r="",a=sh;return t!=null&&(t.unstable_strictMode===!0&&(s=!0),t.identifierPrefix!==void 0&&(r=t.identifierPrefix),t.onRecoverableError!==void 0&&(a=t.onRecoverableError)),t=Iu(e,1,!1,null,null,s,!1,r,a),e[ks]=t.current,oo(e.nodeType===8?e.parentNode:e),new Ru(t)};Tn.findDOMNode=function(e){if(e==null)return null;if(e.nodeType===1)return e;var t=e._reactInternals;if(t===void 0)throw typeof e.render=="function"?Error(me(188)):(e=Object.keys(e).join(","),Error(me(268,e)));return e=Ef(t),e=e===null?null:e.stateNode,e};Tn.flushSync=function(e){return br(e)};Tn.hydrate=function(e,t,s){if(!wi(t))throw Error(me(200));return ji(null,e,t,!0,s)};Tn.hydrateRoot=function(e,t,s){if(!Cu(e))throw Error(me(405));var r=s!=null&&s.hydratedSources||null,a=!1,o="",l=sh;if(s!=null&&(s.unstable_strictMode===!0&&(a=!0),s.identifierPrefix!==void 0&&(o=s.identifierPrefix),s.onRecoverableError!==void 0&&(l=s.onRecoverableError)),t=nh(t,null,e,1,s??null,a,!1,o,l),e[ks]=t.current,oo(e),r)for(e=0;e<r.length;e++)s=r[e],a=s._getVersion,a=a(s._source),t.mutableSourceEagerHydrationData==null?t.mutableSourceEagerHydrationData=[s,a]:t.mutableSourceEagerHydrationData.push(s,a);return new Si(t)};Tn.render=function(e,t,s){if(!wi(t))throw Error(me(200));return ji(null,e,t,!1,s)};Tn.unmountComponentAtNode=function(e){if(!wi(e))throw Error(me(40));return e._reactRootContainer?(br(function(){ji(null,null,e,!1,function(){e._reactRootContainer=null,e[ks]=null})}),!0):!1};Tn.unstable_batchedUpdates=ju;Tn.unstable_renderSubtreeIntoContainer=function(e,t,s,r){if(!wi(s))throw Error(me(200));if(e==null||e._reactInternals===void 0)throw Error(me(38));return ji(e,t,s,!1,r)};Tn.version="18.3.1-next-f1338f8080-20240426";function rh(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(rh)}catch(e){console.error(e)}}rh(),sf.exports=Tn;var S0=sf.exports,ap=S0;Fc.createRoot=ap.createRoot,Fc.hydrateRoot=ap.hydrateRoot;/**
 * @license
 * (c) Copyright 2023 Grammarly, Inc.
 * 
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 * 
 *     http://www.apache.org/licenses/LICENSE-2.0
 * 
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ll(e,t,s){return t in e?Object.defineProperty(e,t,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[t]=s,e}var op=new Map;class ho extends Error{constructor(t,s){super(),ll(this,"args",void 0),ll(this,"code",void 0),ll(this,"url",void 0),ll(this,"_c",void 0);var r=new URL("https://developer.grammarly.com/docs/error-explainer");r.searchParams.set("code",t.toString()),s.forEach(a=>r.searchParams.append("args",function(o){if(o instanceof Error)return o.message+`
`+String(o.stack);if(o==null)return"null";if(typeof o=="object")try{return Object.prototype.toString.call(o)}catch{}return String(o)}(a))),this.stack!=null&&r.searchParams.set("trace",this.stack),this.message="Minified error #".concat(t,": See ").concat(r.toString()," for details."),this.args=s,this.code=t,this.url=r.toString()}toUserMessage(){var t=op.get("".concat(this.code));if(t==null)return[this];var s=new Map(this.args.map((a,o)=>["${".concat(o,"}"),a])),r=t.split(/(\${\d+})/).filter(a=>a!=="");return r.map(a=>{var o;return(o=s.get(a))!==null&&o!==void 0?o:a})}toJSON(){return{name:"InvariantError",message:this.message,description:this._m,code:this.code,args:this.args,stack:this.stack}}static setMessages(t){op=t}static create(t,s,r,a){a!=null&&s.push(a);var o=new ho(t,s,r);return o.stack=a==null?void 0:a.stack,o._m=r,o}}const lp=new WeakMap;async function w0(e,t){const s=lp.get(e);if(s!=null)return await s;(function(a){a.Grammarly==null&&(a.Grammarly={})})(e);const r=new Promise((a,o)=>{try{let c=function(i,u){return i.document.querySelectorAll(`script[src^="${u.replace(/\?.*$/,"")}"]`)[0]}(e,t);c!=null?l():(c=function(i,u){const p=i.document.createElement("script");return p.src=u,i.document.head.appendChild(p),p}(e,t),c.addEventListener("load",l),c.addEventListener("error",function(){try{throw new ho(23,[])}catch(i){o(i)}}))}catch(c){return o(c)}function l(){try{if(e.Grammarly==null||typeof e.Grammarly.EditorSDK!="function")throw new ho(22,[]);a(e.Grammarly)}catch(c){o(c)}}});return lp.set(e,r),await r}async function ip(e,t,s,r){if(typeof window>"u"&&r===void 0)throw new ho(21,[]);const a=function(c){return c.location.origin!=="null"?c.location.origin:c.origin!=="null"?c.origin:"null"}(r??window);a==="null"&&(r??window).top!==(r??window)&&console.warn("Grammarly is not supported in IFrames with `null` origin. Consider adding `sandbox='allow-same-origin allow-scripts'` to <iframe> element.");const o=new URL("https://js.grammarly.com/grammarly-editor-sdk@2.5",a);t!=null&&o.searchParams.set("clientId",t),o.searchParams.set("packageName",e);const l=await w0(r??window,o.toString());if(t!=null)return new l.EditorSDK(t,s)}const wc={onBeforeSuggestionCardOpen:"before-suggestion-card-open",onSuggestionCardOpen:"suggestion-card-open",onSuggestionCardClose:"suggestion-card-close",onSuggestionCardAction:"suggestion-card-action",onPluginTurnedOff:"plugin-turned-off",onPluginError:"plugin-error",onDocumentStats:"document-stats",onSessionStats:"session-stats"};/**
 * @license
 * (c) Copyright 2023 Grammarly, Inc.
 * 
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 * 
 *     http://www.apache.org/licenses/LICENSE-2.0
 * 
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const j0=ci.createContext({});function E0(e,t,s){const r=g.useCallback(a=>e==null?void 0:e(new CustomEvent("plugin-error",{detail:a})),[e]);g.useEffect(()=>{var a;typeof navigator<"u"&&(t!=null&&((a=s==null?void 0:s.current)===null||a===void 0?void 0:a.ownerDocument.defaultView)!=null&&window!==s.current.ownerDocument.defaultView?ip("@grammarly/editor-sdk-react",t,void 0,s.current.ownerDocument.defaultView).catch(r):ip("@grammarly/editor-sdk-react").catch(r))},s!=null&&t!=null?[s,t]:[])}function cp(e){return typeof e=="function"}const go=e=>{const[t,{clientId:s,config:r,children:a,className:o,...l}]=function(E){const W={},N={...E};return Object.keys(wc).forEach(h=>{W[h]=E[h],h in N&&delete N[h]}),[W,N]}(e),c=g.useContext(j0),i=g.useRef(),u=g.useRef(),p=g.useRef(),y=g.useCallback(E=>{i.current=E,w()},[]),b=function(E){const[W,N]=g.useState({}),h=g.useCallback(()=>{customElements.whenDefined(E).then(()=>N(S=>({...S,[E]:!0}))).catch(()=>{})},[E]);return g.useEffect(h,[h]),!!W[E]}("grammarly-editor-plugin"),w=g.useCallback(()=>{var E;i.current!=null&&u.current!=null&&b&&i.current.connect(u.current,(E=p.current)!==null&&E!==void 0?E:void 0)},[b]),R=g.useMemo(()=>({...c.config,...r}),[c.config,r]);return g.useEffect(()=>{i.current&&(i.current.config=R)},[i,R]),g.useEffect(()=>{if(i.current==null)return;const{current:E}=i,W=[];return Object.keys(wc).forEach(N=>{const h=t[N],S=wc[N];h!=null&&(E.addEventListener(S,h),W.push(()=>E.removeEventListener(S,h)))}),()=>W.forEach(N=>N())},[...Object.values(t),b,i.current]),E0(e.onPluginError,s??c.clientId,i),ci.createElement("grammarly-editor-plugin",{...l,ref:y,clientId:s??c.clientId,autodetect:cp(a)?"off":"on",class:o},cp(a)?a({setEditor:E=>{u.current=E,w()},setViewport:E=>{p.current=E,w()}}):a)};/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */var k0={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const A0=e=>e.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase().trim(),Ze=(e,t)=>{const s=g.forwardRef(({color:r="currentColor",size:a=24,strokeWidth:o=2,absoluteStrokeWidth:l,className:c="",children:i,...u},p)=>g.createElement("svg",{ref:p,...k0,width:a,height:a,stroke:r,strokeWidth:l?Number(o)*24/Number(a):o,className:["lucide",`lucide-${A0(e)}`,c].join(" "),...u},[...t.map(([y,b])=>g.createElement(y,b)),...Array.isArray(i)?i:[i]]));return s.displayName=`${e}`,s};/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const qa=Ze("AlertTriangle",[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3Z",key:"c3ski4"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ah=Ze("ArrowRight",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"m12 5 7 7-7 7",key:"xquz4c"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Jl=Ze("Bell",[["path",{d:"M6 8a6 6 0 0 1 12 0c0 7 3 9 3 9H3s3-2 3-9",key:"1qo2s2"}],["path",{d:"M10.3 21a1.94 1.94 0 0 0 3.4 0",key:"qgo35s"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const I0=Ze("Calculator",[["rect",{width:"16",height:"20",x:"4",y:"2",rx:"2",key:"1nb95v"}],["line",{x1:"8",x2:"16",y1:"6",y2:"6",key:"x4nwl0"}],["line",{x1:"16",x2:"16",y1:"14",y2:"18",key:"wjye3r"}],["path",{d:"M16 10h.01",key:"1m94wz"}],["path",{d:"M12 10h.01",key:"1nrarc"}],["path",{d:"M8 10h.01",key:"19clt8"}],["path",{d:"M12 14h.01",key:"1etili"}],["path",{d:"M8 14h.01",key:"6423bh"}],["path",{d:"M12 18h.01",key:"mhygvu"}],["path",{d:"M8 18h.01",key:"lrp35t"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const T0=Ze("Calendar",[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const oh=Ze("Check",[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const R0=Ze("ChevronDown",[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ql=Ze("ChevronLeft",[["path",{d:"m15 18-6-6 6-6",key:"1wnfg3"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const is=Ze("ChevronRight",[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const C0=Ze("ChevronUp",[["path",{d:"m18 15-6-6-6 6",key:"153udz"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const D0=Ze("Clock",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polyline",{points:"12 6 12 12 16 14",key:"68esgv"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const L0=Ze("FilePlus2",[["path",{d:"M4 22h14a2 2 0 0 0 2-2V7l-5-5H6a2 2 0 0 0-2 2v4",key:"1pf5j1"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M3 15h6",key:"4e2qda"}],["path",{d:"M6 12v6",key:"1u72j0"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const _0=Ze("FileSpreadsheet",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M8 13h2",key:"yr2amv"}],["path",{d:"M14 13h2",key:"un5t4a"}],["path",{d:"M8 17h2",key:"2yhykz"}],["path",{d:"M14 17h2",key:"10kma7"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const yo=Ze("FileText",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M10 9H8",key:"b1mrlr"}],["path",{d:"M16 13H8",key:"t4e002"}],["path",{d:"M16 17H8",key:"z1uh3a"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const lh=Ze("FolderOpen",[["path",{d:"m6 14 1.5-2.9A2 2 0 0 1 9.24 10H20a2 2 0 0 1 1.94 2.5l-1.54 6a2 2 0 0 1-1.95 1.5H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h3.9a2 2 0 0 1 1.69.9l.81 1.2a2 2 0 0 0 1.67.9H18a2 2 0 0 1 2 2v2",key:"usdka0"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const O0=Ze("Globe",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 2a14.5 14.5 0 0 0 0 20 14.5 14.5 0 0 0 0-20",key:"13o1zl"}],["path",{d:"M2 12h20",key:"9i4pu4"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Du=Ze("HelpCircle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3",key:"1u773s"}],["path",{d:"M12 17h.01",key:"p32p05"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ih=Ze("History",[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}],["path",{d:"M12 7v5l4 2",key:"1fdv2h"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Lu=Ze("Home",[["path",{d:"m3 9 9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z",key:"y5dka4"}],["polyline",{points:"9 22 9 12 15 12 15 22",key:"e2us08"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const M0=Ze("KeyRound",[["path",{d:"M2 18v3c0 .6.4 1 1 1h4v-3h3v-3h2l1.4-1.4a6.5 6.5 0 1 0-4-4Z",key:"167ctg"}],["circle",{cx:"16.5",cy:"7.5",r:".5",fill:"currentColor",key:"w0ekpg"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const oa=Ze("Lightbulb",[["path",{d:"M15 14c.2-1 .7-1.7 1.5-2.5 1-.9 1.5-2.2 1.5-3.5A6 6 0 0 0 6 8c0 1 .2 2.2 1.5 3.5.7.7 1.3 1.5 1.5 2.5",key:"1gvzjb"}],["path",{d:"M9 18h6",key:"x1upvd"}],["path",{d:"M10 22h4",key:"ceow96"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const P0=Ze("ListPlus",[["path",{d:"M11 12H3",key:"51ecnj"}],["path",{d:"M16 6H3",key:"1wxfjs"}],["path",{d:"M16 18H3",key:"12xzn7"}],["path",{d:"M18 9v6",key:"1twb98"}],["path",{d:"M21 12h-6",key:"bt1uis"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Bt=Ze("Loader2",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ch=Ze("LogOut",[["path",{d:"M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4",key:"1uf3rs"}],["polyline",{points:"16 17 21 12 16 7",key:"1gabdz"}],["line",{x1:"21",x2:"9",y1:"12",y2:"12",key:"1uyos4"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const _u=Ze("NotebookPen",[["path",{d:"M13.4 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2v-7.4",key:"re6nr2"}],["path",{d:"M2 6h4",key:"aawbzj"}],["path",{d:"M2 10h4",key:"l0bgd4"}],["path",{d:"M2 14h4",key:"1gsvsf"}],["path",{d:"M2 18h4",key:"1bu2t1"}],["path",{d:"M18.4 2.6a2.17 2.17 0 0 1 3 3L16 11l-4 1 1-4Z",key:"1dba1m"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const F0=Ze("Paperclip",[["path",{d:"m21.44 11.05-9.19 9.19a6 6 0 0 1-8.49-8.49l8.57-8.57A4 4 0 1 1 18 8.84l-8.59 8.57a2 2 0 0 1-2.83-2.83l8.49-8.48",key:"1u3ebp"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ou=Ze("Plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const dh=Ze("Receipt",[["path",{d:"M4 2v20l2-1 2 1 2-1 2 1 2-1 2 1 2-1 2 1V2l-2 1-2-1-2 1-2-1-2 1-2-1-2 1Z",key:"q3az6g"}],["path",{d:"M16 8h-6a2 2 0 1 0 0 4h4a2 2 0 1 1 0 4H8",key:"1h4pet"}],["path",{d:"M12 17.5v-11",key:"1jc1ny"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const B0=Ze("Search",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["path",{d:"m21 21-4.3-4.3",key:"1qie3q"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Zl=Ze("Send",[["path",{d:"m22 2-7 20-4-9-9-4Z",key:"1q3vgg"}],["path",{d:"M22 2 11 13",key:"nzbqef"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $0=Ze("ShieldAlert",[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}],["path",{d:"M12 8v4",key:"1got3b"}],["path",{d:"M12 16h.01",key:"1drbdi"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const H0=Ze("Sparkles",[["path",{d:"m12 3-1.912 5.813a2 2 0 0 1-1.275 1.275L3 12l5.813 1.912a2 2 0 0 1 1.275 1.275L12 21l1.912-5.813a2 2 0 0 1 1.275-1.275L21 12l-5.813-1.912a2 2 0 0 1-1.275-1.275L12 3Z",key:"17u4zn"}],["path",{d:"M5 3v4",key:"bklmnn"}],["path",{d:"M19 17v4",key:"iiml17"}],["path",{d:"M3 5h4",key:"nem4j1"}],["path",{d:"M17 19h4",key:"lbex7p"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const U0=Ze("Star",[["polygon",{points:"12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2",key:"8f66p6"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const uh=Ze("Table",[["path",{d:"M12 3v18",key:"108xh3"}],["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}],["path",{d:"M3 9h18",key:"1pudct"}],["path",{d:"M3 15h18",key:"5xshup"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $s=Ze("Trash2",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const No=Ze("Upload",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"17 8 12 3 7 8",key:"t8dd8p"}],["line",{x1:"12",x2:"12",y1:"3",y2:"15",key:"widbto"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const W0=Ze("UserCheck",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["polyline",{points:"16 11 18 13 22 9",key:"1pwet4"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const z0=Ze("User",[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const V0=Ze("Wand2",[["path",{d:"m21.64 3.64-1.28-1.28a1.21 1.21 0 0 0-1.72 0L2.36 18.64a1.21 1.21 0 0 0 0 1.72l1.28 1.28a1.2 1.2 0 0 0 1.72 0L21.64 5.36a1.2 1.2 0 0 0 0-1.72Z",key:"1bcowg"}],["path",{d:"m14 7 3 3",key:"1r5n42"}],["path",{d:"M5 6v4",key:"ilb8ba"}],["path",{d:"M19 14v4",key:"blhpug"}],["path",{d:"M10 2v2",key:"7u0qdc"}],["path",{d:"M7 8H3",key:"zfb6yr"}],["path",{d:"M21 16h-4",key:"1cnmox"}],["path",{d:"M11 3H9",key:"1obp7u"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ht=Ze("X",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]]),mh=["The facts outlined in the statement of claim","Statement of Claim  Factual Summary"],Ws="Factual background  Statement of Claim",ph=["Factual Summary from the Letter of Demand"],Co="Factual background  Letter of Demand",Mu="The plaintiff's expert opinion",Pu="The claimant's expert opinion",ws=[{id:"u1",username:"lior",password:"lior123",name:"Lior Perry",email:"lior@lp-law.co.il",role:"ADMIN"},{id:"u2",username:"lidor",password:"lidor123",name:"Lidor Kabilo",email:"Lidor@lp-law.co.il",role:"SUB_ADMIN"},{id:"u3",username:"iris",password:"iris123",name:"Iris Alfman",email:"Iris@lp-law.co.il",role:"FINANCE"},{id:"u4",username:"hava",password:"hava123",name:"Hava Kabilo",email:"Hava@lp-law.co.il",role:"LAWYER"},{id:"u5",username:"may",password:"may123",name:"May Harari",email:"May@lp-law.co.il",role:"LAWYER"},{id:"u6",username:"vlada",password:"vlada123",name:"Vlada Boltach",email:"Vlada@lp-law.co.il",role:"LAWYER"},{id:"u7",username:"orly",password:"orly123",name:"Orly Day",email:"Orly@lp-law.co.il",role:"LAWYER"}],dp=["W/R/B Underwriting","QBE Insurance Group","Market Form Underwriting","Dale Underwriting Partners","MedPro & CNA Syndicate","Hardy (Underwriting Agencies) Limited"],Lr=[Ws,Co,Mu,Pu,"The insured's expert opinion","Insurance Coverage","Risk Assessment","MPL","Strategy","Expenses breakdown","Expenses & Compensation breakdown","Recommendations","Strategy & Recommendations","Request for Approval of a Settlement Agreement"],fh=["New lawsuit","Letter of demand","New third-party notice","Caution Notice"],bo="/api/templates",vo=async e=>{if(!e.ok){const s=await e.text().catch(()=>"");throw new Error(s||`Request failed with status ${e.status}`)}const t=await e.json();return Array.isArray(t)?t:[]},up=async()=>{const e=await fetch(bo);return vo(e)},mp=async(e,t)=>{const s={"Content-Type":"application/json","x-user-role":t};if(!e.id){const a=await fetch(bo,{method:"POST",headers:s,body:JSON.stringify(e)});return vo(a)}const r=await fetch(`${bo}/${encodeURIComponent(e.id)}`,{method:"PUT",headers:s,body:JSON.stringify(e)});return vo(r)},K0=async(e,t)=>{const s=await fetch(`${bo}/${encodeURIComponent(e)}`,{method:"DELETE",headers:{"x-user-role":t}});return vo(s)},Y0=async(e,t,s)=>{const r=await fetch(`${bo}/${encodeURIComponent(e)}/reorder`,{method:"POST",headers:{"Content-Type":"application/json","x-user-role":s},body:JSON.stringify({direction:t})});return vo(r)},Cd=async e=>{if(!e||!e.trim())return"";try{const t=await fetch("/api/translate",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({text:e})});if(!t.ok)throw new Error(`Server error: ${t.statusText}`);return(await t.json()).translation||""}catch(t){return console.error("Translation error:",t),"Error translation."}},G0=async(e,t)=>{try{const s=await fetch("/api/extract-policy",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({image:e,mimeType:t})});if(!s.ok)throw new Error("Server error");return await s.json()}catch(s){return console.error(s),{}}},q0=async(e,t="SAFE_POLISH")=>{try{const s=await fetch("/api/refine-text",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({text:e,mode:t})}),r=await s.json().catch(()=>({}));if(s.status===422&&r&&r.error&&r.error.code==="FACT_PROTECTION_FAILED")return{text:typeof r.refined=="string"?r.refined:e,factProtectionBlocked:!0};if(!s.ok)throw new Error("Refinement failed");return{text:typeof r.refined=="string"&&r.refined.trim()?r.refined:e,factProtectionBlocked:!1}}catch(s){throw console.error("Hebrew refinement error:",s),s}},xh=async e=>{if(!e||!e.trim())return e;try{const t=await fetch("/api/improve-english",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({text:e})});if(!t.ok)throw new Error("English improvement failed");const s=await t.json(),r=typeof s.improved=="string"?s.improved:"";return r.trim()?r:e}catch(t){throw console.error("English improvement error:",t),t}},X0=async e=>{if(!e||!e.trim())return"";try{const t=await fetch("/api/hebrew-report-summary",{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({text:e})}),s=await t.json().catch(()=>({}));if(!t.ok){const a=s&&typeof s.error=="string"&&s.error||"Hebrew report summary failed";throw new Error(a)}return typeof s.summary=="string"&&s.summary.trim()?s.summary.trim():""}catch(t){throw console.error("Hebrew report summary error:",t),t instanceof Error?t:new Error("Hebrew report summary error")}},J0=async(e,t,s="CLAIM",r)=>{const a=await fetch("/api/analyze-medical-complaint",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({fileBase64:e,mimeType:t,analysisType:s,expertCountMode:r==null?void 0:r.expertCountMode,partyRole:r==null?void 0:r.partyRole,sectionKey:r==null?void 0:r.sectionKey,plaintiffName:r==null?void 0:r.plaintiffName,insuredName:r==null?void 0:r.insuredName,insurerName:r==null?void 0:r.insurerName,reportSubject:r==null?void 0:r.reportSubject})}),o=await a.json().catch(()=>({})),l=o.analysis??null,c=typeof o.claimSummary=="string"?o.claimSummary:"";return a.ok?o.success===!1?{analysis:null,claimSummary:"",success:!1,reason:o.reason}:{analysis:l,claimSummary:c,success:!0}:(console.error("Medical complaint analysis failed",a.status,o),{analysis:null,claimSummary:"",success:!1,reason:o.reason||"REQUEST_FAILED"})},Q0=async(e,t)=>{const s=await fetch("/api/analyze-dental-opinion",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({fileBase64:e,mimeType:t})}),r=await s.json().catch(()=>({})),a=typeof r.result=="string"?r.result:"",o=typeof r.reason=="string"?r.reason:void 0;return s.ok?r.success===!1?{success:!1,text:"",reason:o||"AI_UNAVAILABLE"}:{success:!0,text:a}:(console.error("Dental opinion analysis failed",s.status,r),{success:!1,text:"",reason:o||"REQUEST_FAILED"})},Z0=async(e,t)=>{try{const s=await fetch("/api/extract-expenses",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({fileBase64:e,mimeType:t})});if(!s.ok)throw new Error("Expenses extraction failed");return await s.json()}catch(s){return console.error(s),{items:[]}}},eN=async e=>{try{const t=await fetch("/api/help-chat",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({question:e})});if(!t.ok)throw new Error("Chat failed");return(await t.json()).answer||"Sorry, I could not answer that."}catch(t){return console.error(t),"System error. Please try again."}},tN=async e=>{try{const t=await fetch("/api/assistant/help",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)}),s=await t.json().catch(()=>({}));t.ok||console.error("Assistant help HTTP error:",t.status,s);const r=typeof s.title=="string"&&s.title.trim()?s.title.trim():"    ",a=Array.isArray(s.bullets)?s.bullets.filter(c=>typeof c=="string"&&c.trim().length>0):["        -AI.","       (, ,  PDF).","  ,      ."],o=typeof s.warning=="string"&&s.warning.trim()?s.warning.trim():void 0,l=typeof s.nextSuggestion=="string"&&s.nextSuggestion.trim()?s.nextSuggestion.trim():void 0;return{title:r,bullets:a,warning:o,nextSuggestion:l}}catch(t){throw console.error("Assistant help error:",t),t}},pp=async e=>{try{if(!(await fetch("/api/send-email",{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify(e)})).ok)throw new Error("Email failed");return!0}catch(t){return console.error(t),!1}},jc=async e=>{try{const t=await fetch("/api/render-report-pdf",{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({report:e})});if(!t.ok)throw new Error("PDF rendering failed");return await t.blob()}catch(t){throw console.error("PDF render error:",t),t}};async function nN(e,t){try{const s=await fetch("/api/analyze-tone-risk",{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({content:e})});let r=null;try{r=await s.json()}catch{r=null}if(!s.ok){const p=r&&r.error&&typeof r.error.message=="string"?r.error.message:"Tone & Risk analysis failed";throw new Error(p)}const a=!!(r&&r.ok),o=r&&typeof r.runAt=="string"?r.runAt:new Date().toISOString(),l=Array.isArray(r==null?void 0:r.issues)?r.issues:[],c=r&&typeof r.promptVersion=="string"?r.promptVersion:"unknown",i=r&&typeof r.meta=="object"?{sectionsSent:Number(r.meta.sectionsSent)||0,charsBefore:Number(r.meta.charsBefore)||0,charsAfter:Number(r.meta.charsAfter)||0,truncatedSections:Number(r.meta.truncatedSections)||0}:{sectionsSent:0,charsBefore:0,charsAfter:0,truncatedSections:0},u=r&&typeof r.error=="object"?{code:r.error.code,message:r.error.message}:void 0;if(!a){const p=u&&typeof u.message=="string"&&u.message||"Tone & Risk analysis failed",y=new Error(p);throw y.code=(u==null?void 0:u.code)||"LLM_FAILED",y}return{ok:!0,runAt:o,promptVersion:c,issues:l,meta:i,error:void 0}}catch(s){throw console.error("Tone & Risk analysis error:",s),s instanceof Error?s:new Error("Tone & Risk analysis error")}}async function sN(e,t){const s=await fetch("/api/review-hebrew-style",{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({content:e})}),r=await s.json().catch(()=>({})),a=Array.isArray(r.issues)?r.issues:[],o=typeof r.runAt=="string"?r.runAt:new Date().toISOString();return s.ok?r.success===!1?{runAt:o,issues:a,success:!1,reason:r.reason}:{runAt:o,issues:a,success:!0}:(console.error("Hebrew style review failed",s.status,r),{runAt:o,issues:a,success:!1,reason:r.reason||"REQUEST_FAILED"})}const la="/api/best-practices",ia=async e=>{if(!e.ok){const s=await e.text().catch(()=>"");throw new Error(s||`Request failed with status ${e.status}`)}const t=await e.json();return Array.isArray(t)?t:[]},rN=async()=>{const e=await fetch(la);return ia(e)},fp=async(e,t)=>{const s={"Content-Type":"application/json","x-user-role":t};if(!e.id){const a=await fetch(la,{method:"POST",headers:s,body:JSON.stringify(e)});return ia(a)}const r=await fetch(`${la}/${encodeURIComponent(e.id)}`,{method:"PUT",headers:s,body:JSON.stringify(e)});return ia(r)},aN=async(e,t)=>{const s=await fetch(`${la}/${encodeURIComponent(e)}`,{method:"DELETE",headers:{"x-user-role":t}});return ia(s)},oN=async(e,t,s)=>{const r=await fetch(`${la}/${encodeURIComponent(e)}`,{method:"PUT",headers:{"Content-Type":"application/json","x-user-role":s},body:JSON.stringify({isEnabled:t})});return ia(r)},xp=async(e,t,s)=>{const r=await fetch(`${la}/${encodeURIComponent(e)}/usage`,{method:"POST",headers:{"Content-Type":"application/json","x-user-role":s},body:JSON.stringify({mode:t})});return ia(r)},Fu=e=>e===Mu,Bu=e=>e===Pu,hp=e=>Fu(e)||Bu(e),lN=e=>Fu(e)||e===Ws?"PLAINTIFF":Bu(e)||e===Co?"CLAIMANT":null,gp=(e,t="SINGLE")=>`${t==="MULTIPLE"?"Expert opinions":"Expert opinion"}  ${e==="PLAINTIFF"?"Statement of Claim":"Letter of Demand"}`,Dd=(e,t)=>Fu(e)?gp("PLAINTIFF",t):Bu(e)?gp("CLAIMANT",t):e,iN=({data:e})=>{const[t,s]=g.useState(""),[r,a]=g.useState(!1),[o,l]=g.useState(null);if(g.useEffect(()=>{let i=!1;return(async()=>{a(!0),l(null);try{const p=await fetch("/api/render-report-html",{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({report:e})});if(!p.ok)throw new Error("Failed to load report HTML");const y=await p.text();i||s(y)}catch(p){console.error(p),i||l("   ")}finally{i||a(!1)}})(),()=>{i=!0}},[e]),o)return n.jsx("div",{className:"w-[210mm] min-h-[297mm] bg-panel border border-borderDark shadow-2xl mx-auto flex items-center justify-center text-sm text-red-300",children:o});if(r&&!t)return n.jsx("div",{className:"w-[210mm] min-h-[297mm] bg-panel shadow-2xl mx-auto flex flex-col items-center justify-center text-sm text-textMuted",children:n.jsx("span",{children:"  ..."})});const c=!!e.policyFile&&(e.attachPolicyAsAppendix??!0);return n.jsxs("div",{className:"space-y-2",children:[n.jsx("iframe",{title:"Report Preview",className:"w-[210mm] min-h-[297mm] bg-panel shadow-2xl mx-auto border-none print:shadow-none print:w-full",srcDoc:t}),c&&n.jsx("p",{className:"w-[210mm] mx-auto text-[11px] text-textMuted text-right",children:"The policy file will be attached as Appendix A in the final PDF (not shown in this preview)."})]})},cN=e=>{switch(e){case"HEBREW_SUBMITTED":return" ";case"HEBREW_CHANGES_REQUESTED":return" ";case"HEBREW_APPROVED":return" ";case"HEBREW_REOPENED_EXTERNAL":return"  ()";case"HEBREW_DRAFT":default:return" "}},dN=e=>{switch(e){case"SUBMITTED":return"  ";case"CHANGES_REQUESTED":return"  ";case"APPROVED":return"  ";case"DRAFT":default:return"  (  )"}},kl="report-review-panel",Ld="external-feedback-panel",uN=({report:e,currentUser:t,onSubmitToAdmin:s,onApproveHebrew:r,onRequestChanges:a,onMarkIssueDone:o,onAddExternalFeedbackIssues:l,onReopenHebrewDueToExternalFeedback:c})=>{const[i,u]=g.useState(!1),[p,y]=g.useState(""),[b,w]=g.useState(""),[R,E]=g.useState("NORMAL"),[W,N]=g.useState(""),[h,S]=g.useState("INTERNAL"),[P,U]=g.useState("ENGLISH_ONLY"),V=g.useMemo(()=>{const M=e.reportReview;return M||{status:"DRAFT",issues:[]}},[e.reportReview]),X=g.useMemo(()=>{const M={};return V.issues.filter(I=>(I.origin??"INTERNAL")==="INTERNAL").forEach(I=>{const D=I.sectionKey||"GENERAL";M[D]||(M[D]=[]),M[D]=[...M[D],I]}),M},[V.issues]),te=g.useMemo(()=>{const M={};return V.issues.filter(I=>I.origin==="EXTERNAL").forEach(I=>{const D=I.sectionKey||"GENERAL";M[D]||(M[D]=[]),M[D]=[...M[D],I]}),M},[V.issues]),G=(t==null?void 0:t.role)==="LAWYER",ae=(t==null?void 0:t.role)==="ADMIN",j=V.issues.some(M=>(M.origin??"INTERNAL")==="EXTERNAL"&&M.status!=="DONE"&&M.externalAction==="REQUIRES_HEBREW"),F=M=>{S(M),y(""),w(""),E("NORMAL"),N(""),U("ENGLISH_ONLY"),u(!0)},L=()=>{const M=p.trim(),I=b.trim();if(!M||!I)return;const D={title:M,instruction:I,severity:R,type:"OTHER",sectionKey:void 0,externalAction:h==="EXTERNAL"?P:void 0};h==="EXTERNAL"&&l?l([D],W.trim()||void 0):a([D]),u(!1)},O=dN(V.status),H=cN(e.hebrewWorkflowStatus);return n.jsxs("section",{id:kl,className:"mt-4 rounded-xl border border-borderDark bg-navySecondary px-4 py-3",dir:"rtl",lang:"he",children:[n.jsxs("div",{className:"mb-2 flex items-center justify-between gap-3",children:[n.jsxs("div",{children:[n.jsx("div",{className:"text-xs font-semibold text-textMuted500",children:" "}),n.jsx("div",{className:"text-sm font-medium text-textLight",children:O})]}),n.jsx("span",{className:"inline-flex items-center rounded-full bg-navySecondary px-3 py-1 text-xs font-medium text-textMuted700",children:H})]}),G&&n.jsx("div",{className:"mb-3 text-xs text-amber-700",children:e.hebrewWorkflowStatus==="HEBREW_REOPENED_EXTERNAL"?"            .":V.status==="SUBMITTED"?"   .       .":V.status==="CHANGES_REQUESTED"?"   .      .":null}),ae&&j&&n.jsx("div",{className:"mb-3 text-xs font-semibold text-red-700",children:"      .    ."}),V.issues.length>0&&n.jsxs("div",{className:"mb-3 space-y-3",children:[Object.keys(X).length>0&&n.jsxs("div",{children:[n.jsx("div",{className:"mb-1 text-xs font-semibold text-textMuted",children:"  ()"}),Object.entries(X).map(([M,I])=>n.jsxs("div",{className:"rounded-lg bg-panel p-2 mb-1",children:[M!=="GENERAL"&&n.jsxs("div",{className:"mb-1 text-[11px] font-semibold text-textMuted500",children:[": ",M]}),n.jsx("ul",{className:"space-y-1",children:I.map(D=>n.jsxs("li",{className:"flex items-start justify-between gap-2 rounded-md border border-borderDark bg-navySecondary px-2 py-1.5",children:[n.jsxs("div",{children:[n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsx("span",{className:`inline-flex items-center rounded-full px-2 py-0.5 text-[10px] font-semibold ${D.severity==="CRITICAL"?"bg-red-100 text-red-700":D.severity==="NORMAL"?"bg-amber-50 text-amber-700":"bg-navySecondary text-textMuted"}`,children:D.severity==="CRITICAL"?"":D.severity==="NORMAL"?"":""}),n.jsx("span",{className:"text-xs font-medium text-textLight",children:D.title})]}),n.jsx("div",{className:"mt-1 text-[11px] text-textMuted700",children:D.instruction})]}),(G||ae)&&n.jsx("button",{type:"button",className:"mt-1 inline-flex items-center rounded-full border border-emerald-200 bg-emerald-50 px-2 py-0.5 text-[10px] font-medium text-emerald-700 hover:bg-emerald-100 disabled:opacity-50",disabled:D.status==="DONE",onClick:()=>o(D.id),children:D.status==="DONE"?"":" "})]},D.id))})]},M))]}),Object.keys(te).length>0&&n.jsxs("div",{id:Ld,children:[n.jsx("div",{className:"mb-1 text-xs font-semibold text-textMuted",children:"  "}),Object.entries(te).map(([M,I])=>n.jsxs("div",{className:"rounded-lg bg-panel p-2 mb-1",children:[M!=="GENERAL"&&n.jsxs("div",{className:"mb-1 text-[11px] font-semibold text-textMuted500",children:[": ",M]}),n.jsx("ul",{className:"space-y-1",children:I.map(D=>n.jsxs("li",{className:"flex items-start justify-between gap-2 rounded-md border border-borderDark bg-navySecondary px-2 py-1.5",children:[n.jsxs("div",{children:[n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsx("span",{className:`inline-flex items-center rounded-full px-2 py-0.5 text-[10px] font-semibold ${D.severity==="CRITICAL"?"bg-red-100 text-red-700":D.severity==="NORMAL"?"bg-amber-50 text-amber-700":"bg-navySecondary text-textMuted"}`,children:D.severity==="CRITICAL"?"":D.severity==="NORMAL"?"":""}),n.jsx("span",{className:"text-xs font-medium text-textLight",children:D.title})]}),n.jsx("div",{className:"mt-1 text-[11px] text-textMuted700",children:D.instruction})]}),(G||ae)&&n.jsx("button",{type:"button",className:"mt-1 inline-flex items-center rounded-full border border-emerald-200 bg-emerald-50 px-2 py-0.5 text-[10px] font-medium text-emerald-700 hover:bg-emerald-100 disabled:opacity-50",disabled:D.status==="DONE",onClick:()=>o(D.id),children:D.status==="DONE"?"":" "})]},D.id))})]},M))]})]}),n.jsxs("div",{className:"mt-3 flex flex-wrap items-center gap-2",children:[G&&n.jsx("button",{type:"button",className:"rounded-md bg-sky-700 px-3 py-1.5 text-xs font-semibold text-white hover:bg-sky-800 disabled:opacity-50",onClick:s,disabled:V.status==="SUBMITTED"||V.status==="APPROVED",children:"  "}),ae&&n.jsxs(n.Fragment,{children:[n.jsx("button",{type:"button",className:"rounded-md bg-emerald-700 px-3 py-1.5 text-xs font-semibold text-white hover:bg-emerald-800 disabled:opacity-50",onClick:r,children:"  "}),n.jsx("button",{type:"button",className:"rounded-md bg-amber-700 px-3 py-1.5 text-xs font-semibold text-white hover:bg-amber-800",onClick:()=>F("INTERNAL"),children:" "}),l&&n.jsx("button",{type:"button",className:"rounded-md bg-slate-700 px-3 py-1.5 text-xs font-semibold text-white hover:bg-slate-800",onClick:()=>F("EXTERNAL"),children:"   "}),c&&e.status==="SENT"&&n.jsx("button",{type:"button",className:"rounded-md bg-red-700 px-3 py-1.5 text-xs font-semibold text-white hover:bg-red-800",onClick:c,children:"   ( )"}),c&&e.status!=="SENT"&&n.jsx("span",{className:"text-[11px] text-textMuted500",children:"       (SENT)."})]})]}),i&&n.jsx("div",{className:"fixed inset-0 z-[180] flex items-center justify-center bg-black/40",children:n.jsxs("div",{className:"w-full max-w-md rounded-xl bg-panel p-4 shadow-2xl",dir:"rtl",lang:"he",children:[n.jsx("h3",{className:"mb-3 text-sm font-bold text-textLight",children:"   "}),n.jsxs("div",{className:"mb-3 space-y-2",children:[n.jsxs("div",{children:[n.jsx("label",{className:"mb-1 block text-xs font-semibold text-textMuted700",children:"  ()"}),n.jsx("input",{type:"text",className:"w-full rounded-md border border-borderDark px-2 py-1.5 text-sm",value:p,onChange:M=>y(M.target.value)})]}),n.jsxs("div",{children:[n.jsx("label",{className:"mb-1 block text-xs font-semibold text-textMuted700",children:"  ()"}),n.jsx("textarea",{className:"w-full rounded-md border border-borderDark px-2 py-1.5 text-sm",rows:3,value:b,onChange:M=>w(M.target.value)})]}),n.jsxs("div",{children:[n.jsx("label",{className:"mb-1 block text-xs font-semibold text-textMuted700",children:" "}),n.jsxs("select",{className:"w-full rounded-md border border-borderDark px-2 py-1.5 text-xs",value:R,onChange:M=>E(M.target.value),children:[n.jsx("option",{value:"NORMAL",children:""}),n.jsx("option",{value:"CRITICAL",children:""}),n.jsx("option",{value:"STYLE",children:""})]})]}),h==="EXTERNAL"&&n.jsxs("div",{children:[n.jsx("label",{className:"mb-1 block text-xs font-semibold text-textMuted700",children:"    ()"}),n.jsx("input",{type:"text",className:"w-full rounded-md border border-borderDark px-2 py-1.5 text-sm",value:W,onChange:M=>N(M.target.value)}),n.jsx("label",{className:"mb-1 mt-3 block text-xs font-semibold text-textMuted700",children:" "}),n.jsxs("select",{className:"w-full rounded-md border border-borderDark px-2 py-1.5 text-xs",value:P,onChange:M=>U(M.target.value),children:[n.jsx("option",{value:"ENGLISH_ONLY",children:"  "}),n.jsx("option",{value:"REQUIRES_HEBREW",children:"  "})]})]})]}),n.jsxs("div",{className:"mt-4 flex justify-end gap-2",children:[n.jsx("button",{type:"button",className:"rounded-md border border-borderDark px-3 py-1.5 text-xs font-medium text-textMuted700 hover:bg-navySecondary",onClick:()=>u(!1),children:""}),n.jsx("button",{type:"button",className:"rounded-md bg-amber-700 px-3 py-1.5 text-xs font-semibold text-white hover:bg-amber-800 disabled:opacity-50",onClick:L,disabled:!p.trim()||!b.trim(),children:" "})]})]})})]})},So="REPLACE_WITH_GRAMMARLY_CLIENT_ID",$u={[Ws]:"Statement of Claim",[Co]:"Letter of Demand",[Mu]:"Statement of Claim Expert Opinion",[Pu]:"Letter of Demand Expert Opinion","The plaintiff's expert opinion":"Plaintiff Expert Opinion","The claimant's expert opinion":"Claimant Expert Opinion","The insured's expert opinion":"Insured Expert Opinion","Insurance Coverage":"Insurance Coverage","Risk Assessment":"Risk Assessment",MPL:"MPL",Strategy:"Strategy","Expenses breakdown":"Expenses Breakdown","Expenses & Compensation breakdown":"Expenses & Compensation",Recommendations:"Recommendations","Strategy & Recommendations":"Strategy & Recommendations","Request for Approval of a Settlement Agreement":"Settlement Approval",Update:"Update"};mh.forEach(e=>{$u[e]="Statement of Claim"});ph.forEach(e=>{$u[e]="Letter of Demand"});const mN=e=>($u[e]||e||"").trim(),hh=e=>e.map(mN).filter(Boolean),_d=e=>{const t=new Set;return e.map(s=>s.trim()).filter(s=>{if(!s)return!1;const r=s.toLowerCase();return t.has(r)?!1:(t.add(r),!0)})},Hu=/[\\/:*?"<>|]/g,Ec=e=>(e||"").trim(),pN=e=>{const t=(e.filenameTag||"").toLowerCase(),s=(e.plaintiffTitle||"").toLowerCase();return t.includes("demand")||s==="claimant"},fN=e=>{var t;return(((t=e.reportHistory)==null?void 0:t.length)||0)+1},xN=120,hN=e=>{if(!e.length)return"";if(e.length===1)return e[0];if(e.length===2)return`${e[0]} & ${e[1]}`;const t=e.slice(0,-1),s=e[e.length-1];return`${t.join(", ")} & ${s}`},cr=e=>{const t=Ec(e.insurerName),s=Ec(e.insuredName),r=Ec(e.plaintiffName),a=fN(e);let o=[];const l=Array.isArray(e.fileNameTitles)?on(e.fileNameTitles.map(R=>qt(R))):[];l.length>0?o=_d(l):a===1?o=[pN(e)?"New Letter of demand":"New Lawsuit"]:(o=_d(hh(e.selectedSections||[])),o.length||(o=["Update"]));const c=hN(o),i=`Report ${a}`;let p=[t||void 0,s||void 0,r||void 0,c||void 0].filter(Boolean).join(" - ");if(p=p.replace(Hu," ").replace(/\s+/g," ").replace(/-+/g,"-").trim(),!p){const R=i;return R.toLowerCase().endsWith(".pdf")?R:`${R}.pdf`}const y=` - ${i}`,b=Math.max(0,xN-y.length);if(p.length>b){const R=p.slice(0,b),E=R.lastIndexOf(" ");p=(E>0?R.slice(0,E):R).trim()}let w=`${p}${y}`;return w=w.replace(/\s+/g," ").replace(/-+/g,"-").trim(),w||(w=`Report-${Date.now()}`),w.toLowerCase().endsWith(".pdf")?w:`${w}.pdf`},ei=e=>cr(e).replace(/\.pdf$/i,""),gh=e=>`fileNameTopics:${e||"default"}`,gN=["Update","Expenses","New Lawsuit","New Third Party Notice","New Letter of Demand","Risk Assessment","Strategy","Recommendation","Request for Settlement Approval","Judgment","Request to Reopen a Claim","Dismissal for Inaction"],qt=e=>{const t=(e||"").trim();return t?t.replace(Hu," ").replace(/\s+/g," ").trim():""},ti=e=>qt(e).trim().toLowerCase(),on=e=>{const t=new Set,s=[];for(const r of e){const a=qt(r),o=ti(a);o&&(t.has(o)||(t.add(o),s.push(a)))}return s},yN=e=>{if(typeof window>"u")return[];try{const t=window.localStorage.getItem(gh(e));if(!t)return[];const s=JSON.parse(t);return Array.isArray(s)?on(s.map(r=>typeof r=="string"?r:"").map(qt)):[]}catch{return[]}},NN=(e,t)=>{if(!(typeof window>"u"))try{const s=on(t.map(qt)).filter(Boolean);window.localStorage.setItem(gh(e),JSON.stringify(s))}catch{}},bN=(e,t,s=15)=>{const r=qt(t),a=ti(r);if(!a)return on(e).slice(0,s);const o=(e||[]).filter(c=>ti(c)!==a),l=[r,...o];return on(l).slice(0,s)},yh=e=>`topicCombos:${e||"default"}`,Nh=e=>`insurerDefaultTopics:${e||"default"}`,bh=e=>{if(!e)return null;try{return JSON.parse(e)}catch{return null}},Od=e=>{if(typeof window>"u")return[];const t=window.localStorage.getItem(yh(e)),s=bh(t);return Array.isArray(s)?s.filter(a=>Array.isArray(a)).map(a=>a.map(o=>qt(o)).filter(Boolean)).filter(a=>a.length>0):[]},yp=(e,t)=>{if(typeof window>"u")return;const s=t.map(r=>on(r.map(a=>qt(a))).filter(Boolean)).filter(r=>r.length>0);try{window.localStorage.setItem(yh(e),JSON.stringify(s))}catch{}},Np=e=>e.map(s=>ti(s)).filter(Boolean).sort().join("|"),bp=(e,t,s=6)=>{const r=on(t.map(c=>qt(c))).filter(Boolean);if(!r.length)return e;const a=Np(r),o=[],l=new Set;o.push(r),l.add(a);for(const c of e){const i=Np(c);if(!l.has(i)&&(o.push(on(c.map(u=>qt(u))).filter(Boolean)),l.add(i),o.length>=s))break}return o.slice(0,s)},Uu=e=>(e||"").trim().toLowerCase(),Wu=e=>{if(typeof window>"u")return{};const t=window.localStorage.getItem(Nh(e)),s=bh(t);if(!s||typeof s!="object")return{};const r={};for(const[a,o]of Object.entries(s)){if(!Array.isArray(o))continue;const l=on(o.map(c=>qt(c))).filter(Boolean).slice(0,8);l.length&&(r[a]=l)}return r},vh=(e,t)=>{if(typeof window>"u")return;const s={};for(const[r,a]of Object.entries(t)){const o=on((a||[]).map(l=>qt(l))).filter(Boolean).slice(0,8);o.length&&(s[r]=o)}try{window.localStorage.setItem(Nh(e),JSON.stringify(s))}catch{}},vN=(e,t)=>{const s=Wu(e),r=Uu(t);return s[r]||[]},SN=(e,t,s)=>{if(!t)return;const r=Uu(t),a=Wu(e),o=on(s.map(l=>qt(l))).filter(Boolean).slice(0,8);o.length?a[r]=o:delete a[r],vh(e,a)},wN=(e,t)=>{if(!t)return;const s=Uu(t),r=Wu(e);r[s]&&(delete r[s],vh(e,r))},vp=[{id:"general_update",label:"General Update",body:`Dear Sir/Madam,

Please find below our general update regarding the above-captioned matter.

Best regards,
Lior Perry, Adv.`},{id:"risk_assessment",label:"Risk Assessment",body:`Dear Sir/Madam,

Kindly review the following risk assessment prepared for the insurer.

Best regards,
Lior Perry, Adv.`},{id:"expert_opinion",label:"Expert Opinion",body:`Dear Sir/Madam,

Please find our expert opinion summary for your review and records.

Best regards,
Lior Perry, Adv.`},{id:"full_report",label:"Full Report Delivery",body:`Dear Sir/Madam,

Attached is the full report for the current update, including all relevant sections.

Best regards,
Lior Perry, Adv.`},{id:"zeev_new_demand",label:"Zeev  New demand letter",body:`Dear Zeev,

I've attached a report regarding a new demand letter.

Sincerely,
Lior`},{id:"zeev_claim_update",label:"Zeev  Claim update",body:`Dear Zeev,

I've attached a report on the claim in question.

Sincerely,
Lior`},{id:"zeev_new_lawsuit",label:"Zeev  New lawsuit",body:`Dear Zeev,

I've attached a report regarding a new lawsuit.

Sincerely,
Lior`},{id:"zeev_lawsuit_update",label:"Zeev  Lawsuit update",body:`Dear Zeev,

I've attached a report on the lawsuit in question.

Sincerely,
Lior`}],Sp=e=>`emailTemplates:${e||"default"}`,jN=({isOpen:e,report:t,userId:s,isSending:r=!1,recipientsPreview:a,defaultSubject:o,subjectDraft:l,onSubjectDraftChange:c,selectedTopics:i,onSelectedTopicsChange:u,isResendMode:p,onClose:y,onSend:b})=>{const w=vp[0],[R,E]=g.useState(w.id),[W,N]=g.useState(w.body),[h,S]=g.useState([]),[P,U]=g.useState([]),[V,X]=g.useState(l),[te,G]=g.useState(""),[ae,j]=g.useState(""),[F,L]=g.useState([]),[O,H]=g.useState([]),M=se=>{if(typeof window>"u")return[];try{const C=localStorage.getItem(Sp(se));if(!C)return[];const re=JSON.parse(C);return Array.isArray(re)?re.filter(Q=>typeof(Q==null?void 0:Q.id)=="string"&&typeof(Q==null?void 0:Q.label)=="string"&&typeof(Q==null?void 0:Q.body)=="string"):[]}catch{return[]}},I=se=>{typeof window>"u"||localStorage.setItem(Sp(s),JSON.stringify(se))},D=g.useMemo(()=>[...vp,...h],[h]),J=g.useMemo(()=>D.reduce((se,C)=>(se[C.id]=C,se),{}),[D]);g.useEffect(()=>{if(!e)return;const se=M(s);S(se);const C=yN(s);U(C),L(Od(s)),H(vN(s,t.insurerName)),X(l),j(""),G("")},[e,s,l,t.insurerName]),g.useEffect(()=>{if(!e)return;const se=t.selectedEmailTemplate&&J[t.selectedEmailTemplate]?t.selectedEmailTemplate:w.id;E(se),N(t.emailBodyDraft||J[se].body)},[e,w.id,t.emailBodyDraft,t.selectedEmailTemplate,J]);const ue=se=>{E(se);const C=J[se];C&&N(C.body)},ce=()=>{const se=window.prompt("  ?");if(!se)return;const C=se.trim();if(!C)return;const re={id:`custom_${Date.now()}`,label:C,body:W},Q=[...h,re];S(Q),I(Q),E(re.id)},le=g.useMemo(()=>on([...P,...gN]),[P]),fe=g.useMemo(()=>{const se=ae.trim().toLowerCase();return se?le.filter(C=>C.toLowerCase().includes(se)):le},[le,ae]),Ee=g.useMemo(()=>{if(!p)return null;const se=typeof t.reportNumber=="number"&&t.reportNumber>0?`#${t.reportNumber}`:"",C=t.sentAt?new Date(t.sentAt).toLocaleDateString("en-GB",{day:"2-digit",month:"short",year:"numeric"}):"";return n.jsxs("div",{className:"mb-3 flex items-start gap-2 rounded-md border border-amber-300 bg-amber-50 px-3 py-2 text-[11px] text-amber-900",children:[n.jsx(qa,{className:"w-3 h-3 mt-[2px]"}),n.jsxs("div",{children:[n.jsxs("p",{className:"font-semibold",children:["    ",se||"",C?`   ${C}`:"","."]}),n.jsx("p",{className:"mt-1",children:"   (resend)   ,    .       ."})]})]})},[p,t.reportNumber,t.sentAt]),ve=se=>{const C=qt(se);if(!C)return;const re=C.toLowerCase(),Q=i.some(he=>he.trim().toLowerCase()===re)?i.filter(he=>he.trim().toLowerCase()!==re):[...i,C];u(on(Q))},$e=()=>{const se=qt(te);if(!se)return;const C=bN(P,se,15);U(C),NN(s,C);const re=on([...i,se]);u(re),G("")},Pe=g.useMemo(()=>cr({...t,fileNameTitles:i}),[t,i]),Ye=!a.cc.some(se=>se.toLowerCase()!=="reports@lp-law.co.il"),it=a.to[0]||"",q=a.to.length===1&&it.toLowerCase()==="lidor@lp-law.co.il";return e?n.jsx("div",{className:"fixed inset-0 bg-black/50 z-[999] flex items-center justify-center p-4",children:n.jsxs("div",{className:"bg-panel rounded-2xl shadow-2xl w-full max-w-3xl max-h-[90vh] overflow-hidden flex flex-col",children:[n.jsxs("div",{className:"flex items-center justify-between border-b px-6 py-4",children:[n.jsxs("div",{className:"flex items-center gap-3",children:[n.jsx("h2",{className:"text-lg font-semibold text-gray-800",children:"Compose Email"}),q&&n.jsx("span",{className:"inline-flex items-center rounded-full bg-blue-50 px-2.5 py-0.5 text-[11px] font-semibold text-blue-800 border border-blue-200",children:"SANDBOX"})]}),n.jsx("button",{onClick:y,className:"text-gray-500 hover:text-gray-700",children:n.jsx(Ht,{className:"w-5 h-5"})})]}),n.jsxs("div",{className:"flex-1 overflow-y-auto px-6 py-4 space-y-4",children:[Ee,Ye&&n.jsxs("div",{className:"flex items-start gap-2 text-xs text-amber-800 bg-amber-50 border border-amber-200 rounded-md px-3 py-2",children:[n.jsx(qa,{className:"w-3.5 h-3.5 mt-[1px]"}),n.jsx("p",{children:"         .       (To)   CC."})]}),q&&n.jsxs("div",{className:"flex items-start gap-2 text-xs text-blue-800 bg-blue-50 border border-blue-200 rounded-md px-3 py-2",children:[n.jsx(qa,{className:"w-3.5 h-3.5 mt-[1px]"}),n.jsx("p",{children:" :         ,    ."})]}),n.jsxs("div",{className:"text-xs text-gray-600 space-y-1 border rounded-md border-gray-200 bg-gray-50 px-3 py-2",children:[n.jsxs("div",{className:"flex items-center justify-between",children:[n.jsx("span",{className:"font-semibold",children:"To:"})," ",n.jsx("span",{children:a.to.join("; ")||""})]}),a.cc.length>0&&n.jsxs("div",{className:"flex items-center justify-between",children:[n.jsx("span",{className:"font-semibold",children:"CC:"})," ",n.jsx("span",{children:a.cc.join("; ")})]}),n.jsxs("p",{className:"text-[11px] text-gray-500 mt-1",children:["To: ",it||""," (primary), CC: Office + report owner ( )."]}),n.jsxs("div",{children:[n.jsx("span",{className:"font-semibold",children:"Subject:"})," ",V||"(will be generated from case data)"]}),n.jsxs("div",{children:[n.jsx("span",{className:"font-semibold",children:"Attachment:"})," ",Pe]}),n.jsx("p",{className:"text-[11px] text-amber-700 mt-1",children:" :       ,        -PDF ."})]}),n.jsxs("div",{children:[n.jsxs("div",{className:"flex items-center justify-between mb-1",children:[n.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Subject"}),n.jsx("button",{type:"button",onClick:()=>{X(o),c(void 0)},className:"text-[11px] text-blue-700 hover:underline disabled:opacity-50",disabled:r,children:"Reset"})]}),n.jsx("input",{type:"text",value:V,onChange:se=>{const C=se.target.value;X(C),c(C)},className:"w-full border rounded-md p-2 text-sm",disabled:r})]}),n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Template"}),n.jsxs("div",{className:"flex gap-3",children:[n.jsx("select",{value:R,onChange:se=>ue(se.target.value),className:"flex-1 border rounded-md p-2",children:D.map(se=>n.jsx("option",{value:se.id,children:se.label},se.id))}),n.jsx("button",{type:"button",onClick:ce,className:"px-3 py-2 bg-panel border rounded-md text-sm font-medium text-gray-700 hover:bg-gray-100",disabled:r,children:"Save Template"})]})]}),n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"PDF Filename Topics"}),F.length>0&&n.jsxs("div",{className:"mb-2",children:[n.jsx("p",{className:"text-[11px] font-semibold text-gray-700 mb-1",children:"Recent combinations"}),n.jsx("div",{className:"flex flex-wrap gap-2",children:F.map((se,C)=>n.jsx("button",{type:"button",onClick:()=>u(se),className:"inline-flex items-center gap-1 rounded-full bg-gray-100 px-3 py-1 text-[11px] text-gray-800 border border-gray-300 hover:bg-gray-200",children:se.join(" + ")},C))})]}),n.jsx("div",{className:"flex flex-wrap gap-2 mb-2",children:i.length===0?n.jsx("span",{className:"text-xs text-gray-400",children:"No topics selected yet. You can choose from the list below or add your own."}):i.map(se=>n.jsxs("button",{type:"button",onClick:()=>ve(se),className:"inline-flex items-center gap-1 rounded-full bg-blue-50 px-3 py-1 text-xs text-blue-800 border border-blue-200 hover:bg-blue-100",children:[n.jsx("span",{children:se}),n.jsx("span",{className:"text-[10px]",children:""})]},se))}),n.jsx("button",{type:"button",onClick:()=>{u([]),j("")},className:"mb-2 text-[11px] text-blue-700 hover:underline",disabled:r,children:"  "}),n.jsx("div",{className:"flex items-center gap-2 mb-2",children:n.jsx("input",{type:"text",value:ae,onChange:se=>j(se.target.value),placeholder:"  ...",className:"flex-1 border rounded-md p-1.5 text-[11px]",disabled:r})}),n.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-1 mb-2 max-h-32 overflow-y-auto border rounded-md p-2 bg-panel",children:fe.map(se=>{const C=`topic-${se}`,re=se.toLowerCase(),Q=i.some(he=>he.trim().toLowerCase()===re);return n.jsxs("label",{htmlFor:C,className:"flex items-center gap-1 text-xs text-gray-700 cursor-pointer",children:[n.jsx("input",{id:C,type:"checkbox",className:"h-3 w-3",checked:Q,onChange:()=>ve(se),disabled:r}),n.jsx("span",{className:"whitespace-normal break-words",children:se})]},se)})}),n.jsxs("div",{className:"flex gap-2 mt-1",children:[n.jsx("input",{type:"text",value:te,onChange:se=>G(se.target.value),placeholder:"Add custom topic",className:"flex-1 border rounded-md p-2 text-xs",disabled:r}),n.jsx("button",{type:"button",onClick:$e,className:"px-3 py-1.5 bg-panel border rounded-md text-xs font-medium text-gray-700 hover:bg-gray-100 disabled:opacity-50",disabled:r,children:"Add"})]}),n.jsxs("div",{className:"mt-3 space-y-1 text-[11px] text-gray-700",children:[n.jsxs("div",{className:"flex gap-2 flex-wrap items-center",children:[n.jsx("button",{type:"button",onClick:()=>{const se=on(i.map(C=>qt(C)));se.length&&(SN(s,t.insurerName,se),H(se))},className:"px-2 py-1 rounded-full border border-gray-300 bg-panel hover:bg-gray-100",disabled:r||i.length===0,children:"     "}),O.length>0&&n.jsxs(n.Fragment,{children:[n.jsx("button",{type:"button",onClick:()=>u(O),className:"px-2 py-1 rounded-full border border-blue-300 bg-blue-50 text-blue-800 hover:bg-blue-100 disabled:opacity-50",disabled:r,children:"     "}),n.jsx("button",{type:"button",onClick:()=>{wN(s,t.insurerName),H([])},className:"text-[11px] text-red-600 hover:underline",disabled:r,children:"    "})]})]}),O.length>0&&i.length===0&&n.jsx("p",{className:"text-[11px] text-gray-500",children:"     .       ."})]})]}),n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Email Body"}),n.jsx(go,{clientId:So,children:n.jsx("textarea",{value:W,onChange:se=>N(se.target.value),rows:12,dir:"ltr",className:"w-full border rounded-md p-3 text-sm",style:{direction:"ltr",textAlign:"left",unicodeBidi:"plaintext"}})})]}),n.jsxs("div",{className:"border-t pt-4 text-right",children:[n.jsx("p",{className:"text-sm font-semibold text-gray-600 mb-2",children:"Signature"}),n.jsxs("div",{className:"inline-flex flex-col items-end",children:[n.jsx("img",{src:"/assets/branding/signature.png",alt:"Signature placeholder",className:"h-16 object-contain mb-2 opacity-80",onError:se=>{se.currentTarget.style.display="none"}}),n.jsx("span",{className:"text-sm text-gray-700 font-semibold",children:"Adv. Lior Perry"})]})]})]}),n.jsxs("div",{className:"flex justify-end gap-3 border-t px-6 py-4 bg-gray-50",children:[n.jsx("button",{onClick:y,className:"px-4 py-2 rounded-md text-gray-600 hover:bg-gray-200",disabled:r,children:"Cancel"}),n.jsx("button",{onClick:()=>b({body:W,templateId:R,subjectBase:V.trim(),topics:on(i.map(se=>qt(se)))}),className:"px-5 py-2 rounded-md bg-lpBlue text-white font-semibold hover:bg-blue-900 disabled:opacity-60 disabled:cursor-not-allowed",disabled:r,children:r?"Sending":"Send Email"})]})]})}):null},EN=({isOpen:e,availableTitles:t,selectedTitles:s,onClose:r,onSave:a})=>{const o=g.useMemo(()=>b=>{const w=new Set,R=[];return b.forEach(E=>{const W=t.find(N=>N.label===E&&!w.has(N.id));W&&(R.push(W.id),w.add(W.id))}),R},[t]),l=g.useCallback(()=>{const b=o(s);return b.length?b:t.map(w=>w.id)},[o,s,t]),[c,i]=g.useState(l);if(g.useEffect(()=>{e&&i(l())},[e,l]),!e)return null;const u=b=>{i(w=>w.includes(b)?w.filter(R=>R!==b):[...w,b])},p=()=>{i(t.map(b=>b.id))},y=()=>{const b=c.map(w=>{var R;return(R=t.find(E=>E.id===w))==null?void 0:R.label}).filter(Boolean);a(b)};return n.jsx("div",{className:"fixed inset-0 bg-black/40 z-[900] flex items-center justify-center p-4",children:n.jsxs("div",{className:"bg-panel rounded-2xl shadow-2xl w-full max-w-md max-h-[90vh] overflow-hidden flex flex-col",children:[n.jsxs("div",{className:"flex items-center justify-between px-5 py-3 border-b bg-navySecondary50",children:[n.jsx("h3",{className:"text-lg font-semibold text-gray-800",children:"Select File Name Titles"}),n.jsx("button",{onClick:r,className:"text-gray-500 hover:text-gray-800",children:n.jsx(Ht,{className:"w-5 h-5"})})]}),n.jsxs("div",{className:"flex-1 overflow-y-auto p-5 space-y-3",children:[t.length===0&&n.jsx("p",{className:"text-sm text-gray-500",children:"No sections available to include."}),t.map(b=>n.jsxs("label",{className:"flex items-center gap-3 border rounded-lg px-3 py-2 text-sm",children:[n.jsx("input",{type:"checkbox",className:"h-4 w-4 text-lpBlue",checked:c.includes(b.id),onChange:()=>u(b.id)}),n.jsx("span",{className:"text-gray-800",children:b.label||"[Untitled Section]"})]},b.id)),t.length>0&&n.jsx("button",{type:"button",className:"text-xs text-lpBlue hover:underline",onClick:p,children:"Select All"})]}),n.jsxs("div",{className:"flex justify-end gap-3 border-t px-5 py-4 bg-navySecondary50",children:[n.jsx("button",{onClick:r,className:"px-4 py-2 text-gray-600 hover:bg-navySecondary200 rounded-md",children:"Cancel"}),n.jsx("button",{onClick:y,className:"px-5 py-2 bg-lpBlue text-white rounded-md font-semibold hover:bg-blue-900",children:"Save"})]})]})})},Se=e=>(e||"").replace(/\u00A0/g," ").replace(/\s+/g,"").trim();var ma=1e9,kN={precision:20,rounding:4,toExpNeg:-7,toExpPos:21,LN10:"2.302585092994045684017991454684364207601101488628772976033327900967572609677352480235997205089598298341967784042286"},Vu,wt=!0,Hn="[DecimalError] ",xr=Hn+"Invalid argument: ",zu=Hn+"Exponent out of range: ",pa=Math.floor,ir=Math.pow,AN=/^(\d+(\.\d*)?|\.\d+)(e[+-]?\d+)?$/i,En,zt=1e7,bt=7,Sh=9007199254740991,ni=pa(Sh/bt),Ae={};Ae.absoluteValue=Ae.abs=function(){var e=new this.constructor(this);return e.s&&(e.s=1),e};Ae.comparedTo=Ae.cmp=function(e){var t,s,r,a,o=this;if(e=new o.constructor(e),o.s!==e.s)return o.s||-e.s;if(o.e!==e.e)return o.e>e.e^o.s<0?1:-1;for(r=o.d.length,a=e.d.length,t=0,s=r<a?r:a;t<s;++t)if(o.d[t]!==e.d[t])return o.d[t]>e.d[t]^o.s<0?1:-1;return r===a?0:r>a^o.s<0?1:-1};Ae.decimalPlaces=Ae.dp=function(){var e=this,t=e.d.length-1,s=(t-e.e)*bt;if(t=e.d[t],t)for(;t%10==0;t/=10)s--;return s<0?0:s};Ae.dividedBy=Ae.div=function(e){return js(this,new this.constructor(e))};Ae.dividedToIntegerBy=Ae.idiv=function(e){var t=this,s=t.constructor;return xt(js(t,new s(e),0,1),s.precision)};Ae.equals=Ae.eq=function(e){return!this.cmp(e)};Ae.exponent=function(){return Pt(this)};Ae.greaterThan=Ae.gt=function(e){return this.cmp(e)>0};Ae.greaterThanOrEqualTo=Ae.gte=function(e){return this.cmp(e)>=0};Ae.isInteger=Ae.isint=function(){return this.e>this.d.length-2};Ae.isNegative=Ae.isneg=function(){return this.s<0};Ae.isPositive=Ae.ispos=function(){return this.s>0};Ae.isZero=function(){return this.s===0};Ae.lessThan=Ae.lt=function(e){return this.cmp(e)<0};Ae.lessThanOrEqualTo=Ae.lte=function(e){return this.cmp(e)<1};Ae.logarithm=Ae.log=function(e){var t,s=this,r=s.constructor,a=r.precision,o=a+5;if(e===void 0)e=new r(10);else if(e=new r(e),e.s<1||e.eq(En))throw Error(Hn+"NaN");if(s.s<1)throw Error(Hn+(s.s?"NaN":"-Infinity"));return s.eq(En)?new r(0):(wt=!1,t=js(wo(s,o),wo(e,o),o),wt=!0,xt(t,a))};Ae.minus=Ae.sub=function(e){var t=this;return e=new t.constructor(e),t.s==e.s?Eh(t,e):wh(t,(e.s=-e.s,e))};Ae.modulo=Ae.mod=function(e){var t,s=this,r=s.constructor,a=r.precision;if(e=new r(e),!e.s)throw Error(Hn+"NaN");return s.s?(wt=!1,t=js(s,e,0,1).times(e),wt=!0,s.minus(t)):xt(new r(s),a)};Ae.naturalExponential=Ae.exp=function(){return jh(this)};Ae.naturalLogarithm=Ae.ln=function(){return wo(this)};Ae.negated=Ae.neg=function(){var e=new this.constructor(this);return e.s=-e.s||0,e};Ae.plus=Ae.add=function(e){var t=this;return e=new t.constructor(e),t.s==e.s?wh(t,e):Eh(t,(e.s=-e.s,e))};Ae.precision=Ae.sd=function(e){var t,s,r,a=this;if(e!==void 0&&e!==!!e&&e!==1&&e!==0)throw Error(xr+e);if(t=Pt(a)+1,r=a.d.length-1,s=r*bt+1,r=a.d[r],r){for(;r%10==0;r/=10)s--;for(r=a.d[0];r>=10;r/=10)s++}return e&&t>s?t:s};Ae.squareRoot=Ae.sqrt=function(){var e,t,s,r,a,o,l,c=this,i=c.constructor;if(c.s<1){if(!c.s)return new i(0);throw Error(Hn+"NaN")}for(e=Pt(c),wt=!1,a=Math.sqrt(+c),a==0||a==1/0?(t=cs(c.d),(t.length+e)%2==0&&(t+="0"),a=Math.sqrt(t),e=pa((e+1)/2)-(e<0||e%2),a==1/0?t="5e"+e:(t=a.toExponential(),t=t.slice(0,t.indexOf("e")+1)+e),r=new i(t)):r=new i(a.toString()),s=i.precision,a=l=s+3;;)if(o=r,r=o.plus(js(c,o,l+2)).times(.5),cs(o.d).slice(0,l)===(t=cs(r.d)).slice(0,l)){if(t=t.slice(l-3,l+1),a==l&&t=="4999"){if(xt(o,s+1,0),o.times(o).eq(c)){r=o;break}}else if(t!="9999")break;l+=4}return wt=!0,xt(r,s)};Ae.times=Ae.mul=function(e){var t,s,r,a,o,l,c,i,u,p=this,y=p.constructor,b=p.d,w=(e=new y(e)).d;if(!p.s||!e.s)return new y(0);for(e.s*=p.s,s=p.e+e.e,i=b.length,u=w.length,i<u&&(o=b,b=w,w=o,l=i,i=u,u=l),o=[],l=i+u,r=l;r--;)o.push(0);for(r=u;--r>=0;){for(t=0,a=i+r;a>r;)c=o[a]+w[r]*b[a-r-1]+t,o[a--]=c%zt|0,t=c/zt|0;o[a]=(o[a]+t)%zt|0}for(;!o[--l];)o.pop();return t?++s:o.shift(),e.d=o,e.e=s,wt?xt(e,y.precision):e};Ae.toDecimalPlaces=Ae.todp=function(e,t){var s=this,r=s.constructor;return s=new r(s),e===void 0?s:(ps(e,0,ma),t===void 0?t=r.rounding:ps(t,0,8),xt(s,e+Pt(s)+1,t))};Ae.toExponential=function(e,t){var s,r=this,a=r.constructor;return e===void 0?s=vr(r,!0):(ps(e,0,ma),t===void 0?t=a.rounding:ps(t,0,8),r=xt(new a(r),e+1,t),s=vr(r,!0,e+1)),s};Ae.toFixed=function(e,t){var s,r,a=this,o=a.constructor;return e===void 0?vr(a):(ps(e,0,ma),t===void 0?t=o.rounding:ps(t,0,8),r=xt(new o(a),e+Pt(a)+1,t),s=vr(r.abs(),!1,e+Pt(r)+1),a.isneg()&&!a.isZero()?"-"+s:s)};Ae.toInteger=Ae.toint=function(){var e=this,t=e.constructor;return xt(new t(e),Pt(e)+1,t.rounding)};Ae.toNumber=function(){return+this};Ae.toPower=Ae.pow=function(e){var t,s,r,a,o,l,c=this,i=c.constructor,u=12,p=+(e=new i(e));if(!e.s)return new i(En);if(c=new i(c),!c.s){if(e.s<1)throw Error(Hn+"Infinity");return c}if(c.eq(En))return c;if(r=i.precision,e.eq(En))return xt(c,r);if(t=e.e,s=e.d.length-1,l=t>=s,o=c.s,l){if((s=p<0?-p:p)<=Sh){for(a=new i(En),t=Math.ceil(r/bt+4),wt=!1;s%2&&(a=a.times(c),jp(a.d,t)),s=pa(s/2),s!==0;)c=c.times(c),jp(c.d,t);return wt=!0,e.s<0?new i(En).div(a):xt(a,r)}}else if(o<0)throw Error(Hn+"NaN");return o=o<0&&e.d[Math.max(t,s)]&1?-1:1,c.s=1,wt=!1,a=e.times(wo(c,r+u)),wt=!0,a=jh(a),a.s=o,a};Ae.toPrecision=function(e,t){var s,r,a=this,o=a.constructor;return e===void 0?(s=Pt(a),r=vr(a,s<=o.toExpNeg||s>=o.toExpPos)):(ps(e,1,ma),t===void 0?t=o.rounding:ps(t,0,8),a=xt(new o(a),e,t),s=Pt(a),r=vr(a,e<=s||s<=o.toExpNeg,e)),r};Ae.toSignificantDigits=Ae.tosd=function(e,t){var s=this,r=s.constructor;return e===void 0?(e=r.precision,t=r.rounding):(ps(e,1,ma),t===void 0?t=r.rounding:ps(t,0,8)),xt(new r(s),e,t)};Ae.toString=Ae.valueOf=Ae.val=Ae.toJSON=Ae[Symbol.for("nodejs.util.inspect.custom")]=function(){var e=this,t=Pt(e),s=e.constructor;return vr(e,t<=s.toExpNeg||t>=s.toExpPos)};function wh(e,t){var s,r,a,o,l,c,i,u,p=e.constructor,y=p.precision;if(!e.s||!t.s)return t.s||(t=new p(e)),wt?xt(t,y):t;if(i=e.d,u=t.d,l=e.e,a=t.e,i=i.slice(),o=l-a,o){for(o<0?(r=i,o=-o,c=u.length):(r=u,a=l,c=i.length),l=Math.ceil(y/bt),c=l>c?l+1:c+1,o>c&&(o=c,r.length=1),r.reverse();o--;)r.push(0);r.reverse()}for(c=i.length,o=u.length,c-o<0&&(o=c,r=u,u=i,i=r),s=0;o;)s=(i[--o]=i[o]+u[o]+s)/zt|0,i[o]%=zt;for(s&&(i.unshift(s),++a),c=i.length;i[--c]==0;)i.pop();return t.d=i,t.e=a,wt?xt(t,y):t}function ps(e,t,s){if(e!==~~e||e<t||e>s)throw Error(xr+e)}function cs(e){var t,s,r,a=e.length-1,o="",l=e[0];if(a>0){for(o+=l,t=1;t<a;t++)r=e[t]+"",s=bt-r.length,s&&(o+=Ms(s)),o+=r;l=e[t],r=l+"",s=bt-r.length,s&&(o+=Ms(s))}else if(l===0)return"0";for(;l%10===0;)l/=10;return o+l}var js=function(){function e(r,a){var o,l=0,c=r.length;for(r=r.slice();c--;)o=r[c]*a+l,r[c]=o%zt|0,l=o/zt|0;return l&&r.unshift(l),r}function t(r,a,o,l){var c,i;if(o!=l)i=o>l?1:-1;else for(c=i=0;c<o;c++)if(r[c]!=a[c]){i=r[c]>a[c]?1:-1;break}return i}function s(r,a,o){for(var l=0;o--;)r[o]-=l,l=r[o]<a[o]?1:0,r[o]=l*zt+r[o]-a[o];for(;!r[0]&&r.length>1;)r.shift()}return function(r,a,o,l){var c,i,u,p,y,b,w,R,E,W,N,h,S,P,U,V,X,te,G=r.constructor,ae=r.s==a.s?1:-1,j=r.d,F=a.d;if(!r.s)return new G(r);if(!a.s)throw Error(Hn+"Division by zero");for(i=r.e-a.e,X=F.length,U=j.length,w=new G(ae),R=w.d=[],u=0;F[u]==(j[u]||0);)++u;if(F[u]>(j[u]||0)&&--i,o==null?h=o=G.precision:l?h=o+(Pt(r)-Pt(a))+1:h=o,h<0)return new G(0);if(h=h/bt+2|0,u=0,X==1)for(p=0,F=F[0],h++;(u<U||p)&&h--;u++)S=p*zt+(j[u]||0),R[u]=S/F|0,p=S%F|0;else{for(p=zt/(F[0]+1)|0,p>1&&(F=e(F,p),j=e(j,p),X=F.length,U=j.length),P=X,E=j.slice(0,X),W=E.length;W<X;)E[W++]=0;te=F.slice(),te.unshift(0),V=F[0],F[1]>=zt/2&&++V;do p=0,c=t(F,E,X,W),c<0?(N=E[0],X!=W&&(N=N*zt+(E[1]||0)),p=N/V|0,p>1?(p>=zt&&(p=zt-1),y=e(F,p),b=y.length,W=E.length,c=t(y,E,b,W),c==1&&(p--,s(y,X<b?te:F,b))):(p==0&&(c=p=1),y=F.slice()),b=y.length,b<W&&y.unshift(0),s(E,y,W),c==-1&&(W=E.length,c=t(F,E,X,W),c<1&&(p++,s(E,X<W?te:F,W))),W=E.length):c===0&&(p++,E=[0]),R[u++]=p,c&&E[0]?E[W++]=j[P]||0:(E=[j[P]],W=1);while((P++<U||E[0]!==void 0)&&h--)}return R[0]||R.shift(),w.e=i,xt(w,l?o+Pt(w)+1:o)}}();function jh(e,t){var s,r,a,o,l,c,i=0,u=0,p=e.constructor,y=p.precision;if(Pt(e)>16)throw Error(zu+Pt(e));if(!e.s)return new p(En);for(wt=!1,c=y,l=new p(.03125);e.abs().gte(.1);)e=e.times(l),u+=5;for(r=Math.log(ir(2,u))/Math.LN10*2+5|0,c+=r,s=a=o=new p(En),p.precision=c;;){if(a=xt(a.times(e),c),s=s.times(++i),l=o.plus(js(a,s,c)),cs(l.d).slice(0,c)===cs(o.d).slice(0,c)){for(;u--;)o=xt(o.times(o),c);return p.precision=y,t==null?(wt=!0,xt(o,y)):o}o=l}}function Pt(e){for(var t=e.e*bt,s=e.d[0];s>=10;s/=10)t++;return t}function kc(e,t,s){if(t>e.LN10.sd())throw wt=!0,s&&(e.precision=s),Error(Hn+"LN10 precision limit exceeded");return xt(new e(e.LN10),t)}function Ms(e){for(var t="";e--;)t+="0";return t}function wo(e,t){var s,r,a,o,l,c,i,u,p,y=1,b=10,w=e,R=w.d,E=w.constructor,W=E.precision;if(w.s<1)throw Error(Hn+(w.s?"NaN":"-Infinity"));if(w.eq(En))return new E(0);if(t==null?(wt=!1,u=W):u=t,w.eq(10))return t==null&&(wt=!0),kc(E,u);if(u+=b,E.precision=u,s=cs(R),r=s.charAt(0),o=Pt(w),Math.abs(o)<15e14){for(;r<7&&r!=1||r==1&&s.charAt(1)>3;)w=w.times(e),s=cs(w.d),r=s.charAt(0),y++;o=Pt(w),r>1?(w=new E("0."+s),o++):w=new E(r+"."+s.slice(1))}else return i=kc(E,u+2,W).times(o+""),w=wo(new E(r+"."+s.slice(1)),u-b).plus(i),E.precision=W,t==null?(wt=!0,xt(w,W)):w;for(c=l=w=js(w.minus(En),w.plus(En),u),p=xt(w.times(w),u),a=3;;){if(l=xt(l.times(p),u),i=c.plus(js(l,new E(a),u)),cs(i.d).slice(0,u)===cs(c.d).slice(0,u))return c=c.times(2),o!==0&&(c=c.plus(kc(E,u+2,W).times(o+""))),c=js(c,new E(y),u),E.precision=W,t==null?(wt=!0,xt(c,W)):c;c=i,a+=2}}function wp(e,t){var s,r,a;for((s=t.indexOf("."))>-1&&(t=t.replace(".","")),(r=t.search(/e/i))>0?(s<0&&(s=r),s+=+t.slice(r+1),t=t.substring(0,r)):s<0&&(s=t.length),r=0;t.charCodeAt(r)===48;)++r;for(a=t.length;t.charCodeAt(a-1)===48;)--a;if(t=t.slice(r,a),t){if(a-=r,s=s-r-1,e.e=pa(s/bt),e.d=[],r=(s+1)%bt,s<0&&(r+=bt),r<a){for(r&&e.d.push(+t.slice(0,r)),a-=bt;r<a;)e.d.push(+t.slice(r,r+=bt));t=t.slice(r),r=bt-t.length}else r-=a;for(;r--;)t+="0";if(e.d.push(+t),wt&&(e.e>ni||e.e<-ni))throw Error(zu+s)}else e.s=0,e.e=0,e.d=[0];return e}function xt(e,t,s){var r,a,o,l,c,i,u,p,y=e.d;for(l=1,o=y[0];o>=10;o/=10)l++;if(r=t-l,r<0)r+=bt,a=t,u=y[p=0];else{if(p=Math.ceil((r+1)/bt),o=y.length,p>=o)return e;for(u=o=y[p],l=1;o>=10;o/=10)l++;r%=bt,a=r-bt+l}if(s!==void 0&&(o=ir(10,l-a-1),c=u/o%10|0,i=t<0||y[p+1]!==void 0||u%o,i=s<4?(c||i)&&(s==0||s==(e.s<0?3:2)):c>5||c==5&&(s==4||i||s==6&&(r>0?a>0?u/ir(10,l-a):0:y[p-1])%10&1||s==(e.s<0?8:7))),t<1||!y[0])return i?(o=Pt(e),y.length=1,t=t-o-1,y[0]=ir(10,(bt-t%bt)%bt),e.e=pa(-t/bt)||0):(y.length=1,y[0]=e.e=e.s=0),e;if(r==0?(y.length=p,o=1,p--):(y.length=p+1,o=ir(10,bt-r),y[p]=a>0?(u/ir(10,l-a)%ir(10,a)|0)*o:0),i)for(;;)if(p==0){(y[0]+=o)==zt&&(y[0]=1,++e.e);break}else{if(y[p]+=o,y[p]!=zt)break;y[p--]=0,o=1}for(r=y.length;y[--r]===0;)y.pop();if(wt&&(e.e>ni||e.e<-ni))throw Error(zu+Pt(e));return e}function Eh(e,t){var s,r,a,o,l,c,i,u,p,y,b=e.constructor,w=b.precision;if(!e.s||!t.s)return t.s?t.s=-t.s:t=new b(e),wt?xt(t,w):t;if(i=e.d,y=t.d,r=t.e,u=e.e,i=i.slice(),l=u-r,l){for(p=l<0,p?(s=i,l=-l,c=y.length):(s=y,r=u,c=i.length),a=Math.max(Math.ceil(w/bt),c)+2,l>a&&(l=a,s.length=1),s.reverse(),a=l;a--;)s.push(0);s.reverse()}else{for(a=i.length,c=y.length,p=a<c,p&&(c=a),a=0;a<c;a++)if(i[a]!=y[a]){p=i[a]<y[a];break}l=0}for(p&&(s=i,i=y,y=s,t.s=-t.s),c=i.length,a=y.length-c;a>0;--a)i[c++]=0;for(a=y.length;a>l;){if(i[--a]<y[a]){for(o=a;o&&i[--o]===0;)i[o]=zt-1;--i[o],i[a]+=zt}i[a]-=y[a]}for(;i[--c]===0;)i.pop();for(;i[0]===0;i.shift())--r;return i[0]?(t.d=i,t.e=r,wt?xt(t,w):t):new b(0)}function vr(e,t,s){var r,a=Pt(e),o=cs(e.d),l=o.length;return t?(s&&(r=s-l)>0?o=o.charAt(0)+"."+o.slice(1)+Ms(r):l>1&&(o=o.charAt(0)+"."+o.slice(1)),o=o+(a<0?"e":"e+")+a):a<0?(o="0."+Ms(-a-1)+o,s&&(r=s-l)>0&&(o+=Ms(r))):a>=l?(o+=Ms(a+1-l),s&&(r=s-a-1)>0&&(o=o+"."+Ms(r))):((r=a+1)<l&&(o=o.slice(0,r)+"."+o.slice(r)),s&&(r=s-l)>0&&(a+1===l&&(o+="."),o+=Ms(r))),e.s<0?"-"+o:o}function jp(e,t){if(e.length>t)return e.length=t,!0}function kh(e){var t,s,r;function a(o){var l=this;if(!(l instanceof a))return new a(o);if(l.constructor=a,o instanceof a){l.s=o.s,l.e=o.e,l.d=(o=o.d)?o.slice():o;return}if(typeof o=="number"){if(o*0!==0)throw Error(xr+o);if(o>0)l.s=1;else if(o<0)o=-o,l.s=-1;else{l.s=0,l.e=0,l.d=[0];return}if(o===~~o&&o<1e7){l.e=0,l.d=[o];return}return wp(l,o.toString())}else if(typeof o!="string")throw Error(xr+o);if(o.charCodeAt(0)===45?(o=o.slice(1),l.s=-1):l.s=1,AN.test(o))wp(l,o);else throw Error(xr+o)}if(a.prototype=Ae,a.ROUND_UP=0,a.ROUND_DOWN=1,a.ROUND_CEIL=2,a.ROUND_FLOOR=3,a.ROUND_HALF_UP=4,a.ROUND_HALF_DOWN=5,a.ROUND_HALF_EVEN=6,a.ROUND_HALF_CEIL=7,a.ROUND_HALF_FLOOR=8,a.clone=kh,a.config=a.set=IN,e===void 0&&(e={}),e)for(r=["precision","rounding","toExpNeg","toExpPos","LN10"],t=0;t<r.length;)e.hasOwnProperty(s=r[t++])||(e[s]=this[s]);return a.config(e),a}function IN(e){if(!e||typeof e!="object")throw Error(Hn+"Object expected");var t,s,r,a=["precision",1,ma,"rounding",0,8,"toExpNeg",-1/0,0,"toExpPos",0,1/0];for(t=0;t<a.length;t+=3)if((r=e[s=a[t]])!==void 0)if(pa(r)===r&&r>=a[t+1]&&r<=a[t+2])this[s]=r;else throw Error(xr+s+": "+r);if((r=e[s="LN10"])!==void 0)if(r==Math.LN10)this[s]=new this(r);else throw Error(xr+s+": "+r);return this}var Vu=kh(kN);En=new Vu(1);const ys=Vu;ys.set({precision:20,rounding:ys.ROUND_HALF_UP});const Jn=e=>new ys(e??0),Ns=e=>e.toDecimalPlaces(2).toNumber(),Ah=(e,t)=>{const s=Jn(e),r=Jn(t);return Ns(s.mul(r))},Ih=(e,t)=>{const s=Jn(e),r=Jn(t).div(100);return Ns(s.mul(r))},Th=(e,t)=>{const s=Jn(e),r=Jn(t);return Ns(s.add(r))},Ac=e=>{if(e.lineTotalAmount!=null)return Jn(e.lineTotalAmount);const t=e.lineNetAmount!=null?e.lineNetAmount:Ah(e.quantity??0,e.unitPrice??0),s=e.lineVatAmount!=null?e.lineVatAmount:Ih(t,e.vatRate??0);return Jn(Th(t,s))},Fn=(e,t)=>{const s=t.reduce((w,R)=>w.add(Ac(R)),new ys(0)),r=t.reduce((w,R)=>R.isIncludedInRequestedAmount===!1?w:w.add(Ac(R)),new ys(0)),a=t.reduce((w,R)=>R.lineVatAmount==null?w:w.add(Jn(R.lineVatAmount)),new ys(0)),l=t.filter(w=>(w.kind==="ADJUSTMENT"||w.kind==="COMPENSATION")&&w.isIncludedInRequestedAmount===!1).reduce((w,R)=>w.add(Ac(R)),new ys(0)),c=Jn(e.deductibleAmount??0),i=Jn(e.alreadyPaidAmount??0),u=c.add(i).add(l),p=r.sub(u),y=!!e.infoOnly,b=y?new ys(0):p.greaterThan(0)?p:new ys(0);return{grossExpensesTotal:Ns(s),includedExpensesTotal:Ns(r),vatTotal:Ns(a),adjustmentsTotal:Ns(u),amountBeforeInfoOnly:Ns(p),amountToRequest:Ns(b),infoOnlyApplied:y}},Rh="financial_expenses_store_v1",il=()=>({sheets:{},lineItems:{},attachments:{},auditEvents:{},insurerRulesets:{},exceptionAnnotations:{},payments:{},officialSheetIdByCaseId:{}}),TN=e=>{let t=e.officialSheetIdByCaseId;if(t&&Object.keys(t).length>0)return e;t={};const s=Object.values(e.sheets),r=new Map;return s.forEach(a=>{const o=Se(a.caseId);if(!o)return;const l=r.get(o),c=new Date(a.updatedAt||a.createdAt).getTime();(!l||new Date(l.updatedAt||l.createdAt).getTime()<c)&&r.set(o,a)}),r.forEach((a,o)=>{t[o]=a.id}),{...e,officialSheetIdByCaseId:t}},gt=()=>{if(typeof window>"u")return il();try{const e=window.localStorage.getItem(Rh);if(!e)return il();const t=JSON.parse(e);if(!t||typeof t!="object")return il();let s={sheets:t.sheets||{},lineItems:t.lineItems||{},attachments:t.attachments||{},auditEvents:t.auditEvents||{},insurerRulesets:t.insurerRulesets||{},exceptionAnnotations:t.exceptionAnnotations||{},payments:t.payments||{},officialSheetIdByCaseId:t.officialSheetIdByCaseId||{}};return s=TN(s),(!t.officialSheetIdByCaseId||Object.keys(t.officialSheetIdByCaseId||{}).length===0)&&Object.keys(s.officialSheetIdByCaseId||{}).length>0&&cn(s),s}catch(e){return console.error("Failed to load financial expenses store",e),il()}},cn=e=>{if(!(typeof window>"u"))try{window.localStorage.setItem(Rh,JSON.stringify(e))}catch(t){console.error("Failed to persist financial expenses store",t)}},RN=e=>{let t=0;for(let s=0;s<e.length;s++)t=(t<<5)-t+e.charCodeAt(s),t|=0;return Math.abs(t).toString(16)},CN=(e,t,s)=>{const r={sheet:e,lineItems:t.map(a=>({id:a.id,sheetId:a.sheetId,kind:a.kind,expenseType:a.expenseType,providerName:a.providerName,description:a.description,date:a.date,quantity:a.quantity,unitPrice:a.unitPrice,vatRate:a.vatRate,isIncludedInRequestedAmount:a.isIncludedInRequestedAmount,lineNetAmount:a.lineNetAmount,lineVatAmount:a.lineVatAmount,lineTotalAmount:a.lineTotalAmount,attachmentId:a.attachmentId})),attachments:s.map(a=>({id:a.id,sheetId:a.sheetId,fileKey:a.fileKey,originalFileName:a.originalFileName,mimeType:a.mimeType,sizeBytes:a.sizeBytes,linkedLineItemId:a.linkedLineItemId}))};return RN(JSON.stringify(r))},wn=()=>new Date().toISOString(),fa=e=>`${e}_${Math.random().toString(36).slice(2,10)}_${Date.now().toString(36)}`,jo=(e,t)=>{const s=Object.values(e.lineItems).filter(a=>a.sheetId===t),r=Object.values(e.attachments).filter(a=>a.sheetId===t);return{lineItems:s,attachments:r}},DN=e=>{const t=gt(),s=Se(e);return Object.values(t.payments).filter(r=>!r.isDeleted&&Se(r.caseId)===s).sort((r,a)=>{const o=new Date(r.paidAt).getTime(),l=new Date(a.paidAt).getTime();return o-l})},LN=e=>{let t=gt();const s=fa("fpay"),r=wn(),a={id:s,caseId:Se(e.caseId),sheetId:e.sheetId??null,amount:e.amount,paidAt:e.paidAt,reference:e.reference??null,note:e.note??null,isDeleted:!1,createdAt:r,updatedAt:r};return t={...t,payments:{...t.payments,[s]:a}},cn(t),a},_N=e=>{let t=gt();const s=t.payments[e];if(!s)return null;const r={...s,isDeleted:!0,updatedAt:wn()};return t={...t,payments:{...t.payments,[e]:r}},cn(t),r},Ep=(e,t,s)=>{const r=gt(),a=Se(e);if(!a)return s??0;const o=t?new Date(t).getTime():Date.now();if(Number.isNaN(o))return s??0;let l=0,c=!1;return Object.values(r.payments).forEach(i=>{if(i.isDeleted||Se(i.caseId)!==a)return;c=!0;const u=new Date(i.paidAt).getTime();if(Number.isNaN(u)||u>o)return;const p=Number(i.amount)||0;p<=0||(l+=p)}),c?l:s??0},ON=e=>gt().insurerRulesets[e]||null,Ic=()=>{const e=gt();return Object.values(e.sheets).sort((t,s)=>{const r=new Date(t.updatedAt||t.createdAt).getTime();return new Date(s.updatedAt||s.createdAt).getTime()-r})},MN=(e,t,s,r)=>{let a=gt();a.sheets[e]&&(a=Zn(a,e,t,s,"SHEET_DELETED_BY_ADMIN","SHEET",e,{reason:r.trim()}),cn(a))},PN=(e,t,s,r)=>{let a=gt();a.sheets[e]&&(a=Zn(a,e,t,s,"ADMIN_EDIT_AFTER_PAID","SHEET",e,{reason:r.trim()}),cn(a))},Xa=e=>{var a;const t=gt(),s=Se(e);if(!s)return null;const r=(a=t.officialSheetIdByCaseId)==null?void 0:a[s];return!r||!t.sheets[r]?null:r},cl=e=>{const t=gt(),s=t.sheets[e];if(!s)return null;const{lineItems:r,attachments:a}=jo(t,e);return{sheet:s,lineItems:r,attachments:a}},Rs=(e,t)=>{const s=e.sheets[t];if(!s)return e;const{lineItems:r,attachments:a}=jo(e,t),o={...s,sheetVersionNumber:s.sheetVersionNumber+1,sheetVersionHash:CN(s,r,a),updatedAt:wn()};return{...e,sheets:{...e.sheets,[t]:o}}},Zn=(e,t,s,r,a,o,l,c)=>{const i=e.sheets[t];if(!i)return e;const u=fa("fae"),p={id:u,sheetId:t,actorUserId:s,actorRole:r,eventType:a,eventAt:wn(),entityType:o,entityId:l??null,diffJson:c,sheetVersionNumberAtEvent:i.sheetVersionNumber,sheetVersionHashAtEvent:i.sheetVersionHash};return{...e,auditEvents:{...e.auditEvents,[u]:p}}},FN=e=>{const t=gt(),s=fa("fes"),r=wn(),a={id:s,caseId:e.caseId,insurerId:e.insurerId??null,insurerName:e.insurerName??null,periodStart:e.periodStart??null,periodEnd:e.periodEnd??null,periodLabel:e.periodLabel??null,versionIndex:e.versionIndex,status:"DRAFT",archivedReason:null,currency:e.currency||"ILS",deductibleAmount:e.deductibleAmount??null,alreadyPaidAmount:e.alreadyPaidAmount??null,infoOnly:!!e.infoOnly,attachedToReportId:null,attachedAt:null,createdByUserId:e.createdByUserId,createdAt:r,updatedAt:r,readyAt:null,sheetVersionNumber:1,sheetVersionHash:"",insurerRulesetId:e.insurerRulesetId??null,insurerRulesetVersion:e.insurerRulesetVersion??null};let o={...t,sheets:{...t.sheets,[s]:a}};const l=Se(e.caseId);return l&&(o={...o,officialSheetIdByCaseId:{...o.officialSheetIdByCaseId||{},[l]:s}}),o=Rs(o,s),o=Zn(o,s,e.createdByUserId,"FINANCE","SHEET_CREATED","SHEET",s,{caseId:e.caseId,insurerId:e.insurerId??null,insurerName:e.insurerName??null}),cn(o),o.sheets[s]},BN=e=>{let t=gt();const s=t.sheets[e];if(!s)return console.warn("deleteFinancialExpenseSheet: sheet not found",e),t;const r={...t.sheets};delete r[e];const a={};Object.values(t.lineItems).forEach(i=>{i.sheetId!==e&&(a[i.id]=i)});const o={};Object.values(t.attachments).forEach(i=>{i.sheetId!==e&&(o[i.id]=i)});let l={...t.officialSheetIdByCaseId||{}};const c=Se(s.caseId);if(c&&l[c]===e){const i=Object.values(r).filter(u=>Se(u.caseId)===c).sort((u,p)=>{const y=new Date(u.updatedAt||u.createdAt).getTime();return new Date(p.updatedAt||p.createdAt).getTime()-y});i.length>0?l[c]=i[0].id:delete l[c]}return t={...t,sheets:r,lineItems:a,attachments:o,officialSheetIdByCaseId:l},cn(t),t},$N=e=>{let t=gt();const s=t.sheets[e.sheetId];if(!s)return console.warn("updateFinancialExpenseSheetMeta: sheet not found",e.sheetId),null;const r={...s,...e.patch,updatedAt:wn()};t={...t,sheets:{...t.sheets,[e.sheetId]:r}};const a={};return Object.keys(e.patch).forEach(o=>{const l=s[o],c=r[o];l!==c&&(a[o]={before:l,after:c})}),t=Rs(t,e.sheetId),t=Zn(t,e.sheetId,e.actorUserId,e.actorRole,"SHEET_META_UPDATED","SHEET",e.sheetId,Object.keys(a).length?a:void 0),cn(t),t.sheets[e.sheetId]},HN=e=>{let t=gt();if(!t.sheets[e.sheetId])return console.warn("addFinancialExpenseLineItem: sheet not found",e.sheetId),null;const s=fa("fli"),r=wn(),a={id:s,sheetId:e.sheetId,kind:e.kind,expenseType:e.expenseType??null,providerName:e.providerName??null,providerId:e.providerId??null,description:e.description,date:e.date??null,quantity:e.quantity??null,unitPrice:e.unitPrice??null,vatRate:e.vatRate??null,isIncludedInRequestedAmount:e.isIncludedInRequestedAmount??!0,lineNetAmount:e.lineNetAmount??null,lineVatAmount:e.lineVatAmount??null,lineTotalAmount:e.lineTotalAmount??null,attachmentId:e.attachmentId??null,createdAt:r,updatedAt:r};return t={...t,lineItems:{...t.lineItems,[s]:a}},t=Rs(t,e.sheetId),t=Zn(t,e.sheetId,e.actorUserId,e.actorRole,"LINE_ITEM_CREATED","LINE_ITEM",s,{kind:e.kind,description:e.description,amount:e.lineTotalAmount??null}),cn(t),a},UN=e=>{let t=gt();const s=t.lineItems[e.lineItemId];if(!s||s.sheetId!==e.sheetId)return console.warn("updateFinancialExpenseLineItem: line item not found",e.lineItemId),null;const r={...s,...e.patch,updatedAt:wn()};t={...t,lineItems:{...t.lineItems,[e.lineItemId]:r}};const a={};return Object.keys(e.patch).forEach(o=>{const l=s[o],c=r[o];l!==c&&(a[o]={before:l,after:c})}),t=Rs(t,e.sheetId),t=Zn(t,e.sheetId,e.actorUserId,e.actorRole,"LINE_ITEM_UPDATED","LINE_ITEM",e.lineItemId,Object.keys(a).length?a:void 0),cn(t),t.lineItems[e.lineItemId]},WN=e=>{let t=gt();const s=t.lineItems[e.lineItemId];if(!s||s.sheetId!==e.sheetId)return console.warn("deleteFinancialExpenseLineItem: line item not found",e.lineItemId),!1;const{[e.lineItemId]:r,...a}=t.lineItems;return t={...t,lineItems:a},t=Rs(t,e.sheetId),t=Zn(t,e.sheetId,e.actorUserId,e.actorRole,"LINE_ITEM_DELETED","LINE_ITEM",e.lineItemId,{deleted:r}),cn(t),!0},zN=e=>{let t=gt();if(!t.sheets[e.sheetId])return console.warn("addFinancialExpenseAttachment: sheet not found",e.sheetId),null;const s=fa("fat"),r=wn(),a={id:s,sheetId:e.sheetId,fileKey:e.fileKey,originalFileName:e.originalFileName,mimeType:e.mimeType??null,sizeBytes:e.sizeBytes??null,uploadedByUserId:e.uploadedByUserId,uploadedAt:r,linkedLineItemId:e.linkedLineItemId??null};return t={...t,attachments:{...t.attachments,[s]:a}},t=Rs(t,e.sheetId),t=Zn(t,e.sheetId,e.uploadedByUserId,"FINANCE","ATTACHMENT_ADDED","ATTACHMENT",s,{fileKey:e.fileKey,originalFileName:e.originalFileName}),cn(t),a},VN=e=>{let t=gt();const s=t.attachments[e.attachmentId];if(!s||s.sheetId!==e.sheetId)return console.warn("linkAttachmentToLineItem: attachment not found",e.attachmentId),null;const r=s.linkedLineItemId??null,a={...s,linkedLineItemId:e.lineItemId};if(t={...t,attachments:{...t.attachments,[e.attachmentId]:a}},e.lineItemId){const o=t.lineItems[e.lineItemId];o&&(t={...t,lineItems:{...t.lineItems,[e.lineItemId]:{...o,attachmentId:e.attachmentId,updatedAt:wn()}}})}else if(r){const o=t.lineItems[r];o&&o.attachmentId===e.attachmentId&&(t={...t,lineItems:{...t.lineItems,[r]:{...o,attachmentId:null,updatedAt:wn()}}})}return t=Rs(t,e.sheetId),t=Zn(t,e.sheetId,e.actorUserId,e.actorRole,"ATTACHMENT_LINKED","ATTACHMENT",e.attachmentId,{before:r,after:e.lineItemId}),cn(t),t.attachments[e.attachmentId]},KN=e=>{let t=gt();const s=t.sheets[e.sheetId];if(!s)return console.warn("recordSheetReadyAttempt: sheet not found",e.sheetId),null;let r=s;if(e.success){const a=wn();r={...s,status:"READY_FOR_REPORT",readyAt:a,updatedAt:a,insurerRulesetId:e.decisionLog.rulesetId??s.insurerRulesetId??null,insurerRulesetVersion:e.decisionLog.rulesetVersion??s.insurerRulesetVersion??null},t={...t,sheets:{...t.sheets,[e.sheetId]:r}},t=Rs(t,e.sheetId)}return t=Zn(t,e.sheetId,e.actorUserId,e.actorRole,"SHEET_READY_ATTEMPT","SHEET",e.sheetId,{success:e.success,decisionLog:e.decisionLog}),cn(t),t.sheets[e.sheetId]},YN=e=>{let t=gt();const s=t.sheets[e.sheetId];if(!s||s.status!=="READY_FOR_REPORT")return s||null;const r=wn(),a={...s,status:"DRAFT",readyAt:null,updatedAt:r};return t={...t,sheets:{...t.sheets,[e.sheetId]:a}},t=Rs(t,e.sheetId),t=Zn(t,e.sheetId,e.actorUserId,e.actorRole,"SHEET_REVERTED_TO_DRAFT","SHEET",e.sheetId,{from:"READY_FOR_REPORT",to:"DRAFT"}),cn(t),t.sheets[e.sheetId]},GN=(e,t)=>{const s=gt(),r=Object.values(s.sheets),a=new Map;t.forEach(c=>{a.set(c.id,c)});const o=r.map(c=>{var E,W;const{lineItems:i}=jo(s,c.id),u=Fn(c,i),p=c.attachedToReportId?a.get(c.attachedToReportId):void 0,y=Object.values(s.auditEvents).filter(N=>N.sheetId===c.id&&N.diffJson&&N.diffJson.decisionLog);y.sort((N,h)=>new Date(h.eventAt).getTime()-new Date(N.eventAt).getTime());const b=((W=(E=y[0])==null?void 0:E.diffJson)==null?void 0:W.decisionLog)||null,w=b!=null&&b.blockingIssueCodes&&Array.isArray(b.blockingIssueCodes)?b.blockingIssueCodes:void 0,R=(p==null?void 0:p.expensesSheetId)===c.id?!!p.expensesOutOfSync:!1;return{sheetId:c.id,caseId:c.caseId,insurerName:c.insurerName??null,status:c.status,versionIndex:c.versionIndex,updatedAt:c.updatedAt,readyAt:c.readyAt??null,attachedAt:c.attachedAt??null,sentAt:(p==null?void 0:p.sentAt)||null,amountToRequest:u.amountToRequest,infoOnly:c.infoOnly,expensesOutOfSync:R,blockingIssueCodesLatest:w}}),l=c=>{if(!c)return!1;const i=new Date(c).getTime();return!(Number.isNaN(i)||e.dateFrom&&i<new Date(e.dateFrom).getTime()||e.dateTo&&i>new Date(e.dateTo).getTime())};return o.filter(c=>{var i,u;if(e.status&&c.status!==e.status||e.insurerId&&((i=s.sheets[c.sheetId])==null?void 0:i.insurerId)!==e.insurerId||e.insurerName&&!(c.insurerName||"").toLowerCase().includes(e.insurerName.toLowerCase()))return!1;if(e.caseIdOrSearch){const p=e.caseIdOrSearch.toLowerCase();if(!`${c.caseId} ${c.insurerName||""}`.toLowerCase().includes(p))return!1}return!(e.isInfoOnly!=null&&c.infoOnly!==e.isInfoOnly||e.minAmountToRequest!=null&&c.amountToRequest<e.minAmountToRequest||e.maxAmountToRequest!=null&&c.amountToRequest>e.maxAmountToRequest||(e.dateFrom||e.dateTo)&&!l(c.updatedAt)||e.hasMissingAttachments&&!((u=c.blockingIssueCodesLatest)!=null&&u.includes("MISSING_ATTACHMENT_REQUIRED")))}).sort((c,i)=>new Date(i.updatedAt).getTime()-new Date(c.updatedAt).getTime())},qN=e=>{const t=gt(),s=Object.values(t.sheets),r=new Map;e.forEach(i=>{r.set(i.id,i)});let a=0,o=0,l=0,c=0;return s.forEach(i=>{i.status==="READY_FOR_REPORT"&&(a+=1),i.status==="ATTACHED_TO_REPORT"&&(o+=1);const u=i.attachedToReportId?r.get(i.attachedToReportId):void 0;(u==null?void 0:u.status)==="SENT"&&(l+=1);const p=(u==null?void 0:u.expensesSheetId)===i.id&&u.expensesOutOfSync===!0,y=Object.values(t.auditEvents).some(b=>{var w;return b.sheetId===i.id&&b.eventType==="SHEET_READY_ATTEMPT"&&((w=b.diffJson)==null?void 0:w.success)===!1});(p||y)&&(c+=1)}),{readyCount:a,attachedCount:o,sentCount:l,exceptionsCount:c}},Tc=(e,t)=>{if(!e||!t)return null;const s=new Date(e).getTime(),r=new Date(t).getTime();return Number.isNaN(s)||Number.isNaN(r)?null:(r-s)/(1e3*60*60)},Rc=e=>e.length?e.reduce((s,r)=>s+r,0)/e.length:null,Cc=e=>{if(!e.length)return null;const t=[...e].sort((r,a)=>r-a),s=Math.floor(t.length/2);return t.length%2===0?(t[s-1]+t[s])/2:t[s]},dl=(e,t=5)=>({count:e.length,samples:e.slice(0,t)}),XN=e=>{let t=gt();const s=fa("fexa"),r=wn(),a={id:s,sheetId:e.sheetId,noteType:"EXCEPTION_STATUS",value:e.value,actorUserId:e.actorUserId,createdAt:r};return t={...t,exceptionAnnotations:{...t.exceptionAnnotations,[s]:a}},cn(t),a},JN=e=>{const t=gt(),s=Object.values(t.exceptionAnnotations).filter(r=>r.sheetId===e&&r.noteType==="EXCEPTION_STATUS");return s.length?(s.sort((r,a)=>new Date(a.createdAt).getTime()-new Date(r.createdAt).getTime()),s[0].value):null},QN=e=>{const t=gt(),s=Object.values(t.sheets),r=new Map;e.forEach(G=>{r.set(G.id,G)});const a=[],o=[],l=[];let c=0,i=0;const u=[],p=[],y=[],b=[],w=3,R=3,E=Date.now(),W=new Map;Object.values(t.auditEvents).forEach(G=>{const ae=W.get(G.sheetId)||[];ae.push(G),W.set(G.sheetId,ae)});const N=[];s.forEach(G=>{const{lineItems:ae}=jo(t,G.id),j=Fn(G,ae);if(c+=j.amountToRequest,G.infoOnly&&(i+=1),G.createdAt&&G.readyAt){const L=Tc(G.createdAt,G.readyAt);L!=null&&a.push(L)}if(G.readyAt&&G.attachedAt){const L=Tc(G.readyAt,G.attachedAt);L!=null&&o.push(L)}const F=G.attachedToReportId?r.get(G.attachedToReportId):void 0;if(G.attachedAt&&(F!=null&&F.sentAt)){const L=Tc(G.attachedAt,F.sentAt);L!=null&&l.push(L)}j.amountToRequest>0&&N.push(j.amountToRequest)});let h=0;if(N.length>=5){const G=[...N].sort((j,F)=>j-F),ae=Math.floor(G.length*.95)-1;h=G[Math.max(0,ae)]}else N.length>0&&(h=Math.max(...N));s.forEach(G=>{var ue,ce;const{lineItems:ae}=jo(t,G.id),j=Fn(G,ae),F=G.attachedToReportId?r.get(G.attachedToReportId):void 0,L=W.get(G.id)||[],O=L.filter(le=>le.diffJson&&le.diffJson.decisionLog);O.sort((le,fe)=>new Date(fe.eventAt).getTime()-new Date(le.eventAt).getTime());const H=((ce=(ue=O[0])==null?void 0:ue.diffJson)==null?void 0:ce.decisionLog)||null,M=H!=null&&H.blockingIssueCodes&&Array.isArray(H.blockingIssueCodes)?H.blockingIssueCodes:[];if((F==null?void 0:F.expensesSheetId)===G.id&&F.expensesOutOfSync===!0){const le=new Date(G.updatedAt||G.createdAt).getTime();Number.isNaN(le)||(E-le)/864e5>=w&&u.push({sheetId:G.id,caseId:G.caseId,reason:"DIVERGENCE_OLD",updatedAt:G.updatedAt})}(G.status==="READY_FOR_REPORT"||G.status==="ATTACHED_TO_REPORT")&&M.includes("MISSING_ATTACHMENT_REQUIRED")&&j.amountToRequest>0&&p.push({sheetId:G.id,caseId:G.caseId,reason:"MISSING_ATTACHMENTS",updatedAt:G.updatedAt}),h>0&&j.amountToRequest>=h&&y.push({sheetId:G.id,caseId:G.caseId,reason:"HIGH_AMOUNT",updatedAt:G.updatedAt,amountToRequest:j.amountToRequest});const J=L.filter(le=>{var fe;return le.eventType==="SHEET_READY_ATTEMPT"&&((fe=le.diffJson)==null?void 0:fe.success)===!1}).length;J>=R&&b.push({sheetId:G.id,caseId:G.caseId,reason:"REPEATED_BLOCKS",failedAttempts:J,updatedAt:G.updatedAt})});const S=s.length,P=s.filter(G=>{const ae=G.attachedToReportId?r.get(G.attachedToReportId):void 0;return(ae==null?void 0:ae.status)==="SENT"}).length,U=S>0?Number((i/S).toFixed(3)):null,V={draftToReadyAvgHours:Rc(a),draftToReadyMedianHours:Cc(a),readyToAttachedAvgHours:Rc(o),readyToAttachedMedianHours:Cc(o),attachedToSentAvgHours:Rc(l),attachedToSentMedianHours:Cc(l)},X={totalSheets:S,totalSentReports:P,totalAmountRequested:c,infoOnlyRatio:U},te={divergenceOld:dl(u),missingAttachments:dl(p),highAmounts:{threshold:h,...dl(y)},repeatedBlocks:{threshold:R,...dl(b)}};return{sla:V,volumes:X,exceptions:te}},ZN=(e,t=10)=>{const s=gt();return Object.values(s.auditEvents).filter(r=>r.sheetId===e).sort((r,a)=>new Date(a.eventAt).getTime()-new Date(r.eventAt).getTime()).slice(0,t)},eb=5e3,Dc=new Map,La=e=>({actorUserId:e.id,actorRole:e.role}),Xe={async listSheets(){return Ic()},async listPaymentsForCase(e){return DN(e)},getPaidToDateForSheet(e){const t=e.updatedAt||e.createdAt||new Date().toISOString();return Ep(e.caseId,t,e.alreadyPaidAmount??0)},async getLatestSheetForCase(e){const t=Xa(e);return t?cl(t):null},async isNewFinancialModel(e){if(!e)return!1;const t=await Ic(),s=Se(e);return t.some(r=>Se(r.caseId)===s)},logIfMixedModel(e){if(!!!e.expensesSheetId)return;(e.expensesItems&&e.expensesItems.length>0||!!e.expenseWorksheet||!!e.expensesSum)&&console.error("[FinancialExpenses] Mixed model detected for report",e.id," expensesSheetId is set but legacy expenses fields are also populated.")},async getSheet(e){return cl(e)},async getRulesetForSheet(e){const t=e.insurerRulesetId||e.insurerId||"default",s=ON(t);if(s)return s;const r=new Date().toISOString();return{insurerId:t,policyFamily:"FLEXIBLE",requiredAttachmentTypes:[],requireAttachmentPerLine:!1,requireAttachmentForExpenseTypes:[],amountThresholdRequiringAttachment:null,infoOnlyTextVariant:null,notesInternal:null,rulesetVersion:"default",updatedAt:r}},async createSheet(e,t){const s={...t,createdByUserId:e.id};return FN(s)},async createPaymentEvent(e,t){return LN(t)},async updateSheetMeta(e,t,s){const r={sheetId:t,...La(e),patch:s};return $N(r)},async addLineItem(e,t,s){const r={...s,sheetId:t,...La(e)};return HN(r)},async updateLineItem(e,t,s,r){const a={sheetId:t,lineItemId:s,...La(e),patch:r};return UN(a)},async deleteLineItem(e,t,s){const r={sheetId:t,lineItemId:s,...La(e)};return WN(r)},async softDeletePaymentEvent(e){return _N(e)},buildCumulativeExpensesSnapshot(e,t){const s=`${e}::${t||"now"}`,r=Dc.get(s),a=Date.now();if(r&&a-r.ts<eb)return r.value;const o=cl(e);if(!o)return Dc.set(s,{ts:a,value:null}),null;const l=o.sheet,c=t||l.updatedAt||l.createdAt||new Date().toISOString(),i=Ep(l.caseId,c,l.alreadyPaidAmount??0),u={...l,alreadyPaidAmount:i},p=Ic(),y=Se(l.caseId),b=new Date(c).getTime(),w=p.filter(P=>{if(P.id===l.id||Se(P.caseId)!==y)return!1;const U=new Date(P.updatedAt||P.createdAt).getTime();return Number.isNaN(U)||Number.isNaN(b)?!0:U<=b}),R=[];w.forEach(P=>{const U=cl(P.id);U&&U.lineItems.forEach(V=>{V.kind==="EXPENSE"&&R.push(V)})});const E=o.lineItems,N=[...[...R,...E]].sort((P,U)=>{const V=j=>{const F=j.date?new Date(j.date).getTime():NaN;if(!Number.isNaN(F))return F;const L=j.createdAt?new Date(j.createdAt).getTime():NaN;return Number.isNaN(L)?0:L},X=V(P),te=V(U);if(X!==te)return X-te;const G=`${P.sheetId||""}-${P.id}`,ae=`${U.sheetId||""}-${U.id}`;return G.localeCompare(ae)}),S={effectiveSheet:u,currentLines:E,historicalLines:R,allLines:N,opts:{isNewLine:P=>P.kind==="EXPENSE"&&P.sheetId===l.id,isHistoricalLine:P=>P.kind==="EXPENSE"&&P.sheetId!==l.id}};return Dc.set(s,{ts:a,value:S}),S},async deleteSheet(e){BN(e)},async addAttachment(e,t,s){const r={...s,sheetId:t,uploadedByUserId:e.id};return zN(r)},async linkAttachmentToLineItem(e,t,s,r){const a={sheetId:t,attachmentId:s,lineItemId:r,...La(e)};return VN(a)},async recordReadyAttempt(e,t){const s={...t,actorUserId:e.id,actorRole:e.role};return KN(s)},async revertSheetToDraft(e,t){return YN({sheetId:t,actorUserId:e.id,actorRole:e.role})},recordAdminEditAfterPaid(e,t,s){PN(t,e.id,e.role,s)},recordSheetDeletionByAdmin(e,t,s){MN(t,e.id,e.role,s)},async listSheetsForLidor(e,t,s){if(e.role!=="ADMIN"&&e.role!=="SUB_ADMIN")throw new Error("Access denied: only ADMIN or SUB_ADMIN can view financial control data.");return GN(t,s)},async getLidorCounts(e,t){if(e.role!=="ADMIN"&&e.role!=="SUB_ADMIN")throw new Error("Access denied: only ADMIN or SUB_ADMIN can view financial control data.");return qN(t)},async getLidorKpis(e,t){if(e.role!=="ADMIN"&&e.role!=="SUB_ADMIN")throw new Error("Access denied: only ADMIN or SUB_ADMIN can view financial control data.");return QN(t)},async getExceptionStatusForSheet(e,t){if(e.role!=="ADMIN"&&e.role!=="SUB_ADMIN")throw new Error("Access denied: only ADMIN or SUB_ADMIN can view financial control data.");return JN(t)},async setExceptionStatusForSheet(e,t,s){if(e.role!=="ADMIN"&&e.role!=="SUB_ADMIN")throw new Error("Access denied: only ADMIN or SUB_ADMIN can view financial control data.");return XN({sheetId:t,value:s,actorUserId:e.id})},async getSheetAuditForLidor(e,t,s=10){if(e.role!=="ADMIN"&&e.role!=="SUB_ADMIN")throw new Error("Access denied: only ADMIN or SUB_ADMIN can view financial control data.");return ZN(t,s)}},tb={dashboardTitle:" ",brandName:"Lior Perry",brandSubtitle:"  ",welcomeBack:" ",roleLawyer:"",gettingStartedTitle:" ",gettingStartedBodyLine1:"  .",gettingStartedBodyLine2:"   .          .",gettingStartedStep1:"  ",gettingStartedStep2:" ",gettingStartedStep3:"  ",gettingStartedCta:"  ",searchSectionLabel:" ",searchLabel:" ",searchPlaceholder:"  , ,     ...",statusLabel:"",sortByLabel:" ",sortByUpdated:" ",sortByReportDate:" ",sortByInsured:"",onlyMyCases:"  ",clearFilters:" ",searchByOdakanit:"    ",searchOdakanitPlaceholder:"    ...",noCaseFolderFound:"       .",statsSectionLabel:"  ",statsActiveCases:" ",statsActionRequired:"  ",statsWaitingOnOthers:" ",statsFinanceTasks:"  ",statsDraftsReady:" /  ",caseListTitle:"   ",caseListHeaderTitle:" ",caseListHeaderReportNo:"REPORT NO",caseListHeaderPlaintiff:"PLAINTIFF / CLAIMANT",caseListHeaderInsured:"INSURED",caseListHeaderInsurer:"INSURER",caseListHeaderOdakanit:"  ",caseListStatusAttention:"  ",caseListStatusOpen:"  ",caseListStatusNone:"  ",caseListEmpty:"   .",caseListHintActiveOnly:"(     )",financeBannerTitle:"    ",financeBannerBody:"      .         .",bucketActionRequiredTitle:"  ",bucketActionRequiredDescription:"    .",bucketWaitingTitle:" ",bucketWaitingDescription:"   ,     .",bucketInProgressTitle:"",bucketInProgressDescription:"   .",bucketSentTitle:" / ",bucketSentDescription:"     .",emptyActionRequiredTitle:"    ",emptyActionRequiredDesc:"    ,   .",emptyWaitingTitle:"   ",emptyWaitingDesc:"      .",emptyInProgressTitle:"  ",emptyInProgressDesc:"    .",emptySentTitle:"   ",emptySentDesc:"  ,     .",emptyInProgressCta:"  ",defaultEmptyTitle:"  ",defaultEmptyDescription:"     .",untitledCase:"  ",labelInsured:"",labelPlaintiff:"",labelInsurer:" ",labelFile:" ",labelUpdated:":",labelNextStep:" :",nextStepReview:"  ",nextStepWaitingInvoices:" ",nextStepReadyToSend:" ",nextStepDraft:"  ",nextStepSent:"",nextStepContinue:" ",openContinue:" / ",preview:" ",viewSections:"  ",deleteDraftConfirm:"   ?     .",deleteDraftAria:" ",deleteTitle:"",pin:" ",unpin:" ",alertTimeBreach:" ",alertResponseDelay:" ",openNotificationsAria:" ",openNotificationsTitle:"",openNewCaseFolderAria:"  ",openNewCaseFolderTitle:"  ",openHelpCenterAria:"  ",openHelpCenterTitle:" ",logoutAria:"",logoutTitle:"",workQueuesAria:"  ",expand:"",collapse:"",statusDraft:"",statusActionRequired:" ",statusWaitingInvoices:" ",statusPendingReview:" ",statusApproved:"",statusReadyToSend:" ",statusSent:"",densityLabel:" :",densityComfortable:"",densityCompact:"",resumeLastCase:"   ",resumeLabel:"",internalFile:" ",workloadTitle:"  ",workloadActionLabel:"  ",workloadWaitingLabel:"   ",workloadDraftLabel:" ",financeReportsTitle:" /    ",financeReportsHint:"           .",financeReportsHeaderOdakanit:" ",financeReportsHeaderInsured:"",financeReportsHeaderPlaintiff:"",financeReportsHeaderStatus:" ",financeReportsHeaderUpdated:" ",financeReportsEmpty:"     .",focusModeLabel:"    ",tagNewCase:" ",tagOngoingCase:" ",notificationTitle:" ",dailySummary:" ",noNotifications:"  .",clearAll:" ",footerArchiveNote:"      "},Re=e=>tb[e],Lc=({label:e,value:t,icon:s,accentClass:r,selected:a,onClick:o})=>{const l=n.jsxs("div",{className:["flex items-center justify-between rounded-2xl border px-4 py-3 shadow-sm transition","focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-gold focus-visible:ring-offset-2",a?"border-gold bg-gold/10":"border-borderDark bg-panel hover:bg-navySecondary"].join(" "),children:[n.jsxs("div",{children:[n.jsx("p",{className:["text-[11px] uppercase tracking-wide",a?"font-bold text-textLight":"font-semibold text-textMuted"].join(" "),children:e}),n.jsx("p",{className:"mt-1 text-xl font-bold text-gray-900",children:t})]}),n.jsx("div",{className:["inline-flex h-9 w-9 items-center justify-center rounded-full",r].join(" "),"aria-hidden":"true",children:s})]});return o?n.jsx("button",{type:"button",onClick:o,className:"w-full text-left",children:l}):l},nb=({activeCases:e,actionRequired:t,waitingOnOthers:s,draftsAndReady:r,financeTasks:a,selectedFilter:o,onChangeFilter:l})=>{const c=i=>{l&&l(o===i?null:i)};return n.jsxs("section",{"aria-label":Re("statsSectionLabel"),className:"mb-6 grid gap-4 grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-3 xl:grid-cols-3",children:[n.jsx(Lc,{label:Re("statsFinanceTasks"),value:a,icon:n.jsx(_0,{className:"h-4 w-4 text-goldLight"}),accentClass:"bg-gold/20",selected:o==="FINANCE",onClick:()=>c("FINANCE")}),n.jsx(Lc,{label:Re("statsWaitingOnOthers"),value:s,icon:n.jsx(D0,{className:"h-4 w-4 text-goldLight"}),accentClass:"bg-gold/20",selected:o==="WAITING",onClick:()=>c("WAITING")}),n.jsx(Lc,{label:Re("statsDraftsReady"),value:r,icon:n.jsx(Zl,{className:"h-4 w-4 text-goldLight"}),accentClass:"bg-gold/20",selected:o==="DRAFTS",onClick:()=>c("DRAFTS")})]})};Re("statusDraft"),Re("statusActionRequired"),Re("statusWaitingInvoices"),Re("statusPendingReview"),Re("statusApproved"),Re("statusReadyToSend"),Re("statusSent");const _a=e=>(e||"").trim().toLowerCase(),_c=e=>{const t=(e.odakanitNo||"").trim();if(t)return`odakanit:${t}`;const s=[`umr:${_a(e.marketRef)}`,`line:${_a(e.lineSlipNo)}`,`cert:${_a(e.certificateRef)}`,`insured:${_a(e.insuredName)}`,`plaintiff:${_a(e.plaintiffName)}`].filter(r=>!r.endsWith(":"));return s.length?s.join("|"):`id:${e.id}`},sb=24*60*60*1e3,rb=e=>{const t=e.updatedAt||e.reportDate;if(!t)return null;const s=new Date(t).getTime();return Number.isFinite(s)?s:null},ab=e=>{const t=rb(e);return!t||(Date.now()-t)/sb<=3?null:e.status==="DRAFT"?Re("alertResponseDelay"):e.status==="WAITING_FOR_INVOICES"||e.status==="READY_TO_SEND"?Re("alertTimeBreach"):null},ob=e=>e.status==="TASK_ASSIGNED"||e.status==="PENDING_REVIEW"||e.status==="READY_TO_SEND",lb=({report:e})=>e.expensesSheetId?e.supersededByReportId?n.jsx("span",{className:"inline-flex items-center rounded-full bg-slate-100 px-1.5 py-0.5 text-[9px] font-semibold text-slate-700 border border-slate-200",title:"        ",children:""}):n.jsx("span",{className:"inline-flex items-center rounded-full bg-emerald-50 px-1.5 py-0.5 text-[9px] font-semibold text-emerald-800 border border-emerald-200",title:"      ",children:" ()"}):null,ib=Re("brandName"),cb=Re("brandSubtitle"),db={DRAFT:Re("statusDraft"),TASK_ASSIGNED:Re("statusActionRequired"),WAITING_FOR_INVOICES:Re("statusWaitingInvoices"),PENDING_REVIEW:Re("statusPendingReview"),APPROVED:Re("statusApproved"),READY_TO_SEND:Re("statusReadyToSend"),SENT:Re("statusSent")},kp=e=>e==="TASK_ASSIGNED"||e==="PENDING_REVIEW"?"ACTION_REQUIRED":e==="WAITING_FOR_INVOICES"?"WAITING_ON_OTHERS":e==="READY_TO_SEND"?"IN_PROGRESS":e==="SENT"?"SENT_COMPLETED":"IN_PROGRESS",Oc=e=>`lp_pins:${e}`,ub=e=>`lp_dashboard_density:${e}`,mb="lp_current_report",Ap=e=>`lp_pins_migrated:${e}`,pb=({user:e,reports:t,caseFolders:s,notifications:r,showNotifications:a,setShowNotifications:o,onClearNotifications:l,dailySummaryOptIn:c,setDailySummaryOptIn:i,archiveAfterMs:u,onSelectReport:p,onNewReport:y,onOpenCaseFolder:b,onLogout:w,deleteReportById:R})=>{const[E,W]=g.useState(""),[N,h]=g.useState("ALL"),[S,P]=g.useState(!0),[U,V]=g.useState(null),[X,te]=g.useState("UPDATED"),[G,ae]=g.useState(()=>{if(typeof window>"u")return[];try{const Z=window.localStorage.getItem(Oc(e.id)),Ne=Z?JSON.parse(Z):[];return Array.isArray(Ne)?Ne.filter(xe=>typeof xe=="string"):[]}catch{return[]}}),[j,F]=g.useState(()=>{if(typeof window>"u")return"COMFORTABLE";try{return window.localStorage.getItem(ub(e.id))==="COMPACT"?"COMPACT":"COMFORTABLE"}catch{return"COMFORTABLE"}}),L=Date.now(),O=u??Number.MAX_SAFE_INTEGER,[H,M]=g.useState(!1),[I,D]=g.useState({}),J=g.useMemo(()=>r.filter(Ne=>!Ne.targetUserId||Ne.targetUserId===e.id).filter(Ne=>{if(!Ne.reportId)return!0;const xe=t.find(be=>be.id===Ne.reportId);return xe?xe.status!=="SENT":!0}),[r,e.id,t]),ue=g.useMemo(()=>J.filter(Z=>{if(!Z.reportId)return!1;const Ne=t.find(xe=>xe.id===Z.reportId);return!(!Ne||!Ne.expensesSheetId||Ne.status==="SENT")}).length,[J,t]),{mine:ce,buckets:le,filteredReports:fe}=g.useMemo(()=>{const Z=t.filter(Ue=>{if(Ue.deletedAt)return!1;const nt=(Ue.odakanitNo||"").trim();if(!nt)return!0;const jt=s[nt];return!(jt&&jt.closedAt)}),Ne=Z.filter(Ue=>Ue.createdBy===e.id),xe=S?Ne:Z,be=N==="ALL"?xe:xe.filter(Ue=>Ue.status===N),Oe=U==="FINANCE"?be.filter(Ue=>!!Ue.expensesSheetId):be,Ce=(()=>{const Ue=E.trim().toLowerCase();return Ue?Oe.filter(nt=>[nt.odakanitNo,nt.insuredName,nt.plaintiffName,nt.insurerName,nt.marketRef].filter(Boolean).join(" ").toLowerCase().includes(Ue)):Oe})(),qe=H?Ce.filter(Ue=>ob(Ue)||!!ab(Ue)):Ce,dt={ACTION_REQUIRED:[],WAITING_ON_OTHERS:[],IN_PROGRESS:[],SENT_COMPLETED:[]};return qe.forEach(Ue=>{const nt=kp(Ue.status);dt[nt].push(Ue)}),{mine:Ne,buckets:dt,filteredReports:qe}},[t,s,e.id,E,N,S,H,L,O,U]),Ee=g.useMemo(()=>{const Z=new Set;let Ne=0,xe=0,be=0,Oe=0;return ce.forEach(Ce=>{Ce.status!=="SENT"&&(xe+=1,Z.add(_c(Ce))),kp(Ce.status)==="ACTION_REQUIRED"&&(Ne+=1),Ce.status==="READY_TO_SEND"&&(be+=1),Ce.expensesSheetId&&Ce.status!=="SENT"&&(Oe+=1)}),{activeCasesCount:Z.size,actionRequiredCount:Ne,draftsInWorkCount:xe,readyToSendCount:be,financeTasksCount:Oe}},[ce]),{activeCasesCount:ve,actionRequiredCount:$e,draftsInWorkCount:Pe,readyToSendCount:Ke,financeTasksCount:Ye}=Ee,it=g.useMemo(()=>ce.filter(Z=>Z.status==="WAITING_FOR_INVOICES").length,[ce]),q=ce.filter(Z=>!!Z.expensesSheetId&&Z.status!=="SENT");g.useEffect(()=>{const Ne=Array.from(new Set(q.map(xe=>xe.expensesSheetId).filter(xe=>!!xe))).filter(xe=>!I[xe]);Ne.length&&Ne.forEach(xe=>{(async()=>{try{const be=await Xe.getSheet(xe);if(!be)return;const Oe=Fn(be.sheet,be.lineItems);D(Ce=>({...Ce,[xe]:Oe}))}catch{}})()})},[q,I]);const se=g.useMemo(()=>{const Z=new Map,Ne=be=>{const Oe=ei(be);if(!Oe)return"";const Ce=Oe.split(" - ");return Ce.length<=2?Oe:Ce[Ce.length-2]||Oe};return ce.forEach(be=>{if(!be.odakanitNo)return;const Oe=be.odakanitNo.trim();if(!Oe)return;const Ce=Z.get(Oe)||{odakanitNo:Oe,insuredName:be.insuredName||void 0,plaintiffName:be.plaintiffName||void 0,insurerName:be.insurerName||void 0,latestUpdatedAt:null,latestReportTitle:void 0,latestReportNumber:void 0,nextReportNumber:void 0,hasOpenWork:!1,hasUrgentWork:!1},qe=be.updatedAt||be.reportDate,dt=qe&&new Date(qe).getTime()||0,Ue=Ce.latestUpdatedAt&&new Date(Ce.latestUpdatedAt).getTime()||0;dt>=Ue&&(Ce.latestUpdatedAt=qe||Ce.latestUpdatedAt||null,Ce.insuredName=be.insuredName||Ce.insuredName,Ce.plaintiffName=be.plaintiffName||Ce.plaintiffName,Ce.insurerName=be.insurerName||Ce.insurerName,Ce.latestReportTitle=Ne(be)),be.status!=="SENT"&&!be.deletedAt&&(Ce.hasOpenWork=!0),(be.status==="TASK_ASSIGNED"||be.status==="WAITING_FOR_INVOICES"||be.status==="PENDING_REVIEW"||be.status==="READY_TO_SEND")&&(Ce.hasUrgentWork=!0),Z.set(Oe,Ce)}),Array.from(Z.values()).map(be=>{var Ue;const Oe=be.odakanitNo.trim(),Ce=[],qe=s[Oe];(Ue=qe==null?void 0:qe.sentReports)!=null&&Ue.length&&qe.sentReports.forEach(nt=>{typeof nt.reportNo=="number"&&nt.reportNo>0&&Ce.push(nt.reportNo)}),t.forEach(nt=>{var jt;if((nt.odakanitNo||"").trim()===Oe&&nt.status==="SENT")if(typeof nt.reportNumber=="number"&&nt.reportNumber>0)Ce.push(nt.reportNumber);else{const z=(((jt=nt.reportHistory)==null?void 0:jt.length)||0)+1;Ce.push(z)}});const dt=Ce.length?Math.max(...Ce):0;return{...be,latestReportNumber:dt||void 0,nextReportNumber:(dt||0)+1}}).sort((be,Oe)=>{const Ce=be.latestUpdatedAt&&new Date(be.latestUpdatedAt).getTime()||0;return(Oe.latestUpdatedAt&&new Date(Oe.latestUpdatedAt).getTime()||0)-Ce})},[ce]);g.useMemo(()=>new Set(G),[G]);const C=Z=>{p(Z.id)},re=Z=>{const Ne=U===Z?null:Z;switch(V(Ne),Ne){case"ACTION":h("TASK_ASSIGNED");break;case"WAITING":h("WAITING_FOR_INVOICES");break;case"DRAFTS":h("READY_TO_SEND");break;case"FINANCE":h("ALL");break;case"ACTIVE":h("ALL");break;default:h("ALL");break}};N!=="ALL"||E.trim(),g.useEffect(()=>{if(!a)return;const Z=Ne=>{Ne.key==="Escape"&&o(!1)};return window.addEventListener("keydown",Z),()=>window.removeEventListener("keydown",Z)},[a,o]),g.useEffect(()=>{if(typeof window>"u"||!t.length)return;const Z=Ap(e.id);if(window.localStorage.getItem(Z)!=="1")try{const xe=window.localStorage.getItem(Oc(e.id));if(!xe){window.localStorage.setItem(Z,"1");return}const be=JSON.parse(xe);if(!Array.isArray(be)){window.localStorage.setItem(Z,"1");return}const Oe=[],Ce=qe=>{qe&&(Oe.includes(qe)||Oe.push(qe))};be.forEach(qe=>{if(typeof qe!="string")return;const dt=qe.trim();if(!dt)return;const Ue=dt.toLowerCase();if(Ue.startsWith("odakanit:")||Ue.startsWith("umr:")||Ue.startsWith("line:")||Ue.startsWith("cert:")||Ue.startsWith("insured:")||Ue.startsWith("plaintiff:")||Ue.startsWith("id:")){Ce(dt);return}const jt=t.find(z=>_c(z)===dt?!0:z.id===dt||z.odakanitNo&&z.odakanitNo===dt||z.marketRef&&z.marketRef===dt);Ce(jt?_c(jt):`odakanit:${dt}`)}),ae(Oe),window.localStorage.setItem(Oc(e.id),JSON.stringify(Oe)),window.localStorage.setItem(Z,"1")}catch{window.localStorage.setItem(Ap(e.id),"1")}},[t,e.id]),g.useMemo(()=>{if(!ce.length)return null;if(typeof window<"u")try{const Ne=window.localStorage.getItem(mb),xe=Ne?ce.find(be=>be.id===Ne&&!be.deletedAt):null;if(xe)return xe}catch{}return[...ce].sort((Ne,xe)=>{const be=qe=>{const dt=qe.updatedAt||qe.reportDate;return dt&&new Date(dt).getTime()||0},Oe=be(Ne);return be(xe)-Oe})[0]||null},[ce]);const Q=()=>n.jsxs("div",{className:"relative",children:[n.jsxs("button",{type:"button",onClick:()=>o(!a),className:"relative inline-flex h-9 w-9 items-center justify-center rounded-full bg-gold/10 text-xs font-medium text-blue-700 hover:bg-blue-100 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-lpBlue focus-visible:ring-offset-2","aria-label":Re("openNotificationsAria"),title:Re("openNotificationsTitle"),children:[n.jsx(Jl,{className:"h-4 w-4","aria-hidden":"true"}),ue>0&&n.jsx("span",{className:"absolute -top-1.5 -right-1.5 inline-flex h-4 min-w-[16px] items-center justify-center rounded-full bg-red-500 px-1 text-[10px] font-bold text-white",children:ue})]}),a&&n.jsxs("div",{className:"absolute right-0 mt-2 w-80 rounded-lg border border-borderDark bg-panel text-xs shadow-xl z-50",children:[n.jsxs("div",{className:"flex items-center justify-between border-b px-3 py-2",children:[n.jsx("span",{className:"font-semibold text-textLight",children:Re("notificationTitle")}),n.jsxs("label",{className:"flex items-center gap-1 text-[11px] text-textMuted",children:[n.jsx("input",{type:"checkbox",checked:c,onChange:Z=>i(Z.target.checked),className:"h-3 w-3 rounded border-borderDark text-gold focus:ring-gold"}),Re("dailySummary")]})]}),n.jsxs("div",{className:"max-h-64 overflow-auto divide-y",children:[J.length===0&&n.jsx("div",{className:"p-4 text-center text-textMuted",children:Re("noNotifications")}),J.map(Z=>n.jsxs("div",{className:"p-3 space-y-1",children:[n.jsx("p",{className:"font-medium text-textLight",children:Z.message}),n.jsx("p",{className:"text-[10px] text-textMuted",children:new Date(Z.createdAt).toLocaleString()}),Z.reportId&&n.jsx("button",{type:"button",className:"mt-1 text-[11px] text-blue-700 hover:underline",onClick:()=>{p(Z.reportId),o(!1)},children:' " '})]},Z.id))]}),n.jsx("div",{className:"px-3 py-2 text-right",children:n.jsx("button",{type:"button",onClick:l,className:"text-[11px] font-medium text-red-500 hover:underline",children:Re("clearAll")})})]})]}),[he,Fe]=g.useState(""),[je,Te]=g.useState(!1),[et,Ge]=g.useState(-1),He=g.useMemo(()=>{const Z=he.trim();if(!Z)return[];const Ne=Z.toLowerCase(),xe=Object.values(s),be=xe.filter(qe=>qe.odakanitNo.toLowerCase().startsWith(Ne)),Oe=xe.filter(qe=>!qe.odakanitNo.toLowerCase().startsWith(Ne)&&qe.odakanitNo.toLowerCase().includes(Ne));return[...be,...Oe].slice(0,8).map(qe=>({odakanitNo:qe.odakanitNo,insuredName:qe.insuredName,plaintiffName:qe.plaintiffName}))},[he,s]);return g.useEffect(()=>{if(!he.trim()){Te(!1),Ge(-1);return}He.length>0?(Te(!0),Ge(0)):(Te(!1),Ge(-1))},[he,He.length]),n.jsx("div",{className:"min-h-screen bg-navySecondary px-0 pb-6 text-[15px]",dir:"rtl",lang:"he",children:n.jsxs("div",{className:"w-full px-6 md:px-8 lg:px-10 xl:px-12",children:[n.jsxs("header",{className:"sticky top-0 z-20 mb-4 flex flex-col gap-3 border-b border-borderDark bg-panel/80 pb-3 pt-2 backdrop-blur-sm md:flex-row md:items-center md:justify-between",children:[n.jsxs("div",{children:[n.jsx("h1",{className:"text-2xl font-bold text-gold font-heebo",children:Re("dashboardTitle")}),n.jsxs("p",{className:"text-base text-textMuted text-right",children:[n.jsx("span",{className:"font-semibold",children:ib})," ",n.jsx("span",{className:"text-textMuted",children:cb}),n.jsx("span",{className:"text-textMuted",children:"  "}),Re("welcomeBack"),","," ",n.jsx("span",{className:"font-semibold",children:e.name})," ",n.jsxs("span",{className:"text-textMuted",children:["(",Re("roleLawyer"),")"]})]})]}),n.jsxs("div",{className:"flex flex-wrap items-center justify-start gap-2 md:justify-end",children:[n.jsx("button",{type:"button",onClick:y,className:"inline-flex h-9 w-9 items-center justify-center rounded-full bg-lpBlue text-sm font-semibold text-white shadow-sm hover:bg-blue-900 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-lpBlue focus-visible:ring-offset-2","aria-label":Re("openNewCaseFolderAria"),title:Re("openNewCaseFolderTitle"),children:n.jsx(Ou,{className:"h-4 w-4","aria-hidden":"true"})}),Q(),n.jsx("button",{type:"button",className:"inline-flex h-9 w-9 items-center justify-center rounded-full bg-gold/10 text-sm font-medium text-blue-700 hover:bg-blue-100 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-lpBlue focus-visible:ring-offset-2",onClick:()=>{const Z=new CustomEvent("openUserGuide");window.dispatchEvent(Z)},"aria-label":Re("openHelpCenterAria"),title:Re("openHelpCenterTitle"),children:n.jsx(Du,{className:"h-4 w-4","aria-hidden":"true"})}),n.jsx("button",{type:"button",onClick:w,className:"inline-flex h-9 w-9 items-center justify-center rounded-full text-sm font-semibold text-red-600 hover:bg-red-50 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-red-500 focus-visible:ring-offset-2","aria-label":Re("logoutAria"),title:Re("logoutTitle"),children:n.jsx(ch,{className:"h-4 w-4","aria-hidden":"true"})})]})]}),!1,n.jsxs("section",{className:"mb-3 rounded-2xl border border-borderDark bg-panel px-4 py-3 text-xs text-textLight shadow-sm",children:[n.jsx("h2",{className:"mb-1 text-sm font-semibold text-textLight",children:Re("workloadTitle")}),n.jsxs("div",{className:"flex flex-wrap gap-3 text-[11px] text-textLight mb-2",children:[n.jsxs("span",{children:[Ye," ",Re("statsFinanceTasks")]}),n.jsxs("span",{children:[it," ",Re("statsWaitingOnOthers")]}),n.jsxs("span",{children:[Ke," ",Re("statsDraftsReady")]})]}),n.jsx("div",{className:"max-h-40 overflow-y-auto rounded-xl border border-dashed border-borderDark bg-navySecondary px-3 py-2",children:ce.filter(Z=>Z.status!=="SENT").length===0?n.jsx("p",{className:"text-[11px] text-textMuted",children:Re("emptyInProgressTitle")}):n.jsx("ul",{className:"space-y-1 text-[11px]",children:ce.filter(Z=>Z.status!=="SENT").sort((Z,Ne)=>{const xe=be=>{const Oe=be.updatedAt||be.reportDate;return Oe&&new Date(Oe).getTime()||0};return xe(Ne)-xe(Z)}).map(Z=>n.jsxs("li",{className:"flex items-center justify-between gap-2 border-b border-borderDark/70 pb-1 last:border-b-0",children:[n.jsxs("button",{type:"button",onClick:()=>C(Z),className:"flex-1 text-right hover:text-gold",children:[n.jsx("span",{className:"font-semibold",children:Z.insuredName||Z.plaintiffName||Re("untitledCase")}),Z.odakanitNo&&n.jsxs("span",{className:"text-textMuted",children:["  ",Z.odakanitNo]})]}),n.jsxs("span",{className:"whitespace-nowrap text-[10px] text-textMuted flex items-center gap-1",children:[n.jsx("span",{children:db[Z.status]}),n.jsx(lb,{report:Z})]})]},Z.id))})})]}),!1,n.jsxs("section",{className:"mb-3 rounded-2xl border border-borderDark bg-panel px-4 py-3 text-xs text-textLight shadow-sm",children:[n.jsxs("div",{className:"flex items-center justify-between mb-2",children:[n.jsx("h2",{className:"text-sm font-semibold text-textLight",children:Re("caseListTitle")}),n.jsxs("span",{className:"text-[11px] text-textMuted",children:[se.length," ",Re("statsActiveCases")]})]}),n.jsx("p",{className:"mb-2 text-[11px] text-textMuted",children:Re("caseListHintActiveOnly")}),se.length===0?n.jsx("p",{className:"text-[11px] text-textMuted",children:Re("caseListEmpty")}):n.jsx("div",{className:"overflow-x-auto",children:n.jsxs("table",{className:"min-w-full table-fixed text-[11px]",children:[n.jsx("thead",{children:n.jsxs("tr",{className:"border-b border-borderDark bg-navySecondary",children:[n.jsx("th",{className:"px-2 py-1 text-right font-semibold w-32",children:Re("caseListHeaderOdakanit")}),n.jsx("th",{className:"px-2 py-1 text-right font-semibold w-40",children:Re("caseListHeaderInsurer")}),n.jsx("th",{className:"px-2 py-1 text-right font-semibold w-40",children:Re("caseListHeaderInsured")}),n.jsx("th",{className:"px-2 py-1 text-right font-semibold w-40",children:Re("caseListHeaderPlaintiff")}),n.jsx("th",{className:"px-2 py-1 text-right font-semibold w-20",children:Re("caseListHeaderReportNo")}),n.jsx("th",{className:"px-2 py-1 text-right font-semibold w-20",children:Re("caseListHeaderNextReportNo")??"Next report"})]})}),n.jsx("tbody",{children:se.map((Z,Ne)=>{const xe=Z.hasUrgentWork,be=Z.hasOpenWork,Oe=Ne%2===0?"bg-panel":"bg-navySecondary",Ce=xe?"border-l-4 border-red-400 bg-red-50/80":be?"border-l-4 border-amber-300 bg-amber-50/70":"border-l border-transparent";return n.jsxs("tr",{className:`cursor-pointer border-b border-borderDark ${Oe} ${Ce}`,onClick:()=>b(Z.odakanitNo),children:[n.jsx("td",{className:"px-2 py-1 text-right font-mono text-[11px]",children:n.jsx("button",{type:"button",className:"text-gold hover:underline",onClick:()=>b(Z.odakanitNo),children:Z.odakanitNo})}),n.jsx("td",{className:"px-2 py-1 text-right",children:Z.insurerName||""}),n.jsx("td",{className:"px-2 py-1 text-right",children:Z.insuredName||""}),n.jsx("td",{className:"px-2 py-1 text-right",children:Z.plaintiffName||""}),n.jsx("td",{className:"px-2 py-1 text-right font-mono text-[11px]",children:Z.latestReportNumber??""}),n.jsx("td",{className:"px-2 py-1 text-right font-mono text-[11px]",children:Z.nextReportNumber??(Z.latestReportNumber||0)+1})]},Z.odakanitNo)})})]})})]}),!1,!1,n.jsx(nb,{activeCases:ve,actionRequired:$e,waitingOnOthers:it,draftsAndReady:Ke,financeTasks:Ye,selectedFilter:U,onChangeFilter:re}),n.jsxs("section",{className:"mb-3 rounded-2xl border border-emerald-100 bg-panel px-4 py-3 text-xs text-textLight shadow-sm",children:[n.jsxs("div",{className:"flex items-center justify-between mb-2",children:[n.jsx("h2",{className:"text-sm font-semibold text-textLight",children:Re("financeReportsTitle")}),n.jsx("span",{className:"text-[11px] text-textMuted",children:Ye})]}),n.jsx("p",{className:"mb-2 text-[11px] text-textMuted",children:Re("financeReportsHint")}),q.length===0?n.jsx("p",{className:"text-[11px] text-textMuted",children:Re("financeReportsEmpty")}):n.jsx("div",{className:"overflow-x-auto",children:n.jsxs("table",{className:"min-w-full table-fixed text-[11px]",children:[n.jsx("thead",{children:n.jsxs("tr",{className:"border-b border-borderDark bg-navySecondary",children:[n.jsx("th",{className:"px-2 py-1 text-right font-semibold w-48",children:Re("caseListHeaderTitle")}),n.jsx("th",{className:"px-2 py-1 text-right font-semibold w-20",children:Re("caseListHeaderReportNo")}),n.jsx("th",{className:"px-2 py-1 text-right font-semibold w-40",children:Re("caseListHeaderPlaintiff")}),n.jsx("th",{className:"px-2 py-1 text-right font-semibold w-40",children:Re("caseListHeaderInsured")}),n.jsx("th",{className:"px-2 py-1 text-right font-semibold w-40",children:Re("caseListHeaderInsurer")}),n.jsx("th",{className:"px-2 py-1 text-right font-semibold w-32",children:Re("caseListHeaderOdakanit")})]})}),n.jsx("tbody",{children:q.slice().sort((Z,Ne)=>{const xe=be=>{const Oe=be.updatedAt||be.reportDate;return Oe&&new Date(Oe).getTime()||0};return xe(Ne)-xe(Z)}).map(Z=>{var Ce;const Ne=ei(Z),xe=Ne.split(" - "),be=xe.length>2&&xe[xe.length-2]||Ne,Oe=(((Ce=Z.reportHistory)==null?void 0:Ce.length)||0)+1;return n.jsxs("tr",{className:"cursor-pointer border-b border-borderDark hover:bg-emerald-50/60",onClick:()=>{Z.odakanitNo?b(Z.odakanitNo):C(Z)},children:[n.jsxs("td",{className:"px-2 py-1 text-right",children:[n.jsx("div",{className:"font-semibold text-textLight",children:be||""}),Z.updatedAt&&n.jsx("div",{className:"text-[10px] text-textMuted",children:new Date(Z.updatedAt).toLocaleString("he-IL")})]}),n.jsx("td",{className:"px-2 py-1 text-right font-mono text-[11px]",children:Oe}),n.jsx("td",{className:"px-2 py-1 text-right",children:Z.plaintiffName||""}),n.jsx("td",{className:"px-2 py-1 text-right",children:Z.insuredName||""}),n.jsx("td",{className:"px-2 py-1 text-right",children:Z.insurerName||""}),n.jsx("td",{className:"px-2 py-1 text-right font-mono text-[11px]",children:Z.odakanitNo||""})]},Z.id)})})]})})]}),!1]})})},fb="modulepreload",xb=function(e){return"/"+e},Ip={},hb=function(t,s,r){let a=Promise.resolve();if(s&&s.length>0){document.getElementsByTagName("link");const l=document.querySelector("meta[property=csp-nonce]"),c=(l==null?void 0:l.nonce)||(l==null?void 0:l.getAttribute("nonce"));a=Promise.allSettled(s.map(i=>{if(i=xb(i),i in Ip)return;Ip[i]=!0;const u=i.endsWith(".css"),p=u?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${i}"]${p}`))return;const y=document.createElement("link");if(y.rel=u?"stylesheet":fb,u||(y.as="script"),y.crossOrigin="",y.href=i,c&&y.setAttribute("nonce",c),document.head.appendChild(y),u)return new Promise((b,w)=>{y.addEventListener("load",b),y.addEventListener("error",()=>w(new Error(`Unable to preload CSS for ${i}`)))})}))}function o(l){const c=new Event("vite:preloadError",{cancelable:!0});if(c.payload=l,window.dispatchEvent(c),!c.defaultPrevented)throw l}return a.then(l=>{for(const c of l||[])c.status==="rejected"&&o(c.reason);return t().catch(o)})},gb={:"January",:"February",:"March",:"April",:"May",:"June",:"July",:"August",:"September",:"October",:"November",:"December"},yb=e=>{let t=e.trim();return t=t.replace(/Reporl/gi,"Report"),t=t.replace(/Rep0rt/gi,"Report"),t=t.replace(/Repcrt/gi,"Report"),t=t.replace(/\s+/g," "),t},Nb=e=>{try{let t=e;Object.entries(gb).forEach(([r,a])=>{const o=new RegExp(r,"gi");t=t.replace(o,a)});const s=new Date(t);return Number.isNaN(s.getTime())?void 0:s.toISOString().slice(0,10)}catch{return}};async function bb(e){var t,s,r;try{const o=await(await hb(()=>import("./index-BKz3vwFD.js").then(E=>E.i),[])).recognize(e,"eng+heb",{logger:()=>{}}),l=((t=o==null?void 0:o.data)==null?void 0:t.lines)||((r=(s=o==null?void 0:o.data)==null?void 0:s.text)==null?void 0:r.split(/\r?\n/).filter(E=>E.trim().length>0).map(E=>({text:E})))||[],c=[],i={},u="(January|February|March|April|May|June|July|August|September|October|November|December||||||||||||)",p=new RegExp(`Report\\s*(\\d+)\\s*-\\s*(.*?),\\s*(${u}\\s+\\d{1,2},\\s*\\d{4})\\.?$`,"i"),y=/^\s*(Line\s*Slip\s*No\.?|LineSlip\s*No\.?)\s*[:\-]?\s*(.+)\s*$/i,b=/^\s*Unique\s+Market\s+Ref\.?\s*[:\-]?\s*(.+)\s*$/i,w=/^\s*Insured\s*[:\-]?\s*(.+)\s*$/i,R=/^\s*(Plaintiff|Claimant)\s*[:\-]?\s*(.+)\s*$/i;return l.forEach(E=>{const W=E.text||"";if(!W.trim())return;const N=yb(W),h=N.match(p);if(h){const X=Number.parseInt(h[1],10),te=(h[2]||"").trim().replace(/[.,]\s*$/,""),G=h[3]||"",ae=Nb(G);if(!X||!ae||!te||te.length<2)return;c.push({reportNo:X,title:te,sentAt:ae,rawLine:W,confidence:typeof E.confidence=="number"?Math.round(E.confidence):void 0});return}const S=N.match(y);S&&!i.lineSlipNo&&(i.lineSlipNo=S[2].trim());const P=N.match(b);P&&!i.marketRef&&(i.marketRef=P[1].trim());const U=N.match(w);U&&!i.insuredName&&(i.insuredName=U[1].trim());const V=N.match(R);V&&!i.plaintiffOrClaimant&&(i.plaintiffOrClaimant=V[2].trim())}),c.sort((E,W)=>(E.reportNo||0)-(W.reportNo||0)),{previousReports:c,identifiers:i}}catch(a){return console.error("OCR failed",a),{previousReports:[],identifiers:{}}}}const Tp="seedShortcutsStickerCollapsed_v1",vb=()=>{const[e,t]=g.useState(()=>{if(typeof window>"u")return!1;try{return window.localStorage.getItem(Tp)==="1"}catch{return!1}});return g.useEffect(()=>{if(!(typeof window>"u"))try{window.localStorage.setItem(Tp,e?"1":"0")}catch{}},[e]),n.jsx("div",{className:"fixed bottom-4 right-4 z-[260] max-w-xs text-[11px] text-slate-800",style:{pointerEvents:"none"},children:n.jsxs("div",{className:"rounded-xl shadow-lg border border-amber-200 bg-amber-50/95 px-3 py-2",style:{pointerEvents:"auto"},children:[n.jsxs("div",{className:"flex items-center justify-between gap-2 mb-1",children:[n.jsxs("div",{className:"font-semibold flex items-center gap-1",children:[n.jsx("span",{children:""}),n.jsx("span",{children:"Shortcuts"})]}),n.jsx("button",{type:"button",className:"text-[10px] text-slate-600 hover:text-slate-900",onClick:()=>t(s=>!s),children:e?"+":""})]}),!e&&n.jsxs("div",{className:"space-y-1",children:[n.jsx("div",{className:"font-semibold text-[10px] text-slate-700",children:"Screenshot"}),n.jsxs("ul",{className:"space-y-0.5",children:[n.jsx("li",{children:"Ctrl /  + V  Paste screenshot"}),n.jsx("li",{children:"Ctrl /  + Shift + O  Run OCR"})]}),n.jsx("div",{className:"font-semibold text-[10px] text-slate-700 mt-1",children:"Reports table"}),n.jsxs("ul",{className:"space-y-0.5",children:[n.jsx("li",{children:"Enter  Next field"}),n.jsx("li",{children:"Shift + Enter  New report row (below)"}),n.jsx("li",{children:"Ctrl /  + Enter  New report row"})]}),n.jsx("div",{className:"font-semibold text-[10px] text-slate-700 mt-1",children:"Apply"}),n.jsx("ul",{className:"space-y-0.5",children:n.jsx("li",{children:"Ctrl /  + S  Approve & Apply"})}),n.jsx("div",{className:"font-semibold text-[10px] text-slate-700 mt-1",children:"Navigation"}),n.jsx("ul",{className:"space-y-0.5",children:n.jsx("li",{children:"Ctrl + Alt +  /   Previous / Next case"})}),n.jsx("div",{className:"text-[9px] text-slate-500 mt-1",children:"Shortcuts work only in this screen."})]})]})})},Ku="seedDraftCases_v1",Ch="seedDraftFinalized_v1",Sb=7,wb=e=>e.replace(/^\uFEFF/,"").trim().toLowerCase().replace(/[\s_]+/g,"").replace(/[^a-z0-9]/g,""),Rp=(e,t)=>{const s=[];let r="",a=!1;for(let o=0;o<e.length;o+=1){const l=e[o];if(l==='"'){a&&e[o+1]==='"'?(r+='"',o+=1):a=!a;continue}if(l===t&&!a){s.push(r),r="";continue}r+=l}return s.push(r),s.map(o=>o.trim())},jb=e=>{const s=e.split(/\r?\n/).map(R=>R.trim()).filter(R=>R.length>0);if(!s.length)return{drafts:[],error:" CSV .         ."};const r=s[0].replace(/^\uFEFF/,""),a=(r.match(/,/g)||[]).length,o=(r.match(/;/g)||[]).length,l=r.includes("	"),c=o>a?";":a>0?",":l?"	":",",i=Rp(r,c);if(!i.length)return{drafts:[],error:"  CSV  .    : odakanitNo,assignedLawyer"};const u=i.map(R=>wb(R)),p=u.findIndex(R=>R==="odakanitno"),y=u.findIndex(R=>R==="assignedlawyer");if(p<0||y<0)return{drafts:[],error:`   .       : odakanitNo,assignedLawyer ( ). :
odakanitNo,assignedLawyer`};const b=[],w=new Set;for(let R=1;R<s.length;R+=1){const E=s[R];if(!E)continue;const W=Rp(E,c),N=W[p]||"",h=Se(N);if(!h||w.has(h))continue;w.add(h);const S=(W[y]||"").trim();if(!S)return{drafts:[],error:` ${R+1}  AssignedLawyer   ${h}.    /  .`,delimiter:c};const P=S.toLowerCase();if(!ws.find(V=>V.id.toLowerCase()===P||V.username.toLowerCase()===P)){const V=ws.map(X=>`${X.username} (id: ${X.id})`).join(", ");return{drafts:[],error:` ${R+1}  AssignedLawyer="${S}"   ${h}     .
       (id)    .
  : ${V}`,delimiter:c}}b.push({odakanitNo:h,assignedLawyer:S,reports:[],status:"MISSING_HISTORY"})}return b.length?{drafts:b,delimiter:c}:{drafts:[],error:"    CSV.       odakanitNo assignedLawyer  .",delimiter:c}},Dh=e=>{try{return JSON.stringify(e)}catch{return"[]"}},Eb=()=>{if(typeof window>"u")return[];try{const e=window.localStorage.getItem(Ku);if(!e)return[];const t=JSON.parse(e);return Array.isArray(t)?t:[]}catch{return[]}},kb=e=>{if(!(typeof window>"u"))try{window.localStorage.setItem(Ku,Dh(e))}catch{}},Ab=()=>{if(typeof window>"u")return!1;try{return window.localStorage.getItem(Ch)==="1"}catch{return!1}},Ib=()=>{if(!(typeof window>"u"))try{window.localStorage.setItem(Ch,"1")}catch{}},Tb=(e,t,s=Sb)=>{if(!e)return!1;const{odakanitNo:r,seededAt:a,seedSourceLastReportNo:o,seedSourceLastReportDate:l}=e,c=Se(r);if(!c||!!!(a||o||l))return!1;const u=t.filter(p=>!p.deletedAt&&Se(p.odakanitNo)===c);if(u.length>0){const p=typeof o=="number"?o:0,y=l?new Date(l).getTime():0;let b=0,w=0;if(u.forEach(R=>{typeof R.reportNumber=="number"&&R.reportNumber>b&&(b=R.reportNumber);const E=new Date(R.sentAt||R.reportDate).getTime();!Number.isNaN(E)&&E>w&&(w=E)}),b>p&&p>0||w>y&&y>0)return!0}if(a){const p=new Date(a).getTime();if(!Number.isNaN(p)&&(Date.now()-p)/(1e3*60*60*24)>s)return!0}return!!(a&&(o==null||Number.isNaN(o)))},Rb=({caseFolders:e,onUpdateCaseFolders:t,reports:s})=>{const[r,a]=g.useState(()=>Eb()),[o,l]=g.useState(""),[c,i]=g.useState(null),[u,p]=g.useState(!1),[y,b]=g.useState(null),[w,R]=g.useState(null);g.useEffect(()=>{kb(r)},[r]);const E=Ab(),W=g.useMemo(()=>r.find(j=>j.odakanitNo===c)||null,[r,c]),N=()=>{const j=`odakanitNo,assignedLawyer
`,F=new Blob([j],{type:"text/csv;charset=utf-8;"}),L=URL.createObjectURL(F),O=document.createElement("a");O.href=L,O.download="seed-cases-template.csv",document.body.appendChild(O),O.click(),document.body.removeChild(O),URL.revokeObjectURL(L)},h=()=>{const{drafts:j,error:F,delimiter:L}=jb(o);if(F){b(F),R(null);return}b(null),j.length?R(`Loaded ${j.length} cases. Detected delimiter: "${L||","}".`):R(null),a(j)},S=()=>{const j=Dh(r),F=new Blob([j],{type:"application/json;charset=utf-8;"}),L=URL.createObjectURL(F),O=document.createElement("a");O.href=L,O.download="seedDraftCases_v1.json",document.body.appendChild(O),O.click(),document.body.removeChild(O),URL.revokeObjectURL(L)},P=()=>{window.confirm("   -Seed (   CaseFolders)?")&&(a([]),typeof window<"u"&&window.localStorage.removeItem(Ku))},U=()=>{window.confirm(" Finalize    . ?")&&Ib()},V=j=>j.status==="APPLIED"?"APPLIED":j.reports&&j.reports.length>0?"READY":"MISSING_HISTORY",X=j=>{j.reports.length&&(t(F=>{var Pe,Ke,Ye,it;const L=Se(j.odakanitNo);if(!L)return F;const O=F[L],H=new Date().toISOString(),M=O||{odakanitNo:L,reTemplate:(O==null?void 0:O.reTemplate)||"",insuredName:(O==null?void 0:O.insuredName)||"",insurerName:(O==null?void 0:O.insurerName)||"",plaintiffName:(O==null?void 0:O.plaintiffName)||"",marketRef:(O==null?void 0:O.marketRef)||"",lineSlipNo:(O==null?void 0:O.lineSlipNo)||"",certificateRef:(O==null?void 0:O.certificateRef)||"",createdAt:(O==null?void 0:O.createdAt)||H,updatedAt:(O==null?void 0:O.updatedAt)||H,reportIds:(O==null?void 0:O.reportIds)||[],sentReports:(O==null?void 0:O.sentReports)||[]},I=[...M.sentReports];let D=0,J=null;j.reports.forEach(q=>{if(!q.reportNo||!q.title||!q.sentAt)return;const se=I.findIndex(re=>re.reportNo===q.reportNo),C={odakanitNo:L,reportNumber:q.reportNo,insurerName:M.insurerName,insuredName:j.insuredName||M.insuredName,plaintiffName:j.plaintiffName||M.plaintiffName,reportSubject:q.title,reportDate:q.sentAt};se>=0?I[se]={...I[se],reportNo:q.reportNo,sentAt:q.sentAt,snapshot:{...I[se].snapshot||{},...C}}:I.push({reportId:`seed-${L.replace(/[^\w-]+/g,"_")}-${q.reportNo}`,reportNo:q.reportNo,sentAt:q.sentAt,fileName:void 0,snapshot:C}),q.reportNo>D&&(D=q.reportNo),q.sentAt&&(!J||q.sentAt>J)&&(J=q.sentAt)}),I.sort((q,se)=>(q.reportNo||0)-(se.reportNo||0));const ue=((Pe=j.insuredName)==null?void 0:Pe.trim())||M.insuredName||void 0,ce=((Ke=j.plaintiffName)==null?void 0:Ke.trim())||M.plaintiffName||void 0,le=((Ye=j.lineSlipNo)==null?void 0:Ye.trim())||M.lineSlipNo||void 0,fe=((it=j.marketRef)==null?void 0:it.trim())||M.marketRef||void 0,Ee=[];(ue||ce)&&Ee.push(`Re: ${ue||""}${ue&&ce?" / ":""}${ce||""}`.trim()),le&&Ee.push(`LineSlip No. ${le}`),fe&&Ee.push(`Unique Market Ref: ${fe}`);const ve=Ee.join(`
`),$e={...M,insuredName:ue||M.insuredName,plaintiffName:ce||M.plaintiffName,lineSlipNo:le||M.lineSlipNo,marketRef:fe||M.marketRef,assignedLawyer:j.assignedLawyer||(O==null?void 0:O.assignedLawyer),reTemplate:ve||M.reTemplate,seededAt:H,seedSourceLastReportNo:D||M.seedSourceLastReportNo,seedSourceLastReportDate:J||M.seedSourceLastReportDate,updatedAt:H,sentReports:I};return{...F,[L]:$e}}),a(F=>F.map(L=>L.odakanitNo===j.odakanitNo?{...L,status:"APPLIED"}:L)))},te=r.map(j=>{const F=V(j),L=j.reports.length,O=L>0?j.reports.map(J=>J.sentAt).filter(Boolean).sort().slice(-1)[0]:"",H=e[Se(j.odakanitNo)],M=Tb(H,s),I=(H==null?void 0:H.seededAt)||null,D=H!=null&&H.seedSourceLastReportNo&&H.seedSourceLastReportDate?`#${H.seedSourceLastReportNo} (${H.seedSourceLastReportDate})`:"";return{draft:j,status:F,reportsCount:L,lastDate:O,stale:M,lastSeedInfo:I,seedSummary:D}}).filter(j=>u?j.stale:!0),G=r.length,ae=r.filter(j=>V(j)==="APPLIED").length;return n.jsxs("div",{className:"mt-6 border border-slate-200 rounded-xl p-4 bg-white",children:[n.jsxs("div",{className:"flex items-center justify-between mb-3",children:[n.jsxs("div",{className:"space-y-0.5",children:[n.jsx("h2",{className:"text-sm font-semibold text-slate-900",children:"Seed Existing Cases (Admin only)"}),n.jsxs("div",{className:"text-[11px] text-slate-600",children:[n.jsxs("span",{className:"font-semibold",children:[ae," / ",G||0]})," ","cases completed",G>0&&ae===G&&n.jsx("span",{className:"ml-2 text-emerald-600 font-medium",children:" All cases completed"})]})]}),E&&n.jsx("span",{className:"text-[11px] px-2 py-0.5 rounded-full bg-emerald-50 text-emerald-700 border border-emerald-200",children:"Finalized  read only"})]}),n.jsxs("div",{className:"grid md:grid-cols-2 gap-4 text-xs",children:[n.jsxs("div",{className:"space-y-2",children:[n.jsx("h3",{className:"font-semibold text-slate-800",children:"1) Download Template CSV"}),n.jsx("p",{className:"text-slate-600",children:"       CSV   .  : odakanitNo, assignedLawyer."}),n.jsx("button",{type:"button",className:"px-3 py-1.5 rounded bg-slate-800 text-white hover:bg-slate-900",onClick:N,children:"Download Seed Template (CSV)"})]}),n.jsxs("div",{className:"space-y-2",children:[n.jsx("h3",{className:"font-semibold text-slate-800",children:"2) Import Cases CSV"}),n.jsx("p",{className:"text-slate-600",children:"     CSV (  )  Parse.      (localStorage)."}),n.jsx("textarea",{className:"w-full border border-slate-300 rounded p-2 h-24 font-mono",value:o,onChange:j=>l(j.target.value),disabled:E}),y&&n.jsx("div",{className:"mt-1 text-[11px] text-rose-700 bg-rose-50 border border-rose-200 rounded px-2 py-1 whitespace-pre-line",children:y}),w&&!y&&n.jsx("div",{className:"mt-1 text-[11px] text-slate-600",children:w}),n.jsx("button",{type:"button",className:"px-3 py-1.5 rounded bg-blue-600 text-white hover:bg-blue-700 disabled:opacity-50",onClick:h,disabled:E,children:"Parse CSV"})]})]}),n.jsxs("div",{className:"mt-4",children:[n.jsxs("div",{className:"flex items-center justify-between mb-1",children:[n.jsx("h3",{className:"text-xs font-semibold text-slate-800",children:"Imported Cases"}),n.jsxs("label",{className:"flex items-center gap-1 text-[11px] text-slate-600",children:[n.jsx("input",{type:"checkbox",className:"rounded border-slate-300",checked:u,onChange:j=>p(j.target.checked)}),"Show only stale cases"]})]}),te.length===0?n.jsx("p",{className:"text-xs text-slate-500",children:"   ."}):n.jsx("div",{className:"border border-slate-200 rounded overflow-hidden",children:n.jsxs("table",{className:"min-w-full text-[11px]",children:[n.jsx("thead",{className:"bg-slate-50",children:n.jsxs("tr",{children:[n.jsx("th",{className:"px-2 py-1 text-right",children:"odakanitNo"}),n.jsx("th",{className:"px-2 py-1 text-right",children:"Lawyer"}),n.jsx("th",{className:"px-2 py-1 text-right",children:"Status"}),n.jsx("th",{className:"px-2 py-1 text-right",children:"Fresh / Stale"}),n.jsx("th",{className:"px-2 py-1 text-right",children:"#Reports"}),n.jsx("th",{className:"px-2 py-1 text-right",children:"Last date"}),n.jsx("th",{className:"px-2 py-1 text-right",children:"Actions"})]})}),n.jsx("tbody",{children:te.map(({draft:j,status:F,reportsCount:L,lastDate:O,stale:H,lastSeedInfo:M,seedSummary:I})=>{var D;return n.jsxs("tr",{className:`border-t border-slate-200 ${H?"bg-amber-50":""}`,children:[n.jsx("td",{className:"px-2 py-1 font-mono",children:j.odakanitNo}),n.jsx("td",{className:"px-2 py-1",children:j.assignedLawyer||((D=ws.find(J=>J.id===j.assignedLawyer||J.username===j.assignedLawyer))==null?void 0:D.name)||""}),n.jsx("td",{className:"px-2 py-1",children:F==="APPLIED"?"APPLIED":F==="READY"?"READY":"MISSING_HISTORY"}),n.jsx("td",{className:"px-2 py-1",children:F==="APPLIED"?n.jsxs("div",{className:"space-y-0.5",children:[n.jsx("div",{className:H?"text-amber-700 font-semibold":"text-emerald-700 font-semibold",children:H?"STALE":"FRESH"}),M&&n.jsxs("div",{className:"text-[9px] text-slate-500",children:["Last seeded: ",new Date(M).toLocaleDateString()]}),I&&n.jsxs("div",{className:"text-[9px] text-slate-500",children:["Seed based on ",I]})]}):n.jsx("span",{className:"text-[10px] text-slate-400",children:""})}),n.jsx("td",{className:"px-2 py-1 text-center",children:L}),n.jsx("td",{className:"px-2 py-1",children:O||""}),n.jsxs("td",{className:"px-2 py-1 text-left",children:[n.jsx("button",{type:"button",className:"px-2 py-0.5 rounded border border-slate-300 text-slate-700 hover:bg-slate-50 mr-2",onClick:()=>i(j.odakanitNo),disabled:E,children:H?"Re-seed":"Edit"}),n.jsx("button",{type:"button",className:"px-2 py-0.5 rounded border border-emerald-400 text-emerald-700 hover:bg-emerald-50 disabled:opacity-50",onClick:()=>X(j),disabled:F==="MISSING_HISTORY"||E,children:"Apply"})]})]},j.odakanitNo)})})]})})]}),W&&n.jsx("div",{className:"mt-6 border-t border-slate-200 pt-4",children:n.jsx(Cb,{draft:W,index:r.findIndex(j=>j.odakanitNo===W.odakanitNo),total:r.length,finalized:E,onChangeDraft:j=>{a(F=>F.map(L=>L.odakanitNo===j.odakanitNo?j:L))},onApply:X,onNavigateRelative:j=>{const F=r.findIndex(O=>O.odakanitNo===W.odakanitNo);if(F<0)return;const L=F+j;L<0||L>=r.length||i(r[L].odakanitNo)},onResetSeedMeta:()=>{const j=Se(W.odakanitNo);j&&(t(F=>{const L=F[j];if(!L)return F;const{seededAt:O,seedSourceLastReportNo:H,seedSourceLastReportDate:M,...I}=L;return{...F,[j]:I}}),a(F=>F.map(L=>L.odakanitNo===W.odakanitNo?{...L,reports:[],status:"MISSING_HISTORY"}:L)))}})}),n.jsxs("div",{className:"mt-4 flex flex-wrap gap-2 text-xs",children:[n.jsx("button",{type:"button",className:"px-3 py-1.5 rounded border border-slate-300 text-slate-700 hover:bg-slate-50",onClick:S,children:"Export Draft JSON"}),n.jsx("button",{type:"button",className:"px-3 py-1.5 rounded border border-rose-300 text-rose-700 hover:bg-rose-50",onClick:P,disabled:E,children:"Clear Draft Only"}),n.jsx("button",{type:"button",className:"px-3 py-1.5 rounded border border-emerald-400 text-emerald-700 hover:bg-emerald-50 ml-auto disabled:opacity-50",onClick:U,disabled:E,children:"Finalize (readonly)"})]})]})};function Cb({draft:e,index:t,total:s,finalized:r,onChangeDraft:a,onApply:o,onNavigateRelative:l,onResetSeedMeta:c}){const[i,u]=g.useState(null),[p,y]=g.useState([]),[b,w]=g.useState([]),[R,E]=g.useState(!1),W=g.useRef([]),N=g.useRef(null);g.useEffect(()=>{u(null),y([]),w([])},[e.odakanitNo]),g.useEffect(()=>{const F=L=>{var D;if(!e||r)return;const O=(D=L.clipboardData)==null?void 0:D.items;if(!O||O.length===0)return;const H=Array.from(O).find(J=>J.type&&J.type.startsWith("image/"));if(!H){u("Clipboard does not contain an image.");return}const M=H.getAsFile();if(!M)return;const I=new FileReader;I.onload=()=>{const J=I.result;a({...e,screenshotDataUrl:J}),u(null)},I.readAsDataURL(M)};return window.addEventListener("paste",F),()=>{window.removeEventListener("paste",F)}},[e,r,a]),g.useEffect(()=>{const F=L=>{const O=L.target,H=O&&(O.tagName==="INPUT"||O.tagName==="TEXTAREA"||O.isContentEditable),I=navigator.platform.toUpperCase().includes("MAC")?L.metaKey:L.ctrlKey;if(!(H&&!I)){if(I&&!L.shiftKey&&!L.altKey&&L.key.toLowerCase()==="s"){if(L.preventDefault(),!r){if(h())return;o(e)}return}if(I&&L.shiftKey&&!L.altKey&&L.key.toLowerCase()==="o"){L.preventDefault(),!r&&e.screenshotDataUrl&&!R&&te();return}if(I&&!L.shiftKey&&!L.altKey&&L.key==="Enter"){L.preventDefault(),r||S();return}if(I&&L.altKey&&(L.key==="ArrowDown"||L.key==="ArrowUp")){L.preventDefault();const D=L.key==="ArrowDown"?1:-1;if(h(!0)&&!window.confirm("This case has invalid rows. Navigate to another case anyway?"))return;l(D)}if(!I&&!L.altKey&&!L.shiftKey&&L.key==="/"){const D=document.getElementById("seed-cases-search-input");D&&(L.preventDefault(),D.focus())}}};return window.addEventListener("keydown",F),()=>{window.removeEventListener("keydown",F)}},[e,r,o,l,R]);const h=(F=!1)=>{var M;const L=[];let O=!1;if(!e.reports||e.reports.length===0)return u("   ."),!0;const H=new Set;if(e.reports.forEach((I,D)=>{const J={};!Number.isInteger(I.reportNo)||I.reportNo<=0?J.reportNo="     .":H.has(I.reportNo)?J.reportNo="  .":H.add(I.reportNo),I.sentAt?Number.isNaN(new Date(I.sentAt).getTime())&&(J.sentAt="  ."):J.sentAt=" .",(!I.title||I.title.trim().length<2)&&(J.title="  ( 2 )."),(J.reportNo||J.sentAt||J.title)&&(O=!0),L[D]=J}),y(L),u(O?"    .":null),O&&!F){const I=L.findIndex(D=>D.reportNo||D.sentAt||D.title);I>=0&&W.current[I]&&((M=W.current[I])==null||M.focus())}return O},S=()=>{const F=e.reports.length>0?Math.max(...e.reports.map(O=>O.reportNo||0)):0,L={...e,reports:[...e.reports,{reportNo:F+1,sentAt:"",title:""}]};a(L)},P=F=>{const L=e.reports[F],O=e.reports.length>0?Math.max(...e.reports.map(D=>D.reportNo||0)):0,M={reportNo:(L&&Number.isInteger(L.reportNo)&&L.reportNo>0?L.reportNo:O)+1,sentAt:"",title:""},I=[...e.reports];I.splice(F+1,0,M),a({...e,reports:I}),setTimeout(()=>{const D=W.current[F+1];D&&D.focus()},0)},U=(F,L)=>{F.key==="Enter"&&F.shiftKey&&!F.ctrlKey&&!F.metaKey&&!F.altKey&&(F.preventDefault(),r||P(L))},V=(F,L,O)=>{const H=e.reports.map((M,I)=>I===F?{...M,[L]:L==="reportNo"?Number(O.replace(/[^\d]/g,""))||0:O}:M);a({...e,reports:H})},X=F=>{const L=e.reports.filter((O,H)=>H!==F);a({...e,reports:L})},te=async()=>{if(e.screenshotDataUrl){E(!0);try{const{previousReports:F,identifiers:L}=await bb(e.screenshotDataUrl);w(F);const O={...e,insuredName:L.insuredName||e.insuredName,plaintiffName:L.plaintiffOrClaimant||e.plaintiffName,lineSlipNo:L.lineSlipNo||e.lineSlipNo,marketRef:L.marketRef||e.marketRef};a(O),F.length?u(null):u("   .   .")}catch{u("OCR .   .")}finally{E(!1)}}},G=()=>{if(!b.length)return;const F=b.filter(L=>L.reportNo&&L.sentAt&&L.title).map(L=>({reportNo:L.reportNo,sentAt:L.sentAt,title:L.title}));F.length&&(a({...e,reports:F}),u(null),y([]))},ae=F=>{var H;const L=(H=F.target.files)==null?void 0:H[0];if(!L)return;const O=new FileReader;O.onload=()=>{const M=O.result;a({...e,screenshotDataUrl:M}),u(null)},O.readAsDataURL(L)},j=e.screenshotDataUrl;return n.jsxs("div",{className:"mt-2 rounded-lg border border-slate-200 bg-slate-50 p-3 text-[11px] relative",children:[n.jsxs("div",{className:"flex items-center justify-between mb-2",children:[n.jsxs("div",{className:"font-semibold text-slate-800",children:["Case editor  ",e.odakanitNo," ",n.jsxs("span",{className:"text-slate-500",children:["(",t+1,"/",s,")"]})]}),n.jsxs("div",{className:"flex items-center gap-3",children:[n.jsx("button",{type:"button",className:"text-[10px] px-2 py-1 rounded border border-amber-300 text-amber-700 hover:bg-amber-50",onClick:c,disabled:r,children:"Re-seed this case"}),n.jsx("div",{className:"text-[10px] text-slate-500 hidden md:block",children:" : Ctrl+S / S  Apply, Ctrl+Enter   , Ctrl+Shift+O  OCR, Ctrl+Alt+/   "})]})]}),i&&n.jsx("div",{className:"mb-2 rounded bg-amber-50 border border-amber-200 px-2 py-1 text-[11px] text-amber-900",children:i}),n.jsxs("div",{className:"grid md:grid-cols-2 gap-3",children:[n.jsxs("div",{className:"space-y-2",children:[n.jsx("div",{className:"font-semibold text-slate-800",children:"Screenshot / OCR"}),n.jsxs("div",{ref:N,tabIndex:0,className:"border border-dashed border-slate-300 rounded-lg p-2 text-center text-slate-600 bg-white cursor-pointer hover:border-slate-400 focus:outline-none focus:ring-1 focus:ring-slate-400",onClick:()=>{var F;return(F=N.current)==null?void 0:F.focus()},children:[n.jsx("div",{className:"mb-1 font-medium text-slate-800",children:"Click here and press Ctrl+V / V to paste screenshot"}),n.jsx("div",{className:"text-[10px] text-slate-500 mb-2",children:"or choose file from disk"}),n.jsx("input",{type:"file",accept:"image/*",onChange:ae,disabled:r,className:"mx-auto block text-[10px]"})]}),j&&n.jsxs("div",{className:"mt-2",children:[n.jsx("div",{className:"text-[10px] text-slate-600 mb-1",children:"Preview:"}),n.jsx("div",{className:"border border-slate-200 rounded overflow-hidden bg-white max-h-64 flex items-center justify-center",children:n.jsx("img",{src:j,alt:"Seed screenshot",className:"max-h-64"})})]}),n.jsx("div",{className:"flex items-center gap-2 mt-2",children:n.jsx("button",{type:"button",onClick:te,disabled:!j||r||R,className:"px-3 py-1.5 rounded bg-indigo-600 text-white disabled:opacity-50 text-[11px]",children:R?"Running OCR":"Extract Previous Reports from Screenshot"})}),b.length>0&&n.jsxs("div",{className:"mt-2 border border-slate-200 rounded bg-white p-2",children:[n.jsxs("div",{className:"flex items-center justify-between mb-1",children:[n.jsxs("div",{className:"font-semibold text-slate-800 text-[11px]",children:["Proposed extraction (",b.length,")"]}),n.jsx("button",{type:"button",className:"px-2 py-0.5 rounded bg-slate-800 text-white text-[10px]",onClick:G,disabled:r,children:"Apply to table"})]}),n.jsx("div",{className:"max-h-40 overflow-auto text-[10px]",children:n.jsxs("table",{className:"min-w-full border-collapse",children:[n.jsx("thead",{children:n.jsxs("tr",{className:"bg-slate-50",children:[n.jsx("th",{className:"px-1 py-0.5 text-right",children:"#"}),n.jsx("th",{className:"px-1 py-0.5 text-right",children:"Title"}),n.jsx("th",{className:"px-1 py-0.5 text-right",children:"Date"}),n.jsx("th",{className:"px-1 py-0.5 text-right",children:"Conf."})]})}),n.jsx("tbody",{children:b.map((F,L)=>n.jsxs("tr",{className:"border-t border-slate-100",children:[n.jsx("td",{className:"px-1 py-0.5 text-right",children:F.reportNo??""}),n.jsx("td",{className:"px-1 py-0.5 text-right",children:F.title||""}),n.jsx("td",{className:"px-1 py-0.5 text-right",children:F.sentAt||""}),n.jsx("td",{className:"px-1 py-0.5 text-right",children:typeof F.confidence=="number"?`${Math.round(F.confidence)}%`:""})]},L))})]})})]})]}),n.jsxs("div",{className:"space-y-3",children:[n.jsxs("div",{className:"flex items-center justify-between",children:[n.jsx("div",{className:"font-semibold text-slate-800",children:"Previous reports table"}),n.jsx("button",{type:"button",onClick:S,disabled:r,className:"px-2 py-1 rounded border border-slate-300 text-[10px] hover:bg-slate-100",children:"+ Add row (Ctrl+Enter)"})]}),n.jsx("div",{className:"border border-slate-200 rounded bg-white max-h-72 overflow-auto",children:n.jsxs("table",{className:"min-w-full text-[11px]",children:[n.jsx("thead",{className:"bg-slate-50",children:n.jsxs("tr",{children:[n.jsx("th",{className:"px-1 py-1 text-right w-16",children:"Report #"}),n.jsx("th",{className:"px-1 py-1 text-right w-32",children:"Date"}),n.jsx("th",{className:"px-1 py-1 text-right",children:"Title"}),n.jsx("th",{className:"px-1 py-1 text-left w-16"})]})}),n.jsx("tbody",{children:e.reports.length===0?n.jsx("tr",{children:n.jsx("td",{colSpan:4,className:"px-2 py-2 text-center text-slate-400 text-[10px]",children:"  .      OCR ."})}):e.reports.map((F,L)=>{var O,H,M,I,D,J,ue,ce,le;return n.jsxs("tr",{className:"border-t border-slate-100",children:[n.jsxs("td",{className:"px-1 py-1 align-top",children:[n.jsx("input",{ref:fe=>{W.current[L]=fe},type:"number",className:`w-full border rounded px-1 py-0.5 text-[11px] ${(O=p[L])!=null&&O.reportNo?"border-rose-400":"border-slate-300"}`,value:F.reportNo??"",onChange:fe=>V(L,"reportNo",fe.target.value),onKeyDown:fe=>U(fe,L),disabled:r}),((H=p[L])==null?void 0:H.reportNo)&&n.jsx("div",{className:"mt-0.5 text-[9px] text-rose-600",children:(M=p[L])==null?void 0:M.reportNo})]}),n.jsxs("td",{className:"px-1 py-1 align-top",children:[n.jsx("input",{type:"date",className:`w-full border rounded px-1 py-0.5 text-[11px] ${(I=p[L])!=null&&I.sentAt?"border-rose-400":"border-slate-300"}`,value:F.sentAt||"",onChange:fe=>V(L,"sentAt",fe.target.value),onKeyDown:fe=>U(fe,L),disabled:r}),((D=p[L])==null?void 0:D.sentAt)&&n.jsx("div",{className:"mt-0.5 text-[9px] text-rose-600",children:(J=p[L])==null?void 0:J.sentAt})]}),n.jsxs("td",{className:"px-1 py-1 align-top",children:[n.jsx("input",{type:"text",className:`w-full border rounded px-1 py-0.5 text-[11px] ${(ue=p[L])!=null&&ue.title?"border-rose-400":"border-slate-300"}`,value:F.title,onChange:fe=>V(L,"title",fe.target.value),onKeyDown:fe=>U(fe,L),disabled:r}),((ce=p[L])==null?void 0:ce.title)&&n.jsx("div",{className:"mt-0.5 text-[9px] text-rose-600",children:(le=p[L])==null?void 0:le.title})]}),n.jsx("td",{className:"px-1 py-1 align-top text-left",children:n.jsx("button",{type:"button",onClick:()=>X(L),disabled:r,className:"px-1.5 py-0.5 rounded border border-slate-300 text-[10px] text-slate-700 hover:bg-slate-100",children:""})})]},L)})})]})}),n.jsxs("div",{className:"border border-slate-200 rounded bg-white p-2 space-y-2",children:[n.jsx("div",{className:"font-semibold text-slate-800 text-[11px]",children:"Extracted identifiers"}),n.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-2 text-[11px]",children:[n.jsxs("div",{className:"space-y-1",children:[n.jsx("label",{className:"block text-[10px] text-slate-600",children:"Insured"}),n.jsx("input",{type:"text",className:"w-full border rounded px-2 py-0.5 text-[11px] border-slate-300",value:e.insuredName||"",onChange:F=>a({...e,insuredName:F.target.value}),disabled:r})]}),n.jsxs("div",{className:"space-y-1",children:[n.jsx("label",{className:"block text-[10px] text-slate-600",children:"Plaintiff / Claimant"}),n.jsx("input",{type:"text",className:"w-full border rounded px-2 py-0.5 text-[11px] border-slate-300",value:e.plaintiffName||"",onChange:F=>a({...e,plaintiffName:F.target.value}),disabled:r})]}),n.jsxs("div",{className:"space-y-1",children:[n.jsx("label",{className:"block text-[10px] text-slate-600",children:"LineSlip No."}),n.jsx("input",{type:"text",className:"w-full border rounded px-2 py-0.5 text-[11px] border-slate-300",value:e.lineSlipNo||"",onChange:F=>a({...e,lineSlipNo:F.target.value}),disabled:r})]}),n.jsxs("div",{className:"space-y-1",children:[n.jsx("label",{className:"block text-[10px] text-slate-600",children:"Unique Market Ref"}),n.jsx("input",{type:"text",className:"w-full border rounded px-2 py-0.5 text-[11px] border-slate-300",value:e.marketRef||"",onChange:F=>a({...e,marketRef:F.target.value}),disabled:r})]})]})]})]})]}),n.jsx(vb,{})]})}const ul={title:"    ",subtitle:"     ,    ",actions:{openNewReport:"  "},queueItem:{noDate:" "}},Yu=(e,t)=>{console.error(`[LP-CRM] ${e}`,t)},Db=e=>{if(!e)return!1;const t=new Date(e);return Number.isNaN(t.getTime())?!1:t.getTime()>Date.now()},os=e=>{const{messageHe:t,...s}=e;return t?{...s,messageHe:t}:{...s,messageHe:{MISSING_PROVIDER:"    .",MISSING_DESCRIPTION:"  .",INVALID_DATE_FUTURE:"     .",INVALID_QUANTITY:"     -0.",INVALID_UNIT_PRICE:"     .",INVALID_VAT_RATE:"     .",NEGATIVE_AMOUNT:"     .",MISSING_ATTACHMENT_REQUIRED:"      .",SHEET_STATUS_INVALID_FOR_READY:"     -READY_FOR_REPORT.",SHEET_STATUS_INVALID_FOR_ATTACH:"     .",SHEET_STATUS_INVALID_FOR_SEND:"    .",SUMS_INCONSISTENT:"     .",INFO_ONLY_INCONSISTENT:'  " "     0.',SNAPSHOT_HASH_MISMATCH:"-Hash        ."}[s.code]||"  ."}},Lb=(e,t,s)=>{const r=s.filter(u=>u.severity==="ERROR").map(u=>u.code),a=s.filter(u=>u.severity==="WARNING").map(u=>u.code),o=!s.some(u=>u.code==="SUMS_INCONSISTENT"),l=!s.some(u=>u.code==="MISSING_ATTACHMENT_REQUIRED"&&u.severity==="ERROR"),c=!s.some(u=>["MISSING_PROVIDER","MISSING_DESCRIPTION"].includes(u.code)),i=!s.some(u=>u.code==="INFO_ONLY_INCONSISTENT");return{evaluatedAt:new Date().toISOString(),insurerId:e.insurerId||void 0,rulesetId:t==null?void 0:t.insurerId,rulesetVersion:t==null?void 0:t.rulesetVersion,checks:{sumsValid:o,attachmentsOk:l,requiredFieldsOk:c,infoOnlyConsistent:i},blockingIssueCodes:r,warningIssueCodes:a}},_b=e=>{const t=[];return e.kind==="EXPENSE"&&!e.providerName&&t.push(os({code:"MISSING_PROVIDER",severity:"ERROR",scope:"LINE_ITEM",entityId:e.id})),e.description||t.push(os({code:"MISSING_DESCRIPTION",severity:"ERROR",scope:"LINE_ITEM",entityId:e.id})),Db(e.date)&&t.push(os({code:"INVALID_DATE_FUTURE",severity:"WARNING",scope:"LINE_ITEM",entityId:e.id})),e.quantity!=null&&e.quantity<=0&&t.push(os({code:"INVALID_QUANTITY",severity:"ERROR",scope:"LINE_ITEM",entityId:e.id})),e.unitPrice!=null&&e.unitPrice<0&&t.push(os({code:"INVALID_UNIT_PRICE",severity:"ERROR",scope:"LINE_ITEM",entityId:e.id})),e.vatRate!=null&&e.vatRate<0&&t.push(os({code:"INVALID_VAT_RATE",severity:"ERROR",scope:"LINE_ITEM",entityId:e.id})),[e.lineNetAmount,e.lineVatAmount,e.lineTotalAmount].filter(r=>r!=null).some(r=>r<0)&&t.push(os({code:"NEGATIVE_AMOUNT",severity:"ERROR",scope:"LINE_ITEM",entityId:e.id})),t},Ob=(e,t,s,r)=>{if(!r)return[];const a=[],o={};s.forEach(c=>{o[c.id]=c});const l=r.amountThresholdRequiringAttachment??null;return t.forEach(c=>{const i=c.isIncludedInRequestedAmount!==!1,u=!!(c.attachmentId&&o[c.attachmentId]),p=c.lineTotalAmount??0;let y=!1;if(r.policyFamily==="STRICT")i&&c.kind==="EXPENSE"&&(!l||p>=l)&&(y=!0);else if(r.policyFamily==="PARTIAL"){const b=!!c.expenseType&&r.requireAttachmentForExpenseTypes.includes(c.expenseType),w=!!l&&p>=l;i&&(b||w)&&(y=!0)}else r.policyFamily==="FLEXIBLE"&&i&&c.kind==="EXPENSE"&&(!l||p>=l)&&(y=!0);if(y&&!u){const b=r.policyFamily==="FLEXIBLE"?"WARNING":"ERROR";a.push(os({code:"MISSING_ATTACHMENT_REQUIRED",severity:b,scope:"LINE_ITEM",entityId:c.id,messageHe:b==="ERROR"?"      .":"       ."}))}}),r.requiredAttachmentTypes.length>0&&a.push(os({code:"ATTACHMENT_TYPES_NOT_ENFORCED",severity:"INFO",scope:"SHEET",messageHe:"     ,      ."})),e.infoOnly&&a.length&&r.policyFamily,a},Mb=e=>{const{sheet:t,lineItems:s,attachments:r,ruleset:a}=e,o=[];s.forEach(i=>{o.push(..._b(i))});const l=Fn(t,s);t.infoOnly&&l.amountToRequest!==0&&o.push(os({code:"INFO_ONLY_INCONSISTENT",severity:"ERROR",scope:"SHEET"})),o.push(...Ob(t,s,r,a));const c=Lb(t,a,o);return{issues:o,decisionLog:c}},Cp=e=>Mb(e),Pb=e=>{if(!e)return"";const t=new Date(e);if(Number.isNaN(t.getTime()))return"";const s=String(t.getDate()).padStart(2,"0"),r=String(t.getMonth()+1).padStart(2,"0"),a=t.getFullYear();return`${s}/${r}/${a}`},as=e=>(e??0).toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2}),si=e=>{if(e.lineTotalAmount!=null)return e.lineTotalAmount;const t=e.lineNetAmount!=null?e.lineNetAmount:Ah(e.quantity??0,e.unitPrice??0),s=e.lineVatAmount!=null?e.lineVatAmount:Ih(t,e.vatRate??0);return Th(t,s)},Lh=(e,t,s)=>{const r=Fn(e,t),a=[`Expenses Table  Case ${e.caseId}`,"",`Deductible: ${as(e.deductibleAmount??0)}`,`Payments already made: ${as(e.alreadyPaidAmount??0)}`,`Amount to request: ${as(r.amountToRequest)}`,"","Expenses:"],o=[],l=[];let c=0;t.forEach(p=>{var V,X;const y=Pb(p.date||null),b=p.providerName||"",w=p.description||"",R=p.kind==="EXPENSE"?"Expense":p.kind==="COMPENSATION"?p.compensationSource==="COURT"?"Compensation pursuant to a judgment":"Compensation pursuant to a settlement":"Adjustment",E=((V=s==null?void 0:s.isNewLine)==null?void 0:V.call(s,p))??!1,W=((X=s==null?void 0:s.isHistoricalLine)==null?void 0:X.call(s,p))??!1,N=as(si(p)),h=p.vatRate!=null?`, VAT ${p.vatRate}%`:"",S=p.isIncludedInRequestedAmount===!1?" (not included in request)":"",U=` ${y||"-"}  ${E?"[] ":W?"[] ":""}${w}${b?` (${b})`:""}  ${N} (${R}${h})${S}`;if(p.kind==="EXPENSE"){const te=si(p);E&&(c+=te),o.push(U)}else l.push(U)}),o.length||o.push(" No expense items.");const i=s&&typeof s.newExpensesTotal=="number"?s.newExpensesTotal:c;return{text:[...a,...o,"","Adjustments and compensations:",...l.length?l:[" No adjustments or compensations."],"",...i>0?[`Current report expenses only: ${as(i)}`]:[],`Total gross expenses: ${as(r.grossExpensesTotal)}`,`Total deductions (Deductible + Payments already made + adjustments): ${as(r.adjustmentsTotal)}`,`Amount to request: ${as(r.amountToRequest)}`].join(`
`),totals:r}},ri=(e,t,s)=>{const r=Fn(e,t),a=r.amountToRequest<=0,o=[],l=(S,P,U)=>{const V=U!=null&&U.isTotal?"total-balance-row":U!=null&&U.isSummary?"summary-row":"",X=(U==null?void 0:U.rowClass)??"",te=`${V} ${X}`.trim();o.push(`<tr class="${te}"><td>${Fb(S)}</td><td class="amount-cell">${as(P??0)}</td></tr>`)},c=t.filter(S=>S.kind==="EXPENSE");let i=0;const u=c.reduce((S,P)=>{var L,O;const U=si(P),V=((L=s==null?void 0:s.isNewLine)==null?void 0:L.call(s,P))??!1,X=((O=s==null?void 0:s.isHistoricalLine)==null?void 0:O.call(s,P))??!1;V&&(i+=U);const te=P.providerName?` (${P.providerName})`:"",G=P.description?`${P.description}${te}`:te||"Expense",j=`${V?"  ":X?"  ":""}${G}`;return l(j,U,{rowClass:V?"expense-row-new":X?"expense-row-history":""}),S+U},0),p=e.deductibleAmount??0;t.filter(S=>S.kind==="COMPENSATION").forEach(S=>{const P=S.compensationSource==="COURT"?"Court-awarded compensation":"Settlement compensation";l(P,si(S))}),l("Total expenses so far",u,{isSummary:!0});const b=s&&typeof s.newExpensesTotal=="number"?s.newExpensesTotal:i;b>0&&l("Current report expenses only",b,{isSummary:!0}),l("Deductible",p,{isSummary:!0}),l("Payments already made",e.alreadyPaidAmount??0,{isSummary:!0}),l(a?"Total Balance Due (no payment requested)":"Total Balance Due",r.amountToRequest,{isTotal:!0});const w=['<div class="expenses-table-wrapper">','<table class="expenses-table">',"<thead>",'<tr><th>Expenses</th><th class="amount-cell">Amount ()</th></tr>',"</thead>","<tbody>",...o,"</tbody>","</table>","</div>"].join(""),R=t.some(S=>S.kind==="COMPENSATION"&&S.compensationSource!=="COURT"),E=t.some(S=>S.kind==="COMPENSATION"&&S.compensationSource==="COURT"),W=`${as(r.amountToRequest)}`;let N;return E?N='<p class="expenses-payment-note">Pursuant to the judgment rendered in this matter, we kindly request that the Insurer arrange payment of the total amount set out in the attached Expenses Table, in order to bring this claim to a conclusion.<br/><br/><strong>Payment is required within 30 days of receipt of this report.</strong></p>':R?a?N='<p class="expenses-payment-note">Although a settlement has been agreed in principle, the total expenses and compensation fall within the applicable deductible. Accordingly, no payment is required from the Insurer in respect of this claim.</p>':N=`<p class="expenses-payment-note">Should the Insurer approve the settlement, we would be obliged if the Insurer could arrange payment of ${W} to the Brokers bank account in order to bring this claim to a conclusion. This amount represents an all-inclusive settlement, covering both the agreed compensation and the associated expenses. In the event that the settlement is not approved, no payment is required at this stage.</p>`:N=a?'<p class="expenses-payment-note">Given that the deductible exceeds the total expenses incurred in this matter, the Insurer is not required to make any payment in respect of this claim.</p>':`<p class="expenses-payment-note">Accordingly, we would appreciate it if the Insurer could transfer the amount of ${W} to the Brokers bank account.</p>`,{html:w+N+'<p class="expenses-payment-note">All amounts are stated in New Israeli Shekels ().</p>',totals:r}},Fb=e=>e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;"),Bb=({open:e,title:t,message:s,confirmText:r,cancelText:a,destructive:o=!1,onConfirm:l,onCancel:c})=>{const i=g.useRef(null);if(g.useEffect(()=>{if(!e)return;const y=b=>{b.key==="Escape"&&(b.stopPropagation(),c())};if(typeof window<"u"&&window.addEventListener("keydown",y),i.current)try{i.current.focus()}catch{}return()=>{typeof window<"u"&&window.removeEventListener("keydown",y)}},[e,c]),!e)return null;const u=y=>{y.target===y.currentTarget&&c()},p=o?"bg-danger text-white hover:bg-red-800":"bg-navy text-gold hover:bg-navySecondary";return n.jsx("div",{className:"fixed inset-0 z-[300] flex items-center justify-center bg-black/50",onClick:u,children:n.jsxs("div",{className:"bg-panel border border-borderDark rounded-xl shadow-xl max-w-md w-full mx-4 p-5 space-y-3",dir:"rtl",children:[n.jsx("h2",{className:"text-sm font-bold text-gold text-right",children:t}),s&&n.jsx("p",{className:"text-xs text-textMuted text-right whitespace-pre-line",children:s}),n.jsxs("div",{className:"flex justify-end gap-2 mt-4",children:[n.jsx("button",{type:"button",onClick:c,className:"px-3 py-1.5 rounded-md border border-borderDark text-xs text-textLight bg-navySecondary hover:bg-borderDark",children:a}),n.jsx("button",{type:"button",ref:i,onClick:l,className:`px-3 py-1.5 rounded-md text-xs font-semibold ${p}`,children:r})]})]})})},_h={DRAFT:"",READY_FOR_REPORT:" ",ATTACHED_TO_REPORT:" ",ARCHIVED:""};function Oh(e,t){if(t){if(t.status==="SENT")return t.isPaid?"":"  ";const r={TASK_ASSIGNED:" ",WAITING_FOR_INVOICES:" ",PENDING_REVIEW:" ",READY_TO_SEND:"   ",SENT:"  "}[t.status];if(r)return r}return _h[e.status]}function $b(e){return _h[e]}const Hb=[{value:"DRAFT",label:""},{value:"READY_FOR_REPORT",label:" "},{value:"ATTACHED_TO_REPORT",label:" "},{value:"ARCHIVED",label:""}],Ub=({user:e,sheet:t,paymentEvents:s,onChangeEvents:r})=>{const[a,o]=g.useState(""),[l,c]=g.useState(()=>new Date().toISOString().slice(0,10)),[i,u]=g.useState(""),[p,y]=g.useState(""),[b,w]=g.useState(!1),[R,E]=g.useState(null),W=async()=>{const S=Number(a);if(!Number.isFinite(S)||S<=0){E("     .");return}if(!l){E("    .");return}const U=new Date(l).getTime();if(Number.isNaN(U)){E("   .");return}const V=Date.now();if(U>V){E("     .");return}E(null),w(!0);try{const X=new Date(l).toISOString(),te=await Xe.createPaymentEvent(e,{caseId:t.caseId,sheetId:t.id,amount:S,paidAt:X,reference:i||null,note:p||null});r([...s,te]),o(""),u(""),y(""),E(null)}finally{w(!1)}},N=async S=>{await Xe.softDeletePaymentEvent(S),r(s.filter(P=>P.id!==S))},h=s.filter(S=>!S.isDeleted).sort((S,P)=>{const U=new Date(S.paidAt).getTime();return new Date(P.paidAt).getTime()-U});return n.jsxs("div",{className:"space-y-3",children:[n.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-2 items-end",children:[n.jsxs("div",{children:[n.jsx("label",{className:"block text-[11px] font-medium text-slate-700 mb-1",children:"  ()"}),n.jsx("input",{type:"number",className:"w-full border rounded px-2 py-1 text-xs",value:a,onChange:S=>o(S.target.value),min:0})]}),n.jsxs("div",{children:[n.jsx("label",{className:"block text-[11px] font-medium text-slate-700 mb-1",children:" "}),n.jsx("input",{type:"date",className:"w-full border rounded px-2 py-1 text-xs",value:l,onChange:S=>c(S.target.value)})]}),n.jsxs("div",{children:[n.jsx("label",{className:"block text-[11px] font-medium text-slate-700 mb-1",children:" (  / )"}),n.jsx("input",{type:"text",className:"w-full border rounded px-2 py-1 text-xs",value:i,onChange:S=>u(S.target.value)})]}),n.jsxs("div",{children:[n.jsx("label",{className:"block text-[11px] font-medium text-slate-700 mb-1",children:"  ()"}),n.jsxs("div",{className:"flex gap-2",children:[n.jsx("input",{type:"text",className:"flex-1 border rounded px-2 py-1 text-xs",value:p,onChange:S=>y(S.target.value)}),n.jsx("button",{type:"button",className:"px-3 py-1 text-xs rounded bg-emerald-600 text-white hover:bg-emerald-700 disabled:opacity-50",onClick:W,disabled:b,children:" "})]})]})]}),R&&n.jsx("div",{className:"text-[11px] text-red-600 px-1",children:R}),n.jsx("div",{className:"border-t border-slate-200 pt-2",children:h.length===0?n.jsx("p",{className:"text-[11px] text-slate-500",children:"    .       ."}):n.jsx("div",{className:"space-y-1",children:h.map(S=>n.jsxs("div",{className:"flex flex-wrap items-baseline gap-x-4 gap-y-1 rounded border border-slate-200 bg-white px-2 py-1",children:[n.jsxs("span",{className:"font-medium text-slate-800",children:["",S.amount.toLocaleString("he-IL")]}),n.jsxs("span",{className:"text-slate-600",children:[""," ",new Date(S.paidAt).toLocaleDateString("he-IL",{year:"numeric",month:"2-digit",day:"2-digit"})]}),S.reference&&n.jsxs("span",{className:"text-slate-600",children:[": ",S.reference]}),S.note&&n.jsxs("span",{className:"text-slate-600",children:[": ",S.note]}),n.jsx("button",{type:"button",className:"ml-auto text-xs text-red-600 hover:underline",onClick:()=>N(S.id),children:""})]},S.id))})})]})},Mh=({user:e,sheetWithRelations:t,onSheetUpdated:s,onBack:r,onNotifyLawyer:a,linkedReportForLawyer:o})=>{const[l,c]=g.useState(t.sheet),[i,u]=g.useState(t.lineItems),[p,y]=g.useState(!1),[b,w]=g.useState(null),[R,E]=g.useState(null),[W,N]=g.useState([]),[h,S]=g.useState(t.attachments),[P,U]=g.useState(!1),[V,X]=g.useState(""),[te,G]=g.useState([]),[ae,j]=g.useState([]),[F,L]=g.useState("AUTO"),[O,H]=g.useState([]),[M,I]=g.useState([]),[D,J]=g.useState([]),[ue,ce]=g.useState(null),[le,fe]=g.useState(""),[Ee,ve]=g.useState(!1),$e=(o==null?void 0:o.isPaid)===!0,Pe=$e&&e.role!=="ADMIN",Ke=$e&&e.role==="ADMIN",Ye=g.useMemo(()=>Xe.getPaidToDateForSheet(l),[l,M]),it=g.useMemo(()=>({...l,alreadyPaidAmount:Ye}),[l,Ye]);g.useEffect(()=>{c(t.sheet),u(t.lineItems),S(t.attachments),ve(!1),(async()=>{try{const ie=t.sheet.caseId,De=Se(ie);if(!De){H([]),I([]);return}const Me=await Xe.listPaymentsForCase(ie);I(Me);const Le=(await Xe.listSheets()).filter(_t=>_t.id!==t.sheet.id).filter(_t=>Se(_t.caseId)===De);if(!Le.length){H([]),J([]);return}Le.sort((_t,We)=>{const Qt=new Date(_t.updatedAt||_t.createdAt).getTime();return new Date(We.updatedAt||We.createdAt).getTime()-Qt});const st=Le.slice(0,3),ne=[],Be=[];for(const _t of st){const We=await Xe.getSheet(_t.id);if(!We)continue;const Qt=Xe.getPaidToDateForSheet(We.sheet),xn=Fn({...We.sheet,alreadyPaidAmount:Qt},We.lineItems),hn=We.lineItems.filter(Cs=>Cs.kind==="EXPENSE");Be.push(...hn),ne.push({id:We.sheet.id,versionIndex:We.sheet.versionIndex,status:We.sheet.status,createdAt:We.sheet.createdAt,updatedAt:We.sheet.updatedAt,deductibleAmount:We.sheet.deductibleAmount??0,alreadyPaidAmount:Qt,amountToRequest:xn.amountToRequest})}ne.sort((_t,We)=>{const Qt=new Date(_t.updatedAt||_t.createdAt).getTime();return new Date(We.updatedAt||We.createdAt).getTime()-Qt}),H(ne),J(Be);const Ct=Xe.buildCumulativeExpensesSnapshot(t.sheet.id,new Date().toISOString());if(Ct){const _t=Fn(Ct.effectiveSheet,Ct.allLines);ce(_t)}else ce(null)}catch{H([]),I([]),J([]),ce(null)}})()},[t]);const q=g.useMemo(()=>Fn(it,i),[it,i]),se=g.useMemo(()=>{const z=new Set;return W.forEach(ie=>{ie.scope==="LINE_ITEM"&&ie.entityId&&z.add(ie.entityId)}),z},[W]),C=()=>{const z=Cp({sheet:l,lineItems:i,attachments:h,ruleset:void 0});N(z.issues)};g.useEffect(()=>{C()},[l,i]),g.useEffect(()=>{if(!(typeof window>"u"))try{const z=window.localStorage.getItem("financeProviderSuggestions"),ie=window.localStorage.getItem("financeDescriptionSuggestions");if(z){const De=JSON.parse(z);Array.isArray(De)&&G(De.filter(Me=>typeof Me=="string"))}if(ie){const De=JSON.parse(ie);Array.isArray(De)&&j(De.filter(Me=>typeof Me=="string"))}}catch{}},[]),g.useEffect(()=>{if(typeof window>"u")return;const z=new Set(te);let ie=!1;if(i.forEach(pe=>{const Le=(pe.providerName||"").trim();Le&&!z.has(Le)&&(z.add(Le),ie=!0)}),ie){const pe=Array.from(z).sort((Le,st)=>Le.localeCompare(st,"he-IL"));G(pe);try{window.localStorage.setItem("financeProviderSuggestions",JSON.stringify(pe))}catch{}}const De=new Set(ae);let Me=!1;if(i.forEach(pe=>{const Le=(pe.description||"").trim();Le&&!De.has(Le)&&(De.add(Le),Me=!0)}),Me){const pe=Array.from(De).sort((Le,st)=>Le.localeCompare(st,"he-IL"));j(pe);try{window.localStorage.setItem("financeDescriptionSuggestions",JSON.stringify(pe))}catch{}}},[i]);const re=z=>{Pe||(ve(!0),c(ie=>({...ie,...z})))},Q=(z,ie)=>{Pe||(ve(!0),u(De=>{const Me=[...De];return Me[z]={...Me[z],...ie,sheetId:l.id},Me}))},he=()=>{if(Pe)return;ve(!0);const z={id:`tmp-${Date.now()}`,sheetId:l.id,kind:"EXPENSE",expenseType:null,providerName:"",providerId:null,description:"",date:new Date().toISOString().slice(0,10),quantity:1,unitPrice:0,vatRate:18,isIncludedInRequestedAmount:!0,lineNetAmount:null,lineVatAmount:null,lineTotalAmount:null,attachmentId:null,createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()};u(ie=>[...ie,z])},Fe=z=>{if(Pe)return;ve(!0);const ie=i[z];ie&&(u(De=>De.filter((Me,pe)=>pe!==z)),ie.id.startsWith("tmp-")||Xe.deleteLineItem(e,l.id,ie.id))},je=async z=>{if(Pe)return;const ie=Array.from(z);if(ie.length)for(let De=0;De<ie.length;De++){const Me=ie[De],pe=new FileReader,Le=await new Promise((ne,Be)=>{pe.onload=()=>ne(String(pe.result)),pe.onerror=()=>Be(pe.error),pe.readAsDataURL(Me)}),st=await Xe.addAttachment(e,l.id,{fileKey:Le,originalFileName:Me.name,mimeType:Me.type||"application/octet-stream",sizeBytes:Me.size});st&&(ve(!0),S(ne=>[...ne,st]))}},Te=async z=>{const{files:ie}=z.target;!ie||!ie.length||(await je(ie),z.target.value="")},et=async z=>{z.preventDefault(),z.stopPropagation();const{files:ie}=z.dataTransfer;!ie||!ie.length||await je(ie)},Ge=async(z,ie)=>{if(Pe)return;ve(!0);const De=ie||"";try{const Me=await Xe.linkAttachmentToLineItem(e,l.id,De,ie?z.id:null);S(pe=>pe.map(Le=>Me&&Le.id===Me.id?Me:!Me&&Le.id===De?{...Le,linkedLineItemId:ie?z.id:null}:Le)),u(pe=>pe.map(Le=>Le.id===z.id?{...Le,attachmentId:ie||null}:Le.id===z.attachmentId&&!ie?{...Le,attachmentId:null}:Le)),w(ie?" /     .":"    .")}catch(Me){console.error("Failed to link attachment to line item",Me)}},He=async()=>{if(Pe)return;if(Ke){const ie=le.trim();if(!ie){w("   (     ).");return}Xe.recordAdminEditAfterPaid(e,l.id,ie)}if(!((e.role==="SUB_ADMIN"||e.role==="ADMIN")&&!Ke&&(l.status==="READY_FOR_REPORT"||l.status==="ATTACHED_TO_REPORT"||l.status==="ARCHIVED")&&!window.confirm(`     (  /   / ).
         .

  ?`))){y(!0);try{const ie=await Xe.updateSheetMeta(e,l.id,{insurerName:l.insurerName,periodLabel:l.periodLabel,deductibleAmount:l.deductibleAmount??0,alreadyPaidAmount:l.alreadyPaidAmount??0,infoOnly:l.infoOnly}),De=[];for(const pe of i)if(pe.id.startsWith("tmp-")){const Le=await Xe.addLineItem(e,l.id,{kind:pe.kind,expenseType:pe.expenseType,providerName:pe.providerName,providerId:pe.providerId,description:pe.description,date:pe.date,quantity:pe.quantity,unitPrice:pe.unitPrice,vatRate:pe.vatRate,isIncludedInRequestedAmount:pe.isIncludedInRequestedAmount,lineNetAmount:pe.lineNetAmount,lineVatAmount:pe.lineVatAmount,lineTotalAmount:pe.lineTotalAmount,attachmentId:pe.attachmentId});Le&&De.push(Le)}else{const Le=await Xe.updateLineItem(e,l.id,pe.id,{kind:pe.kind,expenseType:pe.expenseType,providerName:pe.providerName,providerId:pe.providerId,description:pe.description,date:pe.date,quantity:pe.quantity,unitPrice:pe.unitPrice,vatRate:pe.vatRate,isIncludedInRequestedAmount:pe.isIncludedInRequestedAmount,lineNetAmount:pe.lineNetAmount,lineVatAmount:pe.lineVatAmount,lineTotalAmount:pe.lineTotalAmount,attachmentId:pe.attachmentId});Le&&De.push(Le)}const Me=await Xe.getSheet(l.id)||{sheet:ie||l,lineItems:De,attachments:[]};s(Me),ve(!1),w("  .")}finally{y(!1)}}},Z=()=>{Ee&&!window.confirm("   .   ?")||r()};g.useEffect(()=>{if(!Ee)return;const z=ie=>{ie.preventDefault(),ie.returnValue=""};return window.addEventListener("beforeunload",z),()=>window.removeEventListener("beforeunload",z)},[Ee]);const Ne=Xa(l.caseId)===l.id,xe=Oh(l,o),be=async()=>{y(!0);try{const z=await Xe.getRulesetForSheet(l),ie=Cp({sheet:l,lineItems:i,attachments:h,ruleset:z}),De=ie.issues.map(Le=>Le.code==="MISSING_ATTACHMENT_REQUIRED"&&Le.severity==="ERROR"?{...Le,severity:"WARNING"}:Le);N(De);const Me=De.filter(Le=>Le.severity==="ERROR"&&Le.code!=="MISSING_ATTACHMENT_REQUIRED");if(Me.length){const Le=Me.map(st=>` ${st.messageHe}`).join(`
`);X(Le),U(!0),w("          .");return}const pe=await Xe.recordReadyAttempt(e,{sheetId:l.id,success:!0,decisionLog:ie.decisionLog});if(pe){c(pe);const Le=await Xe.getSheet(pe.id)||{sheet:pe,lineItems:i,attachments:h};s(Le),a&&a({caseId:pe.caseId,sheetId:pe.id,lawyerId:F==="AUTO"?void 0:F});const st=F==="AUTO"?(o==null?void 0:o.ownerName)||"  ":(o==null?void 0:o.ownerName)||" ";w(`       ${st}   ${pe.caseId}.`)}}finally{y(!1)}},Oe=()=>{const z=Xe.buildCumulativeExpensesSnapshot(l.id,new Date().toISOString());if(!z)return;const{effectiveSheet:ie,allLines:De,opts:Me}=z,{html:pe}=ri(ie,De,Me);E(pe)},Ce=z=>se.has(z),qe=g.useMemo(()=>{const z=new Set(te);return i.forEach(ie=>{ie.providerName&&z.add(ie.providerName)}),Array.from(z).sort((ie,De)=>ie.localeCompare(De,"he-IL"))},[i,te]),dt=g.useMemo(()=>{const z=new Set(ae);return i.forEach(ie=>{ie.description&&z.add(ie.description)}),Array.from(z).sort((ie,De)=>ie.localeCompare(De,"he-IL"))},[i,ae]),Ue=()=>{const z={sheet:l,lineItems:i,attachments:h,totals:q},ie=new Blob([JSON.stringify(z,null,2)],{type:"application/json"}),De=URL.createObjectURL(ie),Me=document.createElement("a");Me.href=De,Me.download=`expenses-${l.caseId||l.id}.json`,Me.click(),URL.revokeObjectURL(De)},nt=()=>{const z=["LineId","Date","Provider","Description","Quantity","UnitPrice","VatRate","IncludedInRequest","LineTotal"],ie=i.map(st=>[st.id,st.date||"",(st.providerName||"").replace(/"/g,'""'),(st.description||"").replace(/"/g,'""'),st.quantity??"",st.unitPrice??"",st.vatRate??"",st.isIncludedInRequestedAmount!==!1?"YES":"NO",st.lineTotalAmount??""]),De=[z.join(","),...ie.map(st=>st.map(ne=>{const Be=String(ne??"");return/[",\n]/.test(Be)?`"${Be}"`:Be}).join(","))].join(`
`),Me=new Blob(["\uFEFF"+De],{type:"text/csv;charset=utf-8;"}),pe=URL.createObjectURL(Me),Le=document.createElement("a");Le.href=pe,Le.download=`expenses-${l.caseId||l.id}.csv`,Le.click(),URL.revokeObjectURL(pe)},jt=g.useMemo(()=>o?[{id:o.createdBy,name:o.ownerName||'" '}]:[],[o]);return n.jsxs("div",{className:"flex flex-col gap-4",children:[$e&&n.jsx("div",{className:"rounded-lg border border-amber-300 bg-amber-50 px-4 py-3 text-sm text-amber-900",children:Pe?n.jsxs("div",{children:[n.jsx("strong",{children:"      ."}),n.jsx("p",{className:"mt-1 text-amber-800",children:" ADMIN    ."})]}):n.jsxs("div",{children:[n.jsx("strong",{children:"    (ADMIN)."}),n.jsx("p",{className:"mt-2 text-amber-800",children:"     ."}),n.jsx("input",{type:"text",className:"mt-2 w-full max-w-md border border-amber-300 rounded px-3 py-1.5 text-sm",placeholder:"  ()",value:le,onChange:z=>fe(z.target.value)})]})}),n.jsxs("div",{className:"flex items-center justify-between",children:[n.jsxs("div",{children:[n.jsxs("h2",{className:"text-xl font-semibold text-gray-900 flex items-center gap-2",children:["  : ",n.jsx("span",{className:"font-mono",children:l.caseId}),Ne?n.jsx("span",{className:"inline-flex px-2 py-0.5 rounded-full text-xs font-medium bg-emerald-100 text-emerald-800 border border-emerald-200",children:""}):n.jsx("span",{className:"inline-flex px-2 py-0.5 rounded-full text-xs font-medium bg-gray-100 text-gray-600 border border-gray-200",children:""})]}),n.jsxs("p",{className:"text-sm text-gray-600 mt-1",children:[": ",n.jsx("span",{className:"font-medium",children:xe})]})]}),n.jsxs("div",{className:"flex gap-3 flex-wrap justify-end items-center",children:[jt.length>0&&n.jsxs("div",{className:"text-xs text-gray-700",children:[n.jsx("label",{className:"block mb-1 font-medium",children:"     "}),n.jsxs("select",{className:"border rounded px-2 py-1 text-xs bg-white",value:F,onChange:z=>L(z.target.value||"AUTO"),children:[n.jsx("option",{value:"AUTO",children:'   "  '}),jt.map(z=>n.jsx("option",{value:z.id,children:z.name},z.id))]})]}),n.jsx("button",{type:"button",className:"px-3 py-1 text-sm rounded border border-gray-300 text-gray-700 hover:bg-gray-50",onClick:Z,children:" "}),n.jsx("button",{type:"button",className:"px-3 py-1.5 text-sm rounded border border-blue-300 text-blue-700 hover:bg-blue-50",onClick:Oe,children:" "}),!Pe&&n.jsx("button",{type:"button",className:"px-4 py-1.5 text-sm rounded bg-emerald-600 text-white hover:bg-emerald-700 disabled:opacity-50",onClick:be,disabled:p,children:"   "}),n.jsx("button",{type:"button",className:"px-4 py-1.5 text-sm rounded bg-blue-600 text-white hover:bg-blue-700 disabled:opacity-50",onClick:He,disabled:p||Pe,children:p?"":Ee?"  ( )":" "}),e.role==="ADMIN"&&n.jsx("button",{type:"button",className:"px-3 py-1.5 text-xs rounded border border-gray-300 text-gray-700 hover:bg-gray-50",onClick:Ue,children:" JSON"}),n.jsx("button",{type:"button",className:"px-3 py-1.5 text-xs rounded border border-gray-300 text-gray-700 hover:bg-gray-50",onClick:nt,children:" Excel (CSV)"})]})]}),b&&n.jsx("div",{className:"mt-2 rounded border border-green-200 bg-green-50 px-3 py-2 text-sm text-green-800",children:b}),R&&n.jsxs("div",{className:"mt-2 rounded border border-gray-300 bg-white px-3 py-3 text-sm text-left",children:[n.jsxs("div",{className:"flex justify-between items-center mb-2",children:[n.jsx("span",{className:"font-semibold text-gray-800",children:"Expenses Table  Preview"}),n.jsx("button",{type:"button",className:"text-sm text-blue-600 hover:underline",onClick:()=>E(null),children:""})]}),n.jsx("div",{className:"overflow-x-auto text-base",dangerouslySetInnerHTML:{__html:R}})]}),n.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 bg-white border rounded-lg p-4 shadow-sm",children:[n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:""}),n.jsx("input",{className:"w-full border rounded px-2 py-1 text-sm disabled:bg-gray-100 disabled:cursor-not-allowed",value:l.insurerName||"",onChange:z=>re({insurerName:z.target.value}),disabled:Pe})]}),n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:" / "}),n.jsx("input",{className:"w-full border rounded px-2 py-1 text-sm disabled:bg-gray-100 disabled:cursor-not-allowed",value:l.periodLabel||"",onChange:z=>re({periodLabel:z.target.value}),disabled:Pe})]}),n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:" "}),n.jsx("input",{type:"number",className:"w-full border rounded px-2 py-1 text-sm disabled:bg-gray-100 disabled:cursor-not-allowed",value:l.deductibleAmount??0,onChange:z=>{const ie=Number(z.target.value),De=Number.isFinite(ie)?Math.max(0,ie):0;re({deductibleAmount:De})},disabled:Pe})]}),n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"  "}),n.jsx("input",{type:"number",className:"w-full border rounded px-2 py-1 text-sm bg-gray-50",value:Ye,readOnly:!0})]}),n.jsxs("div",{className:"flex items-center gap-2 mt-2",children:[n.jsx("input",{id:"infoOnly",type:"checkbox",checked:l.infoOnly,onChange:z=>re({infoOnly:z.target.checked}),disabled:Pe}),n.jsx("label",{htmlFor:"infoOnly",className:"text-sm text-gray-800",children:"   (  )"})]})]}),n.jsxs("div",{className:"flex flex-col gap-2",children:[n.jsxs("div",{className:"flex items-center justify-between text-xs text-gray-700 px-1",children:[n.jsx("span",{className:"font-semibold",children:"    (  )"}),n.jsx("span",{className:"text-gray-500",children:"   / PDF     ."})]}),n.jsxs("div",{className:"flex flex-wrap gap-4 items-center bg-blue-50 border border-blue-100 rounded-lg p-4 text-sm",children:[n.jsxs("div",{children:[n.jsx("div",{className:"text-gray-600",children:"   "}),n.jsxs("div",{className:"font-semibold",children:[q.grossExpensesTotal.toLocaleString("he-IL")," "]})]}),n.jsxs("div",{children:[n.jsx("div",{className:"text-gray-600",children:"   (  +  + )"}),n.jsxs("div",{className:"font-semibold",children:[q.adjustmentsTotal.toLocaleString("he-IL")," "]})]}),n.jsxs("div",{children:[n.jsx("div",{className:"text-gray-600",children:"    (   )"}),n.jsxs("div",{className:"font-semibold",children:[q.amountBeforeInfoOnly.toLocaleString("he-IL")," "]})]}),n.jsxs("div",{children:[n.jsx("div",{className:"text-gray-600",children:"   "}),n.jsxs("div",{className:"font-semibold text-blue-700",children:[q.amountToRequest.toLocaleString("he-IL")," "]})]}),q.infoOnlyApplied&&n.jsx("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-yellow-100 text-yellow-800",children:"  (  )"})]}),n.jsx("div",{className:"px-1 text-[11px] text-gray-500",children:" :         .   (Expenses Table)   -PDF        ."})]}),ue&&n.jsxs("div",{className:"mt-3 flex flex-col gap-2",children:[n.jsx("div",{className:"flex items-center justify-between text-xs text-slate-700 px-1",children:n.jsx("span",{className:"font-semibold",children:"   ( +  )"})}),n.jsxs("div",{className:"flex flex-wrap gap-4 items-center bg-indigo-50 border border-indigo-100 rounded-lg p-4 text-sm",children:[n.jsxs("div",{children:[n.jsx("div",{className:"text-slate-600",children:"   "}),n.jsxs("div",{className:"font-semibold",children:[ue.grossExpensesTotal.toLocaleString("he-IL")," "]})]}),n.jsxs("div",{children:[n.jsx("div",{className:"text-slate-600",children:"  (  +  + )"}),n.jsxs("div",{className:"font-semibold",children:[ue.adjustmentsTotal.toLocaleString("he-IL")," "]})]}),n.jsxs("div",{children:[n.jsx("div",{className:"text-slate-600",children:"   "}),n.jsxs("div",{className:"font-semibold",children:[Ye.toLocaleString("he-IL")," "]})]}),n.jsxs("div",{children:[n.jsx("div",{className:"text-slate-600",children:"  /  ()"}),n.jsxs("div",{className:"font-semibold text-indigo-700",children:[ue.amountToRequest.toLocaleString("he-IL")," "]})]})]})]}),n.jsxs("div",{className:"mt-2 text-xs text-gray-500 bg-white border border-dashed border-gray-300 rounded-md p-2",children:[n.jsx("span",{className:"font-semibold mr-1",children:" :"}),"    (, , , ,  ).       ,            ."]}),n.jsxs("div",{className:"bg-white border rounded-lg p-4 shadow-sm flex flex-col gap-2 text-sm",onDragOver:z=>{z.preventDefault(),z.stopPropagation()},onDrop:et,children:[n.jsxs("div",{className:"flex items-center justify-between",children:[n.jsx("div",{className:"font-medium text-gray-900",children:""}),n.jsxs("label",{className:"inline-flex items-center gap-2 cursor-pointer text-xs text-blue-700 hover:text-blue-800",children:[n.jsx("span",{className:"px-2 py-1 border border-blue-400 rounded bg-blue-50",children:" "}),n.jsx("input",{type:"file",className:"hidden",multiple:!0,onChange:Te})]})]}),n.jsx("p",{className:"text-xs text-gray-500",children:"         ."}),h.length===0?n.jsx("div",{className:"text-gray-500 text-xs",children:"    ."}):n.jsx("ul",{className:"divide-y divide-gray-100",children:h.map(z=>n.jsxs("li",{className:"py-1 flex items-center justify-between gap-4",children:[n.jsxs("div",{className:"flex flex-col",children:[n.jsx("span",{className:"text-gray-900 text-xs",children:z.originalFileName}),n.jsxs("span",{className:"text-gray-500 text-[11px]",children:[": ",z.sizeBytes!=null?`${(z.sizeBytes/1024).toFixed(1)} KB`:" ","  "," ",z.uploadedAt?new Date(z.uploadedAt).toLocaleString("he-IL",{dateStyle:"short",timeStyle:"short"}):""]})]}),n.jsx("button",{type:"button",className:"text-xs text-blue-700 hover:underline",onClick:()=>{z.fileKey.startsWith("data:")&&window.open(z.fileKey,"_blank")},children:" / "})]},z.id))})]}),W.length>0&&n.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-lg p-3 text-sm",children:[n.jsx("div",{className:"font-semibold text-red-800 mb-1",children:"  :"}),n.jsx("ul",{className:"list-disc pr-5 space-y-0.5",children:W.map(z=>n.jsxs("li",{children:[n.jsxs("span",{className:"font-mono text-xs text-gray-500 ml-1",children:["[",z.severity,"]"]}),n.jsxs("span",{className:"text-red-900",children:[" ",z.messageHe]})]},`${z.code}-${z.scope}-${z.entityId||"sheet"}`))})]}),n.jsxs("div",{className:"bg-white border rounded-lg shadow-sm overflow-x-auto",children:[n.jsxs("table",{className:"min-w-full text-sm",children:[n.jsx("thead",{className:"bg-gray-50",children:n.jsxs("tr",{children:[n.jsx("th",{className:"px-2 py-1 border-b text-right",children:""}),n.jsx("th",{className:"px-2 py-1 border-b text-right",children:""}),n.jsx("th",{className:"px-2 py-1 border-b text-right",children:""}),n.jsx("th",{className:"px-2 py-1 border-b text-right",children:""}),n.jsx("th",{className:"px-2 py-1 border-b text-right",children:""}),n.jsx("th",{className:"px-2 py-1 border-b text-right",children:" "}),n.jsx("th",{className:"px-2 py-1 border-b text-right",children:" %"}),n.jsx("th",{className:"px-2 py-1 border-b text-right",children:" "}),n.jsx("th",{className:"px-2 py-1 border-b text-right",children:" "}),n.jsx("th",{className:"px-2 py-1 border-b text-right",children:""}),n.jsx("th",{className:"px-2 py-1 border-b"})]})}),n.jsxs("tbody",{children:[D.length>0&&n.jsx("tr",{children:n.jsx("td",{className:"px-2 py-1 border-b text-xs text-slate-600 bg-slate-50",colSpan:9,children:"  ( )      ."})}),D.map((z,ie)=>{if(z.kind!=="EXPENSE")return null;const De=z.lineTotalAmount??(z.quantity??0)*(z.unitPrice??0)*(1+(z.vatRate??0)/100);return n.jsxs("tr",{className:"bg-slate-50 text-slate-700",children:[n.jsx("td",{className:"px-2 py-1 border-b text-[11px] text-slate-500",children:""}),n.jsx("td",{className:"px-2 py-1 border-b text-xs",children:z.providerName||""}),n.jsx("td",{className:"px-2 py-1 border-b text-xs",children:z.description||""}),n.jsx("td",{className:"px-2 py-1 border-b text-xs whitespace-nowrap",children:z.date||""}),n.jsx("td",{className:"px-2 py-1 border-b text-xs",children:z.quantity??""}),n.jsx("td",{className:"px-2 py-1 border-b text-xs",children:z.unitPrice??""}),n.jsx("td",{className:"px-2 py-1 border-b text-xs",children:z.vatRate??""}),n.jsx("td",{className:"px-2 py-1 border-b text-xs",children:Number.isFinite(De)?De.toLocaleString("he-IL"):""}),n.jsx("td",{className:"px-2 py-1 border-b text-[11px] text-slate-400",children:" "})]},`hist-${z.id}-${ie}`)}),i.map((z,ie)=>{const De=Ce(z.id),Me=h.find(ne=>ne.id===z.attachmentId),pe=z.kind==="COMPENSATION",Le=z.kind==="EXPENSE",st=z.kind==="COMPENSATION"?z.compensationSource==="COURT"?"COMPENSATION_COURT":"COMPENSATION_SETTLEMENT":z.kind;return n.jsxs("tr",{className:`${De?"bg-red-50":ie%2===0?"bg-white":"bg-gray-50"} ${Le?"border-l-4 border-emerald-300 bg-emerald-50/60":""}`,children:[n.jsx("td",{className:"px-2 py-1 border-b",children:n.jsxs("select",{className:"border rounded px-1 py-0.5 text-xs",value:st,onChange:ne=>{const Be=ne.target.value;Be==="EXPENSE"?Q(ie,{kind:"EXPENSE",compensationSource:null}):Be==="ADJUSTMENT"?Q(ie,{kind:"ADJUSTMENT",compensationSource:null}):Be==="COMPENSATION_SETTLEMENT"?Q(ie,{kind:"COMPENSATION",compensationSource:"SETTLEMENT",providerName:"",expenseType:null,vatRate:0,quantity:1}):Be==="COMPENSATION_COURT"&&Q(ie,{kind:"COMPENSATION",compensationSource:"COURT",providerName:"",expenseType:null,vatRate:0,quantity:1})},children:[n.jsx("option",{value:"EXPENSE",children:"Expense"}),n.jsx("option",{value:"COMPENSATION_SETTLEMENT",children:"Compensation pursuant to a settlement"}),n.jsx("option",{value:"COMPENSATION_COURT",children:"Compensation pursuant to a judgment"}),n.jsx("option",{value:"ADJUSTMENT",children:"Adjustment"})]})}),n.jsx("td",{className:"px-2 py-1 border-b",children:pe?n.jsx("span",{className:"text-[11px] text-gray-400 whitespace-nowrap",children:"  "}):n.jsxs("div",{className:"flex items-center gap-1",children:[Le&&n.jsx("span",{className:"inline-flex items-center rounded-full bg-emerald-100 text-emerald-700 text-[10px] px-2 py-[1px]",children:""}),n.jsx("input",{list:"provider-suggestions",className:"border rounded px-1 py-0.5 w-32 text-xs",placeholder:" ",value:z.providerName||"",onChange:ne=>Q(ie,{providerName:ne.target.value})})]})}),n.jsx("td",{className:"px-2 py-1 border-b",children:n.jsx("input",{className:"border rounded px-1 py-0.5 w-64 text-xs",list:"description-suggestions",value:z.description,onChange:ne=>Q(ie,{description:ne.target.value})})}),n.jsx("td",{className:"px-2 py-1 border-b",children:n.jsx("input",{type:"date",className:"border rounded px-1 py-0.5 text-xs",value:z.date||"",onChange:ne=>Q(ie,{date:ne.target.value||null})})}),n.jsx("td",{className:"px-2 py-1 border-b",children:n.jsx("input",{type:"number",className:"border rounded px-1 py-0.5 w-20 text-xs disabled:bg-gray-100 disabled:text-gray-400",value:z.quantity??1,disabled:pe,onChange:ne=>{if(pe)return;const Be=Number(ne.target.value),Ct=Number.isFinite(Be)?Math.max(0,Be):0;Q(ie,{quantity:Ct})}})}),n.jsx("td",{className:"px-2 py-1 border-b",children:n.jsx("input",{type:"number",className:"border rounded px-1 py-0.5 w-24 text-xs",value:z.unitPrice??0,onChange:ne=>{const Be=Number(ne.target.value),Ct=Number.isFinite(Be)?Math.max(0,Be):0;Q(ie,{unitPrice:Ct})}})}),n.jsx("td",{className:"px-2 py-1 border-b",children:n.jsx("input",{type:"number",className:"border rounded px-1 py-0.5 w-16 text-xs disabled:bg-gray-100 disabled:text-gray-400",value:z.vatRate??0,disabled:pe,onChange:ne=>{if(pe)return;const Be=Number(ne.target.value),Ct=Number.isFinite(Be)?Math.max(0,Be):0;Q(ie,{vatRate:Ct})}})}),n.jsx("td",{className:"px-2 py-1 border-b text-center",children:n.jsx("input",{type:"checkbox",checked:z.isIncludedInRequestedAmount!==!1,onChange:ne=>Q(ie,{isIncludedInRequestedAmount:ne.target.checked})})}),n.jsx("td",{className:"px-2 py-1 border-b text-left font-mono text-xs",children:z.lineTotalAmount!=null?z.lineTotalAmount.toLocaleString("he-IL"):""}),n.jsxs("td",{className:"px-2 py-1 border-b text-right",children:[n.jsxs("div",{className:"flex items-center justify-end gap-2",children:[n.jsxs("select",{className:"border rounded px-1 py-0.5 text-xs max-w-[190px]",value:z.attachmentId||"",title:Me?` : ${Me.originalFileName}`:"   ",onChange:ne=>void Ge(z,ne.target.value?ne.target.value:null),children:[n.jsx("option",{value:"",children:h.length?"   ":"  "}),h.map(ne=>n.jsx("option",{value:ne.id,children:ne.originalFileName},ne.id))]}),z.attachmentId?n.jsxs("span",{className:"inline-flex items-center gap-1 text-[11px] text-emerald-700 font-semibold whitespace-nowrap",children:[n.jsx("span",{className:"text-emerald-600",children:""}),n.jsx("span",{children:" "})]}):n.jsx("span",{className:"inline-flex items-center gap-1 text-[11px] text-gray-500 whitespace-nowrap",children:" "})]}),Me&&n.jsxs("div",{className:"mt-0.5 text-[11px] text-gray-700 text-left",children:[n.jsx("span",{className:"text-gray-500",children:":"})," ",n.jsx("span",{className:"font-mono break-all",children:Me.originalFileName})]})]}),n.jsx("td",{className:"px-2 py-1 border-b text-center",children:n.jsx("button",{type:"button",className:"text-xs text-red-600 hover:underline disabled:opacity-50 disabled:cursor-not-allowed disabled:no-underline",onClick:()=>Fe(ie),disabled:Pe,children:""})})]},z.id)})]})]}),n.jsx("datalist",{id:"provider-suggestions",children:qe.map(z=>n.jsx("option",{value:z},z))}),n.jsx("datalist",{id:"description-suggestions",children:dt.map(z=>n.jsx("option",{value:z},z))}),n.jsx("div",{className:"p-2",children:n.jsx("button",{type:"button",className:"px-3 py-1 text-xs rounded border border-dashed border-gray-400 text-gray-700 hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed",onClick:he,disabled:Pe,children:" "})})]}),n.jsxs("div",{className:"mt-4 rounded-lg border border-slate-200 bg-slate-50 p-3 text-xs",children:[n.jsxs("div",{className:"flex justify-between items-center mb-2",children:[n.jsx("span",{className:"font-semibold text-slate-800",children:" "}),n.jsxs("span",{className:"text-slate-700",children:["    : ",Ye.toLocaleString("he-IL")]})]}),n.jsx(Ub,{user:e,sheet:l,paymentEvents:M,onChangeEvents:I})]}),O.length>0&&n.jsxs("div",{className:"mt-4 rounded-lg border border-slate-200 bg-slate-50 p-3 text-xs",children:[n.jsxs("div",{className:"flex justify-between items-center mb-2",children:[n.jsx("span",{className:"font-semibold text-slate-800",children:"  "}),n.jsxs("span",{className:"text-slate-500",children:["  ",O.length,"    "]})]}),n.jsx("div",{className:"space-y-2",children:O.map(z=>n.jsxs("div",{className:"rounded border border-slate-200 bg-white px-2 py-1 flex flex-wrap gap-x-4 gap-y-1 items-baseline",children:[n.jsxs("span",{className:"font-semibold text-slate-800",children:[" #",z.versionIndex||1]}),n.jsxs("span",{className:"text-slate-600",children:[": ",$b(z.status)]}),n.jsxs("span",{className:"text-slate-500",children:[":"," ",new Date(z.updatedAt||z.createdAt).toLocaleString("he-IL",{dateStyle:"short",timeStyle:"short"})]}),n.jsxs("span",{className:"text-slate-700",children:[" : ",z.deductibleAmount.toLocaleString("he-IL")]}),n.jsxs("span",{className:"text-slate-700",children:["  : ",z.alreadyPaidAmount.toLocaleString("he-IL")]}),n.jsxs("span",{className:"text-slate-700",children:[" : ",z.amountToRequest.toLocaleString("he-IL")]})]},z.id))})]}),n.jsx(Bb,{open:P,title:"    ",message:V?`      :

${V}`:"      .",confirmText:"",cancelText:"",onConfirm:()=>U(!1),onCancel:()=>U(!1)})]})},Wb=[{id:"READY",label:" "},{id:"ATTACHED",label:" "},{id:"SENT",label:""},{id:"EXCEPTIONS",label:""}],Dp={DRAFT:"",READY_FOR_REPORT:" ",ATTACHED_TO_REPORT:" ",ARCHIVED:""},zb=({user:e,reports:t,onOpenReport:s})=>{var it;const[r,a]=g.useState("READY"),[o,l]=g.useState(""),[c,i]=g.useState(""),[u,p]=g.useState(""),[y,b]=g.useState(""),[w,R]=g.useState(""),[E,W]=g.useState([]),[N,h]=g.useState(null),[S,P]=g.useState(null),[U,V]=g.useState(!1),[X,te]=g.useState(null),[G,ae]=g.useState(null),[j,F]=g.useState(null),[L,O]=g.useState(!1),[H,M]=g.useState(null),[I,D]=g.useState(null),[J,ue]=g.useState(!1),[ce,le]=g.useState(!1),[fe,Ee]=g.useState(0);g.useMemo(()=>{if(!N)return 0;switch(r){case"READY":return N.readyCount;case"ATTACHED":return N.attachedCount;case"SENT":return N.sentCount;case"EXCEPTIONS":return N.exceptionsCount;default:return 0}},[N,r]);const ve=q=>{if(q==null)return"";if(q<24)return`${q.toFixed(1)} `;const se=Math.floor(q/24),C=q%24;return C<1?`${se} `:`${se}  ${C.toFixed(1)} `};g.useEffect(()=>{let q=!1;return(async()=>{V(!0),te(null);try{const[C,re]=await Promise.all([Xe.getLidorCounts(e,t),Xe.getLidorKpis(e,t)]);q||(h(C),P(re));const Q={};r==="READY"?Q.status="READY_FOR_REPORT":r==="ATTACHED"&&(Q.status="ATTACHED_TO_REPORT"),o.trim()&&(Q.insurerName=o.trim()),u&&(Q.dateFrom=u),y&&(Q.dateTo=y),w.trim()&&(Q.caseIdOrSearch=w.trim()),c&&(Q.status=c);const he=await Xe.listSheetsForLidor(e,Q,t);let Fe=he;r==="SENT"?Fe=he.filter(je=>je.sentAt):r==="EXCEPTIONS"&&(Fe=he.filter(je=>je.expensesOutOfSync||je.blockingIssueCodesLatest&&je.blockingIssueCodesLatest.length>0)),q||(W(Fe),ae(null),D(null))}catch(C){console.error(C),q||te("    . /   .")}finally{q||V(!1)}})(),()=>{q=!0}},[e,t,r,o,c,u,y,w,fe]);const $e=async q=>{ae(q),D(null),M(null),O(!0);try{const se=await Xe.getSheet(q.sheetId),C=await Xe.getSheetAuditForLidor(e,q.sheetId,200),re=await Xe.getExceptionStatusForSheet(e,q.sheetId);D(se?{sheet:se.sheet,lineItems:se.lineItems,attachments:se.attachments,audit:C,exceptionStatus:re}:{sheet:null,lineItems:[],attachments:[],audit:C,exceptionStatus:re})}catch(se){console.error(se),M("     .")}finally{O(!1)}},Pe=()=>{if(!I||!I.sheet)return;const q={sheet:I.sheet,lineItems:I.lineItems,attachments:I.attachments};F(q)},Ke=()=>{F(null),Ee(q=>q+1)};if(j)return n.jsxs("div",{className:"bg-white rounded-xl border border-slate-200 shadow-sm p-4 mt-4",dir:"rtl",children:[n.jsxs("header",{className:"flex items-center justify-between mb-4",children:[n.jsxs("div",{children:[n.jsx("h2",{className:"text-xl font-bold text-slate-900",children:"   ()"}),n.jsx("p",{className:"text-sm text-slate-600 mt-1",children:"           ."})]}),n.jsx("button",{type:"button",className:"px-3 py-1.5 rounded border border-slate-300 text-sm text-slate-700 hover:bg-slate-100",onClick:Ke,children:"  "})]}),n.jsx(Mh,{user:e,sheetWithRelations:j,onSheetUpdated:q=>{F(q)},onBack:Ke})]});const Ye=async q=>{if(!(!G||!I))try{await Xe.setExceptionStatusForSheet(e,G.sheetId,q),D({...I,exceptionStatus:q})}catch(se){Yu("Failed to update financial exception status",se),M("     .")}};return n.jsxs("div",{className:"bg-white rounded-xl border border-slate-200 shadow-sm p-4 mt-4",dir:"rtl",children:[n.jsx("header",{className:"flex flex-col md:flex-row md:items-center md:justify-between gap-4 mb-4",children:n.jsxs("div",{children:[n.jsx("h2",{className:"text-xl font-bold text-slate-900",children:" "}),n.jsx("p",{className:"text-sm text-slate-600 mt-1",children:"-    ,      ."}),S&&n.jsxs("p",{className:"mt-1 text-xs text-slate-500",children:["  :"," ",S.exceptions.divergenceOld.count+S.exceptions.missingAttachments.count+S.exceptions.repeatedBlocks.count]})]})}),S&&n.jsxs("section",{className:"mb-4 grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 xl:grid-cols-4 gap-3 text-xs",children:[n.jsxs("div",{className:"rounded-xl border border-slate-200 bg-slate-50 px-3 py-2.5",children:[n.jsx("p",{className:"text-slate-500 mb-1",children:"   "}),n.jsx("p",{className:"text-sm font-semibold text-slate-900",children:ve(S.sla.draftToReadyAvgHours)})]}),n.jsxs("div",{className:"rounded-xl border border-slate-200 bg-slate-50 px-3 py-2.5",children:[n.jsx("p",{className:"text-slate-500 mb-1",children:"   "}),n.jsx("p",{className:"text-sm font-semibold text-slate-900",children:ve(S.sla.readyToAttachedAvgHours)})]}),n.jsxs("div",{className:"rounded-xl border border-slate-200 bg-slate-50 px-3 py-2.5",children:[n.jsx("p",{className:"text-slate-500 mb-1",children:"   "}),n.jsx("p",{className:"text-sm font-semibold text-slate-900",children:ve(S.sla.attachedToSentAvgHours)})]}),n.jsxs("div",{className:"rounded-xl border border-blue-100 bg-blue-50 px-3 py-2.5",children:[n.jsx("p",{className:"text-slate-600 mb-1",children:"  "}),n.jsxs("p",{className:"text-sm font-semibold text-blue-800",children:[S.volumes.totalAmountRequested.toLocaleString("he-IL")," "]}),n.jsxs("p",{className:"text-[11px] text-slate-500 mt-0.5",children:[S.volumes.totalSheets||0,"  "," ",S.volumes.totalSentReports||0,"  "]})]})]}),S&&n.jsxs("section",{className:"mb-4",children:[n.jsx("h3",{className:"text-sm font-semibold text-slate-700 mb-1",children:"  "}),n.jsxs("div",{className:"flex flex-wrap gap-2 text-xs",children:[n.jsxs("button",{type:"button",className:"inline-flex items-center gap-1 px-3 py-1.5 rounded-full border border-amber-200 bg-amber-50 text-amber-800 hover:bg-amber-100 transition disabled:opacity-40 disabled:hover:bg-amber-50",disabled:S.exceptions.divergenceOld.count===0,onClick:()=>a("EXCEPTIONS"),children:[n.jsx("span",{children:"    "}),n.jsxs("span",{className:"font-semibold",children:["(",S.exceptions.divergenceOld.count,")"]})]}),n.jsxs("button",{type:"button",className:"inline-flex items-center gap-1 px-3 py-1.5 rounded-full border border-rose-200 bg-rose-50 text-rose-800 hover:bg-rose-100 transition disabled:opacity-40 disabled:hover:bg-rose-50",disabled:S.exceptions.missingAttachments.count===0,onClick:()=>a("EXCEPTIONS"),children:[n.jsx("span",{children:"  "}),n.jsxs("span",{className:"font-semibold",children:["(",S.exceptions.missingAttachments.count,")"]})]}),n.jsxs("button",{type:"button",className:"inline-flex items-center gap-1 px-3 py-1.5 rounded-full border border-purple-200 bg-purple-50 text-purple-800 hover:bg-purple-100 transition disabled:opacity-40 disabled:hover:bg-purple-50",disabled:S.exceptions.repeatedBlocks.count===0,onClick:()=>a("EXCEPTIONS"),children:[n.jsx("span",{children:"   "}),n.jsxs("span",{className:"font-semibold",children:["(",S.exceptions.repeatedBlocks.count,")"]})]})]})]}),n.jsx("div",{className:"flex flex-wrap gap-2 mb-4",children:Wb.map(q=>n.jsxs("button",{type:"button",onClick:()=>a(q.id),className:`px-3 py-1.5 text-xs font-semibold rounded-full border transition ${r===q.id?"bg-lpBlue text-white border-lpBlue":"bg-slate-50 text-slate-700 border-slate-200 hover:bg-slate-100"}`,children:[n.jsx("span",{children:q.label}),N&&n.jsxs("span",{className:"ml-2 inline-flex items-center justify-center px-2 py-0.5 rounded-full bg-white/20 text-[10px]",children:[q.id==="READY"&&N.readyCount,q.id==="ATTACHED"&&N.attachedCount,q.id==="SENT"&&N.sentCount,q.id==="EXCEPTIONS"&&N.exceptionsCount]})]},q.id))}),n.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-3 mb-4 text-sm",children:[n.jsxs("div",{children:[n.jsx("label",{className:"block text-xs font-medium text-slate-600 mb-1",children:""}),n.jsx("input",{className:"w-full border border-slate-200 rounded-lg px-2 py-1.5",placeholder:"   ",value:o,onChange:q=>l(q.target.value)})]}),n.jsxs("div",{children:[n.jsx("label",{className:"block text-xs font-medium text-slate-600 mb-1",children:""}),n.jsxs("select",{className:"w-full border border-slate-200 rounded-lg px-2 py-1.5",value:c,onChange:q=>i(q.target.value),children:[n.jsx("option",{value:"",children:""}),n.jsx("option",{value:"DRAFT",children:""}),n.jsx("option",{value:"READY_FOR_REPORT",children:" "}),n.jsx("option",{value:"ATTACHED_TO_REPORT",children:" "}),n.jsx("option",{value:"ARCHIVED",children:""})]})]}),n.jsxs("div",{children:[n.jsx("label",{className:"block text-xs font-medium text-slate-600 mb-1",children:" "}),n.jsxs("div",{className:"flex gap-2",children:[n.jsx("input",{type:"date",className:"w-1/2 border border-slate-200 rounded-lg px-2 py-1.5",value:u,onChange:q=>p(q.target.value)}),n.jsx("input",{type:"date",className:"w-1/2 border border-slate-200 rounded-lg px-2 py-1.5",value:y,onChange:q=>b(q.target.value)})]})]}),n.jsxs("div",{children:[n.jsx("label",{className:"block text-xs font-medium text-slate-600 mb-1",children:"   / ID"}),n.jsx("input",{className:"w-full border border-slate-200 rounded-lg px-2 py-1.5",placeholder:'/  ,    "',value:w,onChange:q=>R(q.target.value)})]})]}),U&&n.jsx("div",{className:"mt-6 text-sm text-slate-500 text-center",children:" "}),X&&!U&&n.jsx("div",{className:"mt-6 text-sm text-red-600 text-center",children:X}),!U&&!X&&E.length===0&&n.jsxs("div",{className:"mt-6 border border-dashed border-slate-300 rounded-xl py-10 flex flex-col items-center justify-center text-center text-sm text-slate-500",children:[n.jsx("p",{className:"mb-1",children:"  "}),n.jsx("p",{className:"text-xs text-slate-400",children:"/       ."})]}),!U&&!X&&E.length>0&&n.jsx("div",{className:"mt-4 overflow-x-auto border border-slate-200 rounded-xl",children:n.jsxs("table",{className:"w-full text-sm",children:[n.jsx("thead",{className:"bg-slate-50 text-slate-700",children:n.jsxs("tr",{children:[n.jsx("th",{className:"px-3 py-2 text-right",children:""}),n.jsx("th",{className:"px-3 py-2 text-right",children:""}),n.jsx("th",{className:"px-3 py-2 text-right",children:""}),n.jsx("th",{className:"px-3 py-2 text-right",children:" #"}),n.jsx("th",{className:"px-3 py-2 text-right",children:" "}),n.jsx("th",{className:"px-3 py-2 text-right",children:" "}),n.jsx("th",{className:"px-3 py-2 text-right",title:"         ",children:"INFO_ONLY"}),n.jsx("th",{className:"px-3 py-2 text-right",title:"       ",children:""}),n.jsx("th",{className:"px-3 py-2 text-left",children:""})]})}),n.jsx("tbody",{children:E.map(q=>{var he;const se=(he=q.blockingIssueCodesLatest)==null?void 0:he.includes("MISSING_ATTACHMENT_REQUIRED"),C=q.expensesOutOfSync,re=(q.blockingIssueCodesLatest||[]).some(Fe=>Fe!=="MISSING_ATTACHMENT_REQUIRED");let Q="";return C?Q=" ":se?Q=" ":re&&(Q=""),n.jsxs("tr",{className:"border-t border-slate-100 hover:bg-slate-50",children:[n.jsx("td",{className:"px-3 py-2 text-right font-mono text-xs text-slate-800",children:q.caseId}),n.jsx("td",{className:"px-3 py-2 text-right text-slate-800",children:q.insurerName||""}),n.jsx("td",{className:"px-3 py-2 text-right text-slate-800 text-xs",children:Dp[q.status]||q.status}),n.jsxs("td",{className:"px-3 py-2 text-right text-slate-800 text-xs",children:[" #",q.versionIndex]}),n.jsx("td",{className:"px-3 py-2 text-right text-slate-700 text-xs",children:new Date(q.updatedAt).toLocaleString("he-IL",{dateStyle:"short",timeStyle:"short"})}),n.jsxs("td",{className:"px-3 py-2 text-right text-blue-700 font-semibold text-xs",children:[q.amountToRequest.toLocaleString("he-IL")," "]}),n.jsx("td",{className:"px-3 py-2 text-right text-xs text-slate-700",children:q.infoOnly?"":""}),n.jsx("td",{className:"px-3 py-2 text-right text-xs",children:Q?n.jsx("span",{className:"inline-flex px-2 py-0.5 rounded-full bg-amber-100 text-amber-800 border border-amber-200",children:Q}):n.jsx("span",{className:"text-slate-400",children:""})}),n.jsxs("td",{className:"px-3 py-2 text-left text-xs space-x-2 space-x-reverse",children:[n.jsx("button",{type:"button",className:"px-2 py-1 rounded border border-slate-300 text-slate-700 hover:bg-slate-100",onClick:()=>$e(q),children:""}),n.jsx("button",{type:"button",className:"px-2 py-1 rounded border border-slate-300 text-slate-600 hover:bg-slate-100",onClick:()=>{var Fe;(Fe=navigator.clipboard)!=null&&Fe.writeText?navigator.clipboard.writeText(q.sheetId).catch(()=>{}):window.prompt(" :",q.sheetId)},children:" "})]})]},q.sheetId)})})]})}),G&&n.jsxs("div",{className:"mt-6 bg-slate-50 border border-slate-200 rounded-xl p-4",children:[n.jsxs("div",{className:"flex flex-col md:flex-row md:items-center md:justify-between gap-2 mb-2",children:[n.jsxs("h3",{className:"text-sm font-bold text-slate-900",children:["   ",G.caseId," (",G.sheetId,")"]}),n.jsxs("div",{className:"flex flex-wrap gap-2 text-[11px]",children:[n.jsx("button",{type:"button",className:"px-2 py-1 rounded border border-slate-300 text-slate-700 hover:bg-slate-100",onClick:()=>{var q;(q=navigator.clipboard)!=null&&q.writeText?navigator.clipboard.writeText(G.sheetId).catch(()=>{}):window.prompt(" :",G.sheetId)},children:"  "}),((it=I==null?void 0:I.sheet)==null?void 0:it.attachedToReportId)&&n.jsx("button",{type:"button",className:"px-2 py-1 rounded border border-slate-300 text-slate-700 hover:bg-slate-100",onClick:()=>{var se;const q=I.sheet.attachedToReportId;(se=navigator.clipboard)!=null&&se.writeText?navigator.clipboard.writeText(q).catch(()=>{}):window.prompt(" :",q)},children:"  "}),n.jsx("button",{type:"button",className:"px-2 py-1 rounded border border-slate-300 text-slate-700 hover:bg-slate-100",onClick:()=>{var se;const q=`${window.location.origin}${window.location.pathname}?financialSheetId=${encodeURIComponent(G.sheetId)}`;(se=navigator.clipboard)!=null&&se.writeText?navigator.clipboard.writeText(q).catch(()=>{}):window.prompt("  :",q)},children:"  "})]})]}),L&&n.jsx("p",{className:"text-xs text-slate-500",children:" "}),H&&n.jsx("p",{className:"text-xs text-red-600",children:H}),!L&&I&&I.sheet&&n.jsxs("div",{className:"space-y-3 text-xs text-slate-800",children:[n.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-2",children:[n.jsxs("div",{children:[n.jsx("span",{className:"font-semibold",children:":"})," ",n.jsx("span",{className:"font-mono",children:I.sheet.caseId})]}),n.jsxs("div",{children:[n.jsx("span",{className:"font-semibold",children:":"})," ",n.jsx("span",{children:I.sheet.insurerName||""})]}),n.jsxs("div",{children:[n.jsx("span",{className:"font-semibold",children:":"})," ",n.jsx("span",{children:Dp[I.sheet.status]||I.sheet.status})]}),n.jsxs("div",{children:[n.jsx("span",{className:"font-semibold",children:" #:"})," ",n.jsx("span",{children:I.sheet.versionIndex})]}),n.jsxs("div",{children:[n.jsx("span",{className:"font-semibold",children:":"})," ",n.jsx("span",{children:new Date(I.sheet.updatedAt).toLocaleString("he-IL",{dateStyle:"short",timeStyle:"short"})})]}),n.jsxs("div",{children:[n.jsx("span",{className:"font-semibold",children:" :"})," ",n.jsx("span",{children:I.sheet.readyAt||""})]}),n.jsxs("div",{children:[n.jsx("span",{className:"font-semibold",children:" :"})," ",n.jsx("span",{children:I.sheet.attachedAt||""})]})]}),n.jsxs("div",{className:"mt-3",children:[n.jsx("h4",{className:"font-semibold text-slate-900 mb-1 text-xs",children:"  (  )"}),n.jsx("p",{className:"text-[11px] text-slate-500 mb-1",children:"       ,      ."}),n.jsxs("div",{className:"inline-flex rounded-full bg-slate-100 p-1 text-[11px] font-semibold text-slate-700",children:[n.jsx("button",{type:"button",className:`px-3 py-1 rounded-full transition ${I.exceptionStatus?"text-slate-600 hover:text-slate-900":"bg-white shadow-sm text-slate-900"}`,onClick:()=>Ye("IN_PROGRESS"),children:""}),n.jsx("button",{type:"button",className:`px-3 py-1 rounded-full transition ${I.exceptionStatus==="RESOLVED"?"bg-emerald-500 text-white shadow-sm":"text-slate-600 hover:text-slate-900"}`,onClick:()=>Ye("RESOLVED"),children:""})]})]}),I.audit&&I.audit.length>0&&n.jsxs("div",{className:"mt-2",children:[n.jsxs("div",{className:"flex items-center justify-between mb-1",children:[n.jsx("h4",{className:"font-semibold text-slate-900",children:"Decision Logs"}),n.jsxs("label",{className:"flex items-center gap-1 text-[11px] text-slate-600",children:[n.jsx("input",{type:"checkbox",className:"rounded border-slate-300",checked:ce,onChange:q=>le(q.target.checked)}),n.jsx("span",{children:" Decision Logs "})]})]}),(()=>{const q=I.audit.filter(C=>C.diffJson&&C.diffJson.decisionLog).sort((C,re)=>new Date(re.eventAt).getTime()-new Date(C.eventAt).getTime());if(!q.length)return n.jsx("p",{className:"text-slate-500 text-[11px]",children:"   ."});const se=ce?q:[q[0]];return n.jsx("div",{className:"space-y-2 text-[11px]",children:se.map((C,re)=>{const Q=C.diffJson.decisionLog;return n.jsxs("div",{className:"border border-slate-200 rounded-lg px-2 py-1.5 bg-white/60",children:[ce&&n.jsxs("div",{className:"flex items-center justify-between mb-0.5 text-[10px] text-slate-500",children:[n.jsx("span",{children:new Date(C.eventAt).toLocaleString("he-IL",{dateStyle:"short",timeStyle:"short"})}),n.jsxs("span",{children:["#",re+1]})]}),n.jsxs("div",{className:"space-y-1",children:[n.jsxs("div",{children:[n.jsx("span",{className:"font-semibold",title:"      ",children:"Ruleset:"})," ",n.jsxs("span",{children:[Q.rulesetId||""," ("," ",Q.rulesetVersion||"-",")"]})]}),n.jsxs("div",{className:"space-y-0.5",children:[n.jsxs("div",{children:[n.jsx("span",{className:Q.checks.requiredFieldsOk?"text-green-600":"text-red-600",children:Q.checks.requiredFieldsOk?"":""})," ",n.jsx("span",{children:"   "})]}),n.jsxs("div",{children:[n.jsx("span",{className:Q.checks.sumsValid?"text-green-600":"text-red-600",children:Q.checks.sumsValid?"":""})," ",n.jsx("span",{children:" "})]}),n.jsxs("div",{children:[n.jsx("span",{className:Q.checks.attachmentsOk?"text-green-600":"text-red-600",children:Q.checks.attachmentsOk?"":""})," ",n.jsx("span",{children:"    "})]}),n.jsxs("div",{children:[n.jsx("span",{className:Q.checks.infoOnlyConsistent?"text-green-600":"text-red-600",children:Q.checks.infoOnlyConsistent?"":""})," ",n.jsx("span",{children:" INFO_ONLY"})]})]}),n.jsxs("div",{children:[n.jsx("span",{className:"font-semibold",children:" :"})," ",n.jsx("span",{children:(Q.blockingIssueCodes||Q.blockingIssueCodesLatest||[]).join(", ")||""})]})]})]},C.id)})})})()]}),I.audit&&I.audit.length>0&&n.jsxs("div",{className:"mt-3",children:[n.jsxs("div",{className:"flex items-center justify-between mb-1",children:[n.jsx("h4",{className:"font-semibold text-slate-900",children:"Audit Log"}),n.jsxs("label",{className:"flex items-center gap-1 text-[11px] text-slate-600",children:[n.jsx("input",{type:"checkbox",className:"rounded border-slate-300",checked:J,onChange:q=>ue(q.target.checked)}),n.jsx("span",{children:" Audit Log "})]})]}),n.jsx("ul",{className:"space-y-0.5 text-[11px] text-slate-700",children:(J?I.audit:I.audit.slice(0,10)).map(q=>n.jsxs("li",{children:[n.jsx("span",{className:"font-mono text-slate-500 mr-1",children:new Date(q.eventAt).toLocaleString("he-IL",{dateStyle:"short",timeStyle:"short"})})," ",n.jsx("span",{className:"font-semibold",children:q.eventType})," "," ",n.jsx("span",{className:"text-slate-500",children:q.actorRole})]},q.id))})]}),I.sheet.attachedToReportId&&n.jsxs("div",{className:"mt-3",children:[n.jsx("button",{type:"button",className:"px-3 py-1.5 rounded border border-slate-300 text-xs text-slate-700 hover:bg-slate-100",onClick:()=>s(I.sheet.attachedToReportId),children:"  "}),n.jsx("button",{type:"button",className:"ml-2 px-3 py-1.5 rounded border border-blue-500 text-xs text-blue-700 hover:bg-blue-50",onClick:Pe,children:"  "})]}),!I.sheet.attachedToReportId&&n.jsx("div",{className:"mt-3",children:n.jsx("button",{type:"button",className:"px-3 py-1.5 rounded border border-blue-500 text-xs text-blue-700 hover:bg-blue-50",onClick:Pe,children:"  "})})]})]})]})},ai=e=>{const t=e.updatedAt||e.sentAt||e.reportDate;return t?new Date(t).getTime():0},Vb=e=>{var s;return(((s=e.reportReview)==null?void 0:s.issues)??[]).some(r=>(r.origin??"INTERNAL")==="EXTERNAL"&&r.status!=="DONE")},Kb=e=>{var s;return(((s=e.reportReview)==null?void 0:s.issues)??[]).some(r=>(r.origin??"INTERNAL")==="EXTERNAL"&&r.status!=="DONE"&&r.externalAction==="REQUIRES_HEBREW")},Yb=e=>e.filter(t=>t.deletedAt?!1:t.hebrewWorkflowStatus==="HEBREW_REOPENED_EXTERNAL"?!0:Vb(t)).sort((t,s)=>ai(s)-ai(t)),Gb=(e,t)=>e.filter(s=>!(s.deletedAt||s.status!=="SENT"||!t(s)||Kb(s))).sort((s,r)=>ai(r)-ai(s)),qb="adminDashboardUiState:v1",Xb=["u6","u5","u7","u4"],ml=Xb.map(e=>ws.find(t=>t.id===e&&t.role==="LAWYER")).filter(e=>!!e);function Jb(e){var a;if(e.status==="SENT")return"GREEN";const t=(a=e.reportReview)==null?void 0:a.status,s=e.hebrewWorkflowStatus;return(t==="SUBMITTED"||t==="APPROVED"||t==="CHANGES_REQUESTED"||s==="HEBREW_SUBMITTED"||s==="HEBREW_APPROVED"||s==="HEBREW_CHANGES_REQUESTED"||s==="HEBREW_REOPENED_EXTERNAL")&&e.status!=="SENT"?"RED":"YELLOW"}const Qb=({user:e,reports:t,onSelectReport:s,onSelectReportWithFocus:r,onMarkExternalIssuesDone:a,onReopenHebrewDueToExternalFeedback:o,onNewReport:l,caseFolders:c,onUpdateCaseFolders:i,canTranslate:u,onLogout:p,onOpenAssistant:y,onOpenCaseFolder:b})=>{var M;const w=g.useMemo(()=>t.filter(I=>!I.deletedAt),[t]),R=g.useMemo(()=>Yb(w),[w]),E=g.useMemo(()=>Gb(w,u),[w,u]),W=g.useMemo(()=>{const I=new Map;return w.forEach(D=>{if(!D.createdBy)return;const J=I.get(D.createdBy)||[];J.push(D),I.set(D.createdBy,J)}),I},[w]),N=g.useMemo(()=>ml.map(I=>{const J=(W.get(I.id)||[]).filter(fe=>fe.status!=="SENT"),ue=J.filter(fe=>fe.status==="READY_TO_SEND").length,ce=R.filter(fe=>fe.createdBy===I.id).length,le=E.filter(fe=>fe.createdBy===I.id).length;return{lawyer:I,totalOpen:J.length,readyToSendCount:ue,feedbackCount:ce,resendCount:le}}),[R,E,W]),h=I=>{var D;return I.hebrewWorkflowStatus?I.hebrewWorkflowStatus:((D=I.reportReview)==null?void 0:D.status)??"-"},S=I=>{if(!I)return ul.queueItem.noDate;try{const D=new Date(I);return`${D.toLocaleDateString("he-IL")} ${D.toLocaleTimeString("he-IL",{hour:"2-digit",minute:"2-digit"}).replace(":00","")}`}catch{return I}},[P,U]=g.useState("ADMIN"),[V,X]=g.useState(((M=ml[0])==null?void 0:M.id)||""),[te,G]=g.useState("SUMMARY"),[ae,j]=g.useState(null),F=g.useMemo(()=>c?Object.values(c).filter(I=>I.closedAt):[],[c]),L=g.useMemo(()=>ml.find(I=>I.id===V)||ml[0],[V]),O=g.useMemo(()=>{if(!L)return[];const I=W.get(L.id)||[],D=new Map;I.filter(le=>!le.deletedAt).forEach(le=>{const fe=le.odakanitNo&&le.odakanitNo.trim().length>0?le.odakanitNo.trim():"NO_ODAKANIT",Ee=D.get(fe)||[];Ee.push(le),D.set(fe,Ee)});const J=Array.from(D.entries()).map(([le,fe])=>{let Ee=fe[0];fe.forEach(Ke=>{const Ye=new Date(Ke.updatedAt||Ke.reportDate).getTime(),it=new Date(Ee.updatedAt||Ee.reportDate).getTime();Ye>it&&(Ee=Ke)});const ve=le==="NO_ODAKANIT"?"":le,$e=ve||"  ",Pe=Ee.updatedAt||Ee.reportDate;return{odakanitNo:ve,displayOdakanit:$e,representative:Ee,lastUpdatedIso:Pe,reportsCount:fe.length}}),ue=[];return c&&Object.values(c).forEach(le=>{var ve;if(!le.odakanitNo||le.assignedLawyer!==L.id)return;const fe=le.odakanitNo.trim();if(!fe||D.has(fe))return;const Ee={id:`seed-folder-${fe}`,createdBy:L.id,ownerName:L.name,ownerEmail:L.email,reportDate:le.updatedAt||le.createdAt,status:"DRAFT",reportSubject:le.reTemplate||"",recipientId:"1",insurerName:le.insurerName||"",lineSlipNo:le.lineSlipNo||"",marketRef:le.marketRef||"",certificateRef:le.certificateRef||"",insuredName:le.insuredName||"",plaintiffName:le.plaintiffName||"",plaintiffTitle:"Plaintiff",sentAt:void 0,reportHistory:[],selectedTimeline:"standard",filenameTag:"New lawsuit",selectedSections:["Update","Recommendations"],content:{},translatedContent:{},invoiceFiles:[],isWaitingForInvoices:!1,requiresExpenses:!1,isTranslated:!1,expensesItems:[],expenseWorksheet:void 0,reportNotes:[],complaintAnalysis:void 0};ue.push({odakanitNo:le.odakanitNo,displayOdakanit:le.odakanitNo||"  ",representative:Ee,lastUpdatedIso:le.updatedAt||le.createdAt,reportsCount:((ve=le.sentReports)==null?void 0:ve.length)||0})}),[...J,...ue].sort((le,fe)=>{const Ee=le.lastUpdatedIso?new Date(le.lastUpdatedIso).getTime():0;return(fe.lastUpdatedIso?new Date(fe.lastUpdatedIso).getTime():0)-Ee})},[W,L,c]),H=g.useMemo(()=>{if(!L||!ae)return[];const I=W.get(L.id)||[],D=ae.trim();return I.filter(J=>!J.deletedAt).filter(J=>(J.odakanitNo||"").trim()===D)},[W,L,ae]);return n.jsx("div",{className:"min-h-screen bg-navySecondary",dir:"rtl",children:n.jsxs("div",{className:"w-full px-6 md:px-8 lg:px-10 xl:px-12 py-6",children:[n.jsxs("header",{className:"flex flex-col md:flex-row items-start md:items-center justify-between gap-4 mb-6",children:[n.jsxs("div",{children:[n.jsx("h1",{className:"text-2xl font-bold text-textLight",children:ul.title}),n.jsx("p",{className:"text-sm text-textMuted mt-1",children:ul.subtitle}),n.jsxs("p",{className:"text-xs text-textMuted mt-1",children:["/ ",n.jsx("span",{className:"font-semibold",children:e.name})," ",n.jsxs("span",{className:"ml-1 text-textMuted",children:["(",e.role==="SUB_ADMIN"?"SUB_ADMIN":"ADMIN",")"]})]})]}),n.jsxs("div",{className:"flex flex-col items-stretch md:flex-row md:items-center gap-3",children:[n.jsxs("div",{className:"inline-flex rounded-full bg-slate-100 p-1 text-xs font-semibold text-textMuted",children:[n.jsx("button",{type:"button",onClick:()=>U("ADMIN"),className:`px-3 py-1 rounded-full transition ${P==="ADMIN"?"bg-panel text-textLight shadow-sm":"text-textMuted hover:text-textLight"}`,children:" "}),n.jsx("button",{type:"button",onClick:()=>U("FINANCIAL_CONTROL"),className:`px-3 py-1 rounded-full transition ${P==="FINANCIAL_CONTROL"?"bg-panel text-textLight shadow-sm":"text-textMuted hover:text-textLight"}`,children:" "})]}),y&&n.jsx("button",{type:"button",onClick:()=>y(),className:"inline-flex items-center justify-center px-3 py-2 rounded-lg border border-indigo-200 bg-panel text-xs font-semibold text-indigo-800 hover:bg-indigo-50 transition",children:" "}),n.jsx("button",{type:"button",onClick:p,className:"inline-flex items-center justify-center px-3 py-2 rounded-lg border border-red-200 bg-panel text-sm font-semibold text-red-700 hover:bg-red-50 transition",children:""}),n.jsx("button",{onClick:l,className:"inline-flex items-center justify-center px-4 py-2 rounded-lg bg-lpBlue text-white text-sm font-semibold shadow-sm hover:bg-blue-800 transition",children:ul.actions.openNewReport})]})]}),P==="FINANCIAL_CONTROL"?n.jsx(zb,{user:e,reports:t,onOpenReport:s}):n.jsxs(n.Fragment,{children:[n.jsxs("section",{className:"mb-6",children:[n.jsx("h2",{className:"text-sm font-semibold text-textLight mb-2",children:"   "}),n.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 xl:grid-cols-5 gap-3 text-xs",children:N.map(I=>{const D=(L==null?void 0:L.id)===I.lawyer.id;return n.jsxs("button",{type:"button",onClick:()=>{X(I.lawyer.id),j(null),G("LAWYER_CASES")},className:`flex flex-col items-stretch rounded-2xl border px-3 py-3 text-right shadow-sm transition ${D?"border-gold bg-blue-50/80":"border-borderDark bg-panel hover:bg-navySecondary"}`,children:[n.jsxs("div",{className:"flex items-center justify-between mb-1",children:[n.jsx("span",{className:"text-[11px] font-semibold text-slate-700",children:I.lawyer.name}),n.jsxs("span",{className:"inline-flex items-center rounded-full bg-slate-100 px-2 py-0.5 text-[10px] text-textMuted",children:[I.totalOpen," "]})]}),n.jsxs("div",{className:"flex flex-col gap-0.5 text-[11px] text-textMuted",children:[n.jsxs("span",{children:[" :",n.jsx("span",{className:"font-semibold text-emerald-700",children:I.readyToSendCount})]}),n.jsxs("span",{children:["  :",n.jsx("span",{className:"font-semibold text-purple-700",children:I.feedbackCount})]})]})]},I.lawyer.id)})})]}),e.role==="ADMIN"&&c&&i&&n.jsx(Rb,{caseFolders:c,onUpdateCaseFolders:i,reports:t}),e.role==="ADMIN"&&F.length>0&&n.jsxs("section",{className:"mb-6 bg-panel rounded-2xl border border-borderDark shadow-sm p-4",children:[n.jsx("div",{className:"flex items-center justify-between mb-3",children:n.jsxs("div",{children:[n.jsx("h2",{className:"text-sm font-semibold text-textLight",children:" "}),n.jsx("p",{className:"text-[11px] text-textMuted",children:"      .   ,   (  )   ."})]})}),n.jsx("div",{className:"overflow-x-auto",children:n.jsxs("table",{className:"min-w-full text-[11px]",children:[n.jsx("thead",{children:n.jsxs("tr",{className:"border-b border-borderDark bg-navySecondary",children:[n.jsx("th",{className:"px-2 py-1 text-right font-semibold",children:"  "}),n.jsx("th",{className:"px-2 py-1 text-right font-semibold",children:""}),n.jsx("th",{className:"px-2 py-1 text-right font-semibold",children:""}),n.jsx("th",{className:"px-2 py-1 text-right font-semibold",children:" "}),n.jsx("th",{className:"px-2 py-1 text-right font-semibold",children:""})]})}),n.jsx("tbody",{children:F.map(I=>{const D=I.closedAt?new Date(I.closedAt).toLocaleDateString("he-IL"):"";return n.jsxs("tr",{className:"border-b border-borderDark",children:[n.jsx("td",{className:"px-2 py-1 text-right font-semibold text-textLight",children:I.odakanitNo}),n.jsx("td",{className:"px-2 py-1 text-right text-slate-700",children:I.insuredName||""}),n.jsx("td",{className:"px-2 py-1 text-right text-slate-700",children:I.plaintiffName||""}),n.jsx("td",{className:"px-2 py-1 text-right text-textMuted",children:D}),n.jsx("td",{className:"px-2 py-1 text-left",children:b&&n.jsx("button",{type:"button",onClick:()=>b(I.odakanitNo),className:"inline-flex items-center rounded-full bg-panel px-3 py-1 text-[11px] font-semibold text-gold border border-gold hover:bg-navySecondary",children:" "})})]},I.odakanitNo)})})]})})]}),te==="LAWYER_CASES"&&L&&n.jsxs("section",{className:"mb-6 bg-panel rounded-2xl border border-borderDark shadow-sm p-4",children:[n.jsxs("div",{className:"flex items-center justify-between mb-3",children:[n.jsxs("div",{children:[n.jsxs("h2",{className:"text-sm font-semibold text-textLight",children:["     ",L.name]}),n.jsx("p",{className:"text-[11px] text-textMuted",children:"        ."})]}),n.jsx("button",{type:"button",onClick:()=>{G("SUMMARY"),j(null)},className:"text-[11px] px-3 py-1.5 rounded-full border border-borderDark text-slate-700 hover:bg-navySecondary",children:" "})]}),O.length===0?n.jsx("p",{className:"text-xs text-textMuted",children:"       ."}):n.jsx("div",{className:"overflow-x-auto",children:n.jsxs("table",{className:"min-w-full text-[11px]",children:[n.jsx("thead",{children:n.jsxs("tr",{className:"border-b border-borderDark bg-navySecondary",children:[n.jsx("th",{className:"px-2 py-1 text-right font-semibold",children:" "}),n.jsx("th",{className:"px-2 py-1 text-right font-semibold w-20",children:"REPORT NO."}),n.jsx("th",{className:"px-2 py-1 text-right font-semibold w-40",children:"PLAINTIFF/CLAIMANT"}),n.jsx("th",{className:"px-2 py-1 text-right font-semibold w-40",children:"INSURED"}),n.jsx("th",{className:"px-2 py-1 text-right font-semibold w-40",children:"INSURER"}),n.jsx("th",{className:"px-2 py-1 text-right font-semibold w-28",children:"'  "})]})}),n.jsx("tbody",{children:O.map(I=>{var Pe;const{representative:D}=I,J=!!I.odakanitNo,ue=ei(D),ce=ue?ue.split(" - "):[],le=ce.length<=2?ue:ce[ce.length-2]||ue,fe=typeof D.reportNumber=="number"&&D.reportNumber>0?D.reportNumber:(((Pe=D.reportHistory)==null?void 0:Pe.length)||0)+1,Ee=D.plaintiffName||"",ve=D.insuredName||"",$e=D.insurerName||"";return n.jsxs("tr",{className:`border-b border-borderDark ${J?"hover:bg-navySecondary cursor-pointer":"bg-navySecondary/40 text-textMuted"}`,onClick:()=>{J&&(j(I.odakanitNo),G("CASE_REPORTS"))},children:[n.jsxs("td",{className:"px-2 py-1 text-right",children:[n.jsx("div",{className:"text-textLight",children:le||""}),n.jsx("div",{className:"text-[10px] text-textMuted",children:S(I.lastUpdatedIso)})]}),n.jsx("td",{className:"px-2 py-1 text-right text-slate-700 font-mono text-[11px]",children:fe}),n.jsx("td",{className:"px-2 py-1 text-right text-slate-700",children:Ee}),n.jsx("td",{className:"px-2 py-1 text-right text-slate-700",children:ve}),n.jsx("td",{className:"px-2 py-1 text-right text-slate-700",children:$e}),n.jsx("td",{className:"px-2 py-1 text-right font-mono text-[11px]",children:I.displayOdakanit})]},I.displayOdakanit)})})]})})]}),te==="CASE_REPORTS"&&L&&ae&&n.jsxs("section",{className:"mb-6 bg-panel rounded-2xl border border-borderDark shadow-sm p-4",children:[n.jsxs("div",{className:"flex items-center justify-between mb-3",children:[n.jsxs("div",{children:[n.jsxs("h2",{className:"text-sm font-semibold text-textLight",children:["  ",ae,"  ",L.name]}),n.jsx("p",{className:"text-[11px] text-textMuted",children:"  ,     ."})]}),n.jsx("button",{type:"button",onClick:()=>G("LAWYER_CASES"),className:"text-[11px] px-3 py-1.5 rounded-full border border-borderDark text-slate-700 hover:bg-navySecondary",children:" "})]}),H.length===0?n.jsx("p",{className:"text-xs text-textMuted",children:"     ."}):n.jsx("div",{className:"overflow-x-auto",children:n.jsxs("table",{className:"min-w-full text-[11px]",children:[n.jsx("thead",{children:n.jsxs("tr",{className:"border-b border-borderDark bg-navySecondary",children:[n.jsx("th",{className:"px-2 py-1 text-right font-semibold w-64",children:" /  / "}),n.jsx("th",{className:"px-2 py-1 text-right font-semibold w-24",children:' \\"'}),n.jsx("th",{className:"px-2 py-1 text-right font-semibold w-32",children:""}),n.jsx("th",{className:"px-2 py-1 text-right font-semibold w-32",children:" "}),n.jsx("th",{className:"px-2 py-1 text-right font-semibold w-28"})]})}),n.jsx("tbody",{children:H.map(I=>{var fe;const D=Jb(I),J=D==="GREEN"?"bg-emerald-50":D==="RED"?"bg-red-50":"bg-yellow-50",ue=!!I.expensesSheetId,ce=I.reportSubject||I.insuredName||I.plaintiffName||"",le=typeof I.reportNumber=="number"&&I.reportNumber>0?I.reportNumber:(((fe=I.reportHistory)==null?void 0:fe.length)||0)+1;return n.jsxs("tr",{className:`border-b border-borderDark hover:bg-slate-100 cursor-pointer ${J}`,onClick:()=>s(I.id),children:[n.jsxs("td",{className:"px-2 py-1 text-right",children:[n.jsxs("div",{className:"text-textLight flex flex-wrap items-center gap-1 justify-end",children:[n.jsx("span",{children:ce}),ue&&n.jsx("span",{className:"inline-flex items-center rounded-full bg-purple-100 px-2 py-0.5 text-[10px] font-medium text-purple-700",children:" /  "})]}),(I.insuredName||I.plaintiffName)&&n.jsx("div",{className:"text-[10px] text-textMuted",children:[I.insuredName,I.plaintiffName].filter(Boolean).join(" / ")})]}),n.jsx("td",{className:"px-2 py-1 text-right text-slate-700",children:le}),n.jsxs("td",{className:"px-2 py-1 text-right text-slate-700",children:[h(I)," (",I.status,")"]}),n.jsx("td",{className:"px-2 py-1 text-right text-textMuted whitespace-nowrap",children:S(I.updatedAt||I.reportDate)}),n.jsx("td",{className:"px-2 py-1 text-left",children:n.jsx("button",{type:"button",onClick:Ee=>{Ee.stopPropagation(),s(I.id)},className:"inline-flex items-center rounded-full bg-lpBlue px-3 py-1 text-[11px] font-semibold text-white shadow-sm hover:bg-blue-900",children:' \\"'})})]},I.id)})})]})})]})]})]})})},Zb=({user:e,reports:t,onLogout:s,onNotifyLawyer:r,onMarkReportPaid:a,onSheetDeleted:o,onOpenAssistant:l,caseFolders:c})=>{const[i,u]=g.useState([]),[p,y]=g.useState(null),[b,w]=g.useState(!1),[R,E]=g.useState("ALL"),[W,N]=g.useState(""),[h,S]=g.useState(null),[P,U]=g.useState(null),[V,X]=g.useState({}),te=async()=>{w(!0);try{const H=await Xe.listSheets();u(H)}finally{w(!1)}};g.useEffect(()=>{te()},[]);const G=g.useMemo(()=>{const H=new Map;return t.forEach(M=>{if(!M.expensesSheetId)return;const I=H.get(M.expensesSheetId);if(!I){H.set(M.expensesSheetId,M);return}const D=I.updatedAt&&new Date(I.updatedAt).getTime()||0;(M.updatedAt&&new Date(M.updatedAt).getTime()||0)>D&&H.set(M.expensesSheetId,M)}),H},[t]),ae=g.useMemo(()=>[...i.filter(M=>{if(R!=="ALL"&&M.status!==R)return!1;const I=W.trim().toLowerCase();return!(I&&!(M.insurerName||"").toLowerCase().includes(I))})].sort((M,I)=>{const D=Xa(M.caseId)===M.id?1:0,J=Xa(I.caseId)===I.id?1:0;if(J!==D)return J-D;const ue=new Date(M.updatedAt||M.createdAt).getTime();return new Date(I.updatedAt||I.createdAt).getTime()-ue}),[i,R,W]);g.useEffect(()=>{const H=ae.map(M=>M.id).filter(M=>!V[M]);H.length&&H.forEach(M=>{(async()=>{try{const I=await Xe.getSheet(M);if(!I)return;const D=Fn(I.sheet,I.lineItems);X(J=>({...J,[M]:D}))}catch{}})()})},[ae,V]);const j=async H=>{const M=await Xe.getSheet(H);M&&(S(H),U(M))},F=async()=>{const M=(window.prompt("  / :")||"").trim();if(!M)return;const I=Se(M),D=t.filter(Ee=>Se(Ee.odakanitNo||"")===I);let J=null;D.length>0&&(J=D.reduce((ve,$e)=>{const Pe=ve.updatedAt?new Date(ve.updatedAt).getTime()||0:new Date(ve.reportDate||"").getTime()||0;return($e.updatedAt?new Date($e.updatedAt).getTime()||0:new Date($e.reportDate||"").getTime()||0)>Pe?$e:ve}).insurerName||null);let ue=1,ce=0,le=0;try{const ve=(await Xe.listSheets()).filter($e=>Se($e.caseId)===I);if(ve.length>0){ve.sort((Ke,Ye)=>{const it=new Date(Ke.updatedAt||Ke.createdAt).getTime();return new Date(Ye.updatedAt||Ye.createdAt).getTime()-it});const $e=ve[0];ce=$e.deductibleAmount??0,le=$e.alreadyPaidAmount??0,ue=ve.reduce((Ke,Ye)=>Ye.versionIndex&&Ye.versionIndex>Ke?Ye.versionIndex:Ke,1)+1}}catch{}const fe=await Xe.createSheet(e,{caseId:M,insurerId:null,insurerName:J,periodLabel:"",versionIndex:ue,currency:"ILS",deductibleAmount:ce,alreadyPaidAmount:le,infoOnly:!1});await te(),await j(fe.id)},L=H=>{U(H),u(M=>M.map(I=>I.id===H.sheet.id?H.sheet:I));try{const M=Fn(H.sheet,H.lineItems);X(I=>({...I,[H.sheet.id]:M}))}catch{}},O=()=>{S(null),U(null)};if(h&&P){const H=G.get(P.sheet.id)||null;return n.jsx("div",{className:"w-full px-6 md:px-8 lg:px-10 xl:px-12 py-6",children:n.jsx(Mh,{user:e,sheetWithRelations:P,onSheetUpdated:L,onBack:O,onNotifyLawyer:r,linkedReportForLawyer:H})})}return n.jsxs("div",{className:"w-full px-6 md:px-8 lg:px-10 xl:px-12 py-6",children:[n.jsxs("div",{className:"flex items-center justify-between mb-5",children:[n.jsxs("div",{children:[n.jsx("h1",{className:"text-3xl font-semibold text-gray-900",children:" "}),n.jsx("p",{className:"text-base text-gray-600 mt-1",children:"        ()."})]}),n.jsxs("div",{className:"flex gap-2 items-center",children:[l&&n.jsx("button",{type:"button",className:"px-3 py-1.5 text-base rounded border border-indigo-200 text-indigo-800 bg-indigo-50 hover:bg-indigo-100",onClick:l,children:" "}),n.jsx("button",{type:"button",className:"px-3 py-1.5 text-base rounded border border-gray-300 text-gray-700 hover:bg-gray-50",onClick:s,children:""}),n.jsx("button",{type:"button",className:"px-4 py-1.5 text-base rounded bg-blue-600 text-white hover:bg-blue-700",onClick:F,children:"   "})]})]}),n.jsxs("div",{className:"flex flex-wrap gap-4 mb-4 items-end",children:[n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"  "}),n.jsxs("select",{className:"border rounded px-2 py-1 text-base",value:R,onChange:H=>E(H.target.value==="ALL"?"ALL":H.target.value),children:[n.jsx("option",{value:"ALL",children:""}),Hb.map(H=>n.jsx("option",{value:H.value,children:H.label},H.value))]})]}),n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:""}),n.jsx("input",{className:"border rounded px-2 py-1 text-base",placeholder:"   ",value:W,onChange:H=>N(H.target.value)})]})]}),n.jsx("div",{className:"bg-white border rounded-lg shadow-sm overflow-x-auto text-base",children:n.jsxs("table",{className:"min-w-full",children:[n.jsx("thead",{className:"bg-gray-50",children:n.jsxs("tr",{children:[n.jsx("th",{className:"px-3 py-2 border-b text-right",children:""}),n.jsx("th",{className:"px-3 py-2 border-b text-right",children:""}),n.jsx("th",{className:"px-3 py-2 border-b text-right",children:""}),n.jsx("th",{className:"px-3 py-2 border-b text-right",children:""}),n.jsx("th",{className:"px-3 py-2 border-b text-right",children:" "}),n.jsx("th",{className:"px-3 py-2 border-b text-right",children:" "}),n.jsx("th",{className:"px-3 py-2 border-b text-right",children:""})]})}),n.jsxs("tbody",{children:[b&&n.jsx("tr",{children:n.jsx("td",{colSpan:7,className:"px-3 py-4 text-center text-gray-500",children:" "})}),!b&&ae.length===0&&n.jsx("tr",{children:n.jsx("td",{colSpan:7,className:"px-3 py-4 text-center text-gray-500",children:"    ."})}),!b&&ae.map(H=>{const M=G.get(H.id),I=V[H.id];M?M.status==="TASK_ASSIGNED"?" ":M.status==="WAITING_FOR_INVOICES"?" ":M.status==="READY_TO_SEND"?"   ":M.status==="SENT"?"  ":"  ":"";const D=Oh(H,M),J=Xa(H.caseId)===H.id,ue=(()=>{const ce=Se(H.caseId),le=c==null?void 0:c[ce];return le&&le.closedAt?"":!le&&!t.some(Ee=>Se(Ee.odakanitNo)===ce)?"  ":""})();return n.jsxs("tr",{className:"hover:bg-gray-50",children:[n.jsx("td",{className:"px-3 py-2 border-b font-mono text-sm text-gray-800",children:n.jsxs("div",{className:"flex flex-col items-start gap-0.5",children:[n.jsx("span",{children:H.caseId}),n.jsx("span",{className:"inline-flex px-2 py-0.5 rounded-full text-[11px] bg-gray-100 text-gray-700 border border-gray-200",children:ue===""?" ":ue==="  "?"  ":" "})]})}),n.jsx("td",{className:"px-3 py-2 border-b text-gray-800",children:H.insurerName||""}),n.jsxs("td",{className:"px-3 py-2 border-b text-gray-800",children:["  #",H.versionIndex]}),n.jsx("td",{className:"px-3 py-2 border-b",children:n.jsxs("div",{className:"flex flex-wrap items-center gap-1",children:[J?n.jsx("span",{className:"inline-flex px-2 py-0.5 rounded-full text-xs font-medium bg-emerald-100 text-emerald-800 border border-emerald-200",children:""}):n.jsx("span",{className:"inline-flex px-2 py-0.5 rounded-full text-xs font-medium bg-gray-100 text-gray-600 border border-gray-200",children:""}),n.jsx("span",{className:"inline-flex px-2 py-0.5 rounded-full text-sm bg-gray-100 text-gray-700 border border-gray-200",children:D})]})}),n.jsx("td",{className:"px-3 py-2 border-b text-gray-700",children:H.updatedAt?new Date(H.updatedAt).toLocaleString("he-IL",{dateStyle:"short",timeStyle:"short"}):""}),n.jsx("td",{className:"px-3 py-2 border-b text-blue-700 font-semibold",children:I?`${I.amountToRequest.toLocaleString("he-IL")} `:""}),n.jsx("td",{className:"px-3 py-2 border-b text-left",children:n.jsxs("div",{className:"flex items-center gap-2 justify-start",children:[n.jsx("button",{type:"button",className:"px-3 py-1 text-sm rounded border border-blue-500 text-blue-700 hover:bg-blue-50",onClick:()=>void j(H.id),children:""}),M&&M.status==="SENT"&&!M.isPaid&&a&&n.jsx("button",{type:"button",className:"px-3 py-1 text-sm rounded border border-green-500 text-green-700 hover:bg-green-50",onClick:()=>a(M.id),children:""}),(()=>{const ce=t.some(Ke=>Ke.expensesSheetId===H.id),le=t.find(Ke=>Ke.expensesSheetId===H.id),fe=!!(le!=null&&le.isPaid),Ee=!ce||!fe,ve=fe&&e.role==="ADMIN";if(!(Ee||ve))return n.jsx("span",{className:"text-xs text-gray-500 max-w-[180px]",children:"      ."});const Pe=()=>{if(ve)y({sheet:H,reason:""});else{if(!window.confirm("    ?   ."))return;(async()=>(await Xe.deleteSheet(H.id),o==null||o(H.id),await te()))()}};return n.jsx("button",{type:"button",className:"px-2 py-1 text-sm rounded border border-red-400 text-red-600 hover:bg-red-50",onClick:Pe,children:""})})()]})})]},H.id)})]})]})}),p&&n.jsx("div",{className:"fixed inset-0 bg-black/50 z-[200] flex items-center justify-center p-4",dir:"rtl",children:n.jsxs("div",{className:"bg-white rounded-xl shadow-xl max-w-md w-full p-6",children:[n.jsx("h3",{className:"text-lg font-bold text-gray-900 mb-2",children:"    "}),n.jsx("p",{className:"text-sm text-gray-700 mb-4",children:"    ()."}),n.jsx("input",{type:"text",className:"w-full border rounded px-3 py-2 text-sm mb-4",placeholder:" ",value:p.reason,onChange:H=>y(M=>M?{...M,reason:H.target.value}:null)}),n.jsxs("div",{className:"flex gap-2 justify-end",children:[n.jsx("button",{type:"button",className:"px-3 py-1.5 rounded border border-gray-300 text-gray-700",onClick:()=>y(null),children:""}),n.jsx("button",{type:"button",className:"px-3 py-1.5 rounded bg-red-600 text-white disabled:opacity-50",disabled:!p.reason.trim(),onClick:()=>{p.reason.trim()&&(Xe.recordSheetDeletionByAdmin(e,p.sheet.id,p.reason.trim()),(async()=>(await Xe.deleteSheet(p.sheet.id),o==null||o(p.sheet.id),y(null),await te()))())},children:"  "})]})]})})]})},ev=g.createContext(void 0);let tv=0;const nv=({children:e})=>{const[t,s]=g.useState([]),r=g.useCallback(l=>{s(c=>c.filter(i=>i.id!==l))},[]),a=g.useCallback(({message:l,type:c="info"})=>{const i=++tv;s(u=>[...u,{id:i,message:l,type:c}]),window.setTimeout(()=>{r(i)},3e3)},[r]),o=l=>l==="success"?"border-l-gold text-goldLight":l==="error"?"border-l-danger text-red-300":"border-l-gold text-textLight";return n.jsxs(ev.Provider,{value:{showToast:a},children:[e,n.jsx("div",{className:"fixed top-4 right-4 z-[260] flex flex-col gap-2 items-end pointer-events-none",dir:"rtl",children:t.map(l=>n.jsxs("div",{className:`pointer-events-auto max-w-xs bg-panel border border-borderDark rounded-lg shadow-lg px-3 py-2 border-l-4 text-xs flex items-center gap-2 text-textLight ${o(l.type)}`,children:[n.jsx("span",{className:"whitespace-pre-line",children:l.message}),n.jsx("button",{type:"button",onClick:()=>r(l.id),className:"ml-1 p-1 rounded hover:bg-navySecondary text-textMuted",children:n.jsx(Ht,{className:"w-3 h-3"})})]},l.id))})]})},sv=({folder:e,reports:t,onBack:s,onUpdateReTemplate:r,onCreateReportInCase:a,onOpenReport:o,currentUserRole:l,onCloseCase:c,onReopenCase:i,onDeleteCase:u})=>{const[p,y]=g.useState(e.reTemplate||""),b=()=>{const h=p.trim();h!==e.reTemplate&&r(h)},E=t.filter(h=>h.odakanitNo&&h.odakanitNo.trim()===e.odakanitNo).filter(h=>h.status!=="SENT"&&!h.deletedAt)[0]||null,W=!!e.closedAt,N=g.useMemo(()=>{const h=new Map;return e.sentReports.forEach(S=>{if(!S||!S.reportId)return;const P=h.get(S.reportId);if(!P){h.set(S.reportId,S);return}const U=new Date(P.sentAt).getTime()||0;(new Date(S.sentAt).getTime()||0)>=U&&h.set(S.reportId,S)}),Array.from(h.values()).sort((S,P)=>{const U=new Date(S.sentAt).getTime()||0,V=new Date(P.sentAt).getTime()||0;return U-V})},[e.sentReports]);return n.jsx("div",{className:"min-h-screen bg-bgDark px-0 pb-8",children:n.jsxs("div",{className:"w-full px-6 md:px-8 lg:px-10 xl:px-12 pt-4",children:[n.jsx("button",{type:"button",onClick:s,className:"mb-4 inline-flex items-center rounded-full bg-panel border border-borderDark px-3 py-1.5 text-xs font-medium text-textLight shadow-sm hover:bg-navySecondary focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-gold focus-visible:ring-offset-2",children:"  "}),n.jsxs("header",{className:"mb-4 rounded-2xl bg-panel px-5 py-4 shadow-sm border border-borderDark flex flex-col gap-2 md:flex-row md:items-center md:justify-between",children:[n.jsxs("div",{children:[n.jsxs("h1",{className:"text-xl font-serif font-bold text-navy",children:["   ",e.odakanitNo]}),n.jsx("p",{className:"mt-1 text-xs text-textMuted",children:"       ."}),W&&n.jsx("p",{className:"mt-1 text-[11px] font-semibold text-amber-700",children:" :    .        ."})]}),n.jsxs("div",{className:"flex flex-wrap items-center gap-2 text-xs",children:[l==="ADMIN"&&!W&&c&&n.jsx("button",{type:"button",onClick:c,className:"inline-flex items-center rounded-full bg-red-50 px-3 py-1.5 font-semibold text-red-700 border border-red-200 hover:bg-red-100",children:" "}),l==="ADMIN"&&W&&n.jsxs(n.Fragment,{children:[i&&n.jsx("button",{type:"button",onClick:i,className:"inline-flex items-center rounded-full bg-green-50 px-3 py-1.5 font-semibold text-green-700 border border-green-200 hover:bg-green-100",children:"  "}),u&&n.jsx("button",{type:"button",onClick:u,className:"inline-flex items-center rounded-full bg-panel px-3 py-1.5 font-semibold text-textLight border border-borderDark hover:bg-navySecondary",children:" "})]})]})]}),n.jsxs("section",{className:"mb-4 grid gap-4 md:grid-cols-2",children:[n.jsxs("div",{className:"rounded-2xl bg-panel p-4 shadow-sm border border-borderDark",children:[n.jsx("h2",{className:"mb-2 text-xs font-semibold uppercase tracking-wide text-textMuted",children:" "}),n.jsxs("dl",{className:"space-y-1 text-xs text-textLight",children:[n.jsxs("div",{children:[n.jsx("dt",{className:"font-semibold text-textMuted",children:""}),n.jsx("dd",{children:e.insuredName||""})]}),n.jsxs("div",{children:[n.jsx("dt",{className:"font-semibold text-textMuted",children:""}),n.jsx("dd",{children:e.plaintiffName||""})]}),n.jsxs("div",{children:[n.jsx("dt",{className:"font-semibold text-textMuted",children:""}),n.jsx("dd",{children:e.insurerName||""})]}),n.jsxs("div",{children:[n.jsx("dt",{className:"font-semibold text-textMuted",children:"UMR /  "}),n.jsx("dd",{children:e.marketRef||""})]}),n.jsxs("div",{children:[n.jsx("dt",{className:"font-semibold text-textMuted",children:"Line Slip"}),n.jsx("dd",{children:e.lineSlipNo||""})]}),n.jsxs("div",{children:[n.jsx("dt",{className:"font-semibold text-textMuted",children:" "}),n.jsx("dd",{children:e.certificateRef||""})]}),n.jsxs("div",{children:[n.jsx("dt",{className:"font-semibold text-textMuted",children:"  "}),n.jsx("dd",{children:e.reportIds.length})]}),W&&n.jsxs("div",{children:[n.jsx("dt",{className:"font-semibold text-textMuted",children:" "}),n.jsx("dd",{className:"text-amber-700",children:""})]})]})]}),n.jsxs("div",{className:"rounded-2xl bg-panel p-4 shadow-sm border border-borderDark",children:[n.jsx("h2",{className:"mb-2 text-xs font-semibold uppercase tracking-wide text-textMuted",children:"  (RE)"}),n.jsx("textarea",{className:"w-full rounded-lg border border-borderDark p-2 text-xs text-textLight placeholder:text-textMuted focus:border-navy focus:outline-none focus:ring-1 focus:ring-navy",rows:4,value:p,onChange:h=>y(h.target.value),onBlur:b,placeholder:"Example: John Doe v. XYZ Medical Center - Claim Update"}),n.jsx("div",{className:"mt-3 flex justify-end",children:n.jsx("button",{type:"button",onClick:a,className:"inline-flex items-center rounded-full bg-navy px-4 py-1.5 text-[11px] font-semibold text-white shadow-sm hover:bg-blue-900 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-navy focus-visible:ring-offset-2",children:"    "})})]})]}),n.jsxs("section",{className:"mb-4 rounded-2xl bg-panel p-4 shadow-sm border border-borderDark",children:[n.jsxs("div",{className:"mb-3 flex items-center justify-between gap-3",children:[n.jsxs("div",{children:[n.jsx("h2",{className:"text-sm font-semibold text-textLight",children:"   "}),n.jsx("p",{className:"text-xs text-textMuted",children:"     SENT   ( )."})]}),n.jsxs("div",{className:"flex items-center gap-2",children:[E&&n.jsx("button",{type:"button",onClick:()=>o(E.id),className:"rounded-full bg-amber-50 px-3 py-1 text-[11px] font-semibold text-amber-800 border border-amber-200 hover:bg-amber-100",children:"     "}),!W&&n.jsx(n.Fragment,{children:l==="LAWYER"?!E&&n.jsx("button",{type:"button",onClick:a,className:"inline-flex items-center rounded-full bg-navy px-4 py-1.5 text-xs font-semibold text-white shadow-sm hover:bg-blue-900 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-navy focus-visible:ring-offset-2",children:"    "}):n.jsx("button",{type:"button",onClick:a,className:"inline-flex items-center rounded-full bg-navy px-4 py-1.5 text-xs font-semibold text-white shadow-sm hover:bg-blue-900 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-navy focus-visible:ring-offset-2",children:E?"   ()":"    "})})]})]}),n.jsx("div",{className:"overflow-x-auto",children:n.jsxs("table",{className:"min-w-full text-xs text-left text-textLight",children:[n.jsx("thead",{className:"bg-navySecondary text-[11px] uppercase tracking-wide text-textMuted",children:n.jsxs("tr",{children:[n.jsx("th",{className:"px-3 py-2",children:"' "}),n.jsx("th",{className:"px-3 py-2",children:""}),n.jsx("th",{className:"px-3 py-2",children:" "}),n.jsx("th",{className:"px-3 py-2",children:"  / "}),n.jsx("th",{className:"px-3 py-2",children:""})]})}),n.jsxs("tbody",{className:"divide-y divide-gray-100",children:[N.length===0&&n.jsx("tr",{children:n.jsx("td",{colSpan:4,className:"px-3 py-4 text-center text-textMuted",children:"No sent reports recorded for this case yet."})}),N.map(h=>{const S=h.sentAt?new Date(h.sentAt).toLocaleDateString("en-GB",{day:"2-digit",month:"short",year:"numeric"}):"",P=h.snapshot&&h.snapshot.reportSubject||"",U=h.fileName||P||"";return n.jsxs("tr",{children:[n.jsx("td",{className:"px-3 py-2",children:h.reportNo?`#${h.reportNo}`:""}),n.jsx("td",{className:"px-3 py-2",children:h.isResend?n.jsx("span",{className:"inline-flex items-center rounded-full bg-amber-50 px-2 py-0.5 text-[10px] font-semibold text-amber-800 border border-amber-200",children:" "}):n.jsx("span",{className:"inline-flex items-center rounded-full bg-navySecondary px-2 py-0.5 text-[10px] font-semibold text-textMuted border border-borderDark",children:" "})}),n.jsx("td",{className:"px-3 py-2",children:S}),n.jsx("td",{className:"px-3 py-2",children:U}),n.jsx("td",{className:"px-3 py-2",children:n.jsx("button",{type:"button",onClick:()=>o(h.reportId),className:"inline-flex items-center rounded-full bg-panel px-3 py-1 text-[11px] font-semibold text-navy ring-1 ring-navy hover:bg-blue-50 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-navy focus-visible:ring-offset-2","aria-label":` " ${h.reportId}`,children:""})})]},`${h.reportId}-${h.sentAt}`)})]})]})})]})]})})},Ph="lp_case_folders",Fh="lp_case_folders_migrated",rv=()=>{if(typeof window>"u")return{};try{const e=window.localStorage.getItem(Ph),t=e?JSON.parse(e):{};return!t||typeof t!="object"?{}:t}catch(e){return console.error("Failed to load case folders",e),{}}},Dn=e=>{if(!(typeof window>"u"))try{window.localStorage.setItem(Ph,JSON.stringify(e))}catch(t){console.error("Failed to persist case folders",t)}},av=e=>{if(!e||typeof e!="object")return{};const t={};let s=!1;return Object.entries(e).forEach(([r,a])=>{const o=a.odakanitNo||r,l=Se(o);if(!l){s=!0;return}const c=t[l];if(!c){t[l]={...a,odakanitNo:l},l!==r&&(s=!0);return}s=!0;const i=(b,w)=>{if(!b)return w;if(!w)return b;const R=new Date(b.updatedAt||b.createdAt||"").getTime()||0;return(new Date(w.updatedAt||w.createdAt||"").getTime()||0)>R?w:b};let u=c,p=a;(!c.closedAt&&a.closedAt||i(c,a)===a)&&(u=a,p=c);const y={...u,odakanitNo:l,reTemplate:u.reTemplate||p.reTemplate||"",insuredName:u.insuredName||p.insuredName||"",insurerName:u.insurerName||p.insurerName||"",plaintiffName:u.plaintiffName||p.plaintiffName||"",marketRef:u.marketRef||p.marketRef||"",lineSlipNo:u.lineSlipNo||p.lineSlipNo||"",certificateRef:u.certificateRef||p.certificateRef||"",createdAt:u.createdAt||p.createdAt,updatedAt:u.updatedAt||p.updatedAt,closedAt:u.closedAt||p.closedAt||null,closedByUserId:u.closedByUserId||p.closedByUserId||null,reportIds:Array.from(new Set([...u.reportIds||[],...p.reportIds||[]])),sentReports:[...u.sentReports||[],...p.sentReports||[]]};t[l]=y}),s?t:e},Md=(e,t,s)=>{if(!t.odakanitNo)return e;const r=Se(t.odakanitNo);if(!r)return e;const a=s||new Date().toISOString(),o=e[r],l=o||{odakanitNo:r,reTemplate:"",insuredName:"",insurerName:"",plaintiffName:"",marketRef:"",lineSlipNo:"",certificateRef:"",createdAt:(o==null?void 0:o.createdAt)||a,updatedAt:(o==null?void 0:o.updatedAt)||a,reportIds:[],sentReports:(o==null?void 0:o.sentReports)||[]},c={...l,insuredName:t.insuredName||l.insuredName,insurerName:t.insurerName||l.insurerName,plaintiffName:t.plaintiffName||l.plaintiffName,marketRef:t.marketRef||l.marketRef,lineSlipNo:t.lineSlipNo||l.lineSlipNo,certificateRef:t.certificateRef||l.certificateRef,updatedAt:a,reportIds:l.reportIds.includes(t.id)?l.reportIds:[...l.reportIds,t.id],sentReports:l.sentReports},i=(t.reportSubject||"").trim();return i&&(!l.reTemplate||i!==l.reTemplate)&&(c.reTemplate=i),{...e,[r]:c}},Bh=(e,t,s,r,a)=>{var b;if(!t.odakanitNo)return e;const o=Se(t.odakanitNo);if(!o)return e;const l=s||new Date().toISOString(),c=e[o];if(!c)return e;const i=typeof t.reportNumber=="number"&&t.reportNumber>0?t.reportNumber:(((b=t.reportHistory)==null?void 0:b.length)||0)+1,u={id:t.id,odakanitNo:t.odakanitNo,insuredName:t.insuredName,plaintiffName:t.plaintiffName,insurerName:t.insurerName,marketRef:t.marketRef,lineSlipNo:t.lineSlipNo,certificateRef:t.certificateRef,reportDate:t.reportDate,status:"SENT",reportSubject:t.reportSubject},p={reportId:t.id,sentAt:l,reportNo:i,fileName:r,snapshot:u,isResend:!!a,resendIndex:i},y={...c,updatedAt:l,sentReports:[...c.sentReports,p]};return{...e,[o]:y}},Mc=(e,t)=>{let s={...e};return t.forEach(r=>{if(r.odakanitNo&&(s=Md(s,r,r.updatedAt||r.reportDate),r.status==="SENT")){const a=r.sentAt||r.reportDate||new Date().toISOString();s=Bh(s,r,a)}}),s},ov=()=>{if(!(typeof window>"u"))try{window.localStorage.setItem(Fh,"1")}catch{}},lv=()=>{if(typeof window>"u")return!0;try{return window.localStorage.getItem(Fh)==="1"}catch{return!0}},iv=(e,t)=>{const s=e.split(/\s+/).filter(Boolean),r=t.split(/\s+/).filter(Boolean),a=s.length,o=r.length;if(!a&&!o)return[];const l=Array.from({length:a+1},()=>Array(o+1).fill(0));for(let p=a-1;p>=0;p-=1)for(let y=o-1;y>=0;y-=1)s[p]===r[y]?l[p][y]=l[p+1][y+1]+1:l[p][y]=Math.max(l[p+1][y],l[p][y+1]);const c=[];let i=0,u=0;for(;i<a&&u<o;)s[i]===r[u]?(c.push({type:"same",text:s[i]}),i+=1,u+=1):l[i+1][u]>=l[i][u+1]?(c.push({type:"remove",text:s[i]}),i+=1):(c.push({type:"add",text:r[u]}),u+=1);for(;i<a;)c.push({type:"remove",text:s[i]}),i+=1;for(;u<o;)c.push({type:"add",text:r[u]}),u+=1;return c},cv=e=>e==="STEP2"?2:e==="PREVIEW"?3:1,dv=e=>{switch(e){case"STEP1":return"Setup";case"STEP2":return"Draft";case"PREVIEW":return"Preview";case"CASE_FOLDER":return"Case Folder";default:return"Dashboard"}},uv=e=>e?e.role:"Guest",mv=e=>e===1?[{intent:"explain_current_screen",label:"   ?"},{intent:"explain_buttons_in_step",label:"    "},{intent:"common_mistakes_here",label:"   1"}]:e===2?[{intent:"explain_current_screen",label:"    2"},{intent:"when_to_use_ai_tools",label:"   -AI "},{intent:"explain_hebrew_rewrite",label:"    "},{intent:"explain_tone_risk",label:"  Tone & Risk"},{intent:"common_mistakes_here",label:"   2"}]:[{intent:"pre_send_checks",label:"    "},{intent:"explain_tone_risk",label:"   Tone & Risk?"},{intent:"common_mistakes_here",label:"   "}],pv=({isOpen:e,onClose:t,view:s,currentUser:r,currentReport:a,loading:o,error:l,response:c,onRunIntent:i})=>{if(!e)return null;const u=cv(s),p=dv(s),y=uv(r),b=mv(u),w=!!a;return n.jsxs(n.Fragment,{children:[n.jsx("div",{className:"fixed inset-0 bg-black/10 z-[180]",onClick:t}),n.jsxs("div",{className:"fixed inset-y-0 right-0 z-[190] w-full max-w-md bg-panel border-l border-borderDark200 shadow-2xl flex flex-col",children:[n.jsxs("div",{className:"px-4 py-3 border-b border-borderDark200 flex items-center justify-between bg-navySecondary",children:[n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsx("div",{className:"h-8 w-8 rounded-full bg-indigo-600 flex items-center justify-center text-white",children:n.jsx(oa,{className:"w-4 h-4"})}),n.jsxs("div",{className:"flex flex-col",children:[n.jsx("span",{className:"text-sm font-semibold text-textLight",children:" "}),n.jsxs("span",{className:"text-[11px] text-textMuted",children:["Step ",u,"  ",p,"  ",y]})]})]}),n.jsx("button",{type:"button",onClick:t,className:"p-1 rounded hover:bg-navySecondary text-textMuted",children:n.jsx(Ht,{className:"w-4 h-4"})})]}),n.jsxs("div",{className:"px-4 py-3 border-b border-borderDark bg-panel",children:[n.jsxs("div",{className:"flex items-center justify-between mb-2",children:[n.jsx("span",{className:"text-[11px] font-semibold text-textMuted600",children:"   "}),!w&&n.jsx("span",{className:"text-[10px] text-textMuted",children:'     ".'})]}),n.jsx("div",{className:"flex flex-wrap gap-2",children:b.map(R=>n.jsx("button",{type:"button",disabled:o||!w,onClick:()=>i(R.intent),className:`text-[11px] px-3 py-1.5 rounded-full border transition ${o||!w?"border-borderDark200 text-textMuted bg-navySecondary cursor-not-allowed":"border-indigo-200 text-indigo-800 bg-indigo-50 hover:bg-indigo-100"}`,children:R.label},R.intent))})]}),n.jsxs("div",{className:"flex-1 overflow-auto px-4 py-3 space-y-3",dir:"rtl",children:[o&&n.jsxs("div",{className:"flex items-center gap-2 text-[12px] text-textMuted600",children:[n.jsx(Bt,{className:"w-4 h-4 animate-spin"}),n.jsx("span",{children:"      "})]}),!o&&l&&n.jsxs("div",{className:"rounded-md border border-red-200 bg-red-50 px-3 py-2 text-[12px] text-red-800",children:[n.jsx("div",{className:"font-semibold mb-1",children:"    "}),n.jsx("div",{children:"      .   ,   ."})]}),!o&&!l&&c&&n.jsxs("div",{className:"space-y-2",children:[n.jsx("div",{className:"text-sm font-semibold text-textLight",children:c.title}),n.jsx("ul",{className:"list-disc pr-4 space-y-1 text-[12px] text-textLight",children:c.bullets.map((R,E)=>n.jsx("li",{children:R},E))}),c.warning&&n.jsxs("div",{className:"mt-2 rounded-md border border-amber-200 bg-amber-50 px-3 py-2 text-[11px] text-amber-900",children:[n.jsx("span",{className:"font-semibold",children:" : "}),c.warning]}),c.nextSuggestion&&n.jsxs("div",{className:"mt-1 text-[11px] text-textMuted600",children:[n.jsx("span",{className:"font-semibold",children:" : "}),c.nextSuggestion]})]}),!o&&!l&&!c&&n.jsxs("div",{className:"text-[12px] text-textMuted space-y-1",children:[n.jsx("div",{children:'         ,    " .'}),n.jsx("div",{children:"         ."})]})]}),n.jsxs("div",{className:"px-4 py-3 border-t border-borderDark bg-navySecondary",children:[n.jsx("div",{className:"text-[10px] text-textMuted mb-1",children:"   '        ."}),n.jsx("input",{type:"text",disabled:!0,className:"w-full text-[11px] px-2 py-1.5 rounded border border-dashed border-borderDark200 bg-navySecondary text-textMuted",placeholder:"          ."})]})]})]})},Lp=24*60*60*1e3;function yt(e,t,s=new Date){const r={isLocked:!1,lockType:"NONE",lockAt:null,autoLockAt:null,remainingDays:null,reasonSummary:null},a=s.getTime();if(t!=null&&t.closedAt){const o=t.closedAt;return{...r,isLocked:!0,lockType:"MANUAL",lockAt:o,autoLockAt:null,remainingDays:null,reasonSummary:"      ."}}if(e.manualLockedAt)return{...r,isLocked:!0,lockType:"MANUAL",lockAt:e.manualLockedAt,autoLockAt:null,remainingDays:null,reasonSummary:e.manualLockReason?` : ${e.manualLockReason}`:"   ."};if(e.firstSentAt){const l=new Date(e.firstSentAt).getTime();if(!Number.isFinite(l))return r;const i=35+((e.lockExtensions||[]).reduce((E,W)=>{const N=typeof W.days=="number"&&!Number.isNaN(W.days)?W.days:0;return E+N},0)||0),u=l+i*Lp,p=new Date(u),y=p.toISOString();if(a>=u)return{...r,isLocked:!0,lockType:"AUTO",lockAt:y,autoLockAt:y,remainingDays:null,reasonSummary:"    35    ."};const w=(u-a)/Lp,R=w>0?Math.ceil(w):0;return{...r,isLocked:!1,lockType:"NONE",lockAt:null,autoLockAt:y,remainingDays:R,reasonSummary:`    -${R}  (-${p.toLocaleDateString("he-IL")}).`}}return r}const _p=new Map,fv=60*1e3;function pl(e){const t=`${e.reason}::${e.reportId??"unknown"}`,s=Date.now(),r=_p.get(t)??0;s-r<fv||(_p.set(t,s),console.info("[blocked-edit]",e))}const xv="personal_snippets",$h=e=>`${xv}:${e}`,hv=(e,t)=>{if(!e)return[];try{const s=JSON.parse(e);if(!Array.isArray(s))return[];const r=new Date().toISOString();return s.map((a,o)=>{const l=a||{},c=typeof l.id=="string"&&l.id?l.id:`ps-${Date.now()}-${o}-${Math.random().toString(36).slice(2,6)}`,i=typeof l.title=="string"&&l.title.trim()?l.title:"Untitled snippet",u=typeof l.body=="string"?l.body:"",p=typeof l.createdAt=="string"&&l.createdAt?l.createdAt:r,y=typeof l.updatedAt=="string"&&l.updatedAt?l.updatedAt:p,b=typeof l.createdByUserId=="string"&&l.createdByUserId?l.createdByUserId:t,w=typeof l.usageCount=="number"&&Number.isFinite(l.usageCount)&&l.usageCount>=0?l.usageCount:0,R=typeof l.lastUsedAt=="string"&&l.lastUsedAt.trim()?l.lastUsedAt:null,E=typeof l.sectionKey=="string"&&l.sectionKey?l.sectionKey:void 0,W=Array.isArray(l.tags)?l.tags.filter(h=>typeof h=="string"&&h.trim()).map(h=>h.trim()):void 0;return{id:c,title:i,body:u,sectionKey:E,tags:W,createdByUserId:b,createdAt:p,updatedAt:y,usageCount:w,lastUsedAt:R}})}catch{return[]}},Eo=e=>{if(typeof window>"u")return[];if(!e)return[];const t=window.localStorage.getItem($h(e));return hv(t,e)},Gu=(e,t)=>{if(!(typeof window>"u")&&e)try{window.localStorage.setItem($h(e),JSON.stringify(t))}catch{}},gv=(e,t)=>{const s=new Date().toISOString(),r=Eo(e);let a;if(t.id)a=r.map(o=>o.id===t.id?{...o,title:t.title,body:t.body,sectionKey:t.sectionKey,tags:t.tags,updatedAt:s}:o);else{const l={id:`ps-${Date.now()}-${Math.random().toString(36).slice(2,8)}`,title:t.title,body:t.body,sectionKey:t.sectionKey,tags:t.tags,createdByUserId:e,createdAt:s,updatedAt:s,usageCount:0,lastUsedAt:null};a=[...r,l]}return Gu(e,a),a},Op=(e,t)=>{const r=Eo(e).filter(a=>a.id!==t);return Gu(e,r),r},yv=(e,t)=>{const s=Eo(e),r=new Date().toISOString(),a=s.map(o=>o.id===t?{...o,usageCount:(o.usageCount||0)+1,lastUsedAt:r}:o);return Gu(e,a),a},Mp="           (OCR). /     /  .",Cr="     .       .",Nv={title:"Final Preview",toggleHide:"Hide Preview",toggleShow:"Show Preview",downloadPdf:"Download PDF",editFileNames:"Edit file name titles",finalize:"Finalize & Close",backToEditing:"Back to Editing",backToStep2:"Back to Step 2",backToDashboard:"Back to dashboard",helperScroll:"Scroll to review entire document",collapsedHint:'Click "Show Preview" to review the document before sending.'},bv={title:" ",toggleHide:" ",toggleShow:" ",downloadPdf:" PDF",editFileNames:"  ",finalize:" ",backToEditing:" ",backToStep2:"  2",backToDashboard:"  ",helperScroll:"    ",collapsedHint:'  " "     .'},vv=e=>e==="LAWYER"?bv:Nv,Pp={SOC:["   ___________     ____________ ____________   ,   ____________________.","","        ____________________.","","      ,       ________________________."].join(`
`),LOD:["   ___________      .","","        ____________________.","",",    Claimant    ,      ______________________."].join(`
`)},Sv=({message:e,type:t,onClose:s})=>{const r="fixed top-4 right-4 z-[100] p-4 rounded-lg shadow-xl border-l-4 flex items-center gap-3 animate-slide-in bg-panel border-borderDark text-textLight",a=t==="success"?"border-l-gold text-goldLight":t==="error"?"border-l-danger text-red-300":t==="warning"?"border-l-gold text-goldLight":"border-l-gold text-textLight";return n.jsxs("div",{className:`${r} ${a}`,children:[n.jsx("span",{children:e}),n.jsx("button",{onClick:s,className:"hover:bg-navySecondary p-1 rounded text-textMuted",children:n.jsx(Ht,{className:"w-4 h-4"})})]})},wv=({onSubmit:e,onCancel:t,initialTitle:s})=>{const[r,a]=g.useState(s||""),[o,l]=g.useState("BEST_PRACTICE"),[c,i]=g.useState(""),[u,p]=g.useState("INSERTABLE"),y=b=>{b.preventDefault();const w=r.trim();if(!w)return;const R=c.split(",").map(E=>E.trim()).filter(Boolean);e({title:w,label:o,tags:R,behavior:u})};return n.jsxs("form",{onSubmit:y,className:"px-4 py-3 space-y-3 text-xs",children:[n.jsxs("div",{className:"space-y-1",children:[n.jsx("label",{className:"block font-semibold text-textLight",children:"Title"}),n.jsx("input",{type:"text",className:"w-full border border-borderDark rounded px-2 py-1 text-xs",value:r,onChange:b=>a(b.target.value),required:!0})]}),n.jsxs("div",{className:"space-y-1",children:[n.jsx("label",{className:"block font-semibold text-textLight",children:"Label / Type"}),n.jsxs("select",{className:"w-full border border-borderDark rounded px-2 py-1 text-xs",value:o,onChange:b=>l(b.target.value==="LLOYDS_RECOMMENDED"?"LLOYDS_RECOMMENDED":"BEST_PRACTICE"),children:[n.jsx("option",{value:"BEST_PRACTICE",children:"Best practice"}),n.jsx("option",{value:"LLOYDS_RECOMMENDED",children:"Lloyds recommended"})]})]}),n.jsxs("div",{className:"space-y-1",children:[n.jsx("label",{className:"block font-semibold text-textLight",children:"Tags (optional)"}),n.jsx("input",{type:"text",className:"w-full border border-borderDark rounded px-2 py-1 text-xs",placeholder:"e.g. lloyds, settlement, high exposure",value:c,onChange:b=>i(b.target.value)})]}),n.jsxs("div",{className:"space-y-1",children:[n.jsx("label",{className:"block font-semibold text-textLight",children:"Behavior"}),n.jsxs("div",{className:"flex items-center gap-3",children:[n.jsxs("label",{className:"flex items-center gap-1",children:[n.jsx("input",{type:"radio",name:"bp-behavior",checked:u==="INSERTABLE",onChange:()=>p("INSERTABLE")}),n.jsx("span",{children:"Insertable (insert into body)"})]}),n.jsxs("label",{className:"flex items-center gap-1",children:[n.jsx("input",{type:"radio",name:"bp-behavior",checked:u==="COPY_ONLY",onChange:()=>p("COPY_ONLY")}),n.jsx("span",{children:"Copy only"})]})]})]}),n.jsxs("div",{className:"flex items-center justify-end gap-2 pt-2 border-t border-borderDark mt-2",children:[n.jsx("button",{type:"button",onClick:t,className:"px-3 py-1.5 rounded border border-borderDark text-[11px] text-textLight hover:bg-slate-100",children:""}),n.jsx("button",{type:"submit",className:"px-3 py-1.5 rounded bg-emerald-600 text-white text-[11px] hover:bg-emerald-700",children:" Best Practice"})]})]})},Fp=({value:e,onChange:t,placeholder:s,disabled:r,readOnly:a,dir:o="ltr",className:l,style:c={},textareaRef:i})=>{const u=g.useRef(null),p=i||u;return g.useEffect(()=>{const y=p&&"current"in p?p.current:u.current;y&&(y.style.height="auto",y.style.height=y.scrollHeight+"px")},[e,p]),n.jsx(go,{clientId:So,children:n.jsx("textarea",{ref:p,className:l,dir:o,value:e,onChange:a?void 0:t,placeholder:s,disabled:r||a,rows:3,style:{...c,overflow:"hidden",resize:"none"}})})},jv=({onClose:e})=>{const[t,s]=g.useState("MANUAL"),[r,a]=g.useState(""),[o,l]=g.useState([]),[c,i]=g.useState(!1),u=async()=>{if(!r.trim())return;i(!0);const p=await eN(r);l(y=>[...y,{q:r,a:p}]),a(""),i(!1)};return n.jsx("div",{className:"fixed inset-0 bg-black/50 z-[200] flex items-center justify-center p-4",children:n.jsxs("div",{className:"bg-panel w-full max-w-3xl h-[600px] rounded-xl shadow-2xl flex flex-col overflow-hidden animate-scale-in",children:[n.jsxs("div",{className:"bg-navy p-4 text-gold flex justify-between items-center",children:[n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsx(Du,{className:"w-6 h-6"}),n.jsx("h2",{className:"font-bold text-lg",children:"  "})]}),n.jsx("button",{onClick:e,className:"hover:bg-panel/20 rounded p-1",children:n.jsx(Ht,{className:"w-5 h-5"})})]}),n.jsxs("div",{className:"flex border-b",children:[n.jsx("button",{onClick:()=>s("MANUAL"),className:`flex-1 p-3 font-bold ${t==="MANUAL"?"text-lpBlue border-b-2 border-lpBlue":"text-textMuted"}`,children:" "}),n.jsx("button",{onClick:()=>s("CHAT"),className:`flex-1 p-3 font-bold ${t==="CHAT"?"text-lpBlue border-b-2 border-lpBlue":"text-textMuted"}`,children:"   "})]}),n.jsx("div",{className:"flex-1 overflow-auto p-6 bg-navySecondary",dir:"rtl",children:t==="MANUAL"?n.jsxs("div",{className:"space-y-4",children:[n.jsxs("details",{className:"bg-panel p-4 rounded shadow-sm group",children:[n.jsxs("summary",{className:"font-bold text-textLight cursor-pointer list-none flex justify-between",children:["   ",n.jsx(is,{className:"group-open:rotate-90 transition"})]}),n.jsxs("div",{className:"mt-2 text-textMuted text-sm space-y-1",children:[n.jsx("p",{children:"1.       (CRM / Finance /    )."}),n.jsx("p",{children:"2.       +  Notifications   ."}),n.jsx("p",{children:`3.  ""     ' .`})]})]}),n.jsxs("details",{className:"bg-panel p-4 rounded shadow-sm group",children:[n.jsxs("summary",{className:"font-bold text-textLight cursor-pointer list-none flex justify-between",children:['    " ',n.jsx(is,{className:"group-open:rotate-90 transition"})]}),n.jsxs("div",{className:"mt-2 text-textMuted text-sm space-y-1",children:[n.jsxs("p",{children:["1.   ",n.jsx("strong",{children:"Open New Case Folder"}),",      ."]}),n.jsx("p",{children:"2.  ,   4  (Word/PDF)    ."}),n.jsx("p",{children:"3.   FINANCE FINALIZE     ."})]})]}),n.jsxs("details",{className:"bg-panel p-4 rounded shadow-sm group",children:[n.jsxs("summary",{className:"font-bold text-textLight cursor-pointer list-none flex justify-between",children:["   ",n.jsx(is,{className:"group-open:rotate-90 transition"})]}),n.jsxs("div",{className:"mt-2 text-textMuted text-sm space-y-1",children:[n.jsx("p",{children:'   View Worksheet  , ,   " .'}),n.jsx("p",{children:" /     ( ADD),    ."}),n.jsx("p",{children:'  ,      "     Expenses.'})]})]}),n.jsxs("details",{className:"bg-panel p-4 rounded shadow-sm group",children:[n.jsxs("summary",{className:"font-bold text-textLight cursor-pointer list-none flex justify-between",children:["    ",n.jsx(is,{className:"group-open:rotate-90 transition"})]}),n.jsxs("div",{className:"mt-2 text-textMuted text-sm space-y-1",children:[n.jsx("p",{children:"  Manage Favorite Providers     ."}),n.jsx("p",{children:"        ."}),n.jsx("p",{children:'    4   (PDF/Word)  "    .'})]})]}),n.jsxs("details",{className:"bg-panel p-4 rounded shadow-sm group",children:[n.jsxs("summary",{className:"font-bold text-textLight cursor-pointer list-none flex justify-between",children:[' "     ',n.jsx(is,{className:"group-open:rotate-90 transition"})]}),n.jsxs("div",{className:"mt-2 text-textMuted text-sm space-y-1",children:[n.jsx("p",{children:"       -FINANCE   FINALIZE."}),n.jsx("p",{children:' FINALIZE  "     (READY TO SEND)   .'}),n.jsx("p",{children:"     (48   , 30   )     ."})]})]})]}):n.jsxs("div",{className:"flex flex-col h-full",children:[n.jsxs("div",{className:"flex-1 space-y-4 mb-4 overflow-auto",children:[o.length===0&&n.jsx("div",{className:"text-center text-gray-400 mt-10",children:"     !"}),o.map((p,y)=>n.jsxs("div",{className:"space-y-1",children:[n.jsx("div",{className:"bg-blue-100 text-blue-900 p-2 rounded-lg rounded-tr-none self-end w-fit ml-auto max-w-[80%]",children:p.q}),n.jsx("div",{className:"bg-panel border text-textLight p-2 rounded-lg rounded-tl-none self-start w-fit mr-auto max-w-[80%]",children:p.a})]},y))]}),n.jsxs("div",{className:"flex gap-2",dir:"ltr",children:[n.jsx("input",{className:"flex-1 border p-2 rounded",placeholder:"/   ...",value:r,onChange:p=>a(p.target.value),onKeyDown:p=>p.key==="Enter"&&u()}),n.jsx("button",{onClick:u,disabled:c,className:"bg-navy text-gold px-4 rounded hover:bg-navySecondary",children:c?n.jsx(Bt,{className:"w-5 h-5 animate-spin"}):n.jsx(Zl,{className:"w-5 h-5"})})]})]})})]})})},Ev=({reports:e,currentUser:t,onMarkPaid:s})=>{const r=e.filter(l=>l.expensesSum&&!l.isPaid),a=r.reduce((l,c)=>{var u;const i=parseFloat(((u=c.expensesSum)==null?void 0:u.replace(/,/g,""))||"0");return l+(isNaN(i)?0:i)},0),o=t.role==="SUB_ADMIN";return r.length?n.jsxs("div",{className:"mb-8 bg-panel rounded-xl shadow-sm border border-indigo-100 overflow-hidden",children:[n.jsxs("div",{className:"bg-gradient-to-r from-indigo-600 to-indigo-800 p-4 text-white flex justify-between items-center",children:[n.jsxs("h3",{className:"font-bold text-lg flex items-center",children:[n.jsx(I0,{className:"w-6 h-6 mr-2"})," Financial Control - Outstanding Expenses"]}),n.jsxs("div",{className:"text-xl font-bold bg-panel/20 px-4 py-1 rounded",children:["Total: ",a.toLocaleString()]})]}),n.jsx("div",{className:"overflow-x-auto",children:n.jsxs("table",{className:"w-full text-left text-sm",children:[n.jsx("thead",{className:"bg-indigo-50 text-indigo-800",children:n.jsxs("tr",{children:[n.jsx("th",{className:"p-3",children:"Report Date"}),n.jsx("th",{className:"p-3",children:"Insured / File"}),n.jsx("th",{className:"p-3",children:"Amount Requested"}),n.jsx("th",{className:"p-3",children:"Action"})]})}),n.jsx("tbody",{className:"divide-y divide-gray-100",children:r.map(l=>n.jsxs("tr",{className:"hover:bg-navySecondary",children:[n.jsx("td",{className:"p-3",children:new Date(l.reportDate).toLocaleDateString()}),n.jsxs("td",{className:"p-3 font-medium",children:[l.insuredName," (",l.marketRef,")"]}),n.jsxs("td",{className:"p-3 font-bold text-indigo-700",children:["",l.expensesSum]}),n.jsx("td",{className:"p-3",children:o?n.jsx("button",{onClick:()=>s(l.id),className:"text-red-400 hover:text-red-600 hover:bg-red-50 p-1.5 rounded transition",title:"Mark as Paid",children:n.jsx($s,{className:"w-4 h-4"})}):n.jsx("span",{className:"text-gray-400 cursor-not-allowed",children:n.jsx($s,{className:"w-4 h-4"})})})]},l.id))})]})})]}):null};new URL("/assets/statement%20of%20claim-BbEIHM0L.jpg",import.meta.url).href,new URL("/assets/statement%20of%20defence-BIigMwUC.jpg",import.meta.url).href,new URL("/assets/preliminary%20proceedings-BoY9iCcP.jpg",import.meta.url).href,new URL("/assets/evidence%20submission-CZIKo1E1.jpg",import.meta.url).href,new URL("/assets/evidentiary%20hearing-BibkA_Ru.jpg",import.meta.url).href,new URL("/assets/summaries-BEUvavav.jpg",import.meta.url).href,new URL("/assets/judgment-cIMuyU1R.jpg",import.meta.url).href;const kv=[{value:"LETTER_OF_DEMAND",label:"Letter of Demand"},{value:"FIRST_INSTANCE",label:"First Instance Proceedings"},{value:"APPEAL",label:"Appeal Proceedings"}],Oa={LETTER_OF_DEMAND:[{id:"LOD_ISSUED",label:"Letter of Demand Issued"},{id:"LOD_INTERNAL_REVIEW",label:"Internal Review & Coverage Assessment"},{id:"LOD_RESPONSE",label:"Response to Letter of Demand"},{id:"LOD_PRE_LITIGATION",label:"Pre-Litigation Negotiations"},{id:"LOD_OUTCOME_ESCALATION",label:"Outcome / Escalation Decision"},{id:"LOD_CLAIM_SETTLED",label:"Claim Settled"},{id:"LOD_DEMAND_REJECTED",label:"Demand Rejected"}],FIRST_INSTANCE:[{id:"FI_STATEMENT_OF_CLAIM",label:"Statement of Claim Filed"},{id:"FI_STATEMENT_OF_DEFENCE",label:"Statement of Defence Filed"},{id:"FI_DISCOVERY_DISCLOSURE",label:"Discovery & Disclosure"},{id:"FI_COURT_APPOINTED_EXPERT",label:"Court-Appointed Expert",isDynamic:!0},{id:"FI_RD_DOCS_DAMAGE_SUBMISSIONS",label:"R & D Docs  Damage Assessment Submissions",isDynamic:!0},{id:"FI_EVIDENTIARY_HEARINGS",label:"Evidentiary Hearings"},{id:"FI_SUMMATIONS",label:"Summations"},{id:"FI_JUDGMENT",label:"Judgment"}],APPEAL:[{id:"AP_DECISION_TO_APPEAL",label:"Decision to Appeal"},{id:"AP_NOTICE_OF_APPEAL",label:"Notice of Appeal Filed"},{id:"AP_RESPONSE_TO_APPEAL",label:"Response to Appeal"},{id:"AP_APPEAL_HEARINGS",label:"Appeal Hearings"},{id:"AP_APPEAL_JUDGMENT",label:"Appeal Judgment"}]},ds=[{value:"EXPERT_OUR",label:"Expert fees on our behalf",type:"EXPENSE"},{value:"EXPERT_COURT",label:"Expert fees on behalf of the court",type:"EXPENSE"},{value:"INVESTIGATION",label:"Private Investigation fees",type:"EXPENSE"},{value:"SECONDARY_FEE",label:"Payment of secondary procedure fee",type:"EXPENSE"},{value:"COURT_FEES",label:"Court fees",type:"EXPENSE"},{value:"PHOTOCOPY",label:"Photocopying and binding of documents",type:"EXPENSE"},{value:"MEDICAL_RECORDS",label:"Medical Records Collection",type:"EXPENSE"},{value:"ATTORNEY_PHASE_1",label:"Attorney fees for phase 1",type:"EXPENSE"},{value:"ATTORNEY_PHASE_2",label:"Attorney fees for phase 2",type:"EXPENSE"},{value:"ATTORNEY_PHASE_3",label:"Attorney fees for phase 3",type:"EXPENSE"},{value:"ATTORNEY_PHASE_4",label:"Attorney fees for phase 4",type:"EXPENSE"},{value:"ATTORNEY_PHASE_5",label:"Attorney fees for phase 5",type:"EXPENSE"},{value:"ATTORNEY_EXTRA_HEARING",label:"Attorney fees for extra court hearing",type:"EXPENSE"},{value:"ATTORNEY_THIRD_PARTY",label:"Attorney fees for third party notice",type:"EXPENSE"},{value:"OTHER",label:"Other",type:"EXPENSE"},{value:"COMPENSATION_JUDGMENT",label:"Compensation by Judgment",type:"ADJUSTMENT"},{value:"COMPENSATION_SETTLEMENT",label:"Compensation under Settlement",type:"ADJUSTMENT"},{value:"DEDUCTIBLE",label:"Deductible paid by the insured",type:"ADJUSTMENT"},{value:"PAID_BY_INSURER",label:"Expenses already paid by the insurer",type:"ADJUSTMENT"}],Ps=()=>({status:"DRAFT",rows:[],history:[],notes:[],favorites:[],totals:{totalExpenses:0,totalAdjustments:0,totalBalance:0}}),Av=1e3*60*60*48,Hh=1e3*60*60*24*30,Uh=7*24*60*60*1e3,Bp={lineSlip:"UNIQUE MARKET REF",certificate:"CERTIFICATE REF"},ft={REPORTS:"lp_reports",USER:"lp_current_user",VIEW:"lp_view",CURRENT_REPORT:"lp_current_report",CASE_FOLDERS:"lp_case_folders",NOTIFICATIONS:"lp_notifications"},Iv="financial_expenses_store_v1",Tv=(e,t,s)=>{if(!(typeof window>"u"))try{const r=[...e];if(t){const i=r.findIndex(p=>p.id===t.id),u=i>=0?{...r[i],...t}:t;i>=0?r[i]=u:r.push(u)}const a={version:1,exportedAt:new Date().toISOString(),reports:r,caseFolders:s,notifications:(()=>{try{const i=localStorage.getItem(ft.NOTIFICATIONS);return i?JSON.parse(i):[]}catch{return[]}})(),financialStore:(()=>{try{const i=localStorage.getItem(Iv);return i?JSON.parse(i):{}}catch{return{}}})(),caseTemplates:(()=>{try{const i=localStorage.getItem("caseTemplates");return i?JSON.parse(i):[]}catch{return[]}})(),favoriteProviders:(()=>{try{const i=localStorage.getItem("favoriteProviders");return i?JSON.parse(i):{}}catch{return{}}})()},o=new Blob([JSON.stringify(a,null,2)],{type:"application/json"}),l=URL.createObjectURL(o),c=document.createElement("a");c.href=l,c.download=`report-crm-backup-${new Date().toISOString().slice(0,10)}.json`,c.click(),URL.revokeObjectURL(l)}catch(r){console.error("Backup download failed",r)}},Ja="Expenses breakdown",Qr=e=>e?e===Ja?!0:/\bexpenses\b/i.test(e):!1,Rv=()=>{},$p=(e,t,s)=>{if(!e)return e;let r=!1;const a={...e};if(a.content&&t.forEach(o=>{var c;const l=(c=a.content)==null?void 0:c[o];l!==void 0&&(a.content={...a.content},!a.content[s]&&l&&(a.content[s]=l),delete a.content[o],r=!0)}),a.translatedContent&&t.forEach(o=>{var c;const l=(c=a.translatedContent)==null?void 0:c[o];l!==void 0&&(a.translatedContent={...a.translatedContent},!a.translatedContent[s]&&l&&(a.translatedContent[s]=l),delete a.translatedContent[o],r=!0)}),Array.isArray(a.selectedSections)&&a.selectedSections.some(l=>t.includes(l))){const l=a.selectedSections.map(c=>t.includes(c)?s:c);a.selectedSections=Array.from(new Set(l)),r=!0}return a.expertSummaryMode&&t.forEach(o=>{var c;const l=(c=a.expertSummaryMode)==null?void 0:c[o];l&&(a.expertSummaryMode={...a.expertSummaryMode,[s]:l},delete a.expertSummaryMode[o],r=!0)}),r?a:e},Cv=e=>{let t=$p(e,mh,Ws);return t=$p(t,ph,Co),t},Dv=e=>{const t={...e};return t.reportReview||(t.reportReview={status:"DRAFT",issues:[]}),t.hebrewWorkflowStatus||(t.hebrewWorkflowStatus="HEBREW_DRAFT"),Array.isArray(t.reportReview.issues)&&t.reportReview.issues.length>0&&(t.reportReview={...t.reportReview,issues:t.reportReview.issues.map(s=>{const r=s.origin??"INTERNAL";let a=s.externalAction;return r==="EXTERNAL"&&!a&&(a="ENGLISH_ONLY"),{...s,origin:r,externalAction:a}})}),t},Lv=()=>{if(typeof window>"u")return[];try{Rv();const e=localStorage.getItem(ft.REPORTS);return(e?JSON.parse(e):[]).map(Cv).map(Dv)}catch(e){return console.error("Failed to load stored reports",e),[]}},_v=()=>{if(typeof window>"u")return"DASHBOARD";const e=localStorage.getItem(ft.VIEW);return e&&(e==="STEP1"||e==="STEP2"||e==="PREVIEW"||e==="DASHBOARD"||e==="CASE_FOLDER")?e:"DASHBOARD"},oi=e=>{const t=e.filter(r=>r.type==="EXPENSE").reduce((r,a)=>r+(a.amount||0),0),s=e.filter(r=>r.type==="ADJUSTMENT").reduce((r,a)=>r+(a.amount||0),0);return{totalExpenses:t,totalAdjustments:s,totalBalance:t-s}},Hp=e=>{var t,s;if((t=e.expenseWorksheet)!=null&&t.totals)return e.expenseWorksheet.totals.totalBalance;if(e.expensesSum){const r=parseFloat(e.expensesSum.replace(/,/g,""));if(!isNaN(r))return r}return(s=e.expensesItems)!=null&&s.length?e.expensesItems.reduce((r,a)=>r+(a.amount||0),0):0},Up=e=>{var t,s,r;return(((s=(t=e.expenseWorksheet)==null?void 0:t.rows)==null?void 0:s.length)??0)>0||(((r=e.expensesItems)==null?void 0:r.length)??0)>0||!!(e.expensesSum&&e.expensesSum!=="0")},Ln=()=>Math.random().toString(36).slice(2,10),Dr=e=>e==null?e:JSON.parse(JSON.stringify(e)),Wp=e=>new Promise((t,s)=>{const r=new FileReader;r.onloadend=()=>{const a=r.result,o=a.includes(",")?a.split(",")[1]:a;t(o)},r.onerror=()=>s(new Error("Failed to convert blob")),r.readAsDataURL(e)}),li=e=>e?e.replace(/\r\n/g,`
`).replace(/\t/g," ").split(`
`).map(r=>r.replace(/\s+$/g,"").replace(/ {2,}/g," ")).join(`
`).trim().replace(/\n{3,}/g,`

`):"",Wh=e=>{if(!e)return e;let t=e;const s=[{pattern:/\bprosecutor\b/gi,replacement:"plaintiff"},{pattern:/\ba specialist\b/gi,replacement:"an expert"},{pattern:/\bthe specialist\b/gi,replacement:"the expert"},{pattern:/\bProf\.(?=\s|$)/gi,replacement:"prof"},{pattern:/\bNational Insurance Institute\b/gi,replacement:"NII"},{pattern:/\boperation\b/gi,replacement:"surgery"},{pattern:/\bdamage calculations\b/gi,replacement:"R & D Docs"},{pattern:/\bdemander\b/gi,replacement:"claimant"},{pattern:/\bapplicant\b/gi,replacement:"claimant"},{pattern:/\bbranch\b/gi,replacement:"clinic"},{pattern:/\bverdict\b/gi,replacement:"judgment"},{pattern:/\binterrogation\b/gi,replacement:"cross-examination"},{pattern:/\bDr\.(?=\s|$)/gi,replacement:"Dr"},{pattern:/\bversion\b/gi,replacement:"position"},{pattern:/\bpolicyholder\b/gi,replacement:"insured"}];for(const{pattern:r,replacement:a}of s)t=t.replace(r,a);return t=t.replace(/\bopinion\b/gi,(r,a,o)=>{const l=Math.max(0,a-20),c=o.slice(l,a).toLowerCase();return/\bexpert\s*$/.test(c)?r:"expert opinion"}),t},Pc=e=>{const t=e||{};return Object.keys(t).reduce((s,r)=>(s[r]=li(t[r]),s),{})},Ov=e=>e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),zh=e=>{if(!e)return{protectedText:e,map:{}};let t=e;const s={};let r=0;const a=(l,c)=>{t=t.replace(l,i=>{const u=`${c}_${++r}`;return s[u]||(s[u]=i),u})};a(/(?:|\$||)\s*\d[\d,]*(?:\.\d+)?/g,"MONEY"),a(/\b(?:USD|NIS|ILS|EUR|GBP)\s*\d[\d,]*(?:\.\d+)?\b/gi,"MONEY"),a(/\d[\d,]*(?:\.\d+)?\s*(?:NIS|ILS|USD|EUR|GBP)\b/gi,"MONEY"),a(/\d[\d,]*(?:\.\d+)?%/g,"PCT"),a(/\b\d{1,2}[\/\.]\d{1,2}[\/\.]\d{4}\b/g,"DATE");const o="(January|February|March|April|May|June|July|August|September|October|November|December|Jan|Feb|Mar|Apr|Jun|Jul|Aug|Sep|Oct|Nov|Dec)";return a(new RegExp(`\\b\\d{1,2}\\s+${o}\\s+\\d{4}\\b`,"g"),"DATE"),a(new RegExp(`\\b${o}\\s+\\d{1,2},\\s+\\d{4}\\b`,"g"),"DATE"),a(/\b(?:Policy\s+No\.?|Claim\s+#?|File|Case)\s+[A-Za-z0-9\/\-]+\b/gi,"ID"),a(/\b[A-Za-z0-9]{3,}[A-Za-z0-9\-\/]{3,}\b/g,"ID"),a(/\b\d{1,3}(?:,\d{3})*(?:\.\d+)?\b/g,"NUM"),{protectedText:t,map:s}},Vh=(e,t)=>{if(!e||!t||!Object.keys(t).length)return e;let s=e;for(const[r,a]of Object.entries(t)){const o=new RegExp(Ov(r),"g");s=s.replace(o,a)}return s},Mv=`
               . ,   ,          .

          , ,  ,            .

      -  ,     .

   ,     ,                .

      .
`.trim(),Pv=["The policy period is from [policyStartDate] to [policyEndDate].","","The retroactive date is [retroactiveDate].","","    _______________, ,   .","","      ,     ____________  ____________.","",",         ."].join(`
`),Kh=(e,t,s,r,a)=>{const o=Pv,l=P=>`${P}`,c=t||"",i=s||"",u=r||a||"",p=l(`The policy period is from ${c} to ${i}.`),y=l(`The retroactive date is ${u}.`),b=["    _______________, ,   .","","      ,     ____________  ____________.","",",         ."].join(`
`),w=P=>P.replace(/\[policyStartDate\]/gi,c).replace(/\[policyEndDate\]/gi,i).replace(/\[retroactiveDate\]/gi,u),R=`${p}

${y}

${b}`,E=o?w(o):"";if(!E&&!e)return R;let N=e&&e.trim().length?e:E||R;(/\[policyStartDate\]/i.test(N)||/\[policyEndDate\]/i.test(N)||/\[retroactiveDate\]/i.test(N))&&(N=w(N));const h=/The policy period is[^\n]*/i;h.test(N)?N=N.replace(h,p):(!e||!e.trim())&&(N=`${p}

${N}`);const S=/The retroactive date is[^\n]*/i;return S.test(N)?N=N.replace(S,y):(!e||!e.trim())&&(N=N.includes(p)?N.replace(p,`${p}

${y}`):`${y}

${N}`),N.includes("   ")||(N=`${N.trim()}

${b}`),N},Pd=(e,t)=>e.map(s=>{var l;const r=ds.find(c=>c.value===s.category),a=(r==null?void 0:r.type)||"EXPENSE",o=s.category==="OTHER"?((l=s.customLabel)==null?void 0:l.trim())||"Other expense":(r==null?void 0:r.label)||"Expense";return{id:s.id||Ln(),type:a,category:s.category,label:o,serviceProvider:a==="EXPENSE"?s.serviceProvider:void 0,amount:Number(s.amount)||0,locked:!1,createdBy:t==null?void 0:t.id,createdAt:new Date().toISOString(),updatedBy:t==null?void 0:t.id,updatedAt:new Date().toISOString()}}),Fv=e=>e.filter(t=>t.type==="EXPENSE").map(t=>({id:t.id,date:new Date().toISOString().split("T")[0],description:`${t.label}${t.serviceProvider?` (${t.serviceProvider})`:""}`,amount:t.amount,currency:"NIS"})),zp=e=>/[\u0590-\u05FF]/.test(e||""),Bv=({data:e,updateData:t,onNext:s,currentUser:r,timelineGallery:a,onAddTimelineImages:o,onRemoveTimelineImage:l,onSaveAndExit:c,readOnly:i})=>{var Ye,it,q,se;const[u,p]=g.useState(""),[y,b]=g.useState(!1),w=e.insurerName===""||dp.includes(e.insurerName),[R,E]=g.useState(!w),[W,N]=g.useState(!1),[h,S]=g.useState(!1);g.useRef(null);const P=g.useRef(e.insuredName),U=g.useRef(e.plaintiffName);g.useEffect(()=>{P.current=e.insuredName},[e.insuredName]),g.useEffect(()=>{U.current=e.plaintiffName},[e.plaintiffName]);const[V,X]=g.useState(()=>({})),te=C=>C?new Date(C).toISOString().split("T")[0]:new Date().toISOString().split("T")[0],G=C=>C.trim().replace(/\s+/g," "),ae=C=>{const re=e,Q="plaintiffName"in C?C.plaintiffName??re.plaintiffName:re.plaintiffName,he="insuredName"in C?C.insuredName??re.insuredName:re.insuredName;if(!(!!Q&&!!he))return C;const je=G(Q),Te=G(he),et=`${je} v. ${Te}`,Ge="reportSubject"in C?C.reportSubject??re.reportSubject:re.reportSubject,He="isSubjectAuto"in C?C.isSubjectAuto??re.isSubjectAuto:re.isSubjectAuto;return!Ge||!Ge.trim()||He?{...C,reportSubject:et,isSubjectAuto:!0}:C},j=C=>{i||(C==="OTHER"?(E(!0),t(ae({insurerName:""}))):(E(!1),t(ae({insurerName:C}))))},F=()=>{if(!e.odakanitNo||!Se(e.odakanitNo)){alert("     (Odakanit)    .");return}s()},L=C=>{i||((e.expensesSheetId||e.expensesHtml)&&Qr(C)&&(C=Ja),e.selectedSections.includes(C)||t({selectedSections:[...e.selectedSections,C]}),b(!1))},O=C=>{if(i||C==="Update")return;if(!!(e.expensesSheetId||e.expensesHtml)&&Qr(C)){window.alert("           .");return}t({selectedSections:e.selectedSections.filter(Q=>Q!==C)})},H=()=>{i||u.trim()&&!e.selectedSections.includes(u)&&(t({selectedSections:[...e.selectedSections,u]}),p(""))},M=(C,re)=>{const Q=re==="UP"?C-1:C+1;if(Q<0||Q>=e.selectedSections.length)return;const he=[...e.selectedSections];[he[C],he[Q]]=[he[Q],he[C]],t({selectedSections:he})},I=()=>{const C=e.proceduralTimeline;return C&&C.procedureType?C:{procedureType:"FIRST_INSTANCE",currentStageId:"FI_STATEMENT_OF_CLAIM",stages:[]}},D=typeof e.selectedTimeline=="string"?e.selectedTimeline.trim().length>0:!!e.selectedTimelineImage;g.useEffect(()=>{if(e.proceduralTimeline||D)return;const C=I();t({proceduralTimeline:C})},[e.proceduralTimeline,D]),g.useEffect(()=>{const C=e.proceduralTimeline;if(!C)return;const re=Oa[C.procedureType];if(!re||!re.length)return;const Q=[];if(re.forEach(Fe=>{var et;const je=((et=C.stages)==null?void 0:et.find(Ge=>Ge.id===Fe.id))||void 0;(Fe.isDynamic?!!(je!=null&&je.include):(je==null?void 0:je.include)!==!1)&&Q.push(Fe.id)}),!Q.length||Q.includes(C.currentStageId))return;const he=Q[0];he&&he!==C.currentStageId&&t({proceduralTimeline:{...C,currentStageId:he}})},[e.proceduralTimeline,t]);const J=C=>{var je;const re=I(),he=(je=Oa[C][0])==null?void 0:je.id,Fe={...re,procedureType:C,currentStageId:he||re.currentStageId,stages:re.stages.filter(Te=>Oa[re.procedureType].some(et=>et.id===Te.id)).map(Te=>({...Te}))};t({proceduralTimeline:Fe}),X({})},ue=C=>{const Q={...I(),currentStageId:C};t({proceduralTimeline:Q})},ce=(C,re)=>{const Q=I(),he=Array.isArray(Q.stages)?[...Q.stages]:[],Fe=he.findIndex(et=>et.id===C);Fe>=0?he[Fe]={...he[Fe],include:re}:he.push({id:C,label:"",include:re,isDynamic:!0,monthYear:null});let je=Q.currentStageId;if(!re&&C===Q.currentStageId){const et=Oa[Q.procedureType];if(et&&et.length){const Ge=[];if(et.forEach(He=>{const Z=he.find(xe=>xe.id===He.id)||void 0;(He.isDynamic?!!(Z!=null&&Z.include):(Z==null?void 0:Z.include)!==!1)&&Ge.push(He.id)}),Ge.length){const He=et.findIndex(Ne=>Ne.id===C);let Z=null;if(He>0)for(let Ne=He-1;Ne>=0;Ne-=1){const xe=et[Ne].id;if(Ge.includes(xe)){Z=xe;break}}Z||(Z=Ge[0]),je=Z}}}const Te={...Q,currentStageId:je,stages:he};t({proceduralTimeline:Te})},le=(C,re,Q)=>{X(Ge=>{const He={...Ge};return!!!re&&!!!Q?delete He[C]:He[C]={month:re,year:Q},He});const he=I(),Fe=Array.isArray(he.stages)?[...he.stages]:[],je=Fe.findIndex(Ge=>Ge.id===C);let Te=null;if(re&&Q){const Ge=re.padStart(2,"0");Te=`${Q}-${Ge}`}je>=0?Fe[je]={...Fe[je],monthYear:Te}:Fe.push({id:C,label:"",include:!0,isDynamic:!1,monthYear:Te});const et={...he,stages:Fe};t({proceduralTimeline:et})},fe=async C=>{var Q;if(i){C.preventDefault();return}const re=(Q=C.target.files)==null?void 0:Q[0];if(re){N(!0);try{const he=new FileReader;he.onload=async()=>{var Ge;const Fe=he.result.split(",")[1],je=await G0(Fe,re.type);let Te={};if(je.insuredName){const He={...Te,insuredName:je.insuredName},Z=e.isSubjectAuto!==!1;Te=ae(Z?{...He,isSubjectAuto:!0}:He),Z&&(!e.reportSubject||!e.reportSubject.trim())&&(Te.reportSubject=je.insuredName,Te.isSubjectAuto=!0)}je.marketRef?(Te.marketRef=je.marketRef,Te.lineSlipNo=je.marketRef):je.lineSlipNo&&!Te.lineSlipNo&&(Te.lineSlipNo=je.lineSlipNo),je.certificateRef&&(Te.certificateRef=je.certificateRef),typeof je.policyPeriodStart=="string"&&(Te.policyPeriodStart=je.policyPeriodStart),typeof je.policyPeriodEnd=="string"&&(Te.policyPeriodEnd=je.policyPeriodEnd),typeof je.retroStart=="string"&&(Te.retroStart=je.retroStart),typeof je.retroEnd=="string"&&(Te.retroEnd=je.retroEnd),Te.policyFile={id:"policy-doc",name:re.name,data:Fe,type:re.type};const et=Kh((Ge=e.content)==null?void 0:Ge["Insurance Coverage"],Te.policyPeriodStart||e.policyPeriodStart,Te.policyPeriodEnd||e.policyPeriodEnd,Te.retroStart||e.retroStart,Te.retroEnd||e.retroEnd);et&&(Te.content={...e.content,"Insurance Coverage":et}),t(Te),N(!1)},he.readAsDataURL(re)}catch(he){console.error("Error reading file",he),N(!1)}}},Ee=10,ve=10,$e=async C=>{if(i){C.preventDefault(),C.target.value="";return}const re=C.target.files;if(!re||!re.length)return;const Q=e.lawyerAppendixFiles??[];if(Q.length>=Ee){alert(`You can attach up to ${Ee} appendices.`),C.target.value="";return}const he=Ee-Q.length,Fe=Array.from(re).slice(0,he),je=[];for(const Te of Fe){if(Te.size/1048576>ve){alert(`${Te.name} is larger than ${ve}MB and will not be attached.`);continue}let Ge=Te.type;Ge||(/\.(tif|tiff)$/i.test(Te.name)?Ge="image/tiff":Ge="application/octet-stream");const He=new FileReader,Z=await new Promise((Ne,xe)=>{He.onload=()=>{const Oe=String(He.result||"").split(",");Ne(Oe[1]||"")},He.onerror=()=>xe(He.error),He.readAsDataURL(Te)});je.push({id:`lawyer-appx-${Date.now()}-${Math.random().toString(36).slice(2,8)}`,name:Te.name,data:Z,type:Ge})}je.length&&t({lawyerAppendixFiles:[...Q,...je]}),C.target.value=""},Pe=C=>{if(i)return;const Q=(e.lawyerAppendixFiles??[]).filter(he=>he.id!==C);t({lawyerAppendixFiles:Q})},Ke=(C,re,Q,he)=>n.jsxs("div",{className:"relative group",children:[n.jsx("input",{className:"w-full border border-borderDark p-2 rounded focus:ring-2 focus:ring-lpBlue outline-none pr-8",placeholder:Q,value:C,onChange:i?void 0:Fe=>re(Fe.target.value),onBlur:i?void 0:he?()=>he(C):void 0,disabled:i}),C&&n.jsx("button",{type:"button",onClick:i?void 0:()=>re(""),className:`absolute right-2 top-1/2 -translate-y-1/2 text-gray-300 transition-colors ${i?"cursor-not-allowed opacity-50":"hover:text-red-500"}`,disabled:i,children:n.jsx($s,{className:"w-4 h-4"})})]});return n.jsxs("div",{className:"space-y-8",children:[n.jsx("div",{className:"flex justify-end",children:n.jsxs("button",{type:"button",onClick:i?void 0:c,disabled:i,className:`flex items-center text-sm bg-blue-50 px-3 py-1.5 rounded-full ${i?"text-gray-400 cursor-not-allowed":"text-lpBlue hover:text-blue-900"}`,title:i?"  .":void 0,children:[n.jsx(Lu,{className:"w-4 h-4 mr-1"}),"  "]})}),n.jsx("h2",{className:"text-3xl font-bold text-lpBlue font-serif border-b pb-2",children:"1. Case Setup & Structure"}),e.odakanitNo&&n.jsx("div",{className:"bg-indigo-50 border-l-4 border-indigo-600 p-4 mb-6",children:n.jsx("div",{className:"flex justify-between items-center",children:n.jsxs("div",{children:[n.jsxs("h3",{className:"font-bold text-indigo-900 flex items-center",children:[n.jsx(lh,{className:"w-5 h-5 mr-2"})," Odakanit Case #",e.odakanitNo]}),n.jsx("p",{className:"text-sm text-indigo-700",children:"This report folder was initiated by Finance."})]})})}),n.jsxs("div",{className:"bg-panel p-6 rounded-lg shadow-sm border border-borderDark relative overflow-hidden",children:[n.jsx("div",{className:"absolute top-0 left-0 w-1 h-full bg-lpGold"}),n.jsxs("h3",{className:"font-bold text-lg mb-4 text-textLight flex items-center",children:[n.jsx(yo,{className:"w-5 h-5 mr-2 text-lpGold"}),"Re: Case Details (Mandatory Fields - English)"]}),n.jsx("div",{className:"mb-6 bg-blue-50 border-2 border-dashed border-blue-200 rounded-lg p-4 text-center relative group",children:W?n.jsxs("div",{className:"flex flex-col items-center justify-center py-2",children:[n.jsx(Bt,{className:"w-8 h-8 text-lpBlue animate-spin mb-2"}),n.jsx("span",{className:"text-sm font-bold text-lpBlue",children:"Analyzing Policy Document..."})]}):n.jsx(n.Fragment,{children:e.policyFile?n.jsxs("div",{className:"flex flex-col items-center justify-center gap-3",children:[n.jsxs("div",{className:"flex items-center justify-center gap-3",children:[n.jsxs("div",{className:"flex flex-col items-center text-green-700 font-bold text-center",children:[n.jsxs("div",{className:"flex items-center",children:[n.jsx(oh,{className:"w-6 h-6 mr-2"}),"Policy Document Attached"]}),n.jsxs("span",{className:"text-xs font-normal text-green-800",children:["Original file: ",e.policyFile.name]})]}),n.jsx("button",{className:"text-xs text-red-500 hover:underline disabled:text-gray-400 disabled:cursor-not-allowed",onClick:i?void 0:()=>t({policyFile:void 0}),disabled:i,children:"Remove"})]}),n.jsxs("div",{className:"flex items-center justify-center gap-2 text-xs text-textLight bg-panel/70 px-3 py-1 rounded-full border border-borderDark",children:[n.jsx("input",{id:"attach-policy-appendix",type:"checkbox",className:"h-3 w-3 accent-lpBlue",checked:e.attachPolicyAsAppendix??!0,onChange:i?void 0:C=>t({attachPolicyAsAppendix:C.target.checked}),disabled:i}),n.jsx("label",{htmlFor:"attach-policy-appendix",className:"cursor-pointer",children:"Attach policy as Appendix A to final PDF"})]})]}):n.jsxs(n.Fragment,{children:[n.jsxs("div",{className:`flex flex-col items-center justify-center text-center px-4 ${i?"cursor-not-allowed opacity-60":"cursor-pointer"}`,children:[n.jsx(No,{className:"w-8 h-8 text-lpBlue mb-2 group-hover:scale-110 transition-transform"}),n.jsx("span",{className:"text-sm font-bold text-textLight",children:"Upload Policy Document"}),n.jsx("span",{className:"text-xs text-textMuted mt-1",children:"Any file uploaded here (PDF/DOCX/scan) is treated as the official policy for this case."})]}),n.jsx("input",{type:"file",className:"absolute inset-0 opacity-0 cursor-pointer",accept:"application/pdf,application/vnd.openxmlformats-officedocument.wordprocessingml.document,text/plain,image/*",onChange:fe,disabled:i})]})})}),n.jsxs("div",{className:"mb-6 mt-4 bg-slate-50 border border-dashed border-borderDark rounded-lg p-4",children:[n.jsxs("h4",{className:"text-sm font-semibold text-textLight mb-2 flex items-center justify-between",children:[n.jsx("span",{children:"Additional Appendices (Lawyer)"}),n.jsxs("span",{className:"text-[11px] text-textMuted",children:[((Ye=e.lawyerAppendixFiles)==null?void 0:Ye.length)||0,"/",Ee]})]}),n.jsx("div",{className:"flex flex-col md:flex-row gap-3 md:items-center",children:n.jsx("div",{className:"flex-1",children:n.jsxs("label",{htmlFor:"lawyer-appendix-input",className:`flex flex-col items-center justify-center px-3 py-3 border-2 border-dashed border-borderDark rounded-lg text-xs text-textMuted bg-panel transition-colors ${i?"cursor-not-allowed opacity-60":"cursor-pointer hover:border-lpBlue hover:text-lpBlue"}`,children:[n.jsx(No,{className:"w-5 h-5 mb-1"}),n.jsx("span",{className:"font-semibold",children:"Upload / drag legal appendices"}),n.jsxs("span",{className:"mt-1 text-[11px] text-textMuted",children:["Supported: PDF, PNG, JPG, TIFF (up to ",ve,"MB per file)"]}),n.jsx("input",{id:"lawyer-appendix-input",type:"file",multiple:!0,className:"hidden",accept:"application/pdf,image/png,image/jpeg,image/jpg,image/tiff,image/x-tiff",onChange:$e,disabled:i})]})})}),(((it=e.lawyerAppendixFiles)==null?void 0:it.length)||0)>0&&n.jsx("div",{className:"mt-3 border-t border-borderDark pt-2 space-y-1 max-h-40 overflow-y-auto text-xs text-textLight text-left",children:(q=e.lawyerAppendixFiles)==null?void 0:q.map(C=>n.jsxs("div",{className:"flex items-center justify-between gap-2 rounded bg-panel px-2 py-1 border border-borderDark",children:[n.jsxs("div",{className:"flex-1 min-w-0",children:[n.jsx("div",{className:"truncate font-medium",children:C.name}),n.jsx("div",{className:"text-[11px] text-textMuted truncate",children:C.type||"Unknown type"})]}),n.jsx("button",{type:"button",onClick:i?void 0:()=>Pe(C.id),className:"text-[11px] text-red-500 hover:text-red-700 disabled:text-gray-400 disabled:cursor-not-allowed",disabled:i,children:"Remove"})]},C.id))})]}),n.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-5",children:[n.jsxs("div",{className:"space-y-1",children:[n.jsxs("label",{className:"text-xs font-bold text-textMuted uppercase flex items-center",children:[n.jsx(T0,{className:"w-3 h-3 mr-1"})," Report Date"]}),n.jsx("input",{type:"date",className:"w-full border border-borderDark p-2 rounded disabled:bg-navySecondary disabled:text-textMuted",value:te(e.reportDate),onChange:i?void 0:C=>t({reportDate:new Date(C.target.value).toISOString()}),disabled:i})]}),n.jsxs("div",{className:"space-y-1",children:[n.jsx("label",{className:"text-xs font-bold text-textMuted uppercase",children:"RE (Subject)"}),n.jsx("input",{type:"text",className:"w-full border border-borderDark p-2 rounded text-sm disabled:bg-navySecondary disabled:text-textMuted",placeholder:"e.g. John Doe v. XYZ Medical Center  Claim Update",value:e.reportSubject||"",onChange:i?void 0:C=>t({reportSubject:C.target.value,isSubjectAuto:!1}),disabled:i})]}),n.jsxs("div",{className:"space-y-1",children:[n.jsx("label",{className:"text-xs font-bold text-textMuted uppercase",children:"Odakanit Case Number (Internal File)"}),Ke(e.odakanitNo||"",C=>t({odakanitNo:C}),"e.g., 1/123")]}),n.jsxs("div",{className:"space-y-1",children:[n.jsx("label",{className:"text-xs font-bold text-textMuted uppercase",children:"Insurer Name"}),n.jsxs("select",{className:"w-full border border-borderDark p-2 rounded disabled:bg-navySecondary disabled:text-textMuted",value:R?"OTHER":e.insurerName,onChange:i?void 0:C=>j(C.target.value),disabled:i,children:[n.jsx("option",{value:"",disabled:!0,children:"-- Select Insurer --"}),dp.map(C=>n.jsx("option",{value:C,children:C},C)),n.jsx("option",{value:"OTHER",children:"Other (Enter Manually)"})]}),R&&n.jsx("div",{className:"mt-2 animate-fade-in",children:Ke(e.insurerName,C=>t({insurerName:C}),"Type custom insurer name...")})]}),n.jsxs("div",{className:"space-y-1",children:[n.jsx("label",{className:"text-xs font-bold text-textMuted uppercase",children:Bp.lineSlip}),Ke(e.lineSlipNo,C=>t({lineSlipNo:C,marketRef:C}),"e.g., B0180PD2391439")]}),n.jsxs("div",{className:"space-y-1",children:[n.jsx("label",{className:"text-xs font-bold text-textMuted uppercase",children:Bp.certificate}),Ke(e.certificateRef||"",C=>t({certificateRef:C}),"e.g., 516902624")]}),n.jsxs("div",{className:"space-y-1",children:[n.jsx("label",{className:"text-xs font-bold text-textMuted uppercase",children:"Insured Name"}),Ke(e.insuredName,C=>t(ae({insuredName:C})),"e.g., Dr. Cohen",C=>{const re=(C||"").trim();!re||!zp(re)||Cd(re).then(Q=>{!Q||Q.trim()===""||Q==="Error translation."||P.current===re&&t(ae({insuredName:Q.trim()}))}).catch(()=>{})})]}),n.jsxs("div",{className:"space-y-1 md:col-span-2",children:[n.jsxs("div",{className:"flex justify-between items-end mb-1",children:[n.jsx("label",{className:"text-xs font-bold text-textMuted uppercase",children:"Party Name"}),n.jsxs("div",{className:"flex bg-navySecondary rounded p-0.5 text-xs",children:[n.jsx("button",{className:`px-3 py-1 rounded-sm transition-all ${e.plaintiffTitle==="Plaintiff"?"bg-panel shadow text-lpBlue font-bold":"text-textMuted"}`,onClick:()=>t({plaintiffTitle:"Plaintiff"}),children:"Plaintiff"}),n.jsx("button",{className:`px-3 py-1 rounded-sm transition-all ${e.plaintiffTitle==="Claimant"?"bg-panel shadow text-lpBlue font-bold":"text-textMuted"}`,onClick:()=>t({plaintiffTitle:"Claimant"}),children:"Claimant"})]})]}),Ke(e.plaintiffName,C=>t(ae({plaintiffName:C})),"e.g., Mr. Levi",C=>{const re=(C||"").trim();!re||!zp(re)||Cd(re).then(Q=>{!Q||Q.trim()===""||Q==="Error translation."||U.current===re&&t(ae({plaintiffName:Q.trim()}))}).catch(()=>{})})]})]})]}),n.jsxs("div",{className:"bg-panel p-6 rounded-lg shadow-sm border border-borderDark",children:[n.jsx("div",{className:"flex justify-between items-center mb-4",children:n.jsxs("div",{children:[n.jsxs("h3",{className:"font-bold text-lg text-textLight flex items-center",children:[n.jsx(ih,{className:"w-5 h-5 mr-2 text-lpBlue"}),"Procedural Timeline"]}),n.jsx("p",{className:"text-sm text-textMuted",children:'   ,    Month/Year    ".'})]})}),n.jsxs("div",{className:"mb-4",children:[n.jsx("label",{className:"block text-xs font-semibold text-textMuted mb-1",children:"Procedure Type"}),n.jsx("select",{className:"border border-borderDark rounded px-3 py-1 text-sm",value:((se=e.proceduralTimeline)==null?void 0:se.procedureType)||"FIRST_INSTANCE",onChange:C=>J(C.target.value),children:kv.map(C=>n.jsx("option",{value:C.value,children:C.label},C.value))})]}),!e.proceduralTimeline&&D&&n.jsxs("div",{className:"border border-dashed border-borderDark rounded-md p-3 bg-navySecondary text-xs text-textLight",children:[n.jsx("p",{className:"mb-2",children:"This report uses the legacy timeline. You can enable the new Procedural Timeline (recommended for new reports)."}),n.jsx("button",{type:"button",className:"inline-flex items-center px-3 py-1 rounded-full bg-navy text-gold text-[11px] font-semibold hover:bg-navySecondary",onClick:()=>t({proceduralTimeline:I()}),children:"Enable Procedural Timeline"})]}),e.proceduralTimeline&&n.jsx("div",{className:"space-y-3",children:Oa[e.proceduralTimeline.procedureType].map(C=>{var He,Z,Ne;const re=((Z=(He=e.proceduralTimeline)==null?void 0:He.stages)==null?void 0:Z.find(xe=>xe.id===C.id))||void 0,Q=V[C.id],he=!!C.isDynamic,Fe=he?!!(re!=null&&re.include):!0,je=(re==null?void 0:re.monthYear)||"";let Te="",et="";if(Q)Te=Q.month||"",et=Q.year||"";else if(typeof je=="string"&&je.includes("-")){const[xe,be]=je.split("-");xe&&be&&(et=xe,Te=be)}const Ge=((Ne=e.proceduralTimeline)==null?void 0:Ne.currentStageId)===C.id;return n.jsxs("div",{className:"flex items-start justify-between border border-borderDark rounded-lg px-3 py-2 bg-panel",children:[n.jsxs("div",{className:"flex items-start gap-3",children:[n.jsx("input",{type:"radio",name:"currentStage",className:"mt-1",checked:Ge,disabled:!Fe,onChange:()=>Fe&&ue(C.id)}),n.jsxs("div",{children:[n.jsxs("div",{className:"font-semibold text-sm text-textLight flex items-center gap-2",children:[n.jsx("span",{children:C.label}),he&&n.jsx("span",{className:"text-[10px] px-2 py-0.5 rounded-full bg-navySecondary text-textMuted",children:"Dynamic"})]}),n.jsxs("div",{className:"mt-1 flex items-center gap-2 text-xs text-textMuted flex-wrap",children:[n.jsx("span",{children:"Month / Year:"}),n.jsxs("select",{className:"border border-borderDark rounded px-2 py-0.5 text-xs",value:Te,disabled:!Fe,onChange:xe=>le(C.id,xe.target.value,et),children:[n.jsx("option",{value:"",children:""}),n.jsx("option",{value:"01",children:"January"}),n.jsx("option",{value:"02",children:"February"}),n.jsx("option",{value:"03",children:"March"}),n.jsx("option",{value:"04",children:"April"}),n.jsx("option",{value:"05",children:"May"}),n.jsx("option",{value:"06",children:"June"}),n.jsx("option",{value:"07",children:"July"}),n.jsx("option",{value:"08",children:"August"}),n.jsx("option",{value:"09",children:"September"}),n.jsx("option",{value:"10",children:"October"}),n.jsx("option",{value:"11",children:"November"}),n.jsx("option",{value:"12",children:"December"})]}),n.jsx("input",{type:"number",className:"w-20 border border-borderDark rounded px-2 py-0.5 text-xs",placeholder:"Year",value:et,disabled:!Fe,onChange:xe=>le(C.id,Te,xe.target.value),min:1900,max:2100})]})]})]}),he&&n.jsxs("div",{className:"flex items-center gap-1 text-xs text-textMuted",children:[n.jsx("span",{children:"Include"}),n.jsx("input",{type:"checkbox",checked:Fe,onChange:xe=>ce(C.id,xe.target.checked)})]})]},C.id)})})]}),n.jsxs("div",{className:"bg-panel p-6 rounded-lg shadow-sm border border-borderDark",children:[n.jsxs("h3",{className:"font-bold text-lg mb-4 text-textLight flex items-center",children:[n.jsx(P0,{className:"w-5 h-5 mr-2 text-green-600"}),"Current Report Sections"]}),n.jsx("div",{className:"space-y-2 mb-6",children:e.selectedSections.map((C,re)=>{const Q=re>0,he=re<e.selectedSections.length-1,je=!!(e.expensesSheetId||e.expensesHtml)&&Qr(C),Te=C==="Update"||je;return n.jsxs("div",{className:"flex items-center justify-between p-3 bg-panel border border-borderDark rounded shadow-sm",children:[n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsx("span",{className:"w-6 h-6 rounded-full bg-navySecondary text-textMuted flex items-center justify-center text-xs font-bold",children:re+1}),n.jsx("span",{className:"font-medium text-textLight",children:C}),C==="Update"&&n.jsx("span",{className:"text-xs bg-blue-100 text-blue-800 px-2 py-0.5 rounded",children:"Fixed"}),je&&n.jsx("span",{className:"text-xs bg-amber-100 text-amber-800 px-2 py-0.5 rounded",children:"   "})]}),n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsxs("div",{className:"flex flex-col gap-1",children:[n.jsx("button",{onClick:()=>M(re,"UP"),disabled:!Q,className:`p-1 rounded border ${Q?"text-textMuted hover:bg-navySecondary":"text-gray-300 cursor-not-allowed"}`,title:" ",children:n.jsx(C0,{className:"w-4 h-4"})}),n.jsx("button",{onClick:()=>M(re,"DOWN"),disabled:!he,className:`p-1 rounded border ${he?"text-textMuted hover:bg-navySecondary":"text-gray-300 cursor-not-allowed"}`,title:" ",children:n.jsx(R0,{className:"w-4 h-4"})})]}),!Te&&n.jsx("button",{onClick:()=>O(C),className:"p-2 rounded-md text-textMuted hover:text-red-400 hover:bg-red-500/10 border border-transparent hover:border-red-400/40 transition",title:" ",children:n.jsx(Ht,{className:"w-4 h-4"})})]})]},`${C}-${re}`)})}),y?n.jsxs("div",{className:"bg-navySecondary p-4 rounded border animate-fade-in",children:[n.jsxs("div",{className:"flex gap-2",children:[n.jsxs("select",{className:"flex-1 border p-2 rounded",onChange:C=>L(C.target.value),defaultValue:"",children:[n.jsx("option",{value:"",disabled:!0,children:"-- Select a Header --"}),Lr.filter(C=>!e.selectedSections.includes(C)).map(C=>n.jsx("option",{value:C,children:C},C))]}),n.jsx("button",{onClick:()=>b(!1),className:"px-4 py-2 bg-borderDark text-textMuted rounded hover:bg-borderDark",children:"Cancel"})]}),n.jsx("div",{className:"mt-4 pt-4 border-t border-borderDark",children:n.jsxs("div",{className:"flex gap-2",children:[n.jsx("input",{className:"flex-1 border p-2 rounded",placeholder:"Type custom header name...",value:u,onChange:C=>p(C.target.value)}),n.jsx("button",{onClick:()=>{H(),b(!1)},className:"px-4 py-2 bg-purple-600 text-white rounded hover:bg-purple-700",children:"Add Custom"})]})})]}):n.jsxs("button",{onClick:()=>b(!0),className:"w-full py-2 border-2 border-dashed border-borderDark text-textMuted rounded hover:border-green-500 hover:text-green-600 transition flex items-center justify-center font-medium",children:[n.jsx(Ou,{className:"w-4 h-4 mr-2"})," Add Report Section"]})]}),n.jsxs("div",{className:"flex flex-wrap justify-between gap-2",children:[n.jsxs("button",{onClick:c,className:"flex items-center text-textMuted px-4 py-2 border rounded hover:bg-navySecondary transition",children:[n.jsx(Ql,{className:"mr-2 w-4 h-4"})," Back to Dashboard"]}),n.jsxs("button",{onClick:F,className:"flex items-center bg-navy text-gold px-6 py-2 rounded hover:bg-navySecondary transition shadow-md",children:["Next Step ",n.jsx(is,{className:"ml-2 w-4 h-4"})]})]})]})},Vp=e=>{if(!e)return null;try{const t=JSON.stringify(e);let s=0;for(let r=0;r<t.length;r+=1){const a=t.charCodeAt(r);s=(s<<5)-s+a,s|=0}return String(s)}catch{return null}},$v=({data:e,updateData:t,onBack:s,onNext:r,currentUser:a,onSaveAndExit:o,onSaveDraft:l,onTranslate:c,onImproveEnglish:i,onFormatContent:u,onSubmitHebrewForReview:p,onApproveHebrewForTranslation:y,onAddReviewIssues:b,onMarkReviewIssueDone:w,onAddExternalFeedbackIssues:R,onReopenHebrewDueToExternalFeedback:E,step1Focus:W,onStep1FocusConsumed:N,isTranslating:h,isImprovingEnglish:S,onOpenAssistant:P,onActiveSectionChange:U,readOnly:V})=>{var Ho;const X=Ws,te=Co,[G,ae]=g.useState(null),[j,F]=g.useState(!1),[L,O]=g.useState(null),[H,M]=g.useState([]),[I,D]=g.useState(""),[J,ue]=g.useState(!1),[ce,le]=g.useState(()=>Lr[0]||"Update"),[fe,Ee]=g.useState([]),[ve,$e]=g.useState(!1),[Pe,Ke]=g.useState(null),[Ye,it]=g.useState(null),[q,se]=g.useState(null),[C,re]=g.useState([]),[Q,he]=g.useState(!1),[Fe,je]=g.useState(null),[Te,et]=g.useState("SAFE_POLISH"),[Ge,He]=g.useState(null),[Z,Ne]=g.useState([]),[xe,be]=g.useState("TEMPLATES"),[Oe,Ce]=g.useState(""),[qe,dt]=g.useState(!1),[Ue,nt]=g.useState(()=>Lr[0]||"Update"),[jt,z]=g.useState(null),[ie,De]=g.useState(()=>Eo(a.id)),[Me,pe]=g.useState(""),[Le,st]=g.useState(!1),[ne,Be]=g.useState(null),[Ct,_t]=g.useState("DUAL"),[We,Qt]=g.useState(null),[xn,hn]=g.useState(null),[Cs,sr]=g.useState(null),[Cn,rr]=g.useState(null),[es,Un]=g.useState(null),fs=g.useRef(null),Wn=g.useRef(null),A=g.useRef({}),[ge,_e]=g.useState({date:new Date().toISOString().split("T")[0],description:"",amount:0,currency:"NIS"}),Ie=a.role==="FINANCE"||a.role==="SUB_ADMIN"&&!0,mt=e.selectedSections.some(f=>f.toLowerCase().includes("expenses")),at=a.role==="LAWYER"&&e.requiresExpenses===!0&&mt,Zt=a.role==="ADMIN"&&e.isTranslated,Ds=a.role==="LAWYER"||a.role==="ADMIN",en=a.role==="FINANCE"||a.role==="SUB_ADMIN"||a.role==="ADMIN",Dt=((Ho=e.reportReview)==null?void 0:Ho.status)==="APPROVED"||e.hebrewWorkflowStatus==="HEBREW_APPROVED",Do=e.translatedContent||{},xa=Object.keys(Do).some(f=>{if(f.toLowerCase().includes("expenses"))return!1;const T=Do[f];return typeof T=="string"&&T.trim().length>0});g.useEffect(()=>{De(Eo(a.id))},[a.id]);const jr=async f=>{var K,ee;if(V||!Zt||!e.isTranslated||f.toLowerCase().includes("expenses"))return;const T=((K=e.translatedContent)==null?void 0:K[f])||"";if(T.trim()){Un(f);try{const{protectedText:de,map:d}=zh(T),m=await xh(de),x=Vh(m||de,d),k=Wh(x),v={...e.translatedContent||{},[f]:li(k)};t({translatedContent:v}),typeof l=="function"&&l()}catch(de){console.error("Improve English (single section) failed",de);const d=Dd(f,(ee=e.expertSummaryMode)==null?void 0:ee[f]);window.alert(`   "${d}" .      .`)}finally{Un(de=>de===f?null:de)}}},Ei=f=>typeof f.reportNumber=="number"&&f.reportNumber===1,ki=f=>hp(f)?"EXPERT":f===te?"DEMAND":"CLAIM";g.useEffect(()=>{if(!W)return;const f=()=>{let T=null;W==="EXTERNAL_FEEDBACK"?T=Ld:W==="REVIEW"&&(T=kl);let K=null;if(T&&(K=document.getElementById(T)),K||(K=document.getElementById(kl)),K)try{K.scrollIntoView({behavior:"smooth",block:"start"})}catch{}N&&N()};typeof window<"u"?window.requestAnimationFrame(()=>{const T=W==="EXTERNAL_FEEDBACK"&&document.getElementById(Ld)||document.getElementById(kl);if(T){try{T.scrollIntoView({behavior:"smooth",block:"start"})}catch{}N&&N()}else setTimeout(f,0)}):f()},[W,N]);const Ai=()=>{if(V||!en||!ge.description||!ge.amount)return;const f={id:Date.now().toString(),date:ge.date||"",description:ge.description,amount:Number(ge.amount),currency:ge.currency||"NIS"},T=[...e.expensesItems,f],K=T.reduce((ee,de)=>ee+de.amount,0);t({expensesItems:T,expensesSum:K.toLocaleString()}),_e({date:new Date().toISOString().split("T")[0],description:"",amount:0,currency:"NIS"})},Ii=f=>{if(V)return;const T=e.expensesItems.filter(ee=>ee.id!==f),K=T.reduce((ee,de)=>ee+de.amount,0);t({expensesItems:T,expensesSum:K.toLocaleString()})},Yt=async f=>{if(V)return;const T=f.target.files;if(!T)return;const K=e.invoiceFiles.length;if(K>=4){O({msg:"   4   (PDF  Word).",type:"info"}),f.target.value="";return}const ee=Array.from(T).slice(0,4-K),de=[];for(let v=0;v<ee.length;v++){const _=ee[v],$=new FileReader;await new Promise(B=>{$.onload=Y=>{var oe;de.push({id:`inv-${Date.now()}-${v}`,name:_.name,data:((oe=Y.target)==null?void 0:oe.result).split(",")[1],type:_.type}),B()},$.readAsDataURL(_)})}const d=[...e.invoiceFiles,...de],m=d.length>0,k=en&&e.status==="WAITING_FOR_INVOICES"&&m?"TASK_ASSIGNED":e.status;t({invoiceFiles:d,isWaitingForInvoices:!m,status:k}),O({msg:"   ( 4 ).",type:"success"})},dn=f=>{const T=e.invoiceFiles.filter(d=>d.id!==f),K=T.length>0,de=en&&!K&&e.status==="TASK_ASSIGNED"?"WAITING_FOR_INVOICES":e.status;t({invoiceFiles:T,isWaitingForInvoices:!K,status:de})},tn=(f,T)=>{Ie||t({content:{...e.content,[f]:T}})},Ti=f=>f.replace(/{plaintiff}/g,e.plaintiffName||"").replace(/{insured}/g,e.insuredName||"").replace(/\[DATE\]/g,new Date().toLocaleDateString("he-IL"));g.useEffect(()=>{let f=!1;return(async()=>{try{const K=await up();f||M(K)}catch(K){console.error("Failed to load templates",K)}try{const K=await rN();f||Ne(K)}catch(K){console.error("Failed to load best practices",K)}})(),()=>{f=!0}},[]);const Ri=(f,T)=>{Zt&&t({translatedContent:{...e.translatedContent,[f]:T}})},Er=f=>H.filter(T=>T.sectionKey===f&&T.isEnabled!==!1).sort((T,K)=>(T.orderIndex||0)-(K.orderIndex||0)||T.createdAt.localeCompare(K.createdAt)),xs=(f,T)=>{if(Ie)return;let K=T.body.replace(/{plaintiff}/g,e.plaintiffName||"the claimant").replace(/{insured}/g,e.insuredName||"the insured").replace(/\[DATE\]/g,new Date().toLocaleDateString("he-IL"));const ee=e.content[f]||"";tn(f,ee?`${ee}

${K}`:K),ae(null)},Ci=async f=>{try{const T=await up();M(T)}catch(T){console.error("Failed to refresh templates",T)}D(""),Ce(""),ae(T=>T===f?null:f)},Di=async f=>{if(a.role!=="ADMIN")return;const T=A.current[f],K=T==null?void 0:T.current;if(!K){O({msg:"     .",type:"error"});return}const ee=K.selectionStart??0,de=K.selectionEnd??0;if(ee===de){O({msg:"     .",type:"info"});return}let m=(e.content[f]||"").slice(ee,de).trim();if(!m){O({msg:"    .",type:"info"});return}if(m.length<15&&!window.confirm("   .    ?"))return;const x=m.split(/\s+/).slice(0,6).join(" "),v=(window.prompt(" :",x)||"").trim();if(!v){O({msg:"   ( ).",type:"info"});return}const _=new Date().toISOString(),$={id:"",sectionKey:f,title:v,body:m,createdByUserId:a.id,createdAt:_,updatedAt:_,isEnabled:!0};try{const B=await mp($,a.role);M(B),O({msg:"  .",type:"success"})}catch(B){console.error("Failed to save template",B),O({msg:"  .",type:"error"})}},kr=async(f,T)=>{if(a.role!=="ADMIN")return;const K=H.find(de=>de.id===f);if(!K)return;const ee={...K,...T,updatedAt:new Date().toISOString()};try{const de=await mp(ee,a.role);M(de)}catch(de){console.error("Failed to update template",de),O({msg:"  .",type:"error"})}},ha=async f=>{if(a.role==="ADMIN")try{const T=await K0(f,a.role);M(T)}catch(T){console.error("Failed to delete template",T),O({msg:"  .",type:"error"})}},ga=async(f,T)=>{if(a.role==="ADMIN")try{const K=await Y0(f,T,a.role);M(K)}catch(K){console.error("Failed to reorder template",K),O({msg:"   .",type:"error"})}},Lo=(f,T)=>{if(!f||!T||f===T)return"  ";const K=f.split(/\s+/).filter(Boolean),ee=T.split(/\s+/).filter(Boolean);if(!K.length||!ee.length)return"  ";const de=Math.max(K.length,ee.length)||1;let d=0;const m=Math.min(K.length,ee.length);for(let k=0;k<m;k+=1)K[k]!==ee[k]&&(d+=1);d+=Math.abs(K.length-ee.length);const x=d/de;return x<.05?"  ":x<.15?" ":x<.35?" ":" "},Li=async f=>{if(Ie)return;const T=e.content[f];if(T){sr(f),F(!0);try{const K=await q0(T,Te);if(K.factProtectionBlocked){O({msg:"    ( ).    .",type:"info"});return}const ee=K.text,de=Lo(T,ee),d=iv(T,ee),m=d.filter(x=>x.type==="add"||x.type==="remove").length;if(m>0){const x=Date.now()+2e4;He({sectionKey:f,tokens:d,changedWords:m,expiresAt:x,open:!1}),setTimeout(()=>{He(k=>k&&k.sectionKey===f&&k.expiresAt===x?null:k)},2e4)}else He(null);O({msg:`  (${Te==="SAFE_POLISH"?"SAFE_POLISH":"REWRITE"}): ${de}`,type:"success"}),tn(f,ee)}catch(K){console.error("Refine text failed",K),O({msg:"  .   .",type:"error"})}finally{F(!1),sr(null)}}},_i=async(f,T,K)=>{var ee;F(!0);try{const de=await Z0(T,K);if((ee=de.items)!=null&&ee.length){const d=[...e.expensesItems,...de.items],m=d.reduce((x,k)=>x+(k.amount||0),0);t({expensesItems:d,expensesSum:m.toLocaleString()}),O({msg:`  "${f}"  .`,type:"success"})}else O({msg:"    .",type:"info"})}catch(de){console.error("Expenses extraction failed",de),O({msg:" .   PDF/Word .",type:"error"})}finally{F(!1)}},Oi=f=>new Promise((T,K)=>{const ee=new FileReader;ee.onload=()=>T(ee.result.split(",")[1]),ee.onerror=()=>K(new Error("Failed to read file")),ee.readAsDataURL(f)}),_o=f=>{var k,v,_,$,B,Y,oe,we;if(!f)return;const T=[...e.selectedSections],K=ye=>{T.includes(ye)||T.push(ye)},ee=ye=>ye&&ye.length?ye.map(Ve=>` ${Ve}`).join(`
`):"",de=(k=f.timeline)!=null&&k.length?f.timeline.map(ye=>` ${(ye==null?void 0:ye.date)||"  "}  ${(ye==null?void 0:ye.event)||""}`).join(`
`):"",d={...e.content};if(f.briefSummary||de||(v=f.injuries)!=null&&v.length){K("Update");const ye=ee(f.injuries),Ve=ee(f.requestedRelief),Je=[f.briefSummary||"",ye?`
 :
${ye}`:"",Ve?`
 :
${Ve}`:"",de?`
 :
${de}`:""].filter(Boolean);d.Update=Je.join(`
`).trim()}if((_=f.facts)!=null&&_.length){const ye=Ws;K(ye),d[ye]=ee(f.facts)}const m=[];if(($=f.allegations)!=null&&$.length&&m.push(` :
${ee(f.allegations)}`),(B=f.negligenceTheory)!=null&&B.length&&m.push(` :
${ee(f.negligenceTheory)}`),(Y=f.medicalFindings)!=null&&Y.length&&m.push(` :
${ee(f.medicalFindings)}`),m.length){const ye=e.selectedSections.includes("Strategy & Recommendations")?"Strategy & Recommendations":"Strategy";K(ye),d[ye]=m.join(`

`)}f.riskAssessment&&(K("Risk Assessment"),d["Risk Assessment"]=f.riskAssessment);const x=[];(oe=f.recommendedActions)!=null&&oe.length&&x.push(ee(f.recommendedActions)),(we=f.requestedRelief)!=null&&we.length&&x.push(` :
${ee(f.requestedRelief)}`),x.length&&(K("Recommendations"),d.Recommendations=x.join(`

`)),t({content:d,selectedSections:T,complaintAnalysis:f}),O({msg:"     .",type:"success"})},Mi=(f,T)=>{var Wt,Ft,Ot;if(!f)return"";const K=(T==null?void 0:T.analysisType)==="DEMAND"||(T==null?void 0:T.section)===te?"DEMAND":"CLAIM",ee=K==="DEMAND"?"":"",de=K==="DEMAND"?"   ":"  ",d=(Ft=(Wt=f.entities)==null?void 0:Wt.plaintiff)==null?void 0:Ft.trim(),m=(f.defendants||[]).filter(Boolean).join(", "),x=[];x.push(d?`${ee}, ${d}`:ee),m&&x.push(`${de} ${m}`);const k=`${x.join(" ")}.`.replace(/\s+/g," ").trim(),v=(ze,zn,gn,ts=!1)=>{const lt=zn.map(pt=>(pt||"").trim()).filter(Boolean);if(!lt.length&&ts)return"";const Tt=lt.length?lt:gn?[gn]:[];if(!Tt.length)return"";const nn=Tt.map((pt,ns)=>`${ns+1}. ${pt}`.trim()).join(`
`);return`${ze}
${nn}`.trim()},_=(f.timeline||[]).map(ze=>{var ns,Sa,ar,wa,Uo,Wo;if(!(ze!=null&&ze.event)&&!(ze!=null&&ze.date))return"";const zn=((ze==null?void 0:ze.date)||"").toString().trim(),gn=zn||" ",ts=((ze==null?void 0:ze.actor)||"").toString().trim()||(((ns=f.entities)==null?void 0:ns.plaintiff)||"").toString().trim()||ee,lt=((ze==null?void 0:ze.location)||"").toString().trim()||((Wo=(wa=(ar=(Sa=f.entities)==null?void 0:Sa.institution)==null?void 0:ar.toString)==null?void 0:(Uo=wa.call(ar)).trim)==null?void 0:Wo.call(Uo))||"",Tt=((ze==null?void 0:ze.event)||"").toString().trim(),nn=((ze==null?void 0:ze.result)||"").toString().trim(),pt=[];return pt.push(gn),pt.push(` ${ts}`),Tt&&pt.push(` ${Tt}`),lt&&pt.push(` ${lt}`),nn&&pt.push(` ${nn}`),pt.join(" ").replace(/\s+/g," ").trim()}).filter(Boolean)||[],$=(f.facts||[]).filter(Boolean),B=_.length?_:$,oe=v(K==="DEMAND"?"  ,  :":"  ,  :",B,"    ."),we=[];(Ot=f.entities)!=null&&Ot.plaintiff&&we.push(String(f.entities.plaintiff).trim()),Array.isArray(f.defendants)&&we.push(...f.defendants.map(String).map(ze=>ze.trim())),Array.isArray(f.providers)&&we.push(...f.providers.map(String).map(ze=>ze.trim()));const ye=Array.from(new Set(we.filter(Boolean))),Ve=ye.length?`      : ${ye.join(", ")}.`:"",Qe=(Array.isArray(f.gaps)&&f.gaps||Array.isArray(f.missingDetails)&&f.missingDetails||[]).filter(Boolean).map(ze=>String(ze).trim()).filter(Boolean),ct=Qe.length?Qe:["   ,        ."],rt=v("  :",ct),Et=(()=>{const ze=(f.injuries||[]).find(gn=>gn&&String(gn).trim())||(f.medicalFindings||[]).find(gn=>gn&&String(gn).trim());return ze?` ${K==="DEMAND"?"":""},         : ${String(ze).trim()}.`:""})();return[k,oe,Ve,rt,Et].filter(ze=>ze&&String(ze).trim()).join(`

`).trim()},Oo=()=>{tn("Strategy",Mv),O({msg:' " "  .',type:"success"})},Pi=(f,T)=>{var de;const K=(de=f.target.files)==null?void 0:de[0];if(!K)return;if(!T.includes("Expenses")){f.target.value="";return}const ee=new FileReader;ee.onload=async d=>{var x;const m=((x=d.target)==null?void 0:x.result).split(",")[1];await _i(K.name,m,K.type)},ee.readAsDataURL(K),f.target.value=""},Ar=f=>{rr(null),Qt(f),setTimeout(()=>{var T;(T=fs.current)==null||T.click()},0)},Mo=async f=>{var ee,de,d;const T=(ee=f.target.files)==null?void 0:ee[0];if(!T||!We){Qt(null),f.target.value="";return}F(!0);const K=We.section||We.mode;hn(K);try{const m=await Oi(T),x=We.mode==="SECTION"&&We.section||Ws;if(We.domain==="dental"&&We.mode==="SECTION"){try{const oe=await Q0(m,T.type||"application/octet-stream"),we=((de=oe.text)==null?void 0:de.trim())??"";if(!oe.success||!we){const ye=oe.reason==="INVALID_DOCUMENT"?Mp:Cr;O({msg:ye,type:"info"})}else{const ye=we,Ve=We.section||X,Je=e.content[Ve]||"",Qe=Je?`${Je}

${ye}`:ye,ct={content:{...e.content,[Ve]:Qe},selectedSections:e.selectedSections.includes(Ve)?e.selectedSections:[...e.selectedSections,Ve]};if(We.analysisType==="EXPERT"&&We.section){const Et=!!Je.trim()?"MULTIPLE":"SINGLE";ct.expertSummaryMode={...e.expertSummaryMode||{},[Ve]:Et}}t(ct),O({msg:"  ()    .",type:"success"})}}catch(oe){console.error("Dental opinion analysis failed",oe),O({msg:Cr,type:"info"})}finally{F(!1),hn(null),Qt(null),f.target.value=""}return}const v=x===X||x===te,_=hp(x),$={expertCountMode:We.analysisType==="EXPERT"?((d=e.expertSummaryMode)==null?void 0:d[x])||"SINGLE":void 0,partyRole:lN(x)||void 0};(v||_)&&($.sectionKey=x,$.plaintiffName=e.plaintiffName||"",$.insuredName=e.insuredName||"",$.insurerName=e.insurerName||"",$.reportSubject=e.reportSubject||"");const B=await J0(m,T.type||"application/octet-stream",We.analysisType||"CLAIM",$);if(B.success===!1){const oe=B.reason==="INVALID_DOCUMENT"?Mp:Cr;O({msg:oe,type:"info"});return}const Y=(B==null?void 0:B.analysis)||null;if(We.mode==="SECTION"){const oe=((B==null?void 0:B.claimSummary)||"").trim()||Mi(Y,{analysisType:We.analysisType,section:We.section});if(!oe)O({msg:Cr,type:"info"});else{const we=We.section||X,ye=e.content[we]||"",Ve=ye?`${ye}

${oe}`:oe,Je={content:{...e.content,[we]:Ve},selectedSections:e.selectedSections.includes(we)?e.selectedSections:[...e.selectedSections,we]};if(We.analysisType==="EXPERT"&&We.section){const ct=!!ye.trim()?"MULTIPLE":"SINGLE";Je.expertSummaryMode={...e.expertSummaryMode||{},[we]:ct}}Y&&(Je.complaintAnalysis=Y),t(Je),O({msg:"     .",type:"success"})}}else Y?(_o(Y),We.mode==="POLICY"&&t({policyFile:{id:`policy-${Date.now()}`,name:T.name,data:m,type:T.type}})):O({msg:Cr,type:"info"})}catch(m){console.error(m),O({msg:Cr,type:"info"})}finally{F(!1),hn(null),Qt(null),f.target.value=""}},Fi=()=>{const{policyPeriodStart:f,policyPeriodEnd:T,retroStart:K,retroEnd:ee}=e;if(!f&&!T&&!K&&!ee){O({msg:"    .  POLCY .",type:"info"});return}const de=Kh(e.content["Insurance Coverage"],f,T,K,ee);tn("Insurance Coverage",de),O({msg:"   .",type:"success"})},Bi=!!(e.policyPeriodStart||e.policyPeriodEnd||e.retroStart||e.retroEnd),$i=async f=>{if(e.odakanitNo)try{const ee=await Xe.getLatestSheetForCase(e.odakanitNo);if(ee&&ee.lineItems&&ee.lineItems.length>0){const de=Xe.buildCumulativeExpensesSnapshot(ee.sheet.id,new Date().toISOString());if(!de)return;const{effectiveSheet:d,allLines:m,opts:x}=de,{text:k}=Lh(d,m,x),{html:v}=ri(d,m,x);if(tn(f,k),ee.attachments&&ee.attachments.length){const $=e.invoiceFiles||[],B=Math.max(0,4-$.length);if(B>0){const Y=ee.attachments.slice(0,B).map((oe,we)=>{const[ye,Ve]=oe.fileKey.split(",");let Je=oe.mimeType||"application/octet-stream";if(ye&&ye.startsWith("data:")){const ct=ye.match(/^data:(.*?);base64$/);ct&&ct[1]&&(Je=ct[1])}const Qe=Ve||oe.fileKey;return{id:`fes-inv-${oe.id}-${we}`,name:oe.originalFileName,data:Qe,type:Je}});if(Y.length){const oe=[...$,...Y],we=oe.length>0,Ve=en&&e.status==="WAITING_FOR_INVOICES"&&we?"TASK_ASSIGNED":e.status;t({invoiceFiles:oe,isWaitingForInvoices:!we,status:Ve,expensesSheetId:ee.sheet.id,expensesSnapshotAt:ee.sheet.updatedAt||new Date().toISOString(),expensesHtml:v||e.expensesHtml})}}}O({msg:"Expenses Table was inserted into the EXPENSES section.",type:"success"});return}}catch(ee){Yu("Failed to load Expenses Table for report",ee)}const T=e.expenseWorksheet;if(!T||!T.rows||T.rows.length===0){O({msg:"    .",type:"info"});return}if(T.status!=="LOCKED"){O({msg:'       ".',type:"info"});return}const K=Xi(T);tn(f,K),O({msg:'   ".',type:"success"})},Hi=()=>{u&&(u(),O({msg:"    .",type:"success"}))},Ui=async()=>{if(!Ie){$e(!0);try{const f=await nN(e.content||{},a.role),T=f.issues||[];Ee(T);const K=f.runAt||new Date().toISOString();Ke(K),t({toneRiskLastRunAt:K}),it(f.meta||null),T.length?O({msg:"     .",type:"info"}):O({msg:"   Tone & Risk .",type:"success"})}catch(f){console.error("Tone & Risk check failed",f),O({msg:" Tone & Risk        .",type:"error"})}finally{$e(!1)}}},Wi=()=>{Ee([]),Ke(null),it(null),se(null)},zi=(f,T)=>{if(!f||!T)return!1;const K=/(\d{1,2}\/\d{1,2}\/\d{2,4}|\d+(?:\.\d+)?%?)/g,ee=[];let de;for(;(de=K.exec(f))!==null;)de[0]&&ee.push(de[0]);return ee.length?ee.some(d=>!T.includes(d)):!1},Vi=f=>{var de,d;if(!f.suggestion)return;const T=f.sectionKey,K=e.content[T]||"";if(!K||!f.excerpt||!K.includes(f.excerpt)){(de=navigator.clipboard)==null||de.writeText(f.suggestion).catch(()=>{}),O({msg:"    .   .",type:"info"});return}if(zi(f.excerpt,f.suggestion)){(d=navigator.clipboard)==null||d.writeText(f.suggestion).catch(()=>{}),O({msg:"    /      .",type:"info"});return}se({sectionKey:T,prevText:K});const ee=K.replace(f.excerpt,f.suggestion);tn(T,ee)},Ki=()=>{if(!q)return;const{sectionKey:f,prevText:T}=q;tn(f,T),se(null),O({msg:"  .",type:"info"})},Yi=async()=>{if(!Ie){he(!0);try{const f=await sN(e.content||{},a.role),T=f.issues||[];if(re(T),je(f.runAt||new Date().toISOString()),f.success===!1){O({msg:"    .    .",type:"info"});return}T.length?O({msg:"       .",type:"info"}):O({msg:"     .",type:"success"})}catch(f){console.error("Hebrew style review failed",f),O({msg:"    .    .",type:"info"})}finally{he(!1)}}},Gi=(f,T)=>{if(Ie||V)return;const K=Ti(T.body),ee=e.content[f]||"";tn(f,ee?`${ee}

${K}`:K),ae(null);const de=yv(a.id,T.id);De(de)},ya=async f=>{try{await navigator.clipboard.writeText(f.body),O({msg:"  .",type:"info"})}catch{O({msg:"     ",type:"warning"})}},Na=f=>{var m;if(!f.suggestion)return;const T=f.sectionKey,K=e.content[T]||"",ee=f.excerpt;if(!(ee&&K.includes(ee))){(m=navigator.clipboard)==null||m.writeText(f.suggestion).catch(()=>{}),O({msg:"    .   .",type:"info"});return}const d=K.replace(ee,f.suggestion);tn(T,d)},Ir=f=>Z.filter(T=>T.sectionKey===f&&T.isEnabled!==!1).sort((T,K)=>{const ee=T.label==="LLOYDS_RECOMMENDED"?0:1,de=K.label==="LLOYDS_RECOMMENDED"?0:1;if(ee!==de)return ee-de;const d=T.usageCount||0;return(K.usageCount||0)-d}),Po=f=>{if(a.role!=="ADMIN")return;const T=A.current[f],K=T==null?void 0:T.current;if(!K){O({msg:"     .",type:"error"});return}const ee=K.selectionStart??0,de=K.selectionEnd??0;if(ee===de){O({msg:"     -Best Practice.",type:"info"});return}const m=(e.content[f]||"").slice(ee,de).trim();if(!m){O({msg:"    .",type:"info"});return}z({sectionKey:f,body:m})},qi=async({title:f,label:T,tags:K,behavior:ee})=>{if(!jt)return;const de=new Date().toISOString(),d={id:"",sectionKey:jt.sectionKey,title:f,body:jt.body,label:T,tags:K.length?K:void 0,isEnabled:!0,createdByUserId:a.id,createdAt:de,updatedAt:de,usageCount:0,lastUsedAt:null,behavior:ee};try{const m=await fp(d,a.role);Ne(m),O({msg:"Best Practice  .",type:"success"})}catch(m){console.error("Failed to save best practice",m),O({msg:" -Best Practice .",type:"error"})}z(null)},ba=()=>{z(null)},Fo=async(f,T)=>{if(Ie)return;const K=e.content[f]||"",ee=K?`${K}

${T.body}`:T.body;tn(f,ee);try{const de=await xp(T.id,"INSERT",a.role);Ne(de)}catch(de){console.error("Failed to record best practice usage (insert)",de)}},va=async f=>{var T;(T=navigator.clipboard)==null||T.writeText(f.body).catch(()=>{});try{const K=await xp(f.id,"COPY",a.role);Ne(K)}catch(K){console.error("Failed to record best practice usage (copy)",K)}O({msg:"  .",type:"info"})},Tr=async(f,T)=>{const K=Z.find(de=>de.id===f);if(!K)return;const ee={...K,...T,updatedAt:new Date().toISOString()};try{const de=await fp(ee,a.role);Ne(de)}catch(de){console.error("Failed to update best practice",de),O({msg:" -Best Practice .",type:"error"})}},Bo=async f=>{try{const T=await aN(f,a.role);Ne(T)}catch(T){console.error("Failed to delete best practice",T),O({msg:" -Best Practice .",type:"error"})}},$o=async(f,T)=>{try{const K=await oN(f,T,a.role);Ne(K)}catch(K){console.error("Failed to toggle best practice enabled",K),O({msg:"  -Best Practice .",type:"error"})}},Xi=f=>{const T=f.rows.filter(d=>d.type==="EXPENSE"),K=f.rows.filter(d=>d.type==="ADJUSTMENT"),ee=T.map(d=>` ${d.label}${d.serviceProvider?` (${d.serviceProvider})`:""}  ${d.amount.toLocaleString()}`),de=K.map(d=>` ${d.label}  ${d.amount.toLocaleString()}`);return["     ","",":",ee.length?ee.join(`
`):"   ",""," / :",de.length?de.join(`
`):"  ","",`" : ${f.totals.totalExpenses.toLocaleString()}`,`" : ${f.totals.totalAdjustments.toLocaleString()}`,` : ${f.totals.totalBalance.toLocaleString()}`].join(`
`)};return n.jsxs(n.Fragment,{children:[n.jsx("input",{type:"file",ref:fs,className:"hidden",accept:".pdf,.doc,.docx,.txt,.jpg,.jpeg,.png,application/pdf,application/msword,application/vnd.openxmlformats-officedocument.wordprocessingml.document,text/plain,image/*",onChange:Mo}),n.jsxs("div",{className:"space-y-6",children:[n.jsxs("div",{className:"flex flex-wrap justify-between items-center gap-2",children:[n.jsxs("button",{onClick:s,className:"flex items-center text-sm text-textMuted bg-navySecondary px-3 py-1.5 rounded-full hover:bg-borderDark",children:[n.jsx(Ql,{className:"w-4 h-4 mr-1"}),"   1"]}),n.jsxs("div",{className:"flex items-center gap-3",children:[a.role==="ADMIN"&&(c||i)&&n.jsxs("div",{className:"flex flex-col items-end gap-1",children:[c&&n.jsx("button",{onClick:c,disabled:!Dt||h,className:`flex items-center text-sm px-3 py-1.5 rounded-full transition ${Dt&&!h?"text-indigo-700 bg-indigo-50 hover:bg-indigo-100":"text-slate-400 bg-slate-100 cursor-not-allowed"}`,children:h?n.jsxs(n.Fragment,{children:[n.jsx(Bt,{className:"w-4 h-4 mr-1 animate-spin"})," ..."]}):n.jsxs(n.Fragment,{children:[n.jsx(O0,{className:"w-4 h-4 mr-1"})," Auto-Translate"]})}),i&&n.jsx("button",{onClick:i,disabled:!e.isTranslated||!xa||!!S,className:`flex items-center text-sm px-3 py-1.5 rounded-full transition ${e.isTranslated&&xa&&!S?"text-emerald-700 bg-emerald-50 hover:bg-emerald-100":"text-slate-400 bg-slate-100 cursor-not-allowed"}`,children:S?n.jsxs(n.Fragment,{children:[n.jsx(Bt,{className:"w-4 h-4 mr-1 animate-spin"})," Improving..."]}):n.jsx(n.Fragment,{children:"Improve English"})}),c&&!Dt&&!h&&n.jsx("p",{className:"text-[11px] text-textMuted",children:"      ."}),e.translationStale&&n.jsx("p",{className:"text-[11px] text-amber-700 max-w-xs text-right",children:" :      ,      ."}),h&&n.jsx("p",{className:"text-[11px] text-indigo-600",children:"      ."})]}),a.role==="ADMIN"&&Zt&&n.jsxs("div",{className:"flex flex-col items-end gap-1 text-[11px] text-textLight",children:[n.jsx("span",{className:"font-semibold",children:"  "}),n.jsxs("div",{className:"inline-flex rounded-full border border-borderDark overflow-hidden bg-panel",children:[n.jsx("button",{type:"button",onClick:()=>_t("DUAL"),className:`px-3 py-1 ${Ct==="DUAL"?"bg-slate-800 text-white":"bg-panel text-textLight hover:bg-slate-100"} text-[11px]`,children:" + "}),n.jsx("button",{type:"button",onClick:()=>_t("ENGLISH_ONLY"),className:`px-3 py-1 border-r border-borderDark ${Ct==="ENGLISH_ONLY"?"bg-slate-800 text-white":"bg-panel text-textLight hover:bg-slate-100"} text-[11px]`,children:" "})]})]}),a.role==="ADMIN"&&u&&n.jsxs("button",{onClick:Hi,className:"flex items-center text-sm text-purple-700 bg-purple-50 px-3 py-1.5 rounded-full hover:bg-purple-100",children:[n.jsx(_u,{className:"w-4 h-4 mr-1"})," Format Text"]}),n.jsxs("button",{onClick:o,className:"flex items-center text-sm text-lpBlue bg-blue-50 px-3 py-1.5 rounded-full hover:bg-blue-100",children:[n.jsx(Lu,{className:"w-4 h-4 mr-1"}),"  "]})]})]}),j&&n.jsxs("div",{className:"flex items-center justify-end gap-2 text-[11px] text-indigo-600",children:[n.jsx(Bt,{className:"w-3 h-3 animate-spin"}),n.jsx("span",{children:"   ,     "})]}),L&&n.jsx(Sv,{message:L.msg,type:L.type,onClose:()=>O(null)}),n.jsxs("div",{className:"flex items-center justify-between gap-2",children:[n.jsx("h2",{className:"text-2xl font-bold text-lpBlue font-serif",children:"2. Draft Content"}),!Ie&&P&&n.jsxs("button",{type:"button",onClick:()=>P(),className:"flex items-center text-[11px] px-3 py-1.5 rounded-full bg-indigo-50 text-indigo-800 border border-indigo-200 hover:bg-indigo-100",title:"         (  ).",children:[n.jsx(oa,{className:"w-3 h-3 ml-1"})," "]})]}),!Ie&&n.jsxs("div",{className:"mb-3 mt-1 space-y-1",children:[n.jsxs("div",{className:"flex items-center justify-between gap-2",children:[n.jsx("div",{className:"flex items-center gap-2",children:n.jsx("span",{className:"text-[11px] font-semibold text-textMuted",children:"  "})}),Pe&&n.jsxs("div",{className:"text-[11px] text-textMuted",children:[" Tone & Risk :"," ",new Date(Pe).toLocaleString("he-IL",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"})]})]}),n.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[n.jsx("button",{type:"button",onClick:Yi,disabled:Q,title:"        .        .",className:`flex items-center text-sm font-semibold px-4 py-2 rounded-lg border ${Q?"bg-slate-100 text-slate-400 border-borderDark cursor-not-allowed":"bg-blue-500/20 text-blue-200 border-blue-400/60 hover:bg-blue-500/30"}`,children:Q?n.jsxs(n.Fragment,{children:[n.jsx(Bt,{className:"w-4 h-4 mr-1.5 animate-spin"}),"   ..."]}):n.jsx(n.Fragment,{children:"  ( )"})}),C.length>0&&n.jsxs("button",{type:"button",onClick:()=>{const f=document.getElementById("hebrew-style-panel");f&&f.scrollIntoView({behavior:"smooth",block:"start"})},className:"inline-flex items-center text-xs font-medium px-2.5 py-1 rounded-full bg-blue-500/20 text-blue-200 border border-blue-400/60 hover:bg-blue-500/30",children:[" ",C.length>1&&` (${C.length})`]}),n.jsx("button",{type:"button",onClick:Ui,disabled:ve,title:"         .        .",className:`flex items-center text-sm font-semibold px-4 py-2 rounded-lg border ${ve?"bg-slate-100 text-slate-400 border-borderDark cursor-not-allowed":"bg-amber-500/20 text-amber-200 border-amber-400/60 hover:bg-amber-500/30"}`,children:ve?n.jsxs(n.Fragment,{children:[n.jsx(Bt,{className:"w-4 h-4 mr-1.5 animate-spin"}),"  Tone & Risk..."]}):n.jsx(n.Fragment,{children:" Tone & Risk ()"})}),fe.length>0&&n.jsx("button",{type:"button",onClick:Wi,className:"text-[11px] text-textMuted hover:text-textLight underline",children:"  Tone & Risk"})]}),n.jsxs("div",{className:"flex flex-wrap items-center gap-4 text-[11px] text-textMuted",children:[Fe&&!C.length&&!Q&&n.jsx("span",{children:"  ."}),Pe&&!fe.length&&!ve&&n.jsx("span",{children:"  Tone & Risk."})]})]}),!Ie&&fe.length>0&&n.jsxs("div",{id:"tone-risk-panel",className:"mb-4 border border-amber-200 bg-amber-50 rounded-md p-3 text-xs space-y-2",children:[n.jsxs("div",{className:"flex items-center justify-between gap-2 mb-1",children:[n.jsxs("div",{className:"font-semibold text-amber-900",children:[" ",fe.length,"  Tone & Risk"]}),q&&n.jsx("button",{type:"button",onClick:Ki,className:"text-[11px] text-textMuted hover:text-textLight underline",children:"  "})]}),Ye&&n.jsxs("div",{className:"text-[11px] text-textMuted",children:[" ",Ye.sectionsSent,"  |  : ",Ye.charsBefore," |  : ",Ye.charsAfter,Ye.truncatedSections>0&&n.jsxs("span",{className:"ml-2 text-amber-700",children:["      (",Ye.truncatedSections,")"]})]}),n.jsx("div",{className:"space-y-2 max-h-60 overflow-y-auto",children:fe.map(f=>n.jsxs("div",{className:"bg-panel border border-amber-200 rounded px-2 py-2 space-y-1",children:[n.jsx("div",{className:"flex items-center justify-between gap-2",children:n.jsxs("div",{className:"flex items-center gap-1",children:[n.jsx("span",{className:"inline-flex items-center rounded-full px-2 py-0.5 text-[10px] font-semibold bg-slate-100 text-textLight",children:f.sectionKey||"Unknown section"}),n.jsx("span",{className:`inline-flex items-center rounded-full px-2 py-0.5 text-[10px] font-semibold ${f.severity==="CRITICAL"?"bg-red-100 text-red-700":f.severity==="WARNING"?"bg-amber-100 text-amber-700":"bg-slate-100 text-textMuted"}`,children:f.severity}),n.jsx("span",{className:"inline-flex items-center rounded-full px-2 py-0.5 text-[10px] bg-indigo-50 text-indigo-700 font-mono",children:f.kind})]})}),n.jsxs("div",{className:"text-[11px] text-textLight",children:[n.jsx("span",{className:"font-semibold",children:":"})," ",n.jsxs("span",{className:"italic",children:['"',f.excerpt,'"']})]}),n.jsxs("div",{className:"text-[11px] text-textLight",children:[n.jsx("span",{className:"font-semibold",children:":"})," ",f.message]}),f.suggestion&&n.jsxs("div",{className:"text-[11px] text-textLight",children:[n.jsx("span",{className:"font-semibold",children:" :"})," ",n.jsx("span",{className:"whitespace-pre-wrap",children:f.suggestion})]}),n.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[f.suggestion&&n.jsxs(n.Fragment,{children:[n.jsx("button",{type:"button",onClick:()=>{var T;return(T=navigator.clipboard)==null?void 0:T.writeText(f.suggestion||"").catch(()=>{})},className:"px-2 py-0.5 rounded border border-borderDark text-[11px] text-textLight hover:bg-slate-100",children:"  "}),n.jsx("button",{type:"button",onClick:()=>Vi(f),className:"px-2 py-0.5 rounded border border-emerald-300 text-[11px] text-emerald-700 hover:bg-emerald-50",children:" "})]}),n.jsx("button",{type:"button",onClick:()=>re(T=>T.filter(K=>K.id!==f.id)),className:"px-2 py-0.5 rounded border border-borderDark text-[11px] text-textMuted hover:bg-slate-100 ml-auto",children:""})]})]},f.id))})]}),!Ie&&C.length>0&&n.jsxs("div",{id:"hebrew-style-panel",className:"mb-4 border border-blue-200 bg-blue-50 rounded-md p-3 text-xs space-y-2",children:[n.jsxs("div",{className:"flex items-center justify-between gap-2 mb-1",children:[n.jsxs("div",{className:"font-semibold text-blue-900",children:[" ",C.length,"   "]}),Fe&&n.jsxs("div",{className:"text-[11px] text-textMuted",children:[" :"," ",new Date(Fe).toLocaleString("he-IL",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"})]})]}),n.jsx("div",{className:"space-y-2 max-h-60 overflow-y-auto",children:C.map(f=>{const T=e.content[f.sectionKey]||"",K=!!f.suggestion&&!!f.excerpt&&T.includes(f.excerpt);return n.jsxs("div",{className:"bg-panel border border-blue-200 rounded px-2 py-2 space-y-1",children:[n.jsx("div",{className:"flex items-center justify-between gap-2",children:n.jsxs("div",{className:"flex items-center gap-1",children:[n.jsx("span",{className:"inline-flex items-center rounded-full px-2 py-0.5 text-[10px] font-semibold bg-slate-100 text-textLight",children:f.sectionKey||"Unknown section"}),n.jsx("span",{className:`inline-flex items-center rounded-full px-2 py-0.5 text-[10px] font-semibold ${f.severity==="CRITICAL"?"bg-red-100 text-red-700":f.severity==="WARNING"?"bg-amber-100 text-amber-700":"bg-slate-100 text-textMuted"}`,children:f.severity}),n.jsx("span",{className:"inline-flex items-center rounded-full px-2 py-0.5 text-[10px] bg-blue-50 text-blue-700 font-mono",children:f.category})]})}),n.jsxs("div",{className:"text-[11px] text-textLight",children:[n.jsx("span",{className:"font-semibold",children:":"})," ",n.jsxs("span",{className:"italic",children:['"',f.excerpt,'"']})]}),n.jsxs("div",{className:"text-[11px] text-textLight",children:[n.jsx("span",{className:"font-semibold",children:":"})," ",f.message]}),f.suggestion&&n.jsxs("div",{className:"text-[11px] text-textLight",children:[n.jsx("span",{className:"font-semibold",children:" :"})," ",n.jsx("span",{className:"whitespace-pre-wrap",children:f.suggestion})]}),f.suggestion&&n.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[n.jsx("button",{type:"button",onClick:()=>{var ee;return(ee=navigator.clipboard)==null?void 0:ee.writeText(f.suggestion||"").catch(()=>{})},className:"px-2 py-0.5 rounded border border-borderDark text-[11px] text-textLight hover:bg-slate-100",children:" "}),K&&n.jsx("button",{type:"button",onClick:()=>Na(f),className:"px-2 py-0.5 rounded border border-emerald-300 text-[11px] text-emerald-700 hover:bg-emerald-50",children:" "})]})]},f.id)})})]}),Ie&&n.jsxs("div",{className:"bg-orange-100 border-l-4 border-orange-500 p-4 text-orange-800",children:[n.jsxs("p",{className:"font-bold flex items-center",children:[n.jsx($0,{className:"w-5 h-5 mr-2"})," Restricted Access Mode"]}),n.jsxs("p",{className:"text-sm",children:["You are logged in as ",a.role,". You can only modify the Invoice Attachments in the Expenses section."]})]}),e.financeInstructions&&n.jsx("div",{className:"bg-red-50 border-l-4 border-red-600 p-4 shadow-md rounded-r-lg animate-pulse-slow",children:n.jsxs("div",{className:"flex items-start",children:[n.jsx("div",{className:"flex-shrink-0",children:n.jsx(qa,{className:"h-5 w-5 text-red-600"})}),n.jsxs("div",{className:"ml-3 w-full",children:[n.jsx("h3",{className:"text-sm font-bold text-red-800",children:"Instruction from Finance"}),n.jsx("div",{className:"mt-2 text-sm text-red-700 whitespace-pre-wrap",children:e.financeInstructions}),e.expensesSourceFile&&n.jsxs("div",{className:"mt-4 pt-2 border-t border-red-200",children:[n.jsx("p",{className:"text-xs font-bold text-red-800 mb-1",children:"Attached Expenses Source File (Word/Excel):"}),n.jsxs("div",{className:"flex items-center bg-panel p-2 rounded border border-red-200 max-w-md",children:[n.jsx(yo,{className:"w-4 h-4 text-blue-600 mr-2"}),n.jsx("span",{className:"text-sm text-textLight flex-1",children:e.expensesSourceFile.name}),n.jsx("a",{href:`data:${e.expensesSourceFile.type};base64,${e.expensesSourceFile.data}`,download:e.expensesSourceFile.name,className:"text-xs bg-blue-100 text-blue-700 px-2 py-1 rounded hover:bg-blue-200 font-bold",children:"Download"})]})]})]})]})}),at&&n.jsxs("div",{className:"bg-amber-50 border-l-4 border-amber-500 p-4 shadow rounded-r-lg flex gap-3 items-start",children:[n.jsx(qa,{className:"w-5 h-5 text-amber-600 mt-1"}),n.jsxs("div",{children:[n.jsx("p",{className:"font-bold text-amber-900",children:"    "}),n.jsx("p",{className:"text-sm text-amber-800",children:"  /   .              ."})]})]}),n.jsx(uN,{report:e,currentUser:a,onSubmitToAdmin:()=>p&&p(),onApproveHebrew:()=>y&&y(),onRequestChanges:f=>b&&b(f),onMarkIssueDone:f=>w&&w(f),onAddExternalFeedbackIssues:(f,T)=>R&&R(f,T),onReopenHebrewDueToExternalFeedback:()=>E&&E()}),n.jsx("div",{className:"space-y-8",children:e.selectedSections.map(f=>{var d,m,x,k;const T=Dd(f,(d=e.expertSummaryMode)==null?void 0:d[f]),K=/expert/i.test(T),ee=fe.filter(v=>v.sectionKey===f).length,de=C.filter(v=>v.sectionKey===f).length;return n.jsxs("div",{className:`bg-panel p-6 rounded-lg shadow-sm border transition-all ${Ie&&!f.includes("Expenses")?"opacity-60 pointer-events-none border-gray-100":"border-borderDark"}`,onClick:v=>{if(!U||typeof f!="string"||!f.trim())return;const _=v.target;!_||_.closest('button, a, input, textarea, select, svg, [role="button"]')||U(f)},children:[n.jsxs("div",{className:"flex justify-between items-center mb-3 pb-3 border-b border-gold/30",children:[n.jsxs("div",{className:"flex flex-col gap-1",children:[n.jsx("h3",{className:"font-bold text-xl text-gold uppercase tracking-wider border-r-2 border-gold/50 pr-2",children:T}),f.includes("Expenses")&&e.expensesSnapshotAt&&n.jsxs("p",{className:"text-[11px] text-textMuted",children:["Based on the latest Expenses Table as of"," ",new Date(e.expensesSnapshotAt).toLocaleString("en-GB",{day:"2-digit",month:"short",year:"numeric",hour:"2-digit",minute:"2-digit"}),"."]}),!f.includes("Expenses")&&(de>0||ee>0)&&n.jsxs("div",{className:"flex flex-wrap gap-1 text-[10px]",children:[de>0&&n.jsxs("button",{type:"button",onClick:()=>{const v=document.getElementById("hebrew-style-panel");v&&v.scrollIntoView({behavior:"smooth",block:"start"})},className:"inline-flex items-center rounded-full px-2 py-0.5 bg-blue-50 text-blue-800 border border-blue-200 hover:bg-blue-100",children:[" ",de>1&&` (${de})`]}),ee>0&&n.jsxs("button",{type:"button",onClick:()=>{const v=document.getElementById("tone-risk-panel");v&&v.scrollIntoView({behavior:"smooth",block:"start"})},className:"inline-flex items-center rounded-full px-2 py-0.5 bg-amber-50 text-amber-800 border border-amber-200 hover:bg-amber-100",children:[" Tone & Risk",ee>1&&` (${ee})`]})]})]}),!Ie&&n.jsxs("div",{className:"flex items-center gap-2",children:[!f.includes("Expenses")&&n.jsx("button",{className:"inline-flex items-center px-2.5 py-2 rounded-lg border border-borderDark hover:border-gold/50 hover:bg-gold/10 text-textMuted hover:text-goldLight transition",disabled:j,onClick:()=>{Ar({mode:"SECTION",section:f,analysisType:ki(f)})},title:"   ",children:xn===f?n.jsx(Bt,{className:"w-4 h-4 animate-spin"}):n.jsx(F0,{className:"w-4 h-4"})}),K&&n.jsx("button",{className:"inline-flex items-center px-2.5 py-2 rounded-lg border border-borderDark hover:border-gold/50 hover:bg-gold/10 text-textMuted hover:text-goldLight transition",disabled:j,onClick:()=>{Ar({mode:"SECTION",section:f,analysisType:"EXPERT",domain:"dental"})},title:"     ",children:xn===f&&(We==null?void 0:We.domain)==="dental"?n.jsx(Bt,{className:"w-4 h-4 animate-spin"}):n.jsx("span",{className:"text-lg leading-none",children:""})}),f.includes("Expenses")&&Ds&&n.jsx("button",{onClick:()=>$i(f),className:"p-1.5 hover:bg-green-50 rounded text-textMuted hover:text-green-600",title:"   ",children:n.jsx(uh,{className:"w-4 h-4"})}),!f.includes("Expenses")&&n.jsxs(n.Fragment,{children:[f==="Strategy"&&!Ie&&n.jsx("button",{onClick:Oo,className:"px-3 py-1 text-xs font-semibold text-blue-700 bg-blue-50 border border-blue-200 rounded-full hover:bg-blue-100",children:" "}),n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsxs("button",{onClick:()=>Li(f),className:"inline-flex items-center px-4 py-2 rounded-lg text-sm font-semibold text-white bg-purple-600 hover:bg-purple-500 border border-purple-500/50 transition",title:"      ,     .     .",children:[Cs===f?n.jsx(Bt,{className:"w-4 h-4 mr-1.5 animate-spin"}):n.jsx(H0,{className:"w-4 h-4 mr-1.5"}),"  "]}),n.jsxs("div",{className:"flex rounded-full border border-purple-200 overflow-hidden text-[10px] bg-panel",title:"    ",children:[n.jsx("button",{type:"button",onClick:()=>et("SAFE_POLISH"),className:`px-2 py-0.5 ${Te==="SAFE_POLISH"?"bg-purple-100 text-purple-800":"text-purple-500 hover:bg-purple-50"}`,children:" "}),n.jsx("button",{type:"button",onClick:()=>et("REWRITE"),className:`px-2 py-0.5 border-l border-purple-100 ${Te==="REWRITE"?"bg-purple-100 text-purple-800":"text-purple-500 hover:bg-purple-50"}`,children:" "})]})]}),f==="Insurance Coverage"&&Bi&&n.jsx("button",{onClick:Fi,className:"p-1.5 hover:bg-blue-50 rounded text-textMuted hover:text-blue-600",title:"Auto-fill policy data",children:n.jsx(V0,{className:"w-4 h-4"})})]}),Ge&&Ge.sectionKey===f&&Ge.changedWords>0&&Ge.expiresAt>Date.now()&&n.jsxs("div",{className:"mt-1 text-[11px] text-textMuted bg-purple-50/40 border border-purple-100 rounded px-2 py-1",children:[n.jsxs("div",{className:"flex items-center justify-between gap-2",children:[n.jsxs("span",{children:["  ",Ge.changedWords,"   ."]}),n.jsx("button",{type:"button",className:"underline text-purple-700 hover:text-purple-900",onClick:()=>He(v=>v&&v.sectionKey===f?{...v,open:!v.open}:v),children:Ge.open?" ":" "})]}),Ge.open&&n.jsx("div",{className:"mt-1 text-[11px] text-textLight whitespace-pre-wrap leading-relaxed",children:Ge.tokens.map((v,_)=>v.type==="same"?` ${v.text}`:v.type==="add"?` [+${v.text}+]`:` [-${v.text}-]`)})]}),Er(f).length>0&&n.jsxs("button",{onClick:()=>Ci(f),className:"flex items-center gap-1 px-2 py-1 rounded text-xs font-bold bg-navySecondary text-textMuted border hover:bg-yellow-50",children:[n.jsx(oa,{className:"w-3 h-3"})," Ideas"]}),a.role==="ADMIN"&&n.jsxs("div",{className:"flex items-center gap-1",children:[n.jsx("button",{type:"button",onClick:()=>Di(f),className:"px-2 py-1 rounded text-[11px] border border-dashed border-borderDark text-textMuted hover:bg-slate-50",children:"Save selection as template"}),n.jsx("button",{type:"button",onClick:()=>Po(f),className:"px-2 py-1 rounded text-[11px] border border-dashed border-emerald-300 text-emerald-700 hover:bg-emerald-50",children:"Save selection as Best Practice"})]})]})]}),f==="Update"&&Ei(e)&&n.jsxs("div",{className:"mb-3 text-xs text-textLight",children:[n.jsx("span",{className:"block mb-1 font-semibold",children:"    ()"}),n.jsxs("div",{className:"flex flex-wrap gap-2",children:[n.jsx("button",{type:"button",className:"px-3 py-1 rounded-full border border-borderDark bg-navySecondary hover:bg-navySecondary text-[11px] font-semibold text-textLight",onClick:()=>{const v=Pp.SOC,_=e.content.Update||"",$=v.split(`
`)[0];if(_.trimStart().startsWith($))return;const Y=_.trim().length>0?`${v}

${_.trimStart()}`:v;tn("Update",Y)},children:"  (Statement of Claim)"}),n.jsx("button",{type:"button",className:"px-3 py-1 rounded-full border border-borderDark bg-navySecondary hover:bg-navySecondary text-[11px] font-semibold text-textLight",onClick:()=>{const v=Pp.LOD,_=e.content.Update||"",$=v.split(`
`)[0];if(_.trimStart().startsWith($))return;const Y=_.trim().length>0?`${v}

${_.trimStart()}`:v;tn("Update",Y)},children:"  (Letter of Demand)"})]})]}),G===f&&!Ie&&n.jsxs("div",{className:"mb-4 p-3 bg-yellow-50 rounded border border-yellow-200",children:[n.jsxs("div",{className:"flex items-center justify-between gap-2 mb-2",children:[n.jsxs("div",{className:"flex items-center gap-2 text-[11px]",children:[n.jsx("button",{type:"button",className:`px-2 py-1 rounded-full border ${xe==="TEMPLATES"?"bg-panel border-yellow-400 text-yellow-800 font-semibold":"bg-yellow-100/60 border-yellow-200 text-yellow-700"}`,onClick:()=>be("TEMPLATES"),children:"Templates"}),n.jsx("button",{type:"button",className:`px-2 py-1 rounded-full border ${xe==="BEST_PRACTICES"?"bg-panel border-emerald-400 text-emerald-800 font-semibold":"bg-emerald-50/70 border-emerald-200 text-emerald-700"}`,onClick:()=>be("BEST_PRACTICES"),children:"Best Practices"}),n.jsx("button",{type:"button",className:`px-2 py-1 rounded-full border ${xe==="MY_SNIPPETS"?"bg-panel border-sky-400 text-sky-800 font-semibold":"bg-sky-50/70 border-sky-200 text-sky-700"}`,onClick:()=>be("MY_SNIPPETS"),children:" "})]}),xe==="TEMPLATES"&&n.jsx("input",{type:"text",className:"flex-1 border border-yellow-300 rounded px-2 py-1 text-xs",placeholder:"Search templates",value:I,onChange:v=>D(v.target.value)}),xe==="BEST_PRACTICES"&&n.jsx("input",{type:"text",className:"flex-1 border border-emerald-300 rounded px-2 py-1 text-xs",placeholder:"Search best practices",value:Oe,onChange:v=>Ce(v.target.value)}),xe==="MY_SNIPPETS"&&n.jsx("input",{type:"text",className:"flex-1 border border-sky-300 rounded px-2 py-1 text-xs",placeholder:"  ",value:Me,onChange:v=>pe(v.target.value)}),a.role==="ADMIN"&&xe==="TEMPLATES"&&n.jsx("button",{type:"button",onClick:()=>{le(f),ue(!0)},className:"text-[11px] px-2 py-1 rounded bg-panel text-textLight border border-borderDark hover:bg-slate-50",children:"Manage templates"}),a.role==="ADMIN"&&xe==="BEST_PRACTICES"&&n.jsx("button",{type:"button",onClick:()=>{nt(f),dt(!0)},className:"text-[11px] px-2 py-1 rounded bg-panel text-textLight border border-borderDark hover:bg-slate-50",children:"Manage best practices"}),xe==="MY_SNIPPETS"&&n.jsx("button",{type:"button",onClick:()=>{st(!0),Be(null)},className:"text-[11px] px-2 py-1 rounded bg-panel text-textLight border border-borderDark hover:bg-slate-50",children:" "})]}),n.jsx("div",{className:"grid grid-cols-1 gap-2 max-h-60 overflow-y-auto text-xs",children:xe==="TEMPLATES"?(()=>{const v=Er(f),_=I.trim().toLowerCase(),$=_?v.filter(B=>B.title.toLowerCase().includes(_)||B.body.toLowerCase().includes(_)):v;return $.length?$.map(B=>{const Y=B.body.length>160?`${B.body.slice(0,160)}`:B.body;return n.jsxs("div",{className:"flex items-center gap-2 bg-panel border border-yellow-100 rounded px-2 py-2 hover:bg-yellow-100 cursor-pointer",onClick:()=>xs(f,B),children:[n.jsxs("div",{className:"flex-1 min-w-0 text-right",children:[n.jsx("div",{className:"font-semibold text-textLight truncate",children:B.title}),n.jsx("div",{className:"text-[11px] text-textMuted max-h-10 overflow-hidden whitespace-pre-wrap",children:Y})]}),n.jsx("button",{type:"button",className:"text-[11px] px-2 py-1 rounded bg-yellow-50 text-yellow-800 border border-yellow-200 hover:bg-yellow-100",children:"Insert"})]},B.id)}):n.jsx("p",{className:"text-[11px] text-textMuted",children:"No templates found for this section."})})():xe==="BEST_PRACTICES"?(()=>{const v=Ir(f),_=Oe.trim().toLowerCase(),$=_?v.filter(B=>{const Y=(B.tags||[]).join(" ").toLowerCase();return B.title.toLowerCase().includes(_)||B.body.toLowerCase().includes(_)||Y.includes(_)}):v;return $.length?$.map(B=>{const Y=B.body.length>160?`${B.body.slice(0,160)}`:B.body,oe=B.behavior!=="COPY_ONLY";return n.jsxs("div",{className:"flex items-center gap-2 bg-panel border border-emerald-100 rounded px-2 py-2 hover:bg-emerald-50 cursor-default",children:[n.jsxs("div",{className:"flex-1 min-w-0 text-right",children:[n.jsxs("div",{className:"flex flex-wrap items-center justify-end gap-1 mb-0.5",children:[n.jsx("span",{className:"font-semibold text-textLight truncate",children:B.title}),n.jsx("span",{className:`inline-flex items-center rounded-full px-2 py-0.5 text-[9px] font-semibold ${B.label==="LLOYDS_RECOMMENDED"?"bg-purple-100 text-purple-700":"bg-emerald-100 text-emerald-700"}`,children:B.label==="LLOYDS_RECOMMENDED"?"Lloyds recommended":"Best practice"}),B.tags&&B.tags.length>0&&n.jsx("span",{className:"inline-flex items-center rounded-full px-2 py-0.5 text-[9px] bg-slate-100 text-textLight",children:B.tags.join(", ")})]}),n.jsx("div",{className:"text-[11px] text-textMuted max-h-10 overflow-hidden whitespace-pre-wrap",children:Y})]}),n.jsxs("div",{className:"flex flex-col items-stretch gap-1",children:[oe&&n.jsx("button",{type:"button",onClick:()=>Fo(f,B),className:"text-[11px] px-2 py-0.5 rounded bg-emerald-50 text-emerald-800 border border-emerald-200 hover:bg-emerald-100",children:"Insert"}),n.jsx("button",{type:"button",onClick:()=>va(B),className:"text-[11px] px-2 py-0.5 rounded bg-slate-50 text-textLight border border-borderDark hover:bg-slate-100",children:"Copy"})]})]},B.id)}):n.jsx("p",{className:"text-[11px] text-textMuted",children:"No best practices found for this section."})})():(()=>{const v=Me.trim().toLowerCase(),$=ie.filter(B=>!B.sectionKey||B.sectionKey===f).filter(B=>{if(!v)return!0;const Y=(B.tags||[]).join(" ").toLowerCase();return B.title.toLowerCase().includes(v)||B.body.toLowerCase().includes(v)||Y.includes(v)}).slice().sort((B,Y)=>{const oe=B.lastUsedAt||"",we=Y.lastUsedAt||"";if(oe&&we&&oe!==we)return we.localeCompare(oe);if(oe&&!we)return-1;if(!oe&&we)return 1;const ye=B.updatedAt||B.createdAt;return(Y.updatedAt||Y.createdAt).localeCompare(ye)});return $.length?$.map(B=>{const Y=B.body.length>160?`${B.body.slice(0,160)}`:B.body;return n.jsxs("div",{className:"flex items-center gap-2 bg-panel border border-sky-100 rounded px-2 py-2 hover:bg-sky-50 cursor-default",children:[n.jsxs("div",{className:"flex-1 min-w-0 text-right",children:[n.jsxs("div",{className:"flex flex-wrap items-center justify-end gap-1 mb-0.5",children:[n.jsx("span",{className:"font-semibold text-textLight truncate",children:B.title}),B.tags&&B.tags.length>0&&n.jsx("span",{className:"inline-flex items-center rounded-full px-2 py-0.5 text-[9px] bg-slate-100 text-textLight",children:B.tags.join(", ")})]}),n.jsx("div",{className:"text-[11px] text-textMuted max-h-10 overflow-hidden whitespace-pre-wrap",children:Y})]}),n.jsxs("div",{className:"flex flex-col items-stretch gap-1",children:[n.jsx("button",{type:"button",onClick:()=>Gi(f,B),className:"text-[11px] px-2 py-0.5 rounded bg-sky-50 text-sky-800 border border-sky-200 hover:bg-sky-100 disabled:opacity-50 disabled:cursor-not-allowed",disabled:V,title:V?"       .":void 0,children:""}),n.jsx("button",{type:"button",onClick:()=>ya(B),className:"text-[11px] px-2 py-0.5 rounded bg-slate-50 text-textLight border border-borderDark hover:bg-slate-100",children:""}),n.jsx("button",{type:"button",onClick:()=>{st(!0),Be({id:B.id,title:B.title,sectionKey:B.sectionKey||"",tagsInput:(B.tags||[]).join(", "),body:B.body})},className:"text-[11px] px-2 py-0.5 rounded bg-slate-50 text-textLight border border-borderDark hover:bg-slate-100",children:""}),n.jsx("button",{type:"button",onClick:()=>{if(window.confirm("    ?")){const oe=Op(a.id,B.id);De(oe)}},className:"text-[11px] px-2 py-0.5 rounded bg-red-50 text-red-700 border border-red-200 hover:bg-red-100",children:""})]})]},B.id)}):n.jsx("p",{className:"text-[11px] text-textMuted",children:"   ."})})()})]}),f.includes("Expenses")?n.jsxs("div",{className:"space-y-4",children:[en&&n.jsxs("div",{className:"bg-blue-50 p-4 rounded border border-blue-100 mb-4",children:[n.jsx("h4",{className:"text-sm font-bold text-blue-800 mb-2",children:"Add Expense Item"}),n.jsxs("div",{className:"flex gap-2 flex-wrap",children:[n.jsx("input",{type:"date",className:"border p-2 rounded text-sm",value:ge.date,onChange:v=>_e({...ge,date:v.target.value})}),n.jsx("input",{type:"text",className:"border p-2 rounded text-sm flex-1",placeholder:"Description (e.g. Court Fee)",value:ge.description,onChange:v=>_e({...ge,description:v.target.value})}),n.jsx("input",{type:"number",className:"border p-2 rounded text-sm w-24",placeholder:"Amount",value:ge.amount,onChange:v=>_e({...ge,amount:Number(v.target.value)})}),n.jsx("button",{onClick:Ai,className:"bg-blue-600 text-white px-4 py-2 rounded text-sm font-bold hover:bg-blue-700",children:"Add"})]})]}),en&&n.jsxs("div",{className:"flex items-center justify-between mb-2",children:[n.jsxs("div",{className:"relative text-xs",children:[n.jsxs("button",{className:"flex items-center text-indigo-600 bg-panel px-2 py-1 rounded hover:bg-indigo-50",onClick:()=>rr(Cn===f?null:f),children:[n.jsx(No,{className:"w-3 h-3 mr-1"})," Auto-extract"]}),Cn===f&&n.jsxs("div",{className:"absolute right-0 mt-2 w-44 bg-panel border border-borderDark rounded-lg shadow-lg z-20",children:[n.jsxs("label",{className:"w-full block px-3 py-2 hover:bg-navySecondary cursor-pointer text-right",children:["  ",n.jsx("input",{type:"file",className:"hidden",onChange:v=>{rr(null),Pi(v,f)},accept:".pdf,.jpg,.png"})]}),n.jsx("button",{className:"w-full text-right px-3 py-2 hover:bg-navySecondary",onClick:()=>Ar({mode:"EXPENSES",section:f}),children:"  OCR"})]})]}),j&&n.jsxs("span",{className:"text-xs text-indigo-500 flex items-center",children:[n.jsx(Bt,{className:"w-3 h-3 animate-spin mr-1"}),"   ,     "]})]}),n.jsxs("div",{className:"space-y-2",children:[n.jsxs("div",{className:"flex justify-between items-center bg-indigo-50 p-2 rounded border border-indigo-200",children:[n.jsxs("span",{className:"text-sm font-bold text-indigo-900",children:["Total Extracted: ",e.expensesSum||"0"]}),en&&n.jsx("button",{onClick:()=>t({expensesItems:[],expensesSum:"0"}),className:"text-xs text-red-500 hover:underline",children:"Clear All"})]}),n.jsx("div",{className:"overflow-x-auto border rounded",children:n.jsxs("table",{className:"w-full text-sm border-collapse border-borderDark",children:[n.jsx("thead",{className:"bg-navySecondary",children:n.jsxs("tr",{children:[n.jsx("th",{className:"p-2 text-left text-textMuted",children:"Date"}),n.jsx("th",{className:"p-2 text-left text-textMuted",children:"Description"}),n.jsx("th",{className:"p-2 text-right text-textMuted",children:"Amount"}),!Ie&&n.jsx("th",{className:"p-2 w-8"})]})}),n.jsxs("tbody",{children:[e.expensesItems.length===0&&n.jsx("tr",{children:n.jsx("td",{colSpan:4,className:"p-4 text-center text-gray-400 italic",children:"No expenses added."})}),e.expensesItems.map((v,_)=>n.jsxs("tr",{className:"border-t",children:[n.jsx("td",{className:"p-2",children:v.date}),n.jsx("td",{className:"p-2",children:v.description}),n.jsxs("td",{className:"p-2 text-right",children:[v.amount," ",v.currency]}),en&&n.jsx("td",{className:"p-2 text-center",children:n.jsx("button",{onClick:()=>Ii(v.id),className:"text-red-400 hover:text-red-600",children:n.jsx(Ht,{className:"w-3 h-3"})})})]},_))]})]})}),en&&n.jsx("div",{className:"bg-indigo-50 p-3 rounded border",children:n.jsxs("select",{className:"w-full text-sm border p-2 rounded",value:e.paymentRecommendation||"",onChange:v=>t({paymentRecommendation:v.target.value}),children:[n.jsx("option",{value:"",children:"-- Select Recommendation --"}),n.jsx("option",{value:"The expenses are lower than the Deductible...",children:"Option A: Lower than Deductible"}),n.jsxs("option",{value:`It would be appreciated... transfer ${e.expensesSum||"..."}`,children:["Option B: Transfer Funds (",e.expensesSum," )"]})]})})]}),n.jsxs("div",{className:`border-t-2 pt-4 mt-6 ${Ie?"bg-green-50 p-4 rounded border-green-200":""}`,children:[n.jsxs("h4",{className:"font-bold text-sm text-textLight mb-2 flex items-center",children:[n.jsx(dh,{className:"w-4 h-4 mr-2"})," Tax Invoices (Appendices)"]}),(en||!e.isWaitingForInvoices)&&n.jsxs("div",{className:"flex flex-wrap items-center gap-2 mb-2",children:[n.jsxs("button",{onClick:()=>{var v;return(v=Wn.current)==null?void 0:v.click()},className:"px-3 py-1.5 text-xs bg-navySecondary text-textLight rounded hover:bg-borderDark flex items-center gap-1",children:[n.jsx(No,{className:"w-3 h-3"})," "]}),n.jsx("button",{onClick:()=>Ar({mode:"INVOICE"}),className:"px-3 py-1.5 text-xs bg-red-100 text-red-700 rounded hover:bg-red-200 flex items-center gap-1",children:xn==="INVOICE"?n.jsx(Bt,{className:"w-3 h-3 animate-spin"}):" "}),n.jsx("input",{ref:Wn,type:"file",className:"hidden",multiple:!0,accept:".pdf,.doc,.docx,application/msword,application/vnd.openxmlformats-officedocument.wordprocessingml.document,application/pdf",onChange:Yt})]}),n.jsx("div",{className:"mt-2 space-y-2",children:e.invoiceFiles.map(v=>n.jsxs("div",{className:"flex items-center justify-between bg-panel p-2 rounded border shadow-sm text-xs",children:[n.jsxs("span",{className:"flex items-center",children:[n.jsx(yo,{className:"w-3 h-3 mr-2 text-blue-500"})," ",v.name]}),n.jsx("button",{onClick:()=>dn(v.id),className:"text-red-400 hover:text-red-600",children:n.jsx(Ht,{className:"w-3 h-3"})})]},v.id))})]})]}):n.jsxs("div",{className:"relative",children:[!(Zt&&Ct==="ENGLISH_ONLY")&&n.jsx(Fp,{className:"w-full border border-borderDark rounded-md p-4 min-h-[100px] text-right font-sans focus:ring-1 focus:ring-lpBlue outline-none transition-all",dir:"rtl",value:e.content[f]||"",onChange:v=>tn(f,v.target.value),disabled:Ie,readOnly:V,placeholder:"Type Hebrew content here...",style:{lineHeight:"1.6",textAlign:"justify"},textareaRef:(A.current[f]||(A.current[f]=ci.createRef()),A.current[f])}),Zt&&n.jsxs("div",{className:Ct==="ENGLISH_ONLY"?"":"mt-4 border-t pt-4",children:[n.jsxs("div",{className:"flex items-center justify-between mb-2",children:[n.jsx("label",{className:"text-xs font-bold text-textMuted uppercase block",children:"English Output (Editable)"}),a.role==="ADMIN"&&e.isTranslated&&!f.toLowerCase().includes("expenses")&&n.jsx("button",{type:"button",onClick:()=>jr(f),disabled:!!es&&es===f||!(((m=e.translatedContent)==null?void 0:m[f])||"").trim(),className:`text-[11px] px-2 py-1 rounded-full border transition ${es===f?"border-emerald-400 text-emerald-600 bg-emerald-50 cursor-wait":(((x=e.translatedContent)==null?void 0:x[f])||"").trim()?"border-emerald-500 text-emerald-700 hover:bg-emerald-50":"border-borderDark text-slate-400 cursor-not-allowed"}`,children:es===f?n.jsxs("span",{className:"inline-flex items-center gap-1",children:[n.jsx(Bt,{className:"w-3 h-3 animate-spin"}),"Improving..."]}):"Improve this section"})]}),n.jsx(Fp,{className:"w-full border border-indigo-200 rounded-md p-4 min-h-[100px] font-serif focus:ring-1 focus:ring-indigo-300 outline-none transition-all",dir:"ltr",value:((k=e.translatedContent)==null?void 0:k[f])||"",onChange:v=>Ri(f,v.target.value),placeholder:"Translated text will appear here after Auto-Translate...",readOnly:V,style:{lineHeight:"1.6",textAlign:"justify"}})]})]})]},f)})}),a.role==="ADMIN"&&J&&n.jsx("div",{className:"fixed inset-0 z-[120] flex items-center justify-center bg-black/40",children:n.jsxs("div",{className:"bg-panel rounded-lg shadow-xl w-full max-w-3xl max-h-[80vh] overflow-hidden flex flex-col",children:[n.jsxs("div",{className:"px-4 py-2 border-b flex items-center justify-between",children:[n.jsx("h3",{className:"text-sm font-semibold text-textLight",children:"Manage Templates"}),n.jsx("button",{type:"button",onClick:()=>ue(!1),className:"text-textMuted hover:text-textLight",children:n.jsx(Ht,{className:"w-4 h-4"})})]}),n.jsx("div",{className:"px-4 py-3 border-b flex items-center gap-3 text-xs",children:n.jsxs("label",{className:"font-semibold text-textLight",children:["Section:",n.jsx("select",{className:"ml-2 border border-borderDark rounded px-2 py-1 text-xs",value:ce,onChange:f=>le(f.target.value),children:Lr.map(f=>n.jsx("option",{value:f,children:f},f))})]})}),n.jsx("div",{className:"flex-1 overflow-y-auto px-4 py-3 space-y-3 text-xs",children:(()=>{const f=H.filter(T=>T.sectionKey===ce).sort((T,K)=>(T.orderIndex||0)-(K.orderIndex||0)||T.createdAt.localeCompare(K.createdAt));return f.length?f.map((T,K)=>n.jsxs("div",{className:"border border-borderDark rounded-md p-2 bg-slate-50 space-y-1",children:[n.jsxs("div",{className:"flex items-center justify-between gap-2",children:[n.jsx("input",{type:"text",className:"flex-1 border border-borderDark rounded px-2 py-1 text-xs",value:T.title,onChange:ee=>kr(T.id,{title:ee.target.value})}),n.jsxs("label",{className:"flex items-center gap-1 text-[11px] text-textLight",children:[n.jsx("input",{type:"checkbox",checked:T.isEnabled!==!1,onChange:ee=>kr(T.id,{isEnabled:ee.target.checked})}),"Enabled"]})]}),n.jsx("textarea",{className:"w-full border border-borderDark rounded px-2 py-1 text-xs mt-1",rows:3,value:T.body,onChange:ee=>kr(T.id,{body:ee.target.value})}),n.jsxs("div",{className:"flex items-center justify-between mt-1",children:[n.jsxs("div",{className:"flex items-center gap-1",children:[n.jsx("button",{type:"button",className:"px-2 py-0.5 rounded border border-borderDark text-[11px] text-textLight hover:bg-slate-100",onClick:()=>ga(T.id,"UP"),disabled:K===0,children:""}),n.jsx("button",{type:"button",className:"px-2 py-0.5 rounded border border-borderDark text-[11px] text-textLight hover:bg-slate-100",onClick:()=>ga(T.id,"DOWN"),disabled:K===f.length-1,children:""})]}),n.jsx("button",{type:"button",className:"px-2 py-0.5 rounded border border-red-200 text-[11px] text-red-700 hover:bg-red-50",onClick:()=>{window.confirm("Delete this template?")&&ha(T.id)},children:"Delete"})]})]},T.id)):n.jsx("p",{className:"text-[11px] text-textMuted",children:"No templates defined yet for this section."})})()})]})}),a.role==="ADMIN"&&qe&&n.jsx("div",{className:"fixed inset-0 z-[120] flex items-center justify-center bg-black/40",children:n.jsxs("div",{className:"bg-panel rounded-lg shadow-xl w-full max-w-3xl max-h-[80vh] overflow-hidden flex flex-col",children:[n.jsxs("div",{className:"px-4 py-2 border-b flex items-center justify-between",children:[n.jsx("h3",{className:"text-sm font-semibold text-textLight",children:"Manage Best Practices"}),n.jsx("button",{type:"button",onClick:()=>dt(!1),className:"text-textMuted hover:text-textLight",children:n.jsx(Ht,{className:"w-4 h-4"})})]}),n.jsx("div",{className:"px-4 py-3 border-b flex items-center gap-3 text-xs",children:n.jsxs("label",{className:"font-semibold text-textLight",children:["Section:",n.jsx("select",{className:"ml-2 border border-borderDark rounded px-2 py-1 text-xs",value:Ue,onChange:f=>nt(f.target.value),children:Lr.map(f=>n.jsx("option",{value:f,children:f},f))})]})}),n.jsx("div",{className:"flex-1 overflow-y-auto px-4 py-3 space-y-3 text-xs",children:(()=>{const f=Z.filter(T=>T.sectionKey===Ue).sort((T,K)=>{const ee=T.label==="LLOYDS_RECOMMENDED"?0:1,de=K.label==="LLOYDS_RECOMMENDED"?0:1;if(ee!==de)return ee-de;const d=T.usageCount||0;return(K.usageCount||0)-d});return f.length?f.map(T=>n.jsxs("div",{className:"border border-borderDark rounded-md p-2 bg-slate-50 space-y-1",children:[n.jsxs("div",{className:"flex items-center justify-between gap-2",children:[n.jsx("input",{type:"text",className:"flex-1 border border-borderDark rounded px-2 py-1 text-xs",value:T.title,onChange:K=>Tr(T.id,{title:K.target.value})}),n.jsxs("select",{className:"border border-borderDark rounded px-2 py-1 text-[11px]",value:T.label,onChange:K=>Tr(T.id,{label:K.target.value==="LLOYDS_RECOMMENDED"?"LLOYDS_RECOMMENDED":"BEST_PRACTICE"}),children:[n.jsx("option",{value:"BEST_PRACTICE",children:"Best practice"}),n.jsx("option",{value:"LLOYDS_RECOMMENDED",children:"Lloyds recommended"})]}),n.jsxs("label",{className:"flex items-center gap-1 text-[11px] text-textLight",children:[n.jsx("input",{type:"checkbox",checked:T.isEnabled!==!1,onChange:K=>$o(T.id,K.target.checked)}),"Enabled"]})]}),n.jsx("textarea",{className:"w-full border border-borderDark rounded px-2 py-1 text-xs mt-1",rows:3,value:T.body,onChange:K=>Tr(T.id,{body:K.target.value})}),n.jsx("input",{type:"text",className:"w-full border border-borderDark rounded px-2 py-1 text-[11px] mt-1",placeholder:"Tags (comma separated)",value:(T.tags||[]).join(", "),onChange:K=>Tr(T.id,{tags:K.target.value.split(",").map(ee=>ee.trim()).filter(Boolean)})}),n.jsxs("div",{className:"flex items-center justify-between mt-1",children:[n.jsxs("div",{className:"flex items-center gap-2 text-[10px] text-textMuted",children:[n.jsxs("span",{children:["Usage: ",T.usageCount||0]}),T.lastUsedAt&&n.jsxs("span",{children:["Last used:"," ",new Date(T.lastUsedAt).toLocaleString("he-IL",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"})]})]}),n.jsx("button",{type:"button",className:"px-2 py-0.5 rounded border border-red-200 text-[11px] text-red-700 hover:bg-red-50",onClick:()=>{window.confirm("Delete this best practice?")&&Bo(T.id)},children:"Delete"})]})]},T.id)):n.jsx("p",{className:"text-[11px] text-textMuted",children:"No best practices defined yet for this section."})})()})]})}),Le&&n.jsx("div",{className:"fixed inset-0 z-[120] flex items-center justify-center bg-black/40",children:n.jsxs("div",{className:"bg-panel rounded-lg shadow-xl w-full max-w-3xl max-h-[80vh] overflow-hidden flex flex-col",children:[n.jsxs("div",{className:"px-4 py-2 border-b flex items-center justify-between",children:[n.jsx("h3",{className:"text-sm font-semibold text-textLight",children:" "}),n.jsx("button",{type:"button",onClick:()=>{st(!1),Be(null)},className:"text-textMuted hover:text-textLight",children:n.jsx(Ht,{className:"w-4 h-4"})})]}),n.jsxs("div",{className:"flex-1 overflow-y-auto px-4 py-3 space-y-4 text-xs",children:[n.jsxs("div",{className:"flex items-center justify-between gap-2",children:[n.jsx("p",{className:"text-[11px] text-textMuted",children:"          ."}),n.jsx("button",{type:"button",className:"px-3 py-1.5 rounded bg-sky-600 text-white text-[11px] font-semibold hover:bg-sky-700",onClick:()=>Be({id:void 0,title:"",sectionKey:"",tagsInput:"",body:""}),children:" "})]}),ie.length===0&&n.jsx("p",{className:"text-[11px] text-textMuted",children:'    .     " ".'}),ie.length>0&&n.jsxs("div",{className:"space-y-2",children:[n.jsx("h4",{className:"text-[11px] font-semibold text-textLight",children:" "}),n.jsx("div",{className:"space-y-1",children:ie.slice().sort((f,T)=>(T.updatedAt||T.createdAt).localeCompare(f.updatedAt||f.createdAt)).map(f=>n.jsxs("div",{className:"flex items-center justify-between gap-2 border border-borderDark rounded-md px-2 py-1 bg-slate-50",children:[n.jsx("div",{className:"flex-1 min-w-0 text-right",children:n.jsxs("div",{className:"flex flex-wrap items-center justify-end gap-1",children:[n.jsx("span",{className:"font-semibold text-textLight truncate",children:f.title}),f.sectionKey&&n.jsx("span",{className:"inline-flex items-center rounded-full px-2 py-0.5 text-[9px] bg-slate-100 text-textLight",children:f.sectionKey}),f.tags&&f.tags.length>0&&n.jsx("span",{className:"inline-flex items-center rounded-full px-2 py-0.5 text-[9px] bg-slate-100 text-textLight",children:f.tags.join(", ")})]})}),n.jsxs("div",{className:"flex items-center gap-1",children:[n.jsx("button",{type:"button",className:"px-2 py-0.5 rounded border border-borderDark text-[11px] text-textLight hover:bg-slate-100",onClick:()=>Be({id:f.id,title:f.title,sectionKey:f.sectionKey||"",tagsInput:(f.tags||[]).join(", "),body:f.body}),children:""}),n.jsx("button",{type:"button",className:"px-2 py-0.5 rounded border border-red-200 text-[11px] text-red-700 hover:bg-red-50",onClick:()=>{if(window.confirm("Delete this personal snippet?")){const T=Op(a.id,f.id);De(T),ne&&ne.id===f.id&&Be(null)}},children:""})]})]},f.id))})]}),ne&&n.jsxs("form",{className:"border-t border-borderDark pt-3 space-y-3",onSubmit:f=>{f.preventDefault();const T=ne.title.trim(),K=ne.body.trim();if(!T||!K)return;const ee=ne.tagsInput.split(",").map(d=>d.trim()).filter(Boolean)||[],de=gv(a.id,{id:ne.id,title:T,body:K,sectionKey:ne.sectionKey||void 0,tags:ee});De(de),Be(null)},children:[n.jsx("h4",{className:"text-[11px] font-semibold text-textLight",children:ne.id?" ":" "}),n.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-2",children:[n.jsxs("div",{className:"space-y-1",children:[n.jsx("label",{className:"block font-semibold text-textLight",children:""}),n.jsx("input",{type:"text",className:"w-full border border-borderDark rounded px-2 py-1 text-xs",value:ne.title,onChange:f=>Be(T=>T&&{...T,title:f.target.value}),required:!0})]}),n.jsxs("div",{className:"space-y-1",children:[n.jsx("label",{className:"block font-semibold text-textLight",children:" ()"}),n.jsxs("select",{className:"w-full border border-borderDark rounded px-2 py-1 text-xs",value:ne.sectionKey,onChange:f=>Be(T=>T&&{...T,sectionKey:f.target.value}),children:[n.jsx("option",{value:"",children:" "}),Lr.map(f=>n.jsx("option",{value:f,children:f},f))]})]})]}),n.jsxs("div",{className:"space-y-1",children:[n.jsx("label",{className:"block font-semibold text-textLight",children:" (,  )"}),n.jsx("input",{type:"text",className:"w-full border border-borderDark rounded px-2 py-1 text-xs",value:ne.tagsInput,onChange:f=>Be(T=>T&&{...T,tagsInput:f.target.value})})]}),n.jsxs("div",{className:"space-y-1",children:[n.jsx("label",{className:"block font-semibold text-textLight",children:" "}),n.jsx("textarea",{className:"w-full border border-borderDark rounded px-2 py-1 text-xs",rows:5,value:ne.body,onChange:f=>Be(T=>T&&{...T,body:f.target.value})})]}),n.jsxs("div",{className:"flex items-center justify-end gap-2 pt-2 border-t border-borderDark",children:[n.jsx("button",{type:"button",className:"px-3 py-1.5 rounded border border-borderDark text-[11px] text-textLight hover:bg-slate-100",onClick:()=>Be(null),children:""}),n.jsx("button",{type:"submit",className:"px-3 py-1.5 rounded bg-sky-600 text-white text-[11px] font-semibold hover:bg-sky-700",children:""})]})]})]})]})}),a.role==="ADMIN"&&jt&&n.jsx("div",{className:"fixed inset-0 z-[130] flex items-center justify-center bg-black/40",children:n.jsxs("div",{className:"bg-panel rounded-lg shadow-xl w-full max-w-md max-h-[80vh] overflow-hidden flex flex-col",children:[n.jsxs("div",{className:"px-4 py-2 border-b flex items-center justify-between",children:[n.jsx("h3",{className:"text-sm font-semibold text-textLight",children:"Save Best Practice"}),n.jsx("button",{type:"button",onClick:ba,className:"text-textMuted hover:text-textLight",children:n.jsx(Ht,{className:"w-4 h-4"})})]}),n.jsx(wv,{onSubmit:qi,onCancel:ba,initialTitle:jt.body.split(/\s+/).slice(0,6).join(" ")})]})}),n.jsxs("div",{className:"flex justify-between pt-4",children:[n.jsxs("button",{onClick:s,className:"flex items-center text-textMuted px-4 py-2 hover:bg-navySecondary rounded",children:[n.jsx(Ql,{className:"mr-2 w-4 h-4"})," Back"]}),n.jsxs("button",{onClick:r,className:"flex items-center bg-navy text-white px-6 py-2 rounded hover:bg-navySecondary transition",children:["Next Step ",n.jsx(is,{className:"ml-2 w-4 h-4"})]})]})]})]})},Hv=({onClose:e,onSubmit:t,currentUser:s,favoriteProviders:r=[],onSaveFavorite:a})=>{const o=s.role==="LAWYER",[l,c]=g.useState(o?s.id:""),[i,u]=g.useState(""),[p,y]=g.useState(""),[b,w]=g.useState(null),[R,E]=g.useState([{id:Ln(),category:"EXPERT_OUR",serviceProvider:"",amount:""}]),[W,N]=g.useState([]),h=4,S=async()=>{if(!l||!p)return;let j=null;const F=L=>t({lawyerId:l,instructions:i,odakanitNo:p,file:L,worksheet:R,invoiceFiles:W});if(b){const L=new FileReader;L.onload=O=>{var H;j={name:b.name,type:b.type,data:((H=O.target)==null?void 0:H.result).split(",")[1]},F(j)},L.readAsDataURL(b)}else F()},P=async j=>{const F=j.target.files;if(!F)return;if(W.length>=h){alert("   4 ."),j.target.value="";return}const L=Array.from(F).slice(0,h-W.length),O=await Promise.all(L.map(H=>new Promise(M=>{const I=new FileReader;I.onload=D=>{var J;return M({id:`inv-${Date.now()}-${Math.random().toString(36).slice(2,6)}`,name:H.name,data:((J=D.target)==null?void 0:J.result).split(",")[1],type:H.type})},I.readAsDataURL(H)})));N(H=>[...H,...O]),j.target.value=""},U=j=>{N(F=>F.filter(L=>L.id!==j))},V=(j,F,L)=>{E(O=>O.map(H=>H.id===j?{...H,[F]:L}:H))},X=j=>{const F=ds.find(L=>L.type===j)||ds[0];E(L=>[...L,{id:Ln(),category:F.value,serviceProvider:"",amount:"",customLabel:""}])},te=j=>{E(F=>F.length===1?F:F.filter(L=>L.id!==j))},G=Pd(R,s),ae=oi(G);return n.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-[200]",children:n.jsxs("div",{className:"bg-panel p-6 rounded-lg shadow-xl w-96 animate-scale-in",children:[n.jsx("h3",{className:"font-bold text-lg mb-4 text-textLight",children:o?"  ":"Open New Finance Case"}),n.jsxs("div",{className:"space-y-3",children:[n.jsxs("div",{children:[n.jsx("label",{className:"block text-xs font-bold text-textMuted",children:"Internal Case # (Odakanit)"}),n.jsx("input",{className:"w-full border p-2 rounded",value:p,onChange:j=>y(j.target.value),placeholder:"e.g. 55492"})]}),!o&&n.jsxs(n.Fragment,{children:[n.jsxs("div",{children:[n.jsx("label",{className:"block text-xs font-bold text-textMuted",children:"Assign Lawyer"}),n.jsxs("select",{className:"w-full border p-2 rounded",value:l,onChange:j=>c(j.target.value),children:[n.jsx("option",{value:"",children:"-- Select --"}),ws.filter(j=>j.role==="LAWYER").map(j=>n.jsx("option",{value:j.id,children:j.name},j.id))]})]}),n.jsxs("div",{children:[n.jsx("label",{className:"block text-xs font-bold text-textMuted",children:"Instructions"}),n.jsx(go,{clientId:So,children:n.jsx("textarea",{className:"w-full border p-2 rounded",rows:3,value:i,onChange:j=>u(j.target.value),placeholder:"Notes for lawyer..."})})]}),n.jsxs("div",{children:[n.jsx("label",{className:"block text-xs font-bold text-textMuted",children:"Attach Expenses File"}),n.jsx("input",{type:"file",onChange:j=>{var F;return w(((F=j.target.files)==null?void 0:F[0])||null)},className:"text-xs"})]}),n.jsxs("div",{className:"border rounded-lg p-3 bg-amber-50",children:[n.jsxs("div",{className:"flex justify-between items-center mb-2",children:[n.jsx("label",{className:"block text-xs font-bold text-amber-700",children:"Expense Worksheet"}),n.jsxs("div",{className:"flex gap-2 text-xs text-amber-700 font-semibold",children:[n.jsx("button",{type:"button",onClick:()=>X("EXPENSE"),className:"hover:underline",children:"+ Expense"}),n.jsx("button",{type:"button",onClick:()=>X("ADJUSTMENT"),className:"hover:underline",children:"+ Adjustment"})]})]}),n.jsx("div",{className:"space-y-2 max-h-48 overflow-auto pr-1",children:R.map(j=>{const F=ds.find(M=>M.value===j.category),L=(F==null?void 0:F.type)!=="ADJUSTMENT",O=r.filter(M=>M.category===j.category||M.category==="OTHER"),H=Pd([j],s)[0];return n.jsxs("div",{className:"border border-amber-100 bg-panel rounded-lg p-2 space-y-2",children:[n.jsxs("div",{children:[n.jsx("label",{className:"block text-[10px] font-bold text-textMuted",children:"Expense Details"}),n.jsx("select",{value:j.category,onChange:M=>V(j.id,"category",M.target.value),className:"w-full border rounded text-xs p-2",children:ds.map(M=>n.jsx("option",{value:M.value,children:M.label},M.value))})]}),j.category==="OTHER"&&n.jsxs("div",{children:[n.jsx("label",{className:"block text-[10px] font-bold text-textMuted",children:"Custom Label"}),n.jsx("input",{className:"w-full border rounded text-xs p-2",placeholder:"Describe expense",value:j.customLabel||"",onChange:M=>V(j.id,"customLabel",M.target.value)})]}),L&&n.jsxs("div",{children:[n.jsx("label",{className:"block text-[10px] font-bold text-textMuted",children:"Service Provider"}),n.jsx("input",{list:`provider-${j.id}`,className:"w-full border rounded text-xs p-2",placeholder:"Provider name",value:j.serviceProvider,onChange:M=>V(j.id,"serviceProvider",M.target.value)}),n.jsx("datalist",{id:`provider-${j.id}`,children:O.map(M=>n.jsx("option",{value:M.serviceProvider,children:M.label},M.id))}),n.jsx("button",{type:"button",onClick:()=>a&&j.serviceProvider.trim()&&a({id:Ln(),category:j.category,label:(H==null?void 0:H.label)||"Expense",serviceProvider:j.serviceProvider.trim()}),className:"text-[10px] text-amber-600 hover:underline mt-1",children:"Save to favorites"})]}),n.jsxs("div",{children:[n.jsx("label",{className:"block text-[10px] font-bold text-textMuted",children:"Cost ()"}),n.jsx("input",{type:"number",min:"0",className:"w-full border rounded text-xs p-2",placeholder:"",value:j.amount,onChange:M=>V(j.id,"amount",M.target.value)})]}),n.jsx("div",{className:"text-right",children:n.jsx("button",{type:"button",onClick:()=>te(j.id),className:"text-[10px] text-red-500 hover:underline",children:"Remove"})})]},j.id)})}),n.jsxs("div",{className:"text-right text-xs font-bold text-amber-800 mt-2",children:["Total balance preview: ",ae.totalBalance.toLocaleString()]})]}),n.jsxs("div",{className:"border rounded-lg p-3 bg-panel",children:[n.jsxs("div",{className:"flex justify-between items-center mb-2",children:[n.jsx("label",{className:"block text-xs font-bold text-textLight",children:"Tax Invoices (PDF / Word)"}),n.jsxs("span",{className:"text-[11px] text-textMuted",children:[W.length,"/",h]})]}),n.jsxs("label",{className:"flex flex-col items-center justify-center w-full h-24 border-2 border-borderDark border-dashed rounded-lg cursor-pointer bg-panel hover:bg-navySecondary",children:[n.jsxs("div",{className:"flex flex-col items-center justify-center pt-5 pb-6",children:[n.jsx(No,{className:"w-6 h-6 text-gray-400 mb-2"}),n.jsx("p",{className:"text-xs text-textMuted",children:"   ( 4 )"})]}),n.jsx("input",{type:"file",className:"hidden",multiple:!0,accept:".pdf,.doc,.docx,application/msword,application/vnd.openxmlformats-officedocument.wordprocessingml.document,application/pdf",onChange:P})]}),n.jsxs("div",{className:"mt-2 space-y-2 max-h-32 overflow-auto",children:[W.map(j=>n.jsxs("div",{className:"flex items-center justify-between bg-navySecondary p-2 rounded border text-xs",children:[n.jsxs("span",{className:"flex items-center gap-2 text-textLight",children:[n.jsx(yo,{className:"w-3 h-3 text-blue-500"}),j.name]}),n.jsx("button",{type:"button",onClick:()=>U(j.id),className:"text-red-400 hover:text-red-600",children:n.jsx(Ht,{className:"w-3 h-3"})})]},j.id)),W.length===0&&n.jsx("p",{className:"text-xs text-gray-400 text-center",children:"   ."})]})]})]}),o&&n.jsx("p",{className:"text-xs text-textMuted",children:"    .    ."}),n.jsx("button",{onClick:S,className:"w-full bg-indigo-600 text-white py-2 rounded font-bold mt-2 hover:bg-indigo-700",children:o?"Create Personal Folder":"Create Folder"}),n.jsx("button",{onClick:e,className:"w-full text-textMuted text-sm hover:underline mt-1",children:"Cancel"})]})]})})},Uv=({user:e,reports:t,onSelectReport:s,onNewReport:r,onLogout:a,onUpdateReport:o,onDeleteReport:l,onFinanceTaskCreate:c,onNotifyLawyerFromFinance:i,onSheetDeleted:u,caseTemplates:p=[],onStartTemplate:y,onStartNextReport:b,archiveAfterMs:w,favoriteProviders:R={},onSaveFavorite:E,onDeleteFavorite:W,onOpenWorksheet:N,onRequestReminder:h,onRequestNote:S,onSoftDeleteReport:P,onRestoreReport:U,notifications:V=[],showNotifications:X,setShowNotifications:te,onClearNotifications:G,dailySummaryOptIn:ae,setDailySummaryOptIn:j,caseFolders:F,onOpenCaseFolder:L,onOpenAssistant:O})=>{const H=e.role==="ADMIN"||e.role==="SUB_ADMIN"||e.role==="FINANCE",M=e.role==="LAWYER"||e.role==="SUB_ADMIN"||e.role==="FINANCE",[I,D]=g.useState(!1),[J,ue]=g.useState(!1),[ce,le]=g.useState(!1),[fe,Ee]=g.useState(!1),[ve,$e]=g.useState({category:"EXPERT_OUR",label:"",provider:""}),[Pe,Ke]=g.useState(""),[Ye,it]=g.useState(null),q=e.role==="ADMIN",se=e.role==="SUB_ADMIN"||e.role==="FINANCE";if(e.role==="FINANCE"){const A=ge=>{o(ge,{isPaid:!0})};return n.jsx(Zb,{user:e,reports:t,onLogout:a,onNotifyLawyer:i,onMarkReportPaid:A,onSheetDeleted:u,onOpenAssistant:()=>O&&O(),caseFolders:F})}if(!H&&e.role==="LAWYER")return n.jsx(pb,{user:e,reports:t,caseFolders:F||{},notifications:V,showNotifications:X,setShowNotifications:te,onClearNotifications:G,dailySummaryOptIn:ae,setDailySummaryOptIn:j,archiveAfterMs:w,onSelectReport:s,onNewReport:r,onOpenCaseFolder:L,onLogout:a,deleteReportById:l});const C=Date.now(),re=w??Number.MAX_SAFE_INTEGER,Q=A=>A.status==="SENT"&&A.sentAt&&C-new Date(A.sentAt).getTime()>=re,he=H?t:t.filter(A=>A.createdBy===e.id),Fe=he.filter(Q),je=he.filter(A=>!Q(A)&&!A.deletedAt),Te=he.filter(A=>A.deletedAt&&C-new Date(A.deletedAt).getTime()<Uh),et=he.filter(A=>!A.deletedAt),Ge=q?je:M?et:he,He=q?Fe:M?Te:[],Z=H?[]:t.filter(A=>A.status==="READY_TO_SEND"&&A.createdBy===e.id&&!A.deletedAt),Ne=H?[]:t.filter(A=>["TASK_ASSIGNED","WAITING_FOR_INVOICES"].includes(A.status)&&A.createdBy===e.id&&!A.deletedAt),xe=A=>{var ge;if((ge=A.reportHistory)!=null&&ge.length)return A.reportHistory;if(A.status==="SENT"){const _e=A.sentAt||A.reportDate||new Date().toISOString();return[{id:`${A.id}-legacy`,reportNumber:1,subject:`${A.insurerName||"Report"}${A.insuredName?` - ${A.insuredName}`:""}`,date:_e,sent:!0}]}return[]},be=H?[]:t.filter(A=>A.createdBy===e.id&&!A.deletedAt).flatMap(A=>{const ge=xe(A);return ge.length?ge.map((_e,Ie)=>{var mt;return{parent:A,entry:_e,reportNumber:_e.reportNumber||Ie+1,sentAt:_e.date||((mt=_e.snapshot)==null?void 0:mt.createdAt)||A.sentAt,isLatest:Ie===ge.length-1}}):[]}).sort((A,ge)=>{const _e=A.sentAt?new Date(A.sentAt).getTime():0;return(ge.sentAt?new Date(ge.sentAt).getTime():0)-_e}),Oe=A=>{const ge=xe(A),_e=ge[ge.length-1],Ie=(_e==null?void 0:_e.date)||A.sentAt;return Ie?new Date(Ie).getTime():0},Ce=H?[]:t.filter(A=>A.createdBy!==e.id||A.deletedAt||A.status!=="SENT"?!1:xe(A).length>0).sort((A,ge)=>Oe(ge)-Oe(A)),qe=H?[]:[{id:"ready",title:"  ",subtitle:"    ",items:Z,empty:"   .",actionLabel:" ",action:A=>s(A.id),tone:"border-red-100"},{id:"finance",title:"   ",subtitle:"  /   ",items:Ne,empty:"   .",actionLabel:" ",action:A=>s(A.id),tone:"border-amber-100"},{id:"followup",title:'"  ',subtitle:' "    "   ',items:Ce,empty:' "   .',actionLabel:'" ',action:b?A=>b(A.id):void 0,tone:"border-blue-100"},{id:"sent",title:" ",subtitle:'      "   ',items:be,empty:"     .",tone:"border-green-100"}],dt=H?t.filter(A=>A.odakanitNo&&!A.deletedAt):[],Ue=(R==null?void 0:R[e.id])||[],nt=()=>{if(!ve.provider.trim())return;const A=ds.find(_e=>_e.value===ve.category),ge=ve.label.trim()||(A==null?void 0:A.label)||"Favorite provider";E&&E(e.id,{id:Ln(),category:ve.category,label:ge,serviceProvider:ve.provider.trim()}),$e({category:ve.category,label:"",provider:""})},jt=A=>{W&&W(e.id,A)};p.filter(A=>A.ownerId===e.id);const z=t.filter(A=>Up(A)&&!A.deletedAt),ie=e.role==="FINANCE"||e.role==="SUB_ADMIN",De=q||M,Me=q?`Items move here ${w/(1e3*60*60)}h after sending and are deleted after ${Hh/(1e3*60*60*24)} days.`:M?"     7    .":"",pe=z.filter(A=>!["READY_TO_SEND","SENT"].includes(A.status)),Le=z.filter(A=>A.status==="READY_TO_SEND"),st=z.filter(A=>A.status==="SENT"),ne=st.reduce((A,ge)=>A+Hp(ge),0),Be=A=>A==="SENT"?"bg-gold/20 text-goldLight border-gold":A==="READY_TO_SEND"?"bg-danger/30 text-red-300 border-danger":"bg-navySecondary text-textMuted border-borderDark",Ct=A=>A==="READY_TO_SEND"?"READY TO SEND":A.replace(/_/g," "),_t=A=>{o(A,{isPaid:!0})},We=ce?He:Ge,Qt=A=>{const ge=A.createdBy||"unknown",_e=A.odakanitNo||A.marketRef||A.id||"unknown",Ie=(A.plaintiffName||"unknown").toLowerCase();return`${ge}::${_e}::${Ie}`},xn=ie?We.filter(Up):We,hn=new Set((ie?[]:We).map(A=>Qt(A))),Cs=!H&&!ie?p.filter(A=>A.ownerId===e.id&&!hn.has(A.caseKey)).map(A=>({id:`template-${A.caseKey}`,createdBy:A.ownerId,ownerName:A.ownerName,reportDate:A.lastUpdated,status:"TASK_ASSIGNED",recipientId:"1",insurerName:A.insurerName||"",lineSlipNo:A.lineSlipNo||"",marketRef:A.marketRef||"",insuredName:A.insuredName||"",plaintiffName:A.plaintiffName||"",plaintiffTitle:A.plaintiffTitle||"Plaintiff",odakanitNo:A.odakanitNo,selectedTimeline:"standard",filenameTag:fh[0],selectedSections:["Update"],content:{},translatedContent:{},expertSummaryMode:{},invoiceFiles:[],isWaitingForInvoices:!1,isTranslated:!1,expensesItems:[],expenseWorksheet:Ps(),reportNotes:[],__templateKey:A.caseKey})):[],sr=ie?xn:[...xn,...Cs],Cn=Pe.trim().toLowerCase(),rr=A=>Cn?`${A.odakanitNo||""} ${A.insuredName||""} ${A.plaintiffName||""} ${A.ownerName||""}`.toLowerCase().includes(Cn):!0,es=Cn?sr.filter(rr):sr,Un=ie?[]:(()=>{const A=new Map;return es.forEach(ge=>{if(ge.__templateKey)return;const _e=ge.odakanitNo||ge.marketRef||ge.insuredName||ge.id,Ie=ge.reportDate?new Date(ge.reportDate).getTime():0,mt=A.get(_e);mt?(mt.reports.push(ge),Ie>mt.latestDate&&(mt.latestDate=Ie),!mt.caseLabel&&(ge.insuredName||ge.plaintiffName)&&(mt.caseLabel=ge.insuredName||ge.plaintiffName||mt.caseLabel),!mt.insuredName&&ge.insuredName&&(mt.insuredName=ge.insuredName),!mt.plaintiffName&&ge.plaintiffName&&(mt.plaintiffName=ge.plaintiffName)):A.set(_e,{key:_e,odakanitNo:ge.odakanitNo||"",caseLabel:ge.insuredName||ge.plaintiffName||ge.marketRef||"",insuredName:ge.insuredName||"",plaintiffName:ge.plaintiffName||"",reports:[ge],latestDate:Ie})}),Array.from(A.values()).sort((ge,_e)=>_e.latestDate-ge.latestDate)})(),fs=A=>!["READY_TO_SEND","SENT"].includes(A.status),Wn=A=>{if(!fs(A)){alert("      -READY TO SEND  .");return}const ge=A.insuredName||A.plaintiffName||A.odakanitNo||A.id;window.confirm(`  " "${ge}"?    .`)&&l&&l(A.id)};return g.useEffect(()=>{Ye&&(Un.some(A=>A.key===Ye)||it(null))},[Ye,Un]),n.jsxs("div",{className:"min-h-screen bg-bgDark p-6 relative",children:[J&&n.jsx(jv,{onClose:()=>ue(!1)}),I&&n.jsx(Hv,{currentUser:e,onClose:()=>D(!1),onSubmit:A=>{c(A),D(!1)},favoriteProviders:R[e.id]||[],onSaveFavorite:A=>E&&E(e.id,A)}),fe&&n.jsx("div",{className:"fixed inset-0 bg-black/40 flex items-center justify-center z-[200] p-4",children:n.jsxs("div",{className:"bg-panel rounded-2xl shadow-2xl w-full max-w-2xl p-6 space-y-4",children:[n.jsxs("div",{className:"flex items-center justify-between",children:[n.jsxs("h3",{className:"text-lg font-bold text-textLight flex items-center gap-2",children:[n.jsx(U0,{className:"w-4 h-4 text-amber-500"}),"   "]}),n.jsx("button",{onClick:()=>Ee(!1),className:"text-textMuted hover:text-textLight",children:n.jsx(Ht,{className:"w-5 h-5"})})]}),n.jsxs("div",{className:"grid md:grid-cols-3 gap-3",children:[n.jsxs("div",{children:[n.jsx("label",{className:"block text-xs font-bold text-textMuted mb-1",children:""}),n.jsx("select",{value:ve.category,onChange:A=>$e({...ve,category:A.target.value}),className:"w-full border rounded text-sm p-2",children:ds.filter(A=>A.type==="EXPENSE").map(A=>n.jsx("option",{value:A.value,children:A.label},A.value))})]}),n.jsxs("div",{children:[n.jsx("label",{className:"block text-xs font-bold text-textMuted mb-1",children:" "}),n.jsx("input",{className:"w-full border rounded text-sm p-2",value:ve.label,onChange:A=>$e({...ve,label:A.target.value}),placeholder:":  "})]}),n.jsxs("div",{children:[n.jsx("label",{className:"block text-xs font-bold text-textMuted mb-1",children:" "}),n.jsx("input",{className:"w-full border rounded text-sm p-2",value:ve.provider,onChange:A=>$e({...ve,provider:A.target.value}),placeholder:'"  '})]})]}),n.jsx("div",{className:"text-right",children:n.jsx("button",{onClick:nt,className:"bg-amber-500 text-white px-4 py-2 rounded font-bold hover:bg-amber-600",children:" "})}),n.jsxs("div",{className:"max-h-64 overflow-y-auto border rounded-lg divide-y",children:[Ue.length===0&&n.jsx("p",{className:"text-sm text-gray-400 text-center py-6",children:"   ."}),Ue.map(A=>n.jsxs("div",{className:"p-3 flex items-center justify-between",children:[n.jsxs("div",{children:[n.jsx("p",{className:"text-sm font-bold text-textLight",children:A.label}),n.jsx("p",{className:"text-xs text-textMuted",children:A.serviceProvider})]}),n.jsx("button",{onClick:()=>jt(A.id),className:"text-xs text-red-500 hover:underline",children:""})]},A.id))]})]})}),n.jsxs("div",{className:"w-full px-6 md:px-8 lg:px-10 xl:px-12",children:[n.jsxs("div",{className:"flex justify-between items-center mb-8",children:[n.jsxs("div",{children:[n.jsx("h1",{className:"text-3xl font-serif font-bold text-lpBlue",children:"Lior Perry Law Office"}),n.jsxs("p",{className:"text-textMuted",children:["Welcome back, ",n.jsx("span",{className:"font-bold",children:e.name})," (",e.role,")"]})]}),n.jsxs("div",{className:"flex items-center gap-3 flex-wrap justify-end",children:[De&&n.jsxs("button",{onClick:()=>le(A=>!A),className:`flex items-center px-4 py-2 rounded shadow text-sm font-bold ${ce?"bg-gray-300 text-textLight":"bg-borderDark text-textLight"} hover:bg-borderDark`,children:[n.jsx($s,{className:"w-4 h-4 mr-2"})," ",ce?"Back to Reports":`Recycle Bin (${He.length})`]}),n.jsxs("button",{onClick:()=>D(!0),className:"flex items-center bg-indigo-600 text-white px-4 py-2 rounded shadow hover:bg-indigo-700 font-bold",children:[n.jsx(Ou,{className:"w-4 h-4 mr-2"})," Open New Case Folder"]}),n.jsxs("button",{type:"button",onClick:()=>O&&O(),className:"flex items-center text-indigo-700 bg-indigo-50 px-3 py-2 rounded hover:bg-indigo-100",children:[n.jsx(oa,{className:"w-4 h-4 mr-2"}),"  "]}),n.jsxs("div",{className:"relative",children:[n.jsxs("button",{onClick:()=>te(A=>!A),className:"flex items-center text-blue-600 bg-blue-50 px-3 py-2 rounded hover:bg-blue-100 relative",children:[n.jsx(Jl,{className:"w-4 h-4 mr-2"})," Notifications",V.length>0&&n.jsx("span",{className:"absolute -top-2 -right-2 bg-red-500 text-white text-[10px] rounded-full px-1",children:V.length})]}),X&&n.jsxs("div",{className:"absolute right-0 mt-2 w-80 bg-panel border border-borderDark shadow-xl rounded-lg z-50",children:[n.jsxs("div",{className:"flex items-center justify-between px-3 py-2 border-b",children:[n.jsx("span",{className:"text-sm font-bold text-textLight",children:"Smart Notifications"}),n.jsxs("label",{className:"text-xs text-textMuted flex items-center gap-1",children:[n.jsx("input",{type:"checkbox",checked:ae,onChange:A=>j(A.target.checked)}),"Daily summary"]})]}),n.jsxs("div",{className:"max-h-64 overflow-auto divide-y",children:[V.length===0&&n.jsx("div",{className:"p-4 text-xs text-gray-400 text-center",children:"No notifications yet."}),V.map(A=>n.jsxs("div",{className:"p-3 text-sm",children:[n.jsx("p",{className:"font-medium text-textLight",children:A.message}),n.jsx("p",{className:"text-[10px] text-gray-400",children:new Date(A.createdAt).toLocaleString()})]},A.id))]}),n.jsx("div",{className:"px-3 py-2 text-right text-xs",children:n.jsx("button",{onClick:G,className:"text-red-500 hover:underline",children:"Clear all"})})]})]}),n.jsxs("button",{onClick:()=>ue(!0),className:"flex items-center text-blue-600 bg-blue-50 px-3 py-2 rounded hover:bg-blue-100",children:[n.jsx(Du,{className:"w-4 h-4 mr-2"})," "]}),!1,n.jsxs("button",{onClick:a,className:"flex items-center text-red-600 hover:bg-red-50 px-4 py-2 rounded",children:[n.jsx(ch,{className:"w-4 h-4 mr-2"})," Logout"]})]})]}),H&&n.jsx(Ev,{reports:t,currentUser:e,onMarkPaid:_t}),se&&n.jsxs("div",{className:"mb-8 bg-panel border border-amber-200 rounded-2xl shadow p-6 space-y-4",children:[n.jsxs("div",{className:"flex items-center justify-between flex-wrap gap-3",children:[n.jsxs("div",{children:[n.jsxs("h3",{className:"text-lg font-bold text-amber-700 flex items-center gap-2",children:[n.jsx(dh,{className:"w-5 h-5"})," Expenses Overview"]}),n.jsx("p",{className:"text-sm text-textMuted",children:"Tracking all reports that include expense tables."})]}),n.jsxs("div",{className:"flex items-center gap-4 text-sm",children:[n.jsx("button",{onClick:()=>Ee(!0),className:"text-xs text-amber-700 underline hover:text-amber-900",children:"Manage Favorite Providers"}),n.jsxs("div",{className:"text-center",children:[n.jsx("p",{className:"text-xs uppercase text-gray-400",children:"Assigned to Lawyers"}),n.jsx("p",{className:"text-xl font-bold text-amber-700",children:pe.length})]}),n.jsxs("div",{className:"text-center",children:[n.jsx("p",{className:"text-xs uppercase text-gray-400",children:"Waiting for Lior"}),n.jsx("p",{className:"text-xl font-bold text-blue-600",children:Le.length})]}),n.jsxs("div",{className:"text-center",children:[n.jsx("p",{className:"text-xs uppercase text-gray-400",children:"Sent to Insurer"}),n.jsx("p",{className:"text-xl font-bold text-green-600",children:st.length})]}),n.jsxs("div",{className:"text-center",children:[n.jsx("p",{className:"text-xs uppercase text-gray-400",children:"Total Sent Balance"}),n.jsxs("p",{className:"text-xl font-bold text-green-700",children:["",ne.toLocaleString()]})]})]})]}),n.jsx("div",{className:"overflow-x-auto",children:n.jsxs("table",{className:"w-full text-sm",children:[n.jsx("thead",{className:"bg-amber-50 text-amber-800",children:n.jsxs("tr",{children:[n.jsx("th",{className:"p-2 text-left",children:"Case / Lawyer"}),n.jsx("th",{className:"p-2 text-left",children:"Status"}),n.jsx("th",{className:"p-2 text-right",children:"Total Balance ()"}),n.jsx("th",{className:"p-2 text-right",children:"Action"})]})}),n.jsxs("tbody",{className:"divide-y",children:[z.length===0&&n.jsx("tr",{children:n.jsx("td",{colSpan:4,className:"p-4 text-center text-gray-400",children:"No expense reports yet."})}),z.map(A=>n.jsxs("tr",{className:"hover:bg-amber-50 transition",children:[n.jsxs("td",{className:"p-2",children:[n.jsx("div",{className:"font-semibold text-textLight",children:A.insuredName||"Unnamed Case"}),n.jsxs("div",{className:"text-xs text-textMuted",children:["Lawyer: ",A.ownerName]})]}),n.jsx("td",{className:"p-2",children:n.jsx("span",{className:`px-2 py-1 rounded-full text-[10px] font-bold uppercase tracking-wide shadow-sm border ${Be(A.status)}`,children:Ct(A.status)})}),n.jsxs("td",{className:"p-2 text-right font-bold",children:["",Hp(A).toLocaleString()]}),n.jsx("td",{className:"p-2 text-right",children:n.jsx("button",{onClick:()=>s(A.id),className:"text-lpBlue hover:underline text-xs font-bold",children:"Open"})})]},`expense-${A.id}`))]})]})})]}),!H&&qe.length>0&&n.jsx("div",{className:"space-y-6 mb-8",children:qe.map(A=>n.jsxs("div",{className:"bg-panel border rounded-2xl shadow-sm",children:[n.jsx("div",{className:"flex flex-wrap justify-between items-center gap-3 px-4 py-3 border-b",children:n.jsxs("div",{children:[n.jsx("h3",{className:"font-bold text-textLight",children:A.title}),n.jsx("p",{className:"text-sm text-textMuted",children:A.subtitle})]})}),A.items.length===0?n.jsx("div",{className:"p-6 text-center text-gray-400 text-sm",children:A.empty}):n.jsx("div",{className:"p-4 space-y-3",children:A.items.map(ge=>{var mt;if(A.id==="sent"){const at=ge,Zt=at.sentAt?new Date(at.sentAt).toLocaleDateString("he-IL"):"",Ds=at.isLatest&&at.parent.status==="SENT"&&typeof b=="function",en=at.isLatest&&at.parent.status!=="SENT";return n.jsxs("div",{className:`border ${A.tone} rounded-xl p-4`,children:[n.jsxs("div",{className:"grid md:grid-cols-4 gap-4 text-sm text-textMuted",children:[n.jsxs("div",{children:[n.jsx("p",{className:"text-xs uppercase text-gray-400",children:" "}),n.jsx("p",{className:"font-bold text-textLight",children:at.parent.odakanitNo||""})]}),n.jsxs("div",{children:[n.jsx("p",{className:"text-xs uppercase text-gray-400",children:" "}),n.jsx("p",{className:"font-bold text-textLight",children:at.parent.insuredName||""})]}),n.jsxs("div",{children:[n.jsx("p",{className:"text-xs uppercase text-gray-400",children:at.parent.plaintiffTitle}),n.jsx("p",{className:"font-bold text-textLight",children:at.parent.plaintiffName||""})]}),n.jsxs("div",{children:[n.jsxs("p",{className:"text-xs uppercase text-gray-400",children:[" #",at.reportNumber]}),n.jsx("p",{className:"font-bold text-textLight",children:Zt})]})]}),n.jsxs("div",{className:"mt-2 text-sm text-textMuted space-y-1",children:[n.jsxs("p",{children:[n.jsx("span",{className:"font-semibold text-textLight",children:":"})," ",at.entry.subject||""]}),at.entry.fileName&&n.jsxs("p",{className:"text-xs text-textMuted",children:[" : ",at.entry.fileName]})]}),n.jsxs("div",{className:"mt-3 flex flex-wrap gap-2 justify-end",children:[Ds&&b&&n.jsx("button",{onClick:()=>b(at.parent.id),className:"px-4 py-2 rounded-full bg-navy text-white text-sm font-semibold hover:bg-navySecondary",children:'" '}),en&&n.jsx("span",{className:"text-xs text-textMuted font-semibold px-3 py-1 rounded-full bg-navySecondary",children:'"  '})]})]},`${at.parent.id}-${at.entry.id}`)}const _e=ge,Ie=typeof _e.reportNumber=="number"&&_e.reportNumber>0?_e.reportNumber:(((mt=_e.reportHistory)==null?void 0:mt.length)||0)+1;return n.jsxs("div",{className:`border ${A.tone} rounded-xl p-4`,children:[n.jsxs("div",{className:"grid md:grid-cols-4 gap-4 text-sm text-textMuted",children:[n.jsxs("div",{children:[n.jsx("p",{className:"text-xs uppercase text-gray-400",children:" "}),n.jsx("p",{className:"font-bold text-textLight",children:_e.odakanitNo||""})]}),n.jsxs("div",{children:[n.jsx("p",{className:"text-xs uppercase text-gray-400",children:" "}),n.jsx("p",{className:"font-bold text-textLight",children:_e.plaintiffName||""})]}),n.jsxs("div",{children:[n.jsx("p",{className:"text-xs uppercase text-gray-400",children:" "}),n.jsx("p",{className:"font-bold text-textLight",children:_e.insuredName||""})]}),n.jsxs("div",{children:[n.jsx("p",{className:"text-xs uppercase text-gray-400",children:" "}),n.jsxs("p",{className:"font-bold text-textLight",children:["#",Ie]})]})]}),A.id==="followup"&&n.jsx("div",{className:"mt-2 text-xs text-textMuted",children:(()=>{var Ds;const at=(Ds=_e.reportHistory)==null?void 0:Ds[_e.reportHistory.length-1],Zt=at!=null&&at.date?new Date(at.date).toLocaleDateString("he-IL"):_e.sentAt?new Date(_e.sentAt).toLocaleDateString("he-IL"):"";return`"  : #${(at==null?void 0:at.reportNumber)||Ie-1}  ${Zt}`})()}),n.jsxs("div",{className:"mt-3 flex flex-wrap gap-2 justify-end",children:[A.id==="finance"&&fs(_e)&&n.jsxs("button",{onClick:()=>Wn(_e),className:"px-3 py-2 rounded-full border border-red-200 text-red-600 text-sm font-semibold flex items-center gap-1 hover:bg-red-50",title:"  ",children:[n.jsx($s,{className:"w-4 h-4"}),""]}),A.action&&n.jsx("button",{onClick:()=>A.action&&A.action(_e),className:"px-4 py-2 rounded-full bg-navy text-white text-sm font-semibold hover:bg-navySecondary",children:A.actionLabel})]})]},_e.id)})})]},A.id))}),H&&n.jsxs("div",{className:"mb-8",children:[n.jsx("div",{className:"flex justify-between items-end mb-4",children:n.jsxs("h3",{className:"text-lg font-bold text-textLight flex items-center",children:[n.jsx(lh,{className:"w-6 h-6 mr-2 text-indigo-600"})," Active Case Folders"]})}),n.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[dt.length===0&&n.jsx("p",{className:"text-gray-400 italic col-span-3 text-center py-4",children:"No active finance folders."}),dt.map(A=>{var Ie;const ge=(()=>{switch(A.status){case"WAITING_FOR_INVOICES":return{badge:"bg-yellow-50 text-yellow-700",text:"Awaiting Finance Finalize",icon:n.jsx(Bt,{className:"text-yellow-500 w-5 h-5 animate-spin"})};case"TASK_ASSIGNED":return{badge:"bg-blue-50 text-blue-700",text:"Pending Lawyer Action",icon:n.jsx(ah,{className:"text-blue-500 w-5 h-5"})};case"READY_TO_SEND":return{badge:"bg-orange-50 text-orange-700",text:"Waiting for Lior",icon:n.jsx(Bt,{className:"text-orange-500 w-5 h-5 animate-spin"})};case"SENT":return{badge:"bg-green-50 text-green-700",text:"Completed",icon:n.jsx(oh,{className:"text-green-500 w-6 h-6"})};default:return{badge:"bg-navySecondary text-textMuted",text:A.status,icon:n.jsx(Bt,{className:"text-gray-400 w-5 h-5 animate-spin"})}}})(),_e=(Ie=ws.find(mt=>mt.id===A.createdBy))==null?void 0:Ie.name;return n.jsxs("div",{className:"bg-panel p-4 rounded-lg shadow border-t-4 relative border-indigo-100",children:[n.jsxs("div",{className:"flex justify-between items-start mb-2",children:[n.jsxs("h4",{className:"font-bold text-lg",children:["Case #",A.odakanitNo]}),ge.icon]}),n.jsxs("div",{className:"text-sm text-textMuted mb-1 flex items-center",children:[n.jsx(W0,{className:"w-4 h-4 mr-1"})," Assigned to: ",_e]}),n.jsx("div",{className:"text-xs text-textMuted mb-4",children:new Date(A.reportDate).toLocaleDateString()}),n.jsx("div",{className:"flex justify-end gap-2 mt-2",children:A.status==="SENT"?n.jsxs("button",{onClick:()=>l(A.id),className:"text-red-500 hover:bg-red-50 px-3 py-1 rounded text-sm flex items-center",children:[n.jsx($s,{className:"w-4 h-4 mr-1"})," Delete Folder"]}):n.jsx("span",{className:`text-xs font-bold px-2 py-1 rounded ${ge.badge}`,children:ge.text})})]},A.id)})]})]}),(H||ie)&&n.jsxs("div",{className:"bg-panel rounded-xl shadow-sm border border-borderDark overflow-hidden",children:[n.jsxs("div",{className:"p-4 border-b border-gray-100 bg-navySecondary/50 flex flex-wrap gap-3 items-center justify-between",children:[n.jsxs("h3",{className:"font-bold text-textLight flex items-center",children:[n.jsx(ih,{className:"w-4 h-4 mr-2 text-gray-400"})," ",ce?"Recycle Bin":"All Reports"]}),n.jsxs("div",{className:"flex items-center gap-3 flex-wrap justify-end",children:[ce&&Me&&n.jsx("span",{className:"text-xs text-textMuted",children:Me}),n.jsxs("div",{className:"relative w-full sm:w-72",children:[n.jsx(B0,{className:"w-4 h-4 text-gray-400 absolute left-3 top-1/2 -translate-y-1/2"}),n.jsx("input",{value:Pe,onChange:A=>Ke(A.target.value),placeholder:"     ",className:"w-full border border-borderDark rounded-full pl-9 pr-10 py-1.5 text-sm focus:ring-2 focus:ring-blue-200 outline-none"}),Pe&&n.jsx("button",{onClick:()=>Ke(""),className:"absolute right-3 top-1/2 -translate-y-1/2 text-gray-400 hover:text-red-500",children:n.jsx(Ht,{className:"w-4 h-4"})})]})]})]}),ie?n.jsxs("table",{className:"w-full text-left",children:[n.jsx("thead",{className:"bg-navySecondary text-textMuted text-xs uppercase tracking-wider font-semibold",children:n.jsxs("tr",{children:[n.jsx("th",{className:"p-4",children:"Insurer / Subject"}),H&&n.jsx("th",{className:"p-4",children:"Lawyer"}),n.jsx("th",{className:"p-4",children:"Status"}),n.jsx("th",{className:"p-4 text-right",children:"Action"})]})}),n.jsxs("tbody",{className:"divide-y divide-gray-100",children:[es.length===0&&n.jsx("tr",{children:n.jsx("td",{colSpan:H?4:3,className:"p-6 text-center text-gray-400 text-sm",children:Cn?"    .":"  ."})}),es.map(A=>{const ge=A.status==="READY_TO_SEND",_e=A.status==="SENT",Ie=!!A.__templateKey;return n.jsxs("tr",{className:`transition cursor-default ${ge?"bg-red-50":_e?"bg-green-50/50":"hover:bg-blue-50/30"}`,children:[n.jsxs("td",{className:"p-4",children:[n.jsx("div",{className:"font-bold text-textLight",children:A.insurerName||"Untitled"}),n.jsxs("div",{className:"text-xs text-textMuted",children:[A.marketRef," ",A.insuredName?` - ${A.insuredName}`:""]})]}),H&&n.jsx("td",{className:"p-4 text-sm text-textMuted font-medium",children:A.ownerName}),n.jsx("td",{className:"p-4",children:n.jsx("span",{className:`px-2.5 py-1 rounded-full text-[10px] font-bold uppercase tracking-wide shadow-sm border ${Be(A.status)}`,children:Ct(A.status)})}),n.jsx("td",{className:"p-4 text-right",children:n.jsxs("div",{className:"flex justify-end gap-2 flex-wrap",children:[n.jsxs(n.Fragment,{children:[n.jsxs("button",{onClick:()=>N(A.id),className:"text-xs bg-navySecondary hover:bg-borderDark px-3 py-1.5 rounded flex items-center gap-1",children:[n.jsx(uh,{className:"w-3 h-3"})," View Expenses"]}),n.jsxs("button",{onClick:()=>h(A),className:"text-xs bg-blue-50 text-blue-700 hover:bg-blue-100 px-3 py-1.5 rounded flex items-center gap-1",children:[n.jsx(Jl,{className:"w-3 h-3"})," Reminder"]}),n.jsxs("button",{onClick:()=>S(A),className:"text-xs bg-purple-50 text-purple-700 hover:bg-purple-100 px-3 py-1.5 rounded flex items-center gap-1",children:[n.jsx(_u,{className:"w-3 h-3"})," Add Note"]})]}),M&&!q&&!ce&&n.jsxs("button",{onClick:()=>!Ie&&P(A.id),disabled:Ie,className:`text-xs px-3 py-1.5 rounded flex items-center gap-1 ${Ie?"bg-navySecondary text-gray-400 cursor-not-allowed":"bg-red-50 text-red-700 hover:bg-red-100"}`,children:[n.jsx($s,{className:"w-3 h-3"})," Delete"]}),ce&&n.jsxs(n.Fragment,{children:[q&&n.jsx("button",{onClick:()=>o(A.id,{sentAt:new Date().toISOString()}),className:"text-green-600 hover:bg-green-50 px-3 py-1.5 rounded text-sm font-bold",children:"Restore"}),!q&&M&&n.jsx("button",{onClick:()=>U(A.id),className:"text-green-600 hover:bg-green-50 px-3 py-1.5 rounded text-sm font-bold",children:"Restore"})]})]})})]},A.id)})]})]}):n.jsx("div",{children:Un.length===0?n.jsx("div",{className:"p-6 text-center text-gray-400 text-sm",children:Cn?"    .":"  ."}):n.jsx("div",{className:"divide-y divide-gray-100",children:Un.map(A=>{const ge=A.latestDate?new Date(A.latestDate).toLocaleDateString("he-IL"):"-",_e=[...A.reports].sort((Ie,mt)=>{const at=Ie.reportDate?new Date(Ie.reportDate).getTime():0;return(mt.reportDate?new Date(mt.reportDate).getTime():0)-at});return n.jsxs("div",{className:"p-4",children:[n.jsxs("div",{className:"flex flex-wrap justify-between gap-3",children:[n.jsxs("div",{children:[n.jsx("p",{className:"text-xs uppercase text-gray-400",children:" "}),n.jsx("p",{className:"text-xl font-bold text-textLight",children:A.odakanitNo||""}),n.jsxs("p",{className:"text-xs text-textMuted",children:[" : ",n.jsx("span",{className:"font-semibold",children:A.plaintiffName||""}),"   : ",n.jsx("span",{className:"font-semibold",children:A.insuredName||""})]}),n.jsxs("p",{className:"text-xs text-gray-400",children:[" : ",ge]})]}),n.jsxs("div",{className:"text-right",children:[n.jsx("p",{className:"text-xs text-textMuted",children:'" '}),n.jsx("p",{className:"text-2xl font-bold text-textLight",children:A.reports.length}),n.jsx("button",{onClick:()=>it(Ie=>Ie===A.key?null:A.key),className:"mt-2 px-4 py-1.5 text-sm font-semibold rounded-full border border-borderDark text-textLight hover:bg-navySecondary",children:Ye===A.key?" ":" "})]})]}),Ye===A.key&&n.jsx("div",{className:"mt-4 bg-navySecondary border border-borderDark rounded-xl overflow-hidden",children:n.jsxs("table",{className:"w-full text-sm",children:[n.jsx("thead",{className:"bg-navySecondary text-textMuted text-xs uppercase tracking-wide",children:n.jsxs("tr",{children:[n.jsx("th",{className:"p-3 text-left",children:" "}),n.jsx("th",{className:"p-3 text-left",children:" "}),n.jsx("th",{className:"p-3 text-left",children:" "}),n.jsx("th",{className:"p-3 text-left",children:""}),n.jsx("th",{className:"p-3 text-right",children:""})]})}),n.jsx("tbody",{className:"divide-y divide-gray-200",children:_e.map(Ie=>{const mt=Ie.status==="READY_TO_SEND",at=Ie.status==="SENT",Zt=!!Ie.__templateKey;return n.jsxs("tr",{className:`bg-panel ${mt?"bg-red-50":at?"bg-green-50/60":""}`,children:[n.jsx("td",{className:"p-3",children:Ie.reportDate?new Date(Ie.reportDate).toLocaleDateString("he-IL"):""}),n.jsx("td",{className:"p-3",children:Ie.plaintiffName||""}),n.jsx("td",{className:"p-3",children:Ie.insuredName||""}),n.jsx("td",{className:"p-3",children:n.jsx("span",{className:`px-2.5 py-1 rounded-full text-[10px] font-bold uppercase tracking-wide shadow-sm border ${Be(Ie.status)}`,children:Ct(Ie.status)})}),n.jsx("td",{className:"p-3 text-right",children:n.jsxs("div",{className:"flex justify-end gap-2 flex-wrap",children:[n.jsxs("button",{onClick:()=>s(Ie.id),className:"text-lpBlue hover:bg-blue-50 px-3 py-1.5 rounded transition font-bold text-xs flex items-center",children:["Open ",n.jsx(is,{className:"w-3 h-3 ml-1"})]}),M&&!q&&!ce&&n.jsxs("button",{onClick:()=>!Zt&&P(Ie.id),disabled:Zt,className:`text-xs px-3 py-1.5 rounded flex items-center gap-1 ${Zt?"bg-navySecondary text-gray-400 cursor-not-allowed":"bg-red-50 text-red-700 hover:bg-red-100"}`,children:[n.jsx($s,{className:"w-3 h-3"})," Delete"]}),ce&&n.jsxs(n.Fragment,{children:[q&&n.jsx("button",{onClick:()=>o(Ie.id,{sentAt:new Date().toISOString()}),className:"text-green-600 hover:bg-green-50 px-3 py-1.5 rounded text-xs font-bold",children:"Restore"}),!q&&M&&n.jsx("button",{onClick:()=>U(Ie.id),className:"text-green-600 hover:bg-green-50 px-3 py-1.5 rounded text-xs font-bold",children:"Restore"})]})]})})]},Ie.id)})})]})})]},A.key)})})})]}),!H&&n.jsx("div",{className:"fixed bottom-8 right-8",children:n.jsx("button",{onClick:r,className:"bg-navy text-white p-4 rounded-full shadow-xl hover:bg-navySecondary transition transform hover:scale-110",children:n.jsx(L0,{className:"w-6 h-6"})})})]})]})},Wv=({onLogin:e})=>{const[t,s]=g.useState(""),[r,a]=g.useState(""),[o,l]=g.useState(!1),c=async()=>{if(!t||!r){alert("    .");return}l(!0);try{const i=await fetch("/api/login",{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({username:t,password:r})});if(!i.ok){const p=await i.json().catch(()=>({})),y=(p==null?void 0:p.error)||"    .";alert(y);return}const u=await i.json();u&&u.user?e(u.user):alert("Login response was invalid.")}catch(i){console.error("Login failed",i),alert("  (  ?).  .")}finally{l(!1)}};return n.jsx("div",{className:"min-h-screen flex items-center justify-center px-4 bg-bgDark",children:n.jsxs("div",{className:"w-full max-w-sm bg-panel border border-borderDark rounded-2xl p-10 text-center shadow-2xl",children:[n.jsx("div",{className:"mx-auto mb-6 h-20 w-20 rounded-full bg-gold/20 border border-gold flex items-center justify-center text-4xl font-bold text-gold shadow-lg",children:"LP"}),n.jsx("div",{className:"text-sm tracking-[0.5em] text-gold uppercase mb-2",children:"Lloyd's"}),n.jsx("div",{className:"text-3xl font-serif text-textLight mb-1",children:"REPORT"}),n.jsx("div",{className:"text-xs text-textMuted uppercase tracking-[0.4em] mb-8",children:"Builder System"}),n.jsxs("div",{className:"space-y-4 text-left",children:[n.jsx("label",{className:"text-xs uppercase text-textMuted tracking-[0.2em]",children:"Username"}),n.jsxs("div",{className:"relative",children:[n.jsx(z0,{className:"w-4 h-4 text-gold absolute left-3 top-1/2 -translate-y-1/2"}),n.jsx("input",{className:"w-full bg-navy border border-borderDark rounded-full py-3 pl-10 pr-4 text-textLight placeholder-textMuted focus:outline-none focus:ring-2 focus:ring-gold/50",placeholder:"Username",value:t,onChange:i=>s(i.target.value)})]}),n.jsx("label",{className:"text-xs uppercase text-textMuted tracking-[0.2em]",children:"Password"}),n.jsxs("div",{className:"relative",children:[n.jsx(M0,{className:"w-4 h-4 text-gold absolute left-3 top-1/2 -translate-y-1/2"}),n.jsx("input",{type:"password",className:"w-full bg-navy border border-borderDark rounded-full py-3 pl-10 pr-4 text-textLight placeholder-textMuted focus:outline-none focus:ring-2 focus:ring-gold/50",placeholder:"Password",value:r,onChange:i=>a(i.target.value)})]})]}),n.jsxs("button",{onClick:c,disabled:o,className:"mt-8 w-full bg-navy text-gold border border-gold py-3 rounded-full font-semibold tracking-wide flex items-center justify-center gap-2 hover:bg-navySecondary transition-colors disabled:opacity-60 disabled:cursor-not-allowed",children:[o?"Signing in":"Sign In"," ",n.jsx(ah,{className:"w-4 h-4"})]}),n.jsx("div",{className:"mt-6 text-[11px] text-textMuted tracking-[0.3em] uppercase",children:"Lior Perry Law Office & Notary  2024"})]})})},zv=()=>{var ee,de;const[e,t]=g.useState(null),[s,r]=g.useState(!1),[a,o]=g.useState(()=>_v()),[l,c]=g.useState(()=>Lv()),[i,u]=g.useState(null),p=g.useRef(l),y=g.useRef(i),[b,w]=g.useState(null);console.log("AppInner render",{currentUser:e,view:a,reportsCount:l.length});const R=g.useRef(!1),[E,W]=g.useState(null),[N,h]=g.useState([]),[S,P]=g.useState(!1);e==null||e.role;const[U,V]=g.useState(()=>{if(typeof window>"u")return[];try{const d=window.localStorage.getItem(ft.NOTIFICATIONS),m=d?JSON.parse(d):[];return Array.isArray(m)?m.filter(x=>x&&typeof x.id=="string"&&typeof x.message=="string"&&typeof x.createdAt=="string"):[]}catch{return[]}}),[X,te]=g.useState(!1),[G,ae]=g.useState(!1),[j,F]=g.useState([]),[L,O]=g.useState(null),[H,M]=g.useState(()=>{if(typeof window>"u")return{};try{const d=localStorage.getItem("favoriteProviders");return d?JSON.parse(d):{}}catch(d){return console.error("Failed to load favorite providers",d),{}}});g.useEffect(()=>{let d=!1;return fetch("/api/me",{credentials:"include"}).then(m=>m.ok?m.json():null).then(m=>{!d&&(m!=null&&m.user)&&t(m.user)}).catch(()=>{}).finally(()=>{d||r(!0)}),()=>{d=!0}},[]),g.useEffect(()=>{if(!(typeof window>"u"))try{window.localStorage.setItem(ft.NOTIFICATIONS,JSON.stringify(U))}catch{}},[U]);const[I,D]=g.useState(null),[J,ue]=g.useState(""),[ce,le]=g.useState(null),[fe,Ee]=g.useState(""),[ve,$e]=g.useState("LAWYER"),[Pe,Ke]=g.useState(!1),[Ye,it]=g.useState(!1),[q,se]=g.useState(!1),[C,re]=g.useState(!1),[Q,he]=g.useState(!1),[Fe,je]=g.useState(!1),[Te,et]=g.useState(!1),[Ge,He]=g.useState(!1),[Z,Ne]=g.useState(!1),[xe,be]=g.useState(null),[Oe,Ce]=g.useState(null),[qe,dt]=g.useState(()=>{if(typeof window>"u")return[];try{const d=localStorage.getItem("caseTemplates");return d?JSON.parse(d):[]}catch(d){return console.error("Failed to load case templates",d),[]}}),[Ue,nt]=g.useState(null),[jt,z]=g.useState(""),[ie,De]=g.useState(!1),[Me,pe]=g.useState(null),[Le,st]=g.useState(void 0);g.useEffect(()=>{if(!i&&b!==null){w(null);return}i&&b&&i.id!==b&&w(null)},[i,b]),g.useEffect(()=>{typeof window>"u"||lv()||l.length&&Be(d=>{const m=Mc(d,l);return Dn(m),ov(),m})},[l]);const[ne,Be]=g.useState(()=>{const d=rv(),m=av(d);return m!==d&&Dn(m),m}),Ct=g.useRef(ne);g.useEffect(()=>{p.current=l,y.current=i,Ct.current=ne},[l,i,ne]),g.useEffect(()=>{if(typeof window>"u"||!e)return;const d=m=>{const x=p.current,k=y.current;if(Ct.current,x&&k){const v=[...x],_=v.findIndex(B=>B.id===k.id),$=_>=0?{...v[_],...k}:k;_>=0?v[_]=$:v.push($);try{localStorage.setItem(ft.REPORTS,JSON.stringify(v))}catch(B){console.error("beforeunload save failed",B)}}(x!=null&&x.length||k)&&(m.preventDefault(),m.returnValue="")};return window.addEventListener("beforeunload",d),()=>window.removeEventListener("beforeunload",d)},[e]),g.useEffect(()=>{a!=="PREVIEW"&&P(!1)},[a]);const _t=d=>d?d==="SUB_ADMIN"?"OPS":d==="FINANCE"||d==="LAWYER"||d==="ADMIN"?d:"LAWYER":"LAWYER",We=d=>d.deletedAt?Date.now()-new Date(d.deletedAt).getTime()>=Uh:d.status==="SENT"&&d.sentAt?Date.now()-new Date(d.sentAt).getTime()>=Hh:!1;g.useEffect(()=>{const d=()=>{c(x=>x.filter(k=>!We(k)))};d();const m=setInterval(d,60*60*1e3);return()=>clearInterval(m)},[]),g.useEffect(()=>{if(!G)return;const d=setInterval(()=>{if(!l.length)return;const m=l.filter(v=>v.status==="READY_TO_SEND").length,x=l.filter(v=>v.status==="SENT").length,k=`Daily summary: ${m} ready to send, ${x} sent reports.`;V(v=>[{id:`daily-${Date.now()}`,message:k,createdAt:new Date().toISOString(),severity:"info"},...v])},1e3*60*60*12);return()=>clearInterval(d)},[G,l]),g.useEffect(()=>{try{localStorage.setItem("caseTemplates",JSON.stringify(qe))}catch(d){console.error("Failed to persist case templates",d)}},[qe]),g.useEffect(()=>{try{localStorage.setItem("favoriteProviders",JSON.stringify(H))}catch(d){console.error("Failed to persist favorites",d)}},[H]);const Qt=async d=>{if(!e||!i){He(!0),be(null),Ce({title:"   ",bullets:["           .","  ,         .","  ,          ."]});return}const m=a==="STEP2"?2:a==="PREVIEW"?3:1,x=a==="STEP1"?"Step1":a==="STEP2"?"Step2Draft":a==="PREVIEW"?"Step3Preview":"Dashboard",k={step:m,role:_t(e.role),screen:x,section:m===2&&Le?Le:void 0},v={hebrewApproved:i.hebrewWorkflowStatus==="HEBREW_APPROVED",hasTranslation:!!i.isTranslated,translationOutdated:!!i.translationStale,toneRiskRun:!!i.toneRiskLastRunAt,expensesLastUpdatedAt:i.expensesSnapshotAt||void 0};He(!0),Ne(!0),be(null);try{const _=await tN({intent:d,context:k,reportMeta:v});Ce(_)}catch(_){console.error("Smart assistant request failed",_),be("REQUEST_FAILED"),Ce(null)}finally{Ne(!1)}},xn=(d,m)=>{if(!d||!m)return[];const x=[];d.translationStale&&x.push({id:"translation-outdated",kind:"TRANSLATION_OUTDATED",label:"       (translationStale=true).     .",intent:"pre_send_checks"});const k=m.role;return(k==="LAWYER"||k==="ADMIN")&&!d.toneRiskLastRunAt&&x.push({id:"tone-risk-not-run",kind:"TONE_RISK_NOT_RUN",label:"   Tone & Risk  .       .",intent:"explain_tone_risk"}),x};g.useEffect(()=>{let d=!1;return(async()=>{var _;if(typeof window>"u")return;const x=l.filter($=>!!$.expensesSheetId&&!$.expensesHtml&&!$.expensesHtmlMissing);if(!x.length)return;let k=!1;const v=[...l];for(const $ of x)try{const B=await Xe.getSheet($.expensesSheetId);if(B&&B.sheet&&((_=B.lineItems)!=null&&_.length)){const Y=Xe.buildCumulativeExpensesSnapshot(B.sheet.id,new Date().toISOString());if(!Y)continue;const{effectiveSheet:oe,allLines:we,opts:ye}=Y,{html:Ve}=ri(oe,we,ye);if(Ve){const Je=v.findIndex(Qe=>Qe.id===$.id);Je!==-1&&(v[Je]={...v[Je],expensesHtml:Ve},k=!0)}}else{const Y=v.findIndex(oe=>oe.id===$.id);Y!==-1&&(v[Y]={...v[Y],expensesHtmlMissing:!0},k=!0)}}catch(B){console.error("Failed to migrate expensesHtml for report",$.id,B);const Y=v.findIndex(oe=>oe.id===$.id);Y!==-1&&(v[Y]={...v[Y],expensesHtmlMissing:!0},k=!0)}!d&&k&&c(v)})(),()=>{d=!0}},[l]),g.useEffect(()=>{if(!(typeof window>"u"))try{localStorage.setItem(ft.REPORTS,JSON.stringify(l))}catch(d){console.error("Failed to persist reports",d)}},[l]),g.useEffect(()=>{typeof window>"u"||(e?localStorage.setItem(ft.USER,e.username):localStorage.removeItem(ft.USER))},[e]),g.useEffect(()=>{typeof window>"u"||localStorage.setItem(ft.VIEW,a)},[a]),g.useEffect(()=>{typeof window>"u"||(i?localStorage.setItem(ft.CURRENT_REPORT,i.id):localStorage.removeItem(ft.CURRENT_REPORT))},[i]),g.useEffect(()=>{if(typeof window>"u"||R.current)return;const d=localStorage.getItem(ft.CURRENT_REPORT);if(!d){R.current=!0;return}const m=l.find(x=>x.id===d);if(m){const x=!!(m.expensesSheetId||m.expensesHtml);let k=m;if(x&&Array.isArray(m.selectedSections)&&!m.selectedSections.some(v=>Qr(v))){const v=[...m.selectedSections],_=v.includes("Update"),$=v.includes("Recommendations"),B=_?Math.min(v.indexOf("Update")+1,$?v.indexOf("Recommendations"):v.length):0;v.splice(B,0,Ja),k={...m,selectedSections:Array.from(new Set(v))}}u(k)}R.current=!0},[l,e]),g.useEffect(()=>{a==="DASHBOARD"||a==="CASE_FOLDER"||i||(o("DASHBOARD"),typeof window<"u"&&(localStorage.setItem(ft.VIEW,"DASHBOARD"),localStorage.removeItem(ft.CURRENT_REPORT)))},[i,a]);const hn=()=>({id:Date.now().toString(),createdBy:e.id,ownerName:e.name,ownerEmail:e.email,reportNumber:1,reportDate:new Date().toISOString(),updatedAt:new Date().toISOString(),status:"DRAFT",reportSubject:"",recipientId:"1",insurerName:"",lineSlipNo:"",marketRef:"",certificateRef:"",insuredName:"",plaintiffName:"",plaintiffTitle:"Plaintiff",policyPeriodStart:"",policyPeriodEnd:"",retroStart:"",retroEnd:"",sentAt:void 0,reportHistory:[],selectedTimeline:"standard",filenameTag:fh[0],selectedSections:["Update","Recommendations"],content:{},translatedContent:{},invoiceFiles:[],isWaitingForInvoices:!1,requiresExpenses:!1,isTranslated:!1,expensesItems:[],expenseWorksheet:Ps(),reportNotes:[],complaintAnalysis:void 0,attachPolicyAsAppendix:!0}),Cs=({odakanitNo:d,reports:m,caseFolder:x})=>{var $;const k=Se(d);if(!k)return 1;const v=[];return($=x==null?void 0:x.sentReports)!=null&&$.length&&x.sentReports.forEach(B=>{typeof B.reportNo=="number"&&B.reportNo>0&&v.push(B.reportNo)}),m.forEach(B=>{var Y;if(Se(B.odakanitNo)===k&&B.status==="SENT")if(typeof B.reportNumber=="number"&&B.reportNumber>0)v.push(B.reportNumber);else{const oe=(((Y=B.reportHistory)==null?void 0:Y.length)||0)+1;v.push(oe)}}),(v.length?Math.max(...v):0)+1},sr=d=>{const m=d.createdBy||"unknown",x=d.odakanitNo||d.marketRef||d.id,k=(d.plaintiffName||"unknown").toLowerCase();return`${m}::${x}::${k}`},Cn=d=>{const m=sr(d),x={caseKey:m,ownerId:d.createdBy,ownerName:d.ownerName,odakanitNo:d.odakanitNo,plaintiffName:d.plaintiffName,plaintiffTitle:d.plaintiffTitle,insurerName:d.insurerName,lineSlipNo:d.lineSlipNo,marketRef:d.marketRef,certificateRef:d.certificateRef,insuredName:d.insuredName,policyPeriodStart:d.policyPeriodStart,policyPeriodEnd:d.policyPeriodEnd,retroStart:d.retroStart,retroEnd:d.retroEnd,lastUpdated:new Date().toISOString()};dt(k=>k.find(_=>_.caseKey===m)?k.map(_=>_.caseKey===m?x:_):[...k,x])},rr=d=>{if(!e)return;const m=qe.find(k=>k.caseKey===d&&k.ownerId===e.id);if(!m)return;const x={...hn(),odakanitNo:m.odakanitNo||"",insurerName:m.insurerName||"",lineSlipNo:m.lineSlipNo||"",marketRef:m.marketRef||"",certificateRef:m.certificateRef||"",insuredName:m.insuredName||"",plaintiffName:m.plaintiffName||"",plaintiffTitle:m.plaintiffTitle||"Plaintiff",policyPeriodStart:m.policyPeriodStart||"",policyPeriodEnd:m.policyPeriodEnd||"",retroStart:m.retroStart||"",retroEnd:m.retroEnd||""};u(x),o("STEP1")},es=d=>{var oe;if(!e)return;const m=Un(d);if(!m||m.createdBy!==e.id||(((oe=m.reportHistory)==null?void 0:oe.length)||0)===0||m.status!=="SENT")return;const x=m.reportHistory[m.reportHistory.length-1];if(!x)return;const v=x.snapshot||m,_=v.selectedSections&&v.selectedSections.length?[...v.selectedSections]:[...m.selectedSections||[]],$=_.length?_:["Update","Recommendations"],B=new Date().toISOString(),Y={...m,reportDate:B,updatedAt:B,status:"DRAFT",sentAt:void 0,reportNotes:[],content:{},translatedContent:{},executiveSummary:void 0,complaintAnalysis:void 0,expensesItems:[],expensesSum:void 0,paymentRecommendation:void 0,expenseWorksheet:Ps(),invoiceFiles:[],expensesSourceFile:void 0,requiresExpenses:!1,isWaitingForInvoices:!1,isTranslated:!1,selectedEmailTemplate:void 0,emailBodyDraft:void 0,fileNameTitles:[],deletedAt:void 0,deletedBy:void 0,selectedSections:$,reportHistory:[...m.reportHistory||[]]};Y.insurerName=v.insurerName||"",Y.lineSlipNo=v.lineSlipNo||"",Y.marketRef=v.marketRef||"",Y.certificateRef=v.certificateRef||"",Y.insuredName=v.insuredName||"",Y.plaintiffName=v.plaintiffName||"",Y.plaintiffTitle=v.plaintiffTitle||m.plaintiffTitle,Y.policyPeriodStart=v.policyPeriodStart||"",Y.policyPeriodEnd=v.policyPeriodEnd||"",Y.retroStart=v.retroStart||"",Y.retroEnd=v.retroEnd||"",Y.filenameTag=v.filenameTag||Y.filenameTag,Y.fileNameTitles=[],Y.selectedTimeline=v.selectedTimeline||Y.selectedTimeline,Y.selectedTimelineImage=v.selectedTimelineImage,Y.odakanitNo=v.odakanitNo||m.odakanitNo,Y.recipientId=v.recipientId||m.recipientId,c(we=>we.map(ye=>ye.id===m.id?Y:ye)),u(Y),Cn(Y),o("STEP1")},Un=d=>l.find(m=>m.id===d),fs=(d,m)=>{if(d.status!==m.status||d.hebrewWorkflowStatus!==m.hebrewWorkflowStatus||d.insuredName!==m.insuredName||d.plaintiffName!==m.plaintiffName||d.insurerName!==m.insurerName||d.odakanitNo!==m.odakanitNo||d.marketRef!==m.marketRef||d.lineSlipNo!==m.lineSlipNo||d.certificateRef!==m.certificateRef||d.policyPeriodStart!==m.policyPeriodStart||d.policyPeriodEnd!==m.policyPeriodEnd||d.retroStart!==m.retroStart||d.retroEnd!==m.retroEnd||d.reportSubject!==m.reportSubject||d.executiveSummary!==m.executiveSummary)return!0;const x=(k,v)=>JSON.stringify(k)===JSON.stringify(v);return!x(d.content,m.content)||!x(d.translatedContent,m.translatedContent)||!x(d.expenseWorksheet,m.expenseWorksheet)||!x(d.expensesItems,m.expensesItems)||d.expensesSum!==m.expensesSum||d.paymentRecommendation!==m.paymentRecommendation||!x(d.complaintAnalysis,m.complaintAnalysis)||!x(d.reportReview,m.reportReview)},Wn=(d,m)=>{d.odakanitNo&&Be(x=>{const k=Md(x,d,m);return Dn(k),k})},A=(d,m,x,k)=>{d.odakanitNo&&Be(v=>{const _=Bh(v,d,m,x,k);return Dn(_),_})},ge=d=>{var x;return(x=d==null?void 0:d.sentReports)!=null&&x.length?d.sentReports.map((k,v)=>{var Y,oe;const _=typeof k.reportNo=="number"&&k.reportNo>0?k.reportNo:v+1,$=k.sentAt||((Y=k.snapshot)==null?void 0:Y.reportDate)||"",B=((oe=k.snapshot)==null?void 0:oe.reportSubject)||k.fileName||"";return!B||!$?null:{id:k.reportId,reportNumber:_,subject:B,date:$,sent:!0,fileName:k.fileName,snapshot:k.snapshot}}).filter(k=>!!k).sort((k,v)=>k.reportNumber-v.reportNumber):[]},_e=(d,m)=>{const x=d.reportReview??{status:"DRAFT",issues:[]};return{...d,reportReview:m(x)}},Ie=d=>{Dt(d,m=>{const x=(e==null?void 0:e.id)||"unknown",k=new Date().toISOString();return{..._e(m,_=>({..._,status:"SUBMITTED",submittedAt:k,submittedByUserId:_.submittedByUserId||x})),hebrewWorkflowStatus:"HEBREW_SUBMITTED"}})},mt=d=>{(e==null?void 0:e.role)==="ADMIN"&&Dt(d,m=>{const x=(e==null?void 0:e.id)||"unknown",k=new Date().toISOString();return{..._e(m,_=>({..._,status:"APPROVED",reviewedAt:k,reviewedByUserId:x})),hebrewWorkflowStatus:"HEBREW_APPROVED"}})},at=(d,m)=>{m.length&&Dt(d,x=>{const k=(e==null?void 0:e.id)||"unknown",v=new Date().toISOString();return{..._e(x,$=>({...$,status:"CHANGES_REQUESTED",reviewedAt:v,reviewedByUserId:k,issues:[...$.issues,...m.map(B=>({id:`issue-${Date.now()}-${Math.random().toString(36).slice(2)}`,createdAt:v,createdByUserId:k,sectionKey:B.sectionKey,severity:B.severity,type:B.type,title:B.title,instruction:B.instruction,status:"OPEN"}))]})),hebrewWorkflowStatus:"HEBREW_CHANGES_REQUESTED"}})},Zt=(d,m)=>{Dt(d,x=>{const k=new Date().toISOString();return _e(x,v=>({...v,issues:v.issues.map(_=>_.id===m&&_.status!=="DONE"?{..._,status:"DONE",doneAt:k}:_)}))})},Ds=d=>{(e==null?void 0:e.role)==="ADMIN"&&Dt(d,m=>{const x=new Date().toISOString();return _e(m,k=>({...k,issues:k.issues.map(v=>(v.origin??"INTERNAL")==="EXTERNAL"&&v.status!=="DONE"?{...v,status:"DONE",doneAt:x}:v)}))})},en=d=>{var x;return d?((x=d.reportReview)==null?void 0:x.status)==="APPROVED"||d.hebrewWorkflowStatus==="HEBREW_APPROVED":!1},Dt=(d,m)=>{const x=new Date().toISOString();let k=null,v=null;if(c(_=>_.map($=>{var ct;if($.id!==d)return $;const B=Se($.odakanitNo),Y=B&&ne?ne[B]:void 0,oe=yt($,Y||void 0),we=!!(Y!=null&&Y.closedAt),ye=(e==null?void 0:e.role)==="ADMIN"&&b===$.id&&!we;if((e==null?void 0:e.role)==="LAWYER"&&$.status==="SENT"&&!ye)return pl({reason:"LAWYER_SENT_BLOCK",reportId:$.id,odakanitNo:$.odakanitNo,role:e==null?void 0:e.role,status:$.status,lockType:oe.lockType}),$;if(!ye&&oe.isLocked)return pl({reason:ne&&((ct=ne[B])!=null&&ct.closedAt)?"CASE_CLOSED_BLOCK":"LOCKSTATE_BLOCK",reportId:$.id,odakanitNo:$.odakanitNo,role:e==null?void 0:e.role,status:$.status,lockType:oe.lockType}),$;const Je=m($);return k=$,v=Je,fs($,Je)?{...Je,updatedAt:x}:Je})),k&&v&&k.odakanitNo&&v.odakanitNo){const _=k.odakanitNo.trim(),$=v.odakanitNo.trim();_&&$&&_!==$&&Be(B=>{let Y={...B};const oe=Y[_];if(oe){const we=oe.reportIds.filter(ye=>ye!==v.id);Y[_]={...oe,reportIds:we}}return Y=Md(Y,v,x),Dn(Y),Y})}u(_=>{if(!_||_.id!==d)return _;const $=m(_);return fs(_,$)?{...$,updatedAt:x}:$})},Do=(d,m,x)=>{m.length&&(e==null?void 0:e.role)==="ADMIN"&&Dt(d,k=>{const v=(e==null?void 0:e.id)||"unknown",_=new Date().toISOString();return{..._e(k,B=>({...B,status:"CHANGES_REQUESTED",reviewedAt:_,reviewedByUserId:v,issues:[...B.issues,...m.map(Y=>({id:`issue-${Date.now()}-${Math.random().toString(36).slice(2)}`,createdAt:_,createdByUserId:v,sectionKey:Y.sectionKey,severity:Y.severity,type:Y.type,title:Y.title,instruction:Y.instruction,status:"OPEN",origin:"EXTERNAL",externalRefId:x,externalAction:Y.externalAction??"ENGLISH_ONLY"}))]})),postSendFeedbackMeta:{...k.postSendFeedbackMeta||{},lastFeedbackAt:_}}})},xa=d=>{(e==null?void 0:e.role)==="ADMIN"&&Dt(d,m=>{const x=new Date().toISOString(),k=m.reportReview??{status:"DRAFT",issues:[]};return{...m,hebrewWorkflowStatus:"HEBREW_REOPENED_EXTERNAL",reportReview:{...k,status:k.status==="CHANGES_REQUESTED"?k.status:"CHANGES_REQUESTED"},postSendFeedbackMeta:{...m.postSendFeedbackMeta||{},reopenedDueToFeedbackAt:x}}})},jr=d=>{V(m=>[d,...m])},Ei=d=>{F(m=>m.some(x=>x.reportId===d)?m:[...m,{reportId:d}]),O(d)},ki=d=>{F(m=>m.filter(x=>x.reportId!==d)),O(m=>m===d?null:m)},Ai=(d,m)=>{M(x=>{const k=x[d]||[];return k.some(v=>v.serviceProvider.toLowerCase()===m.serviceProvider.toLowerCase()&&v.category===m.category)?x:{...x,[d]:[m,...k]}})},Ii=(d,m)=>{M(x=>{const k=x[d]||[];return{...x,[d]:k.filter(v=>v.id!==m)}})},Yt=d=>{var m;if(i){const x=Se(i.odakanitNo),k=x&&ne?ne[x]:void 0,v=yt(i,k||void 0),_=!!(k!=null&&k.closedAt),$=(e==null?void 0:e.role)==="ADMIN"&&b===i.id&&!_;if((e==null?void 0:e.role)==="LAWYER"&&i.status==="SENT"&&!$){pl({reason:"LAWYER_SENT_BLOCK",reportId:i.id,odakanitNo:i.odakanitNo,role:e==null?void 0:e.role,status:i.status,lockType:v.lockType});return}if(!$&&v.isLocked){pl({reason:ne&&x&&((m=ne[x])!=null&&m.closedAt)?"CASE_CLOSED_BLOCK":"LOCKSTATE_BLOCK",reportId:i.id,odakanitNo:i.odakanitNo,role:e==null?void 0:e.role,status:i.status,lockType:v.lockType});return}const Y=i;let oe={...i,...d};if(Y.translationBaseHash&&d.content){const ye=Y.translationBaseHash,Ve=Vp(d.content);Ve&&Ve!==ye&&(oe={...oe,translationStale:!0})}Y.updateAutoSummarySourceReportId&&d.content&&d.content.Update!==void 0&&(oe={...oe,updateAutoSummaryEdited:!0});const we=fs(Y,oe);u(we?{...oe,updatedAt:new Date().toISOString()}:oe)}},dn=()=>{i&&c(d=>{const x=d.find(k=>k.id===i.id)?d.map(k=>k.id===i.id?i:k):[...d,i];return Wn(i),x})},tn=()=>{if(!i)return;const d=Pc(i.content),m=Pc(i.translatedContent);Yt({content:d,translatedContent:m})},Ti=async()=>{if(i){if(!en(i)){window.alert("       .");return}it(!0);try{const d=Pc(i.content),m={};for(const k of Object.keys(d)){const v=d[k];if(v){const _=await Cd(v);m[k]=li(_)}}const x=Vp(d);Yt({content:d,translatedContent:m,isTranslated:!0,translationBaseHash:x,translationStale:!1}),window.alert("  .")}catch(d){console.error("Translate failed",d),window.alert(" .    .")}finally{it(!1)}}},Ri=async()=>{if(!i)return;if(!i.isTranslated){window.alert("    (Auto-Translate)   .");return}const d=i.translatedContent||{},m=Object.keys(d).filter(x=>!x.toLowerCase().includes("expenses")&&typeof d[x]=="string"&&d[x].trim().length>0);if(!m.length){window.alert("   .");return}se(!0);try{const x={...d},k=[];for(const v of m){const _=d[v];if(!(!_||!_.trim()))try{const{protectedText:$,map:B}=zh(_),Y=await xh($),oe=Vh(Y||$,B),we=Wh(oe);x[v]=li(we)}catch($){console.error(`Improve English failed for section "${v}"`,$),k.push(v),x[v]=_}}if(Yt({translatedContent:x}),dn(),!k.length)window.alert("   .");else{const v=k.map(_=>{var $;return Dd(_,($=i.expertSummaryMode)==null?void 0:$[_])});window.alert(`   .
  : ${v.join(", ")}.
   .`)}}catch(x){console.error("Improve English failed",x),window.alert("  .    .")}finally{se(!1)}},Er=d=>{const m=new Set(["lidor@lp-law.co.il"]),x=new Set(["reports@lp-law.co.il"]);if(d.ownerEmail)x.add(d.ownerEmail);else{const k=ws.find(v=>v.id===d.createdBy);k!=null&&k.email&&x.add(k.email)}return{to:Array.from(m),cc:Array.from(x)}},xs=d=>ei(d),Ci=d=>({...d,invoiceFiles:[],policyFile:void 0,expensesSourceFile:void 0}),Di=(d,m)=>{var v,_,$;const x=d.content?Dr(d.content):{},k=d.translatedContent?Dr(d.translatedContent):{};return{createdAt:m,reportDate:d.reportDate,subject:((v=d.emailSubjectDraft)==null?void 0:v.trim())||xs(d),status:"SENT",odakanitNo:d.odakanitNo,recipientId:d.recipientId,insurerName:d.insurerName,lineSlipNo:d.lineSlipNo,marketRef:d.marketRef,insuredName:d.insuredName,plaintiffName:d.plaintiffName,plaintiffTitle:d.plaintiffTitle,policyPeriodStart:d.policyPeriodStart,policyPeriodEnd:d.policyPeriodEnd,retroStart:d.retroStart,retroEnd:d.retroEnd,filenameTag:d.filenameTag,fileNameTitles:d.fileNameTitles?[...d.fileNameTitles]:void 0,selectedSections:[...d.selectedSections||[]],content:x,translatedContent:k,executiveSummary:d.executiveSummary,complaintAnalysis:d.complaintAnalysis?Dr(d.complaintAnalysis):void 0,requiresExpenses:!!d.requiresExpenses,isWaitingForInvoices:!!d.isWaitingForInvoices,isTranslated:!!d.isTranslated,selectedTimeline:d.selectedTimeline,selectedTimelineImage:d.selectedTimelineImage,expensesItems:(_=d.expensesItems)!=null&&_.length?Dr(d.expensesItems):void 0,expenseWorksheet:d.expenseWorksheet?Dr(d.expenseWorksheet):void 0,expensesSum:d.expensesSum,paymentRecommendation:d.paymentRecommendation,reportNotes:($=d.reportNotes)!=null&&$.length?Dr(d.reportNotes):void 0,ownerName:d.ownerName,ownerEmail:d.ownerEmail}},kr=(d,m,x)=>{var $,B;const k=(($=d.emailSubjectDraft)==null?void 0:$.trim())||xs(d),v=((B=d.reportHistory)==null?void 0:B.length)||0,_=typeof d.reportNumber=="number"&&d.reportNumber>0?d.reportNumber:v+1;return{id:Ln(),reportNumber:_,subject:k,date:x,sent:!0,fileName:m,snapshot:Di(d,x)}},ha=d=>{if(!d)return d;const m="",x="";return d.startsWith(m)?d:`${m}${d}${x}`},ga=(d,m,x)=>{if(typeof window>"u")return;const k=d.to.join(";"),v=B=>encodeURIComponent(B),_=[];d.cc.length&&_.push(`cc=${v(d.cc.join(";"))}`),_.push(`subject=${v(m)}`),_.push(`body=${v(ha(x))}`);const $=`mailto:${k}?${_.join("&")}`;window.location.href=$},Lo=async()=>{if(i){Ke(!0);try{const d=await jc(i),m=cr(i),x=URL.createObjectURL(d),k=document.createElement("a");k.href=x,k.download=m,document.body.appendChild(k),k.click(),k.remove(),URL.revokeObjectURL(x)}catch(d){console.error("PDF download failed",d),alert(" -PDF .  .")}finally{Ke(!1)}}},Li=async()=>{const d=xn(i,e);if(!d.length){await Lo();return}pe({issues:d,onContinue:()=>{pe(null),Lo()}})},_i=()=>{i&&((e==null?void 0:e.role)==="ADMIN"?(je(!1),re(!0)):Mo())},Oi=()=>{var x,k;if(!i||(e==null?void 0:e.role)!=="ADMIN")return;if(i.status!=="SENT"){setShowToast({msg:"       (SENT).",type:"error"});return}if(!en(i)){setShowToast({msg:"   /   .       .",type:"error"});return}if(((k=(x=i.reportReview)==null?void 0:x.issues)==null?void 0:k.some(v=>(v.origin??"INTERNAL")==="EXTERNAL"&&v.status!=="DONE"&&v.externalAction==="REQUIRES_HEBREW"))??!1){setShowToast({msg:"      .    /      .",type:"error"});return}if(!(i.isTranslated&&i.translatedContent&&Object.values(i.translatedContent).some(v=>v&&v.trim().length>0))){setShowToast({msg:"    .      .",type:"error"});return}je(!0),re(!0)},_o=async({body:d,templateId:m,subjectBase:x,topics:k},v)=>{const _=v??i;if(!_||_.translationStale&&!window.confirm("     .      .    ?"))return;const $={..._,selectedEmailTemplate:m,emailBodyDraft:d,emailSubjectDraft:x.trim()?x.trim():void 0,fileNameTitles:k};if(Yt({selectedEmailTemplate:m,emailBodyDraft:d,emailSubjectDraft:$.emailSubjectDraft,fileNameTitles:k}),e){const Qe=Od(e.id),ct=bp(Qe,k,6);yp(e.id,ct)}const B=ha(d);he(!0);let Y=null,oe="";const we=x.trim()||xs($);let ye="",Ve=null,Je=!1;try{Ve=await jc($);const Qe=await Wp(Ve);ye=cr($),Y=Er($),oe=we,Je=await pp({to:Y.to,cc:Y.cc,subject:oe,body:B,attachmentBase64:Qe,attachmentName:ye}),Je?setShowToast({msg:"  .",type:"success"}):setShowToast({msg:"          ( PDF  ,    ).",type:"error"})}catch(Qe){console.error("Email send failed",Qe),setShowToast({msg:"          ( PDF  ,    ).",type:"error"})}finally{if(Y){if(!Je){if(Ve){const Qe=ye||cr($),ct=URL.createObjectURL(Ve),rt=document.createElement("a");rt.href=ct,rt.download=Qe,document.body.appendChild(rt),rt.click(),document.body.removeChild(rt),URL.revokeObjectURL(ct)}ga(Y,oe||we,B)}Mo(ye||void 0),re(!1)}he(!1)}},Mi=async d=>{if(!i)return;let m=i;if(m.odakanitNo){const _=Se(m.odakanitNo);if(_){const B=l.filter(oe=>Se(oe.odakanitNo)===_).reduce((oe,we)=>{const ye=typeof we.reportNumber=="number"&&we.reportNumber>0?we.reportNumber:oe;return ye>oe?ye:oe},0);if((typeof m.reportNumber=="number"&&m.reportNumber>0?m.reportNumber:B)<B){window.alert("       .       .       .");return}}}const x=!!i.expensesSheetId||!!i.expensesHtml,k=Array.isArray(i.selectedSections)&&i.selectedSections.some(_=>Qr(_));if(x&&!k){if(!window.confirm(`       ,        .

       ?`))return;const $=[...i.selectedSections||[]],B=$.includes("Update"),Y=$.includes("Recommendations"),oe=B?Math.min($.indexOf("Update")+1,Y?$.indexOf("Recommendations"):$.length):0;$.splice(oe,0,Ja);const we=Array.from(new Set($)),ye={...i,selectedSections:we};Yt({selectedSections:we}),m=ye}const v=xn(m,e);if(!v.length){await _o(d,m);return}pe({issues:v,onContinue:()=>{pe(null),_o(d,m)}})},Oo=async({body:d,templateId:m,subjectBase:x,topics:k},v)=>{var Je,Qe,ct;const _=v??i;if(!_||(e==null?void 0:e.role)!=="ADMIN"||_.translationStale&&!window.confirm("     .      .     ?"))return;const $={..._,selectedEmailTemplate:m,emailBodyDraft:d,emailSubjectDraft:x.trim()?x.trim():void 0,fileNameTitles:k};if(Yt({selectedEmailTemplate:m,emailBodyDraft:d,emailSubjectDraft:$.emailSubjectDraft,fileNameTitles:k}),e&&k.length){const rt=Od(e.id),Et=bp(rt,k,6);yp(e.id,Et)}const B=ha(d);he(!0);let Y=null,oe="",we="";const ye=x.trim()||xs($);let Ve=!1;try{const rt=await jc($),Et=await Wp(rt);we=cr($),Y=Er($),oe=`Resend  ${ye}`,Ve=await pp({to:Y.to,cc:Y.cc,subject:oe,body:B,attachmentBase64:Et,attachmentName:we}),Ve?setShowToast({msg:"   ( ).",type:"success"}):setShowToast({msg:"         .",type:"error"});const Wt=new Date().toISOString(),Ft=kr({..._,status:"SENT",sentAt:Wt},we,Wt),Ot=typeof _.reportNumber=="number"&&_.reportNumber>0?_.reportNumber:(((Je=_.reportHistory)==null?void 0:Je.length)||0)+1,ze=Se(_.odakanitNo),zn=ze&&ne?ne[ze]:void 0,ts=!yt(_,zn||void 0).isLocked,lt={...Ft,subject:ts?`Corrected resend #${Ot}  ${Ft.subject}`:`Resent #${Ot}  ${Ft.subject}`,isCorrection:ts,revisionIndex:ts?(((ct=(Qe=_.reportHistory)==null?void 0:Qe.filter(nn=>nn.isCorrection))==null?void 0:ct.length)||0)+1:void 0},Tt={..._,status:"SENT",sentAt:Wt,reportHistory:[..._.reportHistory||[],lt],selectedEmailTemplate:void 0,emailBodyDraft:void 0};Cn(Tt),Wn(Tt,Wt),A(Tt,Wt,lt.fileName||we,!0),u(Tt),c(nn=>nn.map(pt=>pt.id===Tt.id?Tt:pt))}catch(rt){console.error("Resend email failed",rt),setShowToast({msg:"         .",type:"error"})}finally{if(Y){const rt=ye||xs(_),Et=oe||`UPDATED: ${rt}`;Ve||ga(Y,Et,B),re(!1)}je(!1),he(!1)}},Pi=async d=>{if(!i)return;let m=i;const x=!!i.expensesSheetId||!!i.expensesHtml,k=Array.isArray(i.selectedSections)&&i.selectedSections.some(_=>Qr(_));if(x&&!k){if(!window.confirm(`        ,        .

        ?`))return;const $=[...i.selectedSections||[]],B=$.includes("Update"),Y=$.includes("Recommendations"),oe=B?Math.min($.indexOf("Update")+1,Y?$.indexOf("Recommendations"):$.length):0;$.splice(oe,0,Ja);const we=Array.from(new Set($)),ye={...i,selectedSections:we};Yt({selectedSections:we}),m=ye}const v=xn(m,e);if(!v.length){await Oo(d,m);return}pe({issues:v,onContinue:()=>{pe(null),Oo(d,m)}})},Ar=d=>{if(!d)return;let m=d.trim();if(!(!m||(m=m.replace(Hu," ").replace(/\s+/g," ").trim(),!m)||(m.toLowerCase().endsWith(".pdf.pdf")&&(m=m.slice(0,-4)),m.toLowerCase().endsWith(".pdf")||(m=`${m}.pdf`),m.length>255)))return m},Mo=d=>{var _;if(!i)return;let m="READY_TO_SEND",x=i.sentAt,k=i;if((e==null?void 0:e.role)==="ADMIN"){m="SENT";const $=new Date().toISOString();x=$;const Y=Ar(d)||cr(Ci(i)),oe=kr({...i},Y,x);k={...i,reportHistory:[...i.reportHistory||[],oe],selectedEmailTemplate:void 0,emailBodyDraft:void 0,firstSentAt:i.firstSentAt||$}}else((e==null?void 0:e.role)==="FINANCE"||(e==null?void 0:e.role)==="SUB_ADMIN")&&(m="TASK_ASSIGNED");const v={...k,status:m,sentAt:x};if(Cn(v),Wn(v,x||new Date().toISOString()),m==="SENT"&&x){const $=(_=v.reportHistory)==null?void 0:_[v.reportHistory.length-1];A(v,x,$==null?void 0:$.fileName,!1)}u(v),c($=>$.find(Y=>Y.id===v.id)?$.map(Y=>Y.id===v.id?v:Y):[...$,v]),o("DASHBOARD")},Fi=(d,m)=>{e&&(Dt(d,x=>{const k=[{id:Ln(),authorId:e.id,authorName:e.name,message:m,createdAt:new Date().toISOString()},...x.reportNotes||[]];return{...x,reportNotes:k}}),jr({id:`note-${Date.now()}`,message:`${e.name} added a note: "${m}"`,createdAt:new Date().toISOString()}))},Bi=(d,m)=>{Dt(d,x=>{const k=x.expenseWorksheet||Ps(),v={id:Ln(),timestamp:new Date().toISOString(),userId:(e==null?void 0:e.id)||"system",userName:(e==null?void 0:e.name)||"System",action:m.action||"UPDATE",details:m.details};return{...x,expenseWorksheet:{...k,history:[v,...k.history||[]]}}})},$i=(d,m,x)=>{e&&(Dt(d,k=>{const v=k.expenseWorksheet||Ps(),_={id:Ln(),rowId:m,authorId:e.id,authorName:e.name,message:x,createdAt:new Date().toISOString()};return{...k,expenseWorksheet:{...v,notes:[_,...v.notes||[]]}}}),Bi(d,{action:"NOTE_ADDED",details:x}))},Hi=d=>{const m=new Date().toISOString();Dt(d,x=>({...x,deletedAt:m,deletedBy:e==null?void 0:e.id}))},Ui=d=>{Dt(d,m=>{const x={...m};return delete x.deletedAt,delete x.deletedBy,x})},Wi=(d,m)=>{Dt(d,x=>{const k=x.expenseWorksheet||Ps();return{...x,expenseWorksheet:{...k,notes:k.notes.map(v=>v.id===m?{...v,resolved:!0,resolvedAt:new Date().toISOString()}:v)}}})},zi=(d,m)=>{!m.amount||m.amount<=0||Dt(d,x=>{var Ve,Je;const k=x.expenseWorksheet||Ps(),v=ds.find(Qe=>Qe.value===m.category),_=(v==null?void 0:v.type)||"EXPENSE",$=m.category==="OTHER"?((Ve=m.customLabel)==null?void 0:Ve.trim())||"Other expense":(v==null?void 0:v.label)||"Expense",B={id:Ln(),type:_,category:m.category,label:$,serviceProvider:_==="EXPENSE"?(Je=m.serviceProvider)==null?void 0:Je.trim():void 0,amount:m.amount,createdBy:e==null?void 0:e.id,createdAt:new Date().toISOString()},Y=[...k.rows||[],B],oe=oi(Y),we=Fv(Y),ye={id:Ln(),timestamp:new Date().toISOString(),userId:(e==null?void 0:e.id)||"system",userName:(e==null?void 0:e.name)||"System",action:"ROW_ADDED",details:`${$} ${B.amount.toLocaleString()}`};return{...x,expenseWorksheet:{...k,rows:Y,totals:oe,history:[ye,...k.history||[]]},expensesItems:we,expensesSum:oe.totalExpenses.toLocaleString()}})},Vi=d=>{const m=ws.find(Y=>Y.id===d.lawyerId);if(!m)return;const x=Pd(d.worksheet||[],e||void 0),k=oi(x),v=d.invoiceFiles||[],_=v.length===0,$={...hn(),createdBy:m.id,ownerName:m.name,ownerEmail:m.email,status:_?"WAITING_FOR_INVOICES":"TASK_ASSIGNED",odakanitNo:d.odakanitNo,financeInstructions:d.instructions,expensesSourceFile:d.file,selectedSections:["Update","Expenses breakdown"],isWaitingForInvoices:_,requiresExpenses:!0},B={...$,expensesItems:x.filter(Y=>Y.type==="EXPENSE").map(Y=>({id:Y.id,date:new Date().toISOString().split("T")[0],description:`${Y.label}${Y.serviceProvider?` (${Y.serviceProvider})`:""}`,amount:Y.amount,currency:"NIS"})),expensesSum:x.length?k.totalExpenses.toLocaleString():$.expensesSum,invoiceFiles:v,expenseWorksheet:{status:"DRAFT",rows:x,history:[{id:Ln(),timestamp:new Date().toISOString(),userId:(e==null?void 0:e.id)||"system",userName:(e==null?void 0:e.name)||"System",action:"WORKSHEET_CREATED",details:`${x.length} rows added via finance request`}],notes:[],favorites:H[d.lawyerId]||[],totals:k}};c(Y=>[...Y,B]),jr({id:`worksheet-${Date.now()}`,message:`New expense worksheet created for case ${d.odakanitNo||B.id}`,createdAt:new Date().toISOString(),reportId:B.id,severity:"info"})},Ki=async({caseId:d,sheetId:m,lawyerId:x})=>{var Ot,ze,zn,gn,ts;const k=Se(d),v=ne==null?void 0:ne[k],_=l.filter(lt=>Se(lt.odakanitNo)===k);if(v&&v.closedAt){window.alert("        .   ,     .");return}if(!_.length&&!v){window.alert("     ( ).       .");return}if(!_.length)return;const $=(lt,Tt)=>{const nn=lt.updatedAt?new Date(lt.updatedAt).getTime():0;return(Tt.updatedAt?new Date(Tt.updatedAt).getTime():0)-nn};let B=_.filter(lt=>!x||lt.createdBy===x).sort($)[0];if(B||(B=_.sort($)[0]),!B)return;const Y=x||B.createdBy;if(!Y)return;const oe=B.odakanitNo||d,we=B.insuredName||B.plaintiffName||"case",ye=`New financial update (Expenses breakdown) is available for Odakanit case ${oe} (${we}).`;let Ve=null,Je,Qe=null,ct=[];try{const lt=await Xe.getSheet(m);if(lt&&lt.sheet&&((Ot=lt.lineItems)!=null&&Ot.length)){const Tt=Xe.buildCumulativeExpensesSnapshot(lt.sheet.id,new Date().toISOString());if(!Tt)return;const{effectiveSheet:nn,allLines:pt,opts:ns}=Tt,{text:Sa,totals:ar}=Lh(nn,pt,ns),wa=((ze=lt.attachments)==null?void 0:ze.length)??0,Uo=ar.amountToRequest.toLocaleString("he-IL",{minimumFractionDigits:2,maximumFractionDigits:2}),Wo="This expenses breakdown was prepared by the finance department and is attached for your review.",Yh=`Summary: total amount to request ${Uo}${wa>0?` (invoices attached: ${wa})`:""}.`;Ve=`${Wo}

${Yh}`;const{html:Gh}=ri(nn,pt,ns);if(Qe=Gh,Je=lt.sheet.updatedAt||new Date().toISOString(),lt.attachments&&lt.attachments.length){const Xu=lt.attachments.slice(0,4).map((ja,qh)=>({id:`fes-inv-${ja.id}-${qh}`,name:ja.originalFileName,data:ja.fileKey.split(",").pop()||ja.fileKey,type:ja.mimeType||"application/pdf"}));Xu.length&&(ct=Xu)}}}catch(lt){Yu("Failed to build Expenses Breakdown text for finance notification",lt)}const rt=new Date().toISOString(),Et=Ve||"An expenses table has been prepared by the finance department for this case. Please review the attached sheet or coordinate with Finance as needed.",Wt=typeof B.reportNumber=="number"&&B.reportNumber>0?B.reportNumber+1:(((zn=B.reportHistory)==null?void 0:zn.length)||0)+1;let Ft={...B,id:`${Date.now()}-finance`,createdBy:Y,status:"TASK_ASSIGNED",reportDate:rt,updatedAt:rt,expensesSheetId:m,expensesSnapshotAt:Je||rt,invoiceFiles:ct,reportNumber:Wt,reportHistory:B.reportHistory||[],attachPolicyAsAppendix:!1,expensesHtml:Qe||void 0,content:{...B.content,Update:((gn=B.content)==null?void 0:gn.Update)||"","Expenses breakdown":Et,Recommendations:((ts=B.content)==null?void 0:ts.Recommendations)||""},selectedSections:["Update","Expenses breakdown","Recommendations"],supersededByReportId:null,supersedesReportId:null};c(lt=>{const Tt=[...lt].filter(pt=>pt.expensesSheetId===m&&!pt.deletedAt&&pt.id!==Ft.id).sort((pt,ns)=>{const Sa=new Date(pt.updatedAt||pt.reportDate||"").getTime()||0;return(new Date(ns.updatedAt||ns.reportDate||"").getTime()||0)-Sa})[0];let nn=lt;return Tt&&(nn=lt.map(pt=>pt.id===Tt.id?{...pt,supersededByReportId:Ft.id}:pt),Ft={...Ft,supersedesReportId:Tt.id}),[...nn,Ft]}),jr({id:`${Date.now()}`,message:ye,createdAt:new Date().toISOString(),reportId:Ft.id,severity:"info",targetUserId:Y})},Yi=d=>{t(d),o("DASHBOARD"),u(null),w(null),R.current=!1,typeof window<"u"&&(localStorage.setItem(ft.USER,d.username),localStorage.setItem(ft.VIEW,"DASHBOARD"),localStorage.removeItem(ft.CURRENT_REPORT))},[Gi,ya]=g.useState(!1),[Na,Ir]=g.useState(!1),Po=()=>{if(!(l.length>0||i)){ba();return}Ir(!1),ya(!0)},qi=()=>{ya(!1),Ir(!1),ba()},ba=()=>{if(t(null),u(null),w(null),R.current=!1,o("DASHBOARD"),W(null),P(!1),re(!1),he(!1),je(!1),et(!1),D(null),ue(""),le(null),Ee(""),$e("LAWYER"),F([]),O(null),te(!1),nt(null),h([]),typeof window<"u")try{localStorage.removeItem(ft.USER),localStorage.removeItem(ft.CURRENT_REPORT),localStorage.setItem(ft.VIEW,"DASHBOARD"),localStorage.removeItem(qb)}catch(d){console.error("Failed to clear session storage on logout",d)}};if(!s)return n.jsx("div",{className:"min-h-screen flex items-center justify-center bg-bgDark",children:n.jsxs("div",{className:"text-textMuted text-sm flex items-center gap-2",children:[n.jsx(Bt,{className:"w-5 h-5 animate-spin","aria-hidden":!0}),n.jsx("span",{children:"..."})]})});if(!e)return n.jsx(Wv,{onLogin:Yi});if(a==="CASE_FOLDER"&&Ue){const d=ne[Ue]||null,m=()=>{o("DASHBOARD")};return d?n.jsx(sv,{folder:d,reports:l,currentUserRole:e.role,onBack:m,onUpdateReTemplate:x=>{Be(k=>{const v=k[Ue];if(!v)return k;const _={...v,reTemplate:x,updatedAt:new Date().toISOString()},$={...k,[Ue]:_};return Dn($),$})},onCloseCase:e.role==="ADMIN"?()=>{const x=Ue;if(!x)return;const k=Se(x);if(l.some($=>Se($.odakanitNo)===k&&$.status!=="SENT"&&!$.deletedAt)){window.alert("         .        .");return}if(!window.confirm("        .   ?"))return;const _=new Date().toISOString();Be($=>{const B=$[x];if(!B)return $;const Y={...B,closedAt:_,closedByUserId:e.id,updatedAt:_},oe={...$,[x]:Y};return Dn(oe),oe})}:void 0,onReopenCase:e.role==="ADMIN"?()=>{const x=Ue;x&&window.confirm("         .   ?")&&Be(k=>{const v=k[x];if(!v)return k;const _={...v,closedAt:null,closedByUserId:null,updatedAt:new Date().toISOString()},$={...k,[x]:_};return Dn($),$})}:void 0,onDeleteCase:e.role==="ADMIN"?()=>{const x=Ue;if(!x)return;const k=Se(x);if(l.some(_=>Se(_.odakanitNo)===k&&_.status!=="SENT"&&!_.deletedAt)){window.alert("       .        .");return}window.confirm("           (  ).   ?")&&window.confirm(" :      ?     .")&&(Be(_=>{const $={..._};return delete $[x],Dn($),$}),c(_=>_.filter($=>Se($.odakanitNo)!==k)),nt(null),o("DASHBOARD"))}:void 0,onCreateReportInCase:()=>{const x=ne[Ue];if(!x||!e)return;if(x.closedAt){window.alert("  .      .");return}const k=l.find(Qe=>Qe.odakanitNo&&Se(Qe.odakanitNo)===Se(x.odakanitNo)&&Qe.status!=="SENT"&&!Qe.deletedAt);if(k&&e.role==="LAWYER"){window.alert("     .     .      .");return}if(k&&e.role==="ADMIN"&&!window.confirm("     .       ( ,    )?"))return;const v=new Date().toISOString(),_=hn(),$=ge(x),B=Cs({odakanitNo:x.odakanitNo,reports:l,caseFolder:x}),Y=Array.isArray(x.sentReports)?x.sentReports:[];let oe=null,we="";if(Y.length>0){oe=[...Y].sort((Ft,Ot)=>{const ze=new Date(Ft.sentAt||"").getTime()||0;return(new Date(Ot.sentAt||"").getTime()||0)-ze})[0];const Qe=(oe==null?void 0:oe.snapshot)||{},ct=Qe.content||{},rt=Array.isArray(Qe.selectedSections)?Qe.selectedSections:[],Et=rt.length>0?rt:Object.keys(ct),Wt=[];Et.forEach(Ft=>{const Ot=ct[Ft];typeof Ot=="string"&&Ot.trim()&&Wt.push(Ot.trim())}),we=Wt.join(`

`).trim()}const ye=!!(oe&&we),Ve="    ",Je={..._,odakanitNo:x.odakanitNo,reportSubject:x.reTemplate||"",insuredName:x.insuredName||"",plaintiffName:x.plaintiffName||"",insurerName:x.insurerName||"",marketRef:x.marketRef||"",lineSlipNo:x.lineSlipNo||"",certificateRef:x.certificateRef||"",reportDate:v,updatedAt:v,reportHistory:$,reportNumber:B,content:ye?{..._.content||{},Update:Ve}:_.content,updateAutoSummarySourceReportId:ye?oe.reportId:null,updateAutoSummaryGeneratedAt:ye?v:null,updateAutoSummaryEdited:!1};if(u(Je),w(null),o("STEP1"),typeof window<"u")try{localStorage.setItem(ft.CURRENT_REPORT,Je.id)}catch{}if(Wn(Je,v),ye){const Qe=we,ct=oe.reportId;(async()=>{try{let rt=await X0(Qe);rt=(rt||"").trim(),rt||(rt=`,     ${Qe.trim().slice(0,600)}`),rt.startsWith(",  ")||(rt=`,     ${rt}`),Dt(Je.id,Et=>{var Wt;return Et.updateAutoSummaryEdited||((Wt=Et.content)==null?void 0:Wt.Update)!==Ve?Et:{...Et,content:{...Et.content||{},Update:rt},updateAutoSummarySourceReportId:ct,updateAutoSummaryGeneratedAt:new Date().toISOString()}})}catch(rt){console.error("Auto summary generation failed, falling back to snippet.",rt);const Et=Qe.trim();if(!Et)return;const Ft=`,     ${Et.slice(0,600)}`;Dt(Je.id,Ot=>{var ze;return Ot.updateAutoSummaryEdited||((ze=Ot.content)==null?void 0:ze.Update)!==Ve?Ot:{...Ot,content:{...Ot.content||{},Update:Ft},updateAutoSummarySourceReportId:ct,updateAutoSummaryGeneratedAt:new Date().toISOString()}})}})()}},onOpenReport:x=>{const k=l.find(v=>v.id===x);if(k&&(u(k),w(null),o("STEP1"),typeof window<"u"))try{localStorage.setItem(ft.CURRENT_REPORT,k.id)}catch{}}}):n.jsx("div",{className:"min-h-screen flex items-center justify-center bg-bgDark px-4",children:n.jsxs("div",{className:"max-w-md rounded-2xl bg-panel p-6 text-center text-sm text-textLight shadow-sm border border-borderDark",children:[n.jsx("p",{className:"mb-3 font-semibold text-gold",children:"Case folder not found"}),n.jsx("p",{className:"mb-4 text-xs text-textMuted",children:"The requested case folder is no longer available. You can return to the dashboard and select another case."}),n.jsx("button",{type:"button",onClick:m,className:"inline-flex items-center rounded-full bg-navy px-4 py-1.5 text-xs font-semibold text-gold shadow-sm hover:bg-navySecondary focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-gold focus-visible:ring-offset-2",children:"Back to dashboard"})]})})}const Fo=()=>{if((e==null?void 0:e.role)==="LAWYER"){z(""),De(!0);return}const d=hn();if(u(d),w(null),o("STEP1"),typeof window<"u")try{localStorage.setItem(ft.CURRENT_REPORT,d.id)}catch{}},va=(d,m)=>{const x=l.find(k=>k.id===d);if(x&&(u(x),w(null),o("STEP1"),W(m||null),typeof window<"u"))try{localStorage.setItem(ft.CURRENT_REPORT,x.id)}catch{}};if(a==="DASHBOARD")return(e==null?void 0:e.role)==="ADMIN"||(e==null?void 0:e.role)==="SUB_ADMIN"?n.jsx(Qb,{user:e,reports:l,caseFolders:ne,onUpdateCaseFolders:d=>{Be(m=>{const x=d(m);return Dn(x),x})},onNewReport:Fo,onSelectReport:va,onSelectReportWithFocus:(d,m)=>va(d,m),onMarkExternalIssuesDone:Ds,onReopenHebrewDueToExternalFeedback:d=>xa(d),canTranslate:en,onLogout:Po,onOpenAssistant:()=>He(!0),onOpenCaseFolder:d=>{const m=Se(d);m&&(Be(x=>{const k=Mc(x,l);return Dn(k),k}),nt(m),o("CASE_FOLDER"))}}):n.jsxs(n.Fragment,{children:[n.jsx(Uv,{user:e,reports:l,onNewReport:Fo,onSelectReport:va,onLogout:Po,onUpdateReport:(d,m)=>{Dt(d,x=>({...x,...m}))},onDeleteReport:d=>c(m=>m.filter(x=>x.id!==d)),onFinanceTaskCreate:Vi,onNotifyLawyerFromFinance:Ki,onSheetDeleted:d=>{c(m=>m.map(x=>x.expensesSheetId===d?{...x,expensesSheetId:void 0,expensesHtml:void 0,expensesSnapshotAt:void 0}:x))},caseTemplates:qe,onStartTemplate:rr,onStartNextReport:es,archiveAfterMs:Av,favoriteProviders:H,onSaveFavorite:Ai,onDeleteFavorite:Ii,onOpenWorksheet:Ei,onRequestReminder:d=>{le(d),Ee(`Reminder for ${d.insuredName||"case"}`)},onRequestNote:d=>{D(d),ue("")},onSoftDeleteReport:Hi,onRestoreReport:Ui,notifications:U.filter(d=>!d.targetUserId||d.targetUserId===(e==null?void 0:e.id)),showNotifications:X,setShowNotifications:te,onClearNotifications:()=>V([]),dailySummaryOptIn:G,setDailySummaryOptIn:ae,caseFolders:ne,onOpenCaseFolder:d=>{const m=Se(d);m&&(Be(x=>{const k=Mc(x,l);return Dn(k),k}),nt(m),o("CASE_FOLDER"))},onOpenAssistant:()=>He(!0)}),(e==null?void 0:e.role)==="LAWYER"&&ie&&n.jsx("div",{className:"fixed inset-0 z-[250] flex items-center justify-center bg-black/40",children:n.jsxs("div",{className:"bg-panel rounded-2xl shadow-xl max-w-sm w-full mx-4 p-5 space-y-3",dir:"rtl",children:[n.jsx("h2",{className:"text-sm font-bold text-textLight text-right",children:"    "}),n.jsx("p",{className:"text-xs text-textMuted text-right",children:'/   .         / " .          .'}),n.jsx("input",{type:"text",className:"w-full border border-borderDark rounded px-3 py-1.5 text-sm text-textLight",placeholder:": 1/123",value:jt,onChange:d=>z(d.target.value)}),n.jsxs("div",{className:"flex justify-end gap-2 mt-2",children:[n.jsx("button",{type:"button",className:"px-3 py-1.5 rounded-md border border-borderDark text-xs text-textLight bg-panel hover:bg-slate-50",onClick:()=>{De(!1),z("")},children:""}),n.jsx("button",{type:"button",className:"px-3 py-1.5 rounded-md bg-navy text-xs font-semibold text-gold hover:bg-navySecondary",onClick:()=>{const d=jt.trim();if(!d){alert("    .");return}const m=d,x=ne[m],k=new Date().toISOString();if(x){const v=hn(),_=ge(x),$=Cs({odakanitNo:x.odakanitNo,reports:l,caseFolder:x}),B={...v,odakanitNo:x.odakanitNo,reportSubject:x.reTemplate||"",insuredName:x.insuredName||"",plaintiffName:x.plaintiffName||"",insurerName:x.insurerName||"",marketRef:x.marketRef||"",lineSlipNo:x.lineSlipNo||"",certificateRef:x.certificateRef||"",reportDate:k,updatedAt:k,reportHistory:_,reportNumber:$};if(u(B),o("STEP1"),typeof window<"u")try{localStorage.setItem(ft.CURRENT_REPORT,B.id)}catch{}Wn(B,k)}else{const _={...hn(),odakanitNo:m};if(u(_),o("STEP1"),typeof window<"u")try{localStorage.setItem(ft.CURRENT_REPORT,_.id)}catch{}Wn(_,k)}De(!1),z("")},children:""})]})]})})]});if(!i)return null;const Tr=typeof i.reportNumber=="number"&&i.reportNumber>0?i.reportNumber:(((ee=i.reportHistory)==null?void 0:ee.length)||0)+1,Bo=hh(i.selectedSections||[]),$o=Bo.map((d,m)=>({id:`${m}-${d.replace(/\s+/g,"-")||"title"}`,label:d})).filter(d=>!!d.label),Xi=_d(Bo),Ho=i.fileNameTitles&&i.fileNameTitles.length?i.fileNameTitles:Xi,f=Tr!==1&&$o.length>0,T=j.map(d=>{const m=Un(d.reportId);return m?{...d,report:m,title:`${m.insuredName||"Case"} (${m.ownerName})`}:null}).filter(Boolean),K=L?Un(L):null;return n.jsxs(n.Fragment,{children:[n.jsx("div",{className:"min-h-screen bg-navySecondary pb-12",children:n.jsxs("div",{className:"w-full pt-6 px-6 md:px-8 lg:px-10 xl:px-12",children:[n.jsxs("div",{className:"flex justify-between items-center mb-8",children:[n.jsxs("div",{className:"flex items-center bg-panel p-2 rounded-full shadow-sm",children:[n.jsx("div",{className:`px-4 py-1 rounded-full ${a==="STEP1"?"bg-navy text-white font-bold":"text-textMuted"}`,children:"1. Setup"}),n.jsx(is,{className:"w-4 h-4 text-gray-300 mx-2"}),n.jsx("div",{className:`px-4 py-1 rounded-full ${a==="STEP2"?"bg-navy text-white font-bold":"text-textMuted"}`,children:"2. Draft"}),n.jsx(is,{className:"w-4 h-4 text-gray-300 mx-2"}),n.jsx("div",{className:`px-4 py-1 rounded-full ${a==="PREVIEW"?"bg-navy text-white font-bold":"text-textMuted"}`,children:"3. Preview"})]}),n.jsxs("button",{type:"button",onClick:()=>He(!0),className:"flex items-center text-[11px] px-3 py-1.5 rounded-full bg-indigo-50 text-indigo-800 border border-indigo-200 hover:bg-indigo-100",title:"     ,     .",children:[n.jsx(oa,{className:"w-3 h-3 ml-1"})," "]})]}),i&&(()=>{const d=Se(i.odakanitNo),m=d&&ne?ne[d]:void 0,x=yt(i,m||void 0),k=!!(m!=null&&m.closedAt),v=(e==null?void 0:e.role)==="ADMIN"&&b===i.id;return(x.isLocked||k)&&!(v&&!k)})()&&n.jsxs("div",{className:"mb-4 rounded-2xl border border-amber-300 bg-amber-50 px-4 py-3 text-xs text-amber-900 flex items-start justify-between gap-3",children:[n.jsxs("div",{children:[n.jsx("p",{className:"font-semibold text-[13px]",children:(()=>{const d=Se(i.odakanitNo),m=d&&ne?ne[d]:void 0,x=yt(i,m||void 0);return m!=null&&m.closedAt?"      .":x.lockType==="MANUAL"?"   .":x.lockType==="AUTO"&&x.lockAt?`    ${new Date(x.lockAt).toLocaleDateString("he-IL")}.`:"  ."})()}),n.jsx("p",{className:"mt-1 text-[11px]",children:'  ,    PDF,      "     .'})]}),(e==null?void 0:e.role)==="ADMIN"&&n.jsxs("div",{className:"flex flex-col items-end gap-2",children:[(()=>{const d=Se(i.odakanitNo),m=d&&ne?ne[d]:void 0,x=yt(i,m||void 0);return i.status==="SENT"&&!x.isLocked})()&&n.jsx("button",{type:"button",className:"shrink-0 inline-flex items-center rounded-full bg-panel px-3 py-1.5 text-[11px] font-semibold text-amber-900 border border-amber-300 hover:bg-amber-100",onClick:()=>{const d=window.prompt(`      .
 /     (  ):`);if(!d||!d.trim())return;w(i.id);const m=new Date().toISOString(),x=e.id,k=e.name;Yt({lastAdminOverrideAt:m,lastAdminOverrideById:x,lastAdminOverrideByName:k,lastAdminOverrideReason:d.trim()})},children:"  ()"}),(()=>{const d=Se(i.odakanitNo),m=d&&ne?ne[d]:void 0,x=yt(i,m||void 0),k=!x.isLocked&&!!i.firstSentAt&&!(m!=null&&m.closedAt),v=!(m!=null&&m.closedAt)&&!i.manualLockedAt&&!x.isLocked;return n.jsxs("div",{className:"flex flex-wrap gap-2 justify-end",children:[k&&n.jsx("button",{type:"button",className:"inline-flex items-center rounded-full bg-amber-100 px-3 py-1.5 text-[10px] font-semibold text-amber-900 border border-amber-300 hover:bg-amber-200",onClick:()=>{const _=window.prompt(`   -35  .
 /   (  ):`);if(!_||!_.trim())return;const $=new Date().toISOString(),B=i.lockExtensions||[];Yt({lockExtensions:[...B,{extendedAt:$,extendedById:e.id,extendedByName:e.name,days:35,reason:_.trim()}]})},children:"   (+35 )"}),v&&n.jsx("button",{type:"button",className:"inline-flex items-center rounded-full bg-amber-100 px-3 py-1.5 text-[10px] font-semibold text-amber-900 border border-amber-300 hover:bg-amber-200",onClick:()=>{const _=window.prompt(`     .
 /     (  ):`);if(!_||!_.trim())return;const $=new Date().toISOString();Yt({manualLockedAt:$,manualLockedById:e.id,manualLockedByName:e.name,manualLockReason:_.trim()})},children:"  "})]})})()]})]}),a==="STEP1"&&n.jsx(Bv,{data:i,updateData:Yt,onNext:()=>{if(i){const d=Se(i.odakanitNo),m=d&&ne?ne[d]:void 0;yt(i,m||void 0).isLocked||dn()}o("STEP2")},onBack:()=>{if(i){const d=Se(i.odakanitNo),m=d&&ne?ne[d]:void 0;yt(i,m||void 0).isLocked||dn()}o("DASHBOARD")},currentUser:e,timelineGallery:N,onAddTimelineImages:d=>h(m=>[...m,...d.map(x=>({...x,id:Date.now().toString()}))]),onRemoveTimelineImage:d=>h(m=>m.filter(x=>x.id!==d)),onSaveAndExit:()=>{if(i){const d=Se(i.odakanitNo),m=d&&ne?ne[d]:void 0;yt(i,m||void 0).isLocked||dn()}o("DASHBOARD")},readOnly:!!i&&(()=>{const d=Se(i.odakanitNo),m=d&&ne?ne[d]:void 0,x=yt(i,m||void 0),k=!!(m!=null&&m.closedAt),v=(e==null?void 0:e.role)==="ADMIN"&&b===i.id&&!k,_=(e==null?void 0:e.role)==="LAWYER"&&i.status==="SENT";return v?!1:_||k?!0:x.isLocked})()}),a==="STEP2"&&n.jsx($v,{data:i,updateData:Yt,onNext:()=>{if(i){const d=Se(i.odakanitNo),m=d&&ne?ne[d]:void 0;yt(i,m||void 0).isLocked||dn()}o("PREVIEW")},onBack:()=>{if(i){const d=Se(i.odakanitNo),m=d&&ne?ne[d]:void 0;yt(i,m||void 0).isLocked||dn()}o("STEP1")},currentUser:e,timelineGallery:N,onAddTimelineImages:d=>{},onSaveAndExit:()=>{if(i){const d=Se(i.odakanitNo),m=d&&ne?ne[d]:void 0;yt(i,m||void 0).isLocked||dn()}o("DASHBOARD")},onSaveDraft:i&&(()=>{const d=Se(i.odakanitNo),m=d&&ne?ne[d]:void 0,x=yt(i,m||void 0);if(!((e==null?void 0:e.role)==="LAWYER"&&i.status==="SENT"||x.isLocked))return dn})(),onTranslate:i&&(()=>{const d=Se(i.odakanitNo),m=d&&ne?ne[d]:void 0,x=yt(i,m||void 0);if(!((e==null?void 0:e.role)==="LAWYER"&&i.status==="SENT"||x.isLocked))return Ti})(),onFormatContent:i&&(()=>{const d=Se(i.odakanitNo),m=d&&ne?ne[d]:void 0,x=yt(i,m||void 0);if(!((e==null?void 0:e.role)==="LAWYER"&&i.status==="SENT"||x.isLocked))return tn})(),onSubmitHebrewForReview:i&&(()=>{const d=Se(i.odakanitNo),m=d&&ne?ne[d]:void 0,x=yt(i,m||void 0);if(!((e==null?void 0:e.role)==="LAWYER"&&i.status==="SENT"||x.isLocked))return()=>Ie(i.id)})(),onApproveHebrewForTranslation:i&&(()=>{const d=Se(i.odakanitNo),m=d&&ne?ne[d]:void 0,x=yt(i,m||void 0);if(!((e==null?void 0:e.role)==="LAWYER"&&i.status==="SENT"||x.isLocked))return()=>mt(i.id)})(),onAddReviewIssues:i&&(()=>{const d=Se(i.odakanitNo),m=d&&ne?ne[d]:void 0,x=yt(i,m||void 0);if(!((e==null?void 0:e.role)==="LAWYER"&&i.status==="SENT"||x.isLocked))return v=>at(i.id,v)})(),onMarkReviewIssueDone:i&&(()=>{const d=Se(i.odakanitNo),m=d&&ne?ne[d]:void 0,x=yt(i,m||void 0);if(!((e==null?void 0:e.role)==="LAWYER"&&i.status==="SENT"||x.isLocked))return v=>Zt(i.id,v)})(),onAddExternalFeedbackIssues:i&&(()=>{const d=Se(i.odakanitNo),m=d&&ne?ne[d]:void 0,x=yt(i,m||void 0);if(!((e==null?void 0:e.role)==="LAWYER"&&i.status==="SENT"||x.isLocked))return(v,_)=>Do(i.id,v,_)})(),onReopenHebrewDueToExternalFeedback:i&&(()=>{const d=Se(i.odakanitNo),m=d&&ne?ne[d]:void 0,x=yt(i,m||void 0);if(!((e==null?void 0:e.role)==="LAWYER"&&i.status==="SENT"||x.isLocked))return()=>xa(i.id)})(),step1Focus:E,onStep1FocusConsumed:()=>W(null),isTranslating:Ye,isImprovingEnglish:q,onImproveEnglish:i&&(()=>{const d=Se(i.odakanitNo),m=d&&ne?ne[d]:void 0,x=yt(i,m||void 0);if(!((e==null?void 0:e.role)==="LAWYER"&&i.status==="SENT"||x.isLocked))return Ri})(),onOpenAssistant:()=>He(!0),onActiveSectionChange:d=>st(d),readOnly:!!i&&(()=>{const d=(e==null?void 0:e.role)==="ADMIN"&&b===i.id;if(!i)return!1;const m=Se(i.odakanitNo),x=m&&ne?ne[m]:void 0,k=yt(i,x||void 0);return!d&&k.isLocked})()}),a==="PREVIEW"&&(()=>{const d=vv(e==null?void 0:e.role),m=(e==null?void 0:e.role)==="LAWYER";return n.jsxs("div",{className:"space-y-6 animate-fade-in",dir:m?"rtl":void 0,lang:m?"he":void 0,children:[n.jsxs("div",{className:"flex justify-between items-center flex-wrap gap-2",children:[n.jsxs("button",{onClick:()=>{dn(),o("STEP2")},className:"flex items-center text-sm text-textMuted bg-navySecondary px-3 py-1.5 rounded-full hover:bg-borderDark",children:[n.jsx(Ql,{className:"w-4 h-4 mr-1"}),d.backToStep2]}),n.jsxs("button",{onClick:()=>{dn(),o("DASHBOARD")},className:"flex items-center text-sm text-lpBlue bg-blue-50 px-3 py-1.5 rounded-full hover:bg-blue-100",children:[n.jsx(Lu,{className:"w-4 h-4 mr-1"}),d.backToDashboard]})]}),n.jsxs("div",{className:"flex justify-between items-center bg-panel p-4 rounded shadow mb-4",children:[n.jsxs("div",{children:[n.jsx("h2",{className:"text-xl font-bold text-lpBlue",children:d.title}),n.jsx("p",{className:"mt-1 text-xs text-textMuted",children:"Export options let you back up the current report data (JSON/CSV) in addition to the PDF."})]}),n.jsxs("div",{className:"flex gap-2 flex-wrap justify-end items-center",children:[n.jsxs("button",{type:"button",onClick:()=>He(!0),className:"flex items-center text-[11px] px-3 py-1.5 rounded-full bg-indigo-50 text-indigo-800 border border-indigo-200 hover:bg-indigo-100",title:"         PDF.",children:[n.jsx(oa,{className:"w-3 h-3 mr-1"})," "]}),n.jsx("button",{onClick:()=>P(x=>!x),className:"flex items-center bg-borderDark text-textLight px-4 py-2 rounded hover:bg-borderDark",children:S?d.toggleHide:d.toggleShow}),n.jsxs("button",{onClick:Li,disabled:Pe,className:"flex items-center bg-panel text-textLight border border-borderDark px-4 py-2 rounded hover:bg-navySecondary disabled:opacity-50",children:[Pe?n.jsx(Bt,{className:"w-4 h-4 mr-2 animate-spin"}):n.jsx(yo,{className:"w-4 h-4 mr-2"}),d.downloadPdf]}),n.jsx("button",{onClick:()=>et(!0),disabled:!f,className:"flex items-center bg-panel text-textLight border border-borderDark px-4 py-2 rounded hover:bg-navySecondary disabled:opacity-40",children:d.editFileNames}),n.jsx("button",{onClick:()=>{const x={report:i},k=new Blob([JSON.stringify(x,null,2)],{type:"application/json"}),v=URL.createObjectURL(k),_=document.createElement("a");_.href=v,_.download=`report-${i.odakanitNo||i.id}.json`,_.click(),URL.revokeObjectURL(v)},className:"flex items-center bg-panel text-textLight border border-borderDark px-3 py-2 rounded hover:bg-navySecondary text-xs",children:"JSON Export"}),n.jsx("button",{onClick:()=>{const x=["OdakanitNo","InsuredName","PlaintiffName","InsurerName","MarketRef","LineSlipNo","CertificateRef","ReportDate","Status"],k=[i.odakanitNo||"",i.insuredName||"",i.plaintiffName||"",i.insurerName||"",i.marketRef||"",i.lineSlipNo||"",i.certificateRef||"",i.reportDate||"",i.status||""],v=oe=>{const we=String(oe??"");return/[",\n]/.test(we)?`"${we.replace(/"/g,'""')}"`:we},_=[x.join(","),k.map(v).join(",")].join(`
`),$=new Blob(["\uFEFF"+_],{type:"text/csv;charset=utf-8;"}),B=URL.createObjectURL($),Y=document.createElement("a");Y.href=B,Y.download=`report-${i.odakanitNo||i.id}.csv`,Y.click(),URL.revokeObjectURL(B)},className:"flex items-center bg-panel text-textLight border border-borderDark px-3 py-2 rounded hover:bg-navySecondary text-xs",children:"CSV Export"}),n.jsxs("button",{onClick:_i,className:"flex items-center bg-green-600 text-white px-4 py-2 rounded hover:bg-green-700",children:[n.jsx(Zl,{className:"w-4 h-4 mr-2"}),d.finalize]}),e.role==="ADMIN"&&n.jsxs("button",{onClick:Oi,className:"flex items-center bg-orange-600 text-white px-4 py-2 rounded hover:bg-orange-700",children:[n.jsx(Zl,{className:"w-4 h-4 mr-2"}),"   "]})]})]}),S?n.jsxs("div",{className:"bg-panel rounded-2xl shadow p-4 space-y-4",children:[n.jsx("div",{className:"flex items-center justify-end flex-wrap gap-3",children:n.jsx("span",{className:"text-xs text-textMuted",children:d.helperScroll})}),n.jsx("div",{className:"border rounded-2xl bg-navySecondary p-4 pr-6 max-h-[900px] overflow-auto shadow-inner",children:n.jsx("div",{className:"scale-[0.85] origin-top flex justify-center overflow-visible",children:n.jsx(iN,{data:i})})})]}):n.jsx("div",{className:"text-center text-textMuted border border-dashed border-borderDark rounded-2xl p-6 bg-navySecondary",children:d.collapsedHint}),n.jsx("div",{className:"flex justify-start mt-4",children:n.jsx("button",{onClick:()=>o("STEP2"),className:"px-6 py-2 bg-borderDark text-textLight rounded hover:bg-borderDark",children:d.backToEditing})})]})})()]})}),i&&n.jsx(jN,{isOpen:C,isSending:Q,report:i,userId:e==null?void 0:e.id,recipientsPreview:Er(i),defaultSubject:xs(i),subjectDraft:((de=i.emailSubjectDraft)==null?void 0:de.trim())||xs(i),onSubjectDraftChange:d=>Yt({emailSubjectDraft:d&&d.trim()?d.trim():void 0}),selectedTopics:i.fileNameTitles||[],onSelectedTopicsChange:d=>Yt({fileNameTitles:d}),isResendMode:Fe,onClose:()=>{Q||(je(!1),re(!1))},onSend:Fe?Pi:Mi}),i&&n.jsx(EN,{isOpen:Te,availableTitles:$o,selectedTitles:Ho,onClose:()=>et(!1),onSave:d=>{const m=d.map(x=>x.trim()).filter(Boolean);Yt({fileNameTitles:m}),et(!1)}}),n.jsx(pv,{isOpen:Ge,onClose:()=>{He(!1)},view:a,currentUser:e,currentReport:i,loading:Z,error:xe,response:Oe,onRunIntent:Qt}),I&&n.jsx("div",{className:"fixed inset-0 bg-black/40 z-[200] flex items-center justify-center p-4",children:n.jsxs("div",{className:"bg-panel rounded-xl shadow-xl w-full max-w-md p-6 space-y-4",children:[n.jsxs("h3",{className:"text-lg font-bold text-textLight flex items-center gap-2",children:[n.jsx(_u,{className:"w-4 h-4"})," Add Note"]}),n.jsxs("p",{className:"text-sm text-textMuted",children:["Case: ",I.insuredName||I.odakanitNo||I.id]}),n.jsx(go,{clientId:So,children:n.jsx("textarea",{className:"w-full border rounded p-3 text-sm",rows:4,value:J,onChange:d=>ue(d.target.value),placeholder:"Write your note..."})}),n.jsxs("div",{className:"flex justify-end gap-2",children:[n.jsx("button",{onClick:()=>{D(null),ue("")},className:"px-4 py-2 text-textMuted hover:bg-navySecondary rounded",children:"Cancel"}),n.jsx("button",{onClick:()=>{I&&J.trim()&&(Fi(I.id,J.trim()),D(null),ue(""))},className:"px-4 py-2 bg-navy text-white rounded hover:bg-navySecondary",children:"Save"})]})]})}),ce&&n.jsx("div",{className:"fixed inset-0 bg-black/40 z-[200] flex items-center justify-center p-4",children:n.jsxs("div",{className:"bg-panel rounded-xl shadow-xl w-full max-w-md p-6 space-y-4",children:[n.jsxs("h3",{className:"text-lg font-bold text-textLight flex items-center gap-2",children:[n.jsx(Jl,{className:"w-4 h-4"})," Send Reminder"]}),n.jsxs("p",{className:"text-sm text-textMuted",children:["Case: ",ce.insuredName||ce.odakanitNo||ce.id]}),n.jsx("label",{className:"text-xs font-bold text-textMuted",children:"Recipients"}),n.jsxs("select",{className:"w-full border rounded p-2 text-sm",value:ve,onChange:d=>$e(d.target.value),children:[n.jsx("option",{value:"LAWYER",children:"Lawyer"}),n.jsx("option",{value:"SUB_ADMIN",children:"Sub-Admin"}),n.jsx("option",{value:"BOTH",children:"Both"})]}),n.jsx("label",{className:"text-xs font-bold text-textMuted",children:"Message"}),n.jsx(go,{clientId:So,children:n.jsx("textarea",{className:"w-full border rounded p-3 text-sm",rows:4,value:fe,onChange:d=>Ee(d.target.value),placeholder:"Reminder details..."})}),n.jsxs("div",{className:"flex justify-end gap-2",children:[n.jsx("button",{onClick:()=>{le(null),Ee("")},className:"px-4 py-2 text-textMuted hover:bg-navySecondary rounded",children:"Cancel"}),n.jsx("button",{onClick:()=>{if(ce&&fe.trim()){const d=[];(ve==="LAWYER"||ve==="BOTH")&&d.push(ce.ownerName),(ve==="SUB_ADMIN"||ve==="BOTH")&&d.push(...ws.filter(m=>m.role==="SUB_ADMIN").map(m=>m.name)),jr({id:`reminder-${Date.now()}`,message:`Reminder to ${d.join(", ")}: ${fe.trim()}`,createdAt:new Date().toISOString(),reportId:ce.id}),le(null),Ee("")}},className:"px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700",children:"Send"})]})]})}),Gi&&n.jsx("div",{className:"fixed inset-0 bg-black/50 z-[250] flex items-center justify-center p-4",dir:"rtl",children:n.jsxs("div",{className:"bg-panel rounded-2xl shadow-2xl w-full max-w-md p-6 space-y-4",children:[n.jsx("h3",{className:"text-lg font-bold text-gold",children:"  "}),n.jsx("p",{className:"text-sm text-textLight",children:"     .        ."}),n.jsxs("div",{className:"flex flex-wrap gap-2 justify-end",children:[n.jsx("button",{type:"button",onClick:()=>{Tv(l,i,ne),Ir(!0)},className:"px-4 py-2 rounded-lg bg-navy text-gold text-sm font-semibold hover:bg-navySecondary",children:" "}),n.jsx("button",{type:"button",onClick:qi,disabled:!Na,title:Na?"":"    ",className:"px-4 py-2 rounded-lg bg-red-600 text-white text-sm font-semibold hover:bg-red-700 disabled:opacity-50 disabled:cursor-not-allowed",children:""}),n.jsx("button",{type:"button",onClick:()=>{ya(!1),Ir(!1)},className:"px-4 py-2 rounded-lg border border-borderDark text-textLight text-sm hover:bg-navySecondary",children:""})]}),Na&&n.jsx("p",{className:"text-xs text-green-600",children:" .   ."})]})}),Me&&Me.issues.length>0&&n.jsx("div",{className:"fixed inset-0 bg-black/40 z-[210] flex items-center justify-center p-4",children:n.jsxs("div",{className:"bg-panel rounded-2xl shadow-2xl w-full max-w-lg p-6 space-y-4",dir:"rtl",children:[n.jsxs("div",{className:"flex items-center justify-between gap-2",children:[n.jsx("h3",{className:"text-lg font-bold text-textLight",children:"  "}),n.jsx("button",{type:"button",onClick:()=>pe(null),className:"p-1 rounded hover:bg-slate-100 text-textMuted",children:n.jsx(Ht,{className:"w-4 h-4"})})]}),n.jsx("p",{className:"text-xs text-textMuted",children:"       PDF    .       ."}),n.jsx("ul",{className:"space-y-2 text-sm text-textLight",children:Me.issues.map(d=>n.jsxs("li",{className:"flex items-start justify-between gap-3 border border-slate-100 rounded-md px-3 py-2 bg-slate-50",children:[n.jsx("span",{className:"flex-1",children:d.label}),n.jsxs("div",{className:"flex flex-col items-end gap-1",children:[n.jsx("button",{type:"button",className:"text-[11px] text-indigo-700 hover:text-indigo-900 underline whitespace-nowrap",onClick:()=>{He(!0),Qt(d.intent)},children:"  ?"}),n.jsx("button",{type:"button",className:"text-[11px] text-textLight hover:text-textLight underline whitespace-nowrap",onClick:()=>{pe(null),(d.kind==="TRANSLATION_OUTDATED"||d.kind==="TONE_RISK_NOT_RUN"||d.kind==="EXPENSES_OLD")&&(dn(),o("STEP2"))},children:d.kind==="TRANSLATION_OUTDATED"?" ":d.kind==="TONE_RISK_NOT_RUN"?" Tone & Risk":d.kind==="EXPENSES_OLD"?"  ":" "})]})]},d.id))}),n.jsx("div",{className:"flex items-center justify-between pt-3 border-t border-slate-100 gap-3",children:n.jsx("button",{type:"button",className:"px-4 py-1.5 rounded-md bg-green-600 text-xs text-white hover:bg-green-700",onClick:()=>{const d=Me;pe(null),d!=null&&d.onContinue&&d.onContinue()},children:"  "})})]})}),K&&n.jsx(Vv,{report:K,sessions:T,onSwitch:O,onClose:ki,currentUser:e,onAddRowNote:$i,onResolveRowNote:Wi,onAddWorksheetRow:zi,previousReport:l.filter(d=>d.id!==K.id&&d.odakanitNo&&d.odakanitNo===K.odakanitNo).sort((d,m)=>new Date(m.reportDate).getTime()-new Date(d.reportDate).getTime())[0]})]})},Vv=({report:e,sessions:t,onSwitch:s,onClose:r,currentUser:a,onAddRowNote:o,onResolveRowNote:l,onAddWorksheetRow:c,previousReport:i})=>{const[u,p]=g.useState("table"),[y,b]=g.useState(""),[w,R]=g.useState(null),[E,W]=g.useState({category:"EXPERT_OUR",serviceProvider:"",amount:"",customLabel:""}),N=e.expenseWorksheet||Ps(),h=N.rows.filter(j=>j.type==="EXPENSE"),S=N.rows.filter(j=>j.type==="ADJUSTMENT"),P=N.notes.filter(j=>!j.resolved),U=N.totals||oi(N.rows),V=(a==null?void 0:a.role)==="FINANCE"||(a==null?void 0:a.role)==="SUB_ADMIN",X=ds.find(j=>j.value===E.category),te=(X==null?void 0:X.type)!=="ADJUSTMENT",G=j=>{y.trim()&&(o(e.id,j,y.trim()),b(""),R(null))},ae=()=>{const j=parseFloat(E.amount);isNaN(j)||j<=0||(c(e.id,{category:E.category,serviceProvider:te?E.serviceProvider:void 0,amount:j,customLabel:E.customLabel}),W({category:"EXPERT_OUR",serviceProvider:"",amount:"",customLabel:""}))};return n.jsx("div",{className:"fixed inset-0 bg-black/40 z-[220] flex items-center justify-center p-4",children:n.jsxs("div",{className:"bg-panel rounded-2xl shadow-2xl w-full max-w-5xl max-h-[90vh] overflow-hidden flex flex-col",children:[n.jsxs("div",{className:"flex justify-between items-center px-5 py-3 border-b bg-navySecondary",children:[n.jsxs("div",{children:[n.jsx("p",{className:"text-xs text-textMuted uppercase",children:"Expense Worksheet"}),n.jsxs("h2",{className:"text-lg font-bold text-textLight",children:[e.insuredName||e.odakanitNo||"Case","  ",e.ownerName]})]}),n.jsx("button",{onClick:()=>r(e.id),className:"text-textMuted hover:text-textLight",children:n.jsx(Ht,{className:"w-5 h-5"})})]}),n.jsx("div",{className:"flex border-b bg-panel px-4 overflow-x-auto",children:t.map(j=>n.jsxs("button",{onClick:()=>s(j.reportId),className:`flex items-center gap-2 px-3 py-2 text-sm border-b-2 ${j.reportId===e.id?"border-lpBlue text-lpBlue font-bold":"border-transparent text-gray-400"}`,children:[j.title,n.jsx("span",{onClick:F=>{F.stopPropagation(),r(j.reportId)},className:"text-gray-400 hover:text-red-500",children:n.jsx(Ht,{className:"w-3 h-3"})})]},j.reportId))}),n.jsx("div",{className:"flex gap-2 px-5 pt-4 text-sm font-semibold",children:["table","history","notes","compare"].map(j=>n.jsx("button",{onClick:()=>p(j),className:`px-3 py-1 rounded-full ${u===j?"bg-navy text-white":"bg-navySecondary text-textMuted"}`,children:j==="table"?"Worksheet":j==="history"?"History":j==="notes"?`Notes (${P.length})`:"Compare"},j))}),n.jsxs("div",{className:"flex-1 overflow-auto p-5 space-y-4",children:[u==="table"&&n.jsxs(n.Fragment,{children:[n.jsxs("div",{className:"grid grid-cols-3 gap-4 text-center bg-navySecondary rounded-lg py-3",children:[n.jsxs("div",{children:[n.jsx("p",{className:"text-xs uppercase text-gray-400",children:"Total Expenses"}),n.jsxs("p",{className:"text-lg font-bold text-textLight",children:["",U.totalExpenses.toLocaleString()]})]}),n.jsxs("div",{children:[n.jsx("p",{className:"text-xs uppercase text-gray-400",children:"Adjustments"}),n.jsxs("p",{className:"text-lg font-bold text-yellow-700",children:["",U.totalAdjustments.toLocaleString()]})]}),n.jsxs("div",{children:[n.jsx("p",{className:"text-xs uppercase text-gray-400",children:"Balance Due"}),n.jsxs("p",{className:"text-lg font-bold text-green-700",children:["",U.totalBalance.toLocaleString()]})]})]}),V&&n.jsxs("div",{className:"border rounded-lg p-3 bg-amber-50 space-y-2",children:[n.jsx("p",{className:"text-xs font-bold text-amber-700",children:"  "}),n.jsxs("div",{className:"grid md:grid-cols-3 gap-2",children:[n.jsx("select",{value:E.category,onChange:j=>W({...E,category:j.target.value}),className:"border rounded text-xs p-2",children:ds.map(j=>n.jsx("option",{value:j.value,children:j.label},j.value))}),E.category==="OTHER"&&n.jsx("input",{className:"border rounded text-xs p-2",placeholder:" ",value:E.customLabel,onChange:j=>W({...E,customLabel:j.target.value})}),te&&n.jsx("input",{className:"border rounded text-xs p-2",placeholder:" ",value:E.serviceProvider,onChange:j=>W({...E,serviceProvider:j.target.value})}),n.jsx("input",{className:"border rounded text-xs p-2",placeholder:" ",type:"number",min:"0",value:E.amount,onChange:j=>W({...E,amount:j.target.value})}),n.jsx("button",{onClick:ae,className:"bg-amber-500 text-white rounded text-xs font-bold px-3 py-2 hover:bg-amber-600",children:"Add"})]})]}),n.jsxs("div",{className:"grid md:grid-cols-2 gap-6",children:[n.jsxs("div",{children:[n.jsx("h4",{className:"text-sm font-bold text-textMuted mb-2",children:"Service Expenses"}),n.jsxs("div",{className:"space-y-2",children:[h.length===0&&n.jsx("p",{className:"text-xs text-gray-400",children:"No expenses recorded."}),h.map(j=>{const F=N.notes.filter(L=>L.rowId===j.id&&!L.resolved).length;return n.jsxs("div",{className:"border rounded-lg p-3 bg-panel shadow-sm",children:[n.jsxs("div",{className:"flex justify-between",children:[n.jsxs("div",{children:[n.jsx("p",{className:"font-semibold text-sm",children:j.label}),j.serviceProvider&&n.jsx("p",{className:"text-xs text-textMuted",children:j.serviceProvider})]}),n.jsxs("div",{className:"text-right",children:[n.jsxs("p",{className:"font-bold text-lpBlue",children:["",j.amount.toLocaleString()]}),n.jsxs("button",{className:"text-[10px] text-gray-400",onClick:()=>R(w===j.id?null:j.id),children:[" Notes (",F,")"]})]})]}),w===j.id&&n.jsxs("div",{className:"mt-2 flex gap-2",children:[n.jsx("input",{className:"flex-1 border rounded text-xs p-2",value:y,onChange:L=>b(L.target.value),placeholder:"Add note..."}),n.jsx("button",{onClick:()=>G(j.id),className:"px-3 py-1 text-xs bg-navy text-white rounded",children:"Save"})]})]},j.id)})]})]}),n.jsxs("div",{children:[n.jsx("h4",{className:"text-sm font-bold text-textMuted mb-2",children:"Adjustments"}),n.jsxs("div",{className:"space-y-2",children:[S.length===0&&n.jsx("p",{className:"text-xs text-gray-400",children:"No adjustments yet."}),S.map(j=>n.jsx("div",{className:"border rounded-lg p-3 bg-navySecondary",children:n.jsxs("div",{className:"flex justify-between",children:[n.jsx("p",{className:"font-semibold text-sm",children:j.label}),n.jsxs("p",{className:"font-bold text-red-600",children:["",j.amount.toLocaleString()]})]})},j.id))]})]})]}),n.jsxs("div",{className:"border rounded-lg p-3 bg-navySecondary",children:[n.jsx("label",{className:"block text-xs font-bold text-textMuted mb-1",children:"General Note"}),n.jsxs("div",{className:"flex gap-2",children:[n.jsx("input",{className:"flex-1 border rounded text-xs p-2",value:y,onChange:j=>b(j.target.value),placeholder:"Add note for worksheet..."}),n.jsx("button",{onClick:()=>G(void 0),className:"px-3 py-1 text-xs bg-navy text-white rounded",children:"Save"})]})]})]}),u==="history"&&n.jsxs("div",{className:"space-y-2",children:[N.history.length===0&&n.jsx("p",{className:"text-xs text-gray-400",children:"No history recorded yet."}),N.history.map(j=>n.jsxs("div",{className:"border rounded-lg p-3 bg-panel flex justify-between",children:[n.jsxs("div",{children:[n.jsx("p",{className:"text-sm font-semibold",children:j.action}),j.details&&n.jsx("p",{className:"text-xs text-textMuted",children:j.details})]}),n.jsxs("div",{className:"text-right text-[10px] text-gray-400",children:[n.jsx("p",{children:j.userName}),n.jsx("p",{children:new Date(j.timestamp).toLocaleString()})]})]},j.id))]}),u==="notes"&&n.jsxs("div",{className:"space-y-2",children:[N.notes.length===0&&n.jsx("p",{className:"text-xs text-gray-400",children:"No notes yet."}),N.notes.map(j=>n.jsx("div",{className:`border rounded-lg p-3 ${j.resolved?"bg-green-50":"bg-panel"}`,children:n.jsxs("div",{className:"flex justify-between",children:[n.jsxs("div",{children:[n.jsx("p",{className:"text-sm font-semibold",children:j.authorName}),n.jsx("p",{className:"text-xs text-textMuted",children:j.message})]}),n.jsxs("div",{className:"text-right text-[10px] text-gray-400",children:[n.jsx("p",{children:new Date(j.createdAt).toLocaleString()}),!j.resolved&&n.jsx("button",{onClick:()=>l(e.id,j.id),className:"text-xs text-green-600 hover:underline",children:"Resolve"})]})]})},j.id))]}),u==="compare"&&n.jsx("div",{children:i!=null&&i.expenseWorksheet?n.jsxs("div",{className:"grid md:grid-cols-2 gap-4",children:[n.jsxs("div",{className:"border rounded-lg p-3",children:[n.jsx("h4",{className:"text-sm font-bold text-textMuted mb-2",children:"Previous Report"}),n.jsx("p",{className:"text-xs text-gray-400 mb-2",children:new Date(i.reportDate).toLocaleDateString()}),n.jsxs("p",{className:"text-lg font-bold text-textLight",children:["",i.expenseWorksheet.totals.totalBalance.toLocaleString()]})]}),n.jsxs("div",{className:"border rounded-lg p-3",children:[n.jsx("h4",{className:"text-sm font-bold text-textMuted mb-2",children:"Current Report"}),n.jsx("p",{className:"text-xs text-gray-400 mb-2",children:new Date(e.reportDate).toLocaleDateString()}),n.jsxs("p",{className:"text-lg font-bold text-textLight",children:["",U.totalBalance.toLocaleString()]})]})]}):n.jsx("p",{className:"text-xs text-gray-400",children:"No previous worksheet available for comparison."})})]})]})})},Kv=()=>n.jsx(nv,{children:n.jsx(zv,{})}),qu=document.getElementById("root");console.log("Bootstrapping LP app, rootElement exists?",!!qu);if(!qu)throw new Error("Could not find root element to mount to");const Yv=Fc.createRoot(qu);Yv.render(n.jsx(ci.StrictMode,{children:n.jsx(Kv,{})}));export{Xh as g};
