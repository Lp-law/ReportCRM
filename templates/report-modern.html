<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Case Update Report</title>
    <style>
      :root {
        --lp-navy: #0b1f3b;
        --lp-gold: #b08d57;
        --lp-orange: #d97706;
        --lp-text: #0f172a;
        --lp-muted: #475569;
        --lp-border: #e2e8f0;
        --lp-bg: #f6f8fb;
      }

      * {
        box-sizing: border-box;
      }

      html,
      body {
        margin: 0;
        padding: 0;
      }

      body {
        font-family: "Segoe UI", system-ui, -apple-system, BlinkMacSystemFont, "Inter",
          Arial, sans-serif;
        font-size: 11.5pt;
        line-height: 1.5;
        color: var(--lp-text);
        background-color: #ffffff;
      }

      @page {
        size: A4;
        /* Margins are controlled by Puppeteer (page.pdf margin.*) */
      }

      .page {
        width: 100%;
        position: relative;
      }

      /* Optional watermark removed for a cleaner, neutral layout */

      .cover-page {
        padding: 20mm 18mm 18mm 18mm;
      }

      .cover-header {
        display: block;
        text-align: left;
        margin-bottom: 18mm;
      }

      .cover-logo-center {
        display: block;
        margin-bottom: 10mm;
      }

      .cover-logo-wrapper {
        margin: 0;
      }

      .cover-logo {
        display: block;
        margin: 0;
        max-height: 40mm;
        max-width: 88mm;
        object-fit: contain;
      }
      .cover-page-1 .cover-logo {
        max-height: 50mm; /* ~25% larger on cover page 1 only */
        max-width: 110mm;
      }

      .cover-title-block {
        text-align: center;
      }

      .cover-title-label {
        font-size: 10pt;
        text-transform: uppercase;
        letter-spacing: 0.18em;
        color: var(--lp-navy);
        border-bottom: 1px solid var(--lp-gold);
        display: inline-block;
        padding-bottom: 1mm;
      }

      .cover-title {
        margin: 4px 0 1mm;
        font-size: 28pt;
        letter-spacing: 0.14em;
        text-transform: uppercase;
        color: var(--lp-navy);
        font-weight: 800;
      }

      .cover-subtitle-secondary {
        margin-top: 1mm;
        font-size: 16pt;
        font-weight: 600;
        letter-spacing: 0.06em;
        color: var(--lp-text);
      }

      .cover-meta {
        margin-bottom: 18mm;
      }

      .cover-meta-row {
        display: grid;
        grid-template-columns: 32mm auto; /* fixed label column */
        column-gap: 6mm;                  /* spacing between label and value */
        font-size: 10pt;
        margin-bottom: 2mm;
        align-items: baseline;
      }

      .cover-meta-label {
        color: var(--lp-muted);
        text-transform: uppercase;
        letter-spacing: 0.12em;
      }

      .cover-meta-value {
        font-weight: 600;
        justify-self: start;
        text-align: left;
      }

      .cover-procedural-stage {
        font-size: 10pt;
        margin: 4mm 0 4mm;
        max-height: 1.2em;
        overflow: hidden;
        white-space: nowrap;
        text-overflow: ellipsis;
      }

      .previous-reports-section {
        margin: 8mm 0 10mm;
      }

      .previous-reports-title {
        font-size: 14pt;
        font-weight: 700;
        text-transform: uppercase;
        letter-spacing: 0.14em;
        color: var(--lp-navy);
        margin: 0 0 2mm;
      }

      .previous-reports-list {
        list-style: none;
        padding: 0;
        margin: 0;
        font-size: 12pt;
        color: var(--lp-text);
      }

      .previous-reports-item {
        margin-bottom: 1mm;
      }

      .previous-reports-none {
        font-size: 12pt;
        color: var(--lp-text);
      }

      .cover-card {
        border-radius: 10px;
        border: 1px solid var(--lp-border);
        padding: 9mm 9mm 8mm 9mm;
        background: var(--lp-bg);
      }

      .cover-section-title {
        font-size: 14pt;
        text-transform: uppercase;
        letter-spacing: 0.14em;
        color: var(--lp-navy);
        margin: 0 0 4mm;
      }

      .cover-grid {
        display: grid;
        grid-template-columns: 1.4fr 1.4fr;
        gap: 4mm 16mm;
        font-size: 12pt;
      }

      .cover-grid-group-title {
        font-weight: 600;
        text-transform: uppercase;
        letter-spacing: 0.12em;
        margin-bottom: 1mm;
        color: var(--lp-muted);
      }

      .cover-grid-item {
        margin-bottom: 1.25mm;
      }

      .cover-grid-label {
        font-size: 9pt;
        color: var(--lp-muted);
        text-transform: uppercase;
        letter-spacing: 0.12em;
      }

      .cover-grid-value {
        font-weight: 600;
      }

      /* cover-re-pack: atomic block (RE + Previous Reports) – never split; whole block on page 1 or whole on page 2 */
      .cover-re-pack {
        break-inside: avoid;
        page-break-inside: avoid;
        display: table;
        width: 100%;
        table-layout: fixed;
        margin-top: 4mm;
      }

      .cover-re-line {
        margin: 4mm 0 6mm;
        padding: 4mm 6mm;
        border-radius: 8px;
        border-left: 3px solid var(--lp-gold);
        background: rgba(176, 141, 87, 0.1);
        font-size: 11pt;
      }

      .cover-re-label {
        text-transform: uppercase;
        letter-spacing: 0.18em;
        font-size: 9pt;
        color: var(--lp-navy);
      }

      .cover-re-value {
        margin-top: 2mm;
        font-weight: 600;
        color: var(--lp-text);
        word-break: break-word;
      }

      .cover-confidential-label {
        margin-top: 3mm;
        font-size: 10.5pt;
        font-weight: 600;
        text-transform: uppercase;
        letter-spacing: 0.16em;
        color: var(--lp-orange);
        text-align: center;
        width: 100%;
      }

      .timeline-section {
        margin-top: 6mm;
        /* Smaller minimum height so the block fits better within the cover */
        min-height: 24mm;
        /* Keep the whole timeline block together on one page if possible */
        page-break-inside: avoid;
        break-inside: avoid;
      }

      .timeline-title {
        font-size: 14pt;
        font-weight: 700;
        text-transform: uppercase;
        letter-spacing: 0.16em;
        color: var(--lp-navy);
        margin: 0 0 3mm;
      }

      .timeline-list {
        list-style: none;
        padding: 0;
        margin: 0;
        font-size: 9.5pt;
        color: var(--lp-text);
      }

      .timeline-item {
        display: flex;
        align-items: baseline;
        gap: 4px;
        margin-bottom: 1.5mm;
      }

      .timeline-date {
        white-space: nowrap;
        font-weight: 600;
      }

      .timeline-sep {
        color: var(--lp-muted);
      }

      .timeline-label {
        flex: 1;
      }

      .timeline-graphic {
        margin: 10mm auto 12mm;
        text-align: center;
        page-break-inside: avoid;
        break-inside: avoid;
      }

      .timeline-graphic-title {
        font-size: 10pt;
        font-weight: 600;
        text-transform: uppercase;
        letter-spacing: 0.14em;
        color: var(--lp-muted);
        margin: 0 0 3mm;
      }

      .timeline-graphic-image {
        width: 100%;
        max-width: 640px;
        height: auto;
        display: block;
        margin: 0 auto;
      }

      /* Dedicated procedural timeline page */
      .timeline-page {
        padding: 18mm 18mm 18mm 18mm;
        box-sizing: border-box;
      }

      .timeline-page-inner {
        max-width: 170mm;
        margin: 0 auto;
      }

      .timeline-header {
        margin-bottom: 10mm;
      }

      .timeline-page-title {
        font-size: 18pt;
        font-weight: 700;
        letter-spacing: 0.16em;
        text-transform: uppercase;
        color: var(--lp-navy);
        margin: 0 0 2mm;
      }

      .timeline-page-subtitle {
        font-size: 11pt;
        font-weight: 600;
        color: var(--lp-muted);
        margin: 0 0 2mm;
      }

      .timeline-page-meta {
        font-size: 9.5pt;
        color: var(--lp-muted);
        margin: 0;
      }

      .timeline-page-body {
        font-size: 10pt;
      }

      .timeline-vertical-root {
        position: relative;
        padding-left: 10mm;
        page-break-inside: avoid;
        break-inside: avoid;
      }

      .timeline-vertical-line {
        position: absolute;
        left: 3mm;
        top: 0;
        bottom: 0;
        width: 1px;
        background-color: var(--lp-border);
      }

      .timeline-vertical-list {
        list-style: none;
        margin: 0;
        padding: 0;
      }

      .timeline-vertical-item {
        position: relative;
        display: flex;
        align-items: flex-start;
        gap: 4mm;
        margin-bottom: 4mm;
        word-break: break-word;
        padding: 2mm 3mm;
        border-radius: 4px;
        border: 1px solid var(--lp-border);
        background-color: #ffffff;
        box-sizing: border-box;
      }

      .timeline-vertical-dot {
        position: absolute;
        left: 0;
        top: 2px;
        width: 7px;
        height: 7px;
        border-radius: 999px;
        background-color: var(--lp-border);
      }

      .timeline-vertical-content {
        margin-left: 4mm;
      }

      .timeline-vertical-label {
        font-weight: 600;
      }

      .timeline-vertical-date {
        font-size: 9pt;
        color: var(--lp-muted);
        margin-top: 1mm;
      }

      .timeline-vertical-item-COMPLETED .timeline-vertical-dot {
        background-color: var(--lp-navy);
      }

      .timeline-vertical-item-CURRENT .timeline-vertical-dot {
        background-color: var(--lp-orange);
      }

      .timeline-vertical-item-UPCOMING .timeline-vertical-dot {
        background-color: var(--lp-border);
      }

      /* Slight density clamp for very long timelines (8+ stages) */
      .timeline-vertical-item:nth-child(n+8) {
        margin-bottom: 3mm;
        padding-top: 1.5mm;
        padding-bottom: 1.5mm;
      }

      .timeline-vertical-item:nth-child(n+8) .timeline-vertical-label {
        font-size: 9.5pt;
      }

      .timeline-vertical-item-CURRENT {
        border-color: var(--lp-navy);
        background-color: #f5f7fb;
      }

      .timeline-vertical-item-COMPLETED {
        border-color: var(--lp-navy);
      }

      .timeline-vertical-item-CURRENT .timeline-vertical-label::after {
        content: 'CURRENT';
        display: inline-block;
        margin-left: 4mm;
        padding: 0 3px;
        font-size: 8pt;
        font-weight: 600;
        border-radius: 999px;
        border: 1px solid var(--lp-orange);
        color: var(--lp-orange);
      }

      .timeline-vertical-item-CURRENT .timeline-vertical-dot {
        width: 9px;
        height: 9px;
        border-radius: 999px;
        box-shadow: 0 0 0 2px #ffffff, 0 0 0 4px var(--lp-orange);
      }

      .timeline-page-footer {
        margin-top: 12mm;
        font-size: 8.5pt;
        color: var(--lp-muted);
      }

      .page-break-after {
        page-break-after: always;
      }

      /* --- Appendix (Invoices) page-break rules --- */
      .appendix-block {
        break-before: page;
        page-break-before: always;
      }

      .appendix-root {
        width: 100%;
      }

      .appendix-item {
        break-before: page;
        page-break-before: always;
        break-inside: avoid;
        page-break-inside: avoid;
        margin-top: 12px;
      }

      .appendix-pdf {
        width: 100%;
        height: 92vh;
        display: block;
      }

      .appendix-caption {
        break-inside: avoid;
        page-break-inside: avoid;
        margin-top: 8px;
        font-size: 11px;
        color: var(--lp-muted);
        text-align: center;
      }

      /* Body */
      .body-root {
        padding-top: 4mm;   /* צמצום קל של הריווח העליון בעמודי ה-BODY */
        padding-left: 18mm;
        padding-right: 18mm;
        padding-bottom: 18mm;
        box-sizing: border-box;
      }

      .body-main {
        font-size: 11.5pt;
      }

      .exec-summary {
        border-radius: 8px;
        border: 1px solid #e5e7eb;
        background: #f9fafb;
        padding: 6mm;
        margin-bottom: 10mm;
      }

      .exec-summary-title {
        font-size: 11pt;
        font-weight: 700;
        text-transform: uppercase;
        letter-spacing: 0.14em;
        margin: 0 0 3mm;
        color: var(--lp-navy);
      }

      .exec-summary-content {
        font-size: 10.5pt;
        color: var(--lp-text);
      }

      .section-title {
        font-size: 11pt;
        font-weight: 700;
        text-transform: uppercase;
        letter-spacing: 0.14em;
        color: var(--lp-navy);
        margin: 0 0 3mm;
      }

      .section-title-inner {
        display: inline-block;
        padding-bottom: 1mm;
        border-bottom: 2px solid var(--lp-gold);
      }

      .section-content {
        font-size: 10.5pt;
        color: var(--lp-text);
        text-align: justify;
        word-break: break-word;
        overflow-wrap: anywhere;
      }

      .section-content p,
      .section-content li {
        unicode-bidi: plaintext;
      }

      .section-content p[dir="rtl"],
      .section-content li[dir="rtl"],
      .section-content .rtl {
        direction: rtl;
        text-align: right;
      }

      .placeholder-text {
        font-style: italic;
        color: var(--lp-muted);
      }

      .expenses-table {
        width: 100%;
        border-collapse: collapse;
        font-size: 9.5pt;
        margin-bottom: 4mm;
      }

      .expenses-table th,
      .expenses-table td {
        border: 1px solid var(--lp-border);
        padding: 4px 6px;
      }

      .expenses-table thead {
        background: rgba(11, 31, 59, 0.06);
        font-weight: 600;
        color: var(--lp-navy);
      }

      .amount-col {
        text-align: right;
        white-space: nowrap;
      }

      .recommendation {
        margin-top: 2mm;
        font-size: 9.5pt;
        background: #f3f4f6;
        border-left: 3px solid var(--lp-gold);
        padding: 4px 8px;
        color: var(--lp-text);
      }

      .closing-line {
        margin-top: 10mm;
        font-style: italic;
        font-size: 10.5pt;
        color: var(--lp-text);
      }

      .signature-block {
        margin-top: 8mm;
        font-size: 10.5pt;
      }

      .signature-label {
        font-weight: 600;
        margin: 0 0 2mm;
      }

      .signature-image {
        max-height: 28mm;
        margin: 2mm 0 2mm;
      }

      .signature-fallback {
        font-family: "Segoe Script", "Lucida Handwriting", cursive;
        font-size: 14pt;
        color: var(--lp-text);
        margin: 1mm 0 2mm;
      }

      .signature-name {
        font-weight: 600;
        margin: 0;
      }

      .footer-note {
        margin-top: 6mm;
        font-size: 8.5pt;
        color: var(--lp-text-muted);
      }
    
/* =========================================================
   TWO-PAGE COVER (Timeline stays on cover page 2)
   ========================================================= */

.page-break-after {
  page-break-after: always;
  break-after: page;
}

/* Cover page 1: visual only (spacing tuned below) */

/* Cover page 2: cover details + timeline */
.cover-page-2 {
  padding: 16mm 18mm 18mm 18mm;
}

/* Ensure cover-card styling applies nicely on page 2 */
.cover-page-2 .cover-card {
  box-sizing: border-box;
}

/* Timeline constrained within cover page 2 */
.cover-page-2 .timeline-graphic-image {
  width: 100%;
  max-width: 100%;
  /* Slightly smaller max-height so the arrow graphic fits comfortably
     together with the claim details and previous reports on a single page */
  max-height: 80mm;
  height: auto;
  object-fit: contain;
  display: block;
  margin: 0 auto;
}

/* =========================================================
   PATCH: cover spacing + optional cover image + body pagination
   ========================================================= */

/* Cover page 1: compact header-fixed + atomic cover-re-pack (RE + Previous Reports) */
.cover-page-1 {
  padding: 14mm 12mm 10mm 12mm;
  box-sizing: border-box;
}

/* Header (logo + title + meta) – compact, fixed height feel */
.cover-page-1 .cover-header-fixed {
  margin-bottom: 0;
}
.cover-page-1 .cover-header-fixed .cover-logo-center { margin-bottom: 6mm; }
.cover-page-1 .cover-header-fixed .cover-title { font-size: 24pt; margin: 3px 0 1mm; }
.cover-page-1 .cover-header-fixed .cover-meta { margin-top: 4mm; margin-bottom: 0; }
.cover-page-1 .cover-header-fixed .cover-meta-row { margin-bottom: 1mm; }

/* cover-re-pack: atomic – entire block on one page or entire at start of next */
.cover-page-1 .cover-re-pack { margin-top: 4mm; }
.cover-page-1 .cover-re-pack .cover-re-line { margin: 0 0 4mm; padding: 2mm 4mm; }
.cover-page-1 .cover-re-pack .previous-reports-section { margin: 0; }
.cover-page-1 .cover-re-pack .previous-reports-title { margin: 0 0 1.5mm; font-size: 12pt; }
.cover-page-1 .cover-re-pack .previous-reports-item { margin-bottom: 0.5mm; }

.cover-extra-image {
  width: 100%;
  display: flex;
  justify-content: center;
  margin-top: 8mm;
}

.cover-extra-image img {
  width: 100%;
  max-width: 165mm;
  height: auto;
  display: block;
  border-radius: 6px;
}

/* Body page-break hygiene */
.section-title { break-after: avoid; page-break-after: avoid; }

.section-content p, .section-content li { orphans: 3; widows: 3; }

.signature-block { break-inside: avoid; page-break-inside: avoid; }


.cover-page-1 .cover-header-fixed {
  display: flex;
  flex-direction: column;
}

/* ============================
   BODY: force content visibility + better page breaks
   ============================ */

/* Some section HTML may carry inline color styles; force readable text */
.section-content,
.section-content * {
  color: var(--lp-text) !important;
}

/* Keep titles with the first few lines (avoid orphan titles at bottom) */
.section-title {
  break-after: avoid-page;
  page-break-after: avoid;
}

.section-block {
  margin-bottom: 10mm;
  break-inside: auto;
  page-break-inside: auto;
  padding-top: 3mm; /* breathing room when a section starts at top of a new page */
}

/* Signature: space-dependent – stay with text when room, else new page (never split, never orphaned) */
.signature-page {
  page-break-before: avoid;   /* prefer same page as preceding content */
  padding-top: 8mm;           /* when at top of new page */
  break-inside: avoid;
  page-break-inside: avoid;
}
.signature-page .signature-block {
  break-inside: avoid;
  page-break-inside: avoid;
  margin-top: 8mm;            /* gap when attached to text */
  padding-top: 2mm;
}

</style>
  </head>
  <body>
    <!-- COVER PAGE 1: header-fixed (compact) + cover-re-pack (RE + Previous Reports, atomic) -->
    <div class="page cover-page cover-page-1 page-break-after">
      <div class="cover-header-fixed">
        <div class="cover-logo-center">
          <div class="cover-logo-wrapper">
            {{#if logoBase64}}
              <img src="{{logoBase64}}" alt="Lior Perry Law Firm" class="cover-logo" />
            {{/if}}
          </div>
        </div>
        <div class="cover-title-block">
          <div class="cover-confidential-label">CONFIDENTIAL</div>
          <h1 class="cover-title">CLAIM STATUS REPORT</h1>
          {{#if coverSubtitle}}
            <div class="cover-subtitle-secondary">{{coverSubtitle}}</div>
          {{/if}}
        </div>
        <div class="cover-meta">
          {{#if reportNumber}}
            <div class="cover-meta-row">
              <div class="cover-meta-label">Report No.</div>
              <div class="cover-meta-value">{{reportNumber}}</div>
            </div>
          {{/if}}
          {{#if reportDate}}
            <div class="cover-meta-row">
              <div class="cover-meta-label">Date</div>
              <div class="cover-meta-value">{{reportDate}}</div>
            </div>
          {{/if}}
        </div>
      </div>

      <div class="cover-re-pack">
        {{#if reportReLine}}
          <div class="cover-re-line">
            <div class="cover-re-label">Re:</div>
            <div class="cover-re-value">{{reportReLine}}</div>
          </div>
        {{/if}}
        <section class="previous-reports-section">
          <h3 class="previous-reports-title">PREVIOUS REPORTS</h3>
          {{#if previousReports.hasEntries}}
            <ul class="previous-reports-list">
              {{#each previousReports.entries}}
                <li class="previous-reports-item">{{display}}</li>
              {{/each}}
            </ul>
          {{else}}
            <p class="previous-reports-none">None</p>
          {{/if}}
        </section>
      </div>
    </div>

        <!-- COVER PAGE 2: Claim details, timeline (RE + Previous Reports are in cover-re-pack on page 1) -->
    <div class="page cover-page cover-page-2 page-break-after">
      <div class="cover-card">
        <h2 class="cover-section-title">Claim Details</h2>

        <div class="cover-grid">
          <div>
            {{#if odakanitNo}}
              <div class="cover-grid-item">
                <div class="cover-grid-label">Internal File</div>
                <div class="cover-grid-value">{{odakanitNo}}</div>
              </div>
            {{/if}}

            {{#if insurerName}}
              <div class="cover-grid-item">
                <div class="cover-grid-label">Insurer</div>
                <div class="cover-grid-value">{{insurerName}}</div>
              </div>
            {{/if}}

            {{#if insuredName}}
              <div class="cover-grid-item">
                <div class="cover-grid-label">Insured</div>
                <div class="cover-grid-value">{{insuredName}}</div>
              </div>
            {{/if}}

            {{#if plaintiffName}}
              <div class="cover-grid-item">
                <div class="cover-grid-label">{{plaintiffTitle}}</div>
                <div class="cover-grid-value">{{plaintiffName}}</div>
              </div>
            {{/if}}
          </div>

          <div>
            <div class="cover-grid-group-title">Policy</div>

            {{#if lineSlipNo}}
              <div class="cover-grid-item">
                <div class="cover-grid-label">Line Slip No.</div>
                <div class="cover-grid-value">{{lineSlipNo}}</div>
              </div>
            {{/if}}

            {{#if marketRef}}
              <div class="cover-grid-item">
                <div class="cover-grid-label">UMR / Market Ref.</div>
                <div class="cover-grid-value">{{marketRef}}</div>
              </div>
            {{/if}}

            {{#if certificateRef}}
              <div class="cover-grid-item">
                <div class="cover-grid-label">Certificate Ref.</div>
                <div class="cover-grid-value">{{certificateRef}}</div>
              </div>
            {{/if}}

            {{#if policyPeriodStart}}
              <div class="cover-grid-item">
                <div class="cover-grid-label">Policy Period</div>
                <div class="cover-grid-value">{{policyPeriodStart}}{{#if policyPeriodEnd}} – {{policyPeriodEnd}}{{/if}}</div>
              </div>
            {{/if}}
          </div>
        </div>

        {{#if currentProceduralStageLabel}}
          <p class="cover-procedural-stage">
            Procedural Stage: {{currentProceduralStageLabel}} (see Procedural Timeline on the following page)
          </p>
        {{/if}}

        {{#if timelineImage}}
          <div class="timeline-section">
            <h3 class="timeline-title">PROCEDURAL TIMELINE</h3>
            <div class="timeline-graphic">
              <img src="{{timelineImage}}" alt="Procedural Timeline" class="timeline-graphic-image" />
            </div>
          </div>
        {{/if}}
      </div>
    </div>

    {{#if proceduralTimeline}}
      <div class="page timeline-page page-break-after">
        <div class="timeline-page-inner">
          <header class="timeline-header">
            <h1 class="timeline-page-title">PROCEDURAL TIMELINE</h1>
            {{#if proceduralTimeline.procedureTypeLabel}}
              <p class="timeline-page-subtitle">{{proceduralTimeline.procedureTypeLabel}}</p>
            {{/if}}
            {{#if proceduralTimeline.metaLine}}
              <p class="timeline-page-meta">{{proceduralTimeline.metaLine}}</p>
            {{/if}}
          </header>

          <section class="timeline-page-body">
            <div class="timeline-vertical-root">
              <div class="timeline-vertical-line"></div>
              <ul class="timeline-vertical-list">
                {{#each proceduralTimeline.stages}}
                  <li class="timeline-vertical-item timeline-vertical-item-{{status}}">
                    <div class="timeline-vertical-dot"></div>
                    <div class="timeline-vertical-content">
                      <div class="timeline-vertical-label">{{label}}</div>
                      {{#if monthYearDisplay}}
                        <div class="timeline-vertical-date">{{monthYearDisplay}}</div>
                      {{/if}}
                    </div>
                  </li>
                {{/each}}
              </ul>
            </div>
          </section>

          <footer class="timeline-page-footer">
            <p class="timeline-page-note">
              Dates reflect estimated procedural milestones and may be subject to change.
            </p>
          </footer>
        </div>
      </div>
    {{/if}}

    <!-- BODY PAGES -->
    <div class="page body-root">
      <main class="body-main">
        {{#if hasExecutiveSummary}}
          <section class="exec-summary">
            <h2 class="exec-summary-title">Executive Summary</h2>
            <div class="exec-summary-content">
              {{{executiveSummaryHtml}}}
            </div>
          </section>
        {{/if}}

        {{#each sections}}
          <section class="section-block">
            <h2 class="section-title">
              <span class="section-title-inner">{{title}}</span>
            </h2>

            {{#if isExpenses}}
              {{#if html}}
                <div class="section-content">
                  {{{html}}}
                </div>
              {{else}}
              {{#if hasExpensesTable}}
                <table class="expenses-table">
                  <thead>
                    <tr>
                      <th>Date</th>
                      <th>Description</th>
                      <th class="amount-col">Amount</th>
                    </tr>
                  </thead>
                  <tbody>
                    {{#each expensesItems}}
                      <tr>
                        <td>{{date}}</td>
                        <td>{{description}}</td>
                        <td class="amount-col">{{amountDisplay}} {{currency}}</td>
                      </tr>
                    {{/each}}
                  </tbody>
                  {{#if expensesSum}}
                    <tfoot>
                      <tr>
                        <td colspan="2"><strong>Total Balance</strong></td>
                        <td class="amount-col"><strong>{{expensesSum}}</strong></td>
                      </tr>
                    </tfoot>
                  {{/if}}
                </table>
                {{#if paymentRecommendation}}
                  <div class="recommendation">
                    Recommendation: {{paymentRecommendation}}
                  </div>
                {{/if}}
              {{else}}
                {{#if contentHtml}}
                  <div class="section-content">
                    {{{contentHtml}}}
                  </div>
                {{else}}
                  <p class="placeholder-text">{{emptyExpensesPlaceholder}}</p>
                {{/if}}
              {{/if}}
              {{/if}}
            {{else}}
              {{#if contentHtml}}
                <div class="section-content">
                  {{{contentHtml}}}
                </div>
              {{else}}
                {{#if html}}
                  <div class="section-content">
                    {{{html}}}
                  </div>
                {{else}}
                  {{#if content}}
                    <div class="section-content">
                      {{{content}}}
                    </div>
                  {{else}}
                    {{#if text}}
                      <div class="section-content">
                        {{{text}}}
                      </div>
                    {{/if}}
                  {{/if}}
                {{/if}}
              {{/if}}
            {{/if}}
          </section>
        {{/each}}

        {{#if invoicesAppendixHtml}}
          <section class="section-block appendix-block">
            <h2 class="section-title">
              <span class="section-title-inner">Appendix – Invoices</span>
            </h2>
            <div class="section-content">
              <div class="appendix-root">
                {{{invoicesAppendixHtml}}}
              </div>
            </div>
          </section>
        {{/if}}

        <div class="signature-page">
        {{#if signatureImage}}
          <div class="signature-block">
            <img src="{{signatureImage}}" alt="Signature" class="signature-image" />
          </div>
        {{else}}
          {{#if signatureHtml}}
            <div class="signature-block">
              {{{signatureHtml}}}
            </div>
          {{else}}
            <div class="signature-block">
              <div class="signature-name">{{signatureName}}</div>
              <div class="signature-title">{{signatureTitle}}</div>
            </div>
          {{/if}}
        {{/if}}
        </div>
      </main>
    </div>
  </body>
</html>


