<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Report</title>
    <style>
      @page {
        margin: 140px 40px 180px 40px;
      }

      body {
        font-family: "Segoe UI", Arial, sans-serif;
        font-size: 12px;
        line-height: 1.6;
        color: #0f172a;
        margin: 0;
      }

      .header,
      .footer {
        position: fixed;
        left: 50px;
        right: 50px;
        background: #fff;
        font-size: 11px;
      }

      .header {
        top: 0;
        height: 90px;
        padding: 10px 0 6px;
        background: #fff;
      }

      .header-logo-wrapper {
        text-align: center;
        height: 60px;
        display: flex;
        align-items: center;
        justify-content: center;
      }

      .header-logo {
        max-height: 55px;
        object-fit: contain;
      }

      .header-divider {
        height: 2px;
        background: #d4af37;
        margin: 6px 0 4px;
      }

      .footer {
        bottom: 24px;
        padding: 8px 0 6px;
        border-top: 2px solid #d4af37;
      }

      .footer-lawyers {
        display: grid;
        grid-template-columns: repeat(6, 1fr);
        gap: 6px;
        font-size: 10px;
        text-align: center;
        color: #0f172a;
      }

      .footer-contact {
        border-top: 1px solid #d4af37;
        margin-top: 6px;
        padding-top: 6px;
        font-size: 10px;
        color: #475569;
        line-height: 1.5;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 12px;
        flex-wrap: wrap;
      }

      .footer-logo img {
        max-height: 32px;
      }

      .footer-contact-text {
        text-align: center;
      }

      .logo-bottom {
        max-height: 55px;
      }

      .main {
        margin: 0;
        padding: 10px 0 60px;
      }

      .meta-grid {
        display: grid;
        grid-template-columns: 170px 1fr;
        gap: 4px 12px;
        font-size: 11px;
        margin-bottom: 18px;
        padding-top: 8px;
        border-top: 1px solid #e2e8f0;
      }

      .meta-label {
        font-weight: 600;
        color: #1e293b;
        text-transform: uppercase;
        letter-spacing: 0.08em;
      }

      .meta-value {
        border-bottom: 1px solid #e2e8f0;
        min-height: 18px;
      }

      .section-block {
        margin-top: 24px;
      }

      .section-title {
        font-size: 13px;
        font-weight: 700;
        text-transform: uppercase;
        letter-spacing: 0.08em;
        color: #0f172a;
        margin: 18px 0 8px;
      }

      .section-title-inner {
        display: inline-block;
        border-bottom: 2px solid #60a5fa;
        padding-bottom: 2px;
      }

      .section-content {
        font-size: 12px;
        color: #1f2937;
        text-align: justify;
        word-break: break-word;
      }

      .placeholder-text {
        font-style: italic;
        color: #64748b;
      }

      .current-report {
        margin-top: 6px;
        font-weight: 600;
        color: #0f172a;
      }

      .timeline-block {
        text-align: center;
      }

      .timeline-image {
        width: 100%;
        max-height: 260px;
        object-fit: contain;
        border: 1px solid #e2e8f0;
        border-radius: 8px;
        padding: 8px;
        background: #fff;
      }

      .expenses-table {
        width: 100%;
        border-collapse: collapse;
        font-size: 11px;
        margin-bottom: 8px;
      }

      .expenses-table th,
      .expenses-table td {
        border: 1px solid #e2e8f0;
        padding: 6px;
        text-align: left;
      }

      .expenses-table thead {
        background: #f8fafc;
        font-weight: 600;
      }

      .amount-col {
        text-align: right;
        white-space: nowrap;
      }

      .recommendation {
        margin-top: 6px;
        font-style: italic;
        background: #ecfdf5;
        border-left: 3px solid #10b981;
        padding: 6px 10px;
        color: #065f46;
      }

      .closing-line {
        margin-top: 32px;
        font-style: italic;
        color: #0f172a;
      }

      .signature-block {
        margin-top: 24px;
        text-align: left;
      }

      .signature-label,
      .signature-name {
        font-weight: 600;
        margin: 0;
      }

      .signature-image {
        max-height: 65px;
        margin: 2px 0 4px;
      }

      .signature-fallback {
        font-family: "Segoe Script", "Lucida Handwriting", cursive;
        font-size: 20px;
        color: #1d4ed8;
        margin: 2px 0 4px;
      }

      .signature-block {
        page-break-inside: avoid;
        break-inside: avoid;
        page-break-after: avoid;
      }

      .report-date-line {
        text-align: right;
        font-size: 11px;
        margin-bottom: 10px;
        letter-spacing: 0.05em;
      }

      .previous-reports-title {
        font-size: 13px;
        font-weight: 700;
        text-transform: uppercase;
        letter-spacing: 0.1em;
        color: #0f172a;
        margin: 0 0 6px;
      }
    </style>
  </head>
  <body>
    <div class="header">
      <div class="header-logo-wrapper">
        {{#if topLogo}}
          <img src="{{topLogo}}" class="header-logo" />
        {{/if}}
      </div>
      <div class="header-divider"></div>
    </div>

    <div class="footer">
      <div class="footer-lawyers">
        <div>Adv. May Harari</div>
        <div>Adv. Vlada Boltach</div>
        <div>Adv. Orly Day</div>
        <div>Adv. Hava Kabilo</div>
        <div>Adv. Ori Marom</div>
        <div>Adv. Lior Perry</div>
      </div>
      <div class="footer-contact">
        {{#if bottomLogo}}
          <div class="footer-logo">
            <img src="{{bottomLogo}}" class="logo-bottom" alt="Lior Perry Branding" />
          </div>
        {{/if}}
        <div class="footer-contact-text">
          <div>HaTamar 3, Even Yehuda 4050003</div>
          <div>www.liorperry.law | 077-571-2999 .Tel | 077-470-4677 .Fax | Office@lp-law.co.il</div>
        </div>
      </div>
    </div>

    <div class="main">

      {{#if reportDate}}
        <div class="report-date-line">DATE: {{reportDate}}</div>
      {{/if}}

      {{#if hasMetaRows}}
        <div class="meta-grid">
          {{#if insurerName}}
            <div class="meta-label">INSURER</div>
            <div class="meta-value">{{insurerName}}</div>
          {{/if}}
          {{#if uniqueMarketRef}}
            <div class="meta-label">UNIQUE MARKET REF</div>
            <div class="meta-value">{{uniqueMarketRef}}</div>
          {{/if}}
          {{#if certificateRef}}
            <div class="meta-label">CERTIFICATE REF</div>
            <div class="meta-value">{{certificateRef}}</div>
          {{/if}}
          {{#if insuredName}}
            <div class="meta-label">INSURED</div>
            <div class="meta-value">{{insuredName}}</div>
          {{/if}}
          {{#if plaintiffName}}
            <div class="meta-label">{{plaintiffTitle}}</div>
            <div class="meta-value">{{plaintiffName}}</div>
          {{/if}}
        </div>
      {{/if}}

      <div class="section-block">
        <h3 class="previous-reports-title">Previous Reports</h3>
        <div class="section-content">
          {{#if previousReports.hasEntries}}
            {{#each previousReports.entries}}
              <p>
                Report {{reportNumber}}
                {{#if subject}} â€“ {{subject}}{{/if}}
                {{#if date}}, {{date}}{{/if}}
              </p>
            {{/each}}
          {{else}}
            <p class="placeholder-text">[No Previous Reports]</p>
          {{/if}}
          <p class="current-report">{{previousReports.currentReportLabel}}</p>
        </div>
      </div>

      {{#if timeline.hasImage}}
        <div class="section-block timeline-block">
          <img src="{{timeline.imageSrc}}" alt="Case timeline" class="timeline-image" />
        </div>
      {{else}}
        {{#if timeline.placeholder}}
          <div class="section-block timeline-block">
            <p class="placeholder-text">{{timeline.placeholder}}</p>
          </div>
        {{/if}}
      {{/if}}

      {{#if hasExecutiveSummary}}
        <div class="section-block">
          <h3 class="section-title"><span class="section-title-inner">Executive Summary</span></h3>
          <div class="section-content">{{{executiveSummaryHtml}}}</div>
        </div>
      {{/if}}

      {{#each sections}}
        <div class="section-block">
          <h3 class="section-title"><span class="section-title-inner">{{title}}</span></h3>
          {{#if isExpenses}}
            {{#if hasExpensesTable}}
              <table class="expenses-table">
                <thead>
                  <tr>
                    <th>Date</th>
                    <th>Description</th>
                    <th class="amount-col">Amount</th>
                  </tr>
                </thead>
                <tbody>
                  {{#each expensesItems}}
                    <tr>
                      <td>{{date}}</td>
                      <td>{{description}}</td>
                      <td class="amount-col">{{amountDisplay}} {{currency}}</td>
                    </tr>
                  {{/each}}
                </tbody>
                {{#if expensesSum}}
                  <tfoot>
                    <tr>
                      <td colspan="2"><strong>Total Balance</strong></td>
                      <td class="amount-col"><strong>{{expensesSum}}</strong></td>
                    </tr>
                  </tfoot>
                {{/if}}
              </table>
              {{#if paymentRecommendation}}
                <div class="recommendation">Recommendation: {{paymentRecommendation}}</div>
              {{/if}}
            {{else}}
              <p class="placeholder-text">{{emptyExpensesPlaceholder}}</p>
            {{/if}}
          {{else}}
            <div class="section-content">{{{contentHtml}}}</div>
          {{/if}}
        </div>
      {{/each}}

      {{#if closingLine}}
        <p class="closing-line">{{closingLine}}</p>
      {{/if}}

      <div class="signature-block">
        <p class="signature-label">Yours sincerely,</p>
        {{#if signatureImage}}
          <img src="{{signatureImage}}" alt="Signature" class="signature-image" />
        {{else}}
          <div class="signature-fallback">{{signatureFallbackText}}</div>
        {{/if}}
        <p class="signature-name">Adv. Lior Perry</p>
      </div>
    </div>
  </body>
</html>
