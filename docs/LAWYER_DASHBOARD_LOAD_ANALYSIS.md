# אבחון עומס דשבורד עורכת הדין

**תאריך:** פברואר 2025  
**הקשר:** DRY RUN – אבחון מוצרי UX ממוקד  
**מטרה:** מיפוי, הבנה ואבחון בלבד – ללא פתרונות, ללא שינוי קוד

---

## 1. Executive Summary

הדשבורד פועל במצב `minimalDashboard = true`, ומציג חמישה אזורים עיקריים: כותרת "העומס שלי היום" (משלושה מספרים + רשימת טיוטות), טבלת "תיקים לפי מספר עודכנית", שלוש כרטיסיות סטטיסטיקות (דיווחים כספיים, ממתין לחשבוניות, טיוטות/מוכן לשליחה), וטבלת "דיווחים / טבלאות הוצאות שנשלחו מאיריס". המקורות: `reports`, `caseFolders`, `notifications` – כולם מאותו state. יש חפיפה: אותם דיווחים מופיעים במספר תצוגות; הכרטיסיות והמספרים משתמשים באותם מאגרי נתונים עם פיצולים שונים.

---

## 2. טבלת כרטיסיות – תפקיד, מקור נתונים, שלב עבודה

| כרטיסיה | תפקיד | מקור נתונים | ישות/סטטוס | קהל יעד | שלב ביום |
|---------|-------|-------------|-------------|---------|----------|
| **העומס שלי להיום** | סיכום מספרי + רשימת טיוטות | `mine` (reports.createdBy === user.id, לא deletedAt, לא closed) | שלושה מספרים: financeTasksCount, waitingForInvoicesCount, readyToSendCount; רשימה: כל דיווח עם status ≠ SENT | עורכת דין | תחילת יום – סקירה ראשונה |
| **תיקים לפי מספר תיק בעודכנית** | תצוגה ממוקדת תיקים (case-centric) | `caseRows` – נגזר מ־`mine` + `caseFolders` + `reports` | שורה לכל odakanitNo: מבוטח, תובעת, חברת ביטוח, Report No, Next Report No | עורכת דין | איתור תיק ספציפי, מעקב לפי תיק |
| **דיווחים כספיים מאיריס** (כרטיסית ספירה) | מספר דיווחים עם טבלת הוצאות מאיריס שטרם נשלחו | `mine` מסונן: `!!r.expensesSheetId && r.status !== 'SENT'` | financeTasksCount | עורכת דין | עדכון על משימות פיננסיות |
| **ממתין לחשבונית** (כרטיסית ספירה) | מספר דיווחים שממתינים לחשבוניות | `mine` מסונן: `r.status === 'WAITING_FOR_INVOICES'` | waitingForInvoicesCount | עורכת דין | הזמנת חשבוניות / המתנה לאיריס |
| **טיוטה / מוכן לשליחה** (כרטיסית ספירה) | מספר דיווחים מוכנים לשליחה | `mine` מסונן: `r.status === 'READY_TO_SEND'` | readyToSendCount | עורכת דין | לפני שליחה לליאור |
| **דיווחים / טבלאות הוצאות שנשלחו מאיריס** | טבלת פרטי דיווחים עם טבלאות הוצאות מאיריס | `financeReports` = `mine` מסונן: `!!r.expensesSheetId && r.status !== 'SENT'` | אותם דיווחים שמספר ה־"דיווחים כספיים מאיריס" מייצג | עורכת דין | טיפול בדיווחים כספיים פתוחים |

**הערה:** הכותרת "דיווחים / טבלאות הוצאות שנשלחו מאיריס" מתייחסת לטבלאות הוצאות שנשלחו **מאיריס** לעורכת הדין, ולא לדיווחים שנשלחו **לאיריס**. ההנחיה בקוד מחדדת: דיווחים שבהם התקבלה טבלת הוצאות מאיריס ועדיין לא נשלחו לליאור.

---

## 3. מיפוי חפיפות לוגיות

### חפיפה מלאה

| כרטיסיה א׳ | כרטיסיה ב׳ | השדה/התנאי | תיאור החפיפה |
|-------------|-------------|--------------|---------------|
| דיווחים כספיים מאיריס (ספירה) | דיווחים / טבלאות הוצאות שנשלחו מאיריס (טבלה) | `expensesSheetId` + `status !== 'SENT'` | אותה אוכלוסיית דיווחים: הכרטיסייה מציגה את המספר, הטבלה מציגה את הרשימה המפורטת. |

### חפיפה חלקית

| כרטיסיה א׳ | כרטיסיה ב׳ | השדה/התנאי | תיאור החפיפה |
|-------------|-------------|--------------|---------------|
| העומס שלי להיום (רשימה) | תיקים לפי מספר עודכנית | `mine`, `caseRows` | אותה אוכלוסיית דיווחים בשתי תצוגות: האחת לפי דיווח, השנייה לפי תיק (אודאקנית). דיווח אחד יכול להופיע ברשימת "העומס" ובשורת התיק המתאימה. |
| דיווחים כספיים מאיריס | ממתין לחשבונית | דיווח עם `expensesSheetId` + `WAITING_FOR_INVOICES` | דיווח כזה נספר גם ב־"דיווחים כספיים מאיריס" וגם ב־"ממתין לחשבונית". |
| דיווחים כספיים מאיריס | טיוטה / מוכן לשליחה | דיווח עם `expensesSheetId` + `READY_TO_SEND` | דיווח כזה נספר גם ב־"דיווחים כספיים מאיריס" וגם ב־"טיוטה / מוכן לשליחה". |

### חפיפה בנתונים (אותו מקור, חיתוכים שונים)

| מקור נתונים | חיתוך | כרטיסיות משתמשות |
|-------------|-------|-------------------|
| `mine` | `status !== 'SENT'` | רשימת "העומס שלי להיום" |
| `mine` | `!!expensesSheetId && status !== 'SENT'` | "דיווחים כספיים מאיריס" (ספירה + טבלה) |
| `mine` | `status === 'WAITING_FOR_INVOICES'` | "ממתין לחשבונית" |
| `mine` | `status === 'READY_TO_SEND'` | "טיוטה / מוכן לשליחה" |

### ניסוח לעומת לוגיקה

- **"דיווחים / טבלאות הוצאות שנשלחו מאיריס"** – הכותרת מתייחסת לכך שהטבלאות נשלחו **מאיריס** לעורכת הדין. ההנחיה מתארת בפירוש: דיווחים עם טבלת הוצאות מאיריס שעדיין לא נשלחו לליאור. אין כאן חפיפה בשם בלבד – הלוגיקה והנתונים תואמים.
- **"ממתין לחשבונית"** לעומת **"דיווחים כספיים מאיריס"** – שתי כותרות שונות לאותו דיווח כשמדובר בדיווח עם טבלת הוצאות מאיריס שממתין לחשבוניות.

---

## 4. אבחון עומס מידע

### אזורים שמוצגים בו־זמנית (minimalDashboard = true)

1. **Header** – כותרת, משתמש, כפתורי פעולה (פתיחת תיק, התראות, עזרה, התנתקות)  
2. **העומס שלי להיום** – שלושה מספרים + רשימה בגלילה (עד max-h-40)  
3. **תיקים לפי מספר עודכנית** – טבלה עם 6 עמודות  
4. **סיכום לוח בקרה** – 3 כרטיסיות סטטיסטיקות (grid)  
5. **דיווחים / טבלאות הוצאות שנשלחו מאיריס** – טבלה עם 6 עמודות  

סה״כ חמישה אזורי תוכן עיקריים.

### אזורים שמושכים תשומת לב (UI)

- **כרטיסיות הסטטיסטיקות** – רקע כהה, אייקונים, מספרים גדולים (text-xl), גבולות מודגשים בעת בחירה.  
- **Header** – זהב, גודל גופן בולט.  
- **שורות "דורש טיפול"** בטבלת התיקים – border אדום, רקע אדום־בהיר.  
- **רשימת העומס** – גלילה וצפיפות שורות עשויות לגרום לתחושת עומס.

### אזורים שנדחקים או מצטמצמים

- **רשימת "העומס שלי להיום"** – `max-h-40` מגביל את הגלילה; כשיש הרבה טיוטות – חלק נסתר.  
- **טבלאות** – על מסכים קטנים יופיע scroll אופקי; עמודות רבות עלולות להקטין נראות.  
- **הנחיות טקסט** – font קטן (text-[11px]), צבע `text-textMuted` – פחות בולטות.

### אזורים קריטיים מול משניים

- **קריטי:** רשימת "העומס" (טיוטות פעילות), טבלת תיקים (מיפוי תיק↔דיווח), כרטיסיית "דיווחים כספיים מאיריס".  
- **משני אבל תופס מקום:** שלוש כרטיסיות הספירה – מציגות מספרים שכבר מופיעים ב־"העומס שלי להיום" ובטבלאות; ההבדל הוא אינטראקטיביות (סינון בעת לחיצה).

### קושי זיהוי מידע קריטי

- שלושת המספרים מופיעים פעמיים: ב־"העומס שלי להיום" וב־DashboardStats.  
- אותו דיווח יכול להופיע בכמה תצוגות – קשה לדעת מה "המקור האחד" לעדכון.  
- הכותרת "דיווחים / טבלאות הוצאות שנשלחו מאיריס" עלולה להתפרש כ"נשלחו לאיריס" – בניגוד למשמעות בפועל (נשלחו **מאיריס**).

---

## 5. זרימת עבודה יומית (As-Is)

### הזרימה כפי שמשתמעת מהקוד

1. **כניסה** – הדשבורד נטען עם Header.  
2. **סריקה ראשונה** – "העומס שלי להיום" אמור לתת תמונת מצב: כמה דיווחים כספיים, כמה ממתינים לחשבוניות, כמה מוכנים לשליחה, ורשימת כל הטיוטות.  
3. **איתור תיק** – טבלת "תיקים לפי מספר עודכנית" מאפשרת מעבר לתיק ספציפי (לחיצה על odakanitNo).  
4. **סינון** – לחיצה על כרטיסיית סטטיסטיקה (כשזמינה) אמורה לסנן את התצוגה; במצב minimal אינה משפיעה על טבלאות "העומס" ו־"תיקים" – רק על ActionList, שמוסתר.  
5. **טיפול בדיווחים כספיים** – טבלת "דיווחים / טבלאות הוצאות שנשלחו מאיריס" מאפשרת פתיחת דיווח כספי ישירות.

### השוואה: אידאלי מול מבנה נוכחי

| היבט | אידאלי (משתמע) | מבנה נוכחי |
|------|-----------------|------------|
| סדר צפייה | העומס קודם, אחריו תיקים, ואז דיווחים כספיים | העומס קודם, אחריו תיקים, ואז כרטיסיות ספירה, ולבסוף טבלת דיווחים כספיים |
| משיכת תשומת לב | מספרים בולטים של משימות דחופות | כרטיסיות הספירה בולטות; המספרים מופיעים גם ב־"העומס" |
| קישור תיק↔דיווח↔טבלת הוצאות | לחיצה אחת בין תצוגות | תיק↔דיווח דרך טבלת התיקים; דיווח כספי דרך טבלה נפרדת; אין קישור ויזואלי ישיר בין הטבלאות |
| פעולה ראשונה | המשך טיפול אחרון / פתיחת תיק חדש | כפתור "פתיחת תיק חדש" ב־Header; "המשך טיפול" מוסתר ב־minimal mode |

---

## 6. סיכום

### מה ברור

- מקורות הנתונים: `reports`, `caseFolders`, `notifications` – כולם מאותו state.  
- הגדרת הכרטיסיות והטבלאות בקוד – תנאי סינון ו־mapping ברורים.  
- חפיפה לוגית: אותו דיווח נספר ומוצג במספר תצוגות.  
- במצב minimal, ActionList (4 דליים), SearchAndFilters, Density, Focus mode ו־Resume מוסתרים.  

### מה פחות ברור

- האם הכוונה שהכרטיסיות יבצעו סינון בפועל – במצב minimal אין להן השפעה על התצוגה.  
- האם "דיווחים / טבלאות הוצאות שנשלחו מאיריס" מובן למשתמשת כטבלאות מאיריס (לא דיווחים שנשלחו לאיריס).  
- מה התפקיד המדויק של שלוש כרטיסיות הספירה כש־ActionList מוסתר.  

### שאלות מוצריות פתוחות

1. מה העדיפות האמיתית: תצוגת תיקים (case-centric) לעומת תצוגת דיווחים (report-centric)?  
2. האם הכוונה לאחד את המספרים (העומס vs. כרטיסיות) למקום אחד, או לשמור על שני מקומות?  
3. האם במצב minimal כרטיסיות הספירה אמורות לסנן משהו – ואם כן, את מה?  
4. מה חשוב יותר בבוקר: רשימת טיוטות, טבלת תיקים, או דיווחים כספיים מאיריס?  

---

*מסמך אבחון בלבד – ללא פתרונות, ללא TODO, ללא קוד.*
