# סיכום שיפורי UX במודול הפיננסי

## קבצים ששונו

| קובץ | שינויים |
|------|---------|
| `src/utils/financialExpenseStatusLabels.ts` | **חדש** – פונקציות תוויות סטטוס אחידות |
| `src/components/finance/FinanceExpenseSheetEditor.tsx` | isDirty, Guardrail יציאה, Badge רשמי/היסטורי, הסבר נעילה, הסתרת JSON ל-FINANCE, טקסטים |
| `src/components/finance/FinanceExpensesDashboard.tsx` | Badge רשמי/היסטורי, מיון רשמי קודם, תוויות סטטוס אחידות, הסבר מחיקה חסומה |

## 1. Unsaved Changes Guardrail

- **isDirty** – נדלק בכל שינוי במטא, שורות, נספחים או קישור נספח.
- **כפתור שמירה**: `"שמור טיוטה (יש שינויים)"` כאשר יש שינויים, `"נשמר ✓"` כשאין.
- **יציאה** – בלחיצה על "חזרה לרשימה" עם שינויים לא שמורים: Confirm "יש שינויים שלא נשמרו. לצאת בלי לשמור?".
- **רענון/סגירת דף** – `beforeunload` מזהיר כשיש שינויים לא שמורים.
- **אחרי שמירה מוצלחת** – isDirty מוגדר ל-false.

## 2. סימון גיליון רשמי

- **רשימה** – Badge "רשמי" (ירוק) או "היסטורי" (אפור) בעמודת הסטטוס.
- **עורך** – Badge "רשמי" או "היסטורי" ליד כותרת התיק.
- **מיון** – הגיליון הרשמי מוצג ראשון ברשימה (לפי תיק).

## 3. איחוד תצוגת סטטוסים

- **`financialExpenseStatusLabels.ts`** – `getFinancialExpenseStatusLabelHe`, `getFinancialExpenseStatusLabelHeRaw`, `FINANCIAL_STATUS_OPTIONS`.
- הרשימה, המסנן והעורך משתמשים באותן פונקציות.
- READY_FOR_REPORT תמיד מוצג כ"נשלח לעו״ד" (לא "מוכן לדיווח").

## 4. הסבר למצבי חסימה

- **נעילה אחרי שולם** – "הדיווח סומן כשולם ולכן הגיליון נעול לעריכה. רק ADMIN יכול לתקן עם הערה."
- **מחיקה חסומה** – "לא ניתן למחוק גיליון שמשויך לדיווח ששולם." במקום כפתור מחיקה.

## 5. ניקוי רעש טכני

- **Export JSON** – מוצג רק ל־ADMIN (מוסתר עבור FINANCE).
- **"INFO_ONLY"** → "לידיעה בלבד (ללא בקשה לתשלום)".
- **"amountBeforeInfoOnly"** → "סכום להזמנה בדיווח זה (לפני סעיפים לידיעה בלבד)".

---

## אישור

**לא שונתה לוגיקת חישוב** – `financialExpensesCalculator` לא שונה.  
**לא שונה workflow** – סטטוסים, מעברי מצבים וזרימת עסקית ללא שינוי.  
**רק שינויים ב־UI / טקסטים / Guardrails.**
